<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸­ï¼‰è¿ç®—ç¬¦é‡è½½</title>
      <link href="/p/43924/"/>
      <url>/p/43924/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><h2 id="å…­ã€è¿ç®—ç¬¦é‡è½½">å…­ã€è¿ç®—ç¬¦é‡è½½</h2><p>åœ¨å‰é¢æˆ‘ä»¬æ¥è§¦è¿‡å‡½æ•°é‡è½½ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªåŒåå‡½æ•°ï¼Œåªè¦å®ƒä»¬æœ‰å”¯ä¸€çš„å‡½æ•°ç­¾åï¼ˆç”±å‡½æ•°å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€å‡½æ•°åç»„æˆï¼‰å¯ä»¥è®©ç¼–è¯‘å™¨åŒºåˆ†å³å¯ã€‚</p><p><strong>åœ¨C++ä¸­ï¼Œè¿ç®—ç¬¦è¢«è§†ä¸ºå‡½æ•°ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥è¿›è¡Œé‡è½½</strong>ã€‚</p><p>è®¤è¯†ä¸‹è¿ç®—ç¬¦è¿™ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚</p><p>è¿ç®—ç¬¦<code>operator+</code> ä½œä¸ºå‡½æ•°ï¼Œæ¥æ”¶äº†ä¸¤ä¸ª<code>int</code>ç±»å‹å‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x &#123; <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">int</span> y &#123; <span class="number">3</span> &#125;;</span><br><span class="line">x+y;   </span><br></pre></td></tr></table></figure><p>é‡è½½å‡½æ•°<code>operator+</code> ï¼Œåˆæ¥æ”¶äº†ä¸¤ä¸ª<code>double</code> ç±»å‹å‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> x &#123; <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">double</span> y &#123; <span class="number">3</span> &#125;;</span><br><span class="line">x+y; </span><br></pre></td></tr></table></figure><p>è¿™éƒ½æ˜¯C++ä¸ºæˆ‘ä»¬å†…ç½®å®ç°äº†<code>operator+</code> é‡è½½ï¼Œç”¨äºC++åŸºæœ¬ç±»å‹ä¹‹é—´è¿ç®—ã€‚</p><p><strong>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰é‡è½½è‡ªå·±çš„è¿ç®—ç¬¦å‡½æ•°</strong>ã€‚</p><p>è™½ç„¶C++ ä¸­å‡ ä¹æ‰€æœ‰çš„è¿ç®—ç¬¦æˆ‘ä»¬éƒ½å¯ä»¥è¿›è¡Œé‡è½½ï¼Œä½†è¦æ³¨æ„ä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li>é‡è½½è¿ç®—ç¬¦ä¸­çš„è‡³å°‘ä¸€ä¸ªæ“ä½œæ•°å¿…é¡»æ˜¯ç”¨æˆ·å®šä¹‰çš„ç±»å‹ï¼Œæ¯”å¦‚é‡è½½<code>operator+</code> å‡½æ•°ï¼Œä¸€ä¸ªå‚æ•°æ˜¯<code>int</code>ï¼Œä¸€ä¸ªæ˜¯<code>double</code> æ˜¯ä¸è¡Œçš„ï¼›</li><li>æ— æ³•æ›´æ”¹è¿ç®—ç¬¦æ”¯æŒçš„æ“ä½œæ•°æ•°é‡ï¼Œä¼˜å…ˆçº§ä¹Ÿè¢«ä¿ç•™ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myInt</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">       <span class="keyword">int</span> i;</span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">      <span class="built_in">myInt</span>(<span class="keyword">int</span> a):<span class="built_in">i</span>(a)&#123; &#125;</span><br><span class="line">       <span class="function"><span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> i;&#125; </span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é‡è½½æ“ä½œç¬¦å½¢å¼</span></span><br><span class="line">myInt <span class="keyword">operator</span>+(myInt&amp; i1,myInt&amp; i2)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">myInt</span>(i1.<span class="built_in">getValue</span>()+i2.<span class="built_in">getValue</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ™®é€šå‡½æ•°</span></span><br><span class="line"><span class="function">myInt <span class="title">add</span><span class="params">(myInt&amp; i1,myInt&amp; i2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">myInt</span>(i1.<span class="built_in">getValue</span>()+i2.<span class="built_in">getValue</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ™®é€šå‡½æ•°ä¹Ÿå¯ä»¥å®ç°é‡è½½è¿ç®—ç¬¦æ‰€éœ€çš„åŠŸèƒ½ï¼Œé‡è½½è¿ç®—ç¬¦æœ‰ä»€ä¹ˆå¥½å¤„</strong>ï¼Ÿ</p><p>é‡è½½è¿ç®—ç¬¦å¯ä»¥è®©ç¨‹åºè¡¨è¾¾æ›´ç›´è§‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myInt i1&#123;<span class="number">1</span>&#125;;</span><br><span class="line">    myInt i2&#123;<span class="number">2</span>&#125;;</span><br><span class="line"></span><br><span class="line">    myInt i3 = i1+i2;      <span class="comment">// i3.getValue()=3ï¼Œæ›´ç›´è§‚</span></span><br><span class="line">    myInt i4 = <span class="built_in">add</span>(i1,i2); <span class="comment">// i3.getValue()=3 </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><u>å¦‚æœé‡è½½è¿ç®—ç¬¦å¹¶ä¸èƒ½è®©ä½ çš„ç¨‹åºæ›´æ¸…æ™°ï¼Œè¯·è°¨æ…ä½¿ç”¨</u>ã€‚</p><h3 id="6-1-é‡è½½è¿ç®—ç¬¦çš„ä¸‰ç§æ–¹å¼">6.1 é‡è½½è¿ç®—ç¬¦çš„ä¸‰ç§æ–¹å¼</h3><p>é‡è½½è¿ç®—ç¬¦æœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼ï¼š</p><ul><li>å‹å…ƒå‡½æ•°æ–¹å¼</li><li>æ™®é€šå‡½æ•°æ–¹å¼</li><li>æˆå‘˜å‡½æ•°æ–¹å¼</li></ul><p>æŒ‰ç…§é¡ºåºæˆ‘ä»¬ä¾æ¬¡æ¥çœ‹ä¸‹ã€‚</p><h4 id="6-1-1-å‹å…ƒå‡½æ•°">6.1.1 å‹å…ƒå‡½æ•°</h4><h5 id="é‡è½½å‹å…ƒåˆè¯†">é‡è½½å‹å…ƒåˆè¯†</h5><p>ä¸‹é¢å±•ç¤ºäº†é‡è½½<code>operator+</code> ï¼Œå…¶ä½™æ“ä½œç¬¦<code>-</code> ã€<code>/</code> ã€<code>*</code> ç­‰ç±»ä¼¼ã€‚</p><p>æ³¨æ„åˆ°å‡½æ•°<code>operator+</code> æ˜¯ç±»<code>MinMax</code> çš„å‹å…ƒå‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨<code>MinMax</code>çš„ç§æœ‰æˆå‘˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cents</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">int</span> m_cents&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Cents</span>(<span class="keyword">int</span> cents): m_cents&#123; cents &#125;&#123;&#125;</span><br><span class="line">  <span class="comment">// ç±»ä¸­å£°æ˜å‹å…ƒå‡½æ•°åŸå‹</span></span><br><span class="line">  <span class="keyword">friend</span> Cents <span class="keyword">operator</span>+(<span class="keyword">const</span> Cents&amp; c1, <span class="keyword">const</span> Cents&amp; c2)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹å…ƒå‡½æ•°å®šä¹‰</span></span><br><span class="line">Cents <span class="keyword">operator</span>+(<span class="keyword">const</span> Cents&amp; c1, <span class="keyword">const</span> Cents&amp; c2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; c1.m_cents + c2.m_cents &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Cents cents1&#123; <span class="number">6</span> &#125;;</span><br><span class="line">  Cents cents2&#123; <span class="number">8</span> &#125;;</span><br><span class="line">  Cents centsSum =  cents1 + cents2 ;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;I have &quot;</span> &lt;&lt; centsSum.<span class="built_in">getCents</span>() &lt;&lt; <span class="string">&quot; cents.\n&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I have 14 cents.</span><br></pre></td></tr></table></figure><h5 id="æ›´å¤šä¾‹å­ï¼šé‡è½½I-Oè¿ç®—ç¬¦">æ›´å¤šä¾‹å­ï¼šé‡è½½I/Oè¿ç®—ç¬¦</h5><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŒæ—¶ä½¿ç”¨é‡è½½çš„ <code>operator&lt;&lt;</code> å’Œ <code>operator&gt;&gt;</code> çš„ç¤ºä¾‹ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">double</span> m_x&#123;&#125;;</span><br><span class="line">    <span class="keyword">double</span> m_y&#123;&#125;;</span><br><span class="line">    <span class="keyword">double</span> m_z&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(<span class="keyword">double</span> x=<span class="number">0.0</span>, <span class="keyword">double</span> y=<span class="number">0.0</span>, <span class="keyword">double</span> z=<span class="number">0.0</span>): m_x&#123;x&#125;, m_y&#123;y&#125;, m_z&#123;z&#125;&#123;&#125;</span><br><span class="line">    <span class="comment">// ç±»å‹å‹å…ƒå‡½æ•°å£°æ˜</span></span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt; (std::ostream&amp; out, <span class="keyword">const</span> Point&amp; point);</span><br><span class="line">    <span class="keyword">friend</span> std::istream&amp; <span class="keyword">operator</span>&gt;&gt; (std::istream&amp; in, Point&amp; point);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::ostream&amp; <span class="keyword">operator</span>&lt;&lt; (std::ostream&amp; out, <span class="keyword">const</span> Point&amp; point)</span><br><span class="line">&#123;</span><br><span class="line">    out &lt;&lt; <span class="string">&quot;Point(&quot;</span> &lt;&lt; point.m_x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; point.m_y &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; point.m_z &lt;&lt; <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    <span class="comment">// è¿”å›std::ostreamå¯¹è±¡outï¼Œè¿™æ ·å°±å¯ä»¥å½¢æˆé“¾å¼ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">// åƒè¿™æ ·ï¼šout&lt;&lt;point1&lt;&lt;&quot; &quot; &lt;&lt; point2</span></span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å’Œå‰æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œé‡è½½çš„å‚æ•°ç±»å‹ä¸åŒ</span></span><br><span class="line">std::istream&amp; <span class="keyword">operator</span>&gt;&gt; (std::istream&amp; in, Point&amp; point)</span><br><span class="line">&#123;</span><br><span class="line">    in &gt;&gt; point.m_x;</span><br><span class="line">    in &gt;&gt; point.m_y;</span><br><span class="line">    in &gt;&gt; point.m_z;</span><br><span class="line">    <span class="comment">// åŒå‰è¿”å›std::istreamå¯¹è±¡inï¼Œå½¢æˆé“¾å¼</span></span><br><span class="line">    <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Enter a point: &quot;</span>;</span><br><span class="line">    Point point1;</span><br><span class="line">    Point point2;</span><br><span class="line">    <span class="comment">// é“¾å¼è¾“å…¥</span></span><br><span class="line">    std::cin &gt;&gt; point1 &gt;&gt; point2;</span><br><span class="line">    <span class="comment">// é“¾å¼è¾“å‡º</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;You entered: &quot;</span> &lt;&lt; point1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; point2&lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]# ./test.out </span><br><span class="line">Enter a point: 1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">You entered: Point(1, 2, 3) Point(4, 5, 6)</span><br></pre></td></tr></table></figure><h4 id="6-1-2-æ™®é€šå‡½æ•°">6.1.2 æ™®é€šå‡½æ•°</h4><p>ä½¿ç”¨å‹å…ƒå‡½æ•°è™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†ä¹Ÿä¸€å®šç¨‹åº¦çš„ç ´åäº†ç±»çš„å°è£…æ€§ã€‚å› æ­¤æˆ‘ä»¬å»ºè®®å°½é‡å°†é‡è½½è¿ç®—ç¬¦å®ç°ä¸ºæ™®é€šå‡½æ•°ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå°ä¾‹å­ã€‚</p><p>æ³¨æ„åˆ°æ™®é€šå‡½æ•°å’Œå®ç°ä¸ºå‹å…ƒå‡½æ•°æä¸ºç±»ä¼¼ï¼Œé™¤äº†å‹å…ƒå‡½æ•°éœ€è¦åœ¨ç±»ä¸­å…ˆå£°æ˜å‡½æ•°åŸå‹ <code>friend Cents operator+(const Cents&amp;,const Cents&amp;)</code> ï¼Œå…¶ä½™æ²¡æœ‰åŒºåˆ«ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cents</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">int</span> m_cents&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Cents</span>(<span class="keyword">int</span> cents): m_cents&#123; cents &#125;&#123;&#125;</span><br><span class="line">  <span class="comment">// è®¿é—®ç§æœ‰æˆå‘˜çš„æ¥å£å‡½æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">getCents</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_cents; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ™®é€šå‡½æ•°ï¼Œéå‹å…ƒ</span></span><br><span class="line">Cents <span class="keyword">operator</span>+(<span class="keyword">const</span> Cents&amp; c1, <span class="keyword">const</span> Cents&amp; c2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> Cents&#123; c1.<span class="built_in">getCents</span>() + c2.<span class="built_in">getCents</span>() &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Cents cents1&#123; <span class="number">6</span> &#125;;</span><br><span class="line">  Cents cents2&#123; <span class="number">8</span> &#125;;</span><br><span class="line">  Cents centsSum =  cents1 + cents2 ; <span class="comment">// ok </span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-1-3-æˆå‘˜å‡½æ•°">6.1.3 æˆå‘˜å‡½æ•°</h4><h5 id="é‡è½½æˆå‘˜åˆè¯†">é‡è½½æˆå‘˜åˆè¯†</h5><p>æˆå‘˜é‡è½½è¿ç®—ç¬¦å’Œå‹å…ƒé‡è½½è¿ç®—ç¬¦å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯ä¹Ÿæœ‰äº›ä¸åŒï¼š</p><ul><li>é‡è½½çš„è¿ç®—ç¬¦è¢«å®šä¹‰ä¸ºæˆå‘˜è€Œä¸æ˜¯å‹å…ƒï¼ˆä¾‹å¦‚ï¼Œæ˜¯<code>Cents::operator+</code> è€Œä¸æ˜¯<code>operator+</code> ï¼‰ï¼›</li><li>å·¦è¾¹çš„ç±»ç±»å‹å‚æ•°<code>const Cents&amp;</code>è¢«ç§»é™¤äº†ï¼Œå˜æˆäº†éšå«çš„ <code>*this</code> å¯¹è±¡ã€‚</li></ul><p>çœ‹ä»£ç è¯´è¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cents</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_cents &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Cents</span>(<span class="keyword">int</span> cents): m_cents &#123; cents &#125; &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// friend Cents operator+(const Cents &amp;cents, int value);</span></span><br><span class="line">    <span class="comment">// å¯¹æ¯”æ™®é€šå‡½æ•°å£°æ˜ï¼š</span></span><br><span class="line">    <span class="comment">// 1. å°‘äº†friendå£°æ˜ï¼Œæœ¬æ¥å°±æ˜¯æˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜æ²¡å¿…è¦</span></span><br><span class="line">    <span class="comment">// 2. å·¦å‚æ•°è¢«çœç•¥ï¼Œéšå«ä¸º*thiså¯¹è±¡</span></span><br><span class="line">    Cents <span class="keyword">operator</span>+ (<span class="keyword">int</span> value);</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCents</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_cents; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹æ¯”æ™®é€šå‡½æ•°å¤šäº†Cents::ï¼ˆæˆå‘˜å‡½æ•°ï¼‰ï¼Œå¤šäº†å·¦å‚æ•°</span></span><br><span class="line">Cents Cents::<span class="keyword">operator</span>+ (<span class="keyword">int</span> value)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// m_centsè¢«è§†ä¸ºthis-&gt;m_cents</span></span><br><span class="line">    <span class="keyword">return</span> Cents &#123; m_cents + value &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Cents cents1 &#123; <span class="number">6</span> &#125;;</span><br><span class="line">Cents cents2 &#123; cents1 + <span class="number">2</span> &#125;;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;I have &quot;</span> &lt;&lt; cents2.<span class="built_in">getCents</span>() &lt;&lt; <span class="string">&quot; cents.\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I have 8 cents.</span><br></pre></td></tr></table></figure><h5 id="é‡è½½ä¸€å…ƒå‡½æ•°">é‡è½½ä¸€å…ƒå‡½æ•°</h5><p>æ­£ (+)ã€è´Ÿ (-) å’Œé€»è¾‘é (!) è¿ç®—ç¬¦éƒ½æ˜¯ä¸€å…ƒè¿ç®—ç¬¦ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åªå¯¹ä¸€ä¸ªæ“ä½œæ•°è¿›è¡Œæ“ä½œï¼Œä¹Ÿå°±æ˜¯åªå¯¹åº”ç”¨å®ƒä»¬çš„å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥é€šå¸¸ä¸€å…ƒè¿ç®—ç¬¦é‡è½½è¢«å®ç°ä¸ºæˆå‘˜å‡½æ•°ã€‚</p><p>ä¸‹é¢æ˜¯ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ³¨æ„è´Ÿè¿ç®—ç¬¦å’Œå‡å·è¿ç®—ç¬¦ä¹‹é—´æ²¡æœ‰æ··æ·†ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰ä¸åŒæ•°é‡çš„å‚æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cents</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_cents &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Cents</span>(<span class="keyword">int</span> cents): <span class="built_in">m_cents</span>(cents) &#123;&#125;</span><br><span class="line">    <span class="comment">// é‡è½½-è´Ÿè¿ç®—ç¬¦ï¼Œæˆå‘˜å‡½æ•°æ–¹å¼</span></span><br><span class="line">    Cents <span class="keyword">operator</span>-() <span class="keyword">const</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCents</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_cents; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å®šä¹‰å¤„</span></span><br><span class="line">Cents Cents::<span class="keyword">operator</span>-() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> -m_cents; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Cents nickle&#123; <span class="number">5</span> &#125;;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;A nickle of debt is worth &quot;</span> &lt;&lt; (-nickle).<span class="built_in">getCents</span>() &lt;&lt; <span class="string">&quot; cents\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-1-4-æœ€ä½³å®ç°ï¼šä½¿ç”¨ä»€ä¹ˆæ–¹å¼é‡è½½">6.1.4 æœ€ä½³å®ç°ï¼šä½¿ç”¨ä»€ä¹ˆæ–¹å¼é‡è½½</h4><p>ä¸‹é¢æ˜¯ä¸€äº›ç»éªŒæ³•åˆ™ï¼š</p><ul><li><p>æ™®é€šå‡½æ•°æˆ–å‹å…ƒå‡½æ•°ä¼˜å…ˆè€ƒè™‘æ™®é€šå‡½æ•°ï¼Œå¯é¿å…å°è£…æ€§è¢«ç ´åã€‚</p></li><li><p><strong>ä½¿ç”¨æˆå‘˜å‡½æ•°</strong>ï¼š</p><ul><li><p>åœ¨å¤„ç†ä¿®æ”¹å·¦æ“ä½œæ•°çš„äºŒå…ƒè¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ operator+=ï¼‰æ—¶ï¼Œé€šå¸¸é¦–é€‰æˆå‘˜å‡½æ•°ç‰ˆæœ¬ï¼Œå› ä¸ºæœ€å³è¾¹çš„æ“ä½œæ•°æˆä¸ºä¸€ä¸ªæ˜¾å¼å‚æ•°ï¼Œä¸ä¼šæ··æ·†è°ï¼ˆå·¦å‚æ•°ï¼‰è¢«ä¿®æ”¹ï¼›</p><p>ä½†æ˜¯å·¦å‚æ•°ç±»å‹å¿…é¡»è¦æ˜¯å½“å‰ç±»ç±»å‹ï¼Œå¦‚operator&lt;&lt;ï¼Œå®ƒå…·æœ‰ ostream ç±»å‹çš„å·¦æ“ä½œæ•°ï¼Œæ­¤æ—¶æŒ‰æ™®é€šå‡½æ•°æ–¹å¼é‡è½½æœ€å¥½ã€‚</p></li><li><p>ä¸€å…ƒè¿ç®—ç¬¦é€šå¸¸ä¹Ÿä½œä¸ºæˆå‘˜å‡½æ•°é‡è½½ï¼Œæ­¤æ—¶æˆå‘˜ç‰ˆæœ¬æ²¡æœ‰å‚æ•°ã€‚</p></li></ul></li><li><p><strong>ä½¿ç”¨æ™®é€šå‡½æ•°</strong>ï¼š</p><ul><li>åœ¨å¤„ç†ä¸ä¿®æ”¹å·¦æ“ä½œæ•°çš„äºŒå…ƒè¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ operator+ï¼‰æ—¶ï¼Œæ™®é€šæˆ–å‹å…ƒå‡½æ•°ç‰ˆæœ¬å…·æœ‰â€œå¯¹ç§°â€çš„é¢å¤–å¥½å¤„ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œæ•°éƒ½æˆä¸ºæ˜¾å¼å‚æ•°ã€‚</li></ul></li></ul><h3 id="6-2-é‡è½½-è¿ç®—ç¬¦">6.2 é‡è½½()è¿ç®—ç¬¦</h3><p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ¥è§¦çš„è¿ç®—ç¬¦ï¼Œå‚æ•°ç±»å‹è™½ç„¶å¯ä»¥è®¾ç½®ï¼Œä½†å‚æ•°ç±»å‹æ˜¯å›ºå®šçš„ã€‚</p><p><strong>è€Œé‡è½½æ‹¬å·è¿ç®—ç¬¦ <code>operator()</code>  ï¼Œå…è®¸æˆ‘ä»¬æ”¹å˜å®ƒçš„å‚æ•°ç±»å‹å’Œæ•°é‡</strong>ã€‚</p><p>è¿™æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p><code>operator()</code> ä¸€å¤§ç”¨å¤„æ˜¯ç”¨æ¥å®ç°å‡½å­ï¼ˆå‡½æ•°å¯¹è±¡ï¼‰ã€‚ç›¸æ¯”æ™®é€šå‡½æ•°ï¼Œ</p><ul><li>å‡½å­å¯ä»¥<u>å°†ä»»æ„æ•°é‡çš„æ•°æ®å­˜å‚¨åœ¨æˆå‘˜å˜é‡</u>ï¼Œè€Œä¸ç”¨åœ¨å½¢å‚ä¸­å®šä¹‰é¿å…äº†å¯èƒ½çš„å€¼ä¼ é€’å¼€é”€ï¼›</li><li>å‡½å­å¯ä»¥<u>ä¿å­˜ç»“æœå’ŒçŠ¶æ€</u>ï¼Œæé«˜ä»£ç çµæ´»æ€§ï¼›</li><li>å‡½æ•°æŒ‡é’ˆä¸èƒ½å†…è”ï¼Œå‡½å­å¯ä»¥ï¼Œæ•ˆç‡æ›´é«˜ï¼ˆæ²¡éªŒè¯è¿‡ï¼‰ã€‚</li></ul><h4 id="6-2-1-å®ç°å‡½å­">6.2.1 å®ç°å‡½å­</h4><p>è¯·çœ‹ä¸‹ä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Accumulator</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_counter&#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">int</span> i)</span></span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCounter</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_counter;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 1.å‡½å­æ•°æ®æˆå‘˜m_counterä¿å­˜åœ¨ç±»ä¸­ï¼Œè€Œä¸æ˜¯å½¢å‚ä¸­å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Accumulator::operator</span><span class="params">()</span> <span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (m_counter += i); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Accumulator acc&#123;&#125;;</span><br><span class="line">    <span class="comment">// å‡½å­å°±åƒå‡½æ•°ä¸€æ ·ä½¿ç”¨</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">acc</span>(<span class="number">10</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">//  10</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">acc</span>(<span class="number">20</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">//  30</span></span><br><span class="line">    <span class="comment">// 2.å‡½å­ä¿å­˜äº†ç»“æœçŠ¶æ€</span></span><br><span class="line">    acc.<span class="built_in">getCounter</span>(); <span class="comment">// 30</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‡½å­æ›´å¤šçš„æ˜¯åº”ç”¨åœ¨å…³è”å®¹å™¨å’ŒSTLï¼Œå…¶ä¸­è®¸å¤šç®—æ³•éƒ½æ˜¯å¯ä»¥ç”¨å‡½æ•°æˆ–å‡½æ•°å¯¹è±¡è‡ªå®šä¹‰æ¯”è¾ƒå™¨çš„</strong>ã€‚</p><p>è¯·çœ‹ä¸‹ä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyGreater</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (a &gt; b);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">myLesser</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a &lt; b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">const</span> std::array&lt;<span class="keyword">int</span>,<span class="number">6</span>&gt;&amp; arr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : arr)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;<span class="keyword">int</span>,6&gt; arr = &#123; <span class="number">13</span>, <span class="number">90</span>, <span class="number">99</span>, <span class="number">5</span>, <span class="number">40</span>, <span class="number">80</span> &#125;;</span><br><span class="line">    <span class="comment">// std::sortç¬¬ä¸‰ä¸ªæŒ‡é’ˆæ¥å—ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// æ™®é€šå‡½æ•°ï¼Œæ­¤æ—¶myLesseræ˜¯å‡½æ•°åœ°å€</span></span><br><span class="line">    std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), myLesser);</span><br><span class="line">    <span class="built_in">print</span>(arr);</span><br><span class="line">    <span class="comment">// å‡½å­ï¼Œæ­¤æ—¶MyGreater()ä¹Ÿæ˜¯å‡½æ•°åœ°å€ï¼Œä¸è¦()è¿·æƒ‘</span></span><br><span class="line">    std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), <span class="built_in">MyGreater</span>());</span><br><span class="line">    <span class="built_in">print</span>(arr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp <span class="built_in">test</span>]<span class="comment"># g++ -std=c++11 test.cpp -o test.out</span></span><br><span class="line">[root@roy-cpp <span class="built_in">test</span>]<span class="comment"># ./test.out </span></span><br><span class="line">5 13 40 80 90 99 </span><br><span class="line">99 90 80 40 13 5 </span><br></pre></td></tr></table></figure><h3 id="6-3-é‡è½½-è¿ç®—ç¬¦">6.3 é‡è½½=è¿ç®—ç¬¦</h3><h4 id="6-3-1-åŒºåˆ†å¤åˆ¶æ„é€ å‡½æ•°">6.3.1 åŒºåˆ†å¤åˆ¶æ„é€ å‡½æ•°</h4><p>å¤åˆ¶æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦çš„ç”¨é€”å‡ ä¹ç›¸åŒâ€”â€”<u>éƒ½æ˜¯å°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡</u>ã€‚</p><p>ä½†å®ƒä»¬æœ€æ ¸å¿ƒçš„åŒºåˆ«åœ¨äºä½œç”¨çš„æ—¶æœºä¸åŒï¼š</p><ul><li>å¤åˆ¶æ„é€ å‡½æ•°ï¼šåªè¦å¯¹è±¡åœ¨<u>å£°æ˜æ—¶</u>ç”¨äº†å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ç¼–è¯‘å™¨åˆ›å»ºçš„åŒ¿åå¯¹è±¡ï¼‰è¿›è¡Œåˆå§‹åŒ–ï¼Œå°±ä¼šè§¦å‘å¤åˆ¶æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œå¤åˆ¶<u>åˆå§‹åŒ–</u>ã€‚</li><li>èµ‹å€¼è¿ç®—ç¬¦ï¼šä¸æ˜¯åœ¨å¯¹è±¡å£°æ˜æ—¶ï¼Œè€Œæ˜¯ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡è¢«å¦ä¸€ä¸ªå¯¹è±¡é‡æ–°<u>èµ‹å€¼æ—¶</u> ï¼Œå°±ä¼šè§¦å‘èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°ã€‚</li></ul><p>æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥ç†è§£ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">     <span class="keyword">int</span> m_year&#123;&#125;;</span><br><span class="line">     <span class="keyword">int</span> m_month&#123;&#125;;</span><br><span class="line">     <span class="keyword">int</span> m_day&#123;&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="built_in">Date</span>() = <span class="keyword">default</span>;</span><br><span class="line">     <span class="built_in">Date</span>(<span class="keyword">int</span> day,<span class="keyword">int</span> month=<span class="number">1</span>,<span class="keyword">int</span> year=<span class="number">2022</span>) </span><br><span class="line">     &#123;</span><br><span class="line">         std::cout&lt;&lt; <span class="string">&quot;æ„é€ å‡½æ•°è¢«è°ƒç”¨&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">         m_year=year;m_month=month;m_day=day;</span><br><span class="line">     &#125;;</span><br><span class="line">     <span class="built_in">Date</span>(Date <span class="keyword">const</span>&amp; tmp): <span class="built_in">m_year</span>(tmp.m_year),<span class="built_in">m_month</span>(tmp.m_month),<span class="built_in">m_day</span>(tmp.m_day)</span><br><span class="line">     &#123;</span><br><span class="line">         std::cout&lt;&lt; <span class="string">&quot;å¤åˆ¶æ„é€ å‡½æ•°è¢«è°ƒç”¨&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">     &#125;</span><br><span class="line">     Date&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Date&amp; date)</span><br><span class="line">     &#123;</span><br><span class="line">         std::cout&lt;&lt; <span class="string">&quot;oprator=è¢«è°ƒç”¨&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">         m_year=date.m_year; m_month=date.m_year; m_day=date.m_year;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸»å‡½æ•°ä¸­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="comment">// éƒ½æ˜¯å¤åˆ¶åˆå§‹åŒ–</span></span><br><span class="line"> Date date1 = <span class="number">25</span>;       <span class="comment">// 1</span></span><br><span class="line">Date date2 = Date&#123;<span class="number">25</span>&#125;; <span class="comment">// 2</span></span><br><span class="line">Date date3 = date2;    <span class="comment">// 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>1ã€2åœ¨å¯¹è±¡date1ã€date2<u>å£°æ˜æ—¶</u>ç”¨åŒ¿åå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼ˆç¼–è¯‘å™¨è¦ä½¿å¾—<code>=</code> å·¦å³æ“ä½œç±»å‹ä¸€è‡´ï¼Œåˆ†åˆ«åœ¨<code>=</code>å³ä¾§åˆ›å»ºäº†DateåŒ¿åå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–date1ã€date2ï¼‰ã€‚</li><li>3å¤„date3ä¹Ÿæ˜¯<u>å£°æ˜</u>æ—¶ä½¿ç”¨äº†å…¶å®ƒå¯¹è±¡ï¼ˆdate2ï¼‰è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥ä¹Ÿä¼šè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ã€‚</li></ul><p>ä½†æ˜¯1ã€2å¤„ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ä½¿ç”¨æ™®é€šæ„é€ å‡½æ•°åˆå§‹åŒ–ï¼Œæ‰€ä»¥æœ€åè¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br><span class="line">æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br><span class="line">å¤åˆ¶æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è°ƒç”¨èµ‹å€¼è¿ç®—ç¬¦<code>=</code> çš„æƒ…å†µï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> Date date1 = <span class="number">25</span>;       <span class="comment">// 1</span></span><br><span class="line">Date date2 = Date&#123;<span class="number">25</span>&#125;; <span class="comment">// 2</span></span><br><span class="line">date2 = <span class="number">31</span>;            <span class="comment">// 3</span></span><br><span class="line">date2 = date1;         <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br><span class="line">æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br><span class="line">oprator=è¢«è°ƒç”¨</span><br><span class="line">oprator=è¢«è°ƒç”¨</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯3ã€4å¤„éƒ½æ˜¯è°ƒç”¨äº†èµ‹å€¼è¿ç®—ç¬¦<code>=</code> è¿›è¡Œèµ‹å€¼ï¼ˆä¸æ˜¯åˆå§‹åŒ–ï¼‰ï¼š</p><ul><li>3å¤„ï¼Œdate2ä¸æ˜¯å£°æ˜æ—¶è¿›è¡Œ<u>åˆå§‹åŒ–</u>ï¼Œè€Œæ˜¯ä½¿ç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„åŒ¿åå¯¹è±¡è¿›è¡Œ<u>é‡æ–°èµ‹å€¼</u> ï¼›</li><li>4å¤„ï¼ŒåŒç†ï¼Œdate2ä¸æ˜¯å£°æ˜æ—¶è¿›è¡Œ<u>åˆå§‹åŒ–</u> ï¼Œä½¿ç”¨date1è¿›è¡Œ<u>é‡æ–°èµ‹å€¼</u> ã€‚</li></ul><p>å®ƒä»¬éƒ½ç¬¦åˆå‰æ–‡æ‰€è¿°ï¼šâ€œè€Œæ˜¯ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡è¢«å¦ä¸€ä¸ªå¯¹è±¡é‡æ–°<u>èµ‹å€¼æ—¶</u> ï¼Œå°±ä¼šè§¦å‘èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°â€ ã€‚</p><h2 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h2><div class="timeline"><div class="timenode"><div class="meta"><p><p>2022-01-29 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ç¬¬ä¸€æ¬¡æ›´æ–°</li></ol></div></div></div><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++STLä¸­çš„å‡½æ•°å¯¹è±¡ ï¼šhttps://blog.csdn.net/CV_Jason/article/details/83899253<a href="#fnref:1" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++åŸºç¡€ </tag>
            
            <tag> è¿ç®—ç¬¦é‡è½½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸Šï¼‰å¿«é€Ÿå…¥é—¨</title>
      <link href="/p/17506/"/>
      <url>/p/17506/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><h2 id="äº”ã€é¢å¯¹å¯¹è±¡å…¥é—¨">äº”ã€é¢å¯¹å¯¹è±¡å…¥é—¨</h2><p>C++å’ŒCä¸€å¤§ä¸»è¦åŒºåˆ«å¢åŠ äº†é¢å¯¹å¯¹è±¡çš„ç‰¹æ€§ï¼Œæ”¯æŒå¤šæ€ã€ç»§æ‰¿ã€‚</p><p>ä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥é¢å¯¹å¯¹è±¡ï¼Ÿæˆ–è€…è¯´å®ƒæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</p><h3 id="5-1-ä¸ºä»€ä¹ˆéœ€è¦é¢å¯¹å¯¹è±¡ï¼Ÿ">5.1 ä¸ºä»€ä¹ˆéœ€è¦é¢å¯¹å¯¹è±¡ï¼Ÿ</h3><h4 id="5-1-1-ä»é¢å‘è¿‡ç¨‹è¯´èµ·">5.1.1 ä»é¢å‘è¿‡ç¨‹è¯´èµ·</h4><p>åœ¨ä¼ ç»Ÿç¼–ç¨‹ä¸­ï¼Œ<u>æ•°æ®å’Œå¤„ç†è¯¥æ•°æ®çš„å‡½æ•°æ˜¯å•ç‹¬çš„å®ä½“</u>ï¼Œå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ä»¥äº§ç”Ÿæ‰€éœ€çš„ç»“æœã€‚</p><p>ä½†æ˜¯ç”±äºè¿™ç§åˆ†ç¦»ï¼Œä¼ ç»Ÿç¼–ç¨‹é€šå¸¸ä¸èƒ½æä¾›éå¸¸ç›´è§‚çš„ç°å®è¡¨ç¤ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">goToHome</span>(you);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¡Œä¸ºä¸»ä½“<code>you</code> å’Œè¡Œä¸º<code>goToHome</code> è¢«åˆ†éš”äº†ï¼š<code>you</code>  è¢«å½“åšå•ç‹¬çš„æ•°æ®å®ä½“ï¼Œè¡Œä¸º<code>goToHome</code> è¢«å½“åšå½“åšçš„å•ç‹¬çš„å‡½æ•°å®ä½“ã€‚</p><p>é¢å¯¹å¯¹è±¡åˆ™æä¾›äº†æ›´ç›´è§‚çš„è¡¨ç¤ºèƒ½åŠ›ã€‚å› ä¸ºé¢å¯¹å¯¹è±¡<u>å°†å¯¹è±¡ï¼ˆè¡Œä¸ºä¸»ä½“ï¼‰ã€å±æ€§å’Œè¡Œä¸ºç»“åˆåˆ°ç‹¬ç«‹ã€å¯é‡ç½®çš„åŒ…ä¸­ï¼Œè€Œè¿™äº›å±æ€§å’Œè¡Œä¸ºå¾€å¾€ä¹Ÿè¢«è®¤ä¸ºæ˜¯å¯†ä¸å¯åˆ†çš„</u>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you.goToHome();</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™è®©å¯¹è±¡ï¼ˆ<code>you</code>ï¼‰æ˜¯è°ï¼Œä»¥åŠæ­£åœ¨è°ƒç”¨ä»€ä¹ˆè¡Œä¸ºï¼ˆ<code>goToHome</code>ï¼‰æ›´æ¸…æ¥šäº†ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸æ˜¯ä¸“æ³¨äºç¼–å†™å‡½æ•°ï¼Œè€Œæ˜¯<u>ä¸“æ³¨äºå®šä¹‰å…·æœ‰æ˜ç¡®å®šä¹‰çš„è¡Œä¸ºé›†çš„å¯¹è±¡</u>ã€‚</p><p>è¿™ï¼Œå°±æ˜¯é¢å¯¹å¯¹è±¡ã€‚</p><p>å¾—ç›Šäºè¿™ç§ä¸“æ³¨äºå¯¹è±¡çš„è¡Œä¸ºï¼Œé¢å¯¹å¯¹è±¡å¸¦æ¥ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>ä»£ç æ¨¡å—åŒ–</li><li>æ›´å®¹æ˜“ç†è§£ã€ç›´è§‚</li><li>å¯é‡ç”¨æ€§é«˜</li></ul><p>ç°åœ¨æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­è¿›è¡Œå¯¹æ¯”ï¼šæ‰“å°å¹´/æœˆ/æ—¥åˆ°å±å¹•ä¸Šã€‚</p><ul><li><p>é¢å¯¹è¿‡ç¨‹</p><p>æŒ‰ç…§é¢å¯¹è¿‡ç¨‹çš„æ€æƒ³ï¼Œ<code>Date</code>å½“åšç‹¬ç«‹å˜é‡ç»„ç»‡äº†â€œå¹´/æœˆ/æ—¥â€ï¼Œâ€œæ‰“å°â€åˆ™å½“åšç‹¬ç«‹è¡Œä¸ºï¼ˆå‡½æ•°ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> year &#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> month &#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> day &#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">const</span> DateStruct&amp; date)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; date.year &lt;&lt; <span class="string">&#x27;/&#x27;</span> &lt;&lt; date.month &lt;&lt; <span class="string">&#x27;/&#x27;</span> &lt;&lt; date.day;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date today &#123; <span class="number">2022</span>, <span class="number">1</span>, <span class="number">24</span> &#125;;</span><br><span class="line">    today.day = <span class="number">25</span>; </span><br><span class="line">    <span class="built_in">print</span>(today);  <span class="comment">// 2022/1/25</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é¢å‘å¯¹è±¡</p><p>é¢å‘å¯¹è±¡åˆ™å°†<code>Date</code>è§†ä½œè¡Œä¸ºä¸»ä½“ï¼ˆå¯¹è±¡ï¼‰ï¼Œâ€œå¹´/æœˆ/æ—¥â€è¢«å½“åšå…¶æˆå‘˜å˜é‡ï¼Œâ€œæ‰“å°â€åˆ™æ˜¯å…¶æˆå‘˜å‡½æ•°ã€‚æ­¤æ—¶æ˜ç¡®äº†è¡Œä¸ºä¸»ä½“å¯¹è±¡<code>Date</code>ï¼Œå»ºç«‹äº†â€œå¹´/æœˆ/æ—¥â€å’Œè¡Œä¸ºâ€œæ‰“å°â€çš„å…³è”ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span>  // <span class="keyword">class</span>å…³é”®å­—</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _year &#123;&#125;;  <span class="comment">// æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">int</span> _month &#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> _day &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span>  <span class="comment">// æˆå‘˜å‡½æ•°</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; m_year &lt;&lt; <span class="string">&#x27;/&#x27;</span> &lt;&lt; m_month &lt;&lt; <span class="string">&#x27;/&#x27;</span> &lt;&lt; m_day;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date today &#123; <span class="number">2022</span>, <span class="number">1</span>, <span class="number">24</span> &#125;;</span><br><span class="line">    today._day = <span class="number">25</span>; </span><br><span class="line">    <span class="comment">// ä¸»ä½“å¯¹è±¡.è¡Œä¸º() </span></span><br><span class="line">    today.<span class="built_in">print</span>();  <span class="comment">// 2022/1/25</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>ç°åœ¨æ¥æ›´ç³»ç»Ÿåœ°äº†è§£ä¸‹é¢å¯¹å¯¹è±¡åŸºæœ¬ç»„æˆå§ã€‚</p><h4 id="5-1-2-é¢å¯¹å¯¹è±¡ç»„æˆ">5.1.2 é¢å¯¹å¯¹è±¡ç»„æˆ</h4><h5 id="æˆå‘˜ç»„æˆ">æˆå‘˜ç»„æˆ</h5><p>ä¸Šé¢å±•ç¤ºäº†é¢å¯¹å¯¹è±¡åŸºæœ¬çš„<u>æˆå‘˜å˜é‡</u>å’Œ<u>æˆå‘˜å‡½æ•°</u>ã€‚</p><p>é¢å¯¹å¯¹è±¡è¿˜å¯ä»¥æœ‰<u>æˆå‘˜ç±»å‹</u> ã€<u>åµŒå¥—ç±»å‹</u>ã€‚</p><ul><li><p>æˆå‘˜ç±»å‹</p><p>æˆå‘˜ç±»å‹è§„å®šè¿™ä¸ªç±»åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€æ›´æ–°ç±»å‹åˆ«åï¼Œè€Œä¸å¿…æ›¿æ¢åŸºæœ¬ç±»å‹ã€‚</p><p>è¿™æ ·è¯´æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<code>vector</code>ç±»è§„å®šçš„ç±»å‹<code>size_type</code> ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220125171853448.png" alt="image-20220125171853448"></p><p><code>size_t</code> å½’æ ¹ç©¶åº•å°±æ˜¯ç±»å‹<code>long unsigned int</code> åˆ«å</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220125172016902.png" alt="image-20220125172016902"></p><p>ä¹Ÿå°±æ˜¯è¯´ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="keyword">int</span>&gt;::size_type x;  <span class="comment">// ç­‰ä»·ï¼šunsigned long int x </span></span><br><span class="line">std::cout&lt;&lt;<span class="built_in"><span class="keyword">typeid</span></span>(x).<span class="built_in">name</span>()&lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// m,è¡¨ç¤ºunsigned long (int)</span></span><br></pre></td></tr></table></figure><p><code>stl_vector.h</code> å˜é‡åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§ç±»å‹åˆ«åå£°æ˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç†Ÿæ‚‰çš„<code>size()</code> æ–¹æ³•å£°æ˜ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220125172456097.png" alt="image-20220125172456097"></p><p><strong>å›åˆ°å‰é¢ï¼šè¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„</strong>ï¼Ÿ</p><p>å½“æˆ‘ä»¬æƒ³ä¿®æ”¹vectorä½¿ç”¨çš„åŸºæœ¬ç±»å‹ï¼Œåªéœ€è¦å°†ä¿®æ”¹ç±»å‹åˆ«åå°±è¡Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #define __SIZE_TYPE__ long unsigned int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __SIZE_TYPE__ int  <span class="comment">// ç°åœ¨vectoråŸºæœ¬ç±»å‹è¢«ä½ å£°æ˜ä¸ºint</span></span></span><br></pre></td></tr></table></figure></li><li><p>åµŒå¥—ç±»å‹</p><p>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ç±»ç±»å‹åµŒå¥—äº†ï¼šç±»ç±»å‹ã€ç»“æ„ä½“ç±»å‹ã€æšä¸¾ç±»å‹ï¼Œæ­¤æ—¶å°±ç§°ä¸ºåµŒå¥—ç±»å‹ã€‚</p><p>ä»¥æšä¸¾ç±»å‹åµŒå¥—ä¸ºä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">FruitType</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">apple,</span><br><span class="line">banana,</span><br><span class="line">cherry</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">FruitType m_type &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Fruit</span>(FruitType type) :m_type &#123; type &#125;</span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="function">FruitType <span class="title">getType</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_type;  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„æšä¸¾ç±»å‹ä¸é™åˆ¶ä½œç”¨èŒƒå›´</span></span><br><span class="line">Fruit apple &#123; Fruit::apple &#125;; <span class="comment">// è°ƒç”¨æ„é€ å‡½æ•°Fruit(FruitType type)</span></span><br><span class="line">    apple.<span class="built_in">getType</span>() ; <span class="comment">// FruitType::apple</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="è®¿é—®æ§åˆ¶ç¬¦">è®¿é—®æ§åˆ¶ç¬¦</h5><p>ç±»ä¸­æˆå‘˜å¯ä»¥ç”¨ä¸åŒçš„è®¿é—®æ§åˆ¶ç¬¦ä¿®é¥°ï¼ŒC++è®¿é—®ç¬¦åŒ…æ‹¬ï¼š</p><ul><li>public</li><li>private</li><li>protect</li></ul><p>ä¸¾ä¸€ä¸ªå°ä¾‹å­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateClass</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>: <span class="comment">// ç§æœ‰æˆå‘˜ï¼Œå¯çœç•¥</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">int</span> size_type;  <span class="comment">// ç±»æ•°æ®ç±»å‹</span></span><br><span class="line">size_type m_month &#123;&#125;; </span><br><span class="line">size_type m_day &#123;&#125;; </span><br><span class="line">size_type m_year &#123;&#125;; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:  <span class="comment">// å…¬å¼€æˆå‘˜ï¼Œä¸å¯çœç•¥</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setDate</span><span class="params">(size_type month, size_type day, size_type year)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">m_month = month;</span><br><span class="line">m_day = day;</span><br><span class="line">m_year = year;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; m_month &lt;&lt; <span class="string">&#x27;/&#x27;</span> &lt;&lt; m_day &lt;&lt; <span class="string">&#x27;/&#x27;</span> &lt;&lt; m_year;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DateClass date;</span><br><span class="line">    <span class="comment">// date.m_month = 1;  // é”™è¯¯ï¼Œè®¿é—®ç§æœ‰å˜é‡ </span></span><br><span class="line">date.<span class="built_in">setDate</span>(<span class="number">1</span>, <span class="number">25</span>, <span class="number">2022</span>); </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ€ä½³å®è·µå»ºè®®ï¼šç±»æˆå‘˜å˜é‡æ˜¯ç§æœ‰çš„ï¼Œç±»æˆå‘˜å‡½æ•°æ˜¯å…¬å¼€çš„</strong>ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆå»ºè®®ï¼ŸèƒŒåæœ‰ä»€ä¹ˆç¼–ç¨‹æ€æƒ³æŒ‡å¯¼å—ï¼Ÿ</p><p>å¯¹äºæ™®é€šäººè€Œè¨€ï¼Œé¥æ§å™¨å°±æ˜¯ä¸€ä¸ªç®€å•çš„ç•Œé¢åŒ…æ‹¬è‹¥å¹²çš„æŒ‰é’®ï¼Œç”¨æˆ·åªå…³å¿ƒæŒ‰é’®æŒ‰ä¸‹çš„æ•ˆæœï¼Œä½†ä¸å…³å¿ƒå…·ä½“æ˜¯å¦‚ä½•å’Œç”µè§†é€šä¿¡ã€‚ç±»ä¼¼çš„ï¼Œè¸©ä¸‹æ²¹é—¨è¸æ¿ä¹Ÿä¸éœ€è¦å…³å¿ƒå†…ç‡ƒæœºå¦‚ä½•ä½¿å¾—è½¦è½®è½¬åŠ¨ã€‚</p><p>è¿™å…¶å®å°±æ˜¯æ¥å£åˆ†ç¦»çš„æ€æƒ³ï¼šé™ä½å¯¹è±¡å¤æ‚æ€§ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨ä¸äº†è§£å¯¹è±¡å¦‚ä½•å·¥ä½œçš„å‰æä¸‹ï¼Œå¯ä»¥å»ä½¿ç”¨å¯¹è±¡ã€‚</p><h5 id="ä¸‰å¤§ç‰¹æ€§ä¹‹å°è£…">ä¸‰å¤§ç‰¹æ€§ä¹‹å°è£…</h5><p><strong>ç»“æ„åˆ†ç¦»æ€æƒ³ä¹Ÿå°±æ˜¯é¢å¯¹å¯¹è±¡ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ï¼Œçš„é‡è¦ç»„æˆéƒ¨åˆ†</strong>ã€‚</p><p>æ€ä¹ˆå®ç°å°è£…ï¼Ÿ</p><p>åœ¨ C++ ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—®è¯´æ˜ç¬¦å®ç°å°è£…ã€‚ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½æ˜¯ç§æœ‰çš„ï¼ˆéšè—å®ç°ç»†èŠ‚ï¼‰ï¼Œå¤§å¤šæ•°æˆå‘˜å‡½æ•°éƒ½æ˜¯å…¬å¼€çš„ï¼ˆå‘ç”¨æˆ·å…¬å¼€æ¥å£ï¼‰ã€‚</p><p>å°è£…å…·ä½“æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</p><ul><li>é™ä½å¯¹è±¡å¤æ‚æ€§ï¼ŒåŒå‰ã€‚</li><li>ä¿æŠ¤æ•°æ®ï¼Œç±»ä¸­å®šä¹‰çš„æˆå‘˜å˜é‡éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œæ„å‘³ç€å®ƒå¯ä»¥è¢«ç±»ä»»ä½•å¯¹è±¡ä¿®æ”¹ï¼Œè¿™å¾ˆå±é™©ã€‚ä½¿ç”¨privateä¿®é¥°é¿å…äº†è¿™ä¸€ç‚¹ï¼Œè®¿é—®æ•°æ®åªèƒ½å…¬å…±æ¥å£å‡½æ•°ã€‚</li><li>æ›´å®¹æ˜“è°ƒè¯•ï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½åªèƒ½é€šè¿‡åŒä¸€ä¸ªå…¬å…±å‡½æ•°ä¿®æ”¹æŸä¸ªå€¼ï¼Œè¿™æ ·å€¼å‡ºç°ä¸æ­£ç¡®çš„å¾ˆå®¹æ˜“è¿›è¡Œdebugã€‚</li><li>æ›´å®¹æ˜“ä¿®æ”¹ï¼Œâ€¦</li></ul><p>å¦å¤–ä¸¤å¤§ç‰¹æ€§å°†ä¼šåœ¨åé¢ç« èŠ‚ä»‹ç»ï¼š</p><ul><li>ç»§æ‰¿ï¼šè®©æŸç§ç±»å‹å¯¹è±¡è·å¾—å¦ä¸€ä¸ªç±»å‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li>å¤šæ€ï¼šå°†çˆ¶å¯¹è±¡è®¾ç½®æˆå’Œä¸€ä¸ªæˆ–æ›´å¤šå­å¯¹è±¡ç›¸ç­‰çš„æŠ€æœ¯ã€‚</li></ul><h5 id="ç±»å’Œç»“æ„ä½“è¿™ä¹ˆåƒï¼Ÿ">ç±»å’Œç»“æ„ä½“è¿™ä¹ˆåƒï¼Ÿ</h5><p>çœ‹åˆ°è¿™ä½ ä¸ç¦æƒ³åæ§½ï¼Œä½ è¯´ç±»è¿™äº›åŠŸèƒ½ï¼š</p><ul><li>åµŒå¥—ã€å˜é‡ã€å‡½æ•°</li></ul><p>ç»“æ„ä½“éƒ½æœ‰å•Šï¼Ÿç”šè‡³ä½ è¿˜çŸ¥é“æ›´å¤šï¼š</p><ul><li>ç»“æ„ä½“æ”¯æŒç»§æ‰¿ã€å¤šæ€â€¦</li></ul><p>æ˜¯çš„ï¼Œåœ¨C++ä¸­ç±»å’Œç»“æ„ä½“é™¤äº†<u>é»˜è®¤è®¿é—®ç¬¦</u>å¤–å¤ªåƒäº†ï¼Œä»¥è‡³äºå¾ˆå¤šå¼€å‘äººå‘˜è®¤ä¸ºè¿™æ˜¯ä¸ªé”™è¯¯çš„è®¾è®¡ã€‚</p><ul><li>æ¯”å¦‚ï¼Œå‡è®¾åˆ†é…ç±»çš„å†…å­˜ä¼šåœ¨ç±»è¢«é”€æ¯å‰é‡Šæ”¾æ˜¯æ­£å¸¸çš„ï¼Œä½†å¯¹ç»“æ„ä½“è¿™ç§å‡è®¾æ˜¯ä¸å®‰å…¨çš„ï¼ˆè™½ç„¶ç»“æ„ä½“ä¹Ÿæœ‰ææ„å‡½æ•°ï¼‰ã€‚</li><li>å¦å¤–ï¼Œæ¨¡æ¿ç¼–ç¨‹æ˜¯ä¸é€‚ç”¨äºstructçš„ã€‚</li></ul><p><strong>æœ€ä½³å®è·µï¼šå°† struct ç”¨äºçº¯æ•°æ®ç»“æ„ï¼Œå¯¹åŒæ—¶å…·æœ‰æ•°æ®å’Œå‡½æ•°çš„å¯¹è±¡ä½¿ç”¨ class</strong>ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå»ºè®®structå£°æ˜ä¸ºPOD(Plain Old Date)ç±»å‹è¿›è¡Œä½¿ç”¨ã€‚</p><p><a href="https://zhuanlan.zhihu.com/p/45545035">ä»€ä¹ˆæ˜¯PODç±»å‹ï¼Ÿ</a></p><p>å¦‚æœstruct/class/enumç­‰ï¼Œåªå®šä¹‰äº†å¸¸è§„æ•°æ®ç±»å‹(ä¸èƒ½å«æœ‰è‡ªå®šä¹‰æ•°æ®ç±»å‹)ï¼Œä¸ä½¿ç”¨å°åŒ…æˆ–è€…other object-orientedç‰¹å¾ã€‚é‚£ä¹ˆå°±æ˜¯PODç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">myDate</span>   // <span class="title">POD</span>ç±»å‹</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">float</span> f;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-2-æ„é€ å‡½æ•°">5.2 æ„é€ å‡½æ•°</h3><p>å½“ä¸€ä¸ªç±»ï¼ˆæˆ–ç»“æ„ï¼‰çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯å…¬å…±çš„æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥<u>åˆ—è¡¨åˆå§‹åŒ–</u>ç±»ï¼ˆæˆ–ç»“æ„ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> m_x ;</span><br><span class="line">    <span class="keyword">int</span> m_y ;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Foo foo1 &#123; <span class="number">1</span>, <span class="number">2</span> &#125;; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‰é¢è¯´è¿‡ï¼Œæˆå‘˜å˜é‡ä¸€èˆ¬å£°æ˜ä¸ºprivateï¼Œæ­¤æ—¶æ— æ³•ç›´æ¥åˆå§‹åŒ–ç±»ã€‚</p><p>æ­¤æ—¶å¦‚ä½•åˆå§‹åŒ–æˆå‘˜å˜é‡ï¼Ÿ</p><ul><li><p>å¦‚æœç§æœ‰æˆå‘˜å˜é‡ä»…ä»…æ˜¯éœ€è¦é›¶å€¼åˆå§‹åŒ–ï¼Œåœ¨ç±»æˆå‘˜å˜é‡ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–<code>&#123;&#125;</code>å³å¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> m_x&#123;&#125; ;  <span class="comment">// å£°æ˜æ—¶åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">int</span> m_y&#123;&#125; ;  <span class="comment">// å£°æ˜æ—¶åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœç§æœ‰æˆå‘˜å˜é‡éœ€è¦æŒ‡å®šå€¼ï¼Œ<strong>ä½¿ç”¨æ„é€ å‡½æ•°å¯ä»¥æŒ‡å®šåˆå§‹åŒ–ç±»çš„æˆå‘˜å˜é‡</strong>ã€‚</p></li></ul><p>æ„é€ å‡½æ•°æœ‰ç‰¹å®šå‘½åè§„åˆ™ï¼š</p><ul><li>å’Œç±»åŒå</li><li>æ²¡æœ‰è¿”å›ç±»å‹</li></ul><p>ä»é»˜è®¤æ„é€ å‡½æ•°å¼€å§‹æ¥è§¦å§ã€‚</p><h4 id="5-2-1-é»˜è®¤æ„é€ å‡½æ•°">5.2.1 é»˜è®¤æ„é€ å‡½æ•°</h4><p>ä¸å¸¦å‚æ•°ï¼ˆæˆ–æ‰€æœ‰å‚æ•°éƒ½å…·æœ‰é»˜è®¤å€¼ï¼‰çš„æ„é€ å‡½æ•°ç§°ä¸º<strong>é»˜è®¤æ„é€ å‡½æ•°</strong>ã€‚</p><blockquote><p>ã€æ³¨ã€‘å…¶å®ƒæ„é€ å‡½æ•°éƒ½æœªå£°æ˜æ—¶ï¼Œç¼–è¯‘å™¨ä¼šéšå¼å£°æ˜ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fraction</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_numerator &#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> m_denominator &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Fraction</span>() <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    &#123;</span><br><span class="line">        m_numerator = <span class="number">0</span>;</span><br><span class="line">        m_denominator = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fraction frac&#123;&#125;; <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>Fraction frac&#123;&#125;</code> æ­¤æ—¶ä¼šè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>æœ‰æ—¶å€™ä½ ä¹Ÿä¼šçœ‹åˆ°ä¸‹é¢åˆå§‹åŒ–æ–¹å¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fraction frac;</span><br></pre></td></tr></table></figure><p>è¿™äºŒè€…æœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿ</p><h5 id="åˆ—è¡¨åˆå§‹åŒ–å’Œç›´æ¥åˆå§‹åŒ–">åˆ—è¡¨åˆå§‹åŒ–å’Œç›´æ¥åˆå§‹åŒ–</h5><p><code>Fraction frac&#123;&#125;</code> é€šå¸¸ç§°ä¸ºåˆ—è¡¨åˆå§‹åŒ–ï¼Œè€Œ <code>Fraction frac</code> ç§°ä¸ºç›´æ¥åˆå§‹åŒ–ã€‚å®ƒä»¬éƒ½ä¼šåœ¨æ‰§è¡Œæ—¶è°ƒç”¨é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯<code>&#123;&#125;</code> æ–¹å¼è¿˜<u>å¯èƒ½</u>ä¼šä½¿å¾—ç¼–è¯‘å™¨è°ƒç”¨æ„é€ å‡½æ•°ä¹‹å‰ï¼Œ<u>å¯¹æˆå‘˜å˜é‡è¿›è¡Œé›¶å€¼åˆå§‹åŒ–</u>ã€‚</p><p>éªŒè¯ä¸€ä¸‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fraction</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_numerator ;  <span class="comment">// å»é™¤&#123;&#125;</span></span><br><span class="line">    <span class="keyword">int</span> m_denominator ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Fraction</span>()  <span class="comment">// ä¸åšä»»ä½•äº‹</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// m_numerator = 0;  </span></span><br><span class="line">        <span class="comment">// m_denominator = 1;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Fraction frac1&#123;&#125;; <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">    Fraction frac2;   <span class="comment">// ç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line">    std::cout&lt;&lt;frac1.m_numerator&lt;&lt;std::endl;</span><br><span class="line">    std::cout&lt;&lt;frac2.m_numerator&lt;&lt;std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">2082139952</span><br></pre></td></tr></table></figure><p>å¯è§åˆ—è¡¨åˆå§‹åŒ–æ–¹å¼ç¡®å®å¯¹æˆå‘˜å˜é‡è¿›è¡Œäº†<u>é›¶å€¼åˆå§‹åŒ–</u>ï¼Œè€Œç›´æ¥åˆå§‹åŒ–ç±»æˆå‘˜å­˜çš„æ˜¯åƒåœ¾å€¼ï¼ˆè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨<u>1.2.4</u>èŠ‚ä¹Ÿæ€»ç»“å¯¹æ¯”è¿‡ï¼Œå› ä¸ºæ­¤æ—¶å˜é‡å€¼éƒ½æ˜¯<u>é»˜è®¤åˆå§‹åŒ–</u>çš„ï¼‰ã€‚</p><p>ä¸ä»…å¦‚æ­¤ï¼Œå¦‚æœå­˜åœ¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œ<u><code>&#123;&#125;</code> è¿˜å¯ä»¥ç›´æ¥ä¼ å…¥å®å‚å€¼</u>ï¼Œé©¬ä¸Šä½ å°±å¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼ã€‚</p><h5 id="éšå¼æ„é€ å‡½æ•°">éšå¼æ„é€ å‡½æ•°</h5><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œå¦‚æœä½ çš„ç±»<u>æ²¡æœ‰ä»»ä½•æ„é€ å‡½æ•°</u>ï¼ŒC++ ä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆéšå¼çš„é»˜è®¤æ„é€ å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_year&#123; <span class="number">1900</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> m_month&#123; <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> m_day&#123; <span class="number">1</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date date&#123;&#125;; <span class="comment">// è°ƒç”¨éšå¼çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå­˜åœ¨å…¶ä»–ä»»ä½•çš„æ„é€ å‡½æ•°ï¼Œéšå¼çš„æ„é€ å‡½æ•°ä¸ä¼šç”Ÿæˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_year&#123; <span class="number">1900</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> m_month&#123; <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> m_day&#123; <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Date</span>(<span class="keyword">int</span> year,<span class="keyword">int</span> month,<span class="keyword">int</span> daya)</span><br><span class="line">    &#123;m_year=year;m_month=month;m_day=day;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date date&#123;&#125;; <span class="comment">// errorï¼Œä¸å­˜åœ¨é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åçš„ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œæ­¤æ—¶è¿˜å¯ä»¥å¦‚æ­¤ç®€åŒ–å£°æ˜ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Date</span>() = <span class="keyword">default</span>;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ä¼šæ¸…æ™°å¾ˆå¤šã€‚</p><h5 id="è½¬æ¢æ„é€ å‡½æ•°">è½¬æ¢æ„é€ å‡½æ•°</h5><p>C++ ä¼šå°†ä»»ä½•æ„é€ å‡½æ•°è§†ä¸ºéšå¼è½¬æ¢è¿ç®—ç¬¦ï¼Œåœ¨<u>4.X.1 ç”¨æˆ·è‡ªå®šä¹‰éšå¼è½¬æ¢</u> æœ‰è¿‡è¯¦ç»†ä»‹ç»ã€‚</p><p>ç®€å•å›å¿†ä¸€ä¸‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dog</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// 1.è½¬æ¢æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">dog</span>(string name) &#123;m_name = name;&#125; </span><br><span class="line">        <span class="comment">// 2.ç±»å‹è½¬æ¢é‡è½½</span></span><br><span class="line">        <span class="function"><span class="keyword">operator</span> <span class="title">string</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> m_name;&#125; </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        string m_name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">s2dog</span><span class="params">(cosnt dog&amp;)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// nothing;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      string dogname = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">      <span class="comment">// 1.è½¬æ¢æ„é€ å‡½æ•°</span></span><br><span class="line">      dog d = dogname; <span class="comment">// ok</span></span><br><span class="line">      <span class="built_in">s2dog</span>(<span class="string">&quot;dog&quot;</span>);    <span class="comment">// ok</span></span><br><span class="line">      <span class="comment">// 2.ç±»å‹è½¬æ¢é‡è½½</span></span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;my name is &quot;</span> &lt;&lt; <span class="built_in">string</span>(d) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“è¿‡ç¨‹æ¶‰åŠåˆ°å¤åˆ¶åˆå§‹åŒ–ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dog d = dogname; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><ol><li>è¡¨è¾¾å¼ä»å³åˆ°å·¦ï¼Œæ„é€ å‡½æ•°<code>dog(string)</code>ä½œä¸ºè½¬æ¢æ„é€ å‡½æ•° ï¼Œç¼–è¯‘å™¨å…ˆåˆ›å»º<code>dog</code>ä¸´æ—¶åŒ¿åå¯¹è±¡ï¼Œä½¿å¾—<code>=</code>ä¸¤è¾¹æ“ä½œç±»å‹ä¸€è‡´ï¼›</li><li>ç„¶åæ„é€ å‡½æ•°<code>dog(string)</code> ï¼Œåˆå§‹åŒ–åŒ¿åå¯¹è±¡ï¼›</li><li>ç¼–è¯‘å™¨åˆ›å»ºå¯¹è±¡<code>d</code> ï¼›</li><li>è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œç”¨åŒ¿åå¯¹è±¡æˆå‘˜å€¼å¤åˆ¶åˆå§‹åŒ–å¯¹è±¡<code>d</code> ã€‚</li></ol><p>ä¸‹é¢ä»‹ç»åˆå§‹åŒ–ç›¸å…³å·¥ä½œç»†èŠ‚&amp;åŸç†ã€‚</p><h4 id="5-2-2-å†è°ˆåˆå§‹åŒ–">5.2.2 å†è°ˆåˆå§‹åŒ–</h4><p>å›é¡¾ä¸€ä¸‹ä¸‰ç§åˆå§‹åŒ–æ–¹å¼ã€‚</p><p>ä¸‹é¢æ˜¯åˆ—è¡¨åˆå§‹åŒ–<code>&#123;&#125;</code> åˆå§‹åŒ–ï¼ˆå¯èƒ½ä¼šå¯¹éé™æ€æˆå‘˜è¿›è¡Œé›¶å€¼åˆå§‹åŒ–ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_year&#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> m_month&#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> m_day&#123;&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Date</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Date</span>(<span class="keyword">int</span> day,<span class="keyword">int</span> month=<span class="number">1</span>,,<span class="keyword">int</span> month=<span class="number">1</span><span class="keyword">int</span> year=<span class="number">2022</span>) <span class="comment">// å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå­˜åœ¨é»˜è®¤å€¼</span></span><br><span class="line">    &#123;</span><br><span class="line">        m_year=year;m_month=month;m_day=day;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date date&#123;<span class="number">25</span>&#125;; <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–ï¼Œè°ƒç”¨å¸¦å‚æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç›´æ¥åˆå§‹åŒ–æ–¹å¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Date <span class="title">date</span><span class="params">(<span class="number">25</span>)</span></span>; <span class="comment">// ç›´æ¥åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p>ç”šè‡³ä½ è¿˜å¯ä»¥ä½¿ç”¨<u>å¤åˆ¶åˆå§‹åŒ–</u>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Date date1 = <span class="number">25</span>;   <span class="comment">// è¿˜è¿›è¡Œäº†éšå¼è½¬æ¢ï¼Œç­‰ä»·äºDate date1 =Date(25)</span></span><br><span class="line">Date date2 = <span class="built_in">Date</span>(<span class="number">25</span>); <span class="comment">// 2</span></span><br><span class="line">Date date3 = Date&#123;<span class="number">25</span>&#125;; <span class="comment">// 3</span></span><br><span class="line">Date date4 = date3;    <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><p><strong><code>=</code> å·¦ä¾§æ˜¯è¢«åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œå› ä¸º<code>=</code>å·¦å³ä¸¤ä¾§æ“ä½œç±»å‹è¦ç›¸ç­‰ï¼Œæ‰€ä»¥<code>=</code> å³ä¾§ä¼šå…ˆç”Ÿæˆä¸€ä¸ªï¼ˆåŒ¿åï¼‰å¯¹è±¡ï¼Œå¯¹å·¦ä¾§å¯¹è±¡æˆå‘˜è¿›è¡Œï¼ˆå¤åˆ¶ï¼‰åˆå§‹åŒ–</strong>ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å»ºè®®é¿å…ä½¿ç”¨ç±»è¿›è¡Œå¤åˆ¶åˆå§‹åŒ–ï¼Œå› ä¸ºä¸€èˆ¬æ•ˆç‡è¾ƒä½ä¸”ä¸å®‰å…¨ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå¤åˆ¶åˆå§‹åŒ–æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</p><h5 id="å¤åˆ¶åˆå§‹åŒ–ğŸŒŸ">å¤åˆ¶åˆå§‹åŒ–ğŸŒŸ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://sqrt-1.me/?p=241">C++çš„ç›´æ¥åˆå§‹åŒ–ä¸å¤åˆ¶åˆå§‹åŒ–</a></p></blockquote><p>å…ˆè¯´è¯´ç›´æ¥åˆå§‹åŒ–æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Date <span class="title">date</span><span class="params">(<span class="number">25</span>)</span></span>; <span class="comment">// ç›´æ¥åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–è¯‘å™¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡<code>date</code> ï¼›</li><li>åˆå§‹åŒ–static<u>é™æ€æˆå‘˜</u>ï¼›</li><li>æœ€åè°ƒç”¨åŒ¹é…çš„æ„é€ å‡½æ•° <code>Date(int day,int year=2022,int month=1)</code>åˆå§‹åŒ–<code>date</code>çš„<u>éé™æ€æˆå‘˜</u>ã€‚</li></ol><p>åˆ—è¡¨åˆå§‹åŒ–ç±»ä¼¼ï¼Œåªæ˜¯åœ¨è°ƒç”¨æ„é€ å‡½æ•°å‰ï¼Œå¯èƒ½è¿˜ä¼šå¯¹éé™æ€æˆå‘˜è¿›è¡Œé›¶å€¼åˆå§‹åŒ–ã€‚</p><p><strong>æ³¨æ„ï¼Œæ„é€ å‡½æ•°æ²¡æœ‰åˆ›å»ºå¯¹è±¡ï¼Œåªè¿›è¡Œåˆå§‹åŒ–ã€‚</strong></p><p>å¯¹äºå¤åˆ¶åˆå§‹åŒ–ï¼Œæ¶‰åŠåˆ°ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬éšå¼å£°æ˜çš„å¤åˆ¶æ„é€ å‡½æ•°ã€‚</p><p>ä¸€ä¸ªç©ºç±»é»˜è®¤ä¼šæ·»åŠ ä»¥ä¸‹å‡½æ•°ï¼ŒåŒ…æ‹¬å¤åˆ¶æ„é€ å‡½æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼ºçœæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="built_in">Date</span>();</span><br><span class="line"><span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">~<span class="built_in">Date</span>();</span><br><span class="line"><span class="comment">// èµ‹å€¼è¿ç®—å‡½æ•°</span></span><br><span class="line">Date&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Date&amp;);</span><br><span class="line"><span class="comment">// å¤åˆ¶æ„é€ å‡½æ•° ï¼ˆcopy constructorï¼‰</span></span><br><span class="line"><span class="built_in">Date</span>(Date <span class="keyword">const</span>&amp; tmp);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¤åˆ¶æ„é€ å‡½æ•°å®Œæ•´å®šä¹‰ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆå‘˜åˆ—è¡¨æ–¹å¼ï¼Œä¸‹èŠ‚ä»‹ç»</span></span><br><span class="line"><span class="built_in">Date</span>(Date <span class="keyword">const</span>&amp; tmp):<span class="built_in">m_year</span>(tmp.m_year),<span class="built_in">m_month</span>(tmp.m_month),<span class="built_in">m_day</span>(tmp.m_day) </span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><p>å›åˆ°å¤åˆ¶åˆå§‹åŒ–ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Date date = <span class="built_in">Date</span>(<span class="number">25</span>); <span class="comment">// å¤åˆ¶åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><ol><li><p>ä¸ºäº†<code>=</code>ä¸¤ä¾§æ“ä½œç±»å‹ä¸€è‡´ï¼Œ<u>ç¼–è¯‘å™¨é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŒ¿åå¯¹è±¡</u>ï¼Œä¸ºæ–¹ä¾¿è®°ä¸º<code>tmp</code>ï¼›</p><blockquote><p>æ³¨ï¼š<code>Date(25)</code> æ˜¯ä¸€ç§åŒ¿åå¯¹è±¡åˆå§‹åŒ–æ–¹å¼ï¼Œå®ƒéšè—äº†å¯¹è±¡çš„åå­—ï¼Œç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Date <span class="title">tmp</span><span class="params">(<span class="number">25</span>)</span></span>; <span class="comment">// åŒ¿åå¯¹è±¡å‡è®¾ä¸ºtmp</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p>æ‰§è¡Œ<code>Date(25)</code>ï¼Œï¼ˆåŒ¿åå¯¹è±¡ä¸­çš„ï¼‰æ„é€ å‡½æ•° <code>Date(int day,int year=2022,int month=1)</code> <u>åˆå§‹åŒ–ä¸´æ—¶å¯¹è±¡</u>ï¼›</p></li><li><p>ç¼–è¯‘å™¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡<code>date</code> ï¼›</p></li><li><p>æœ€åç¼–è¯‘å™¨å†è°ƒç”¨ï¼ˆå¯¹è±¡<code>date</code>ä¸­ï¼‰<u>æ‹·è´æ„é€ å‡½æ•°</u>ï¼Œå°†ä¸´æ—¶åŒ¿åå¯¹è±¡<code>tmp</code>ä½œä¸ºæ‹·è´æ„é€ å‡½æ•°å‚æ•° ï¼Œ<code>date</code> æ¯ä¸ªæˆå‘˜å€¼å¤åˆ¶ä¸´æ—¶åŒ¿åå¯¹è±¡æˆå‘˜ã€‚</p></li></ol><p><strong>åªè¦å¯¹è±¡åœ¨<u>å£°æ˜æ—¶</u>ç”¨äº†å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ç¼–è¯‘å™¨åˆ›å»ºçš„åŒ¿åå¯¹è±¡ï¼‰è¿›è¡Œåˆå§‹åŒ–ï¼Œå°±ä¼šè§¦å‘å¤åˆ¶æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¤åˆ¶<u>åˆå§‹åŒ–</u>ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¸è¦æ‰§ç€äºè¡¨è±¡ï¼Œ=ä¸é‡è¦ï¼šå¤åˆ¶åˆå§‹åŒ–æ ¸å¿ƒåœ¨äºè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ™®é€šæ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–</strong>ã€‚</p><p>ä¸‹é¢è¿™ç§æ–¹å¼è™½ç„¶æ²¡æœ‰<code>=</code> ï¼Œçœ‹èµ·æ¥åƒç›´æ¥åˆå§‹åŒ–ã€‚ä½†<code>Date date5</code> <u>å£°æ˜</u>æ—¶ä½¿ç”¨äº†å¯¹è±¡<code>date1</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥ä¾æ—§æ˜¯å¤åˆ¶åˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Date <span class="title">date5</span><span class="params">(date1)</span></span>;   <span class="comment">// å¤åˆ¶åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™ç§â€œå¤åˆ¶â€æ•ˆç‡å¯æƒ³è€Œè¨€æ˜¯ä½ä¸‹çš„ï¼Œå› ä¸ºå®ƒè¿˜å¯èƒ½ä¼šåˆ›å»ºä¸´æ—¶åŒ¿åå¯¹è±¡ã€‚</p><blockquote><p>ä¸è¿‡æ ‡å‡†è§„å®šï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œå…è®¸ç¼–è¯‘å™¨åœ¨åˆé€‚çš„åœ°æ–¹è¿›è¡Œä¼˜åŒ–ï¼Œ<u>è·³è¿‡åˆ›å»ºä¸´æ—¶åŒ¿åå¯¹è±¡</u>è¿™ä¸€æ­¥ï¼Œç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°æ„é€ è¦åˆ›å»ºçš„å¯¹è±¡ã€‚</p><p>ä¸‹é¢4ä¸ªå¤åˆ¶åˆå§‹åŒ–å“ªäº›ä¼šæ‰§è¡Œå¤åˆ¶æ„é€ å‡½æ•°ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">     <span class="keyword">int</span> m_year&#123;&#125;;</span><br><span class="line">     <span class="keyword">int</span> m_month&#123;&#125;;</span><br><span class="line">     <span class="keyword">int</span> m_day&#123;&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     <span class="built_in">Date</span>() = <span class="keyword">default</span>;</span><br><span class="line">     <span class="built_in">Date</span>(<span class="keyword">int</span> day,<span class="keyword">int</span> month=<span class="number">1</span>,<span class="keyword">int</span> year=<span class="number">2022</span>) </span><br><span class="line">     &#123;</span><br><span class="line">         m_year=year;m_month=month;m_day=day;</span><br><span class="line">         std::cout&lt;&lt; <span class="string">&quot;æ„é€ å‡½æ•°è¢«è°ƒç”¨&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">     &#125;;</span><br><span class="line">     <span class="built_in">Date</span>(Date <span class="keyword">const</span>&amp; tmp): <span class="built_in">m_year</span>(tmp.m_year),<span class="built_in">m_month</span>(tmp.m_month),<span class="built_in">m_day</span>(tmp.m_day)</span><br><span class="line">     &#123;</span><br><span class="line">         std::cout&lt;&lt; <span class="string">&quot;å¤åˆ¶æ„é€ å‡½æ•°è¢«è°ƒç”¨&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="comment">// éƒ½æ˜¯å¤åˆ¶åˆå§‹åŒ–</span></span><br><span class="line"> Date date1 = <span class="number">25</span>;       <span class="comment">// 1 </span></span><br><span class="line">Date date2 = <span class="built_in">Date</span>(<span class="number">25</span>); <span class="comment">// 2</span></span><br><span class="line">Date date3 = Date&#123;<span class="number">25</span>&#125;; <span class="comment">// 3</span></span><br><span class="line">Date date4 = date3;    <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¯èƒ½ä¼šè®©ä½ æœ‰äº›æƒŠè®¶ï¼šé™¤äº†æ–¹å¼<code>4</code> ï¼Œå…¶ä½™éƒ½æ²¡ç”¨è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]# g++ -std=c++11 test.cpp -o test.out</span><br><span class="line">[root@roy-cpp test]# ./test.out </span><br><span class="line">æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br><span class="line">æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br><span class="line">æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br><span class="line">å¤åˆ¶æ„é€ å‡½æ•°è¢«è°ƒç”¨</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯é™¤äº†æ–¹å¼<code>4</code> ï¼Œç¼–è¯‘å™¨éƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼ˆ1ã€2ã€3ç”Ÿæˆäº†åŒ¿åå¯¹è±¡ï¼Œç¼–è¯‘å™¨å¯ä»¥è·³è¿‡ï¼‰ã€‚æ‰€ä»¥æ–¹å¼1ã€2ã€3ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Date <span class="title">date1</span><span class="params">(<span class="number">25</span>)</span></span>;</span><br><span class="line"><span class="function">Date <span class="title">date2</span><span class="params">(<span class="number">25</span>)</span></span>;</span><br><span class="line"><span class="function">Date <span class="title">date3</span><span class="params">(<span class="number">25</span>)</span></span>;</span><br></pre></td></tr></table></figure><p>æœ‰äº›ç¼–è¯‘å™¨è¿˜ä¼šå¯¹æ–¹å¼<code>4</code> è¿›è¡Œä¼˜åŒ–ï¼ˆæ²¡éªŒè¯è¿‡ï¼‰ã€‚</p></blockquote><p><strong>ä¸ä»…å¦‚æ­¤ï¼Œå¤åˆ¶åˆå§‹åŒ–æ•ˆç‡ä½çš„åŒæ—¶è¿˜å¹¶ä¸å®‰å…¨</strong>ã€‚</p><p>å› ä¸ºè¿™ç§æ‹·è´æ–¹å¼æ˜¯<u>æµ…æ‹·è´</u>ï¼Œå¦‚æœå­˜åœ¨æŒ‡é’ˆä¹Ÿåªæ˜¯å¤åˆ¶å…¶å€¼ï¼Œä¸ä¼šå¤åˆ¶å…¶æŒ‡å‘çš„åŒºåŸŸã€‚</p><h5 id="æ·±æ‹·è´å’Œæµ…æ‹·è´">æ·±æ‹·è´å’Œæµ…æ‹·è´</h5><p>æµ…æ‹·è´ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>æµ…æ‹·è´çš„æŒ‡é’ˆå’ŒåŸæ¥çš„æŒ‡é’ˆæŒ‡å‘åŒä¸€å—åœ°å€ï¼Œå¦‚æœåŸæ¥çš„æŒ‡é’ˆæ‰€æŒ‡å‘çš„èµ„æºé‡Šæ”¾äº†ï¼Œé‚£ä¹ˆå†é‡Šæ”¾æµ…æ‹·è´çš„æŒ‡é’ˆçš„èµ„æºå°±ä¼šå‡ºç°double freeã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> *p&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Test</span>()&#123;p = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(<span class="number">4</span>);&#125;</span><br><span class="line">        ~<span class="built_in">Test</span>()&#123;<span class="keyword">delete</span> p;&#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Test ob1;</span><br><span class="line">   Test ob2 = ob1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æ‰§è¡Œå‡ºé”™ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220126000908921.png" alt="image-20220126000908921"></p><p>ç»™å„ä½çœ‹å®˜åˆ†æä¸‹åŸå› ï¼š</p><ol><li><p><code>Test ob1</code>æ„é€ ç±»å¯¹è±¡ob1ï¼Œè¿™æ˜¯è°ƒç”¨äº†<u>æ„é€ å‡½æ•°</u>ï¼Œä¸ºob1.påˆ†é…äº†å†…å­˜ç©ºé—´ï¼›</p></li><li><p><code>Test ob2 = ob1</code>ï¼Œè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°æ„é€ ç±»å¯¹è±¡ob2 = ob1;</p></li><li><p>main()å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå…¨å±€å‡½æ•°çš„è¿è¡Œå‘¨æœŸç»“æŸï¼Œç³»ç»Ÿå›æ”¶å†…å­˜ï¼ˆææ„å‡½æ•°é™¤äº†æ˜¾ç¤ºdeleteæ‰§è¡Œï¼Œå¯¹è±¡ç¦»å¼€ä½œç”¨èŒƒå›´ä¼šè‡ªåŠ¨æ‰§è¡Œï¼‰ï¼š</p><ul><li>å…ˆè°ƒç”¨ob1çš„ææ„å‡½æ•°ï¼Œå°†ob1.pæŒ‡å‘çš„å†…å­˜é‡Šæ”¾ï¼›</li><li>å†è°ƒç”¨ob2çš„ææ„å‡½æ•°ï¼Œå°†ob2.pæŒ‡å‘çš„å†…å­˜é‡Šæ”¾ã€‚</li></ul></li><li><p>ä½†æ˜¯ç”±äºob2.pçš„å†…å­˜å·²ç»åœ¨ä¸Šä¸€æ­¥è¢«é‡Šæ”¾ï¼Œæ‰€ä»¥é€ æˆäº†double freeã€‚</p></li></ol><p>è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼š</p><ul><li><p><strong>ç¦æ­¢ä½¿ç”¨<u>æ‹·è´æ„é€ å‡½æ•°</u></strong>ï¼š</p><p>ä½¿ç”¨deleteå…³é”®å­—ç¦æ­¢ï¼ˆæ¨èï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++11æ–°ç‰¹æ€§delete</span></span><br><span class="line"><span class="built_in">Test</span>(Test &amp;ob) = <span class="keyword">delete</span>; </span><br></pre></td></tr></table></figure><p>æˆ–å£°æ˜ä¸ºprivateï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>:  <span class="comment">// å°è¯•è°ƒç”¨ç§æœ‰æˆå‘˜å‡½æ•°ä¼šå‡ºé”™</span></span><br><span class="line"><span class="built_in">Test</span>(Test &amp;ob)&#123;...&#125;; </span><br></pre></td></tr></table></figure><p>è®©ä½¿ç”¨è€…æ— æ³•ä½¿ç”¨<u>é»˜è®¤</u>æ„é€ å‡½æ•°ã€‚</p></li><li><p><strong>æ·±æ‹·è´</strong>ï¼š</p><p>è‡ªå·±æ˜¾ç¤ºå£°æ˜å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå¯¹æˆå‘˜å˜é‡å®ç°æ·±æ‹·è´ï¼ˆå¤åˆ¶æŒ‡é’ˆå†…å­˜åŒºåŸŸå€¼ï¼‰ã€‚</p><p>æ·±æ‹·è´ä¸ä»…æ‹·è´å€¼ï¼Œè¿˜å¼€è¾Ÿå‡ºä¸€å—æ–°çš„ç©ºé—´ç”¨æ¥å­˜æ”¾æ–°çš„å€¼ï¼Œå³ä½¿åŸå…ˆçš„å¯¹è±¡è¢«ææ„æ‰ï¼Œé‡Šæ”¾å†…å­˜äº†ä¹Ÿä¸ä¼šå½±å“åˆ°æ·±æ‹·è´å¾—åˆ°çš„å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> *p&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Test</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            p = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>]();</span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Test</span>()&#123;<span class="keyword">delete</span> p;&#125;</span><br><span class="line">        <span class="built_in">Test</span>(<span class="keyword">const</span> Test&amp; other) <span class="comment">// å®ç°æ·±æ‹·è´</span></span><br><span class="line">        &#123;    </span><br><span class="line">            <span class="keyword">if</span>(p) <span class="comment">// pä¸ç©º</span></span><br><span class="line">             <span class="keyword">delete</span> p;</span><br><span class="line">            <span class="keyword">if</span>(other.p)  <span class="comment">// other.pä¸ç©º</span></span><br><span class="line">            &#123;</span><br><span class="line">                p = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>]();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; <span class="number">4</span> ; i++)</span><br><span class="line">                p[i] = other.p[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul><h5 id="ç§»åŠ¨æ„é€ å‡½æ•°">ç§»åŠ¨æ„é€ å‡½æ•°</h5><blockquote><p>C++11ä¹‹å‰ï¼Œå¯¹è±¡çš„æ‹·è´æ§åˆ¶ç”±ä¸‰ä¸ªå‡½æ•°å†³å®šï¼šæ‹·è´æ„é€ å‡½æ•°ï¼ˆCopy Constructorï¼‰ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼ˆCopy Assignment operatorï¼‰å’Œææ„å‡½æ•°ï¼ˆDestructorï¼‰ã€‚</p><p>C++11æ–°å¢åŠ äº†ä¸¤ä¸ªå‡½æ•°ï¼šç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆMove Constructorï¼‰å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆMove Assignment operatorï¼‰ã€‚</p></blockquote><p>åœ¨å‰é¢æˆ‘ä»¬ä»‹ç»äº†ä¸¤ç§æ–¹æ³•æ¥é¿å…æŒ‡é’ˆæµ…æ‹·è´é€ æˆdouble freeçš„é—®é¢˜ã€‚</p><p><strong>åœ¨è¿™é‡Œæˆ‘ä»¬ä»‹ç»ç¬¬ä¸‰ç§æ–¹æ³•ï¼šè¢«å¤åˆ¶çš„å¯¹è±¡çš„æŒ‡é’ˆæˆå‘˜ç½®ä¸ºNULL</strong>ï¼š</p><p>æŒ‡é’ˆçš„æµ…æ‹·è´ä¹‹æ‰€ä»¥å±é™©ï¼Œç©¶å…¶æœ¬è´¨æ˜¯å› ä¸ºè¢«ææ„å‡½æ•°é‡Šæ”¾äº†ä¸¤æ¬¡ã€‚ä¾‹å¦‚ä¸Šè¿°æŒ‡é’ˆ<code>p</code> çš„ç©ºé—´å°±è¢«é‡Šæ”¾äº†ä¸¤æ¬¡ï¼Œå¯¼è‡´double freeã€‚</p><p><strong>å¦‚æœè¢«å¤åˆ¶çš„å¯¹è±¡ä¸å†è¢«ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤åˆ¶æ„é€ å‡½æ•°è¿›è¡Œæµ…æ‹·è´åå°†æŒ‡é’ˆæˆå‘˜ç½®ä¸ºNULLï¼Œææ„æ—¶åˆ¤æ–­æŒ‡é’ˆè¢«ç½®ä¸ºNULLå°±ä¸è¢«é‡Šæ”¾ã€‚è¿™æ ·å°±å¯ä»¥é¿å…double free</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> *p &#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Test</span>()&#123; p = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(<span class="number">4</span>); &#125;</span><br><span class="line">        <span class="built_in">Test</span>(Test&amp; other) </span><br><span class="line">        &#123;    </span><br><span class="line">            <span class="keyword">if</span>(p)  </span><br><span class="line">               <span class="keyword">delete</span> p;</span><br><span class="line">            p = other.p;        <span class="comment">// æµ…æ‹·è´</span></span><br><span class="line">            other.p = <span class="literal">nullptr</span>;  <span class="comment">// æµ…æ‹·è´åå°†æ‹·è´å¯¹è±¡æŒ‡é’ˆæˆå‘˜ç½®ä¸ºNULL</span></span><br><span class="line">        &#125; </span><br><span class="line">        ~<span class="built_in">Test</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(p) <span class="comment">// pä¸ç©ºï¼Œææ„å‡½æ•°è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">            &#123;       </span><br><span class="line">                <span class="keyword">delete</span> p;</span><br><span class="line">            &#125;   </span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Test ob1;</span><br><span class="line">   Test ob2 = ob1; <span class="comment">// ok</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€æ–¹é¢ï¼Œ<strong>è¿™é‡Œ<code>ob2</code> ç›´æ¥ä½¿ç”¨äº†<code>ob1</code> çš„ç©ºé—´ï¼ˆob2.pæŒ‡å‘çš„æ˜¯ob1.påŸæ¥çš„ç©ºé—´ï¼‰ï¼Œä¸å°±å¤§å¤§åœ°é™ä½å†…å­˜åˆ†é…æˆæœ¬å—</strong>ï¼Ÿ</p><p>è¿™ä¹Ÿå°±æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°çš„åˆè¡·ï¼Œ<u>ä¸Šé¢çš„æ‹·è´æ„é€ å‡½æ•°å·²ç»å¯ä»¥ç§°ä¸ºæ˜¯ç§»åŠ¨æ„é€ å‡½æ•°</u>ã€‚</p><p>å¯¹äºç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡ï¼Œå¾€å¾€åªç”¨äºä¼ é€’æ•°æ®ï¼ˆæ²¡æœ‰å…¶å®ƒçš„ç”¨å¤„ï¼‰ï¼Œå¹¶ä¸”ä¼šå¾ˆå¿«ä¼šè¢«é”€æ¯ã€‚å› æ­¤åœ¨ä½¿ç”¨ä¸´æ—¶å¯¹è±¡åˆå§‹åŒ–æ–°å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥<u>å°†å…¶åŒ…å«çš„æŒ‡é’ˆæˆå‘˜æŒ‡å‘çš„å†…å­˜èµ„æºç›´æ¥ç§»ç»™æ–°å¯¹è±¡æ‰€æœ‰</u>ï¼Œæ— éœ€å†æ–°æ‹·è´ä¸€ä»½ï¼Œè¿™å¤§å¤§æé«˜äº†åˆå§‹åŒ–çš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p>ä½†è¿™ç§æ–¹å¼ä¹Ÿæœ‰å±€é™æ€§ï¼š</p><ol><li><p>ä»…é™äºä¸€ä¸ªå¯¹è±¡è¢«å¤åˆ¶åä¸å†è¢«ä½¿ç”¨çš„åœºæ™¯ï¼Œæ¯”å¦‚è¿™é‡Œ<code>ob1</code>ï¼Œå› ä¸º<code>ob1.p</code>æŒ‡å‘å†…å­˜å·²ç»è¢«ç½®ä¸ºNULLï¼›</p></li><li><p>æ„é€ å‡½æ•°å‚æ•°æ— æ³•å£°æ˜ä¸ºconstï¼Œå³ <code>const Test&amp; other</code> ï¼Œå¦åˆ™<code>other.p = nullptr</code> æ— æ³•ä¿®æ”¹ä¼šç¼–è¯‘å‡ºé”™ã€‚ä¸ç”¨constè™½ç„¶å°±å¯ä»¥ä¿®æ”¹äº†ï¼Œä½†å°±æ— æ³•æ¥å—å³å€¼å¼•ç”¨äº†ï¼ˆå¼•ç”¨å¿…é¡»ç”¨å·¦å€¼åˆå§‹åŒ–ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Test</span>(<span class="keyword">const</span> Test&amp; other);  </span><br><span class="line"><span class="function">Test <span class="title">ob2</span><span class="params">(Test())</span></span>;  <span class="comment">// constä¿®é¥°å¼•ç”¨è™½ç„¶ä¹Ÿå¯ä»¥æ¥å—å³å€¼ï¼Œä½†ä¸èƒ½ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line">test.cpp: In copy constructor â€˜Test::<span class="built_in">Test</span>(<span class="keyword">const</span> Test&amp;)â€™:</span><br><span class="line">test.cpp:<span class="number">89</span>:<span class="number">21</span>: error: assignment of member â€˜Test::pâ€™ in read-only object</span><br><span class="line">             other.p = <span class="literal">nullptr</span>;   </span><br></pre></td></tr></table></figure></li></ol><p>æœ‰æ²¡æœ‰åŠæ³•ï¼Œ<strong>è®©ç§»åŠ¨æ„é€ å‡½æ•°å‚æ•°ä¸ç”¨constä¿®é¥°ï¼Œä¹Ÿå¯ä»¥æ¥å—å³å€¼å¼•ç”¨</strong>ï¼Ÿ</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> *p&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Test</span>()&#123;p = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(<span class="number">4</span>);&#125;</span><br><span class="line">        <span class="built_in">Test</span>(Test&amp; other) </span><br><span class="line">        &#123;    </span><br><span class="line">            cout&lt;&lt; <span class="string">&quot;å¤åˆ¶æ„é€ å‡½æ•°ï¼ˆæµ…æ‹·è´ï¼‰&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">if</span>(p)</span><br><span class="line">                <span class="keyword">delete</span> p;</span><br><span class="line">            p = other.p;         <span class="comment">// æµ…æ‹·è´</span></span><br><span class="line">            other.p = <span class="literal">nullptr</span>;   <span class="comment">// ç½®ä¸ºnull</span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="built_in">Test</span>(Test&amp;&amp; other) <span class="comment">// ä½¿ç”¨å³å€¼å¼•ç”¨</span></span><br><span class="line">        &#123;</span><br><span class="line">            cout&lt;&lt; <span class="string">&quot;ç§»åŠ¨æ„é€ å‡½æ•°&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">if</span>(p)</span><br><span class="line">                <span class="keyword">delete</span> p;</span><br><span class="line">            p = other.p;         <span class="comment">// æµ…æ‹·è´</span></span><br><span class="line">            other.p = <span class="literal">nullptr</span>;   <span class="comment">// ç½®ä¸ºnull</span></span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Test</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(p) <span class="comment">// pä¸ç©º</span></span><br><span class="line">            &#123;       </span><br><span class="line">                <span class="keyword">delete</span> p;</span><br><span class="line">            &#125;   </span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Test ob1;</span><br><span class="line">   Test ob2 = std::<span class="built_in">move</span>(ob1); <span class="comment">// æ„é€ å‡½æ•°å‚æ•°æ¥å—å³å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç§»åŠ¨æ„é€ å‡½æ•°</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç§»åŠ¨æ„é€ å‡½æ•°å’Œæˆ‘ä»¬ä¹‹å‰å®ç°çš„å¤åˆ¶æ„é€ å‡½æ•°ï¼ˆæµ…æ‹·è´ï¼‰åŸºæœ¬ä¸€è‡´ã€‚é™¤äº†ï¼š</p><ol><li><p>å£°æ˜æ—¶ï¼Œ<code>Test(Test&amp;&amp; other)</code> çš„<code>&amp;&amp;</code> ï¼Œ<code>&amp;&amp;</code> è¡¨ç¤º<u>å³å€¼å¼•ç”¨</u>ï¼Œè¡¨ç¤ºå‚æ•°åªæ¥æ”¶å³å€¼ï¼›</p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œå¦‚æœä½ å°è¯•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Test ob1;</span><br><span class="line">   Test ob2 = ob1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¤åˆ¶æ„é€ å‡½æ•°ï¼ˆæµ…æ‹·è´ï¼‰</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>ob1</code> æ˜¯å³å€¼ï¼Œä¸ä¼šæ‰§è¡Œç§»åŠ¨æ„é€ å‡½æ•°ã€‚å…¶å®ƒä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>&amp;&amp; pb = a;  <span class="comment">// errorï¼Œåªèƒ½æ¥å—å³å€¼ï¼Œaæ˜¯å·¦å€¼</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>&amp;&amp; pc = <span class="number">2</span>;  <span class="comment">// ok</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨æ—¶ï¼Œ<code>Test ob2 = std::move(ob1)</code> çš„<code>std::move</code> ï¼Œ<code>std::move</code>è¡¨ç¤ºå°†ä¸€ä¸ªå·¦å€¼è½¬æ¢ä¸ºå³å€¼ã€‚</p><p><strong>æ˜¾ç„¶ï¼Œå³å€¼å¼•ç”¨æ¯”å·¦å€¼å¼•ç”¨æ›´åŠ çµæ´»ï¼Œå®ƒè™½ç„¶åªæ¥æ”¶å³å€¼ä½œä¸ºå¼•ç”¨ï¼Œä½†é…åˆ<code>std::move</code>å¯ä»¥ç§»åŠ¨å·¦å€¼æˆå³å€¼</strong>ã€‚</p><p>è¿™é‡Œæ˜¯å°†<code>ob1</code> è½¬æ¢ä¸ºå³å€¼ã€‚ä¸Šä¸ªä¾‹å­ä¸­ä¹Ÿå¯ä»¥è¿›è¡Œè½¬æ¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>&amp;&amp; pb = std::<span class="built_in">move</span>(a);  <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p><code>std::move</code> å®é™…åªæ˜¯ä¸ªç±»å‹è½¬æ¢å™¨ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">typename</span> remove_reference&lt;T&gt;::<span class="function">type&amp;&amp; <span class="title">move</span><span class="params">(T&amp;&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œç±»å‹Tè½¬æ¢ä¸ºtype</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">typename</span> remove_reference&lt;T&gt;::type&amp;&amp;&gt;(t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>æ€»çš„æ¥è¯´ç§»åŠ¨æ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š</p><ul><li>å……åˆ†åˆ©ç”¨ä¸´æ—¶å¯¹è±¡å†…å­˜ï¼Œé¿å…äº†ç©ºé—´æµªè´¹ï¼›</li><li>å¯ä»¥æ”¾å¿ƒä½¿ç”¨æµ…æ‹·è´ã€‚</li></ul><p>ä½†ä¸€åˆ‡éƒ½å»ºç«‹åœ¨ä½¿ç”¨ä¸´æ—¶å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–è¿™ä¸ªåœºæ™¯ä¸‹ã€‚</p><p><strong>ç§»åŠ¨æ„é€ å‡½æ•°è¿˜å¯ä»¥æ‰©å±•åˆ°ç§»åŠ¨è¯­ä¹‰å‡½æ•°ä¸­ï¼Œæœ€å¸¸è§æ˜¯åœ¨STLä¸­ï¼ŒSTLç±»å¤§éƒ½æ”¯æŒç§»åŠ¨è¯­ä¹‰å‡½æ•°</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>std::vector</code>æ–¹æ³•å®šä¹‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_back</span> <span class="params">(<span class="keyword">const</span> value_type&amp; val)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_back</span> <span class="params">(value_type&amp;&amp; val)</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">emplace_back</span> <span class="params">(Args&amp;&amp;... args)</span></span>;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶<code>void push_back (value_type&amp;&amp; val);</code> å¯ä»¥æ¥å—ç§»åŠ¨è¯­ä¹‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string str1 = <span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line">    std::vector&lt;std::string&gt; vec;</span><br><span class="line">     </span><br><span class="line">    vec.<span class="built_in">push_back</span>(str1); <span class="comment">// ä¼ ç»Ÿæ–¹æ³•ï¼Œcopy</span></span><br><span class="line">    vec.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(str1)); <span class="comment">// è°ƒç”¨ç§»åŠ¨è¯­ä¹‰çš„push_backæ–¹æ³•ï¼Œé¿å…æ‹·è´ï¼Œstr1ä¼šå¤±å»åŸæœ‰å€¼ï¼Œå˜æˆç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œè¿™ç§åšæ³•å‡å°‘äº†å¼€è¾Ÿå†…å­˜å¼€é”€ã€‚</p><p><code>emplace_back</code>ç±»ä¼¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vec.<span class="built_in">emplace_back</span>(std::<span class="built_in">move</span>(str1)); <span class="comment">// emplace_backæ•ˆæœç›¸åŒï¼Œstr1ä¼šå¤±å»åŸæœ‰å€¼</span></span><br><span class="line">vec.<span class="built_in">emplace_back</span>(<span class="string">&quot;axcsddcas&quot;</span>);     <span class="comment">// å½“ç„¶å¯ä»¥ç›´æ¥æ¥å³å€¼</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡å¼ºè°ƒï¼Œç§»åŠ¨è¯­ä¹‰å‡½æ•°ä¹Ÿæ˜¯å»ºç«‹åœ¨è¢«æ‹·è´å¯¹è±¡å†æ‹·è´åå°±ä¸å†è¢«éœ€è¦çš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚è¿™é‡Œçš„<code>str1</code>ã€‚</p><p>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</p><h5 id="æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ğŸŒŸ">æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ğŸŒŸ</h5><p><strong>æ€ä¹ˆåˆå§‹åŒ–ç±»ç§æœ‰æˆå‘˜</strong>ï¼Ÿ</p><p>çœ‹è¿‡å‰é¢æ–‡ç« çš„ä½ è‚¯å®šè„±å£è€Œå‡ºï¼šæ„é€ å‡½æ•°å‘€ï¼</p><p>è¿˜æœ‰å—ï¼Ÿå¯¹äº†ï¼Œè¿˜æœ‰åˆ—è¡¨åˆå§‹åŒ–ã€‚å°±åƒè¿™æ ·ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_year&#123; <span class="number">1900</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> m_month&#123; <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> m_day&#123; <span class="number">1</span> &#125;;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><strong>ä½†å¦‚æœç§æœ‰æˆå‘˜è¢«constä¿®é¥°å‘¢</strong>ï¼Ÿ</p><p>åˆ—è¡¨åˆå§‹åŒ–ä¾æ—§å¯ä»¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> m_year&#123; <span class="number">1900</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> m_month&#123; <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> m_day&#123; <span class="number">1</span> &#125;;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœç”¨æˆ·æƒ³ä½¿ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå­˜åœ¨é»˜è®¤å€¼</span></span><br><span class="line"><span class="built_in">Date</span>(<span class="keyword">int</span> day,<span class="keyword">int</span> year,<span class="keyword">int</span> month) </span><br><span class="line">    &#123;m_year=year;m_month=month;m_day=day;&#125;;</span><br></pre></td></tr></table></figure><p>å‡ºé”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const int Date::m_year</span><br><span class="line">expression must be a modifiable lvalue</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> m_year&#123; <span class="number">1900</span> &#125;;</span><br><span class="line">m_year = year;  <span class="comment">// å¸¸é‡ä¸èƒ½ä¿®æ”¹ï¼Œå‡ºé”™</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µå°±éœ€è¦ç”¨åˆ°<u>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</u>ã€‚</p><p><strong>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨å¯ä»¥è®©ç”¨æˆ·åˆå§‹åŒ–ç§æœ‰å˜é‡ï¼ŒåŒ…æ‹¬å¸¸é‡</strong>ã€‚</p><p>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨åœ¨æ„é€ å‡½æ•°åæ¥<code>:</code> è¿›è¡Œåˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m_year&#123; <span class="number">1900</span> &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m_month&#123; <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m_day&#123; <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Date</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Date</span>(<span class="keyword">int</span> year,<span class="keyword">int</span> month,<span class="keyword">int</span> day ):<span class="built_in">m_year</span>(year),<span class="built_in">m_month</span>(month),<span class="built_in">m_day</span>(day) <span class="comment">// å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå­˜åœ¨é»˜è®¤å€¼</span></span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printDay</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       std::cout&lt;&lt;m_day&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Date d&#123;<span class="number">2022</span>,<span class="number">1</span>,<span class="number">26</span>&#125;;</span><br><span class="line">    d.<span class="built_in">printDay</span>();  <span class="comment">// 26ï¼Œç¡®å®é‡æ–°åˆå§‹åŒ–äº†</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æˆå‘˜åˆå§‹åŒ–è¿˜å¯ä»¥åˆå§‹åŒ–æ•°ç»„æˆå‘˜</strong>ã€‚</p><p>åœ¨ C++11ä¹‹å‰ï¼Œåªèƒ½é€šè¿‡æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨å°†æ•°ç»„æˆå‘˜å½’é›¶ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Something</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m_array[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Something</span>(): m_array &#123;&#125; <span class="comment">// åªå½’é›¶</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¿˜å¯ä»¥èµ‹å€¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Something</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m_array[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Something</span>(): m_array &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125; <span class="comment">//  å¯¹æ•°ç»„è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æœ€åæ³¨æ„ï¼Œåˆå§‹åŒ–åˆ—è¡¨ä¸­çš„å˜é‡æ˜¯<u>æŒ‰ç…§ç±»å£°æ˜é¡ºåºè¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯åˆ—è¡¨æŒ‡å®šçš„é¡ºåº</u>ã€‚</p><h5 id="æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–æ›´å¿«ï¼Ÿ">æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–æ›´å¿«ï¼Ÿ</h5><p>å‡†ç¡®æ¥è¯´ï¼š</p><ul><li>å¯¹äºå†…ç½®æ•°æ®ç±»å‹ï¼Œå¤åˆç±»å‹ï¼ˆæŒ‡é’ˆï¼Œå¼•ç”¨ï¼‰,æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨å’Œæ„é€ å‡½æ•°ä½“å†…è¿›è¡Œæ€§èƒ½æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼›</li><li>å¯¹äºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆç±»ç±»å‹ï¼‰ï¼Œæˆå‘˜åˆ—è¡¨åˆå§‹åŒ–ä¼šå¿«å¾ˆå¤šã€‚</li></ul><p>è¿™æ˜¯å› ä¸ºå¯¹äºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼Œä½¿ç”¨æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–<u>ä¼šå°‘ä½¿ç”¨ä¸€æ¬¡æ„é€ å‡½æ•°</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡†å¤‡å¥½classA</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classA</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">classA</span>() &#123; cout &lt;&lt; <span class="string">&quot;classA()&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="comment">// å¤åˆ¶æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">classA</span>(<span class="keyword">const</span> classA&amp; a) &#123; cout &lt;&lt; <span class="string">&quot;copy classA()&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">    ~<span class="built_in">classA</span>() &#123; cout &lt;&lt; <span class="string">&quot;~classA()&quot;</span> &lt;&lt; endl; &#125;</span><br><span class="line">    <span class="comment">// é‡è½½èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    classA&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> classA&amp; a) </span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;operator= in classA&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç†è§£è¿™ä¸ªé—®é¢˜éœ€è¦ä¸€ç‚¹å‰ç½®çŸ¥è¯†ï¼š</p><ol><li><p>ä»€ä¹ˆä¼šä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Ÿ<u>å£°æ˜</u>ä¸€ä¸ªå¯¹è±¡æ—¶ç”¨å¦å¤–ä¸€ä¸ª<u>å·²å­˜åœ¨</u>çš„å¯¹è±¡è¿›è¡Œ<u>åˆå§‹åŒ–</u>æ—¶ï¼Œä¼šè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A a;</span><br><span class="line">A b = <span class="built_in">A</span>();  <span class="comment">// ç¼–è¯‘å™¨ç”ŸæˆåŒ¿åï¼Œç„¶åè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°åˆå§‹bï¼ˆä¸è¿‡ç¼–è¯‘å™¨ä¼šä¼˜åŒ–ï¼‰</span></span><br><span class="line">A b = a;    <span class="comment">// å·²å­˜åœ¨çš„å¯¹è±¡aè°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°åˆå§‹åŒ–b</span></span><br></pre></td></tr></table></figure></li><li><p>ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦ï¼Ÿ</p><blockquote><p>é‡è½½<code>=</code>èµ‹å€¼è¿ç®—ç¬¦åœ¨ä¸‹ç« ä»‹ç»ã€‚</p></blockquote><p>å½“ä¸€ä¸ª<u>å·²å­˜åœ¨</u>çš„å¯¹è±¡ç”¨å¦å¤–ä¸€ä¸ª<u>å·²å­˜åœ¨</u>çš„å¯¹è±¡è¿›è¡Œ<u>èµ‹å€¼</u>æ—¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A a;</span><br><span class="line">A b;</span><br><span class="line">b = a; <span class="comment">// a,bä¹‹å‰å°±å·²å­˜åœ¨ï¼Œæ­¤æ—¶aè°ƒç”¨èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°å¯¹bè¿›è¡Œèµ‹å€¼</span></span><br></pre></td></tr></table></figure></li><li><p>ç±»æˆå‘˜åˆå§‹åŒ–åŠ¨ä½œ<u>æ—©äºæ„é€ å‡½æ•°ä½“æ‰§è¡Œå‰</u>ã€‚</p></li></ol><p>æœ‰äº†è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸ºä»€ä¹ˆæˆå‘˜åˆ—è¡¨åˆå§‹åŒ–æ›´å¿«ã€‚</p><ul><li><p>æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–æ–¹å¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">classC</span>(<span class="keyword">const</span> classA&amp; a) : <span class="built_in">mA</span>(a) &#123;&#125;  <span class="comment">// å¯¹mAè¿›è¡Œæˆå‘˜åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    classA mA;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    classA class_a;</span><br><span class="line">    <span class="function">classC <span class="title">c</span><span class="params">(class_a)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">classA()</span><br><span class="line">copy classA()</span><br><span class="line">~classA()</span><br><span class="line">~classA()</span><br></pre></td></tr></table></figure><p>ä»£ç 11ã€12è¡Œå¤„ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">classA class_a;  <span class="comment">// è¾“å‡ºï¼šclassA()ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡class_a</span></span><br><span class="line">classA mA = a; <span class="comment">// è¾“å‡ºï¼šcopy classA()ï¼Œä¹Ÿæ˜¯è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°æ–¹å¼</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆå‘˜åˆ—è¡¨åˆå§‹åŒ–ä¼šåœ¨<strong>ç±»å®ä¾‹åŒ–æ—¶ï¼Œç›´æ¥ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°å¯¹ç±»ç±»å‹æˆå‘˜åˆå§‹åŒ–</strong>ã€‚</p></li><li><p>æ„é€ å‡½æ•°ä½“åˆå§‹åŒ–</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classC</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">classC</span>(<span class="keyword">const</span> classA&amp; a) </span><br><span class="line">    &#123;</span><br><span class="line">       mA = a;  <span class="comment">// å‡½æ•°ä½“å†…åˆå§‹åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    classA mA;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    classA class_a;</span><br><span class="line">    <span class="function">classC <span class="title">c</span><span class="params">(class_a)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">classA()</span><br><span class="line">classA()</span><br><span class="line">operator= in classA</span><br><span class="line">~classA()</span><br><span class="line">~classA()</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç 14ã€15è¡Œå¤„ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">classA class_a;  <span class="comment">// è¾“å‡ºï¼šclassA()ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡class_a</span></span><br><span class="line">classA mA;       <span class="comment">// è¾“å‡ºï¼šclassA()ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡mA</span></span><br><span class="line">mA = a;          <span class="comment">// è¾“å‡ºï¼šoperator= in classAï¼Œä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡åˆå§‹åŒ–å¦å¤–ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ï¼Œä½¿ç”¨èµ‹å€¼åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>ç”±äºç±»æˆå‘˜åˆå§‹åŒ–æ—©äºæ™®é€šæ„é€ å‡½æ•°ä½“æ‰§è¡Œï¼Œæ‰€ä»¥æ™®é€šæ„é€ å‡½æ•°ä½“åˆå§‹åŒ–ç­‰äº<code>classA mA = a</code>æ‹†åˆ†ä¸ºâ†’<code>classA mA</code> &amp; <code>mA=a</code> ï¼Œå…ˆè°ƒç”¨<u>é»˜è®¤æ„é€ å‡½æ•°</u>å¯¹<code>mA</code>è¿›è¡Œé»˜è®¤åˆå§‹åŒ–ï¼Œå†è°ƒç”¨èµ‹å€¼=å‡½æ•°è¿›è¡Œé‡æ–°èµ‹å€¼ï¼›</li><li>è€Œæˆå‘˜åˆ—è¡¨åˆå§‹åŒ–æ–¹å¼ï¼Œåœ¨ç±»æˆå‘˜åˆå§‹åŒ–æ—¶ç›´æ¥ä½¿ç”¨<u>å¤åˆ¶æ„é€ å‡½æ•°</u>è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ul><p>æ€»ç»“ï¼š<strong>äºŒè€…éƒ½ä½¿ç”¨äº†æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–åœ¨åˆ†é…å†…å­˜ç©ºé—´æ—¶å°±è¿›è¡Œåˆå§‹åŒ–ï¼Œå› æ­¤å°‘è°ƒç”¨äº†ä¸€æ¬¡èµ‹å€¼=å‡½æ•°ï¼›è€Œæ™®é€šæ„é€ å‡½æ•°ä½“åˆå§‹åŒ–ï¼Œæ˜¯åˆ†é…å†…å­˜ç©ºé—´ä¹‹åï¼Œæ­¤æ—¶æˆå‘˜å·²å­˜åœ¨è¿›è¡Œäº†é»˜è®¤åˆå§‹åŒ–ï¼Œæ‰€ä»¥æ‰§è¡Œå‡½æ•°ä½“ä¼šå†è°ƒç”¨ä¸€æ¬¡èµ‹å€¼=å‡½æ•°</strong>ã€‚</p></li></ul><p>å› æ­¤æˆ‘ä»¬è¯´æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–æ•ˆç‡æ›´é«˜ã€‚</p><h5 id="æœ€ä½³å®è·µï¼šåˆå§‹åŒ–é€‰æ‹©">æœ€ä½³å®è·µï¼šåˆå§‹åŒ–é€‰æ‹©</h5><p>è¿„ä»Šä¸ºæ­¢æˆ‘ä»¬æ¥è§¦äº†å¥½å‡ ç§åˆå§‹åŒ–æ–¹å¼ï¼š</p><p>ç±»å®ä¾‹æ–¹å¼ï¼š</p><ol><li>åˆ—è¡¨åˆå§‹åŒ–</li><li>ç›´æ¥åˆå§‹åŒ–</li><li>å¤åˆ¶åˆå§‹åŒ–</li><li><code>std::move</code></li></ol><p>ç±»å£°æ˜åˆå§‹åŒ–ä½ç½®ï¼š</p><ol><li>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨åˆå§‹åŒ–</li><li>æ™®é€šæ„é€ å‡½æ•°ä½“å†…åˆå§‹åŒ–</li></ol><p>æ€ä¹ˆè¿›è¡Œé€‰æ‹©ï¼Ÿ</p><p>ç±»å£°æ˜åˆå§‹åŒ–ä½ç½®ï¼š</p><ul><li><p><u>ç±»ç±»å‹æˆå‘˜ã€å¸¸é‡æˆå‘˜ã€å¼•ç”¨æˆå‘˜</u>ä¼˜å…ˆè€ƒè™‘<u>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</u>ã€‚å› ä¸ºæˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ä¸åœ¨å‡½æ•°ä½“å†…ï¼Œæ•ˆç‡æ›´é«˜ï¼›</p><p>ï¼ˆè¡¥å……å…¶å®ƒæƒ…å†µï¼šå½“è°ƒç”¨ä¸€ä¸ªåŸºç±»çš„æ„é€ å‡½æ•°ï¼Œè€Œæ„é€ å‡½æ•°æ‹¥æœ‰ä¸€ç»„å‚æ•°æ—¶ï¼›å½“è°ƒç”¨ä¸€ä¸ªæˆå‘˜ç±»çš„æ„é€ å‡½æ•°ï¼Œè€Œå®ƒæ‹¥æœ‰ä¸€ç»„å‚æ•°ã€‚ï¼‰</p></li><li><p>å¦‚æœç±»æˆå‘˜è¿˜éœ€è¦åœ¨è°ƒ<u>ç”¨æ„é€ å‡½æ•°å‰</u>å°±æä¾›é»˜è®¤å€¼ï¼Œæˆå‘˜å£°æ˜æ—¶ä½¿ç”¨<code>&#123;&#125;</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> m_year&#123; <span class="number">1900</span> &#125;;</span><br></pre></td></tr></table></figure></li><li><p>æœ€åè€ƒè™‘æ™®é€šæ„é€ å‡½æ•°ã€‚</p></li></ul><p>ç±»å®ä¾‹æ–¹å¼ï¼š</p><ul><li>ä¼˜å…ˆè€ƒè™‘<u>åˆ—è¡¨åˆå§‹åŒ–</u>ã€‚å› ä¸ºåˆ—è¡¨åˆå§‹åŒ–è¿˜å¯èƒ½ä¼šè¿›è¡Œé›¶å€¼åˆå§‹åŒ–ï¼Œæ›´å®‰å…¨ï¼Œä½†æ•ˆç‡ç›¸æ¯”ç›´æ¥åˆå§‹åŒ–æ›´ä½ç‚¹ã€‚</li><li>å¦‚æœæ˜¯ä¸´æ—¶å¯¹è±¡åˆå§‹åŒ–åœºæ™¯ï¼Œä½¿ç”¨<code>std::move</code>ç§»åŠ¨æ„é€ å‡½æ•°åˆå§‹åŒ–ã€‚</li><li>æ…é‡ä½¿ç”¨å¤åˆ¶åˆå§‹åŒ–ã€‚å› ä¸ºè¿™ç§æ–¹å¼è¿˜ä¼šåˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œæ•ˆç‡æ¯”è¾ƒä½ï¼Œè€Œä¸”ä¸å®‰å…¨ï¼ˆæµ…æ‹·è´ï¼‰â€”â€”ä¸€èˆ¬æ˜¯<u>éœ€è¦æ˜¾å¼å£°æ˜å¤åˆ¶æ„é€ å‡½æ•°å®ç°å¯¹è±¡å¤åˆ¶æ—¶ï¼ˆæ·±æ‹·è´ï¼‰æ‰ä½¿ç”¨</u>ã€‚</li></ul><h4 id="5-2-3-å§”æ‰˜æ„é€ å‡½æ•°">5.2.3 å§”æ‰˜æ„é€ å‡½æ•°</h4><p>æ„é€ å‡½æ•°é‡è½½æ—¶ï¼Œå…è®¸ä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨å…¶å®ƒæ„é€ å‡½æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>å§”æ‰˜æ„é€ å‡½æ•°</strong> ï¼ˆæˆ–è€… <strong>æ„é€ å‡½æ•°é“¾</strong>)ã€‚</p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ</p><p><strong>å› ä¸ºC++ä¸­ä¸èƒ½åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°åµŒå¥—ï¼Œä¸ä¼šåˆå§‹åŒ–å½“å‰å¯¹è±¡</strong> ã€‚</p><p>ä¸‹é¢ä¾¿æ˜¯ä¸€ä¸ªé”™è¯¯çš„ç¤ºèŒƒï¼ŒçŒœçŒœè¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>()&#123; Point&#123;<span class="number">0</span>, <span class="number">0</span>&#125;;&#125;;  <span class="comment">// è°ƒç”¨æœ‰å‚æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Point</span>(<span class="keyword">int</span> _x, <span class="keyword">int</span> _y): <span class="built_in">x</span>(_x), <span class="built_in">y</span>(_y) &#123;  &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123; cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, y = &quot;</span> &lt;&lt; y &lt;&lt;endl; &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> y;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Point p1&#123;&#125;;</span><br><span class="line">    p1.<span class="built_in">show</span>();      <span class="comment">// æ˜¯ x=0ï¼Œy=0å—ï¼Ÿ</span></span><br><span class="line">    Point p2&#123;<span class="number">2</span>,<span class="number">3</span>&#125;;  <span class="comment">// æ˜¯ x=2ï¼Œy=3å—ï¼Ÿ</span></span><br><span class="line">    p2.<span class="built_in">show</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¯èƒ½ä¼šè®©ä½ æœ‰ç‚¹æ„å¤–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = -1847177920, y = 32765</span><br><span class="line">x = 2, y = 3</span><br></pre></td></tr></table></figure><p>å¥½å®¶ä¼™<code>x = -1847177920, y = 32765</code>æ˜¯ä»€ä¹ˆé¬¼ï¼ŸPoint{0, 0}æ²¡æœ‰åˆå§‹åŒ–p1å—ï¼Ÿ</p><p>å›åˆ°æ¡ˆå‘ç°åœºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Point p1;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“åœ¨C++ä¸­å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼š</p><ol><li>è¦å…ˆåˆ†é…å†…å­˜ï¼ˆæ­¤æ—¶ï¼Œéé™æ€æˆå‘˜è¿˜æœªåˆå§‹åŒ–ï¼‰ï¼›</li><li>å†è°ƒç”¨æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–éé™æ€æˆå‘˜ï¼‰ã€‚</li></ol><p>å¯¹äº<code>Point p1</code> ï¼š</p><ol><li>ç¼–è¯‘å™¨ç»™å¯¹è±¡<code>p1</code> åˆ†é…äº†å†…å­˜ï¼›</li><li>è°ƒç”¨æ„é€ å‡½æ•°<code>Point()</code> åˆå§‹åŒ–ï¼Œè¿›å…¥å‡½æ•°ä½“å¼€å§‹æ‰§è¡Œæ„é€ å‡½æ•°<code>Point(int,int)</code> ï¼›</li><li>æ‰§è¡Œæ„é€ å‡½æ•°<code>Point(int,int)</code>æ—¶ï¼Œç¼–è¯‘å™¨åˆåˆ›å»ºäº†ä¸´æ—¶åŒ¿åå¯¹è±¡ï¼›</li><li>æ­¤æ—¶å†è°ƒç”¨<code>Point(int,int)</code> åˆå§‹åŒ–åŒ¿åå¯¹è±¡éé™æ€æˆå‘˜x=0ï¼Œy=0ï¼Œè€Œä¸æ˜¯å¯¹è±¡<code>p1</code>ï¼›</li><li>æ‰€ä»¥æœ€ç»ˆå¯¹è±¡<code>p1</code> é™æ€æˆå‘˜æ²¡æœ‰è¢«åˆå§‹åŒ–ä¸º{0,0}ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°æ„é€ å‡½æ•°å†…éƒ¨çš„æ„é€ å‡½æ•°ï¼Œä¸ä¼šåˆå§‹åŒ–å½“å‰å¯¹è±¡è€Œæ˜¯æ–°ç”Ÿæˆçš„åŒ¿åå¯¹è±¡ã€‚</p><p><strong>æ•´ä¸ªè¿‡ç¨‹æ¯”è¾ƒéš¾ç†è§£çš„æ˜¯ç¬¬3ç‚¹ï¼šä¸ºä»€ä¹ˆæ‰§è¡Œæ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨åˆ›å»ºäº†ä¸´æ—¶å¯¹è±¡ï¼Œæ„é€ å‡½æ•°ä¸æ˜¯ä¸ä¼šåˆ›å»ºå¯¹è±¡å—</strong>ï¼Ÿ</p><p>æ„é€ å‡½æ•°è™½ç„¶ä¸åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯åœ¨æ„é€ å‡½æ•°<u>æ‰§è¡Œå‰</u>ï¼Œç¼–è¯‘å™¨ä¼šåˆ†é…ä¸€ä¸ªåŒ¿åå¯¹è±¡ç©ºé—´ï¼Œç„¶åæ„é€ å‡½æ•°åªè´Ÿè´£å°†å…¶åˆå§‹åŒ–ã€‚</p><p>æ˜¯çš„ï¼ŒC++å°±æ˜¯è¿™ä¹ˆé­”é¬¼ã€‚</p><p><strong>ä¸è¿‡ï¼ŒC++å¤§é­”ç‹å¤§æ…ˆå¤§æ‚²å…è®¸ä½ ä½¿ç”¨å§”æ‰˜æ„é€ å‡½æ•°æ–¹å¼è¿›è¡Œæ„é€ å‡½æ•°åµŒå¥—</strong>ã€‚</p><p>èµ¶ç´§å¸¦ç€æ„Ÿæ©çš„å¿ƒç§ä¸€ä¸‹å§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(): Point&#123;<span class="number">0</span>, <span class="number">0</span>&#125;&#123;&#125;;  <span class="comment">// å§”æ‰˜æ„é€ æ–¹å¼</span></span><br><span class="line">    <span class="built_in">Point</span>(<span class="keyword">int</span> _x, <span class="keyword">int</span> _y): <span class="built_in">x</span>(_x), <span class="built_in">y</span>(_y) &#123;  &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123; cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, y = &quot;</span> &lt;&lt; y &lt;&lt;endl; &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> y;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å·å·å†å‘Šè¯‰ä½ ä¸¤ç§ä¸å¤ªä¼˜é›…çš„æ–¹å¼åšåˆ°ç±»ä¼¼æ„é€ å‡½æ•°åµŒå¥—çš„æ•ˆæœ</strong>ã€‚</p><ul><li><p>æŠŠæ„é€ å‡½æ•°ä¸­çš„å…¬å…±éƒ¨åˆ†æŠ½å–å‡ºæ¥å®šä¹‰ä¸€ä¸ªæˆå‘˜å‡½æ•°(æ¨èä¸ºprivate)ï¼Œç„¶ååœ¨æ¯ä¸ªéœ€è¦è¿™ä¸ªä»£ç çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨è¯¥å‡½æ•°å³å¯ã€‚</p></li><li><p>ä½¿ç”¨placement newã€‚å› ä¸ºplacement newä¸ä¼šé‡æ–°åˆ†é…å†…å­˜ï¼ŒæŸ¥çœ‹å…¶å®šä¹‰ä¹Ÿè¯æ˜äº†è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> *__cdecl <span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>, <span class="keyword">void</span> *_P)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (_P);  <span class="comment">// æ²¡æœ‰åˆ†é…æ–°çš„å†…å­˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥è®©è°ƒç”¨æ„é€ å‡½æ•°<code>Point(int,int)</code> ä¸ä¼šåˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œä¾æ—§æ˜¯åœ¨å¯¹è±¡<code>p1</code>å†…å­˜ä¸­æ‰§è¡Œï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Point</span>()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">new</span> (<span class="keyword">this</span>)Point&#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">Point p1;</span><br></pre></td></tr></table></figure></li></ul><h4 id="5-2-4-éšè—çš„thisæŒ‡é’ˆ">5.2.4 éšè—çš„thisæŒ‡é’ˆ</h4><h5 id="å¿«é€Ÿå›å¿†">å¿«é€Ÿå›å¿†</h5><p>åœ¨<u>2.1.4</u>èŠ‚ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ä¸ªéšè—çš„<code>this</code>æŒ‡é’ˆã€‚</p><p>å¿«é€Ÿå›å¿†ä¸‹ï¼Œä¸‹é¢ä»£ç <u>æ³¨é‡Š</u>æ˜¾ç¤ºæŒ‡ç¤ºäº†<code>this</code>æŒ‡é’ˆï¼š</p><ul><li>ç¼–è¯‘å™¨éšå¼ä¸ºæ¯ä¸ªæ•°æ®æˆå‘˜åŠ ä¸Š<code>this</code> æŒ‡é’ˆï¼›</li><li>ç¼–è¯‘å™¨éšå¼ä¸ºæ¯ä¸ªå‡½æ•°æ˜¾ç¤ºåŠ ä¸Šäº†ç¬¬ä¸€ä¸ªå‚æ•°<code>Simple* const this</code> ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Simple</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Simple</span>(<span class="keyword">int</span> id): m_id&#123; id &#125;</span><br><span class="line">    <span class="comment">// Simple(Simple* const this,int id): this-&gt;m_id&#123; id &#125; </span></span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setID</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123; m_id = id; &#125;</span><br><span class="line">    <span class="comment">//  void setID(Simple* const this,int id) &#123; this-&gt;m_id = id; &#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getID</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;m_id; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Simple simple&#123;<span class="number">1</span>&#125;;</span><br><span class="line">    simple.<span class="built_in">setID</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// simple.setID(&amp;simple,2);</span></span><br><span class="line">    std::cout &lt;&lt; simple.<span class="built_in">getID</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç 22è¡Œå¤„ï¼Œä¹Ÿå¯ä»¥çŸ¥é“ï¼š<strong><code>this</code>æŒ‡é’ˆå°±æ˜¯æŒ‡å‘å½“å‰å¯¹è±¡</strong><code>simple</code> ã€‚</p><p>å¤§éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥å‡è£…ä¸çŸ¥é“thisæŒ‡é’ˆçš„å­˜åœ¨ï¼Œä½†åœ¨é“¾æ¥æˆå‘˜æ—¶thisæŒ‡é’ˆè¡¨ç°å¾—å¾ˆæœ‰ç”¨ã€‚</p><h5 id="thisæŒ‡é’ˆé“¾æ¥æˆå‘˜å‡½æ•°">thisæŒ‡é’ˆé“¾æ¥æˆå‘˜å‡½æ•°</h5><p>æ€è€ƒä¸€ä¸‹ï¼šç»å¸¸ä½¿ç”¨std::coutæ˜¯å¦‚ä½•å®ç°è¿ç»­æ‰“å°å¤šä¸ªå­—ç¬¦ä¸²çš„ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; <span class="string">&quot;Hello &quot;</span> &lt;&lt; <span class="string">&quot;World&quot;</span>;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œstd::cout æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ operator&lt;&lt; æ˜¯å¯¹è¯¥å¯¹è±¡è¿›è¡Œæ“ä½œçš„æˆå‘˜å‡½æ•°ï¼š</p><ul><li>operator&lt;&lt; æ‰“å°ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²&quot;Hello &quot;ï¼Œç„¶åè¿”å›å½“å‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>*this</code>ï¼›</li><li>std::cout å¯¹è±¡ <code>*this</code> è°ƒç”¨operator&lt;&lt; æ‰“å°ç¬¬äºŒä¸ªå­—ç¬¦ä¸²&quot;World&quot;ã€‚</li></ul><p>ä¸¾ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Calc</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_value&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Calc&amp; <span class="title">add</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123; m_value += value; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    <span class="function">Calc&amp; <span class="title">sub</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123; m_value -= value; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    <span class="function">Calc&amp; <span class="title">mult</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123; m_value *= value; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_value; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Calc calc&#123;&#125;;</span><br><span class="line">    calc.<span class="built_in">add</span>(<span class="number">5</span>).<span class="built_in">sub</span>(<span class="number">3</span>).<span class="built_in">mult</span>(<span class="number">4</span>);   <span class="comment">// å‡½æ•°é“¾æ¥èµ·æ¥äº†</span></span><br><span class="line">    std::cout &lt;&lt; calc.<span class="built_in">getValue</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§åšæ³•åœ¨<u>ç±»é‡è½½è¿ç®—ç¬¦</u>æ—¶æœ€å¸¸ä½¿ç”¨ï¼Œåç»­æˆ‘ä»¬ä¼šç»§ç»­ä»‹ç»ã€‚</p><h3 id="5-3-ææ„å‡½æ•°">5.3 ææ„å‡½æ•°</h3><h4 id="ä»€ä¹ˆæ˜¯ææ„å‡½æ•°">ä»€ä¹ˆæ˜¯ææ„å‡½æ•°</h4><p><strong>ææ„å‡½æ•°</strong>æ˜¯å¦ä¸€ç§ç‰¹æ®Šçš„ç±»æˆå‘˜å‡½æ•°ï¼Œåœ¨è¯¥ç±»çš„å¯¹è±¡è¢«é”€æ¯æ—¶æ‰§è¡Œï¼Œå¸®åŠ©ç±»æ¸…ç†å¯¹è±¡ã€‚</p><p>å’Œæ„é€ å‡½æ•°ä¸€æ ·ï¼Œææ„å‡½æ•°æ²¡æœ‰å‚æ•°ã€è¿”å›ç±»å‹ï¼Œä¸ç±»åŒåã€‚</p><p>ææ„å‡½æ•°ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ</p><ul><li>å½“ä¸€ä¸ªå¯¹è±¡æ­£å¸¸è¶…å‡ºèŒƒå›´ï¼›</li><li>delete å…³é”®å­—æ˜¾å¼åˆ é™¤åŠ¨æ€åˆ†é…çš„å¯¹è±¡ã€‚</li></ul><p>ç±»ä¸€å®šéœ€è¦ææ„å‡½æ•°å—ï¼Ÿ</p><ul><li>å¦‚æœåªæ˜¯åŒ…å«æ™®é€šæˆå‘˜å˜é‡çš„å€¼ï¼Œä¸éœ€è¦ææ„å‡½æ•°ï¼›</li><li>å¦‚æœæ˜¯ç±»å¯¹è±¡æŒæœ‰åŠ¨æ€å†…å­˜ã€æ–‡ä»¶æˆ–æ•°æ®åº“å¥æŸ„ï¼Œéœ€è¦ææ„å‡½æ•°ã€‚</li></ul><p>ä¾‹å¦‚ä¸‹é¢<u>æ•°ç»„</u>æŒ‡é’ˆ<code>m_array</code> éœ€è¦æ˜¾ç¤ºå®šä¹‰ææ„å‡½æ•°è¿›è¡Œæ¸…ç†ï¼Œå¦åˆ™ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstddef&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntArray</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">int</span>* m_array&#123;&#125;;  <span class="comment">// æŒæœ‰åŠ¨æ€å†…å­˜</span></span><br><span class="line"><span class="keyword">int</span> m_length&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">IntArray</span>(<span class="keyword">int</span> length) </span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">assert</span>(length &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">m_array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="keyword">static_cast</span>&lt;std::<span class="keyword">size_t</span>&gt;(length)]&#123;&#125;;</span><br><span class="line">m_length = length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">IntArray</span>() <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span>[] m_array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> value)</span> </span>&#123; m_array[index] = value; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getValue</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123; <span class="keyword">return</span> m_array[index]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLength</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> m_length; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">IntArray <span class="title">arr</span> <span class="params">( <span class="number">10</span> )</span></span>;  <span class="comment">// ç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> count&#123; <span class="number">0</span> &#125;; count &lt; arr.<span class="built_in">getLength</span>(); ++count)</span><br><span class="line">arr.<span class="built_in">setValue</span>(count, count+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;The value of element 5 is: &quot;</span> &lt;&lt; ar.<span class="built_in">getValue</span>(<span class="number">5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The value of element 5 is:  6</span><br></pre></td></tr></table></figure><h4 id="RAII">RAII</h4><p>RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€æœ¯ï¼Œå…¶ä¸­èµ„æºä½¿ç”¨ä¸å…·æœ‰è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼ˆä¾‹å¦‚éåŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼‰çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³è”ã€‚åœ¨ C++ ä¸­ï¼ŒRAII æ˜¯é€šè¿‡å…·æœ‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„ç±»æ¥å®ç°çš„ã€‚</p><p><strong>RAII çš„ä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒæœ‰åŠ©äºé˜²æ­¢èµ„æºæ³„æ¼</strong>ï¼ˆä¾‹å¦‚å†…å­˜æœªè¢«é‡Šæ”¾ï¼‰ï¼Œå› ä¸ºæ‰€æœ‰èµ„æºæŒæœ‰å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨æ¸…ç†ã€‚</p><ul><li>èµ„æºï¼ˆä¾‹å¦‚å†…å­˜ã€æ–‡ä»¶æˆ–æ•°æ®åº“å¥æŸ„ç­‰ï¼‰é€šå¸¸åœ¨å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­è·å–ï¼ˆå°½ç®¡å¦‚æœæœ‰æ„ä¹‰ï¼Œå¯ä»¥åœ¨åˆ›å»ºå¯¹è±¡åè·å–ï¼‰ï¼Œå¯ä»¥åœ¨<u>å¯¹è±¡å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ä½¿ç”¨è¯¥èµ„æº</u> ã€‚</li><li><u>å½“å¯¹è±¡è¢«é”€æ¯æ—¶</u>ï¼Œèµ„æºåœ¨ææ„å‡½æ•°ä¸­è¢«é‡Šæ”¾ã€‚</li></ul><p>å‰ä¾‹ä¸­çš„<code>m_array</code>å°±æ˜¯ä¸€ä¸ªRAIIå¾ˆå¥½çš„ä¾‹å­â€”â€”åœ¨æ„é€ å‡½æ•°ä¸­åˆ†é…ï¼Œåœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾ã€‚</p><p>åœ¨æ ‡å‡†åº“ä¸­ï¼Œstd::string å’Œ std::vectoråŒæ ·éµå¾ªRAIIâ€”â€”åŠ¨æ€å†…å­˜åœ¨åˆå§‹åŒ–æ—¶è·å–ï¼Œå¹¶åœ¨é”€æ¯æ—¶è‡ªåŠ¨æ¸…ç†ã€‚</p><h3 id="5-4-å‹å…ƒå‡½æ•°å’Œå‹å…ƒç±»">5.4 å‹å…ƒå‡½æ•°å’Œå‹å…ƒç±»</h3><p>åœ¨å‰é¢ï¼Œæˆ‘ä»¬ä¸€ç›´åŠªåŠ›å°½é‡ä»‹ç»ç±»æ•°æ®ä¿å¯†ï¼ˆprivateï¼‰çš„å¥½å¤„ã€‚</p><p><strong>ä½†æ˜¯ï¼Œå¦‚æœæœ‰ç±»Aå’Œç±»Bç¡®å®è”ç³»çš„éå¸¸ç´§å¯†ï¼Œç±»Bå¯¹è±¡éœ€è¦ç”¨åˆ°ç±»Aå¯¹è±¡çš„ç§æœ‰æˆå‘˜ï¼Œè¿™æ€ä¹ˆåŠ</strong>ï¼Ÿ</p><p>ï¼ˆå®šä¹‰é‡è½½è¿ç®—ç¬¦ä¸¤ä¸ªç±»é€šå¸¸è”ç³»å¾—å¾ˆç´§å¯†ï¼Œä¸€èˆ¬æƒ…å†µç¡®å®ä¸å¸¸è§ã€‚ï¼‰</p><ul><li>å°†ç±»Açš„ç§æœ‰æˆå‘˜å…¬å¼€ï¼ˆpublicï¼‰ï¼Ÿæ˜¾ç„¶ä¸èƒ½è¿™æ ·ï¼Œè¿™æ ·åˆ«çš„ç±»å¯¹è±¡ä¹Ÿå¯ä»¥è®¿é—®Açš„ç§æœ‰æˆå‘˜ï¼›</li><li>åœ¨ç±»Aä¸“é—¨è®¾ç½®æ¥å£å‡½æ•°è·å–ç§æœ‰æˆå‘˜å€¼ï¼Ÿæ˜¾ç„¶è¿™æ ·ä¹Ÿä¸è¡Œï¼Œé“ç†åŒä¸Šã€‚</li></ul><p>å¦‚æœèƒ½æŒ‡å®š<u>åªèƒ½</u>ç±»Bè®¿é—®ç±»Açš„ç§æœ‰æˆå‘˜è¯¥å¤šå¥½å•Šï¼</p><h4 id="5-4-1-å‹å…ƒå‡½æ•°">5.4.1 å‹å…ƒå‡½æ•°</h4><p><strong>å‹å…ƒå‡½æ•°å°±åšäº†è¿™ä¹ˆä¸€ä»¶äº‹ï¼šæŒ‡å®šæŸä¸ªæ™®é€šå‡½æ•°æˆ–æŸä¸ªç±»çš„æˆå‘˜å‡½æ•°ä¸ºæœ¬ç±»çš„å‹å…ƒå‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨æœ¬ç±»çš„ç§æœ‰æˆå‘˜</strong>ã€‚</p><p>ï¼ˆä¸è¿‡åŒæ—¶ä¹Ÿè¿˜æ˜¯ç ´åäº†ç±»çš„å°è£…æ€§å’Œæ•°æ®çš„éšè—æ€§ï¼Œå¯¼è‡´ç¨‹åºå¯ç»´æŠ¤æ€§å˜å·®ï¼‰</p><p>ä¸¾ä¾‹è¯´æ˜æ™®é€šå‡½æ•°/æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒå‡½æ•°ã€‚</p><h5 id="æ™®é€šå‡½æ•°ä½œä¸ºå‹å…ƒå‡½æ•°">æ™®é€šå‡½æ•°ä½œä¸ºå‹å…ƒå‡½æ•°</h5><p>å‹å…ƒå‡½æ•°æ˜¯å®šä¹‰åœ¨ç±»å¤–ï¼ˆä¸å±äºä»»ä½•ç±»ï¼‰ï¼Œä½†å£°æ˜åœ¨ç±»ä¸­ã€‚</p><p>ä¸‹é¢è¿™ä¸ªä¾‹å­åœ¨ç±»<code>Accumulator</code> æŠŠå¤–éƒ¨å‡½æ•°<code>reset</code> ä½œä¸ºå‹å…ƒå‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Accumulator</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_value &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤–éƒ¨å‡½æ•°resetä½œä¸ºå‹å…ƒå‡½æ•°</span></span><br><span class="line">    <span class="comment">// å‹å…ƒå‡½æ•°å£°æ˜åœ¨ç±»å¤–ï¼ŒAccumulatorå¯¹è±¡ä½œä¸ºå‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">(Accumulator&amp; accumulator)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹å…ƒå‡½æ•°resetå®šä¹‰åœ¨ç±»å¤–</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(Accumulator&amp; accumulator)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç°åœ¨resetå¯ä»¥ä½¿ç”¨ç±»Accumulatorå¯¹è±¡çš„ç§æœ‰æˆå‘˜</span></span><br><span class="line">    accumulator.m_value = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Accumulator acc;</span><br><span class="line">    <span class="built_in">reset</span>(acc); <span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼Œæˆ‘ä»¬å¿…é¡»å°† Accumulator å¯¹è±¡ä¼ é€’ç»™ reset()</strong>ã€‚</p><p>å› ä¸ºå‹å…ƒå‡½æ•°reset() <u>ä¸æ˜¯ç±»çš„æˆå‘˜</u>ï¼Œæ²¡æœ‰ <code>*this</code> æŒ‡é’ˆï¼Œä¹Ÿæ²¡æœ‰å¯ä¾›ä½¿ç”¨çš„ Accumulator å¯¹è±¡ï¼Œå¿…é¡»ç»™å®šä¸€ä¸ªã€‚</p><p><strong>ä¸€ä¸ªå‡½æ•°è¿˜å¯ä»¥åŒæ—¶æ˜¯å¤šä¸ªç±»çš„å‹å…ƒå‡½æ•°ï¼Œä½†æ˜¯æ¯ä¸ªç±»ä¸­éƒ½è¦å£°æ˜è¿™ä¸ªå‡½æ•°</strong>ã€‚</p><p>ä¸‹é¢å¤–éƒ¨å‡½æ•°<code>printWeather</code> åŒæ—¶æ˜¯ç±»<code>Humidity</code> å’Œ <code>Temperature</code> çš„å‹å…ƒå‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Humidity</span>;</span>  <span class="comment">// å‰å‘å£°æ˜ï¼Œå¦åˆ™ä»£ç 14è¡Œå¤„æ— æ³•æ‰¾åˆ°å®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperature</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_temp &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Temperature</span>(<span class="keyword">int</span> temp=<span class="number">0</span>): m_temp &#123; temp &#125;</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="comment">// å£°æ˜1ï¼šæ˜¯ç±»Temperatureçš„å‹å…ƒå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">void</span> <span class="title">printWeather</span><span class="params">(<span class="keyword">const</span> Temperature&amp; temperature, <span class="keyword">const</span> Humidity&amp; humidity)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Humidity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_humidity &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Humidity</span>(<span class="keyword">int</span> humidity=<span class="number">0</span>): m_humidity &#123; humidity &#125;</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="comment">// å£°æ˜2ï¼šæ˜¯ç±»Humidityçš„å‹å…ƒå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">void</span> <span class="title">printWeather</span><span class="params">(<span class="keyword">const</span> Temperature&amp; temperature, <span class="keyword">const</span> Humidity&amp; humidity)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å‹å…ƒå‡½æ•°printWeather</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printWeather</span><span class="params">(<span class="keyword">const</span> Temperature&amp; temperature, <span class="keyword">const</span> Humidity&amp; humidity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;The temperature is &quot;</span> &lt;&lt; temperature.m_temp &lt;&lt;</span><br><span class="line">       <span class="string">&quot; and the humidity is &quot;</span> &lt;&lt; humidity.m_humidity &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Humidity <span class="title">hum</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="function">Temperature <span class="title">temp</span><span class="params">(<span class="number">12</span>)</span></span>;</span><br><span class="line">    <span class="built_in">printWeather</span>(temp, hum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒå‡½æ•°">æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒå‡½æ•°</h5><p>ä¸ä½¿æ™®é€šå‡½æ•°æˆä¸ºæœ‹å‹ç±»ä¼¼ï¼Œå¯ä»¥è®©ç±»æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒå‡½æ•°ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®ä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Humidity</span>;</span>  <span class="comment">// å‰å‘å£°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperature</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_temp &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Temperature</span>(<span class="keyword">int</span> temp=<span class="number">0</span>): m_temp &#123; temp &#125;</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸éœ€è¦Humidityå®Œæ•´å®šä¹‰ï¼Œå‰é¢å‰å‘å£°æ˜å°±å¯ä»¥ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printHumidity</span><span class="params">(<span class="keyword">const</span> Humidity&amp; Humidity)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       std::cout &lt;&lt; <span class="string">&quot;The Humidity is &quot;</span> &lt;&lt; Humidity.m_humidity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Humidity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_humidity &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Humidity</span>(<span class="keyword">int</span> humidity=<span class="number">0</span>): m_humidity &#123; humidity &#125;</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    <span class="comment">// Humidityçš„å‹å…ƒå‡½æ•°æ˜¯Temperatureç±»ä¸­çš„printHumidityå‡½æ•°</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œç±»Temperatureä¸€å®šè¦åœ¨å‰ï¼Œå› ä¸ºç¼–è¯‘å™¨éœ€è¦å‹å…ƒå‡½æ•°ç±»Temperatureå®Œæ•´å®šä¹‰</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">void</span> Temperature:: <span class="built_in">printHumidity</span> (<span class="keyword">const</span> Humidity&amp; Humidity);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="5-4-2-å‹å…ƒç±»">5.4.2 å‹å…ƒç±»</h4><p>ä¹Ÿå¯ä»¥è®©æ•´ä¸ªç±»æˆä¸ºå¦ä¸€ä¸ªç±»çš„æœ‹å‹ï¼Œè¿™æ ·å‹å…ƒç±»çš„æ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å®ä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Storage</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> m_nValue &#123;&#125;;</span><br><span class="line">    <span class="keyword">double</span> m_dValue &#123;&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Storage</span>(<span class="keyword">int</span> nValue, <span class="keyword">double</span> dValue)</span><br><span class="line">       : m_nValue &#123; nValue &#125;, m_dValue &#123; dValue &#125;</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Displayæ˜¯æœ¬ç±»ï¼ˆStorageï¼‰çš„å‹å…ƒç±»</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">Display</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">bool</span> m_displayIntFirst;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Display</span>(<span class="keyword">bool</span> displayIntFirst)</span><br><span class="line">         : m_displayIntFirst &#123; displayIntFirst &#125;</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">displayItem</span><span class="params">(<span class="keyword">const</span> Storage&amp; storage)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Displayå¯ä»¥ä½¿ç”¨Storageçš„ç§æœ‰æˆå‘˜</span></span><br><span class="line">        <span class="keyword">if</span> (m_displayIntFirst)</span><br><span class="line">            std::cout &lt;&lt; storage.m_nValue &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; storage.m_dValue &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            std::cout &lt;&lt; storage.m_dValue &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; storage.m_nValue &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Storage <span class="title">storage</span><span class="params">(<span class="number">5</span>, <span class="number">6.7</span>)</span></span>;</span><br><span class="line">    <span class="function">Display <span class="title">display</span><span class="params">(<span class="literal">false</span>)</span></span>;</span><br><span class="line">    display.<span class="built_in">displayItem</span>(storage); <span class="comment">// ok</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h2><div class="timeline"><div class="timenode"><div class="meta"><p><p>2022-01-29ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ä¿®æ”¹æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–ç›¸å…³æè¿°</li><li>å¢åŠ ç§»åŠ¨æ„é€ å‡½æ•°ç›¸å…³æè¿°</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2022-01-28ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ä¿®æ”¹å¤åˆ¶åˆå§‹åŒ–ç›¸å…³æè¿°</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2022-01-27ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ç¬¬ä¸€æ¬¡æ›´æ–°</li></ol></div></div></div><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++æ„é€ å‡½æ•°çš„ç†è§£ : https://www.cnblogs.com/downey-blog/p/10470782.html<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ç¦æ­¢æ‹·è´æ„é€ ï¼Œç¦æ­¢bugï¼šhttps://zhuanlan.zhihu.com/p/266353611<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ä¸ºä»€ä¹ˆä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ä¼šå¿«ä¸€äº›ï¼Ÿhttps://segmentfault.com/a/1190000039294789<a href="#fnref:3" rev="footnote"> â†©</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++11å³å€¼å¼•ç”¨å’Œç§»åŠ¨æ„é€ å‡½æ•°è¯¦è§£ ï¼šhttps://zhuanlan.zhihu.com/p/365412262<a href="#fnref:4" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++è¿›é˜¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++è¿›é˜¶ </tag>
            
            <tag> å¿«é€Ÿå…¥é—¨ </tag>
            
            <tag> é¢å¯¹å¯¹è±¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŠ¡å®åŸºç¡€ï¼ˆä¸‹ï¼‰å¤åˆç±»å‹åŠè½¬æ¢</title>
      <link href="/p/6587/"/>
      <url>/p/6587/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><h2 id="å››ã€å¤åˆç±»å‹åŠè½¬æ¢">å››ã€å¤åˆç±»å‹åŠè½¬æ¢</h2><p><strong>ä»€ä¹ˆæ˜¯å¤åˆç±»å‹ï¼Ÿè¿™å¬èµ·æ¥å¥½åƒæ˜¯æœ‰ç‚¹æ–°å¥‡çš„æ¦‚å¿µ</strong>ã€‚</p><p><u>ä»åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚<code>int</code>ã€<code>char</code>ï¼‰æˆ–å…¶ä»–å¤åˆæ•°æ®ç±»å‹æ„é€ å‡ºæ¥</u>çš„æ•°æ®ç±»å‹ï¼Œå°±ç§°ä¸ºå¤åˆç±»å‹ã€‚</p><p>åœ¨å‰é¢æˆ‘ä»¬å·²ç»æ¥è§¦è¿‡æ‰€è°“çš„å¤åˆç±»å‹ï¼š</p><ul><li><p>æ•°ç»„ï¼ˆ<code>std::string</code>ã€<code>std::array</code> ç­‰ï¼‰ã€æŒ‡é’ˆç±»å‹ï¼ˆå‡½æ•°æŒ‡é’ˆæˆ–è€…è¯´å‡½æ•°ï¼ŒæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆç­‰ï¼‰ã€å¼•ç”¨ç±»å‹ã€‚</p></li><li><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢å‡½æ•°<code>func</code> ç±»å‹æ˜¯<code>void()(int, double)</code> ï¼Œå®ƒç”±åŸºæœ¬ç±»å‹ç»„æˆï¼Œä½¿å…¶æˆä¸ºå¤åˆç±»å‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">double</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æœ¬ç« ä¸»è¦ä»‹ç»çš„å¤åˆç±»å‹æ˜¯ï¼šç»“æ„ä½“å’Œæšä¸¾ï¼Œå„ç§ç±»å‹ä¹‹é—´çš„è½¬æ¢ä¼šåœ¨åé¢ä»‹ç»ã€‚</p><h3 id="4-1-ç»“æ„ä½“">4.1 ç»“æ„ä½“</h3><h4 id="4-1-1-ä»Cè°ˆèµ·">4.1.1 ä»Cè°ˆèµ·</h4><p>åœ¨Cè¯­è¨€ä¸­å®šä¹‰ä¸€ä¸ªå…¸å‹ç»“æ„ä½“<code>struct</code>å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. å®šä¹‰</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">People</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">char</span> gender[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;; <span class="comment">// *è¿™é‡Œæœ‰ä¸ªåˆ†å·ï¼Œæ˜“é—æ¼</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 2.å£°æ˜&amp;åˆå§‹åŒ–ï¼Œç»“åˆ&#123;&#125;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">People</span> <span class="title">people</span> =</span> &#123;<span class="string">&quot;royhuang&quot;</span>,<span class="string">&quot;male&quot;</span>,<span class="number">25</span>&#125;; </span><br><span class="line">    <span class="comment">// 3.è®¿é—®ï¼ŒC/C++ä¸­ç»“æ„ä½“æˆå‘˜é»˜è®¤éƒ½æ˜¯publicå¯ä»¥ç›´æ¥è®¿é—®</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your name: %s \n&quot;</span>,people.name); <span class="comment">// royhuang</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ—¶è¿˜æ˜¯æ–°æ‰‹Cç©å®¶çš„æˆ‘ï¼Œå¾ˆéš¾è¯´å‡º<code>struct</code>åˆ°åº•å¸¦æ¥ä»€ä¹ˆå¥½å¤„ã€‚åªèƒ½éšéšçº¦çº¦æ„Ÿè§‰åˆ°ï¼Œ<code>struct</code>ç»„åˆ<u>å¤šä¸ª</u>ä¸”æœ‰<u>é€»è¾‘å…³è”</u>çš„æ•°æ®<u>å¢å¼ºäº†ç¨‹åºé€»è¾‘æ€§å’Œå¯è¯»æ€§</u>ã€‚</p><p><strong>é‚£ä¹ˆ<code>struct</code> é™¤äº†ç»„ç»‡æœ‰é€»è¾‘å…³è”çš„æ•°æ®æé«˜ä»£ç å¯è¯»æ€§å’Œä¸€è‡´æ€§ï¼Œåœ¨å®é™…ç¼–ç ä¸­è¿˜æœ‰å…¶å®ƒåº”ç”¨å—</strong>ï¼Ÿ</p><p>åœ¨ç¬¬ä¸‰ç« å‡½æ•°ï¼Œæˆ‘ä»¬æåˆ°è¿‡ï¼šç»“æ„ä½“è¿˜å¯ç”¨äº<u>å‡½æ•°ä¼ é€’å¤šä¸ªå‚æ•°</u>æˆ–è€…<u>å‡½æ•°è¿”å›å¤šä¸ªå€¼</u>ã€‚</p><ul><li><p><strong>ä¼ é€’å¤šä¸ªå‚æ•°</strong></p><p>ä¼ é€’ä¸€ä¸ªç»“æ„ä½“ä½œä¸ºå‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printPeople</span><span class="params">(<span class="keyword">const</span> struct People&amp; people)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your name: %s \n&quot;</span>,people.name);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your gender: %s \n&quot;</span>,people.gender);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;your age: %d \n&quot;</span>,people.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">People</span> <span class="title">people</span> =</span> &#123;<span class="string">&quot;royhuang&quot;</span>,<span class="string">&quot;male&quot;</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    <span class="built_in">printPeople</span>(people);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶è¿™ç›¸æ¯”ä¼ é€’å¤šä¸ªå‚æ•°è¦æ¸…çˆ½å¾ˆå¤šï¼ˆä¸”ä¸æ˜“å‡ºé”™ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printPeople</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">const</span> <span class="keyword">char</span>* gender, <span class="keyword">const</span> <span class="keyword">int</span> age)</span></span></span><br></pre></td></tr></table></figure></li><li><p><strong>è¿”å›å¤šä¸ªå€¼</strong></p><p>å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå‚æ•°ï¼Œé™¤äº†ä½¿ç”¨å…ƒç»„ï¼Œç»“æ„ä½“æ˜¯ä¸äºŒçš„é€‰æ‹©ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct People&amp; <span class="title">cleanPeople</span><span class="params">(People&amp; people)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    people.name=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    people.gender=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    people.age=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> people;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-1-2-C-ä¸­struct">4.1.2 C++ä¸­struct</h4><p>C++ä¸­structå…¼å®¹äº†Cï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿˜è¿›è¡Œäº†æ‰©å±•ï¼š</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">C</th><th style="text-align:center">C++</th></tr></thead><tbody><tr><td style="text-align:center">æˆå‘˜</td><td style="text-align:center">åªæœ‰æ•°æ®</td><td style="text-align:center">æ•°æ®ï¼Œå‡½æ•°ç­‰éƒ½å¯ä»¥</td></tr><tr><td style="text-align:center">è®¿é—®æƒé™</td><td style="text-align:center">public</td><td style="text-align:center">é»˜è®¤publicï¼Œæœ‰private</td></tr><tr><td style="text-align:center">æ˜¯å¦å¯ä»¥ç»§æ‰¿</td><td style="text-align:center">å¦</td><td style="text-align:center">æ˜¯</td></tr></tbody></table><ol><li><p>åœ¨Cä¸­ç»“æ„ä½“å£°æ˜å¿…é¡»å¸¦ä¸Š<code>struct</code> å…³é”®å­—ï¼Œè€ŒC++ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">People</span> <span class="title">people1</span>;</span> <span class="comment">// C</span></span><br><span class="line">People people1; <span class="comment">// C++</span></span><br></pre></td></tr></table></figure></li><li><p>C++ä¸­ï¼Œstructå¢åŠ äº†privateè®¿é—®æƒé™ï¼Œä¸”å¯ä»¥å’Œç±»ä¸€æ ·æœ‰æˆå‘˜å‡½æ•°ï¼Œæˆå‘˜é»˜è®¤è®¿é—®è¯´æ˜ç¬¦ä¸ºpublicï¼ˆä¸ºäº†å…¼å®¹Cï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">People</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">     </span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">char</span> gender[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">People</span>(<span class="keyword">const</span> <span class="keyword">char</span>* peole_name,<span class="keyword">const</span> <span class="keyword">char</span>* peole_gender,<span class="keyword">int</span> peole_age)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strncpy</span>(name,peole_name,<span class="number">10</span>);</span><br><span class="line">        <span class="built_in">strncpy</span>(gender,peole_gender,<span class="number">5</span>);</span><br><span class="line">        age = peole_age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printPeople</span><span class="params">(<span class="keyword">const</span> People&amp; people)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;your name:&quot;</span> &lt;&lt;people.name&lt;&lt;std::endl;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;your gender: &quot;</span>&lt;&lt;people.gender&lt;&lt;std::endl;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;your age: &quot;</span>&lt;&lt;people.age&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç§æœ‰å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span>: </span><br><span class="line">        <span class="keyword">char</span> girl_friend[<span class="number">10</span>];</span><br><span class="line">&#125;; <span class="comment">// åˆ†å·</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    People people = &#123;<span class="string">&quot;royhuang&quot;</span>,<span class="string">&quot;male&quot;</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    people.<span class="built_in">printPeople</span>(people);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥ç»§æ‰¿ï¼Œå®ç°äº†å¤šæ€ã€‚</p></li></ol><p>æ˜¾ç„¶ï¼ŒC++ä¸­structå’ŒclassåŒºåˆ«å·²ç»ä¸å¤§ã€‚</p><h4 id="4-1-3-ç»“æ„ä½“å¤§å°å’Œæ¯”è¾ƒ">4.1.3 ç»“æ„ä½“å¤§å°å’Œæ¯”è¾ƒ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/liuweiyuxiang/article/details/85997084">c++ä¸­çš„sizeof()è¿ç®—ç¬¦</a>ã€<a href="https://caohuilong.github.io/2019/03/12/C-%E4%B8%ADsizeof%E7%9A%84%E7%94%A8%E6%B3%95%E6%80%BB%E7%BB%93/">C/C++ä¸­ sizeof çš„ç”¨æ³•æ€»ç»“</a></p></blockquote><p><strong>ä»åŸºæœ¬æ•°æ®ç±»å‹è¯´èµ·</strong>ã€‚</p><p>å¯¹äºshortã€intã€longç®€å•å†…ç½®æ•°æ®ç±»å‹ï¼Œå¯é‡‡ç”¨<code>sizeof</code> å…³é”®å­—è®¡ç®—å¤§å°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i;  </span><br><span class="line"><span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>); <span class="comment">// å€¼ä¸º4  </span></span><br><span class="line"><span class="built_in"><span class="keyword">sizeof</span></span>(i);   <span class="comment">// å€¼ä¸º4ï¼Œç­‰ä»·äºsizeof(int)  </span></span><br><span class="line"><span class="keyword">sizeof</span> i;    <span class="comment">// å€¼ä¸º4  </span></span><br><span class="line"><span class="built_in"><span class="keyword">sizeof</span></span>(<span class="number">2</span>);   <span class="comment">// å€¼ä¸º4ï¼Œç­‰ä»·äºsizeof(int)ï¼Œå› ä¸º2çš„ç±»å‹ä¸ºint  </span></span><br><span class="line"><span class="built_in"><span class="keyword">sizeof</span></span>(<span class="number">2</span> + <span class="number">3.14</span>); <span class="comment">// å€¼ä¸º8ï¼Œç­‰ä»·äºsizeof(double)ï¼Œå› ä¸ºæ­¤è¡¨è¾¾å¼çš„ç»“æœçš„ç±»å‹ä¸ºdouble  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> ary[<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>) * <span class="number">10</span>]; <span class="comment">// OKï¼Œç¼–è¯‘æ— è¯¯</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>sizeofå’Œstrlençš„åŒºåˆ«</strong>ï¼Ÿ</p><ul><li><strong>è¿ç®—ç¬¦ä¸å‡½æ•°</strong>ï¼šsizeofæ˜¯è¿ç®—ç¬¦ï¼Œå¹¶ä¸æ˜¯å‡½æ•°ï¼Œç»“æœåœ¨ç¼–è¯‘æ—¶å¾—åˆ°è€Œéè¿è¡Œä¸­è·å¾—ï¼›strlenæ˜¯å­—ç¬¦å¤„ç†çš„åº“å‡½æ•°ã€‚</li><li><strong>å‚æ•°ç±»å‹</strong>ï¼šsizeofå‚æ•°å¯ä»¥æ˜¯ä»»ä½•æ•°æ®çš„ç±»å‹æˆ–è€…æ•°æ®ï¼ˆsizeofå‚æ•°ä¸é€€åŒ–ï¼‰ï¼›<u>strlençš„å‚æ•°åªèƒ½æ˜¯å­—ç¬¦æŒ‡é’ˆä¸”ç»“å°¾æ˜¯â€™\0â€™çš„å­—ç¬¦ä¸²</u>ã€‚</li><li><strong>å€¼ç¡®å®šæ—¶æœº</strong>ï¼šsizeofå€¼åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ¥å¾—åˆ°åŠ¨æ€åˆ†é…ï¼ˆè¿è¡Œæ—¶åˆ†é…ï¼‰å­˜å‚¨ç©ºé—´çš„å¤§å°ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">char</span>* str = <span class="string">&quot;name&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="built_in"><span class="keyword">sizeof</span></span>(str); <span class="comment">// å–çš„æ˜¯æŒ‡é’ˆstrçš„é•¿åº¦ï¼Œæ˜¯8</span></span><br><span class="line">      <span class="built_in">strlen</span>(str); <span class="comment">// å–çš„æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä¸åŒ…å«ç»“å°¾çš„ \0ã€‚å¤§å°æ˜¯4</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></blockquote><p>æ³¨æ„ï¼Œ<strong>åŸºæœ¬æ•°æ®ç±»å‹çš„å†…å­˜å¤§å°æ˜¯å’Œç³»ç»Ÿç›¸å…³çš„</strong>ï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„ç³»ç»Ÿä¸‹å–å€¼å¯èƒ½ä¸åŒã€‚æ¯”å¦‚ï¼Œlong ç±»å‹ä¸æŒ‡é’ˆç±»å‹åœ¨ 32 ä½æœºå™¨ä¸Šåªå  4 å­—èŠ‚ï¼Œåœ¨ 64 ä½æœºå™¨ä¸Šå  8 å­—èŠ‚ã€‚</p><p>æœ¬èŠ‚å‡å‡è®¾<strong>æŒ‰4å­—èŠ‚å¯¹é½</strong>ï¼ˆintåœ¨32ä½/64ä½éƒ½å 4å­—èŠ‚ï¼‰ ã€‚</p><h5 id="sizeof-è®¡ç®—ç»“æ„ä½“å¤§å°">sizeof è®¡ç®—ç»“æ„ä½“å¤§å°</h5><p>ç»“æ„ä½“çš„sizeofä¸ºäº†æé«˜å­˜å–æ•ˆç‡ï¼Œæ¶‰åŠåˆ°å­—èŠ‚<strong>å¯¹é½</strong>é—®é¢˜ã€‚</p><p>å…¶å¯¹é½è§„åˆ™å¦‚ä¸‹:</p><ol><li><strong>é¡ºåºå­˜å‚¨</strong>ï¼šåˆ†é…å†…å­˜çš„é¡ºåºæ˜¯æŒ‰ç…§å£°æ˜çš„é¡ºåºè¿›è¡Œ<strong>é¡ºåºå­˜å‚¨</strong>ï¼›</li><li><strong>åç§»é‡</strong>ï¼šæ¯ä¸ªå˜é‡ç›¸å¯¹äºèµ·å§‹ä½ç½®çš„åç§»é‡ï¼Œå¿…é¡»æ˜¯<strong>è¯¥å˜é‡ç±»å‹å¤§å°çš„æ•´æ•°å€</strong>ï¼Œä¸æ˜¯æ•´æ•°å€ç©ºå‡ºå†…å­˜ï¼Œç›´åˆ°åç§»é‡æ˜¯æ•´æ•°å€ä¸ºæ­¢ï¼›</li><li><strong>æ•´ä½“å¤§å°</strong>ï¼šæœ€åæ•´ä¸ªç»“æ„ä½“çš„å¤§å°å¿…é¡»æ˜¯ï¼Œ<strong>å˜é‡ç±»å‹æœ€å¤§å€¼çš„æ•´æ•°å€</strong>ã€‚</li></ol><p>ä»¥ä¸‹å®ä¾‹è¯´æ˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> a;</span><br><span class="line">    <span class="keyword">double</span> b;</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(A) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š24ï¼Œè€Œä¸æ˜¯1+8+4=13ã€‚è¿™æ˜¯å› ä¸º ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211223175820728.png" alt="image-20211223175820728"></p><ol><li>char a çš„åç§»é‡ä¸º 0ï¼Œå ç”¨ 1Byteï¼›</li><li>double b æŒ‡çš„ä¸‹ä¸€ä¸ªå¯ç”¨çš„åœ°å€çš„åç§»é‡ä¸º 1ï¼Œä¸æ˜¯ sizeof(double)=8 çš„æ•´æ•°å€ï¼Œéœ€è¦è¡¥è¶³ 7Byte æ‰èƒ½æ˜¯åç§»é‡ä¸º 8ï¼›</li><li>int c æŒ‡çš„ä¸‹ä¸€ä¸ªå¯ç”¨çš„åœ°å€çš„åç§»é‡ä¸º 16ï¼Œæ˜¯ sizeof(int)=4 çš„æ•´æ•°å€ï¼Œæ»¡è¶³ int çš„å¯¹é½æ–¹å¼ï¼›</li><li>ç»“æ„ä½“å¤§å°å¿…é¡»æ˜¯æœ€å¤§æˆå‘˜å¤§å°çš„æ•´æ•°å€ï¼Œï¼ˆå³ç»“æ„ä¸­å ç”¨æœ€å¤§ç©ºé—´çš„ç±»å‹æ‰€å ç”¨çš„å­—èŠ‚æ•° sizeof(double)=8ï¼‰çš„å€æ•°ï¼Œæ‰€ä»¥æœ€åè¿˜éœ€å¡«å……4byteã€‚</li></ol><p><strong>åµŒå¥—ç»“æ„ä½“å’Œunioå…±ç”¨ä½“å¯¹é½è§„åˆ™åˆæœ‰æ‰€ä¸åŒ</strong>ã€‚</p><ul><li><p><strong>åµŒå¥—ç»“æ„ä½“</strong></p><p>å¯¹äºåµŒå¥—çš„ç»“æ„ä½“ï¼Œéœ€è¦å°†å…¶å±•å¼€ã€‚å¯¹åµŒå¥—ç»“æ„ä½“æ±‚ sizeof æ—¶ï¼Œä¸Šè¿°åŸåˆ™å˜ä¸ºï¼š</p><ol><li>å±•å¼€åçš„ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜çš„<strong>åç§»é‡</strong>åº”å½“æ˜¯è¢«å±•å¼€çš„ç»“æ„ä½“ä¸­<strong>æœ€å¤§</strong>ï¼ˆéåµŒå¥—ä¸è¦æ±‚æœ€å¤§ï¼‰çš„æˆå‘˜çš„æ•´æ•°å€ã€‚</li><li>ç»“æ„ä½“å¤§å°å¿…é¡»æ˜¯<strong>æœ€å¤§æˆå‘˜å¤§å°çš„æ•´æ•°å€</strong>ï¼Œè¿™é‡Œæ‰€æœ‰æˆå‘˜è®¡ç®—çš„æ˜¯å±•å¼€åçš„æˆå‘˜ï¼Œè€Œä¸æ˜¯å°†åµŒå¥—çš„ç»“æ„ä½“å½“åšä¸€ä¸ªæ•´ä½“ã€‚</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> a;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">char</span> b;</span><br><span class="line">        <span class="keyword">int</span> c;</span><br><span class="line">    &#125; ss;</span><br><span class="line">    <span class="keyword">short</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(B) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ä»£ç è¾“å‡ºï¼š16ã€‚åˆ†æè¿‡ç¨‹åŒå‰ï¼Œè¿™é‡Œåªç»™å‡ºå›¾ç¤ºã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211223180812242.png" alt="image-20211223180812242"></p></li><li><p><strong>Unioå…±ç”¨ä½“</strong></p><p>union ä¸­å˜é‡å…±ç”¨å†…å­˜ï¼ŒåŸåˆ™å¦‚ä¸‹ï¼š</p><ol><li>å†…å­˜å¤§å°åº”ä»¥æœ€é•¿çš„ä¸ºå‡†ï¼›</li><li>æ»¡è¶³ä¸Šè¿°æ¡ä»¶ä¸‹ï¼Œè¿˜åº”æ˜¯æœ€é•¿æˆå‘˜çš„æ•´æ•°å€å¤§å°ã€‚</li></ol><p>ä¾‹å¦‚ï¼Œä¸‹é¢ä¾‹å­è¾“å‡ºå…±ç”¨ä½“å¤§å°ä¸ºï¼š<strong>24</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">C</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">5</span>];  <span class="comment">// æ•°ç»„å¤§å°=æˆå‘˜*é•¿åº¦=5*4=20</span></span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">    <span class="keyword">double</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æœ€åè¾“å‡ºè¡¥è¶³4byteï¼Œæ»¡è¶³æ˜¯double(8å­—èŠ‚)æ•´æ•°å€</span></span><br><span class="line">   cout &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(C) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ï¼Œè¯·æ€è€ƒï¼š</p><ul><li><strong>å°†å…±ç”¨ä½“å†…çš„ int a[5] ä¿®æ”¹æˆ int a[6] åï¼Œç»“æœä»ç„¶ä¸å˜ï¼›ä½†å¦‚æœå°† int a[5] ä¿®æ”¹æˆ int a[7]ï¼Œç»“æœå°±å˜æˆ 32</strong>ï¼Ÿ</li></ul><p>ä½ å¯åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„è§è§£ã€‚</p></li></ul><h5 id="æ‰©å±•ï¼šsizeofè®¡ç®—ç±»å¯¹è±¡å¤§å°">æ‰©å±•ï¼šsizeofè®¡ç®—ç±»å¯¹è±¡å¤§å°</h5><p>å…³äºç±»å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li><p><strong>è™šå‡½æ•°</strong>ï¼šç¼–è¯‘å™¨éœ€è¦ä¸ºç±»æ„å»ºè™šå‡½æ•°è¡¨ï¼Œç±»<strong>ä¸­éœ€è¦å­˜å‚¨ä¸€ä¸ªæŒ‡é’ˆ</strong>æŒ‡å‘è¿™ä¸ªè™šå‡½æ•°è¡¨çš„é¦–åœ°å€ã€‚</p><p><strong>æ³¨æ„ä¸ç®¡æœ‰å‡ ä¸ªè™šå‡½æ•°ï¼Œéƒ½åªå»ºç«‹ä¸€å¼ è¡¨</strong>ï¼Œæ‰€æœ‰çš„è™šå‡½æ•°åœ°å€éƒ½å­˜åœ¨è¿™å¼ è¡¨é‡Œï¼Œç±»ä¸­åªéœ€è¦ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è™šå‡½æ•°è¡¨é¦–åœ°å€å³å¯ã€‚</p></li><li><p><strong>é™æ€æˆå‘˜</strong>ï¼šè¢«ç±»æ‰€æœ‰å®ä¾‹æ‰€å…±äº«çš„ï¼Œå®ƒ<strong>ä¸è®¡å…¥</strong>sizeofè®¡ç®—çš„ç©ºé—´ã€‚</p></li><li><p><strong>æ™®é€šå‡½æ•°æˆ–é™æ€å‡½æ•°</strong>ï¼šéƒ½å­˜å‚¨åœ¨æ ˆä¸­ï¼Œä¸è®¡å…¥sizeofè®¡ç®—çš„ç©ºé—´ã€‚</p></li><li><p><strong>ç±»æˆå‘˜</strong>ï¼šé‡‡ç”¨å­—èŠ‚å¯¹é½çš„æ–¹å¼åˆ†é…ç©ºé—´ï¼›</p></li></ol><p>ä»¥ä¸‹ä¸ºå®ä¾‹è¯´æ˜ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// è™šå‡½æ•°ï¼šéœ€è¦ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è™šå‡½æ•°è¡¨</span></span><br><span class="line">        <span class="comment">// 32ä½ç³»ç»ŸæŒ‡é’ˆå¤§å°ä¸º 4Byteï¼Œ64ä½ç³»ç»ŸæŒ‡é’ˆå¤§å°ä¸º 8Byte</span></span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">funa</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">funb</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">// æ™®é€šå‡½æ•°æˆ–é™æ€å‡½æ•°æˆ–é™æ€æˆå‘˜ï¼šä¸è®¡å…¥</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fund</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> si; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="comment">// charå 1å­—èŠ‚</span></span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="comment">// inté¦–å…ˆè¦åç§»3å­—èŠ‚ï¼Œæ˜¯sizeof(int)æ•´æ•°å€</span></span><br><span class="line">        <span class="comment">// intæœ¬èº«å 4å­—èŠ‚</span></span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// æœ€åæ€»å¤§å°ä¸ºï¼šæŒ‡é’ˆå¤§å°+1+3+4 = 12 OR 16</span></span><br><span class="line">   cout &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(D) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¾“å‡ºä¸ºï¼š12ï¼ˆ32ä½ç³»ç»Ÿï¼‰æˆ–è€…16ï¼ˆ64ä½ç³»ç»Ÿï¼‰ã€‚å…·ä½“å ç”¨è¯·æŸ¥çœ‹ä»£ç ä¸­æ³¨é‡Šã€‚</p><p><strong>ç±»æˆå‘˜å¯¹é½æ–¹å¼å’Œç»“æ„ä½“æœ‰æ‰€ä¸åŒ</strong>ï¼Œæœªå°½ç»†èŠ‚å°†åœ¨æœªæ¥è¡¥å……ã€‚</p><h5 id="ç©ºç±»-ç»“æ„ä½“å¤§å°">ç©ºç±»/ç»“æ„ä½“å¤§å°</h5><blockquote><p>æ€è€ƒæºè‡ªäºï¼š<a href="https://www.zhihu.com/question/266041176">ç©ºç±»çš„å¤§å°ä¸ºä»€ä¹ˆæ˜¯1ï¼Ÿ</a></p></blockquote><p>ç»è¿‡å®è·µï¼Œæ— è®ºæ˜¯ç©ºç±»è¿˜æ˜¯ç©ºç»“æ„ä½“ï¼Œå…¶å¤§å°<strong>å‡ä¸º1è€Œä¸æ˜¯0</strong>ã€‚</p><p>çœ‹äº†ä¸€ä¸‹æ¯”è¾ƒä¿¡æœçš„è§£ç­”æ˜¯ï¼š</p><ul><li><p>å¦‚æœé•¿åº¦æ˜¯0ï¼Œé‚£ä¹ˆæŠŠä»–å¡ç»™ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡åˆ°å“ªé‡Œå‘¢ï¼Ÿä¸è€ƒè™‘æŒ‡é’ˆï¼Œè¿™ä¸ªç±»è‡ªå·±å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿå¦‚æœæˆ‘ä¸€ä¸‹å­ç”³æ˜100ä¸‡ä¸ªå®ä¾‹ï¼Œéƒ½ä¸å ç”¨å†…å­˜å—ï¼Ÿ</p></li><li><p>c++ ä¸­è§„å®š<strong>ä¸åŒçš„å¯¹è±¡å¿…é¡»æ‹¥æœ‰ä¸åŒçš„åœ°å€</strong>ï¼Œå¦‚æœä¸º0ä¼šå¯¼è‡´ä¸¤ä¸ªç©ºç±»çš„åœ°å€ä¸€æ ·ã€‚</p><blockquote><p>ä½†æ˜¯ä¸ºå•¥ç©ºç±»ä¸€å®šè¦æœ‰ä¸åŒçš„åœ°å€æ¥å»åŒºåˆ†ä¸åŒçš„å¯¹è±¡ï¼Ÿ</p></blockquote></li></ul><h5 id="ç»“æ„ä½“æ¯”è¾ƒ">ç»“æ„ä½“æ¯”è¾ƒ</h5><p>C++ç»“æ„ä½“ç›´æ¥è¿›è¡Œæ¯”è¾ƒä¼šå‡ºé”™ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">float</span> b;</span><br><span class="line">    <span class="keyword">char</span>* c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    A a&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">4</span>]&#123;<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;h&#x27;</span>&#125;&#125;;</span><br><span class="line">    A b&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">4</span>]&#123;<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;h&#x27;</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(a==b)</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;equal&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;not equal&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]# g++ -std=c++11 test.cpp -o test.out</span><br><span class="line">test.cpp: In function â€˜int main()â€™:</span><br><span class="line">test.cpp:21:9: error: no match for â€˜operator==â€™ (operand types are â€˜Aâ€™ and â€˜Aâ€™)</span><br><span class="line">     if(a==b)</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ç§åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><ol><li><p>ç»“æ„ä½“ <code>a</code> å’Œ <code>b</code> æ¯ä¸ªå…ƒç´ é€ä¸ªæ¯”è¾ƒï¼ŒæŒ‡é’ˆæ¯”è¾ƒå®ƒä»¬çš„åœ°å€ã€‚</p></li><li><p>è‡ªå·±é‡è½½æ“ä½œç¬¦<code>==</code> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">float</span> b;</span><br><span class="line">    <span class="keyword">char</span>* c;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>== (<span class="keyword">const</span> A&amp; other) <span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">bool</span> a_is_equal = (a==other.a);</span><br><span class="line">        <span class="keyword">bool</span> b_is_equal = (b==other.b);</span><br><span class="line">        <span class="keyword">bool</span> c_is_equal = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ; i&lt;<span class="number">3</span> ; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(c[i] != other.c[i])</span><br><span class="line">            &#123;</span><br><span class="line">                c_is_equal =<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a_is_equal &amp;&amp; b_is_equal &amp;&amp; c_is_equal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    A a&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">4</span>]&#123;<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;h&#x27;</span>&#125;&#125;;</span><br><span class="line">    A b&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">4</span>]&#123;<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;h&#x27;</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">if</span>(a==b)</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;equal&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;not equal&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]# ./test.out </span><br><span class="line">equal</span><br></pre></td></tr></table></figure></li></ol><h4 id="4-1-4-æ‰©å±•é˜…è¯»ï¼šä¸ºä»€ä¹ˆC-è¿˜ä¿ç•™structï¼Ÿ">4.1.4 æ‰©å±•é˜…è¯»ï¼šä¸ºä»€ä¹ˆC++è¿˜ä¿ç•™structï¼Ÿ</h4><p>åœ¨C++ä¸­ï¼Œé™¤äº†é»˜è®¤è®¿é—®æ§åˆ¶ç¬¦ã€æ¨¡æ¿å‚æ•°ï¼Œstructå’ŒclassåŸºæœ¬å®Œå…¨ä¸€è‡´ï¼Œstructå­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Œå…¨ç”¨classä¸å¥½å—ï¼Ÿ</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">struct</th><th style="text-align:center">class</th></tr></thead><tbody><tr><td style="text-align:center">ç»§æ‰¿é»˜è®¤æƒé™</td><td style="text-align:center">structé»˜è®¤æ˜¯public</td><td style="text-align:center">classé»˜è®¤æ˜¯private</td></tr><tr><td style="text-align:center">æ¨¡æ¿å‚æ•°</td><td style="text-align:center">ä¸å¯ä»¥</td><td style="text-align:center">å¯ä»¥</td></tr></tbody></table><p>è¿™é‡Œé¢çš„åŸå› ä¸»è¦æ˜¯ï¼š</p><ol><li><strong>å†å²åŒ…è¢±</strong>ã€‚ç»™ C è¯­è¨€ç¨‹åºå¼€å‘äººå‘˜æœ‰ä¸€ä¸ªå½’å±æ„Ÿï¼›</li><li><strong>å…¼å®¹</strong> ã€‚è®© C++ ç¼–è¯‘å™¨å…¼å®¹ä»¥å‰ç”¨ C è¯­è¨€å¼€å‘å‡ºæ¥çš„é¡¹ç›®ï¼Œæ¯”å¦‚ç³»ç»Ÿåº“<code>stdlib.h</code> ç­‰ã€‚</li></ol><h3 id="4-2-æšä¸¾">4.2 æšä¸¾</h3><h4 id="4-2-1-æšä¸¾åˆè¯†">4.2.1 æšä¸¾åˆè¯†</h4><p>å’Œç»“æ„ä½“ç±»ä¼¼ï¼Œæšä¸¾ä¹Ÿæ˜¯ç»„ç»‡äº†<u>æœ‰é€»è¾‘å…³ç³»çš„æ•°æ®</u>ï¼Œä¸è¿‡æšä¸¾ï¼š</p><ul><li>æ•°æ®åªèƒ½æ˜¯åŒç±»å‹ï¼ˆæˆ‘ä»¬å®šä¹‰çš„æšä¸¾ç±»å‹ï¼‰ï¼›</li><li>ç›¸æ¯”struct/classï¼Œæšä¸¾enumæ›´åƒæ˜¯ä¸€ç§å¼±ç»„ç»‡ç±»å‹ï¼Œå¦‚æœä½ æœ‰ä¸€ç»„ç›¸å…³çš„å¸¸é‡æœ€å¥½ä½¿ç”¨æšä¸¾ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­å§ï¼Œç”¨æšä¸¾ç»„åˆä¸‰å…ƒè‰²ï¼ˆå¸¸é‡ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Color</span>  // æœ€ä½³å®è·µï¼šé¦–å­—æ¯å¤§å†™</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    red,</span><br><span class="line">    blue,</span><br><span class="line">    green,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Color paint = red;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”ç”¨0ã€1ã€2åˆ†åˆ«å®šä¹‰ä¸‰å…ƒè‰²ï¼Œä»£ç å¯è¯»æ€§æé«˜äº†å¾ˆå¤šã€‚</p><h5 id="æšä¸¾æ˜¯æ•´æ•°ç¬¦å·å¸¸é‡">æšä¸¾æ˜¯æ•´æ•°ç¬¦å·å¸¸é‡</h5><p><strong>æšä¸¾åˆ°åº•ä»€ä¹ˆ</strong>ï¼Ÿ</p><p>å¥½å§ï¼Œæ ‡é¢˜å·²ç»å‡ºå–äº†ç­”æ¡ˆï¼š<strong>æšä¸¾å…¶å®å°±æ˜¯æ•´æ•°ç¬¦å·å¸¸é‡ï¼ˆé»˜è®¤æ˜¯int</strong>ï¼‰ã€‚</p><p>å’Œ<code>char</code> æƒ…å†µæœ‰ç‚¹ç±»ä¼¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> c = <span class="string">&#x27;A&#x27;</span>;</span><br></pre></td></tr></table></figure><p>char å®é™…ä¸Šå­˜å‚¨çš„æ˜¯ä¸€ä¸ª 1 å­—èŠ‚çš„æ•´æ•°å€¼ï¼Œå³å­—ç¬¦<code>'A'</code>è¢«è½¬æ¢ä¸ºæ•´æ•°å€¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º<code>65</code>ï¼‰å¹¶å­˜å‚¨ã€‚</p><p>åªä¸è¿‡æ‰“å°<code>cout</code>ç±»å¯¹<code>&lt;&lt;</code>è¿›è¡Œäº†é‡è½½ï¼Œç›´æ¥æ‰“å°<code>c</code> å‡ºæ¥çš„æ˜¯<code>'A'</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::cout&lt;&lt;c;  <span class="comment">// A</span></span><br></pre></td></tr></table></figure><p>å›åˆ°æšä¸¾<code>enum</code> ï¼š</p><ul><li>æšä¸¾ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªæ•´æ•°å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªæšä¸¾å™¨è¢«åˆ†é…æ•´æ•°å€¼<code>0</code>ï¼Œæ¯ä¸ªåç»­æšä¸¾å™¨çš„å€¼éƒ½æ¯”å‰ä¸€ä¸ª<code>+1</code>ï¼›</li><li>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æšä¸¾å€¼ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Animal</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    cat = <span class="number">-3</span>,</span><br><span class="line">    dog,         <span class="comment">// -2</span></span><br><span class="line">    pig,         <span class="comment">// -1</span></span><br><span class="line">    horse = <span class="number">5</span>,</span><br><span class="line">    giraffe,     <span class="comment">// 6</span></span><br><span class="line">    chicken      <span class="comment">// 7</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Animal animal = dog;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ä½ çš„å® ç‰©æ˜¯ï¼š&quot;</span> &lt;&lt; animal;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½ çš„å® ç‰©æ˜¯ï¼š-2</span><br></pre></td></tr></table></figure><p><strong>å¥½å§ä½ çš„å® ç‰©æ˜¯<code>-2</code>ï¼Œç¼–è¯‘å™¨éšå¼å°†æšä¸¾è½¬æ¢ä¸ºäº†æ•´æ•°ï¼ˆå¹¶æ²¡æœ‰åƒcharä¸€æ ·æ‰“å°å­—ç¬¦ï¼Œstd::coutæ²¡æœ‰å¯¹æšä¸¾ç±»å‹Animalè¿›è¡Œé‡è½½</strong>ï¼‰ã€‚</p><p>ä¸è¿‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šå°†æ•´æ•°éšå¼è½¬æ¢ä¸ºæšä¸¾æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Animal animal = <span class="number">-2</span>;  <span class="comment">// error</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ˜¾å¼è½¬æ¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Animal animal = <span class="keyword">static_cast</span>&lt;Animal&gt;(<span class="number">-2</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä»¬éªŒè¯äº†enumçš„ä¸»è¦ç”¨æ³•å’Œç‰¹æ€§ï¼Œä½†å¯ä»¥æ›´å®Œç¾ä¸€ç‚¹ä¼˜é›…æ‰“å°æšä¸¾æ•°å—ï¼Œå°±åƒcharä¸€æ ·ï¼Ÿ</p><h5 id="ä¼˜é›…æ‰“å°æšä¸¾æ•°">ä¼˜é›…æ‰“å°æšä¸¾æ•°</h5><p>æ€ä¹ˆä¼˜é›…æ‰“å°æšä¸¾æ•°ï¼Ÿ</p><p>C++ä¸­å¹¶æ²¡æœ‰æä¾›ç›¸å…³å‡½æ•°ã€‚è¿™åªæœ‰æˆ‘ä»¬è‡ªå·±æ¥å®ç°ï¼Œ<code>if-else</code>æˆ–<code>switch</code> é€ä¸ªåˆ¤æ–­æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> std::string <span class="title">printAnimal</span><span class="params">(Animal animal)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (animal)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> cat:   <span class="keyword">return</span> <span class="string">&quot;cat&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> dog:   <span class="keyword">return</span> <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> pig:   <span class="keyword">return</span> <span class="string">&quot;pig&quot;</span>;</span><br><span class="line">        <span class="comment">// çœç•¥å…¶å®ƒçš„åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">default</span>:    <span class="keyword">return</span> <span class="string">&quot;???&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¿™éœ€è¦æ˜¾å¼è°ƒç”¨<code>printAnimal</code> æ–¹æ³•ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹ç¬¨æ‹™ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Animal animal = dog;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;ä½ çš„å® ç‰©æ˜¯ï¼š&quot;</span> &lt;&lt; <span class="built_in">printAnimal</span>(animal);</span><br></pre></td></tr></table></figure><p><strong>ç›´æ¥é‡è½½<code>std::cout</code> ç±»è¿ç®—ç¬¦<code>&lt;&lt;</code>æ˜¯æ›´å¥½çš„åšæ³•</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; out, Animal animal)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (animal)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> cat:   <span class="keyword">return</span> <span class="string">&quot;cat&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> dog:   <span class="keyword">return</span> <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> pig:   <span class="keyword">return</span> <span class="string">&quot;pig&quot;</span>;</span><br><span class="line">        <span class="comment">// çœç•¥å…¶å®ƒçš„åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">default</span>:    <span class="keyword">return</span> <span class="string">&quot;???&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°å­—ç¬¦ä¸²çœ‹èµ·æ¥èªæ˜äº†å¾ˆå¤šï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Animal animal = dog;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;ä½ çš„å® ç‰©æ˜¯ï¼š&quot;</span> &lt;&lt; animal;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½ çš„å® ç‰©æ˜¯ï¼šdog</span><br></pre></td></tr></table></figure><h5 id="è®¤è¯†æšä¸¾ä½œç”¨åŸŸ">è®¤è¯†æšä¸¾ä½œç”¨åŸŸ</h5><p><strong>æšä¸¾å†…éƒ¨æ•°æ®å’Œæšä¸¾å…·æœ‰åŒæ ·çš„ä½œç”¨èŒƒå›´ï¼Œä¹Ÿå°±æ˜¯æšä¸¾å¯¹å†…éƒ¨æ•°æ®ä½œç”¨èŒƒå›´æ— é™åˆ¶</strong>ã€‚</p><p>å›åˆ°æœ€å¼€å§‹çš„ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Color</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    red,</span><br><span class="line">    green,</span><br><span class="line">    blue, </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥å°±ä½¿ç”¨äº†red</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥é€šè¿‡å‰ç¼€Color::red</span></span><br><span class="line">    Color paint = red;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>red</code> å’Œ <code>enum Color</code> ä½œç”¨åŸŸæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯å…¨å±€ç±»å‹ã€‚</p><p>è¿™ç§è®¾ç½®ï¼Œè°ƒç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯<strong>åœ¨ä¸¤ä¸ªä¸åŒæšä¸¾ç±»å®šä¹‰ç›¸åŒçš„æ•°æ®ï¼Œä¼šä½¿å¾—å‘½ä»¤ç©ºé—´æ±¡æŸ“ï¼Œå¯¼è‡´ç¼–è¯‘é”™è¯¯</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Color</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    red,</span><br><span class="line">    green,</span><br><span class="line">    blue, <span class="comment">// blue è¡¨ç¤ºé¢œè‰²</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Feeling</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    happy,</span><br><span class="line">    tired,</span><br><span class="line">    blue, <span class="comment">// blueè¡¨ç¤ºå¿ƒæƒ…</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å†å°è¯•è°ƒç”¨ï¼Œç¼–è¯‘æ— æ³•é€šè¿‡ï¼Œä¸¤ä¸ª<code>blue</code> å†²çªï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color paint = blue; <span class="comment">//  error: redeclaration of â€˜blueâ€™</span></span><br></pre></td></tr></table></figure><p>è™½ç„¶å¯ä»¥é€šè¿‡æ˜¾å¼æŒ‡å®šå‰ç¼€é¿å…é”™è¯¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color paint = Color::blue; </span><br></pre></td></tr></table></figure><p>ä½†ç»ˆå½’æ˜¯åŸ‹ä¸‹äº†éšæ‚£ã€‚</p><p><strong>æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨å‘½åç©ºé—´<code>namespace</code> é™å®šèŒƒå›´ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒæšä¸¾ç±»å®šä¹‰ç›¸åŒçš„æ•°æ®</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> color</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Color</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        red,</span><br><span class="line">        green,</span><br><span class="line">        blue,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> feeling</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Feeling</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        happy,</span><br><span class="line">        tired,</span><br><span class="line">        blue, </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç°åœ¨å¿…é¡»åŠ ä¸Šä½œç”¨åŸŸåŒºåŸŸçš„åç§°</span></span><br><span class="line">    color::Color paint  =  color::blue ;</span><br><span class="line">    feeling::Feeling me = feeling::blue ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h5><p>ä½¿ç”¨æšä¸¾è¯·æ˜¾å¼æŒ‡æ˜æšä¸¾ç±»å‹ï¼Œæ¯”å¦‚<code>color::blue</code> è€Œéç›´æ¥ä½¿ç”¨<code>blue</code>ã€‚</p><h4 id="4-2-2-èŒƒå›´æšä¸¾">4.2.2 èŒƒå›´æšä¸¾</h4><h5 id="ä¸ºä»€ä¹ˆéœ€è¦èŒƒå›´æšä¸¾ï¼Ÿ">ä¸ºä»€ä¹ˆéœ€è¦èŒƒå›´æšä¸¾ï¼Ÿ</h5><p>éèŒƒå›´æšä¸¾çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š</p><ul><li><strong>éšå¼è½¬æ¢çš„å±å®³</strong>ã€‚éèŒƒå›´æšä¸¾ä¼šéšå¼åœ°å°†æšä¸¾ç±»å‹è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ï¼Œè¿™æœ‰æ—¶å€™ä¼šé€ æˆä¸€äº›æ„æ–™ä¹‹å¤–çš„é”™è¯¯ï¼ˆæ¯”å¦‚ä¸åŒæšä¸¾ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œä¸‹ä¸¾ä¾‹è¯´æ˜ï¼‰ï¼›</li><li><strong>éå¼ºåˆ¶è¦æ±‚å‰ç¼€</strong>ã€‚è¿™æ˜¾ç„¶å’Œæˆ‘ä»¬åˆšåˆšæåˆ°çš„æšä¸¾æœ€ä½³å®è·µä¸ç¬¦ã€‚</li></ul><p><strong>èŒƒå›´æšä¸¾</strong>çš„ç‰¹æ€§å¾ˆå¥½åœ°è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼š</p><ul><li>èŒƒå›´æšä¸¾æ˜¯<strong>å¼ºç±»å‹çš„</strong>ï¼ˆä¸ä¼šéšå¼è½¬æ¢ä¸ºæ•´æ•°ï¼‰å’Œ<strong>å¼ºä½œç”¨åŸŸçš„</strong>ï¼ˆå¿…é¡»æŒ‡å®šå‰ç¼€ï¼‰ï¼›</li><li>å…¶ä½™å’ŒéèŒƒå›´æšä¸¾æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</li></ul><h5 id="èŒƒå›´æšä¸¾åˆè¯†">èŒƒå›´æšä¸¾åˆè¯†</h5><p>èŒƒå›´æšä¸¾é€šè¿‡<code>enum class</code> å£°æ˜ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title">Color</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">     red, </span><br><span class="line">     blue,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title">Fruit</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    banana, </span><br><span class="line">    apple,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…ˆè®¤è¯†ä¸‹èŒƒå›´æšä¸¾çš„<u>å¼ºä½œç”¨åŸŸ</u>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color c = red;  <span class="comment">// errorï¼Œidentifier &quot;red&quot; is undefined</span></span><br></pre></td></tr></table></figure><p>å¿…é¡»æ˜¾å¼æŒ‡å®šä½œç”¨èŒƒå›´ï¼Œå¥‘åˆäº†æœ€ä½³å®è·µï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Color c = Color::red; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>å†æ¥è®¤è¯†èŒƒå›´æšä¸¾çš„<u>å¼ºç±»å‹</u>ï¼ˆä¸ä¼šéšå¼è½¬æ¢ï¼‰ã€‚</p><ol><li><p>æ— æ³•ç›´æ¥æ‰“å°</p><p>å› ä¸ºèŒƒå›´æšä¸¾ä¸ä¼šéšå¼è½¬æ¢ä¸º<code>int</code> ï¼Œ<code>std::cout</code> æ— æ³•ç›´æ¥æ‰“å°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; Fruit::banana;</span><br></pre></td></tr></table></figure><p>é™¤éä½ æ˜¾å¼è¿›è¡Œè½¬æ¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(Fruit::banana);</span><br></pre></td></tr></table></figure></li><li><p>ä¸èƒ½ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªä¸åŒæšä¸¾ç±»å‹</p><p>ä¸‹é¢ä»£ç ç¼–è¯‘èƒ½é€šè¿‡å—ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Color color = Color::red ; </span><br><span class="line">    Fruit fruit = Fruit::banana ; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (color == fruit) </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;colorå’Œfruitç›¸ç­‰\n&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;colorå’Œfruitä¸ç›¸ç­‰\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ— èŒƒå›´æšä¸¾ä¸Šè¿°ä»£ç ä¸ä¼šç¼–è¯‘å‡ºé”™ï¼Œç”šè‡³ä¼šæ‰“å°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colorå’Œfruitç›¸ç­‰</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>red</code>å’Œ<code>banana</code> éƒ½è¢«éšå¼è½¬æ¢ä¸º<code>int</code>ç±»å‹ï¼Œå€¼éƒ½ä¸º<code>0</code> ã€‚</p><p>ä½†å¦‚æœæ˜¯èŒƒå›´æšä¸¾ï¼Œä¸Šè¿°ä»£ç ä¼šç›´æ¥æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile error: the compiler doesn&#x27;t know how to compare different types Color and Fruit</span><br></pre></td></tr></table></figure><p>èŒƒå›´æšä¸¾ä¸ä¼šè½¬æ¢ä»»ä½•å¯ä»¥ä¸å¦ä¸€ç§ç±»å‹è¿›è¡Œæ¯”è¾ƒçš„ç±»å‹ã€‚</p><p>ä¸è¿‡ï¼Œ<strong>æ¯”è¾ƒåŒä¸€ç±»å‹æ˜¯okçš„</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Color::red == Color::blue) <span class="comment">// ok </span></span><br></pre></td></tr></table></figure></li></ol><h5 id="æœ€ä½³å®è·µ-2">æœ€ä½³å®è·µ</h5><p>è¯·å°½é‡ä½¿ç”¨èŒƒå›´æšä¸¾ï¼Œå®ƒæ›´å®‰å…¨ã€‚</p><p>è™½ç„¶åœ¨å®é™…ç¼–ç æˆ‘ä»¬è¿˜æ˜¯å¯èƒ½ä¼šä½¿ç”¨éèŒƒå›´æšä¸¾ï¼Œå› ä¸ºéèŒƒå›´æšä¸¾éšå¼è½¬æ¢å¯é¿å…å¤§é‡æ‰‹åŠ¨<code>static_casting</code> ã€‚ä½†æ˜¯ï¼Œåªæ˜¯å¶å°”çš„éœ€è¦<code>static_casting</code> ä¾¿ä¸èƒ½æ„æˆæ‹’æ¥èŒƒå›´æšä¸¾çš„ç†ç”±ã€‚</p><h3 id="4-X-ç±»å‹è½¬æ¢ğŸŒŸ">4.X ç±»å‹è½¬æ¢ğŸŒŸ</h3><p><strong>ä»€ä¹ˆæ˜¯ç±»å‹è½¬æ¢</strong>ï¼Ÿ</p><p>å°†å€¼ä»ä¸€ç§æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®ç±»å‹çš„è¿‡ç¨‹ï¼Œç§°ä¸ºç±»å‹è½¬æ¢ã€‚</p><p><strong>C++çš„ç±»å‹æœ‰å‡ ç§</strong>ï¼Ÿ</p><p>C++çš„ç±»å‹è½¬æ¢åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§ä¸ºéšå¼è½¬æ¢ï¼Œå¦ä¸€ç§ä¸ºæ˜¾å¼è½¬æ¢ï¼š</p><ul><li><strong>éšå¼è½¬æ¢</strong>ï¼šç¼–è¯‘å™¨<u>è‡ªåŠ¨</u>è¿›è¡Œçš„ç±»å‹è½¬æ¢ï¼Œå°±æ˜¯éšå¼è½¬æ¢ï¼›</li><li><strong>æ˜¾å¼è½¬æ¢</strong>ï¼šç¨‹åºå‘˜<u>æ˜¾å¼</u>ä½¿ç”¨<code>_cast</code> ç±»å‹è½¬æ¢ç¬¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå°±æ˜¯æ˜¾å¼è½¬æ¢ã€‚</li></ul><p><strong>C++ ä¸­çš„ç»å¤§å¤šæ•°ç±»å‹è½¬æ¢éƒ½æ˜¯éšå¼ç±»å‹è½¬æ¢</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆæ¥æ¥è§¦éšå¼ç±»å‹è½¬æ¢å§ã€‚</p><h4 id="4-X-1-éšå¼è½¬æ¢">4.X.1 éšå¼è½¬æ¢</h4><p>éšå¼è½¬æ¢å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œ<u>æ ‡å‡†è½¬æ¢</u>å’Œ<u>ç”¨æˆ·è‡ªå®šä¹‰è½¬æ¢</u>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬æ˜¯ä»€ä¹ˆã€‚</p><h5 id="æ ‡å‡†è½¬æ¢">æ ‡å‡†è½¬æ¢</h5><p>æ ‡å‡†è½¬æ¢å°±æ˜¯ç¼–è¯‘å™¨é‡Œå†…ç½®çš„ä¸€äº›ç±»å‹è½¬æ¢è§„åˆ™ï¼š</p><ul><li>æ•°å€¼æå‡</li><li>æ•°å€¼è½¬æ¢</li><li>ç®—æœ¯è½¬æ¢</li><li>æ•°ç»„é€€åŒ–æˆæŒ‡é’ˆã€å‡½æ•°è½¬æ¢æˆå‡½æ•°æŒ‡é’ˆ</li><li>æ•°æ®ç±»å‹æŒ‡é’ˆåˆ°voidæŒ‡é’ˆçš„è½¬æ¢ã€nullptr_tåˆ°æ•°æ®ç±»å‹æŒ‡é’ˆçš„è½¬æ¢</li><li>ç‰¹å®šè¯­å¢ƒä¸‹è¦æ±‚çš„è½¬æ¢ï¼Œæ¯”å¦‚ifé‡Œè¦æ±‚boolç±»å‹çš„å€¼ã€æšä¸¾ç±»å‹è½¬æ¢ä¸ºæ•´å‹</li><li>â€¦</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›è½¬æ¢åŸºæœ¬é’ˆå¯¹<u>åŸºæœ¬æ•°æ®ç±»å‹</u>ã€<u>æŒ‡é’ˆ</u>ã€æˆ–<u>æ•°ç»„</u>è¿™ç§å†…ç½®çš„èšåˆç±»å‹çš„ã€‚</p><p>å…ˆä»ç¬¬ä¸€ä¸ªæ•°å€¼æå‡è¯´èµ·å§ã€‚</p><ul><li><p><strong>æ•°å€¼æå‡</strong></p><p><strong>æ•°å€¼æå‡æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</p><p>é¡¾åæ€ä¹‰ï¼Œæ•°å€¼æå‡å°±æ˜¯å°†æ›´å°çš„æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚<code>char</code>ï¼‰ è½¬æ¢ä¸ºæ›´å¤§çš„æ•°æ®ç±»å‹ï¼ˆé€šå¸¸æ˜¯<code>int</code>æˆ–è€…<code>double</code>ï¼‰ã€‚æ˜¾ç„¶è¿™ç§æå‡æ˜¯<u>å®‰å…¨</u>çš„ï¼Œå®ƒä¸ä¼šä¸¢å¤±ç²¾åº¦ã€‚</p><p>æ•°å€¼æå‡ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªå­ç±»åˆ«ï¼šæµ®ç‚¹æå‡å’Œæ•´æ•°æå‡ã€‚</p><ul><li><p><strong>æµ®ç‚¹æå‡</strong></p><p>æµ®ç‚¹æå‡è§„åˆ™å¾ˆç®€å•ï¼Œå°±æ˜¯<code>float</code> å¯ä»¥éšå¼æå‡ä¸º<code>double</code> ã€‚ä¸€ä¸ªä¾‹å­å°±èƒ½æ˜ç™½ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printDouble</span><span class="params">(<span class="keyword">double</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printDouble</span>(<span class="number">4.0f</span>); <span class="comment">// 4.0fæ˜¯floatè¢«éšå¼æå‡double</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ•´å‹æå‡</strong></p></li></ul><blockquote><p><code>char</code>ã€<code>bool</code>ã€<code>short</code> ã€<code>int</code>ã€<code>long</code> éƒ½æ˜¯æ•´å‹ã€‚</p></blockquote><p>æ•´å‹æå‡è¯´ç™½äº†ï¼Œå°±æ˜¯æ¯”<code>int</code> å°çš„æ•°æ®ç±»å‹ï¼Œå°½é‡å¾€<code>int</code> æˆ– <code>unsigned int</code>ä¸Šé ã€‚å®ƒçš„è§„åˆ™å¤§è‡´æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li>æ— ç¬¦å·æˆ–è€…æœ‰ç¬¦å·charã€short ä¼˜å…ˆéšå¼è½¬æ¢ä¸ºintï¼Œå¦‚æœintä¸å¤Ÿå®¹çº³ï¼Œåˆ™è½¬æ¢ä¸º unsigned intï¼›</li><li>boolä¹Ÿè½¬æ¢ä¸ºintï¼Œfalseå˜æˆ0ï¼Œtrueå˜æˆ1ã€‚</li></ol><p>ä¸¾ä¸€ä¸ªå°ä¾‹å­ã€‚</p>  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printInt</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">short</span> s =  <span class="number">3</span> ;  <span class="comment">// short</span></span><br><span class="line">    <span class="built_in">printInt</span>(s);    </span><br><span class="line">    <span class="built_in">printInt</span>(<span class="string">&#x27;a&#x27;</span>);  <span class="comment">// char</span></span><br><span class="line">    <span class="built_in">printInt</span>(<span class="literal">true</span>); <span class="comment">// bool</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•°å€¼ä¹‹é—´çš„è½¬æ¢å°±ç»“æŸäº†</strong>ï¼Ÿ</p><p>çœ‹åˆ°è¿™å„¿æˆ–è®¸ä½ ä¼šè¯´ä½œè€…æ˜¯ä¸æ˜¯é—æ¼äº†ï¼Œ<code>intâ†’float</code> ä¹‹ç±»çš„æ•´å‹æå‡ä»‹ç»å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œ<code>intâ†’float</code> ã€è¿˜æœ‰å®½ç±»å‹â†’çª„ç±»å‹çš„è½¬æ¢éƒ½è¢«å½’ç±»ä¸º<u>æ•°å€¼è½¬æ¢</u>ã€‚å½“ç„¶è¿™åªæ˜¯å­¦æœ¯ä¸Šçš„åŒºåˆ«ï¼Œä½ ä¸å¿…å¤ªè¿‡çº ç»“è¿™ç‚¹ã€‚</p></li><li><p><strong>æ•°å€¼è½¬æ¢</strong></p><p><strong>ä»€ä¹ˆæ˜¯æ•°å€¼è½¬æ¢</strong>ï¼Ÿ</p><p>æ•°å€¼æå‡æœªæåˆ°çš„è½¬æ¢ï¼Œéƒ½æ˜¯æ•°å€¼è½¬æ¢ã€‚</p><p>å›ç­”è¿™ä¹ˆæ•·è¡ï¼Ÿå¥½å§ï¼Œæˆ‘å…·ä½“ä¸€ç‚¹ã€‚</p><p>æ•°å€¼è½¬æ¢å¯åˆ†ä¸ºä»¥ä¸‹äº”ç§è§„åˆ™ï¼š</p><ol><li><p>æ•´å‹å¯è½¬æ¢ä¸ºä»»ä½•å…¶å®ƒæ•´å‹ï¼ˆä¸åŒ…æ‹¬æ•´å‹æå‡ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">short</span> s = <span class="number">3</span>; </span><br><span class="line">  <span class="keyword">long</span> l = <span class="number">3</span>; </span><br><span class="line">  <span class="keyword">char</span> ch = s; </span><br></pre></td></tr></table></figure></li><li><p>æµ®ç‚¹ç±»å‹è½¬æ¢ä¸ºä»»ä½•å…¶ä»–æµ®ç‚¹ç±»å‹ï¼ˆä¸åŒ…æ‹¬æµ®ç‚¹æå‡ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> f = <span class="number">3.0</span>; </span><br><span class="line">  <span class="keyword">long</span> <span class="keyword">double</span> ld = <span class="number">3.0</span>;</span><br></pre></td></tr></table></figure></li><li><p>æ•´æ•°ç±»å‹è½¬æ¢ä¸ºä»»ä½•æµ®ç‚¹ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> d = <span class="number">3</span>;</span><br></pre></td></tr></table></figure></li><li><p>å°†æµ®ç‚¹ç±»å‹è½¬æ¢ä¸ºä»»ä½•æ•´æ•°ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">3.5</span>;</span><br></pre></td></tr></table></figure></li><li><p>å°†æ•´æ•°ç±»å‹æˆ–æµ®ç‚¹ç±»å‹è½¬æ¢ä¸º bool</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> b1 = <span class="number">3.0</span>;</span><br></pre></td></tr></table></figure></li></ol><p>å¯ä»¥çœ‹åˆ°ï¼š<strong><u>æ•°å€¼è½¬æ¢</u>å’Œ<u>æ•°å€¼æå‡</u>çš„è§„åˆ™ç»¼åˆèµ·æ¥å°±æ˜¯ä¸€å¥è¯ï¼šC++ä¸­åŸºæœ¬ä»»æ„æ•´å‹ä¹‹é—´éƒ½å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢</strong>ã€‚</p><p><strong>ä½†æ•°å€¼è½¬æ¢ä¼šå¸¦æ¥ä¸€äº›å±é™©</strong>ã€‚</p><p>ç”±äºæ•°å€¼è½¬æ¢å¯ä»¥å°†ï¼šå®½ç±»å‹â†’çª„ç±»å‹ã€æµ®ç‚¹ç±»å‹â†’æ•´æ•°ç±»å‹ï¼Œè¿™ä¼šå¯¼è‡´ç²¾åº¦ä¸¢å¤±ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ®ç‚¹ç±»å‹â†’æ•´æ•°ç±»å‹</span></span><br><span class="line">  <span class="keyword">float</span> a = <span class="number">1.5</span>;</span><br><span class="line">  <span class="keyword">int</span> b = a ;  <span class="comment">// a = 1.0 , å°æ•°éƒ¨åˆ†ä¸¢å¤±</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å®½ç±»å‹â†’çª„ç±»å‹</span></span><br><span class="line">  <span class="keyword">int</span> a = <span class="number">1000000</span>;</span><br><span class="line">  <span class="keyword">char</span> d = a; <span class="comment">// d = 64ï¼ˆ&#x27;@&#x27;ï¼‰ , aè¢«æˆªæ–­</span></span><br></pre></td></tr></table></figure><p>å¦ä¸€ç‚¹æ¯”è¾ƒéšè”½ï¼Œ<u>éšå¼è½¬æ¢æ€»æ˜¯è½¬æ¢ä¸ºå³å€¼</u>ï¼ˆæ˜¾å¼è½¬æ¢ä¹Ÿæ˜¯ï¼‰ã€‚</p><p>å¬èµ·æ¥å¥½åƒæ²¡ä»€ä¹ˆæ¯›ç—…ï¼Œä½†æ˜¯å’Œå¼•ç”¨ç»“åˆèµ·æ¥å°±åäº‹äº†ï¼Œæˆ‘ä»¬çŸ¥é“å¼•ç”¨åªèƒ½ç”¨å·¦å€¼åˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">long</span> &amp;b = a; <span class="comment">// errorï¼Œæ— æ³•ä½¿ç”¨å³å€¼åˆå§‹åŒ–å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">long</span> &amp;b = <span class="keyword">static_cast</span>&lt;<span class="keyword">long</span>&gt;(a); <span class="comment">// error,æ˜¾å¼è½¬æ¢ä¹Ÿæ˜¯å³å€¼</span></span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.å’Œå¼•ç”¨ç±»å‹ä¿æŒä¸€è‡´</span></span><br><span class="line">  <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">long</span> tmp = a;</span><br><span class="line">  <span class="keyword">long</span> &amp;b = tmp; </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2.ä½¿ç”¨constä¿®é¥°ï¼Œè¿™æ ·å¯ä»¥æ¥å—å³å€¼åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">long</span> &amp;b = a; </span><br></pre></td></tr></table></figure><p>æ‰©å±•åˆ°å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">const</span> <span class="keyword">long</span>&amp; value)</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="built_in">func</span>(a);</span><br></pre></td></tr></table></figure><p><strong>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šæ•™ç¨‹è¯´å°½é‡ç”¨constä¿®é¥°å¼•ç”¨ï¼šè¿™æ ·å¯ä»¥ä½¿å¾—å‡½æ•°å‚æ•°å¯ä»¥éšæ»¡è¶³å¼è½¬æ¢è§„åˆ™</strong>ã€‚</p></li><li><p><strong>ç®—æœ¯è½¬æ¢</strong></p><p>ç®—æœ¯è½¬æ¢å°±æ˜¯å½“æ“ä½œæ•°ä¸æ˜¯åŒä¸€ç±»å‹æ—¶ï¼Œä¼šéšå¼è½¬æ¢ä¸ºåŒä¸€ç±»å‹è¿›è¡Œå†è¿›è¡Œæ“ä½œã€‚</p><p>ç®—æœ¯è½¬æ¢ä¼˜å…ˆçº§åˆ—è¡¨ï¼š</p><ul><li>long double  &gt; double &gt; float &gt; unsigned long long &gt; long long &gt; long &gt; unsigned int &gt; int</li></ul><p>æ³¨æ„åˆ°æœ€ä½ä¼˜å…ˆçº§æ˜¯intã€‚</p><p>ç®—æœ¯è½¬æ¢åªæœ‰ä¸¤æ¡è§„åˆ™ï¼š</p><ul><li>å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªæ“ä½œæ•°çš„ç±»å‹åœ¨ä¼˜å…ˆçº§åˆ—è¡¨ä¸­ï¼Œåˆ™å°†å…·æœ‰è¾ƒä½ä¼˜å…ˆçº§çš„æ“ä½œæ•°è½¬æ¢ä¸ºå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„æ“ä½œæ•°çš„ç±»å‹ï¼›</li><li>å¦åˆ™ï¼ˆä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹éƒ½ä¸åœ¨åˆ—è¡¨ä¸­ï¼‰ï¼Œä¸¤ä¸ªæ“ä½œæ•°éƒ½è¿›è¡Œç±»å‹æå‡ã€‚</li></ul><p>ä¸€ä¸ªç®€å•ä¾‹å­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">double</span> d = <span class="number">3.5</span>;</span><br><span class="line"><span class="built_in"><span class="keyword">typeid</span></span>(i + d).<span class="built_in">name</span>(); <span class="comment">// æœ€ç»ˆç±»å‹ä¸ºdï¼Œdoubleä¼˜å…ˆçº§æ›´é«˜ï¼Œæ‰€ä»¥iæå‡ä¸ºdouble </span></span><br></pre></td></tr></table></figure></li><li><p><strong>æŒ‡é’ˆç›¸å…³è½¬æ¢</strong></p><p>è¿™äº›æˆ‘ä»¬ä¹‹å‰å…¶å®éƒ½åŸºæœ¬è§è¿‡ï¼š</p><ul><li>æ•°ç»„é€€åŒ–æˆæŒ‡é’ˆã€å‡½æ•°è½¬æ¢æˆå‡½æ•°æŒ‡é’ˆ</li><li>æ•°æ®ç±»å‹æŒ‡é’ˆåˆ°voidæŒ‡é’ˆçš„è½¬æ¢ã€nullptr_tåˆ°æ•°æ®ç±»å‹æŒ‡é’ˆçš„è½¬æ¢</li><li>â€¦</li></ul><p>ä¸¾ä¸ªå°ä¾‹å­åŠ æ·±ä¸‹å°è±¡å°±å¥½ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* i = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>();</span><br><span class="line"><span class="keyword">void</span>* ptr = i;  <span class="comment">// æ‰€ä»¥ä¹‹å‰è¯´voidç±»å‹æ¥å—ä»»ä½•ç±»å‹çš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* pc = <span class="number">0</span>;   <span class="comment">// int è½¬æ¢ä¸º Null æŒ‡é’ˆå†è½¬æ¢ä¸ºchar*æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">char</span>* pc = <span class="literal">nullptr</span>;        <span class="comment">// nullptrè½¬æ¢ä¸ºchar*æŒ‡é’ˆ</span></span><br><span class="line">dog* pd = <span class="keyword">new</span> <span class="built_in">yellowdog</span>(); <span class="comment">// æŒ‡é’ˆç±»å‹è½¬æ¢ï¼Œå­ç±» yellowdog æŒ‡é’ˆè½¬æ¢ä¸ºçˆ¶ç±» dog æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ç‰¹æ®Šè¯­å¢ƒä¸‹è½¬æ¢</strong></p><p>ä»¥ifä¸ºä¾‹ï¼Œifæ¥å—boolç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="number">3</span>)  <span class="comment">// 3è½¬æ¢ä¸ºboolç±»å‹ï¼Œè¿™é‡Œæ˜¯true(é0å€¼éƒ½è½¬æ¢ä¸ºtrue)</span></span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;<span class="string">&quot;fine&quot;</span>&lt;&lt;std::endl; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>boolä¹Ÿæ˜¯æ•´å‹ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å‰é¢è¯´åˆ«çš„ï¼ŒC++ä¸­æ•´å‹å‡ ä¹éƒ½å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢ã€‚</p></li></ul><h5 id="åˆ«è¸©å‘ï¼šcharå’Œintçš„è½¬æ¢ï¼Ÿ">åˆ«è¸©å‘ï¼šcharå’Œintçš„è½¬æ¢ï¼Ÿ</h5><p>å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œcharå’Œintå¯ä»¥éšå¼è½¬æ¢ã€‚ä½†è¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›æ„å¤–çš„é”™è¯¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> c = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="keyword">int</span> a = c;   <span class="comment">// a=49</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ˜¯å°†<code>c</code> çš„ASCIIç <code>49</code>ï¼ˆæ•°å­—çš„ASCIIç ä»<code>48</code>å¼€å§‹ï¼Œå³<code>'0'</code>å¼€å§‹ï¼‰ èµ‹å€¼ç»™å˜é‡<code>a</code>ã€‚</p><p>å¦‚æœéœ€è¦è·å–<code>c</code>å­˜å‚¨å€¼<code>'1'</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a1 = c<span class="number">-48</span>;  <span class="comment">// æ–¹æ³•1</span></span><br><span class="line"><span class="keyword">int</span> a2 = c-<span class="string">&#x27;0&#x27;</span>; <span class="comment">// æ–¹æ³•2</span></span><br></pre></td></tr></table></figure><h5 id="ç”¨æˆ·è‡ªå®šä¹‰è½¬æ¢ğŸŒŸ">ç”¨æˆ·è‡ªå®šä¹‰è½¬æ¢ğŸŒŸ</h5><blockquote><p>è¿™éƒ¨åˆ†å†…å®¹æœ‰ç‚¹è¶…å‰ï¼Œé€‚åˆæœ‰ä¸€å®šé¢å¯¹å¯¹è±¡åŸºç¡€çš„åŒå­¦ã€‚</p></blockquote><p><strong>æ€ä¹ˆè¿›è¡Œç”¨æˆ·å®šä¹‰è½¬æ¢</strong>ï¼Ÿ</p><p>ç”¨æˆ·è‡ªå®šä¹‰çš„éšå¼è½¬æ¢æ˜¯éšå¼è½¬æ¢çš„é‡å¤´æˆï¼Œä¸€èˆ¬æŒ‡ä¸¤æ–¹é¢å†…å®¹:</p><ol><li><p><strong>è½¬æ¢æ„é€ å‡½æ•°</strong>ï¼Œåˆ©ç”¨æ¥å—<u>å•ä¸ªå‚æ•°</u> æˆ– <u>ç¬¬ä¸€ä¸ªå‚æ•°å…¶ä½™å‚æ•°éƒ½æä¾›äº†é»˜è®¤å€¼</u> çš„æ„é€ å‡½æ•°ï¼Œå°†<u>å…¶ä»–ç±»å‹å¯¹è±¡â†’è½¬æ¢ä¸ºæœ¬å¯¹è±¡</u>ã€‚</p><blockquote><p>C++ ä¼šå°†ä»»ä½•æ„é€ å‡½æ•°è§†ä¸ºéšå¼è½¬æ¢è¿ç®—ç¬¦ã€‚</p></blockquote></li><li><p><strong>ç±»å‹è½¬æ¢é‡è½½</strong>ï¼Œ <u>é‡è½½æŒ‡å®šç±»å‹</u>ï¼Œå°†<u>æœ¬ç±»çš„å¯¹è±¡â†’è½¬æ¢ä¸ºæŒ‡å®šç±»å‹å¯¹è±¡</u>ã€‚</p></li></ol><p>ä¸¤è€…åˆèµ·æ¥å¯ä»¥æ„æˆä¸€ä¸ªåŒå‘è½¬æ¢å…³ç³»ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dog</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="comment">// 1.è½¬æ¢æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">dog</span>(string name) &#123;m_name = name;&#125; </span><br><span class="line">        <span class="comment">// 2.ç±»å‹è½¬æ¢é‡è½½</span></span><br><span class="line">        <span class="function"><span class="keyword">operator</span> <span class="title">string</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> m_name;&#125; </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        string m_name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">s2dog</span><span class="params">(cosnt dog&amp;)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// nothing;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      string dogname = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line">      <span class="comment">// 1.è½¬æ¢æ„é€ å‡½æ•°</span></span><br><span class="line">      dog d = dogname; <span class="comment">// ok</span></span><br><span class="line">      <span class="built_in">s2dog</span>(<span class="string">&quot;dog&quot;</span>);    <span class="comment">// ok</span></span><br><span class="line">      <span class="comment">// 2.ç±»å‹è½¬æ¢</span></span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;my name is &quot;</span> &lt;&lt; <span class="built_in">string</span>(d) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my name is dog</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§éšå¼è½¬æ¢æ–¹å¼çœ‹èµ·æ¥æœ‰ç‚¹è®©äººè´¹è§£ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dog d = dogname;</span><br></pre></td></tr></table></figure><p>å®ƒä¹Ÿæ²¡æœ‰é‡è½½ <code>=</code> ï¼Œæ€ä¹ˆå°±<code>string</code>â†’<code>dog</code>è½¬æ¢äº†ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸º<code>dog(string name) &#123;m_name = name;&#125;</code> æœ‰ä¸¤å±‚å«ä¹‰ï¼Œé™¤äº†æ„é€ å‡½æ•°å¤–ï¼Œå®ƒè¿˜å¯ä»¥ä½œä¸ºéšå¼è½¬æ¢å‡½æ•°ï¼Œå°† <code>string</code> å¯¹è±¡è½¬æ¢ä¸º <code>dog</code> å¯¹è±¡ã€‚</p><p>å…·ä½“è¿‡ç¨‹è¿˜æ¶‰åŠåˆ°å¤åˆ¶åˆå§‹åŒ–ï¼ˆ<u>5.2.2</u>èŠ‚è¯¦è§£ï¼‰ï¼š</p><ol><li>è¡¨è¾¾å¼ä»å³åˆ°å·¦ï¼Œæ„é€ å‡½æ•°<code>dog(string)</code>ä½œä¸ºè½¬æ¢æ„é€ å‡½æ•° ï¼Œç¼–è¯‘å™¨å…ˆåˆ›å»º<code>dog</code>ä¸´æ—¶åŒ¿åå¯¹è±¡ï¼Œä½¿å¾—<code>=</code>ä¸¤è¾¹æ“ä½œç±»å‹ä¸€è‡´ï¼›</li><li>ç„¶åæ„é€ å‡½æ•°<code>dog(string)</code> ï¼Œåˆå§‹åŒ–åŒ¿åå¯¹è±¡ï¼›</li><li>ç¼–è¯‘å™¨åˆ›å»ºå¯¹è±¡<code>d</code> ï¼›</li><li>è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼ŒåŒ¿åå¯¹è±¡ä½œä¸ºå¤åˆ¶æ„é€ å‡½æ•°å‚æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡<code>d</code> ã€‚</li></ol><p><strong>ç”¨æˆ·è‡ªå®šä¹‰è½¬æ¢æœ‰ä»€ä¹ˆå±é™©</strong>ï¼Ÿ</p><p>éšå¼è½¬æ¢æ€»æ˜¯æˆ–å¤šæˆ–å°‘æœ‰ç‚¹å±é™©ï¼Œç”¨æˆ·è‡ªå®šä¹‰éšå¼è½¬æ¢ä¹Ÿä¸ä¾‹å¤–ã€‚</p><ul><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³å£°æ˜ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä½†æ˜¯ä¼šè‡ªåŠ¨è¢«è¯†åˆ«ä¸ºè½¬æ¢æ„é€ å‡½æ•°â€”â€”å°†<code>string</code> â†’<code>dog</code>ä¹Ÿè®¸å¹¶ä¸æ˜¯æˆ‘ä»¬çš„æœ¬æ„ ã€‚</li><li>é€šå¸¸ç¼–ç éœ€é¿å…åŒå‘éšå¼è½¬æ¢ï¼Œæˆ‘ä»¬å¼€å¤´çš„ä¾‹å­æ˜¯ä¸å¥½çš„ç¼–ç¨‹å®è·µã€‚</li></ul><p>å¦‚æœä¸æƒ³æ„é€ å‡½æ•°è¿›è¡Œéšå¼è½¬æ¢ï¼Œå¯ä»¥ç”¨ <code> explicit</code> è¿›è¡Œå£°æ˜ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">dog</span><span class="params">(string)</span> </span>&#123;m_name = name;&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¿›è¡Œéšå¼è½¬æ¢ä¼šå‡ºé”™ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string dogname = <span class="string">&quot;dog&quot;</span>;  <span class="comment">// error</span></span><br></pre></td></tr></table></figure><p>åªèƒ½è¿›è¡Œæ˜¾ç¤ºè½¬æ¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string dogname = <span class="keyword">static_cast</span>&lt;dog&gt;(<span class="string">&quot;dog&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>ç”¨æˆ·è‡ªå®šä¹‰è½¬æ¢æœ‰ä»€ä¹ˆå¥½å¤„</strong>ï¼Ÿ</p><p>éšå¼è½¬æ¢å¹¶ä¸æ˜¯ä¸€æ— æ˜¯å¤„ï¼Œå®ƒä»ç„¶æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚</p><p>ä¸‹é¢å£°æ˜ä¸€ä¸ª<code>Rational</code> æœ‰ç†æ•°ç±»ï¼Œå¤„ç†æ•°å­—ç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rational</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line"><span class="keyword">int</span> den;</span><br><span class="line">    <span class="comment">// 1.æ„é€ å‡½æ•°éšå¼è½¬æ¢</span></span><br><span class="line"><span class="built_in">Rational</span>(<span class="keyword">int</span> numerator = <span class="number">0</span>, <span class="keyword">int</span> denominator = <span class="number">1</span>)</span><br><span class="line">: <span class="built_in">num</span>(numberator), <span class="built_in">den</span>(denominator) &#123;&#125;</span><br><span class="line">    <span class="comment">// 2.é‡è½½è¿ç®—ç¬¦*</span></span><br><span class="line">    Rational <span class="keyword">operator</span>*(<span class="keyword">const</span> Rational&amp; lhs, <span class="keyword">const</span> Rational&amp; rhs) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.num*rhs.num, lhs.den*rhs.den);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Rational r1 = <span class="number">23</span>;</span><br><span class="line">    Rational r2 = r1 * <span class="number">2</span>;</span><br><span class="line">    Rational r3 = <span class="number">3</span> * r1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªæœ‰ç†æ•°ç±» <code>Rational</code>ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ¥å— 2 ä¸ªé»˜è®¤å‚æ•°ï¼Œåˆ†åˆ«ä»£è¡¨åˆ†å­å’Œåˆ†æ¯ï¼Œç»™è¯¥æ„é€ å‡½æ•°ä¼ é€’ä¸€ä¸ªå‚æ•°æ—¶ï¼Œ<code>Rational</code> å…·æœ‰éšå¼è½¬æ¢çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†æ•°å­—èµ‹å€¼ç»™ <code>Rational</code> å¯¹è±¡ï¼Œå¦‚ï¼š<code>Rational r1 = 23;</code> ã€‚</li><li>ä¸ºäº†é¿å…åŒå‘è½¬æ¢ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å®šä¹‰å°† <code>Rational</code> è½¬æ¢ä¸º <code>int</code> çš„è½¬æ¢å‡½æ•°ï¼Œè€Œå½“æˆ‘ä»¬æƒ³å®ç° <code>Rational</code> å¯¹è±¡å’Œ <code>int</code> ä¹‹é—´è‡ªç”±çš„ç®—æœ¯è¿ç®—æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å…¨å±€çš„æ“ä½œç¬¦é‡è½½ï¼Œå¦‚ä¸Šé¢çš„ <code>operator*</code> å®šä¹‰äº†æœ‰ç†æ•°çš„ä¹˜æ³•äº‘ç®—ç¬¦ã€‚</li></ul><h5 id="æœ€ä½³å®è·µ-3">æœ€ä½³å®è·µ</h5><p>ç±»å‹è½¬æ¢æ˜¯å±é™©çš„æ“ä½œï¼Œä½¿ç”¨æ›´é•¿çš„æ“ä½œç¬¦ï¼ˆåæ–‡å°†æåˆ°çš„æ˜¾å¼è½¬æ¢ï¼‰æé†’åŒäº‹å’Œå°†æ¥çš„è‡ªå·±æ³¨æ„å®‰å…¨ã€‚</p><h4 id="4-X-2-æ˜¾å¼è½¬æ¢">4.X.2 æ˜¾å¼è½¬æ¢</h4><p>æ˜¾å¼è½¬æ¢ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ol><li>å®ŒæˆC++éšå¼è½¬æ¢æ— æ³•å®Œæˆçš„å·¥ä½œï¼Œæ¯”å¦‚èŒƒå›´æšä¸¾ä¸­å°†<code>eunm</code> ç±»å‹â†’<code>int</code> ï¼›</li><li>å°½å¯èƒ½çš„æ›¿ä»£éšå¼è½¬æ¢ï¼Œåœ¨ç¨‹åºæ˜¾å¼çš„å£°æ˜è¿™æ˜¯ä¸ªè½¬æ¢æ“ä½œâ€”â€”è¿™å¾ˆä¸“ä¸šã€‚</li></ol><p>C++/Cæ€»æ˜¯éš¾ä»¥åˆ†å¼€çš„ï¼Œå…ˆä»Cä¸­æ˜¾å¼è½¬æ¢è¯´èµ·å§ã€‚</p><h5 id="Cé£æ ¼æ˜¾å¼è½¬æ¢">Cé£æ ¼æ˜¾å¼è½¬æ¢</h5><p>åœ¨æ ‡å‡† C ç¼–ç¨‹ä¸­ï¼Œè½¬æ¢æ˜¯é€šè¿‡ <code>()</code> è¿ç®—ç¬¦å®Œæˆçš„ï¼Œç±»å‹çš„åç§°è¦è½¬æ¢çš„å€¼æ”¾åœ¨æ‹¬å·å†…ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> x = <span class="number">1.5</span>;</span><br><span class="line"><span class="keyword">int</span> y = (<span class="keyword">double</span>)x;</span><br></pre></td></tr></table></figure><p>Cé£æ ¼çš„è½¬æ¢æ ¼å¼çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†å…¶å®æœ‰ä¸å°‘ç¼ºç‚¹ï¼š</p><ol><li><u>è½¬æ¢å¤ªè¿‡éšæ„ï¼Œå¯ä»¥åœ¨ä»»æ„ç±»å‹ä¹‹é—´è½¬æ¢</u>ã€‚å¯ä»¥æŠŠä¸€ä¸ªæŒ‡å‘constå¯¹è±¡çš„æŒ‡é’ˆè½¬æ¢æˆæŒ‡å‘éconstå¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŠŠä¸€ä¸ªæŒ‡å‘åŸºç±»å¯¹è±¡çš„æŒ‡é’ˆè½¬æ¢æˆä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡çš„æŒ‡é’ˆã€‚è¿™äº›è½¬æ¢ä¹‹é—´çš„å·®è·æ˜¯éå¸¸å·¨å¤§çš„ï¼Œä½†æ˜¯ä¼ ç»Ÿçš„Cè¯­è¨€é£æ ¼çš„ç±»å‹è½¬æ¢æ²¡æœ‰åŒºåˆ†è¿™äº›ã€‚</li><li><u>Cé£æ ¼çš„è½¬æ¢æ²¡æœ‰ç»Ÿä¸€çš„å…³é”®å­—å’Œæ ‡ç¤ºç¬¦</u>ã€‚å¯¹äºå¤§å‹ç³»ç»Ÿï¼Œåšä»£ç æ’æŸ¥æ—¶å®¹æ˜“é—æ¼å’Œå¿½ç•¥ã€‚</li></ol><p>ä¸ºæ­¤ï¼ŒC++ å¼•å…¥äº†<code>_cast</code>å¼ºåˆ¶è½¬æ¢è¿ç®—ç¬¦ã€‚</p><h5 id="C-æ˜¾å¼è½¬æ¢">C++æ˜¾å¼è½¬æ¢</h5><p>C++è½¬æ¢é£æ ¼å®Œç¾çš„è§£å†³äº†Cé£æ ¼ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å¯¹ç±»å‹è½¬æ¢åšäº†ç»†åˆ†ï¼Œæä¾›äº†å››ç§ä¸åŒç±»å‹è½¬æ¢ï¼Œä»¥æ”¯æŒä¸åŒéœ€æ±‚çš„è½¬æ¢ï¼›</li><li>ç±»å‹è½¬æ¢æœ‰äº†ç»Ÿä¸€çš„æ ‡ç¤ºç¬¦ï¼Œåˆ©äºä»£ç æ’æŸ¥å’Œå®¡æŸ¥ã€‚</li></ol><p>å››ç§ä¸åŒç±»å‹çš„è½¬æ¢åˆ†åˆ«æ˜¯ï¼š</p><ul><li><u>static_cast</u>ï¼Œå‘½åä¸Šç†è§£æ˜¯é™æ€ç±»å‹è½¬æ¢ï¼Œå¦‚intè½¬æ¢â†’charã€‚</li><li><u>dynamic_cast</u>ï¼Œå‘½åä¸Šç†è§£æ˜¯åŠ¨æ€ç±»å‹è½¬æ¢ï¼Œå¦‚å­ç±»å’Œçˆ¶ç±»ä¹‹é—´çš„å¤šæ€ç±»å‹è½¬æ¢ã€‚</li><li><u>const_cast</u>ï¼Œå»é™¤constå±æ€§ï¼Œå¦‚å¸¸é‡æŒ‡é’ˆ/å¼•ç”¨è½¬æ¢â†’éå¸¸é‡æŒ‡é’ˆ/å¼•ç”¨ã€‚</li><li><u>reinterpret_cast</u>ï¼Œä»…ä»…é‡æ–°è§£é‡Šç±»å‹ï¼Œæ²¡æœ‰è¿›è¡ŒäºŒè¿›åˆ¶çš„è½¬æ¢ã€‚</li></ul><h5 id="static-cast">static_cast</h5><p><strong>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨static_cast</strong>ï¼Ÿ</p><ul><li><strong>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢</strong>ï¼Œå¦‚æŠŠintè½¬æ¢ä¸ºcharï¼Œå¸¦æ¥å®‰å…¨æ€§é—®é¢˜ç”±ç¨‹åºå‘˜æ¥ä¿è¯ï¼›</li><li><strong>æŠŠç©ºæŒ‡é’ˆè½¬æ¢æˆç›®æ ‡ç±»å‹çš„ç©ºæŒ‡é’ˆ</strong>ï¼›</li><li><strong>æŠŠä»»ä½•ç±»å‹çš„è¡¨è¾¾å¼è½¬ä¸ºvoidç±»å‹</strong>ï¼›</li><li>ï¼ˆä¸æ¨èï¼‰ç±»å±‚æ¬¡ç»“æ„ä¸­<u>åŸºç±»å’Œæ´¾ç”Ÿç±»ä¹‹é—´æŒ‡é’ˆæˆ–å¼•ç”¨</u>çš„è½¬æ¢ï¼šä¸Šè¡Œè½¬æ¢ï¼ˆæ´¾ç”Ÿç±»â€”-&gt;åŸºç±»ï¼‰æ˜¯å®‰å…¨çš„ï¼›ä¸‹è¡Œè½¬æ¢ï¼ˆåŸºç±»â€”-&gt;æ´¾ç”Ÿç±»ï¼‰ç”±äºæ²¡æœ‰åŠ¨æ€ç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥æ˜¯ä¸å®‰å…¨çš„ã€‚</li></ul><p><strong>éšå¼è½¬æ¢éƒ½å»ºè®®ä½¿ç”¨static_castè¿›è¡Œæ ‡æ˜å’Œæ›¿æ¢</strong>ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢éšå¼è½¬æ¢éƒ½å¯æ›¿æ¢ä¸ºæ˜¾å¼çš„static_castè½¬æ¢ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> d = <span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(n); <span class="comment">// åŸºæœ¬ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="keyword">int</span> *pn = &amp;n;</span><br><span class="line"><span class="keyword">double</span> *d = <span class="keyword">static_cast</span>&lt;<span class="keyword">double</span> *&gt;(&amp;n) <span class="comment">// æ— å…³ç±»å‹æŒ‡é’ˆè½¬æ¢ï¼Œç¼–è¯‘é”™è¯¯ï¼Œåº”è¯¥ä½¿ç”¨reinterpret_cast</span></span><br><span class="line"><span class="keyword">void</span> *p = <span class="keyword">static_cast</span>&lt;<span class="keyword">void</span> *&gt;(pn); <span class="comment">// ä»»æ„ç±»å‹è½¬æ¢æˆvoidç±»å‹</span></span><br></pre></td></tr></table></figure><h5 id="dynamic-cast">dynamic_cast</h5><p><strong>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨dynamic_cast</strong>ï¼Ÿ</p><p>åªæœ‰åœ¨<u>æ´¾ç”Ÿç±»ä¹‹é—´</u>è½¬æ¢æ—¶æ‰ä½¿ç”¨dynamic_castï¼Œ<u>type-idå¿…é¡»æ˜¯ç±»æŒ‡é’ˆï¼Œç±»å¼•ç”¨æˆ–è€…<code>void*</code></u>ã€‚</p><ul><li><strong>ä½¿ç”¨æ—¶åŸºç±»å¿…é¡»è¦æœ‰è™šå‡½æ•°</strong>ï¼Œå› ä¸ºdynamic_castæ˜¯è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ï¼Œéœ€è¦è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ï¼Œè€Œè¿™ä¸ªä¿¡æ¯æ˜¯å­˜å‚¨åœ¨ç±»çš„è™šå‡½æ•°è¡¨ä¸­ï¼Œåªæœ‰ä¸€ä¸ªç±»å®šä¹‰äº†è™šå‡½æ•°æ‰ä¼šæœ‰è™šå‡½æ•°è¡¨ï¼ˆå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆä¸€èˆ¬æ„ä¹‰ä¸Šï¼Œè¿™ä¸ªç±»çš„è®¾è®¡è€…ä¹Ÿä¸æƒ³å®ƒæˆä¸ºä¸€ä¸ªåŸºç±»ï¼‰ã€‚</li></ul><p><strong>å’Œstatic_castå¯¹æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</p><ul><li>ä¸‹è¡Œè½¬æ¢ï¼Œdynamic_castæ˜¯å®‰å…¨çš„ï¼ˆå½“ç±»å‹ä¸ä¸€è‡´æ—¶ï¼Œè½¬æ¢è¿‡æ¥çš„æ˜¯ç©ºæŒ‡é’ˆï¼‰ï¼Œè€Œstatic_castæ˜¯ä¸å®‰å…¨çš„ï¼ˆå½“ç±»å‹ä¸ä¸€è‡´æ—¶ï¼Œè½¬æ¢è¿‡æ¥çš„æ˜¯é”™è¯¯æ„ä¹‰çš„æŒ‡é’ˆï¼Œå¯èƒ½é€ æˆè¸©å†…å­˜ï¼Œéæ³•è®¿é—®ç­‰å„ç§é—®é¢˜ï¼‰ã€‚</li><li>dynamic_castè¿˜å¯ä»¥è¿›è¡Œäº¤å‰è½¬æ¢ã€‚</li></ul><p>ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseClass</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">      <span class="keyword">int</span> m_iNum;</span><br><span class="line">      <span class="comment">// åŸºç±»å¿…é¡»æœ‰è™šå‡½æ•°ã€‚ä¿æŒå¤šå°ç‰¹æ€§æ‰èƒ½ä½¿ç”¨dynamic_cast</span></span><br><span class="line">      <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DerivedClass</span>:</span> <span class="keyword">public</span> BaseClass </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">      <span class="keyword">char</span> *m_szName[<span class="number">100</span>];</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">ã€€ã€€</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BaseClass* pb = <span class="keyword">new</span> <span class="built_in">DerivedClass</span>();</span><br><span class="line">    <span class="comment">// å­ç±»-&gt;çˆ¶ç±»ï¼Œé™æ€ç±»å‹è½¬æ¢ï¼Œæ­£ç¡®ä½†ä¸æ¨è</span></span><br><span class="line">    DerivedClass *pd1 = <span class="keyword">static_cast</span>&lt;DerivedClass*&gt;(pb);</span><br><span class="line">    <span class="comment">// å­ç±»-&gt;çˆ¶ç±»ï¼ŒåŠ¨æ€ç±»å‹è½¬æ¢ï¼Œæ­£ç¡®</span></span><br><span class="line">    DerivedClass *pd2 = <span class="keyword">dynamic_cast</span>&lt;DerivedClass*&gt;(pb);</span><br><span class="line"></span><br><span class="line">    BaseClass* pb2 = <span class="keyword">new</span> <span class="built_in">BaseClass</span>();</span><br><span class="line">    <span class="comment">// çˆ¶ç±»-&gt;å­ç±»ï¼Œé™æ€ç±»å‹è½¬æ¢ï¼Œå±é™©ï¼è®¿é—®å­ç±»m_szNameæˆå‘˜è¶Šç•Œ</span></span><br><span class="line">    DerivedClass *pd21 = <span class="keyword">static_cast</span>&lt;DerivedClass*&gt;(pb2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çˆ¶ç±»-&gt;å­ç±»ï¼ŒåŠ¨æ€ç±»å‹è½¬æ¢ï¼Œå®‰å…¨çš„ã€‚ç»“æœæ˜¯NULL</span></span><br><span class="line">    DerivedClass *pd22 = <span class="keyword">dynamic_cast</span>&lt;DerivedClass*&gt;(pb2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="const-cast">const_cast</h5><p>cosnt_castæ˜¯å››ç§ç±»å‹è½¬æ¢ç¬¦ä¸­å”¯ä¸€å¯ä»¥å¯¹å¸¸é‡è¿›è¡Œæ“ä½œçš„è½¬æ¢ç¬¦ï¼Œ<u>ç”¨æ¥å»é™¤å¸¸é‡æ€§</u>ï¼Œç¨‹åºå‘˜å¯¹è¿™ä¸ªæ“ä½œè´Ÿè´£ã€‚</p><ul><li>å¸¸é‡æŒ‡é’ˆè½¬æ¢ä¸ºéå¸¸é‡æŒ‡é’ˆï¼Œå¹¶ä¸”ä»ç„¶æŒ‡å‘åŸæ¥çš„å¯¹è±¡</li><li>å¸¸é‡å¼•ç”¨è¢«è½¬æ¢ä¸ºéå¸¸é‡å¼•ç”¨ï¼Œå¹¶ä¸”ä»ç„¶æŒ‡å‘åŸæ¥çš„å¯¹è±¡</li></ul><p>æ³¨æ„è½¬æ¢ç±»å‹åªèƒ½æ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SA</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">ã€€ã€€<span class="keyword">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> SA ra;</span><br><span class="line">    ra.i = <span class="number">10</span>; <span class="comment">// errorï¼Œç›´æ¥ä¿®æ”¹constç±»å‹</span></span><br><span class="line">    SA &amp;rb = <span class="keyword">const_cast</span>&lt;SA&amp;&gt;(ra);</span><br><span class="line">    rb.i = <span class="number">10</span>; <span class="comment">// okï¼Œå»é™¤äº†å¸¸é‡æ€§</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="reinterpret-cast">reinterpret_cast</h5><p><strong>éå¸¸å±é™©çš„æ“ä½œç¬¦ï¼Œè°¨æ…ä½¿ç”¨</strong>ã€‚</p><ul><li>reinterpret_castå¯ä»¥åœ¨æŒ‡é’ˆå’Œå¼•ç”¨é‡Œè¿›è¡Œè‚†æ— å¿Œæƒ®çš„è½¬æ¢ï¼›</li><li>reinterpret_castå¯ä»¥å°†æ•´å‹è½¬æ¢ä¸ºæŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥æŠŠæŒ‡é’ˆè½¬æ¢ä¸ºæ•°ç»„ï¼›</li><li>reinterpret_castæ˜¯ä»åº•å±‚å¯¹æ•°æ®è¿›è¡Œé‡æ–°è§£é‡Šï¼Œä¾èµ–å…·ä½“çš„å¹³å°ï¼Œå¯ç§»æ¤æ€§å·®ã€‚</li></ul><p>ä¸€èˆ¬ç”¨æ¥ä¸åŒç±»å‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ä¹‹é—´è½¬æ¢ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span>* p_a = &amp;a;</span><br><span class="line"><span class="keyword">bool</span>* p_c = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">bool</span>*&gt;(p_a);</span><br><span class="line">std::cout &lt;&lt; *p_c&lt;&lt; <span class="string">&quot;\n&quot;</span>; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h5 id="æœ€ä½³å®è·µ-4">æœ€ä½³å®è·µ</h5><ul><li><p><strong>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ˜¾å¼è½¬æ¢</strong>ï¼Ÿ</p><p>åœ¨æ‰€æœ‰éœ€è¦è½¬æ¢çš„åœ°æ–¹éƒ½åº”è¯¥å°½é‡ä½¿ç”¨æ˜¾å¼è½¬æ¢ã€‚</p></li><li><p><strong>å››ç§æ˜¾å¼è½¬æ¢è¯¥æ€ä¹ˆé€‰æ‹©</strong>ï¼Ÿ</p><p>âš ï¸ é™¤äº†static_castå¯ç”¨äºéæŒ‡é’ˆã€å¼•ç”¨ç±»å‹ï¼Œå…¶å®ƒè½¬æ¢ç¬¦éƒ½å¿…é¡»æ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚</p><ul><li>static_castï¼šåŸºæœ¬ç±»å‹è½¬æ¢ã€ç±»ä¸‹è¡Œè½¬æ¢ã€ç©ºæŒ‡é’ˆå’Œå…¶å®ƒæŒ‡é’ˆçš„è½¬æ¢ï¼›</li><li>reinterpret_castï¼šä¸åŒç±»å‹çš„æŒ‡é’ˆç±»å‹è½¬æ¢ï¼›</li><li>const_castï¼šå°†å¸¸é‡æŒ‡é’ˆ/å¼•ç”¨è½¬æ¢ä¸ºéå¸¸é‡æŒ‡é’ˆ/å¼•ç”¨ï¼›</li><li>daynamic_castï¼šå¤šæ€ç±»ä¹‹é—´çš„ç±»å‹è½¬æ¢ã€‚</li></ul></li></ul><h4 id="4-X-3-ç±»å‹è½¬æ¢è¡¥å……ï¼šstring">4.X.3 ç±»å‹è½¬æ¢è¡¥å……ï¼šstring</h4><p>è¿™é‡Œä¸»è¦æ€»ç»“ä¸‹<u>ä¸Šé¢æ²¡æåˆ°ï¼Œå¹³æ—¶åˆç»å¸¸ç”¨åˆ°çš„</u>è½¬æ¢ï¼š</p><ol><li>stringå’Œcharç­‰åŸºæœ¬ç±»å‹çš„è½¬æ¢ï¼›</li><li>stringå’Œchar[]ä¹‹é—´è½¬æ¢ï¼›</li><li>stringå’Œå…¶å®ƒç±»å‹æ•°ç»„ï¼ˆæ¯”å¦‚int[]ï¼‰ä¹‹é—´çš„è½¬æ¢ã€‚</li></ol><p>1å’Œ2åœ¨<u>1.8.3</u> &amp; <u>1.8.4</u> èŠ‚éƒ½å·²ä»‹ç»è¿‡ï¼Œä¸ºäº†å®Œæ•´æ€§è¿™é‡Œè¿›è¡Œç®€å•æ€»ç»“ã€‚</p><h5 id="stringâ†”åŸºæœ¬ç±»å‹">stringâ†”åŸºæœ¬ç±»å‹</h5><blockquote><p>stringä¸æ˜¯å†…ç½®ç±»å‹ï¼Œä½¿ç”¨static_castæ˜¯ä¸è¡Œçš„ï¼Œæ¯”å¦‚intâ†”stringã€‚</p></blockquote><p>stringâ†”åŸºæœ¬ç±»å‹æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>ä½¿ç”¨è¾“å…¥ã€è¾“å‡ºæµä½œä¸ºåª’ä»‹å®ç°ï¼›</li><li>ä½¿ç”¨C++11<code>std::string</code>å†…ç½®çš„ç›¸å…³å‡½æ•°å®ç°ã€‚</li></ol><p>ä¸ºäº†é€šç”¨æ€§ï¼Œæˆ‘ä»¬å…ˆä»‹ç» <code>std::istringstream</code>å’Œ<code>std::ostringstream</code>  ä½œä¸ºåª’ä»‹å¦‚ä½•å®ç°è½¬æ¢ã€‚</p><ul><li><code>std::istringstream</code> ï¼Œå³è¾“å…¥æµï¼šæ„é€ å‡½æ•°<u>æ¥å—æ•°æ®çš„è¾“å…¥</u>ï¼Œç„¶åä½¿ç”¨<code>&gt;&gt;</code> æå–æµä¸­æ•°æ®ï¼›</li><li><code>std::ostringstream</code> ï¼Œå³è¾“å‡ºæµï¼šä½¿ç”¨<code>&lt;&lt;</code> æ¥å—æ•°æ®çš„è¾“å…¥ï¼Œä½¿ç”¨æˆå‘˜æ–¹æ³•å¦‚<code>str()</code> æå–æµä¸­æ•°æ®ã€‚</li></ul><p>ä¸‹é¢æ˜¯å…·ä½“å®ä¾‹ã€‚</p><ul><li><p><strong>stringâ†’åŸºæœ¬ç±»å‹</strong></p><p>åŸºæœ¬æ€è·¯ï¼šç”¨stringå¯¹è±¡åˆå§‹åŒ–<u>è¾“å…¥</u>æµ â†’ è¾“å…¥æµå†™å…¥<code>&gt;&gt;</code>å…¶å®ƒç±»å‹ä¸­ï¼ˆstringæ­¤æ—¶ä¼šè¢«è‡ªåŠ¨è½¬æ¢ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;           </span><br><span class="line">    std::string str = <span class="string">&quot;233&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="function">std::istringstream <span class="title">iStream</span><span class="params">(str)</span></span>;</span><br><span class="line">    iStream&gt;&gt;a;   <span class="comment">// è¾“å‡ºæµè‡ªåŠ¨è½¬æ¢</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>stringâ†åŸºæœ¬ç±»å‹</strong></p><p>åŸºæœ¬æ€è·¯ï¼šç”¨<code>&lt;&lt;</code>åˆå§‹åŒ–<u>è¾“å‡º</u>æµ â†’ è¾“å‡ºæµå¯¹è±¡è°ƒç”¨<code>str()</code>æ–¹æ³•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> b = <span class="number">233</span>;</span><br><span class="line">std::ostringstream oStream;</span><br><span class="line">oStream&lt;&lt;b;</span><br><span class="line">oStream.<span class="built_in">str</span>();</span><br></pre></td></tr></table></figure></li></ul><p><strong>å¥½æ¶ˆæ¯ï¼ŒC++11ç»™å¹¿å¤§ç¨‹åºå‘˜å¸¦æ¥äº†ç¦éŸ³ï¼Œæä¾›äº†å¤§é‡å·²ç»å®šä¹‰å¥½çš„æ–¹æ³•</strong>ã€‚</p><blockquote><p>æ›´å¤šä»‹ç»ï¼Œå¯å‚è€ƒï¼š<a href="https://blog.csdn.net/lmb1612977696/article/details/78273629">c++ stringå’Œå…¶ä»–ç±»å‹äº’è½¬</a></p></blockquote><p>ä½†æ³¨æ„ï¼Œcharâ†”stringçš„è½¬æ¢æ–¹æ³•æœªå®ç°ï¼Œæˆ‘ä»¬å¯ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®ç°è½¬æ¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> c = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">std::string str = c;  <span class="comment">// char â†’ string</span></span><br><span class="line"></span><br><span class="line">c = str[<span class="number">0</span>];  <span class="comment">// string â†’ char</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¯¹å¸¸ç”¨çš„è½¬æ¢æ–¹æ³•è¿›è¡Œä»‹ç»ã€‚</p><ul><li><p><strong>stringâ†’åŸºæœ¬ç±»å‹</strong></p><p>å¸¸ç”¨æ–¹æ³•åŸå‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stringâ†’int</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">stoi</span><span class="params">( <span class="keyword">const</span> std::string&amp; str, std::<span class="keyword">size_t</span>* pos = <span class="number">0</span>, <span class="keyword">int</span> base = <span class="number">10</span> )</span></span>;</span><br><span class="line"><span class="comment">// stringâ†’long</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">stol</span><span class="params">( <span class="keyword">const</span> std::string&amp; str, std::<span class="keyword">size_t</span>* pos = <span class="number">0</span>, <span class="keyword">int</span> base = <span class="number">10</span> )</span></span>;</span><br><span class="line"><span class="comment">// stringâ†’float</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">stof</span><span class="params">( <span class="keyword">const</span> std::string&amp; str, std::<span class="keyword">size_t</span>* pos = <span class="number">0</span> )</span></span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å®ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   std::string str = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">   <span class="keyword">int</span> a = std::<span class="built_in">stoi</span>(str);</span><br><span class="line">   <span class="keyword">int</span> <span class="keyword">float</span> = std::<span class="built_in">stof</span>(str);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>stringâ†åŸºæœ¬ç±»å‹</strong></p><p>å¸¸ç”¨æ–¹æ³•åŸå‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°é‡è½½</span></span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">( <span class="keyword">int</span> value )</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">( <span class="keyword">long</span> value )</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">( <span class="keyword">float</span> value )</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">to_string</span><span class="params">( <span class="keyword">double</span> value )</span></span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å®ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">   std::string str1 = std::<span class="built_in">to_string</span>(a);</span><br><span class="line">   <span class="keyword">float</span> b = <span class="number">1.2</span>;</span><br><span class="line">   std::string str1 = std::<span class="built_in">to_string</span>(b);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="stringâ†”char">stringâ†”char[]</h5><p>stringå’Œchar[]æ•°ç»„ä¹‹é—´çš„è½¬æ¢æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºstringå†…ç½®äº†ç›¸å…³æ–¹æ³•ã€‚</p><ul><li><p><strong>char[] â†’ string</strong></p><p>stringæ„é€ å‡½æ•°æ¥å—char[]å­—ç¬¦ä¸²ï¼š<code>string::string(const char* szCString)</code> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> c_arr[] = <span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line">std::string str&#123;c_arr&#125;;  <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">std::string str = c_arr; <span class="comment">// é‡è½½è¿ç®—ç¬¦= </span></span><br></pre></td></tr></table></figure></li><li><p><strong>char[] â† string</strong></p><p>stringåŒæ ·æä¾›äº†<code>c_str()</code> å’Œ <code>data()</code> ç­‰æ–¹æ³•ï¼Œæ³¨æ„è¿”å›ç±»å‹ï¼šä¸èƒ½æ˜¯æ•°ç»„ï¼ˆæ•°ç»„ä¸æ˜¯æŒ‡é’ˆï¼Œä¸èƒ½æ¥å—æŒ‡é’ˆç±»å‹åˆå§‹åŒ–ï¼‰ï¼Œä¸”è¦æ±‚æ˜¯å¸¸é‡ã€‚</p><p>åŸå‹ï¼š<code>const char* string::c_str () const</code> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::string str = <span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> len = str.<span class="built_in">length</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* c_arr = <span class="keyword">new</span> <span class="keyword">char</span>[len+<span class="number">1</span>]; <span class="comment">// æ³¨æ„å…ˆåˆå§‹åŒ–</span></span><br><span class="line"><span class="built_in">strncpy</span>(c_arr, str.<span class="built_in">c_str</span>(),len+<span class="number">1</span>); <span class="comment">// cstring</span></span><br></pre></td></tr></table></figure><p>åŸå‹ï¼š<code>const char* string::data() const</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::string str = <span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> len = str.<span class="built_in">length</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* c_arr = <span class="keyword">new</span> <span class="keyword">char</span>[len+<span class="number">1</span>]; <span class="comment">// æ³¨æ„å…ˆåˆå§‹åŒ–</span></span><br><span class="line"><span class="built_in">strncpy</span>(c_arr, str.<span class="built_in">data</span>(),len+<span class="number">1</span>); <span class="comment">// cstring</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœæ¶‰åŠåˆ°å­—ç¬¦ä¸²åˆ†éš”ç¬¦ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ç‚¹ï¼Œå‚è€ƒä¸‹æ–‡å¤„ç†ã€‚</p></li></ul><h5 id="stringâ†’å…¶å®ƒç±»å‹æ•°ç»„">stringâ†’å…¶å®ƒç±»å‹æ•°ç»„</h5><p><strong>å¦‚æœæ˜¯åˆ†å‰²æ¯ä¸€ä¸ªå­—ç¬¦ä¸ºæ•°ç»„å…ƒç´ ï¼Œå¯ä»¥è½¬æ¢ä¸ºï¼šstringâ†’char[]â†’å…¶å®ƒç±»å‹æ•°ç»„</strong>ã€‚</p><p>ä¸‹é¢å±•ç¤ºäº†ï¼šstringâ†’int[] ï¼Œè¿™é‡Œä½¿ç”¨äº†å®¹å™¨vectorã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string str = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">    std::vector&lt;<span class="keyword">int</span>&gt; i_arr;</span><br><span class="line">    i_arr.<span class="built_in">reserve</span>(<span class="number">10</span>); <span class="comment">// tipsï¼šé¢„å…ˆåˆ†é…ä¸€äº›ç©ºé—´</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.å…ˆè½¬æ¢ä¸ºcharæ•°ç»„</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* c_arr = str3.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="comment">// 2.charæ•°ç»„å†è½¬æ¢ä¸ºå…¶å®ƒç±»å‹æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">char</span> c:str3)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„æ˜¯c-&#x27;0&#x27;ï¼Œä¸æ˜¯static_cast&lt;int&gt;(c)</span></span><br><span class="line">        <span class="comment">// c-&#x27;0&#x27;ç®—æœ¯ç±»å‹æå‡ä¸ºint</span></span><br><span class="line">        i_arr.<span class="built_in">push_back</span>(c-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>stringâ†å…¶å®ƒç±»å‹æ•°ç»„ï¼Œæ²¡å•¥æ„ä¹‰ä¸€èˆ¬å¾ˆå°‘éœ€è¦</strong>ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a[] = &#123;<span class="number">45</span>,<span class="number">45</span>,<span class="number">67</span>,<span class="number">144</span>&#125;;</span><br></pre></td></tr></table></figure><p>è½¬æ¢ä¸º<code>454567144</code> æœ‰å•¥ç”¨å‘¢ï¼Ÿä¸€èˆ¬ä¸éœ€è¦è¿™ä¹ˆåšã€‚æ›´å¤šçš„åè€Œæ˜¯æ€ä¹ˆå°†ä¸€ä¸ªintç±»å‹è½¬æ¢stringã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">2</span>;</span><br><span class="line">string str = std::<span class="built_in">to_string</span>(i);</span><br></pre></td></tr></table></figure><p><strong>å…¶å®ä¸Šé¢ä»‹ç»éƒ½æ˜¯å¾ˆç‰¹æ®Šçš„stringâ†’æ•°ç»„æƒ…å†µï¼šåˆ†å‰²æ¯ä¸€ä¸ªå­—ç¬¦ä¸ºæ•°ç»„å…ƒç´ ã€‚ä½†å¾€å¾€æˆ‘ä»¬éœ€è¦å¤„ç†çš„æ˜¯å¦‚ä½•æŒ‰æŒ‡å®šè§„åˆ™åˆ†å‰²<u>å­ä¸²</u>ä¸ºæ•°ç»„å…ƒç´ </strong>ï¼š</p><p>æ¯”å¦‚ï¼Œå¦‚ä½•å°†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string str = <span class="string">&quot;12,45,56&quot;</span> ;</span><br></pre></td></tr></table></figure><p>è½¬æ¢ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = &#123;<span class="number">12</span>,<span class="number">45</span>,<span class="number">56</span>&#125;;</span><br></pre></td></tr></table></figure><p>æœ€å¸¸è§çš„ä¾¿æ˜¯<u>æŒ‰æŒ‡å®šåˆ†éš”ç¬¦æ¥åˆ†å‰²å­—ç¬¦ä¸²</u>ä¸ºæ–°æ•°ç»„å…ƒç´ ã€‚</p><h5 id="stringæŒ‡å®šåˆ†å‰²â†’æ•°ç»„">stringæŒ‡å®šåˆ†å‰²â†’æ•°ç»„</h5><p>å¯¹äºæŒ‡å®šåˆ†éš”ç¬¦æ¥åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå†è½¬æ¢ä¸ºæ•°ç»„ã€‚ä¸€èˆ¬è€Œè¨€æœ‰å¦‚ä¸‹æ€è·¯ï¼š</p><ol><li>é€šè¿‡stringæˆå‘˜å‡½æ•°ï¼šfind+substrå‡½æ•°ï¼›</li><li>é€šè¿‡Cè¯­è¨€ä¸­åˆ†å‰²å‡½æ•°ï¼šstrtokå‡½æ•°ï¼›</li><li>é€šè¿‡stringstreamå®ç°ã€‚</li></ol><p>è¿™é‡Œä¸»è¦ä»‹ç»ç¬¬1ç§ï¼Œå®Œæ•´çš„ä»‹ç»å¯å‚è€ƒï¼š<a href="https://www.jianshu.com/p/5876a9f49413">C++å­—ç¬¦ä¸²åˆ†å‰²æ–¹æ³•æ€»ç»“</a> ã€‚</p><ul><li>findå‡½æ•°åŸå‹ï¼š <code>size_t find (const string&amp; str, size_t pos = 0) const;</code>ï¼›</li><li>substrå‡½æ•°åŸå‹ï¼š <code>string substr (size_t pos = 0, size_t len = npos) const;</code> ã€‚</li></ul><p><strong>ä»¥stringâ†’int[]ä¸ºä¾‹</strong> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">      std::string str = <span class="string">&quot;12,45,56&quot;</span> ;</span><br><span class="line">      std::vector&lt;<span class="keyword">int</span>&gt; arr;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">const</span> std::string pattern = <span class="string">&quot;,&quot;</span>;</span><br><span class="line">      str += pattern;   <span class="comment">// æ–¹ä¾¿å¤„ç†æœ€åä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">      <span class="keyword">size_t</span>  pre_pos = <span class="number">0</span>; </span><br><span class="line">      <span class="keyword">size_t</span>  pos = str.<span class="built_in">find</span>(pattern);</span><br><span class="line">      <span class="keyword">while</span> (pos != str.npos) <span class="comment">// å¦‚æœæ²¡æ‰¾åˆ°åˆ†éš”ç¬¦åˆ™ç»ˆæ­¢</span></span><br><span class="line">      &#123;</span><br><span class="line">          string temp = str.<span class="built_in">substr</span>(pre_pos,pos);</span><br><span class="line">          arr.<span class="built_in">push_back</span>(std::<span class="built_in">stoi</span>(temp));</span><br><span class="line">          <span class="comment">// ä¿ç•™å‰©ä¸‹çš„å­—ç¬¦ä¸²ä½œä¸ºæ–°ä¸²</span></span><br><span class="line">          str = str.<span class="built_in">substr</span>(pos+<span class="number">1</span>,str.<span class="built_in">length</span>());</span><br><span class="line">          <span class="comment">// æŸ¥æ‰¾æ–°å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦çš„ä½ç½®</span></span><br><span class="line">          pos = str.<span class="built_in">find</span>(pattern); </span><br><span class="line">      &#125; </span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="leetcodeå®æˆ˜">leetcodeå®æˆ˜</h5><p>ä»¥ç»å…¸é¢˜å‹ä¸ºä¾‹ï¼Œå°†ä¸‹é¢è½¬æ¢ä¸ºå¤šç»´æ•°ç»„ï¼Œç¬¬ä¸€è¡Œè¾“å…¥çš„æ˜¯é•¿åº¦ã€‚</p><blockquote><p>3</p><p>11  12  13</p><p>14  15   16</p><p>17   18  19</p></blockquote><p>å®Œæ•´å®ç°ä»£ç å¦‚ä¸‹ï¼šå¯è§å…³é”®æ˜¯å¦‚ä½•å®ç°åˆ†å‰²å­—ç¬¦ä¸²çš„å‡½æ•°ï¼ˆé¢è¯•æ—¶è¿™ç§å¸¸ç”¨å‡½æ•°æœ€å¥½ç›´æ¥èƒŒä¸‹ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">strSplit</span><span class="params">(<span class="keyword">const</span> std::string src_str, vector&lt;<span class="keyword">int</span>&gt;&amp; vec, <span class="keyword">const</span> string pattern)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    std::string str = src_str;</span><br><span class="line">    str += pattern;   <span class="comment">// æ–¹ä¾¿å¤„ç†æœ€åä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">size_t</span>  pre_pos = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">size_t</span>  pos = str.<span class="built_in">find</span>(pattern);</span><br><span class="line">    <span class="keyword">while</span> (pos != str.npos) <span class="comment">// å¦‚æœæ²¡æ‰¾åˆ°åˆ†éš”ç¬¦åˆ™ç»ˆæ­¢</span></span><br><span class="line">    &#123;</span><br><span class="line">        string temp = str.<span class="built_in">substr</span>(pre_pos,pos);</span><br><span class="line">        vec.<span class="built_in">push_back</span>(std::<span class="built_in">stoi</span>(temp));</span><br><span class="line">        <span class="comment">// ä¿ç•™å‰©ä¸‹çš„å­—ç¬¦ä¸²ä½œä¸ºæ–°ä¸²</span></span><br><span class="line">        str = str.<span class="built_in">substr</span>(pos+<span class="number">1</span>,str.<span class="built_in">length</span>());</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾æ–°å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦çš„ä½ç½®</span></span><br><span class="line">        pos = str.<span class="built_in">find</span>(pattern); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">      <span class="keyword">int</span> N = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// std::getline(std::cin,N); // getlineä¸èƒ½æ¥å—ç±»å‹intçš„å‚æ•°</span></span><br><span class="line">      std::cin&gt;&gt;N;</span><br><span class="line">      std::cin.<span class="built_in">ignore</span>(); <span class="comment">// è¯»å–åé¢çš„æ¢è¡Œç¬¦ï¼Œgetlineä¸éœ€è¦å¤„ç†è¿™ä¸ªé—®é¢˜</span></span><br><span class="line">      </span><br><span class="line">      vector&lt;vector&lt;<span class="keyword">int</span>&gt;&gt; array ; <span class="comment">// vectoræ¯”å†…ç½®æ•°ç»„å¥½ç”¨</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ; i&lt;N ; i++)</span><br><span class="line">      &#123;</span><br><span class="line">           std::string cur_line;</span><br><span class="line">           std::<span class="built_in">getline</span>(cin,cur_line);</span><br><span class="line">           vector&lt;<span class="keyword">int</span>&gt; vec_tmp ;</span><br><span class="line">           <span class="built_in">strSplit</span>(cur_line,vec_tmp,<span class="string">&quot; &quot;</span>);</span><br><span class="line">           array.<span class="built_in">push_back</span>(vec_tmp);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æœ€ä½³å®è·µ-5">æœ€ä½³å®è·µ</h5><p>ä¸æ¶‰åŠåˆ°æ•°ç»„ï¼š</p><ul><li><p><strong>å¦‚æœæ˜¯åŸºæœ¬ç±»å‹ä¹‹é—´çš„äº’è½¬</strong>ï¼Œéšå¼è½¬æ¢è™½ç„¶ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æœ€å¥½ä½¿ç”¨<code>static_cast</code>æ˜¾å¼è½¬æ¢ï¼›</p><p>ä¸è¿‡éœ€è¦æ³¨æ„charâ†”intä¹‹é—´çš„è½¬æ¢ï¼Œä¹Ÿè®¸ä½ å¹¶ä¸éœ€è¦charç±»å‹çš„ASCIIå€¼ã€‚</p></li><li><p><strong>å¦‚æœæ˜¯æŒ‡é’ˆã€å¼•ç”¨ã€å¤šæ€ã€å¸¸é‡è½¬éå¸¸é‡ä¹‹é—´çš„è½¬æ¢</strong>ï¼Œè¯·ä½¿ç”¨æ˜¾ç¤ºè½¬æ¢ï¼›</p></li><li><p><strong>å¦‚æœstringå’ŒåŸºæœ¬ç±»å‹è½¬æ¢</strong>ï¼Œä½¿ç”¨<code>std::string</code> å†…ç½®çš„å‡½æ•°åº“æ•ˆç‡æœ€é«˜ã€‚</p></li></ul><p>æ¶‰åŠåˆ°æ•°ç»„ï¼š</p><ul><li><strong>å¦‚æœæ˜¯stringâ†”char[]ï¼Œä¸æ¶‰åŠåˆ°åˆ†å‰²å­ä¸²</strong>ï¼Œä½¿ç”¨<code>std::string</code> å†…ç½®å‡½æ•°å¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡Œè½¬æ¢ï¼›</li><li><strong>å¦‚æœæ˜¯stringâ†’å…¶å®ƒç±»å‹æ•°ç»„ï¼ˆå•å‘ï¼Œåå‘æ²¡å¤šå¤§æ„ä¹‰ï¼‰ï¼Œä¸æ¶‰åŠåˆ°åˆ†å‰²å­ä¸²</strong> ï¼ŒæŒ‰stringâ†’char[]â†’å…¶å®ƒç±»å‹æ•°ç»„è½¬æ¢å³å¯ï¼›</li><li><strong>å¦‚æœæ˜¯stringâ†’å…¶å®ƒç±»å‹æ•°ç»„ï¼ˆå•å‘ï¼‰ï¼Œæ¶‰åŠåˆ°åˆ†å‰²å­ä¸²</strong> ï¼š<ul><li>å…ˆå€ŸåŠ©findå’Œsubstrå‡½æ•°åˆ‡å‰²å‡ºå­ä¸²æ•°ç»„ï¼ˆstring[]ï¼‰ï¼›</li><li>å†å°†æ¯ä¸ªå­ä¸²è½¬æ¢ä¸ºå…¶å®ƒç±»å‹ï¼ˆå†…ç½®å‡½æ•°å®ç°ï¼Œå¦‚stoiï¼‰ã€‚</li></ul></li></ul><p>æœ€åï¼Œè¯·å°½é‡é¿å…ä½¿ç”¨éšå¼è½¬æ¢ã€‚</p><h2 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h2><div class="timeline"><div class="timenode"><div class="meta"><p><p>2022-01-22 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ç¬¬ä¸€æ¬¡æ›´æ–°</li></ol></div></div></div><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ä¸­å·²ç»æœ‰é¢å‘å¯¹è±¡çš„æ¦‚å¿µï¼Œé‚£structè¿˜æœ‰å•¥å­˜åœ¨çš„æ„å›¾ï¼šhttps://www.zhihu.com/question/23174488<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ä¸­å››ç§å¼ºåˆ¶ç±»å‹è½¬æ¢åŒºåˆ«è¯¦è§£ï¼šhttps://blog.csdn.net/chen134225/article/details/81305049<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">æ²¡æœ‰å­¦ä¸ä¼šçš„C++ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„éšå¼ç±»å‹è½¬æ¢ ï¼šhttps://juejin.cn/post/6844903798100459533<a href="#fnref:3" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++åŸºç¡€ </tag>
            
            <tag> ç»“æ„ä½“ </tag>
            
            <tag> æšä¸¾ </tag>
            
            <tag> ç±»å‹è½¬æ¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŠ¡å®åŸºç¡€ï¼ˆä¸Šï¼‰å¿«é€Ÿå…¥é—¨</title>
      <link href="/p/26224/"/>
      <url>/p/26224/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><h2 id="ä¸€ã€å¿«é€Ÿå¼€å§‹">ä¸€ã€å¿«é€Ÿå¼€å§‹</h2><h3 id="1-1-è®¤è¯†C">1.1 è®¤è¯†C++</h3><h4 id="1-1-1-ä¸ºä»€ä¹ˆéœ€è¦C">1.1.1 ä¸ºä»€ä¹ˆéœ€è¦C++</h4><p>å‰æœ‰Javaåæœ‰Pythonã€Goã€Rustï¼ŒC++ä½œä¸ºä¸€ä¸ªâ€œè€å¤è‘£â€ä¼¼ä¹æœ‰ç‚¹æ ¼æ ¼ä¸å…¥äº†ï¼Ÿ</p><p>å…¶å®ä¸ç„¶ï¼ŒC å’Œ C++ çš„åº•å±‚è®¾è®¡ç†å¿µå¯ä»¥æ¦‚æ‹¬ä¸ºâ€œä¿¡ä»»ç¨‹åºå‘˜â€â€”â€”è¿™æ—¢ç¾å¦™åˆå±é™©ã€‚ä½†ä¹Ÿæ­£æ˜¯C++ å…è®¸ç¨‹åºå‘˜é«˜åº¦è‡ªç”±åœ°åšä»–ä»¬æƒ³åšçš„äº‹ï¼Œå› æ­¤ï¼Œ<strong>åœ¨éœ€è¦é«˜æ€§èƒ½å’Œç²¾ç¡®æ§åˆ¶å†…å­˜å’Œå…¶ä»–èµ„æºçš„æƒ…å†µä¸‹è¡¨ç°å‡ºè‰²</strong> ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯C++æ“…é•¿çš„ä¸€äº›é¢†åŸŸï¼Œå®ƒä»¬å¯¹æ€§èƒ½è¦æ±‚é€šå¸¸æå…¶è‹›åˆ»ï¼š</p><ul><li>è§†é¢‘æ¸¸æˆ</li><li>å®æ—¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ç”¨äºè¿è¾“ã€åˆ¶é€ ç­‰â€¦â€¦ï¼‰</li><li>é«˜æ€§èƒ½é‡‘èåº”ç”¨ï¼ˆä¾‹å¦‚é«˜é¢‘äº¤æ˜“ï¼‰</li><li>å›¾å½¢åº”ç”¨å’Œæ¨¡æ‹Ÿ</li><li>ç”Ÿäº§åŠ›/åŠå…¬åº”ç”¨</li><li>åµŒå…¥å¼è½¯ä»¶</li><li>éŸ³è§†é¢‘å¤„ç†</li><li>äººå·¥æ™ºèƒ½å’Œç¥ç»ç½‘ç»œ</li></ul><p>å¦‚æœä½ æƒ³æ›´äº†è§£è®¡ç®—æœºçš„æœ¬è´¨ï¼Œä¹Ÿå¯¹è¿™äº›é¢†åŸŸæ„Ÿå…´è¶£ï¼ŒC/C++åº”è¯¥æ˜¯ä½ ä¸äºŒçš„é€‰æ‹©ã€‚</p><h4 id="1-1-2-C-ç»„æˆ">1.1.2 C++ç»„æˆ</h4><p>æ ‡å‡†çš„C++ç”±ä¸¤ä¸ªé‡è¦éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>æ ¸å¿ƒè¯­è¨€</strong>ï¼Œæä¾›äº†æ‰€æœ‰æ„ä»¶å—ï¼ŒåŒ…æ‹¬å˜é‡ã€æ•°æ®ç±»å‹å’Œå¸¸é‡ç­‰ç­‰ã€‚</li><li><strong>C++ æ ‡å‡†åº“</strong>ï¼Œæä¾›äº†å¤§é‡çš„å‡½æ•°ï¼Œç”¨äºæ“ä½œæ–‡ä»¶ã€å­—ç¬¦ä¸²ç­‰ï¼ŒåŒ…å«<strong>æ ‡å‡†æ¨¡æ¿åº“</strong>ï¼ˆSTLï¼‰ï¼Œæä¾›äº†å¤§é‡çš„æ–¹æ³•ï¼Œç”¨äºæ“ä½œæ•°æ®ç»“æ„ç­‰ã€‚</li></ul><p>C++ æ ‡å‡†åº“ç®€å•æ¥è¯´å°±æ˜¯æä¾›ä¸€äº›é¢„å®šçš„åº“åŠå‡½æ•°ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç¼–å†™ä»£ç ã€‚æ•´ä½“å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li><strong>æ ‡å‡†å‡½æ•°åº“</strong>ï¼š è¿™ä¸ªåº“æ˜¯ç”±é€šç”¨çš„ã€ç‹¬ç«‹çš„ã€<u>ä¸å±äºä»»ä½•ç±»çš„å‡½æ•°</u>ç»„æˆçš„ï¼Œå‡½æ•°åº“ç»§æ‰¿è‡ª C è¯­è¨€ã€‚<ul><li>è¾“å…¥/è¾“å‡º I/Oã€å­—ç¬¦ä¸²å’Œå­—ç¬¦å¤„ç†ã€æ•°å­¦ã€æ—¶é—´ã€æ—¥æœŸå’Œæœ¬åœ°åŒ–ã€åŠ¨æ€åˆ†é…ã€å…¶ä»–ã€å®½å­—ç¬¦å‡½æ•°</li></ul></li><li><strong>é¢å‘å¯¹è±¡ç±»åº“</strong>ï¼š è¿™ä¸ªåº“æ˜¯ç±»åŠå…¶ç›¸å…³å‡½æ•°çš„é›†åˆã€‚<ul><li>æ ‡å‡†çš„ C++ I/O ç±»ã€String ç±»ã€æ•°å€¼ç±»ã€STL å®¹å™¨ç±»ã€STL ç®—æ³•ã€STL å‡½æ•°å¯¹è±¡ã€STL è¿­ä»£å™¨ã€STL åˆ†é…å™¨ã€æœ¬åœ°åŒ–åº“ã€å¼‚å¸¸å¤„ç†ç±»ã€æ‚é¡¹æ”¯æŒåº“</li></ul></li></ol><p>åŒæ—¶ï¼Œä¸ºäº†ç¼–å†™çš„ä»£ç åœ¨ Macã€UNIXã€Windowsã€Alpha è®¡ç®—æœºä¸Šéƒ½èƒ½é€šè¿‡ç¼–è¯‘ï¼Œ C++ é‡‡ç”¨<strong>ISOæ ‡å‡†</strong>ã€‚</p><p>ISOæ ‡å‡†å‘å±•å†å²ä¸€è§ˆå¦‚ä¸‹ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/00001_01.png" alt="Modern C++ ä¸­çš„å¤šçº¿ç¨‹| Busyboxs"></p><h4 id="1-1-3-ç¬¬ä¸€ä¸ªC-ç¨‹åº">1.1.3 ç¬¬ä¸€ä¸ªC++ç¨‹åº</h4><p>ğŸ–± ä»æ¢¦å¼€å§‹çš„åœ°æ–¹ï¼Œå†™ä¸€ä¸ªç»å…¸<code>hello.cpp</code> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* main() æ˜¯ç¨‹åºå¼€å§‹æ‰§è¡Œçš„åœ°æ–¹ */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout &lt;&lt; <span class="string">&quot;Hello World&quot;</span>&lt;&lt;endl; <span class="comment">// è¾“å‡º Hello World</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¡®ä¿<code>g++</code>ç¨‹åºå¯è¢«è¯†åˆ«ï¼ˆåŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼‰ï¼Œåœ¨åŒ…å«æºæ–‡ä»¶ <code>hello.cpp</code> çš„ç›®å½•ä¸­ï¼Œç¼–è¯‘å¹¶æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ g++ hello.cpp</span><br><span class="line">$ ./a.out</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure><p><code>g++</code>ç¼–è¯‘ä»£ç çš„æ–¹å¼å°†åœ¨æœ¬æ–‡å¤§é‡ä½¿ç”¨ï¼Œåœ¨å‰æ–‡ï¼š<a href="https://hwh.zone/p/2834/">g++/Makefile/CMakeå¿«é€Ÿå…¥é—¨</a> ï¼Œæˆ‘ä»¬ä¹Ÿä»”ç»†ä»‹ç»è¿‡ã€‚å¦‚æœè¿˜ä¸å¤ªäº†è§£ï¼Œå¯ä»¥ä¸€è¯»ã€‚</p><p>åœ¨ä¸Šè¿°ç¨‹åºä¸­è¿˜ä½¿ç”¨äº†C++çš„<strong>æ³¨é‡Š</strong>ï¼š</p><ul><li>å•è¡Œæ³¨é‡Šï¼š<code>// æ³¨é‡Šå†…å®¹</code></li><li>å¤šè¡Œæ³¨é‡Šï¼š<code>/* æ³¨é‡Šå†…å®¹ */</code></li></ul><p>ç‰¹åˆ«çš„ï¼Œåœ¨ <code>/* */</code> æ³¨é‡Šå†…éƒ¨ï¼Œ<code>//</code> å­—ç¬¦æ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼›åœ¨ <code>//</code> æ³¨é‡Šå†…ï¼Œ<code>/* */</code> ä¹Ÿæ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚</p><h3 id="1-2-å˜é‡">1.2 å˜é‡</h3><p>â€œå˜é‡â€ä¸€è¯æ¥æºäºæ•°å­¦ï¼Œæ˜¯è®¡ç®—æœºè¡¨ç¤ºèƒ½å‚¨å­˜è®¡ç®—ç»“æœæˆ–èƒ½è¡¨ç¤ºå€¼çš„æŠ½è±¡æ¦‚å¿µï¼Œä½†è¿™ç§è¯´æ³•ä¸å¤Ÿæ·±åˆ»ã€‚</p><p>åº”è¯¥ä»CPUè§’åº¦ç†è§£ï¼Œ<u>å˜é‡</u>å°±æ˜¯æŸå—å†…å­˜åŒºåŸŸ<u>åœ°å€åˆ«å</u>ï¼Œè¿™å—å†…å­˜åŒºåŸŸä¿å­˜å˜é‡çš„å€¼ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªå®ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">x = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>å¯¹åº”æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movl    $0, -12(%rbp)</span><br><span class="line">movl    $1, -12(%rbp)</span><br></pre></td></tr></table></figure><ol><li>å½“CPUæ‰§è¡Œ<code>int x = 0</code>ï¼Œä¼šåœ¨å†…å­˜ï¼ˆè¿™é‡Œæ˜¯æ ˆï¼‰è…¾å‡ºä¸€å—åŒºåŸŸï¼ˆ<code>-12(%rbp)</code>ï¼‰ç”¨æ¥å­˜å‚¨å˜é‡<code>x</code>ï¼›ç„¶å<code>x</code>æ‰€ä»£è¡¨çš„å†…å­˜åŒºåŸŸï¼ˆ<code>-12(%rbp)</code>ï¼‰è¢«å­˜å…¥0ã€‚</li><li>ç»§ç»­æ‰§è¡Œ<code>x=1</code>ï¼Œ1è¢«å­˜å…¥å˜é‡<code>x</code>æ‰€ä»£è¡¨çš„å†…å­˜åŒºåŸŸã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå˜é‡çš„å­˜åœ¨ä½¿å¾—æˆ‘ä»¬ï¼š<strong>ä¸ç”¨è®°ä½ä¸ºåˆ†é…<code>x</code>çš„å†…å­˜åœ°å€æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬é€šè¿‡å˜é‡å<code>x</code>å°±å¯ä»¥ä½¿ç”¨åˆ†é…çš„å†…å­˜åŒºåŸŸ</strong>ã€‚<strong>å› ä¸ºä½¿ç”¨<code>x</code>æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å˜é‡<code>x</code>éšå¼è‡ªåŠ¨ç¿»è¯‘æˆå¯¹åº”çš„å†…å­˜åœ°å€ï¼ŒåŒæ—¶è¿›è¡Œé—´æ¥å¯»å€</strong>ï¼ˆå¯ä»¥ç†è§£ä¸ºä½¿ç”¨<code>x</code>ç­‰ä»·äº<code>*x</code>ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;   <span class="comment">// ç¼–è¯‘å™¨çœ¼é‡Œï¼šint* x = -12(%rbp); *x = 0;</span></span><br><span class="line">x = <span class="number">1</span>;       <span class="comment">// ç¼–è¯‘å™¨çœ¼é‡Œï¼š *x = 1;</span></span><br></pre></td></tr></table></figure><p>è¯´å®Œæ·±å±‚æ¬¡çš„æ¦‚å¿µï¼Œæˆ‘ä»¬æ¥äº†è§£å˜é‡åŸºæœ¬çš„ä¸€äº›å®šä¹‰&amp;ä½¿ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* a simple example*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> c, ch;  <span class="comment">// charç±»å‹å˜é‡c,ch</span></span><br><span class="line"><span class="keyword">int</span> months;   <span class="comment">// intç±»å‹å˜é‡months</span></span><br><span class="line"><span class="comment">/* main() æ˜¯ç¨‹åºå¼€å§‹æ‰§è¡Œçš„åœ°æ–¹ */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span>  empoly_salary = <span class="number">20000</span>; <span class="comment">// intç±»å‹å˜é‡empoly_salary</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç»„æˆå˜é‡çš„åŸºæœ¬ä¸‰è¦ç´ ï¼š<strong>åç§°ã€ç±»å‹åŠå€¼</strong>ã€‚</p><ol><li><p><strong>åç§°</strong>ï¼šå˜é‡çš„åç§°å¯ä»¥ç”±<strong>å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿å­—ç¬¦</strong>ç»„æˆã€‚</p></li><li><p><strong>ç±»å‹</strong>ï¼šç”¨äº<strong>æŒ‡å®šå˜é‡å­˜å‚¨çš„å¤§å°å’Œå¸ƒå±€</strong>ã€‚åœ¨C++ä¸­æœ‰<u>åŸºæœ¬ç±»å‹</u>å’Œå…¶å®ƒçš„å¦‚<u>æšä¸¾</u>ç­‰ç±»å‹ã€‚</p><ul><li><p><strong>åŸºæœ¬ç±»å‹</strong>ï¼šC++ ä¸ƒç§åŸºæœ¬æ•°æ®ç±»å‹å¦‚ä¸‹ã€‚</p><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">å…³é”®å­—</th></tr></thead><tbody><tr><td style="text-align:center">å¸ƒå°”å‹</td><td style="text-align:center">bool</td></tr><tr><td style="text-align:center">å­—ç¬¦å‹</td><td style="text-align:center">char</td></tr><tr><td style="text-align:center">æ•´å‹</td><td style="text-align:center">int</td></tr><tr><td style="text-align:center">æµ®ç‚¹å‹</td><td style="text-align:center">float</td></tr><tr><td style="text-align:center">åŒæµ®ç‚¹å‹</td><td style="text-align:center">double</td></tr><tr><td style="text-align:center">æ— ç±»å‹</td><td style="text-align:center">void</td></tr><tr><td style="text-align:center">å®½å­—ç¬¦å‹</td><td style="text-align:center">wchar_t</td></tr></tbody></table></li><li><p><strong>å…¶å®ƒç±»å‹</strong></p><p>C++ ä¹Ÿå…è®¸å®šä¹‰å„ç§å…¶ä»–ç±»å‹çš„å˜é‡ï¼Œæ¯”å¦‚<strong>æšä¸¾ã€æŒ‡é’ˆã€æ•°ç»„ã€å¼•ç”¨ã€æ•°æ®ç»“æ„ã€ç±»</strong>ç­‰ã€‚è¿™æ˜¯æˆ‘ä»¬åç»­ç¬”è®°ä¼šç»§ç»­æåˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p></li></ul></li></ol><p>åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°äº†å˜é‡ä¸‰è¦ç´ ï¼š<strong>åç§°</strong>ã€<strong>å€¼</strong>å’Œ<strong>ç±»å‹</strong>ã€‚ç”±æ­¤å¯ä»¥å¼•å‘å‡ ä¸ªå°é—®é¢˜ï¼š</p><ul><li><p>C++å˜é‡åç§°æœ‰ä»€ä¹ˆ<strong>å‘½ä»¤è§„åˆ™</strong>æˆ–è§„å¾‹å—ï¼Ÿ</p></li><li><p>C++<strong>ä¸åŒçš„ä½ç½®ï¼ˆå¦‚ï¼Œmainå‡½æ•°ä½“å†…ã€å¤–</strong>ï¼‰å®šä¹‰çš„å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ</p></li><li><p><strong>C++çš„å˜é‡å­˜å‚¨æœ‰ä¸Šé™å—</strong>ï¼Ÿæ¯”å¦‚intç±»å‹çš„å˜é‡æœ€å¤šå¯ä»¥å­˜å‚¨å¤šå¤§çš„æ•°æ®ï¼Ÿ</p></li><li><p>å®é™…å†™ä»£ç ä¸­ï¼Œå˜é‡ä¸ä¸€å®šç«‹é©¬ç»™å®ƒèµ‹å€¼ï¼ˆåˆå§‹åŒ–ï¼‰ï¼Œ<strong>å˜é‡çš„åˆå§‹åŒ–å€¼ä¼šæ˜¯ä»€ä¹ˆå‘¢</strong>ï¼Ÿä¸ºä»€ä¹ˆå¸¸è¯´å˜é‡ä¸åˆå§‹åŒ–æ˜¯ä¸€ä¸ªä¸å¥½çš„è¡Œä¸ºï¼Ÿ</p></li></ul><h4 id="1-2-1-æ ‡è¯†ç¬¦å’Œå‘½ä»¤è§„åˆ™">1.2.1 æ ‡è¯†ç¬¦å’Œå‘½ä»¤è§„åˆ™</h4><p>C++ æ ‡è¯†ç¬¦æ˜¯ç”¨æ¥<strong>æ ‡è¯†å˜é‡ã€å‡½æ•°ã€ç±»ã€æ¨¡å—</strong>ï¼Œæˆ–ä»»ä½•å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰é¡¹ç›®çš„åç§°ã€‚ä¸€ä¸ªæ ‡è¯†ç¬¦<strong>ä»¥å­—æ¯ A-Z æˆ– a-z æˆ–ä¸‹åˆ’çº¿ _ å¼€å§‹ï¼Œåè·Ÿé›¶ä¸ªæˆ–å¤šä¸ªå­—æ¯ã€ä¸‹åˆ’çº¿å’Œæ•°å­—</strong>ï¼ˆ0-9ï¼‰ã€‚</p><p>C++ æ ‡è¯†ç¬¦å†…ä¸å…è®¸å‡ºç°æ ‡ç‚¹å­—ç¬¦ï¼Œæ¯”å¦‚ @ã€&amp; å’Œ %ã€‚C++ æ˜¯åŒºåˆ†å¤§å°å†™çš„ç¼–ç¨‹è¯­è¨€ã€‚å› æ­¤ï¼Œåœ¨ C++ ä¸­ï¼Œ<strong>Manpower</strong> å’Œ <strong>manpower</strong> æ˜¯ä¸¤ä¸ªä¸åŒçš„æ ‡è¯†ç¬¦ã€‚</p><p>ä¸‹é¢åˆ—å‡ºå‡ ä¸ªæœ‰æ•ˆçš„æ ‡è¯†ç¬¦ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mohd       zara    abc   move_name  a_123</span><br><span class="line">myname50   _temp   j     a23b9      retVal</span><br></pre></td></tr></table></figure><h4 id="1-2-2-å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡">1.2.2 å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡</h4><p>ä¸€èˆ¬æ¥è¯´æœ‰ä¸‰ä¸ªåœ°æ–¹å¯ä»¥å£°æ˜å˜é‡ï¼š</p><ul><li><strong>å‡½æ•°æˆ–ä¸€ä¸ªä»£ç å—å†…éƒ¨</strong>ï¼Œç§°ä¸ºå±€éƒ¨å˜é‡ï¼›</li><li><strong>å‡½æ•°å‚æ•°ä¸­</strong>ï¼Œç§°ä¸ºå½¢å¼å‚æ•°ï¼›</li><li><strong>æ‰€æœ‰å‡½æ•°å¤–éƒ¨</strong>ï¼Œç§°ä¸ºå…¨å±€å˜é‡ã€‚</li></ul><p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* a simple example*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mainå‡½æ•°ä½“å¤–ï¼Œå…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> c, ch; </span><br><span class="line"><span class="keyword">int</span> months;        </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span>  empoly_salary = <span class="number">20000</span>;  <span class="comment">// mainå‡½æ•°ä½“å†…ï¼Œå±€éƒ¨å˜é‡</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ã€<strong>æ‰©å±•æ€è€ƒ</strong>ã€‘ç‰¹åˆ«çš„ï¼Œå¦‚æœ<strong>å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡çš„åç§°ç›¸åŒ</strong>ï¼Œè°ƒç”¨æ—¶ä»¥è°çš„å€¼ä¸ºå‡†ï¼Ÿ</p><ul><li>ç­”æ¡ˆï¼šä»¥å±€éƒ¨å˜é‡å€¼ä¸ºå‡†ï¼Œè¯·çœ‹ä¸‹ä¾‹ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mainå‡½æ•°ä½“å¤–ï¼Œå…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> c, ch; </span><br><span class="line"><span class="keyword">int</span> months;        </span><br><span class="line"><span class="keyword">int</span> empoly_salary = <span class="number">24000</span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span>  empoly_salary = <span class="number">20000</span>;  <span class="comment">// mainå‡½æ•°ä½“å†…ï¼Œå±€éƒ¨å˜é‡</span></span><br><span class="line">   cout&lt;&lt; empoly_salary&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è¾“å‡ºå€¼ï¼š20000ã€‚<strong>å±€éƒ¨å˜é‡çš„å€¼ä¼šè¦†ç›–å…¨å±€å˜é‡çš„å€¼</strong>ã€‚</p></li><li><p>ã€<strong>æ·±å…¥æ€»ç»“</strong>ã€‘<strong>å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«å’Œæ€»ç»“</strong></p><ul><li><p><strong>å£°æ˜ä½ç½®ä¸åŒ</strong>ï¼šå±€éƒ¨å˜é‡å£°æ˜åœ¨å‡½æ•°æˆ–ä»£ç å—å†…éƒ¨ï¼›å…¨å±€å˜é‡å£°æ˜åœ¨æ‰€æœ‰å‡½æ•°çš„å¤–éƒ¨ã€‚</p></li><li><p><strong>ç”Ÿå‘½å‘¨æœŸä¸åŒ</strong>ï¼šå…¨å±€å˜é‡éšä¸»ç¨‹åºåˆ›å»ºå’Œåˆ›å»ºï¼Œéšä¸»ç¨‹åºé”€æ¯è€Œé”€æ¯ï¼›å±€éƒ¨å˜é‡åœ¨å±€éƒ¨å‡½æ•°å†…éƒ¨ï¼Œç”šè‡³å±€éƒ¨å¾ªç¯ä½“ç­‰å†…éƒ¨å­˜åœ¨ï¼Œé€€å‡ºå°±ä¸å­˜åœ¨ï¼›</p></li><li><p><strong>ä½¿ç”¨æ–¹å¼ä¸åŒ</strong>ï¼šé€šè¿‡å£°æ˜åå…¨å±€å˜é‡åœ¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥ç”¨åˆ°ï¼Œ<strong>åˆ†é…åœ¨å…¨å±€æ•°æ®æ®µå¹¶ä¸”åœ¨ç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™è¢«åŠ è½½</strong>ï¼›å±€éƒ¨å˜é‡åˆ†é…åœ¨å †æ ˆåŒºï¼Œåªèƒ½åœ¨å±€éƒ¨ä½¿ç”¨ã€‚</p></li></ul></li></ul><h4 id="1-2-3-å˜é‡ç±»å‹">1.2.3 å˜é‡ç±»å‹</h4><h5 id="ä¸ƒç§åŸºæœ¬ç±»å‹">ä¸ƒç§åŸºæœ¬ç±»å‹</h5><p>åœ¨å‰é¢æˆ‘ä»¬æåˆ°ï¼š</p><ul><li><p>å˜é‡å…¶å®åªä¸è¿‡æ˜¯ç¨‹åºå¯æ“ä½œçš„å­˜å‚¨åŒºçš„åç§°ï¼Œç±»å‹å†³å®šäº†å˜é‡å­˜å‚¨çš„å¤§å°å’Œå¸ƒå±€ã€‚</p></li><li><p>C++æœ‰ä¸ƒç§åŸºæœ¬ç±»å‹</p><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">å…³é”®å­—</th></tr></thead><tbody><tr><td style="text-align:center">å¸ƒå°”å‹</td><td style="text-align:center">bool</td></tr><tr><td style="text-align:center">å­—ç¬¦å‹</td><td style="text-align:center">char</td></tr><tr><td style="text-align:center">æ•´å‹</td><td style="text-align:center">int</td></tr><tr><td style="text-align:center">æµ®ç‚¹å‹</td><td style="text-align:center">float</td></tr><tr><td style="text-align:center">åŒæµ®ç‚¹å‹</td><td style="text-align:center">double</td></tr><tr><td style="text-align:center">æ— ç±»å‹</td><td style="text-align:center">void</td></tr><tr><td style="text-align:center">å®½å­—ç¬¦å‹</td><td style="text-align:center">wchar_t</td></tr></tbody></table></li></ul><p>è¿™äº›åŸºæœ¬ç±»å‹å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹ä¿®é¥°ç¬¦è¿›è¡Œä¿®é¥°ï¼š</p><ul><li>signedã€unsignedã€shortã€long</li></ul><p>ä¾‹å¦‚ï¼Œ wchar_t æ˜¯è¿™æ ·æ¥çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">short</span> <span class="keyword">int</span> <span class="keyword">wchar_t</span>;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ wchar_t å®é™…ä¸Šå’Œ short int ä¸€æ ·ã€‚</p><p>æ¯ç§ç±»å‹éœ€å ç”¨ä¸åŒçš„å­—èŠ‚æ•°ï¼Œå­˜å‚¨ä¸Šä¸‹é™å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">æè¿°</th><th style="text-align:center">å–å€¼èŒƒå›´</th><th style="text-align:center">å­—èŠ‚æ•°</th></tr></thead><tbody><tr><td style="text-align:center"><strong>int</strong></td><td style="text-align:center">æ•´å‹ï¼Œè¡¨ç¤ºæ•´æ•°</td><td style="text-align:center">-2^-31^ ~ 2^31^-1</td><td style="text-align:center"><strong>4</strong></td></tr><tr><td style="text-align:center">unsigned int</td><td style="text-align:center">æ— ç¬¦å·æ•´å‹ï¼Œè¡¨ç¤ºæ•´æ•°</td><td style="text-align:center">0 ~ 2^32^-1</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">bool</td><td style="text-align:center">å¸ƒå°”ç±»å‹</td><td style="text-align:center">trueæˆ–false</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">char</td><td style="text-align:center">å­—ç¬¦ç±»å‹ï¼Œæ˜¯<strong>æ•´å‹</strong></td><td style="text-align:center">-128~127</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">unsigned char</td><td style="text-align:center">æ— ç¬¦å·å­—ç¬¦ç±»å‹ï¼Œæ˜¯<strong>æ•´å‹</strong></td><td style="text-align:center">0~255</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center"><strong>float</strong></td><td style="text-align:center">å•ç²¾åº¦æµ®ç‚¹å€¼ï¼Œè¡¨ç¤ºå®æ•°</td><td style="text-align:center">3.4Ã—10^-38^ ~ 3.4Ã—10^38^</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center"><strong>double</strong></td><td style="text-align:center">åŒç²¾åº¦æµ®ç‚¹å€¼ï¼Œè¡¨ç¤ºå®æ•°</td><td style="text-align:center">1.7Ã—10^-308^ ~ 1.7Ã—10^308^</td><td style="text-align:center">8</td></tr><tr><td style="text-align:center"><strong>long</strong></td><td style="text-align:center">é•¿æ•´å‹</td><td style="text-align:center">-2^-31^ ~ 2Ã—10^31^-1</td><td style="text-align:center"><strong>4</strong></td></tr><tr><td style="text-align:center">unsigned long</td><td style="text-align:center">æ— ç¬¦å·é•¿æ•´å‹</td><td style="text-align:center">0 ~ 2^32^-1</td><td style="text-align:center">4</td></tr><tr><td style="text-align:center">unsigned long long</td><td style="text-align:center">æ— ç¬¦å·é•¿æ•´å‹ï¼Œ64ä½</td><td style="text-align:center">0 ~ 2Ã—10^64^-1</td><td style="text-align:center">8</td></tr><tr><td style="text-align:center"><strong>short</strong></td><td style="text-align:center">çŸ­æ•´å‹</td><td style="text-align:center">-2^-15^ ~ 2^15^-1</td><td style="text-align:center">2</td></tr><tr><td style="text-align:center">unsigned short</td><td style="text-align:center">æ— ç¬¦å·çŸ­æ•´å‹</td><td style="text-align:center">0 ~ 2^16^-1</td><td style="text-align:center">2</td></tr></tbody></table><h5 id="å¦‚ä½•æ¯”è¾ƒæµ®ç‚¹å˜é‡ï¼Ÿ">å¦‚ä½•æ¯”è¾ƒæµ®ç‚¹å˜é‡ï¼Ÿ</h5><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„å°é—®é¢˜ï¼Œå®ƒæ¶‰åŠåˆ°è®¡ç®—æœºä¸€äº›åº•å±‚è¡¨ç¤ºã€‚</p><p><strong>æ°¸è¿œä¸è¦ä½¿ç”¨<code>==</code> æ¯”è¾ƒä¸¤ä¸ªæµ®ç‚¹å˜é‡ï¼Œå› ä¸ºè®¡ç®—æœºä¸èƒ½ç²¾ç¡®è¡¨ç¤ºé2çš„æŒ‡æ•°å¹‚å°æ•°</strong>ã€‚</p><p>ä½ æˆ–è®¸è¡¨ç¤ºç–‘é—®ï¼šç›´æ¥<code>==</code>æ¯”è¾ƒä¸å¯ä»¥å—ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> a = <span class="number">2.33</span>;</span><br><span class="line"><span class="keyword">float</span> b = <span class="number">2.33</span>;</span><br><span class="line"><span class="keyword">if</span>( a == b)</span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;<span class="string">&quot;ä¸ç›¸ç­‰&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;<span class="string">&quot;ç›¸ç­‰&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç›¸ç­‰</span><br></pre></td></tr></table></figure><p>â€” è¿™æ²¡æ¯›ç—…å•Šè€é“ï¼Ÿ</p><p>ä¸ï¼Œè€é“é—®é¢˜å¤§çš„å¾ˆå‹’ï¼</p><p>ä¸‹é¢æ¯”è¾ƒä¾¿å‡ºç°äº†æ„æ–™ä¹‹å¤–çš„ç»“æœã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> a = <span class="number">2.33</span>;</span><br><span class="line"><span class="keyword">float</span> b = <span class="number">2.34</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>((b-a) == <span class="number">0.01</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;<span class="string">&quot;ç›¸ç­‰&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;<span class="string">&quot;ä¸ç›¸ç­‰&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸ç›¸ç­‰</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º<code>b</code> ã€<code>a</code> åœ¨åº•å±‚äºŒè¿›åˆ¶ä¸­ä¸èƒ½ç²¾ç¡®è¡¨ç¤ºï¼Œåªèƒ½<u>æ— é™è¶‹è¿‘</u>ã€‚å®é™…å­˜å‚¨ä¸­ï¼Œè®¡ç®—æœº<u>åªä¼šæˆªæ–­ä¿ç•™ä¸€å®šé•¿åº¦çš„äºŒè¿›åˆ¶æ•°ï¼Œå¹¶ä¸èƒ½ç²¾ç¡®è¡¨ç¤ºæµ®ç‚¹æ•°</u> ã€‚</p><p>ä»¥IEEE 754æ ‡å‡†ä¸ºä¾‹ï¼Œå•ç²¾åº¦ï¼ˆæ€»32ä½ï¼‰å°¾æ•°ä¿ç•™23ä½ï¼Œå…¶ä½™æŒ‡æ•°8ä½ï¼Œç¬¦å·ä½1ä½ï¼ˆ<a href="https://tooltt.com/ieee/">åœ¨çº¿è½¬æ¢åœ°å€</a>ï¼‰ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220117161858469.png" alt="image-20220117161858469"></p><p>åœ¨æµ®ç‚¹è¿ç®—ä¸­ï¼Œè®¡ç®—æœºä¹Ÿæ˜¯ä½¿ç”¨äºŒè¿›åˆ¶è¿›è¡Œè®¡ç®—ï¼š</p><ul><li><p>æœ€å¼€å§‹<code>a=b=2.33</code> ï¼Œåˆ¤æ–­<code>a=b</code> æ˜¯å¦ç›¸ç­‰ï¼šè®¡ç®—æœºé€šè¿‡å¯¹æ¯”æ¯ä¸€ä¸ª<code>bit</code> ï¼Œå› ä¸º<code>b</code> å’Œ<code>a</code> åº•å±‚äºŒè¿›åˆ¶è¡¨ç¤ºç›¸ç­‰ï¼Œæ‰€ä»¥ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªç›¸ç­‰æµ®ç‚¹æ•°ä¸ä¼šå‡ºé”™ï¼›</p></li><li><p>ä½†æ˜¯å¦‚æœæ˜¯<code>a-b</code> ï¼Œæµ®ç‚¹æ•°å‚ä¸äº†è¿ç®—ï¼šå› æ­¤æ“ä½œæ•°<code>b</code> å’Œ<code>a</code> æœ¬æ¥å°±æ˜¯ä¸ç²¾ç¡®çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œè®¡ç®—å‡ºæ¥çš„äºŒè¿›åˆ¶ç»“æœè‡ªç„¶æ— æ³•ç²¾ç¡®è¡¨ç¤ºçš„<code>0.01</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00111100001000111101011100001010 # 32ä½ï¼Œ0.01å¯¹åº”äºŒè¿›åˆ¶è¡¨ç¤º</span><br></pre></td></tr></table></figure></li></ul><p>æ‰€ä»¥å‚ä¸äº†è¿ç®—çš„æµ®ç‚¹æ•°<code>b-a</code> å†å’Œ<code>0.01</code> æ¯”è¾ƒå‡ºé”™ã€‚</p><p><strong>ä½†ä¹Ÿå¹¶ä¸æ˜¯æ‰€æœ‰çš„æµ®ç‚¹æ•°éƒ½ä¸èƒ½ç²¾ç¡®è¡¨ç¤ºï¼Œ2çš„æ•´æ•°å†¥çš„æµ®ç‚¹æ•°ä¾¿å¯ä»¥ç²¾ç¡®è¡¨ç¤º</strong>ã€‚</p><p><code>IEEE 754</code>å­˜å‚¨æ ‡å‡†å¦‚ä¸‹ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1949091-20200502090534549-1343111747.png" alt="IEEE 754 æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹æ³•- è«å“ˆå¾·- åšå®¢å›­"></p><p>æ ¹æ®æ ‡å‡†ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>=</mo><mn>1.0</mn><mo>âˆ—</mo><msup><mn>2</mn><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">0.5=1.0*2^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1.0</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> ï¼Œæ˜¾ç„¶<code>0.5</code> å¯ä»¥è¢«ç²¾ç¡®è¡¨ç¤ºã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220117163244930.png" alt="image-20220117163244930"></p><h4 id="1-2-4-å˜é‡åˆå§‹åŒ–ğŸŒŸ">1.2.4 å˜é‡åˆå§‹åŒ–ğŸŒŸ</h4><p>åˆå§‹åŒ–æ˜¯æŒ‡<strong>å£°æ˜å˜é‡ä½†æ²¡æœ‰å®šä¹‰å®ƒï¼ˆæ²¡æœ‰æŒ‡å®šåˆå€¼</strong>ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨è¿›è¡Œçš„<strong>é»˜è®¤åˆå§‹åŒ–</strong>ï¼ˆèµ‹å€¼ï¼‰æ“ä½œã€‚</p><p>å…ˆè®²è®²ä¸Šè¿°æ¦‚å¿µä¸­å‡ºç°çš„æ–°åè¯ï¼Œâ€œå£°æ˜â€å’Œâ€œå®šä¹‰â€ã€‚</p><h5 id="å£°æ˜å’Œå®šä¹‰çš„åŒºåˆ«ï¼Ÿ">å£°æ˜å’Œå®šä¹‰çš„åŒºåˆ«ï¼Ÿ</h5><p>è¯´æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œè¦åˆ†å˜é‡å’Œå‡½æ•°ä¸¤ä¸ªæ–¹é¢è®¨è®ºã€‚</p><blockquote><p>å£°æ˜å¯ä»¥å¤šæ¬¡ï¼Œå®šä¹‰åªèƒ½æœ‰ä¸€æ¬¡ã€‚</p></blockquote><p><strong>å¦‚æœæ˜¯å˜é‡</strong>ã€‚</p><ul><li><p><strong>å£°æ˜ï¼ˆä¸€èˆ¬åœ¨<code>.h</code>æ–‡ä»¶ä¸­</strong>ï¼‰ï¼šä»…ä»…æ˜¯æŠŠå˜é‡çš„å£°æ˜çš„ä½ç½®åŠç±»å‹æä¾›ç»™ç¼–è¯‘å™¨ï¼Œå¹¶ä¸åˆ†é…å†…å­˜ç©ºé—´ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> a ;     <span class="comment">// å£°æ˜ï¼Œåˆ«å¤„å®šä¹‰</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> b = <span class="number">10</span>; <span class="comment">// å£°æ˜åŒæ—¶å®šä¹‰ï¼Œå˜é‡båˆ†é…äº†ç©ºé—´ä¸”å­˜å‚¨äº†å€¼10</span></span><br></pre></td></tr></table></figure><p>âš ï¸ æ³¨æ„å¦‚æœä¸æ˜¯<code>extern</code>å…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼ŒC++ä¸­çš„å˜é‡<u>å£°æ˜æ—¶ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å®šä¹‰ï¼ˆé»˜è®¤åˆå§‹åŒ–ï¼‰</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*other.h*/</span></span><br><span class="line"><span class="keyword">int</span> a; <span class="comment">//  å£°æ˜+å®šä¹‰</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰å¤šä¸ª<code>.cpp</code> æ–‡ä»¶<code>include â€œother.hâ€</code> ï¼Œ<u>ä¼šé‡å¤å®šä¹‰å¤šæ¬¡<code>a</code></u>ï¼ˆå®šä¹‰åªèƒ½æœ‰ä¸€æ¬¡ï¼‰ã€‚</p><ul><li><p>main.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;other.h&quot;</span>  <span class="comment">// å¼•å…¥å¤´æ–‡ä»¶other.hï¼Œå˜é‡aè¢«å®šä¹‰ä¸€æ¬¡, funcæœªè¢«å®šä¹‰åªå£°æ˜</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>other.h</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a;</span><br></pre></td></tr></table></figure></li><li><p>other.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&quot;other.h&quot;</span> <span class="comment">// å¼•å…¥å¤´æ–‡ä»¶other.hï¼Œå˜é‡aè¢«å®šä¹‰ä¸€æ¬¡</span></span></span><br></pre></td></tr></table></figure></li></ul><p>å°è¯•ç¼–è¯‘å‡ºé”™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]# g++  -std=c++11 main.cpp other.cpp -o  main.out</span><br><span class="line">/tmp/cc2DsgGi.o:(.data+0x0): multiple definition of `a&#x27;</span><br><span class="line">/tmp/ccDlbvUg.o:(.data+0x0): first defined here</span><br></pre></td></tr></table></figure><blockquote><p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ­¤æ—¶é‡‡ç”¨<code>ifndef</code>é˜²æ­¢é¢„ç¼–è¯‘é‡å¤å®šä¹‰æ²¡æœ‰ç”¨ï¼Œæ›´å¤š<code>ifndef</code> è§£é‡Šå‚è€ƒï¼š<a href="http://c.biancheng.net/view/7636.html">C++é˜²æ­¢å¤´æ–‡ä»¶è¢«é‡å¤å¼•å…¥çš„3ç§æ–¹æ³•</a> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*other.h*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> OTHER_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OTHER_H</span></span><br><span class="line"><span class="keyword">int</span> a;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> </span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæ­¤æ—¶<code>main.cpp</code> ã€<code>other.cpp</code> æ˜¯åˆ†åˆ«ç¼–è¯‘çš„ï¼Œ<code>main.cpp</code> ä¸­çš„<code>define OTHER_H</code> å¯¹<code>other.cpp</code> ä¸èµ·ä½œç”¨ã€‚</p></blockquote><p>ä¸ºäº†é¿å…è¿™ç§é—®é¢˜ï¼Œä¸ºäº†é¿å…è¿™ç§é—®é¢˜æˆ‘ä»¬åªæœ‰å°†å¤´æ–‡ä»¶ä¸­å˜é‡å£°æ˜ä¸ºexternï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> a; </span><br></pre></td></tr></table></figure><p>å†æ¬¡ç¼–è¯‘æ­£å¸¸ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]<span class="meta"># g++  -std=c++11 main.cpp other.cpp -o  main.out</span></span><br></pre></td></tr></table></figure><p><code>main.cpp</code> å’Œ <code>other.cpp</code> éƒ½æ˜¯æ‹¥æœ‰<code>a</code>çš„å£°æ˜ï¼Œå£°æ˜å¯ä»¥å¤šæ¬¡ã€‚</p></li><li><p><strong>å®šä¹‰ï¼ˆä¸€èˆ¬åœ¨<code>.cpp</code>æ–‡ä»¶ä¸­</strong>ï¼‰ï¼šè¦åœ¨å®šä¹‰çš„åœ°æ–¹ä¸ºå…¶<u>åˆ†é…å­˜å‚¨ç©ºé—´</u>ï¼Œç›¸åŒå˜é‡å¯ä»¥åœ¨å¤šå¤„å£°æ˜ï¼ˆå¤–éƒ¨å˜é‡externï¼‰ï¼Œä½†åªèƒ½åœ¨ä¸€å¤„å®šä¹‰ã€‚</p></li></ul>  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a; <span class="comment">// å£°æ˜ä¹Ÿæ˜¯å®šä¹‰ï¼Œç¼–è¯‘å™¨é»˜è®¤åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p><strong>å¦‚æœæ˜¯å‡½æ•°</strong>ã€‚</p><ul><li><p><strong>å£°æ˜ï¼ˆä¸€èˆ¬åœ¨<code>.h</code>æ–‡ä»¶ä¸­</strong>ï¼‰ï¼šæŠŠå‡½æ•°çš„ä½ç½®ã€å‚æ•°å’Œè¿”å›ç±»å‹ç­‰ä¿¡æ¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>å®šä¹‰ï¼ˆä¸€èˆ¬åœ¨<code>.cpp</code>æ–‡ä»¶ä¸­</strong>ï¼‰ï¼šåœ¨æºæ–‡ä»¶ä¸­å®ç°å…·ä½“å‡½æ•°ï¼Œ<u>å¹¶ä¸ºå…¶åˆ†é…å†…å­˜</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &gt; y ? x : y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="æœ€ä½³å®è·µï¼šå¤´æ–‡ä»¶é‡Œåº”è¯¥æ”¾ä»€ä¹ˆï¼Ÿ">æœ€ä½³å®è·µï¼šå¤´æ–‡ä»¶é‡Œåº”è¯¥æ”¾ä»€ä¹ˆï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://github.com/chenshuo/muduo/blob/master/muduo">muduo</a> ä¸­åšæ³•ã€‚</p></blockquote><p>åœ¨å¤´æ–‡ä»¶<code>test.h</code>ä¸­ï¼š</p><ul><li><p><strong>å…¨å±€å˜é‡</strong>ï¼šæ³¨æ„ç”¨externå…³é”®å­—ä¿®é¥°ï¼Œåªå£°æ˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> a;</span><br></pre></td></tr></table></figure></li><li><p><strong>å‡½æ•°</strong>ï¼šåªå£°æ˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å†…è”å‡½æ•°å¯ç›´æ¥å®šä¹‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†…è”å‡½æ•°ä¼šè¢«ç›´æ¥æ›¿æ¢ï¼Œä¸ç”¨æ‹…å¿ƒé‡å¤å®šä¹‰çš„é—®é¢˜ã€‚</p></li><li><p><strong>ç»“æ„ä½“</strong>ï¼šå£°æ˜+å®šä¹‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> isOK;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç”±äºç»“æ„ä½“å·²ç»è¢«å®šä¹‰ï¼Œå¦‚æœæœ‰å¤šä¸ª<code>.cpp</code> æ–‡ä»¶ includeäº†<code>test.h</code> å®¹æ˜“å‡ºç°é‡å¤å®šä¹‰ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¼€æºæ–‡ä»¶ä¸­å¾€å¾€åœ¨<code>.h</code> æ–‡ä»¶ä¸­ä½¿ç”¨<a href="http://c.biancheng.net/view/7636.html">#ifndef</a> é¿å…å¤´æ–‡ä»¶è¢«é‡å¤å¼•å…¥ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> XXX_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> XXX_H</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">bool</span> isOK;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></li><li><p><strong>ç±»</strong>ï¼šç±»å£°æ˜+å®šä¹‰ï¼Œå†…éƒ¨æˆå‘˜åªå£°æ˜ã€‚</p><p>åŒä¸Šï¼Œéœ€æ³¨æ„ä½¿ç”¨<a href="http://c.biancheng.net/view/7636.html">#ifndef</a> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get_value</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      <span class="keyword">int</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ™®é€šæˆå‘˜å‡½æ•°ï¼ˆæ™®é€šæ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°ã€è®¿é—®å‡½æ•°ç­‰ï¼‰å»ºè®®åœ¨ç±»ä¸­ï¼ˆå¤´æ–‡ä»¶ï¼‰å®šä¹‰ï¼›é‡è¦çš„æˆå‘˜å‡½æ•°åº”åœ¨ä¸ç±»åŒåçš„ .cpp æ–‡ä»¶ä¸­å®šä¹‰ã€‚</p></li><li><p><strong>å…¶å®ƒ</strong>ï¼šdefineå®å®šä¹‰ã€‚</p></li></ul><p>åœ¨æºæ–‡ä»¶<code>test.cpp</code>ä¸­ï¼š</p><p>å®ç°<code>test.h</code>ç›¸å…³å®šä¹‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&quot;test.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;  <span class="comment">// å®šä¹‰å˜é‡</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span>  <span class="comment">// å®šä¹‰å‡½æ•°</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &gt; y ? x : y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç»“æ„ä½“æˆå‘˜</span></span><br><span class="line"><span class="comment">// ä¸ç”¨ï¼Œç›´æ¥ä½¿ç”¨å³å¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç±»æˆå‘˜ï¼ˆå¾€å¾€æ˜¯é‡è¦çš„ç±»æˆå‘˜å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MyClass::get_value</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é»˜è®¤åˆå§‹åŒ–">é»˜è®¤åˆå§‹åŒ–</h5><p>å˜é‡å€¼å£°æ˜æ—¶çš„åˆå§‹åŒ–å€¼ä¸ä»…å’Œ<strong>å˜é‡çš„ç±»å‹</strong>æœ‰å…³ç³»ï¼Œä¹Ÿå’Œ<strong>å˜é‡å£°æ˜çš„ä½ç½®</strong>æœ‰å…³ç³»ï¼š</p><ul><li><p><strong>å¯¹äºå†…ç½®ç±»å‹å˜é‡</strong>ï¼ˆå¦‚ <code>int</code> ï¼Œ<code>double</code>ï¼Œ<code>bool</code>ç­‰ï¼‰</p><ul><li>å‡½æ•°ä½“ä¹‹<strong>å¤–</strong>çš„å˜é‡ï¼šä¼šè¿›è¡Œ&quot;é›¶å€¼åˆå§‹åŒ–&quot; ï¼›</li><li>å‡½æ•°ä½“ä¹‹<strong>å†…</strong>çš„å˜é‡ï¼šæ­¤æ—¶è¯¥å˜é‡æ˜¯<strong>æœªå®šä¹‰å€¼</strong>ï¼Œåœ¨ä¸€äº›IDEä¸­å¦‚VS2017ä½¿ç”¨ä¼šæŠ¥é”™ï¼›åœ¨ä¸€äº›ç¼–è¯‘å™¨ä¸­å¦‚VSCode2020å¯ä»¥è¢«ä½¿ç”¨ï¼Œ<strong>éƒ¨åˆ†ä¼šè¢«åˆå§‹åŒ–ï¼Œéƒ¨åˆ†æŒ‡å‘å†…å­˜ä¸­â€œé‡å€¼â€</strong>ï¼›</li><li><strong>é™æ€å˜é‡</strong>ï¼ˆåŒ…æ‹¬å±€éƒ¨é™æ€å˜é‡ï¼‰ï¼šè¿›è¡Œ&quot;é›¶å€¼åˆå§‹åŒ–&quot;ã€‚</li></ul></li><li><p><strong>å¯¹äºç±»æˆå‘˜å˜é‡ï¼ˆClass</strong>ï¼‰ï¼š</p><ul><li><p><strong>åŸç”Ÿç±»å‹</strong>ï¼šintç±»å‹æˆ–è€…æŒ‡é’ˆç±»å‹ç­‰ï¼Œä»–ä»¬<strong>ä¸ä¼šè¢«åˆå§‹åŒ–</strong>ã€‚ä½†æ˜¯ï¼Œä»–ä»¬ä¼šä½¿ç”¨ç±»å®ä¾‹å†…å­˜åœ°å€ä¸­ä»»ä½•å·²ç»å­˜åœ¨çš„<strong>é‡å€¼</strong>ä½œä¸ºè‡ªå·±çš„å€¼ï¼›</p><ul><li><strong>å¯¹è±¡ç±»å‹</strong>ï¼šå¦‚stringç±»å‹ï¼Œ<strong>é»˜è®¤æ„é€ å™¨</strong>ä¼šè¢«è°ƒç”¨åˆå§‹åŒ–ä¸ºç©ºä¸²<code>&quot;&quot;</code>ï¼›</li></ul></li><li><p><strong>å¼•ç”¨ç±»å‹</strong>ï¼šæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p></li></ul></li></ul><p>å¯¹äºä»¥ä¸Šæè¿°æˆ‘ä»¬è¿›è¡Œå®ä¾‹éªŒè¯ã€‚</p><blockquote><p>ã€å®ä¾‹ã€‘ä¸åŒæƒ…å†µåˆå§‹åŒ–éªŒè¯ã€‚</p></blockquote><p>æˆ‘ä»¬å…ˆç»™å‡ºå„ç§æƒ…å†µä¸‹æ€»ç»“ï¼Œå…·æœ‰éªŒè¯è¯·æŸ¥çœ‹ä¸‹æ–¹ä»£ç ã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">int/float/double</th><th style="text-align:center">bool</th><th style="text-align:center">string/char</th><th style="text-align:center">æŒ‡é’ˆ</th><th style="text-align:center">å¼•ç”¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>å±€éƒ¨å˜é‡</strong></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">0</td><td style="text-align:center"><code>&quot;&quot;</code>ï¼Œ<code>''</code></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">å‡ºé”™</td></tr><tr><td style="text-align:center"><strong>å…¨å±€å˜é‡/é™æ€å˜é‡</strong></td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center"><code>&quot;&quot;</code>ï¼Œ<code>''</code></td><td style="text-align:center">0</td><td style="text-align:center">å‡ºé”™</td></tr><tr><td style="text-align:center"><strong>ç±»æˆå‘˜</strong></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">é‡å€¼</td><td style="text-align:center"><code>&quot;&quot;</code>ï¼Œé‡å€¼</td><td style="text-align:center"><code>&quot;&quot;</code>/é‡å€¼</td><td style="text-align:center">å‡ºé”™</td></tr></tbody></table><p>ä»¥ä¸‹æ˜¯å®é™…ä»£ç éªŒè¯ã€‚</p><div class="tabs" id="markdown"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#markdown-1">å‡½æ•°ä½“å¤–å˜é‡</button></li><li class="tab"><button type="button" data-href="#markdown-2">å‡½æ•°ä½“å†…å˜é‡</button></li><li class="tab"><button type="button" data-href="#markdown-3">é™æ€å˜é‡</button></li><li class="tab"><button type="button" data-href="#markdown-4">ç±»æˆå‘˜å˜é‡</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="markdown-1"><ul><li><p>å‡½æ•°ä½“å¤–å˜é‡</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°ä½“å¤–çš„æ‰€æœ‰å˜é‡ï¼ˆå…¨å±€å˜é‡ï¼‰éƒ½å·²ç»è¢«<strong>é›¶å€¼åˆå§‹åŒ–</strong>ï¼šæ•´æ•°/æµ®ç‚¹ç±»å‹/æŒ‡é’ˆåˆå§‹åŒ–ä¸º0ï¼›å­—ç¬¦ä¸²ç±»å‹è¢«åˆå§‹åŒ–ç©ºä¸²ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.æ•°å€¼ç±»å‹</span></span><br><span class="line"><span class="keyword">int</span> num;  <span class="comment">// 0       </span></span><br><span class="line"><span class="keyword">float</span> f;  <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">double</span> d; <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.bool ç±»å‹</span></span><br><span class="line"><span class="keyword">bool</span> b;   <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.å­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">string str;  <span class="comment">// &quot;&quot; </span></span><br><span class="line"><span class="keyword">char</span> c;      <span class="comment">// &#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.æŒ‡é’ˆ: é›¶å€¼</span></span><br><span class="line"><span class="comment">// æ—§ç‰ˆæœ¬C++, 0 æˆä¸ºæŒ‡ç¤ºæ— æ•ˆå†…å­˜ä½ç½®å€¼</span></span><br><span class="line">string *str_ptr; <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">int</span> *ptr;        <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.å¼•ç”¨ï¼šå‡ºé”™</span></span><br><span class="line">string &amp;str_ref; <span class="comment">//  error: not initialized</span></span><br><span class="line"><span class="keyword">int</span> &amp;int_ref;    <span class="comment">// error: not initialized</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// æ‰“å°æµ‹è¯•ä»£ç ç•¥</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-2"><ul><li><p>å‡½æ•°ä½“å†…å˜é‡</p><p>VSCodeï¼ˆg++ 4.6+ï¼‰ä¸­ç»™<strong>éƒ¨åˆ†å±€éƒ¨å˜é‡è¿›è¡Œäº†â€œåˆå§‹åŒ–â€</strong>ï¼Œç›´æ¥ä½¿ç”¨å¹¶æœªæŠ¥é”™ã€‚ä½†æ˜¯ï¼Œ<strong>æµ®ç‚¹ç±»å‹å’ŒæŒ‡é’ˆçš„å€¼éƒ½æŒ‡å‘äº†é‡å€¼</strong>ã€‚</p><p>å‡½æ•°ä½“å†…å˜é‡å˜é‡ä¸åˆå§‹åŒ–ï¼Œæ˜¯ä¸ªå±é™©ä¸”é”™è¯¯çš„ç¼–ç¨‹è¡Œä¸ºï¼Œä½¿å¾—ä»£ç å¾ˆéš¾è°ƒè¯•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1.æ•°å€¼ç±»å‹</span></span><br><span class="line">    <span class="keyword">int</span> num;  <span class="comment">// é‡å€¼ï¼š9.88131e-324     </span></span><br><span class="line">    <span class="keyword">float</span> f;  <span class="comment">// é‡å€¼ï¼š5.88128e-39</span></span><br><span class="line">    <span class="keyword">double</span> d; <span class="comment">// é‡å€¼ï¼š2.07385e-317</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.bool ç±»å‹</span></span><br><span class="line">    <span class="keyword">bool</span> b;   <span class="comment">// 0</span></span><br><span class="line">    <span class="comment">// 3.å­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">    string str;  <span class="comment">// &quot;&quot; </span></span><br><span class="line">    <span class="keyword">char</span> c;      <span class="comment">// &#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4.æŒ‡é’ˆ: é›¶å€¼</span></span><br><span class="line">    <span class="comment">// æŒ‡é’ˆæŒ‡å‘å†…å­˜ä¸­éšæœºåœ°å€å€¼ï¼Œè¿™éå¸¸å±é™©</span></span><br><span class="line">    string *str_ptr; <span class="comment">// 0x400a10</span></span><br><span class="line">    <span class="keyword">int</span> *ptr;        <span class="comment">// 0x400be0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5.å¼•ç”¨ï¼šå‡ºé”™</span></span><br><span class="line">    string &amp;str_ref; <span class="comment">//  error: not initialized</span></span><br><span class="line">    <span class="keyword">int</span> &amp;int_ref;    <span class="comment">//  error: not initialized</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å°æµ‹è¯•ä»£ç ç•¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-3"><ul><li><p>é™æ€å˜é‡</p><p>ç‰¹åˆ«çš„ï¼Œé™æ€å˜é‡ä¸è®ºæ˜¯<strong>å±€éƒ¨é™æ€å˜é‡è¿˜æ˜¯å…¨å±€é™æ€å˜é‡éƒ½ä¼šè¿›è¡Œé›¶å€¼åˆå§‹åŒ–</strong>ã€‚åˆå§‹åŒ–è§„åˆ™åŒå…¨å±€å˜é‡ã€‚</p><blockquote><p>â“ å±€éƒ¨é™æ€å˜é‡ï¼Œæ¯æ¬¡è¿›å…¥å‡½æ•°éƒ½ä¼šè¢«åˆå§‹åŒ–å—ï¼Ÿ</p></blockquote><p>é™æ€å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ä¸€æ ·ï¼Œæ•°æ®éƒ½å­˜æ”¾åœ¨å…¨å±€åŒºåŸŸï¼Œæ‰€ä»¥<strong>åœ¨ä¸»ç¨‹åºmainæ‰§è¡Œä¹‹å‰</strong>ï¼Œç¼–è¯‘å™¨å·²ç»ä¸ºå…¶åˆ†é…å¥½äº†å†…å­˜ï¼Œå³<strong>åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">count_calls</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸»ç¨‹åºæ‰§è¡Œå°±å·²è¢«åˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">// åç»­è¿›å…¥å‡½æ•°ä¸ä¼šå†æ‰§è¡Œåˆå§‹åŒ–å˜ä¸º0</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> ctr;     <span class="comment">// é»˜è®¤åˆå§‹åŒ–ä¸º 0</span></span><br><span class="line">    <span class="keyword">return</span> ++ctr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ®µç¨‹åºå°†è¾“å‡ºä» 1 åˆ° 10 çš„æ•°å­—ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i != <span class="number">10</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">count_calls</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-4"><ul><li><p>ç±»æˆå‘˜å˜é‡</p><p>å¯ä»¥çœ‹åˆ°ï¼Œç±»æˆå‘˜å˜é‡å€¼å¦‚æœä¸ç»™å®šåˆå§‹åŒ–ï¼š<strong>åŸºæœ¬ç±»å‹å˜é‡æŒ‡å‘é‡å€¼ï¼›å¼•ç”¨ç±»å‹ä¼šéæ³•è­¦å‘Š</strong>ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>å¯¹è±¡ç±»å‹</strong>stringä¼šè¢«â€œé›¶å€¼åˆå§‹åŒ–â€ï¼ˆ<code>ç©ºä¸²</code>ï¼‰ã€‚è¿™æ˜¯å› ä¸ºstringç±»å‹çš„é»˜è®¤æ„é€ å‡½æ•°è¢«è°ƒç”¨ï¼Œè€Œstringçš„é»˜è®¤æ„é€ ä¼šå°†stringç±»å‹å€¼åˆå§‹åŒ–ä¸º<code>ç©ºä¸²</code>ã€‚</p><p>æ˜¾ç„¶ï¼Œç±»æˆå‘˜å˜é‡æœ€å¥½åœ¨ä½¿ç”¨å‰è¿›è¡Œåˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 1.æ•°å€¼ç±»å‹</span></span><br><span class="line">    <span class="keyword">int</span> num;   <span class="comment">// é‡å€¼ï¼š1760379232    </span></span><br><span class="line">    <span class="keyword">float</span>  f;  <span class="comment">// é‡å€¼ï¼š4.59149e-41</span></span><br><span class="line">    <span class="keyword">double</span> d;  <span class="comment">// é‡å€¼ï¼š4.59149e-41</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.bool ç±»å‹</span></span><br><span class="line">    <span class="keyword">bool</span> b ;   <span class="comment">// é‡å€¼ï¼š2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.å­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">    string str;  <span class="comment">// &quot;&quot; ç©º,å¯¹è±¡ç±»å‹ï¼Œä¼šè°ƒç”¨stringæ„é€ å‡½æ•°åˆå§‹åŒ–ï¼Œæ‰€ä»¥æ˜¯&quot;&quot;</span></span><br><span class="line">    <span class="keyword">char</span> c;      <span class="comment">// é‡å€¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4.æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// æŒ‡é’ˆæŒ‡å‘å†…å­˜ä¸­éšæœºåœ°å€å€¼ï¼Œè¿™éå¸¸å±é™©</span></span><br><span class="line">    string *str_ptr; <span class="comment">// 0</span></span><br><span class="line">    <span class="keyword">int</span> *ptr;        <span class="comment">// 0x400d00</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5.å¼•ç”¨ï¼šå‡ºé”™</span></span><br><span class="line">    string &amp;str_ref; <span class="comment">// not initialized</span></span><br><span class="line">    <span class="keyword">int</span> &amp;int_ref;    <span class="comment">// not initialized</span></span><br><span class="line">    </span><br><span class="line">   <span class="keyword">public</span>: </span><br><span class="line">    <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°ï¼šä¸åšä»»ä½•æ“ä½œ</span></span><br><span class="line">    <span class="built_in">test</span>() &#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    test t;</span><br><span class="line">    <span class="comment">// æ‰“å°æµ‹è¯•ä»£ç ç•¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="1-3-å…³é”®å­—">1.3 å…³é”®å­—</h3><p>åœ¨å‰é¢çš„ä¾‹å­ï¼Œå¤šæ¬¡è§åˆ°çš„<strong>externå…³é”®å­—</strong>æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> c, ch;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯å…³é”®å­—ï¼Œæœ‰ä¸ªæ•´ä½“çš„æ¦‚å¿µå’Œäº†è§£ã€‚</p><p>å…³é”®å­—æ˜¯<strong>é¢„å®šä¹‰çš„</strong>å•è¯ï¼Œå¯¹ç¼–è¯‘å™¨å…·æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚ä¾‹å¦‚ï¼Œå‰é¢æˆ‘ä»¬çœ‹åˆ°çš„<code>int</code>ã€<code>float</code>ç­‰åŸºæœ¬å˜é‡ç±»å‹ä¹Ÿæ˜¯å…³é”®å­—çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ä¸‹è¡¨åˆ—å‡ºäº† C++ ä¸­çš„å…³é”®å­—ã€‚è¿™äº›å…³é”®å­—ä¸èƒ½ä½œä¸ºå¸¸é‡åã€å˜é‡åæˆ–å…¶ä»–æ ‡è¯†ç¬¦åç§°ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/C-Tutorial-Edureka-Keywords-of-C-Program.png" alt="C++ Tutorial | Learn C++ | C++ Programming Language | Edureka"></p><p>æœ¬èŠ‚ä¸»è¦ä»‹ç»å­˜å‚¨ç±»ç›¸å…³å…³é”®å­—ã€‚</p><p>å­˜å‚¨ç±»å®šä¹‰ C++ ç¨‹åºä¸­<strong>å˜é‡/å‡½æ•°çš„èŒƒå›´ï¼ˆå¯è§æ€§ï¼‰å’Œç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œè¿™äº›è¯´æ˜ç¬¦æ”¾ç½®åœ¨å®ƒä»¬æ‰€ä¿®é¥°çš„ç±»å‹ä¹‹å‰ã€‚ä¸‹é¢åˆ—å‡º C++ ç¨‹åºä¸­å¯ç”¨çš„å­˜å‚¨ç±»ï¼š</p><ul><li>extern</li><li>static</li><li>mutable</li><li>thread_local (C++11)</li></ul><p>ç‰¹åˆ«çš„ï¼Œä» C++ 11 å¼€å§‹ï¼Œauto å…³é”®å­—ä¸å†æ˜¯ å­˜å‚¨ç±»è¯´æ˜ç¬¦ï¼Œä½†autoæ˜¯c++11ä¸­éå¸¸ä¼˜é›…çš„å…³é”®å­—ã€‚ä¸ºäº†æ›´å¥½çš„è¯´æ˜å®ƒçš„ä½œç”¨ï¼Œåœ¨<u>3.XèŠ‚</u>ä¸­ä¼šæ­£å¼æåˆ°å®ƒã€‚</p><h4 id="1-3-1-externå…³é”®å­—">1.3.1 externå…³é”®å­—</h4><blockquote><p><code>extern</code>é¡¾åæ€ä¹‰ï¼Œå¤–é¢çš„ã€å¤–æ¥çš„ã€‚</p></blockquote><p>extern å¯ä»¥ç½®äºå˜é‡æˆ–è€…å‡½æ•°å‰ï¼Œæ‰©å±•å˜é‡/å‡½æ•°çš„å®šä¹‰åŸŸï¼š</p><ol><li>ç¬¬ä¸€ç§æƒ…å†µï¼Œé¦–å…ˆå°†å£°æ˜çš„å˜é‡/å‡½æ•°ä½œç”¨åŸŸï¼Œä»å£°æ˜æ‰©å±•åˆ°æœ¬æ–‡ä»¶ç»“æŸï¼›å¦‚æœä¾æ—§æœªæ‰¾åˆ°å®šä¹‰è½¬æƒ…å†µäºŒã€‚</li><li>ç¬¬äºŒç§æƒ…å†µï¼Œå£°æ˜å˜é‡/å‡½æ•°å®šä¹‰åœ¨å…¶å®ƒæ–‡ä»¶ä¸­ï¼Œ<u>åœ¨é“¾æ¥æ—¶</u>ä¼šåœ¨<u>å…¶å®ƒæ–‡ä»¶</u>å¯»æ‰¾å…¶å®šä¹‰ï¼ˆè¿™æ ·åœ¨<u>ç¼–è¯‘æ—¶</u>ï¼Œæœ¬æ–‡ä»¶æœªæ‰¾å®šä¹‰ä¹Ÿä¸æŠ¥é”™ï¼‰ã€‚</li></ol><p>åˆ†åˆ«ä¸¾ä¸¤ä¸ªä¾‹å­è¯´æ˜ä¸¤ç§æƒ…å†µã€‚</p><h5 id="ç¬¬ä¸€ç§æƒ…å†µï¼Œå˜é‡åœ¨æœ¬æ–‡ä»¶å®šä¹‰">ç¬¬ä¸€ç§æƒ…å†µï¼Œå˜é‡åœ¨æœ¬æ–‡ä»¶å®šä¹‰</h5><blockquote><p>ã€ä¾‹1ã€‘å˜é‡å£°æ˜åä¸æƒ³ç«‹å³åˆå§‹åŒ–ï¼Œåœ¨è°ƒç”¨åæ‰ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚å¦‚ä½•åœ¨è°ƒç”¨æ—¶å°±è·å–æ­£ç¡®çš„å€¼ï¼Ÿ</p></blockquote><p>ä½¿ç”¨ <code>extern</code> å…³é”®å­—å¯¹å˜é‡<code>c</code>, <code>ch</code> ä½œâ€œå¤–éƒ¨å˜é‡å£°æ˜â€ï¼Œä½¿<strong>ä½œç”¨åŸŸæ‰©å±•åˆ°ä»å£°æ˜å¼€å§‹åˆ°æœ¬æ–‡ä»¶ç»“æŸ</strong> ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼š<u>åœ¨æœ¬æ–‡ä»¶å…¶å®ƒåŒºåŸŸå¯»æ‰¾å…¶å®šä¹‰</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// ä½œç”¨åŸŸæ‰©å±•åˆ°æ–‡ä»¶ç»“å°¾</span></span><br><span class="line">   <span class="keyword">extern</span> <span class="keyword">char</span> c, ch;  </span><br><span class="line">   cout&lt;&lt;c&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;ch&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœŸæ­£å®šä¹‰çš„åœ°æ–¹</span></span><br><span class="line"><span class="keyword">char</span> c=<span class="string">&#x27;h&#x27;</span>, ch=<span class="string">&#x27;H&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]# g++  -std=c++11 main.cpp other.cpp -o  main.out</span><br><span class="line">[root@roy-cpp test]# ./main.out </span><br><span class="line">h</span><br><span class="line">H</span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœæ²¡æœ‰ä½¿ç”¨externå…³é”®å­—ï¼Œè¾“å‡ºä¸ºç©ºï¼ˆé»˜è®¤åˆå§‹åŒ–çš„å€¼ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœæœ¬æ–‡ä»¶æ²¡æ‰¾åˆ°å®šä¹‰ï¼Œexternè¿˜ä¼šå»å…¶å®ƒæ–‡ä»¶ä¸­å¯»æ‰¾å®šä¹‰ã€‚</p><h5 id="ç¬¬äºŒç§æƒ…å†µï¼Œå˜é‡åœ¨å…¶å®ƒæ–‡ä»¶å®šä¹‰">ç¬¬äºŒç§æƒ…å†µï¼Œå˜é‡åœ¨å…¶å®ƒæ–‡ä»¶å®šä¹‰</h5><p><strong><code>c, ch</code>æ˜¯åœ¨åˆ«çš„æ–‡ä»¶ä¸­å£°æ˜</strong></p><blockquote><p>ã€ä¾‹2ã€‘å˜é‡<code>c</code>, <code>ch</code> æ˜¯åœ¨<u>åˆ«çš„.cppæ–‡ä»¶</u>ä¸­å£°æ˜çš„ï¼Œä½†åˆéœ€è¦åœ¨ main å‡½æ•°ä¸­è°ƒç”¨å®ƒä»¬ï¼ˆ<u>å¼•å…¥å¤´æ–‡ä»¶ä¸­ä¹Ÿæ²¡æœ‰å®ƒä»¬çš„å®šä¹‰</u>ï¼‰ã€‚</p></blockquote><p>ä½¿ç”¨externå…³é”®å­—å£°æ˜å³å¯è§£å†³ï¼Œè¿™æ ·ç¼–è¯‘é˜¶æ®µä¸ä¼šå‡ºé”™ï¼Œé“¾æ¥æ—¶ä¼šå»å¯»æ‰¾å®ƒä»¬çš„å®šä¹‰ï¼ˆå¦‚æœexternä¿®é¥°å‡½æ•°/ç±»ç­‰æ•ˆæœç­‰åŒå‰å‘å£°æ˜ï¼Œ3.1.1èŠ‚ï¼‰ã€‚</p><ul><li><p>main.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¤–éƒ¨å˜é‡ï¼Œå¤´æ–‡ä»¶ä¸­ä¹Ÿæ²¡æœ‰c,chçš„å®šä¹‰</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> c, ch;     </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout&lt;&lt;c&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;ch&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>other.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> c=<span class="string">&#x27;h&#x27;</span>, ch=<span class="string">&#x27;H&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><p>æ²¡ä½¿ç”¨externå…³é”®å­—å£°æ˜ç¼–è¯‘ä¼šå‡ºé”™ï¼Œä½¿ç”¨åç¼–è¯‘æ­£å¸¸ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -std=c++11 main.cpp other.cpp -o main.out</span><br><span class="line">./main.out</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">h</span><br><span class="line">H</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™ä¸ªåšæ³•æœ‰ç‚¹åˆ»æ„ï¼Œæ ¹æ®æˆ‘ä»¬ä¹‹å‰çš„æœ€ä½³å®è·µï¼Œå£°æ˜å’Œå®šä¹‰æœ€å¥½åˆ†å¼€ã€‚å˜é‡<code>c</code>, <code>ch</code> åº”è¯¥å£°æ˜åœ¨<u>.hæ–‡ä»¶</u>ä¸­ã€‚</p><p><strong>æ­¤æ—¶<code>extern</code>å…³é”®å­—çš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œ <code>other.h</code> å˜é‡<code>a</code>å®šä¹‰åœ¨åˆ«å¤„/æ–‡ä»¶ä¸­</strong>ã€‚</p><ul><li><p>main.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;other.h&quot;</span>  <span class="comment">// å¼•å…¥å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout&lt;&lt;c&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;ch&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>other.h</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> c=<span class="string">&#x27;h&#x27;</span>, ch=<span class="string">&#x27;H&#x27;</span>; <span class="comment">// åªå£°æ˜</span></span><br></pre></td></tr></table></figure></li><li><p>other.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&quot;other.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> c=<span class="string">&#x27;h&#x27;</span>, ch=<span class="string">&#x27;H&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><p>ç¼–è¯‘æ­£å¸¸ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test]<span class="meta"># g++  -std=c++11 main.cpp other.cpp -o  main.out</span></span><br></pre></td></tr></table></figure><h5 id="æœ€ä½³å®è·µï¼šä»€ä¹ˆæ—¶å€™ä½¿ç”¨externå’Œå¤´æ–‡ä»¶">æœ€ä½³å®è·µï¼šä»€ä¹ˆæ—¶å€™ä½¿ç”¨externå’Œå¤´æ–‡ä»¶</h5><p><strong>å¼•å…¥å¤´æ–‡ä»¶å°±å¯ä»¥ä½¿ç”¨åœ¨å…¶å®ƒæ–‡ä»¶çš„å˜é‡/å‡½æ•°/ç±»ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦extern</strong>ï¼Ÿ</p><ol><li><p><strong>externå°†å£°æ˜ã€å®šä¹‰åˆ†ç¦»</strong>ã€‚externå¯ä»¥ç”¨äºå¤´æ–‡ä»¶æŠŠå…¨å±€å˜é‡çš„å£°æ˜å’Œå®šä¹‰åˆ†ç¦»ï¼Œé¿å…é‡å¤å®šä¹‰ï¼›</p></li><li><p><strong>åªéœ€è¦ä½¿ç”¨ä¸ªåˆ«å…¶å®ƒæ–‡ä»¶çš„å˜é‡/å‡½æ•°ç­‰</strong>ã€‚æœ‰æ—¶å€™æˆ‘ä»¬åªæƒ³ä½¿ç”¨å¤´æ–‡ä»¶å®šä¹‰çš„ä¸ªåˆ«å˜é‡/å‡½æ•°ï¼Œä½†æ˜¯è¿™æ ·ä¸å¾—ä¸å¼•å…¥<u>å¤´æ–‡ä»¶æ‰€æœ‰çš„ç›¸å…³å˜é‡/å‡½æ•°ç­‰å£°æ˜</u>ã€‚åœ¨å¤§é¡¹ç›®ç¼–è¯‘ä¸­ï¼Œè¿‡åº¦ä½¿ç”¨å¤´æ–‡ä»¶ä¼šè®©ç¼–è¯‘é€Ÿåº¦æ˜¾è‘—å˜æ…¢ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220121152903021.png" alt="image-20220121152903021"></p><p>è¿™é‡Œæˆ‘ä»¬<u>æ²¡æœ‰include â€œother.hâ€</u> , å› ä¸ºæˆ‘ä»¬åªéœ€è¦å®ƒçš„<code>Max</code> å‡½æ•°ï¼Œä½¿ç”¨externå…³é”®å­—å³å¯ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>other.h</code> å®å¼€å…³ <code>ifndef</code> éƒ½å¯ä»¥å»æ‰ï¼Œä¸ä¼šæœ‰é‡å¤å®šä¹‰çš„å±é™©ï¼ˆæ¯”å¦‚<code>Struct S</code>ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´externè¿˜é™ä½äº†å¤´æ–‡ä»¶é‡å¤å®šä¹‰çš„é£é™©ã€‚</p></li><li><p><strong>C++å’ŒCä»£ç æ··ç¼–æ—¶</strong>ã€‚ ä¸‹èŠ‚è¯´æ˜ã€‚</p></li></ol><p>å…¶ä½™æƒ…å†µä½¿ç”¨includeå¼•å…¥å¤´æ–‡ä»¶ï¼Œæ¥ä½¿ç”¨åˆ«çš„æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡/å‡½æ•°ã€‚</p><h5 id="extern-â€œCâ€">extern â€œCâ€</h5><p>externå…³é”®å­—è¿˜å¯ç”¨äºextern â€œCâ€ï¼Œä½¿å¾—Cå’ŒC++æ··ç¼–ä¸ä¼šå‡ºé”™ï¼Œå®ƒæœ‰ä¸¤å±‚å«ä¹‰ï¼š</p><ol><li><strong>å£°æ˜çš„å˜é‡æ˜¯externçš„</strong>ï¼Œå®ƒåªæ˜¯åœ¨è¿™é‡Œå£°æ˜ï¼Œå®šä¹‰åœ¨åˆ«çš„åœ°æ–¹ï¼›</li><li><strong>å£°æ˜çš„å˜é‡æŒ‰Cæ–¹å¼è¿›è¡Œç¼–è¯‘</strong>ã€‚</li></ol><p>ç¬¬2ç‚¹æ˜¯æœ¬èŠ‚çš„æ ¸å¿ƒå†…å®¹ã€‚</p><blockquote><p>âš ï¸ ä»¥ä¸‹æƒ…å†µä»…åœ¨ç”¨gccç¼–è¯‘ä»£ç æ—¶å‡ºç°ï¼Œg++ç¼–è¯‘ä¸ä¼šå‡ºé”™ï¼ˆèŠ‚æœ«è§£é‡Šï¼‰ã€‚</p></blockquote><p>å‡†å¤‡ä¸‰ä¸ªæ–‡ä»¶ï¼ša.cã€a.hã€main.cpp ï¼Œåœ¨<strong>main.cpp</strong>ä¸­è°ƒç”¨<strong>a.c</strong>ä¸­çš„å‡½æ•°<code>printHello</code> ã€‚</p><p>å°è¯•gccç¼–è¯‘ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220121172211779.png" alt="image-20220121172211779"></p><p>å¾ˆä¸å¹¸æŠ¥é”™äº†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main.cpp:(.text+<span class="number">0x5</span>): undefined reference to `<span class="built_in">printHello</span>()&#x27;</span><br></pre></td></tr></table></figure><p>é“¾æ¥è¿‡ç¨‹ä¸­æ‰¾ä¸åˆ°ç¬¦å· <code>printHello</code> ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p><p><strong>è¿™æ˜¯å› ä¸º<code>gcc</code> å¯¹ cppå’Œcä»£ç å˜é‡çš„ç¬¦å·å¤„ç†ä¸åŒå¯¼è‡´çš„</strong>ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ä»ä»£ç åˆ°å¯æ‰§è¡Œç¨‹åºéœ€è¦ç»è¿‡ï¼Œé¢„ç¼–è¯‘â†’ç¼–è¯‘â†’æ±‡ç¼–â†’é“¾æ¥ï¼Œå…¶ä¸­ç¼–è¯‘å’Œé“¾æ¥å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>ç¼–è¯‘ï¼šä»£ç å±•å¼€ã€è¯­æ³•æ£€æŸ¥ï¼Œè¿˜åŒ…æ‹¬<u>å°†å˜é‡è½¬æˆç¬¦å·</u>ï¼›</li><li>é“¾æ¥ï¼šå°†æœªå®šä¹‰çš„ç¬¦å·ï¼Œ<u>è§£æé‡å®šä½åˆ°å…¶å®šä¹‰å®ç°çš„åœ°æ–¹</u>ã€‚</li></ul><p>æŸ¥çœ‹<code>a.o</code>é“¾æ¥å‰çš„ç¬¦å·è¡¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test1]# gcc -c a.c -o a.o</span><br><span class="line">[root@roy-cpp test1]# nm a.o</span><br><span class="line">0000000000000000 T printHello</span><br><span class="line">                 U puts</span><br></pre></td></tr></table></figure><p><code>a.c</code> ç¼–è¯‘åçš„ç¬¦å·åï¼ˆ<code>printHello</code>ï¼‰å’Œä»£ç ä¸­çš„å®šä¹‰ä¸€æ ·ã€‚</p><p>å†æŸ¥çœ‹<code>main.o</code>é“¾æ¥å‰çš„ç¬¦å·è¡¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test1]# nm main.o</span><br><span class="line">0000000000000000 T main</span><br><span class="line">                 U _Z10printHellov</span><br></pre></td></tr></table></figure><p><code>main.cpp</code> ç¼–è¯‘å<code>printHello</code>ç¬¦å·åå˜ä¸º<code>_Z10printHellov</code> ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</p><blockquote><p>å¯¹äºC++ä»£ç ï¼šå¦‚æœæ˜¯æ•°æ®å˜é‡å¹¶ä¸”æ²¡æœ‰åµŒå¥—ï¼Œç¬¦å·åä¹Ÿæ˜¯æœ¬èº«ï¼›å¦‚æœå˜é‡åæœ‰åµŒå¥—ï¼ˆåœ¨åç§°ç©ºé—´æˆ–ç±»é‡Œï¼‰æˆ–è€…æ˜¯å‡½æ•°åï¼Œç¬¦å·åå°±ä¼šæŒ‰å¦‚ä¸‹è§„åˆ™æ¥å¤„ç†ã€‚</p><ol><li>ç¬¦å·ä»¥_Zå¼€å§‹ï¼›</li><li>å¦‚æœæœ‰åµŒå¥—ï¼Œåé¢ç´§è·ŸNï¼Œç„¶åæ˜¯åç§°ç©ºé—´ã€ç±»ã€å‡½æ•°çš„åå­—ï¼Œåå­—å‰çš„æ•°å­—æ˜¯é•¿åº¦ï¼Œä»¥Eç»“å°¾ï¼›</li><li>å¦‚æœæ²¡åµŒå¥—ï¼Œåˆ™ç›´æ¥æ˜¯åå­—é•¿åº¦åé¢è·Ÿç€åå­—ï¼›</li><li>æœ€åæ˜¯å‚æ•°åˆ—è¡¨ï¼Œ<code>v</code> è¡¨ç¤º<code>void</code>ã€‚</li></ol></blockquote><p>å› ä¸º<code>main.cpp</code> çš„ç¬¦å·<code>_Z10printHellov</code> æ˜¯æœªå®šä¹‰çš„ï¼Œå®ƒéœ€è¦è§£æé‡å®šä½åˆ°å®šä¹‰çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯<code>a.o</code> ä¸­ã€‚ä½†æ˜¾ç„¶ç¬¦å·<code>_Z10printHellov</code> å’Œ  <code>printHello</code> ä¸åŒï¼Œå› æ­¤é“¾æ¥æ—¶åœ¨<code>a.o</code>æ‰¾ä¸åˆ°ç›¸å…³ç¬¦å·å¯¼è‡´æŠ¥é”™ï¼Œæ— æ³•æ­£ç¡®é‡å®šä¹‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main.cpp:(.text+0x5): undefined reference to `printHello()&#x27;</span><br></pre></td></tr></table></figure><p><strong>è¿™ä¸ªæ—¶å€™extern â€œCâ€ å°±æ´¾ä¸Šç”¨åœºäº†ï¼šåœ¨C++æ–‡ä»¶æŒ‡å®šä»£ç /å¤´æ–‡ä»¶æŒ‰Cçš„æ–¹å¼è¿›è¡Œç¼–è¯‘</strong>ã€‚</p><p>å°†<code>a.h</code> ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus </span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>&#123; </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printHello</span><span class="params">()</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹<code>main.o</code> ç¬¦å·è¡¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test1]# gcc -c main.cpp -o main.o</span><br><span class="line">[root@roy-cpp test1]# nm main.o</span><br><span class="line">0000000000000000 T main</span><br><span class="line">                 U printHello</span><br></pre></td></tr></table></figure><p>ä¸€åˆ‡æ­£å¸¸ã€‚æ•´ä¸ªè¿‡ç¨‹è¯¦ç»†å˜åŒ–å¦‚ä¸‹ï¼š</p><ol><li><p><code>gcc</code> æ ¹æ®<code>main.cpp</code> æ–‡ä»¶ååç¼€è¯†åˆ«ä¸ºcppæ–‡ä»¶ï¼›</p></li><li><p>é¢„ç¼–è¯‘ï¼šå°†<code>main.cpp</code> ä¸­ <code>\#include &quot;a.h&quot;</code> å±•å¼€ï¼Œå› ä¸ºcppæ–‡ä»¶éƒ½ä¼šå­˜åœ¨å®å®šä¹‰<code>__cplusplus</code>ï¼Œæ‰€ä»¥<code>#ifdef __cplusplus</code> æˆç«‹ã€‚æœ€ç»ˆå±•å¼€ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>&#123; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printHello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘ï¼šç¼–è¯‘åˆ° extern â€œCâ€{â€¦} ä¸­çš„å˜é‡<code>printHello</code> æŒ‰Cæ–¹å¼ç¼–è¯‘æˆç¬¦å·<code>printHello</code> ã€‚</p></li></ol><p>å†æ¬¡å°è¯•ç¼–è¯‘ä¹Ÿç¡®å®æ­£å¸¸è¾“å‡ºäº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test1]# gcc  main.cpp a.c -o main.out</span><br><span class="line">[root@roy-cpp test1]# ./main.out </span><br><span class="line">hello C ! </span><br></pre></td></tr></table></figure><p><strong>ä½†æ˜¯g++ç¼–è¯‘ä¸ä½¿ç”¨extern â€œCâ€æ±‡ç¼–Cå’ŒC++ä»£ç ä¹Ÿä¸ä¼šå‡ºé”™ ï¼Œå› ä¸ºg++å°†cæˆ–cppä»£ç éƒ½æŒ‰cppæ–¹å¼ç¼–è¯‘</strong>ã€‚</p><p>ä¸‹é¢æ˜¯æµ‹è¯•ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220121175557825.png" alt="image-20220121175557825"></p><p>æŸ¥çœ‹æ­¤æ—¶<code>a.c</code>ç¼–è¯‘åçš„<code>a.o</code> ç¬¦å·è¡¨ï¼ˆcppé£æ ¼ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp test1]<span class="comment"># g++ -c a.c -o a.o</span></span><br><span class="line">[root@roy-cpp test1]<span class="comment"># nm a.o</span></span><br><span class="line">                 U puts</span><br><span class="line">0000000000000000 T _Z10printHellov</span><br></pre></td></tr></table></figure><h4 id="1-3-2-staticå…³é”®å­—">1.3.2  staticå…³é”®å­—</h4><p>staticå…³é”®å­—å¸¸äºå„ç§é¢è¯•é¢˜ã€ä¹¦ç±ä¸­ï¼Œ<strong>ä¸ºä»€ä¹ˆéœ€è¦staticå…³é”®å­—ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤é‡è¦</strong>ï¼Ÿ</p><p>æˆ‘ä»¬ä»é¢å‘è¿‡ç¨‹å’Œé¢å‘è§’åº¦ä¸¤ä¸ªè§’åº¦åˆ†æã€‚</p><h5 id="é¢å‘è¿‡ç¨‹è§’åº¦">é¢å‘è¿‡ç¨‹è§’åº¦</h5><p><strong>ä¸€ã€ä½œç”¨åŸŸéšè—ã€‚å½“ä¸€ä¸ªå·¥ç¨‹æœ‰å¤šä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œç”¨staticä¿®é¥°çš„å‡½æ•°æˆ–å˜é‡åªèƒ½å¤Ÿåœ¨æœ¬æ–‡ä»¶ä¸­å¯è§ï¼Œæ–‡ä»¶å¤–ä¸å¯è§</strong>ã€‚</p><blockquote><p><strong>å¯¹æ¯”å…¨å±€å˜é‡/å‡½æ•°</strong>ï¼šå…¨å±€å˜é‡/å‡½æ•°è®¿é—®å…·æœ‰å…¨å±€æ€§ï¼Œ<u>å…¶å®ƒæ–‡ä»¶</u>é€šè¿‡<strong>externå…³é”®å­—æˆ–å¼•ç”¨å¤´æ–‡ä»¶</strong>ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨<u>æœ¬æ–‡ä»¶</u>ä¸­å®šä¹‰çš„å…¨å±€å˜é‡/å‡½æ•°ã€‚</p></blockquote><p>ä½†æœ‰æ—¶æˆ‘ä»¬å¹¶ä¸å¸Œæœ›è¿™æ ·ï¼Œå› ä¸ºè¿™æš´éœ²äº†æˆ‘ä»¬ä¸æƒ³æš´éœ²çš„å˜é‡/å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™staticå¯ä»¥æ›´å¥½çš„é™å®šä½œç”¨èŒƒå›´ã€‚</p><p>ç”±æ­¤è¿˜å¼•ç”³å¦å¤–ä¸€ä¸ªå¥½å¤„ï¼šä¸åŒçš„äººç¼–å†™ä¸åŒçš„å‡½æ•°æ—¶ï¼Œ<strong>ä¸ç”¨æ‹…å¿ƒæ˜¯å¦ä¼šä¸å…¶å®ƒæ–‡ä»¶ä¸­çš„å‡½æ•°åŒå</strong>ï¼Œå› ä¸ºåŒåä¹Ÿæ²¡æœ‰å…³ç³»ï¼ˆé™å®šä½œç”¨èŒƒå›´åœ¨æœ¬æ–‡ä»¶å†…ï¼‰ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªå°ä¾‹å­æ¥ç†è§£ï¼š</p><ul><li><p><strong>å˜é‡ä½œç”¨åŸŸ</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿staticè¢«externå…³é”®å­—ä¿®é¥°ï¼Œä¾æ—§ä¸èƒ½å…¶å®ƒæ–‡ä»¶è¢«å¼•ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*other.cpp*/</span></span><br><span class="line"><span class="keyword">int</span> global_var = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> static_var = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*main.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> global_var;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> staic_var;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘æ­£ç¡®ï¼Œother.cppä¸­çš„global_varè¢«æ­£ç¡®æ‰“å°è¾“å‡º</span></span><br><span class="line">    cout&lt;&lt;global_var&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼–è¯‘é”™è¯¯ï¼Œundefined reference to `staic_var&#x27;</span></span><br><span class="line">    cout&lt;&lt;staic_var&lt;&lt;endl;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å‡½æ•°ä½œç”¨åŸŸ</strong></p><p>å°†é™æ€å‡½æ•°<code>static_func</code> å®šä¹‰åœ¨<code>other.h</code> ï¼ˆå®ç°åœ¨<code>other.cpp</code>ï¼‰ï¼Œæ— æ³•é€šè¿‡ç¼–è¯‘ï¼šundefined reference to static_func()ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/*other.h*/</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">static_func</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">global_func</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*other.cpp*/</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">static_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      cout&lt;&lt;<span class="string">&quot;i am static_func in other.cpp&quot;</span>&lt;&lt;endl;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">global_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       cout&lt;&lt;<span class="string">&quot;i am global_func in other.cpp&quot;</span>&lt;&lt;endl;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*main.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;other.h&quot;</span>  </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="comment">// å‡ºé”™ï¼šundefined reference to &#x27;static_func()&#x27;</span></span><br><span class="line">      <span class="built_in">global_func</span>();</span><br><span class="line">    <span class="built_in">static_func</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å°è¯•ç¼–è¯‘å‡ºé”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -std=c++11 main.cpp other.cpp -o main.out</span><br></pre></td></tr></table></figure><p><strong>ä½†å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨å¤´æ–‡ä»¶ï¼Œ<code>static_func</code>å¯ä»¥è¢«æˆåŠŸä½¿ç”¨</strong>ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/*other.cpp*/</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">static_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      cout&lt;&lt;<span class="string">&quot;i am static_func in other.cpp&quot;</span>&lt;&lt;endl;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">global_func</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       cout&lt;&lt;<span class="string">&quot;i am global_func in other.cpp&quot;</span>&lt;&lt;endl;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/*main.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;other.cpp&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li></ul><p>int main()<br>{<br>// å‡è¢«æ­£ç¡®æ‰§è¡Œäº†<br>global_func();<br>static_func();<br>}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">![image-20220121001648635](https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220121001648635.png)</span><br><span class="line">  </span><br><span class="line">è¿™æ˜¯å› ä¸ºæ­¤æ—¶`static_func` å·²ç»è¢«è§†ä¸ºåœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</span><br><span class="line">  </span><br><span class="line">æ³¨æ„åˆ°ï¼š</span><br><span class="line">  </span><br><span class="line">1. å¤´æ–‡ä»¶ `#include &quot;other.cpp&quot;` ï¼Œé¢„ç¼–è¯‘æ—¶ç›´æ¥æ›¿æ¢ä¸º `other.cpp` ä¸­å†…å®¹ï¼Œ ç›¸å½“ç›´æ¥åœ¨`main.cpp` &lt;u&gt;å®šä¹‰&lt;/u&gt;äº†`static_func` ã€‚åŒä¸€ä¸ªæ–‡ä»¶ä¸­è°ƒç”¨é™æ€å‡½æ•°`static_func`è‡ªç„¶æ˜¯å¯ä»¥çš„ã€‚ </span><br><span class="line">  </span><br><span class="line">     é¢„ç¼–è¯‘åçš„æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚</span><br><span class="line">  </span><br><span class="line">     ![image-20220121002134540](https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220121002134540.png)</span><br><span class="line">  </span><br><span class="line">     è€Œä¹‹å‰ç”Ÿæˆçš„é¢„ç¼–è¯‘æ–‡ä»¶æ˜¯ä¸ä¼šåŒ…å«é™æ€å‡½æ•°çš„å®šä¹‰ï¼ˆåªæœ‰å¤´æ–‡ä»¶`other.h`ä¸­çš„é™æ€å‡½æ•°å£°æ˜ï¼‰ï¼Œæ‰€ä»¥å®é™…å®šä¹‰è¿˜æ˜¯åœ¨åˆ«çš„æ–‡ä»¶ï¼ˆ`other.cpp`ï¼‰ä¸­ï¼Œå› æ­¤è°ƒç”¨æ—¶ä¼šå‡ºé”™ã€‚</span><br><span class="line">  </span><br><span class="line">  2. æ‰€ä»¥æˆ‘ä»¬åœ¨g++ç¼–è¯‘æ—¶éƒ½ä¸ç”¨æŠŠ`other.cpp`ä½œä¸ºæºæ–‡ä»¶ï¼ˆé¢„ç¼–è¯‘æ—¶å·²ç»æ›¿æ¢äº†ï¼‰ã€‚</span><br><span class="line">  </span><br><span class="line">     ![image-20220121002353063](https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220121002353063.png)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">**äºŒã€å…¨å±€ç”Ÿå‘½å‘¨æœŸã€‚ç”¨staticä¿®é¥°çš„å˜é‡æˆ–å‡½æ•°ç”Ÿå‘½å‘¨æœŸæ˜¯å…¨å±€çš„ï¼ˆå³ä½¿æ˜¯å±€éƒ¨é™æ€å˜é‡ï¼‰ï¼Œå­˜å‚¨åœ¨é™æ€æ•°æ®åŒºï¼ˆå…¨å±€æ•°æ®åŒºï¼‰ã€‚ å³åœ¨mainå‡½æ•°æ‰§è¡Œå‰å°±ä¼šè¢«åˆå§‹åŒ–**ã€‚</span><br><span class="line"></span><br><span class="line">&lt;img src=&quot;https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/memory.png&quot; alt=&quot;memory&quot; style=&quot;zoom:67%;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬ä¸¾ä¸€ä¸ªå®ä¾‹ï¼Œæ¥æ›´å¥½çš„ç†è§£â€œå…¨å±€ç”Ÿå‘½å‘¨æœŸâ€è¿™ä¸ªæ¦‚å¿µã€‚</span><br><span class="line"></span><br><span class="line">- ä¸‹ä¾‹ä¸­ï¼Œåœ¨`normal_add`å‡½æ•°ä¸­å®šä¹‰äº†å±€éƒ¨å˜é‡`count` ï¼Œæ¯æ¬¡å‡½æ•°é€€å‡ºï¼Œcountä¹Ÿéšä¹‹é”€æ¯ã€‚æ‰€ä»¥æ¯æ¬¡æ‰“å°çš„éƒ½æ˜¯è¿›å…¥å‡½æ•°åˆå§‹åŒ–åçš„å€¼+1ã€‚</span><br><span class="line"></span><br><span class="line">  ```cpp</span><br><span class="line"> #include &lt;iostream&gt;</span><br><span class="line">  using namespace std;</span><br><span class="line">  </span><br><span class="line">  static int i ;    // å…¨å±€è®¿é—®æ€§ï¼Œå…¨å±€ç”Ÿå‘½å‘¨æœŸ </span><br><span class="line">  </span><br><span class="line">  int normal_add()</span><br><span class="line">  &#123;</span><br><span class="line">      int count = 0;  // å±€éƒ¨è®¿é—®æ€§ï¼Œå±€éƒ¨è®¿é—®å‘¨æœŸ</span><br><span class="line">      return ++count;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  int main()</span><br><span class="line">  &#123;</span><br><span class="line">     for(int j = 0 ; j &lt; 3 ; j++)</span><br><span class="line">        cout&lt;&lt; normal_add()&lt;&lt;endl;</span><br><span class="line">     return 0;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211224205831812.png" alt="image-20211224205831812"></p><ul><li><p>ä¸‹ä¾‹ä¸­ï¼Œåœ¨<code>static_add</code> ä¸­å®šä¹‰äº†å±€éƒ¨é™æ€å˜é‡<code>count</code> ã€‚<strong>å®ƒåªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼ˆå†…å­˜åªè¢«åˆ†é…ä¸€æ¬¡ï¼Œè§ä¸‹ä¾‹è§£é‡Šï¼‰ï¼Œéšç€å‡½æ•°é€€å‡ºä¹Ÿä¸é”€æ¯</strong>ï¼Œä¿æŒæœ€æ–°çš„å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">int</span> i ;    <span class="comment">// å…¨å±€è®¿é—®æ€§ï¼Œå…¨å±€ç”Ÿå‘½å‘¨æœŸ </span></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">static_add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;  <span class="comment">// å±€éƒ¨è®¿é—®æ€§ï¼Œå±€éƒ¨è®¿é—®å‘¨æœŸ</span></span><br><span class="line">     <span class="keyword">return</span> ++count;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">    <span class="comment">// è™½ç„¶å¤šæ¬¡ï¼ˆ3æ¬¡ï¼‰è¿›å…¥äº†å‡½æ•°static_add</span></span><br><span class="line">    <span class="comment">// ä½†countåªåœ¨ç¬¬ä¸€æ¬¡è¿›å…¥å‡½æ•°è¢«åˆå§‹åŒ–äº†ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; <span class="number">3</span> ; j++)</span><br><span class="line">       cout&lt;&lt; <span class="built_in">static_add</span>()&lt;&lt;endl;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211224205850147.png" alt="image-20211224205850147"></p></li></ul><p><strong>ä¸‰ã€åˆå§‹åŒ–é›¶å€¼</strong>ã€‚</p><p>staticä¿®é¥°çš„ï¼ˆå±€éƒ¨/å…¨å±€ï¼‰å˜é‡å’Œå…¨å±€å˜é‡ä¸€æ ·ï¼Œä¸æ˜¾ç¤ºå®šä¹‰æ—¶ä¼šè¿›è¡Œé›¶å€¼åˆå§‹åŒ–ã€‚</p><h5 id="é¢å‘å¯¹è±¡è§’åº¦">é¢å‘å¯¹è±¡è§’åº¦</h5><p><strong>ä¸€ã€ç±»åªæ‹·è´ä¸€ä»½ã€‚ç±»ä¸­staticä¿®é¥°çš„é™æ€æ•°æ®æˆå‘˜æˆ–é™æ€æˆå‘˜å‡½æ•°æ˜¯å±äºç±»çš„ï¼Œæ‰€æœ‰å¯¹è±¡åªæœ‰ä¸€ä»½æ‹·è´ï¼Œå› æ­¤å®ƒçš„å€¼å¯ä»¥è¢«æ‰€æœ‰å¯¹è±¡æ›´æ–°ï¼Œåœ¨ç±»æœªå®ä¾‹åŒ–å°±å¯ä»¥ä½¿ç”¨</strong>ã€‚</p><p>ç‰¹åˆ«çš„ï¼Œ <strong>staticç±»å¯¹è±¡å¿…é¡»è¦åœ¨ç±»å¤–è¿›è¡Œåˆå§‹åŒ–</strong>ï¼Œå› ä¸ºstaticä¿®é¥°çš„å˜é‡å…ˆäºå¯¹è±¡å­˜åœ¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> j;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> test::i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> test::j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1.ç±»æœªå®ä¾‹åŒ–å°±å¯ä»¥è¢«ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">// 2.static åƒæ™®é€šç±»æˆå‘˜å¯ä»¥è¢«ä¿®é¥°ä¸ºprivate</span></span><br><span class="line">    <span class="comment">// test::i = 1;  // è®¿é—®é”™è¯¯ï¼Œç§æœ‰é™æ€å˜é‡</span></span><br><span class="line">    test::j = <span class="number">1</span>;     <span class="comment">// è®¿é—®æ­£ç¡®ï¼Œå…¬æœ‰é™æ€å˜é‡</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment">// 3.æ‰€æœ‰å¯¹è±¡åªæœ‰ä¸€ä»½æ‹·è´ï¼Œæ›´æ–°çš„åŒä¸€å—å­˜å‚¨åŒºåŸŸ</span></span><br><span class="line">    <span class="comment">//   ä½†å¦‚æœæ˜¯æ™®é€šç±»æ•°æ®æˆå‘˜ï¼Œä¸‹é¢è¾“å‡ºéƒ½æ˜¯1ã€‚</span></span><br><span class="line">    test a, b ,c ;</span><br><span class="line">    cout&lt;&lt;++a.j&lt;&lt;endl ;   <span class="comment">// 2</span></span><br><span class="line">    cout&lt;&lt;++b.j&lt;&lt;endl ;   <span class="comment">// 3</span></span><br><span class="line">    cout&lt;&lt;++c.j&lt;&lt;endl ;   <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§ç‰¹æ€§å¯ä»¥å¾ˆå¥½çš„å®ç°ç±»å¤šä¸ªå¯¹è±¡çš„å˜é‡å…±äº«ã€‚</p><p>åœ¨åé¢é¢å¯¹å¯¹è±¡ç¬”è®°ä¸­ï¼Œæœ‰æœºä¼šæˆ‘ä»¬è¿˜ä¼šæ›´æ·±å…¥æ¢è®¨ä¸‹staticçš„ç”¨æ³•ï¼Œæ¯”å¦‚ä¸è™šå‡½æ•°çš„å…³ç³»ã€‚</p><p>æœ€åï¼Œæ€»ç»“ä¸‹å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚</p><p><strong>å…¨å±€å˜é‡/å‡½æ•°å’Œstaticå˜é‡/å‡½æ•°çš„åŒºåˆ«</strong>ï¼Ÿ</p><ol><li><strong>å­˜å‚¨æ–¹å¼</strong>ã€‚å…¨å±€å˜é‡/å‡½æ•°å’Œstaticå˜é‡/å‡½æ•°éƒ½æ˜¯é™æ€å­˜å‚¨æ–¹å¼ï¼Œå­˜å‚¨åœ¨å…¨å±€æ•°æ®åŒºã€‚</li><li><strong>ä½œç”¨åŸŸ</strong>ã€‚å…¨å±€å˜é‡/å‡½æ•°æ˜¯å¯è§æ€§å…¨å±€æ€§ï¼Œå…¶å®ƒæ–‡ä»¶ä¸­å¯é€šè¿‡externå…³é”®å­—/å¼•ç”¨å¤´æ–‡ä»¶ï¼Œæ¥è¿›è¡Œä½¿ç”¨ï¼›ä½†é™æ€å˜é‡/å‡½æ•°åªèƒ½åœ¨æœ¬ç±»ä½¿ç”¨ã€‚</li><li><strong>åˆå§‹åŒ–</strong>ã€‚staicå˜é‡/å‡½æ•°åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä½†å…¨å±€å˜é‡åˆ™ä¸ç„¶å¯ä»¥è¢«åˆå§‹åŒ–å¤šæ¬¡ã€‚</li><li><strong>é¢å¯¹å¯¹è±¡</strong>ã€‚ç±»é™æ€æˆå‘˜ã€å‡½æ•°åªè¢«æ‹·è´ä¸€ä»½ï¼Œä¸ºå…¨å¯¹è±¡å…±äº«ã€‚</li></ol><h3 id="1-4-å¸¸é‡">1.4 å¸¸é‡</h3><p>åœ¨å‰é¢æˆ‘ä»¬è®¤è¯†çš„â€œå˜é‡â€ï¼Œå³æ„ä¸ºâ€œå˜åŒ–å¯è¢«ä¿®æ”¹çš„å€¼â€ï¼Œçµæ´»æ€§å¼ºã€‚</p><p>åœ¨C++ä¸­è¿˜å­˜åœ¨â€œå¸¸é‡â€ï¼Œå³â€œä¸å¸Œæœ›è¢«ä¿®æ”¹çš„å€¼â€ï¼Œå®šä¹‰ä»¥åæ— æ³•è¢«ä¿®æ”¹ã€‚</p><p>å¦‚ä½•å®šä¹‰ä¸€ä¸ªå¸¸é‡ï¼Ÿ</p><h4 id="1-4-1-å®šä¹‰å¸¸é‡">1.4.1 å®šä¹‰å¸¸é‡</h4><blockquote><p>ğŸ–‹ æŠŠå¸¸é‡å®šä¹‰ä¸ºå¤§å†™å­—æ¯å½¢å¼ï¼Œæ˜¯éå¸¸å¥½çš„ç¼–ç¨‹å®è·µã€‚</p></blockquote><p>åœ¨ C++ ä¸­ï¼Œæœ‰ä¸¤ç§ç®€å•çš„å®šä¹‰å¸¸é‡çš„æ–¹å¼ï¼š</p><ul><li><p>ä½¿ç”¨ <strong>#define</strong> é¢„å¤„ç†å™¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME value</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ <strong>const</strong> å…³é”®å­—ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> type  NAME = value;</span><br></pre></td></tr></table></figure></li></ul><p>ä»¥ä¸‹æ˜¯æ›´å¤šçš„å®ä¾‹ï¼ˆä»¥constå…³é”®å­—å®šä¹‰ä¸ºä¾‹ï¼‰ã€‚è¯·æ³¨æ„ä¸åŒæ•°æ®ç±»å‹å¸¸é‡å®šä¹‰çš„åŒºåˆ«ã€‚</p><h4 id="1-4-2-å¸¸é‡ç±»å‹">1.4.2 å¸¸é‡ç±»å‹</h4><ul><li><p><strong>æ•´æ•°å¸¸é‡</strong></p><p>æ•´æ•°å¸¸é‡å¯ä»¥æ˜¯åè¿›åˆ¶ã€å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶çš„å¸¸é‡ã€‚å‰ç¼€æŒ‡å®šåŸºæ•°ï¼š0x æˆ– 0X è¡¨ç¤ºåå…­è¿›åˆ¶ï¼Œ0 è¡¨ç¤ºå…«è¿›åˆ¶ï¼Œä¸å¸¦å‰ç¼€åˆ™é»˜è®¤è¡¨ç¤ºåè¿›åˆ¶ã€‚</p><p>æ•´æ•°å¸¸é‡ä¹Ÿå¯ä»¥å¸¦ä¸€ä¸ªåç¼€ï¼Œåç¼€æ˜¯ U å’Œ L çš„ç»„åˆï¼ŒU è¡¨ç¤ºæ— ç¬¦å·æ•´æ•°ï¼ˆunsignedï¼‰ï¼ŒL è¡¨ç¤ºé•¿æ•´æ•°ï¼ˆlongï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">int</span> VALUE = <span class="number">123</span>;</span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">int</span> VALUE = <span class="number">123L</span>;   <span class="comment">// è‡ªåŠ¨è½¬æ¢ä¸ºlongç±»å‹</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">int</span> VALUE = <span class="number">123u</span>;   <span class="comment">// è‡ªåŠ¨è½¬æ¢ä¸ºunsiged intç±»å‹</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">int</span> VALUE = <span class="number">0x123</span>;  <span class="comment">// 16è¿›åˆ¶</span></span><br><span class="line">   <span class="keyword">const</span> <span class="keyword">int</span> VALUE = <span class="number">0123</span>;   <span class="comment">// 8è¿›åˆ¶</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>æµ®ç‚¹å¸¸é‡</strong></p><p>æµ®ç‚¹å¸¸é‡ç”±æ•´æ•°éƒ¨åˆ†ã€å°æ•°ç‚¹ã€å°æ•°éƒ¨åˆ†å’ŒæŒ‡æ•°éƒ¨åˆ†ç»„æˆã€‚</p><p>ä»¥ä¸‹ä»…ç»™å‡ºå…³é”®ä»£ç ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">float</span> VALUE = <span class="number">3.14159</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">float</span> VALUE = <span class="number">314159e-5</span>;  <span class="comment">// ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å¸ƒå°”å¸¸é‡</strong></p><p>å¸ƒå°”å¸¸é‡å…±æœ‰ä¸¤ä¸ªï¼Œå³<strong>trueå’Œfalse</strong>ã€‚</p><p>ä»¥ä¸‹ä»…ç»™å‡ºå…³é”®ä»£ç ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">bool</span> VALUE = <span class="literal">true</span>;   </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">bool</span> VALUE = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸åº”æŠŠ true çš„å€¼çœ‹æˆ 1ï¼ŒæŠŠ false çš„å€¼çœ‹æˆ 0ã€‚å³å¦‚ä¸‹å®šä¹‰é€šå¸¸ä¸å»ºè®®è¿›è¡Œï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸å»ºè®®çš„åšæ³•</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">bool</span> VALUE = <span class="number">1</span>;   </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">bool</span> VALUE = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>å­—ç¬¦å¸¸é‡</strong></p><p>å­—ç¬¦å¸¸é‡æ˜¯<strong>æ‹¬åœ¨å•å¼•å·ä¸­</strong>ã€‚</p><p>å­—ç¬¦å¸¸é‡å¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ï¼ˆä¾‹å¦‚ â€˜xâ€™ï¼‰ã€ä¸€ä¸ªè½¬ä¹‰åºåˆ—ï¼ˆä¾‹å¦‚ â€˜\tâ€™ï¼‰ï¼Œæˆ–ä¸€ä¸ªé€šç”¨çš„å­—ç¬¦ï¼ˆä¾‹å¦‚ â€˜\u02C0â€™ï¼‰ã€‚</p><p>ä»¥ä¸‹ç»™å‡ºå…³é”®ä»£ç è¿›è¡Œç¤ºä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> VALUE = <span class="string">&#x27;X&#x27;</span>;        <span class="comment">// æ™®é€šå­—ç¬¦</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> VALUE = <span class="string">&#x27;\n&#x27;</span>;       <span class="comment">// è½¬ä¹‰å­—ç¬¦ï¼Œå³æ¢è¡Œç¬¦</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> VALUE = <span class="string">&#x27;\u02C0&#x27;</span>;   <span class="comment">// é€šç”¨å­—ç¬¦ï¼Œæ‰“å°è¾“å‡º</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å­—ç¬¦ä¸²å¸¸é‡</strong></p><p>å­—ç¬¦ä¸²å­—é¢å€¼æˆ–å¸¸é‡æ˜¯æ‹¬åœ¨åŒå¼•å· â€œâ€ ä¸­çš„ã€‚ä¸€ä¸ªå­—ç¬¦ä¸²åŒ…å«ç±»ä¼¼äºå­—ç¬¦å¸¸é‡çš„å­—ç¬¦ï¼šæ™®é€šçš„å­—ç¬¦ã€è½¬ä¹‰åºåˆ—å’Œé€šç”¨çš„å­—ç¬¦ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> string VALUE = <span class="string">&quot;\n&quot;</span>;       <span class="comment">// è½¬ä¹‰å­—ç¬¦ï¼Œå³æ¢è¡Œç¬¦</span></span><br><span class="line"><span class="keyword">const</span> string VALUE = <span class="string">&quot;\u02C0&quot;</span>;   <span class="comment">// é€šç”¨å­—ç¬¦ï¼Œæ‰“å°è¾“å‡º</span></span><br><span class="line"><span class="keyword">const</span> string VALUE = <span class="string">&quot;hello world&quot;</span>;   </span><br></pre></td></tr></table></figure></li></ul><h4 id="1-4-3-const-å’Œconstexpr">1.4.3 const å’Œconstexpr</h4><p>C++11 å¼•å…¥äº†ä¸€ä¸ªå…³é”®å­—<strong>å¸¸é‡è¡¨è¾¾å¼<code>constexpr</code>ï¼Œå®ƒç¡®ä¿å˜é‡å¿…é¡»åœ¨<u>ç¼–è¯‘æ—¶</u>è¢«åˆå§‹åŒ–ï¼Œè€Œ<code>const</code>ä¿®é¥°çš„å˜é‡å¯ä»¥åœ¨<u>ç¼–è¯‘æ—¶</u>æˆ–<u>è¿è¡Œæ—¶</u>è¢«åˆå§‹åŒ–</strong>ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œ<code>constexpr</code> è¯­ä¹‰æ‰æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å¸¸é‡ï¼Œè¿è¡Œæ—¶ä¸èƒ½åˆå§‹åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::cin;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> j = i + <span class="number">1</span>; <span class="comment">// okï¼Œconstä¿®é¥°çš„å€¼åœ¨è¿è¡Œæ—¶è¢«åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">int</span> j = i + <span class="number">1</span>; <span class="comment">// errorï¼Œè¿è¡Œæ—¶æ— æ³•åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ç¼–è¯‘å‡ºé”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp <span class="built_in">test</span>]<span class="comment"># g++ -std=c++11 test.cpp -o test.out</span></span><br><span class="line">test.cpp: In <span class="keyword">function</span> â€˜int main()â€™:</span><br><span class="line">test.cpp:1817:25: error: the value of â€˜iâ€™ is not usable <span class="keyword">in</span> a constant expression</span><br><span class="line">     constexpr int j = i+1;</span><br></pre></td></tr></table></figure><p><strong><code>constexpr</code>æœ‰ä»€ä¹ˆå¥½å¤„</strong>ï¼Ÿ</p><p><code>constexpr</code> å¯ä»¥æ˜¾ç¤ºåœ°å‘Šè¯‰ç¼–è¯‘å™¨<u>è¡¨ç¤ºå¼æ˜¯ç¡®å®šå€¼ä¸”å¯ä»¥è¢«ä¼˜åŒ–</u>ï¼Œ<code>const</code> ä¿®é¥°çš„ç¼–è¯‘å™¨åªèƒ½<u>éšå¼è·Ÿè¸ªæ˜¯è¿è¡Œæ—¶å¸¸é‡è¿˜æ˜¯ç¼–è¯‘æ—¶å¸¸é‡</u>ã€‚</p><p>æ¯”å¦‚ä¸Šè¿°ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> i = <span class="number">0</span>; <span class="comment">// ä¿®æ”¹ä¸ºå¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> j = i + <span class="number">1</span>; <span class="comment">// okï¼Œconstä¿®é¥°çš„å€¼åœ¨è¿è¡Œæ—¶è¢«åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">int</span> j = i + <span class="number">1</span>; <span class="comment">// okï¼Œåœ¨ç¼–è¯‘æ—¶è¿™è¡Œä»£ç è¢«ä¼˜åŒ–</span></span><br></pre></td></tr></table></figure><p>ç”±äº<code>i</code>ä¹Ÿæ˜¯å¸¸é‡ï¼Œè¡¨è¾¾å¼<code>int j = i + 1</code>æ˜¾ç„¶ä¹Ÿä¸€å®šä¼šæ˜¯å¸¸é‡ã€‚æˆ‘ä»¬ç”±æ­¤å¯ä»¥æ˜¾ç¤ºå£°æ˜ä¸º<code>constexpr</code>ï¼Œè¿™æ ·è¡¨è¾¾å¼ä¼šè¢«ç¼–è¯‘å™¨å¤§èƒ†åœ°åœ¨ç¼–è¯‘æœŸè¿›è¡Œä¼˜åŒ–ï¼Œæé«˜ç¼–è¯‘é€Ÿåº¦ã€‚</p><p>åœ¨å¯¹æ€§èƒ½è¦æ±‚è‹›åˆ»çš„é«˜å¹¶å‘åœºæ™¯<code>constexpr</code>æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h4 id="1-4-4-define-const-å‡½æ•°-ğŸŒŸ">1.4.4 define &amp; const &amp; å‡½æ•° ğŸŒŸ</h4><p><strong>defineå®å®šä¹‰å’Œconstçš„åŒºåˆ«</strong>ï¼Ÿ</p><ul><li><strong>æ–‡æœ¬æ›¿æ¢</strong>ï¼šdefineæ˜¯åœ¨ç¼–è¯‘çš„<strong>é¢„å¤„ç†</strong>é˜¶æ®µèµ·ä½œç”¨ï¼Œå±äºæ–‡æœ¬æ’å…¥æ›¿æ¢ï¼›è€Œconstæ˜¯åœ¨<strong>ç¼–è¯‘ã€è¿è¡Œ</strong>çš„æ—¶å€™èµ·ä½œç”¨ï¼›</li><li><strong>ç±»å‹æ£€æŸ¥</strong>ï¼šdefineåªåšæ›¿æ¢ï¼Œä¸åšç±»å‹æ£€æŸ¥å’Œè®¡ç®—ï¼Œä¹Ÿä¸æ±‚è§£ï¼Œå®¹æ˜“äº§ç”Ÿé”™è¯¯ï¼›constå¸¸é‡æœ‰æ•°æ®ç±»å‹ï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹å…¶è¿›è¡Œç±»å‹å®‰å…¨æ£€æŸ¥ï¼›</li><li><strong>å†…å­˜å ç”¨</strong>ï¼šdefineåªæ˜¯å°†å®åç§°è¿›è¡Œæ›¿æ¢ï¼Œåœ¨å†…å­˜ä¸­ä¼šäº§ç”Ÿå¤šåˆ†ç›¸åŒçš„å¤‡ä»½ã€‚conståœ¨ç¨‹åºè¿è¡Œä¸­åªæœ‰ä¸€ä»½å¤‡ä»½ï¼Œä¸”å¯ä»¥æ‰§è¡Œå¸¸é‡æŠ˜å ï¼Œèƒ½å°†å¤æ‚çš„çš„è¡¨è¾¾å¼è®¡ç®—å‡ºç»“æœæ”¾å…¥å¸¸é‡è¡¨ï¼›</li><li><strong>ç©ºé—´åˆ†é…</strong>ï¼šå®å®šä¹‰çš„æ•°æ®æ²¡æœ‰åˆ†é…å†…å­˜ç©ºé—´ï¼Œåªæ˜¯æ’å…¥æ›¿æ¢æ‰ï¼›constå®šä¹‰çš„å˜é‡åªæ˜¯å€¼ä¸èƒ½æ”¹å˜ï¼Œä½†è¦åˆ†é…å†…å­˜ç©ºé—´ã€‚</li></ul><p><strong>defineå®å®šä¹‰å’Œå‡½æ•°çš„åŒºåˆ«</strong>ï¼Ÿ</p><ul><li><p><strong>æ–‡æœ¬æ›¿æ¢</strong>ï¼šdefineæ˜¯åœ¨ç¼–è¯‘çš„<strong>é¢„å¤„ç†</strong>é˜¶æ®µèµ·ä½œç”¨ï¼Œå±äºæ–‡æœ¬æ’å…¥æ›¿æ¢ï¼›å‡½æ•°è°ƒç”¨åœ¨è¿è¡Œæ—¶éœ€è¦è·³è½¬åˆ°å…·ä½“è°ƒç”¨å‡½æ•°ï¼›</p></li><li><p><strong>ç±»å‹æ£€æŸ¥</strong>ï¼šdefineåªåšæ›¿æ¢ï¼Œä¸åšç±»å‹æ£€æŸ¥å’Œè®¡ç®—ï¼Œä¹Ÿä¸æ±‚è§£ï¼Œå®¹æ˜“äº§ç”Ÿé”™è¯¯ï¼›å‡½æ•°å‚æ•°å…·æœ‰ç±»å‹ï¼Œéœ€è¦æ£€æŸ¥ç±»å‹ï¼›</p></li><li><p><strong>å…¶å®ƒ</strong>ï¼šå‡½æ•°æœ‰è¿”å›å€¼ï¼Œåœ¨æœ€åä¸ç”¨åŠ åˆ†å·ã€‚</p></li></ul><h3 id="1-5-è¿ç®—ç¬¦">1.5 è¿ç®—ç¬¦</h3><p>è¿ç®—ç¬¦æ˜¯ä¸€ç§å‘Šè¯‰ç¼–è¯‘å™¨<strong>æ‰§è¡Œç‰¹å®šçš„æ•°å­¦æˆ–é€»è¾‘æ“ä½œ</strong>çš„ç¬¦å·ã€‚</p><p>é™¤äº†å¸¸è§çš„ï¼š<strong>ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€ä½è¿ç®—ç¬¦ã€èµ‹å€¼è¿ç®—ç¬¦</strong>å¤–ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å…¶å®ƒçš„ä¸€äº›é‡è¦è¿ç®—ç¬¦ã€‚</p><table><thead><tr><th style="text-align:center">è¿ç®—ç¬¦</th><th style="text-align:center">æè¿°</th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><code>sizeof</code></td><td style="text-align:center">sizeof è¿ç®—ç¬¦ä¸€ä¸ªå¯¹è±¡æˆ–ç±»å‹æ‰€å çš„å†…å­˜å­—èŠ‚æ•°ã€‚</td><td style="text-align:center">é‡è¦ï¼Œ4.1.3èŠ‚ç»™å‡ºå…·ä½“ç¤ºä¾‹</td></tr><tr><td style="text-align:center"><code>Condition ? X : Y</code></td><td style="text-align:center">æ¡ä»¶è¿ç®—ç¬¦ã€‚å¦‚æœ Condition ä¸ºçœŸ ? åˆ™å€¼ä¸º X : å¦åˆ™å€¼ä¸º Yã€‚</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><code>.</code>ã€  <code>-&gt;</code></td><td style="text-align:center">æˆå‘˜è¿ç®—ç¬¦ç”¨äºå¼•ç”¨ç±»ã€ç»“æ„å’Œå…±ç”¨ä½“çš„æˆå‘˜ã€‚</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><code>Cast</code></td><td style="text-align:center">å¼ºåˆ¶è½¬æ¢è¿ç®—ç¬¦æŠŠä¸€ç§æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®ç±»å‹ã€‚</td><td style="text-align:center">4.XèŠ‚è¯¦è¿°</td></tr><tr><td style="text-align:center"><code>&amp;</code></td><td style="text-align:center">å–åœ°å€è¿ç®—ç¬¦ <code>&amp;</code> ï¼Œå¯è·å–å˜é‡çš„åœ°å€ã€‚ä¾‹å¦‚ ï¼Œ<code>int var =3; int *ptr=&amp;var</code>ï¼Œè·å–å˜é‡<code>var</code>çš„åœ°å€ã€‚</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><code>*</code></td><td style="text-align:center">é—´æ¥å¯»å€è¿ç®—ç¬¦ <code>*</code>ï¼Œ è·å–æŒ‡å®šåœ°å€çš„å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼Œ<code>int val = *ptr</code> ,æ­¤æ—¶var=3ã€‚</td><td style="text-align:center"></td></tr></tbody></table><h4 id="1-5-1-è¿ç®—ç¬¦æ±‡æ€»">1.5.1 è¿ç®—ç¬¦æ±‡æ€»</h4><blockquote><p>è¯¥å°èŠ‚è¯¦ç»†åˆ—å‡ºå„ç±»è¿ç®—ç¬¦ï¼Œä»…ä¸ºæŸ¥è¡¨ç”¨ã€‚è¯»è€…å¯ç•¥è¿‡ã€‚</p></blockquote><p>éç‰¹åˆ«è¯´æ˜ï¼Œä¸‹ä¾‹ä¸­å‡è®¾å˜é‡ A çš„å€¼ä¸º 10ï¼Œå˜é‡ B çš„å€¼ä¸º 20ã€‚</p><div class="tabs" id="markdown"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#markdown-1">ç®—æœ¯è¿ç®—ç¬¦</button></li><li class="tab"><button type="button" data-href="#markdown-2">å…³ç³»è¿ç®—ç¬¦</button></li><li class="tab"><button type="button" data-href="#markdown-3">é€»è¾‘è¿ç®—ç¬¦</button></li><li class="tab"><button type="button" data-href="#markdown-4">ä½è¿ç®—ç¬¦</button></li><li class="tab"><button type="button" data-href="#markdown-5">èµ‹å€¼è¿ç®—ç¬¦</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="markdown-1"><ul><li><p><strong>ç®—æœ¯è¿ç®—ç¬¦</strong></p><table><thead><tr><th style="text-align:center">è¿ç®—ç¬¦</th><th style="text-align:center">æè¿°</th><th style="text-align:center">å®ä¾‹</th></tr></thead><tbody><tr><td style="text-align:center"></td><td style="text-align:center">æŠŠä¸¤ä¸ªæ“ä½œæ•°ç›¸åŠ </td><td style="text-align:center">A + B å°†å¾—åˆ° 30</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">ä»ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸­å‡å»ç¬¬äºŒä¸ªæ“ä½œæ•°</td><td style="text-align:center">A - B å°†å¾—åˆ° -10</td></tr><tr><td style="text-align:center">*</td><td style="text-align:center">æŠŠä¸¤ä¸ªæ“ä½œæ•°ç›¸ä¹˜</td><td style="text-align:center">A * B å°†å¾—åˆ° 200</td></tr><tr><td style="text-align:center">/</td><td style="text-align:center">åˆ†å­é™¤ä»¥åˆ†æ¯</td><td style="text-align:center">B / A å°†å¾—åˆ° 2</td></tr><tr><td style="text-align:center">%</td><td style="text-align:center">å–æ¨¡è¿ç®—ç¬¦ï¼Œæ•´é™¤åçš„ä½™æ•°</td><td style="text-align:center">B % A å°†å¾—åˆ° 0</td></tr><tr><td style="text-align:center">++</td><td style="text-align:center">è‡ªå¢è¿ç®—ç¬¦ï¼Œæ•´æ•°å€¼å¢åŠ  1</td><td style="text-align:center">A++ å°†å¾—åˆ° 11</td></tr><tr><td style="text-align:center">â€“</td><td style="text-align:center">è‡ªå‡è¿ç®—ç¬¦ï¼Œæ•´æ•°å€¼å‡å°‘ 1</td><td style="text-align:center">A-- å°†å¾—åˆ° 9</td></tr></tbody></table></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-2"><ul><li><p><strong>å…³ç³»è¿ç®—ç¬¦</strong></p><table><thead><tr><th style="text-align:center">è¿ç®—ç¬¦</th><th style="text-align:center">æè¿°</th><th style="text-align:center">å®ä¾‹</th></tr></thead><tbody><tr><td style="text-align:center">==</td><td style="text-align:center">æ£€æŸ¥ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A == B) ä¸ä¸ºçœŸã€‚</td></tr><tr><td style="text-align:center">!=</td><td style="text-align:center">æ£€æŸ¥ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A != B) ä¸ºçœŸã€‚</td></tr><tr><td style="text-align:center">&gt;</td><td style="text-align:center">æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å¤§äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A &gt; B) ä¸ä¸ºçœŸã€‚</td></tr><tr><td style="text-align:center">&lt;</td><td style="text-align:center">æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å°äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A &lt; B) ä¸ºçœŸã€‚</td></tr><tr><td style="text-align:center">&gt;=</td><td style="text-align:center">æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å¤§äºæˆ–ç­‰äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A &gt;= B) ä¸ä¸ºçœŸã€‚</td></tr><tr><td style="text-align:center">&lt;=</td><td style="text-align:center">æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å°äºæˆ–ç­‰äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A &lt;= B) ä¸ºçœŸã€‚</td></tr></tbody></table></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-3"><ul><li><p><strong>é€»è¾‘è¿ç®—ç¬¦</strong></p><p>å‡è®¾å˜é‡ A çš„å€¼ä¸º 1ï¼Œå˜é‡ B çš„å€¼ä¸º 0ã€‚</p><table><thead><tr><th style="text-align:center">è¿ç®—ç¬¦</th><th style="text-align:center">æè¿°</th><th style="text-align:center">å®ä¾‹</th></tr></thead><tbody><tr><td style="text-align:center">&amp;&amp;</td><td style="text-align:center">ç§°ä¸ºé€»è¾‘ä¸è¿ç®—ç¬¦ã€‚å¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½éé›¶ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A &amp;&amp; B) ä¸ºå‡ã€‚</td></tr><tr><td style="text-align:center">||</td><td style="text-align:center">ç§°ä¸ºé€»è¾‘æˆ–è¿ç®—ç¬¦ã€‚å¦‚æœä¸¤ä¸ªæ“ä½œæ•°ä¸­æœ‰ä»»æ„ä¸€ä¸ªéé›¶ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td style="text-align:center">(A || B) ä¸ºçœŸã€‚</td></tr><tr><td style="text-align:center">!</td><td style="text-align:center">ç§°ä¸ºé€»è¾‘éè¿ç®—ç¬¦ã€‚ç”¨æ¥é€†è½¬æ“ä½œæ•°çš„é€»è¾‘çŠ¶æ€ã€‚å¦‚æœæ¡ä»¶ä¸ºçœŸåˆ™é€»è¾‘éè¿ç®—ç¬¦å°†ä½¿å…¶ä¸ºå‡ã€‚</td><td style="text-align:center">!(A &amp;&amp; B) ä¸ºçœŸã€‚</td></tr></tbody></table></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-4"><ul><li><p><strong>ä½è¿ç®—ç¬¦</strong></p><table><thead><tr><th style="text-align:center">p</th><th style="text-align:center">q</th><th style="text-align:center">p &amp; q</th><th style="text-align:center">p | q</th><th style="text-align:center">p ^ q</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td></tr></tbody></table></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-5"><ul><li><p><strong>èµ‹å€¼è¿ç®—ç¬¦</strong></p><table><thead><tr><th style="text-align:center">è¿ç®—ç¬¦</th><th style="text-align:center">æè¿°</th><th style="text-align:center">å®ä¾‹</th></tr></thead><tbody><tr><td style="text-align:center">=</td><td style="text-align:center">ç®€å•çš„èµ‹å€¼è¿ç®—ç¬¦ï¼ŒæŠŠå³è¾¹æ“ä½œæ•°çš„å€¼èµ‹ç»™å·¦è¾¹æ“ä½œæ•°</td><td style="text-align:center">C = A + B å°†æŠŠ A + B çš„å€¼èµ‹ç»™ C</td></tr><tr><td style="text-align:center">+=</td><td style="text-align:center">åŠ ä¸”èµ‹å€¼è¿ç®—ç¬¦ï¼ŒæŠŠå³è¾¹æ“ä½œæ•°åŠ ä¸Šå·¦è¾¹æ“ä½œæ•°çš„ç»“æœèµ‹å€¼ç»™å·¦è¾¹æ“ä½œæ•°</td><td style="text-align:center">C += A ç›¸å½“äº C = C + A</td></tr><tr><td style="text-align:center">-=</td><td style="text-align:center">å‡ä¸”èµ‹å€¼è¿ç®—ç¬¦ï¼ŒæŠŠå·¦è¾¹æ“ä½œæ•°å‡å»å³è¾¹æ“ä½œæ•°çš„ç»“æœèµ‹å€¼ç»™å·¦è¾¹æ“ä½œæ•°</td><td style="text-align:center">C -= A ç›¸å½“äº C = C - A</td></tr><tr><td style="text-align:center">*=</td><td style="text-align:center">ä¹˜ä¸”èµ‹å€¼è¿ç®—ç¬¦ï¼ŒæŠŠå³è¾¹æ“ä½œæ•°ä¹˜ä»¥å·¦è¾¹æ“ä½œæ•°çš„ç»“æœèµ‹å€¼ç»™å·¦è¾¹æ“ä½œæ•°</td><td style="text-align:center">C *= A ç›¸å½“äº C = C * A</td></tr><tr><td style="text-align:center">/=</td><td style="text-align:center">é™¤ä¸”èµ‹å€¼è¿ç®—ç¬¦ï¼ŒæŠŠå·¦è¾¹æ“ä½œæ•°é™¤ä»¥å³è¾¹æ“ä½œæ•°çš„ç»“æœèµ‹å€¼ç»™å·¦è¾¹æ“ä½œæ•°</td><td style="text-align:center">C /= A ç›¸å½“äº C = C / A</td></tr><tr><td style="text-align:center">%=</td><td style="text-align:center">æ±‚æ¨¡ä¸”èµ‹å€¼è¿ç®—ç¬¦ï¼Œæ±‚ä¸¤ä¸ªæ“ä½œæ•°çš„æ¨¡èµ‹å€¼ç»™å·¦è¾¹æ“ä½œæ•°</td><td style="text-align:center">C %= A ç›¸å½“äº C = C % A</td></tr><tr><td style="text-align:center">&lt;&lt;=</td><td style="text-align:center">å·¦ç§»ä¸”èµ‹å€¼è¿ç®—ç¬¦</td><td style="text-align:center">C &lt;&lt;= 2 ç­‰åŒäº  C = C &lt;&lt; 2</td></tr><tr><td style="text-align:center">&gt;&gt;=</td><td style="text-align:center">å³ç§»ä¸”èµ‹å€¼è¿ç®—ç¬¦</td><td style="text-align:center">C &gt;&gt;= 2 ç­‰åŒäº  C = C &gt;&gt; 2</td></tr><tr><td style="text-align:center">&amp;=</td><td style="text-align:center">æŒ‰ä½ä¸ä¸”èµ‹å€¼è¿ç®—ç¬¦</td><td style="text-align:center">C &amp;= 2 ç­‰åŒäº  C = C &amp; 2</td></tr><tr><td style="text-align:center">^=</td><td style="text-align:center">æŒ‰ä½å¼‚æˆ–ä¸”èµ‹å€¼è¿ç®—ç¬¦</td><td style="text-align:center">C ^= 2 ç­‰åŒäº  C = C ^ 2</td></tr><tr><td style="text-align:center">|=</td><td style="text-align:center">æŒ‰ä½æˆ–ä¸”èµ‹å€¼è¿ç®—ç¬¦</td><td style="text-align:center">C |= 2 ç­‰åŒäº  C = C | 2</td></tr></tbody></table></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="1-5-2-è¿ç®—ç¬¦ä¼˜å…ˆçº§">1.5.2 è¿ç®—ç¬¦ä¼˜å…ˆçº§</h4><p>ä¸åŒè¿ç®—ç¬¦åœ¨ç¼–è¯‘æ—¶ä¼˜å…ˆçº§æ˜¯ä¸åŒçš„ã€‚</p><ul><li>ä¾‹å¦‚ x = 7 + 3 * 2ï¼Œåœ¨è¿™é‡Œï¼Œx è¢«èµ‹å€¼ä¸º 13ï¼Œè€Œä¸æ˜¯ 20ï¼Œå› ä¸ºè¿ç®—ç¬¦ * å…·æœ‰æ¯” + æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥é¦–å…ˆè®¡ç®—ä¹˜æ³• 3*2ï¼Œç„¶åå†åŠ ä¸Š 7ã€‚</li></ul><p>åˆ—å‡ºæ‰€æœ‰ä¼˜å…ˆçº§æ¯”è¾ƒï¼Œä¾›éœ€è¦æ—¶æŸ¥è¡¨æ‰€ç”¨ã€‚è¯»è€…ä¸åº”è¿‡åˆ†å…³æ³¨ä¸‹é¢ç»†èŠ‚ã€‚</p><table><thead><tr><th style="text-align:center">ç±»åˆ«</th><th style="text-align:center">è¿ç®—ç¬¦</th><th style="text-align:center">ç»“åˆæ€§</th></tr></thead><tbody><tr><td style="text-align:center">åç¼€</td><td style="text-align:center">() [] -&gt; .  ++   - -</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">ä¸€å…ƒ</td><td style="text-align:center">+  -   !  ~  ++  - -   (type)*  &amp;  sizeof</td><td style="text-align:center">ä»å³åˆ°å·¦</td></tr><tr><td style="text-align:center">ä¹˜é™¤</td><td style="text-align:center">*  /  %</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">åŠ å‡</td><td style="text-align:center">+  -</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">ç§»ä½</td><td style="text-align:center">&lt;&lt; &gt;&gt;</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">å…³ç³»</td><td style="text-align:center">&lt; &lt;=  &gt; &gt;=</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">ç›¸ç­‰</td><td style="text-align:center">==  !=</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">ä½ä¸ AND</td><td style="text-align:center">&amp;</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">ä½å¼‚æˆ– XOR</td><td style="text-align:center">^</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">ä½æˆ– OR</td><td style="text-align:center">|</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">é€»è¾‘ä¸ AND</td><td style="text-align:center">&amp;&amp;</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">é€»è¾‘æˆ– OR</td><td style="text-align:center">||</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr><tr><td style="text-align:center">æ¡ä»¶</td><td style="text-align:center">?:</td><td style="text-align:center">ä»å³åˆ°å·¦</td></tr><tr><td style="text-align:center">èµ‹å€¼</td><td style="text-align:center">=  +=  -=  *=  /=  %=&gt;&gt;=  &lt;&lt;=  &amp;=  ^=   |=</td><td style="text-align:center">ä»å³åˆ°å·¦</td></tr><tr><td style="text-align:center">é€—å·</td><td style="text-align:center">,</td><td style="text-align:center">ä»å·¦åˆ°å³</td></tr></tbody></table><h3 id="1-6-å¾ªç¯">1.6 å¾ªç¯</h3><p>å¾ªç¯è¯­å¥å…è®¸æˆ‘ä»¬å¤šæ¬¡æ‰§è¡Œä¸€ä¸ªè¯­å¥æˆ–è¯­å¥ç»„ï¼Œä¸‹é¢æ˜¯å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­å¾ªç¯è¯­å¥çš„ä¸€èˆ¬å½¢å¼ï¼š</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1472440363761312.png" alt="img" style="zoom: 80%;" /><h4 id="1-6-1-å¿«é€Ÿå…¥é—¨">1.6.1 å¿«é€Ÿå…¥é—¨</h4><p>C++ ç¼–ç¨‹è¯­è¨€æä¾›äº†ä»¥ä¸‹å‡ ç§å¾ªç¯ç±»å‹ã€‚ç‚¹å‡»é“¾æ¥æŸ¥çœ‹æ¯ä¸ªç±»å‹çš„ç»†èŠ‚ã€‚</p><table><thead><tr><th style="text-align:center">å¾ªç¯ç±»å‹</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center"><a href="https://www.w3cschool.cn/cpp/cpp-while-loop.html">while å¾ªç¯</a></td><td style="text-align:center">å½“ç»™å®šæ¡ä»¶ä¸ºçœŸæ—¶ï¼Œé‡å¤è¯­å¥æˆ–è¯­å¥ç»„ã€‚å®ƒä¼šåœ¨æ‰§è¡Œå¾ªç¯ä¸»ä½“ä¹‹å‰æµ‹è¯•æ¡ä»¶ã€‚</td></tr><tr><td style="text-align:center"><a href="https://www.w3cschool.cn/cpp/cpp-for-loop.html">for å¾ªç¯</a></td><td style="text-align:center">å¤šæ¬¡æ‰§è¡Œä¸€ä¸ªè¯­å¥åºåˆ—ï¼Œç®€åŒ–ç®¡ç†å¾ªç¯å˜é‡çš„ä»£ç ã€‚</td></tr><tr><td style="text-align:center"><a href="https://www.w3cschool.cn/cpp/cpp-do-while-loop.html">doâ€¦while å¾ªç¯</a></td><td style="text-align:center">é™¤äº†å®ƒæ˜¯åœ¨å¾ªç¯ä¸»ä½“ç»“å°¾æµ‹è¯•æ¡ä»¶å¤–ï¼Œå…¶ä»–ä¸ while è¯­å¥ç±»ä¼¼ã€‚</td></tr><tr><td style="text-align:center"><a href="https://www.w3cschool.cn/cpp/cpp-nested-loops.html">åµŒå¥—å¾ªç¯</a></td><td style="text-align:center">å¯ä»¥åœ¨ whileã€for æˆ– doâ€¦while å¾ªç¯å†…ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå¾ªç¯ã€‚</td></tr></tbody></table><p><strong>å¾ªç¯æ§åˆ¶è¯­å¥</strong>æ›´æ”¹æ‰§è¡Œçš„æ­£å¸¸åºåˆ—ã€‚</p><table><thead><tr><th style="text-align:center">æ§åˆ¶è¯­å¥</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center"><a href="https://www.w3cschool.cn/cpp/cpp-break-statement.html">break è¯­å¥</a></td><td style="text-align:center">ç»ˆæ­¢ <strong>loop</strong> æˆ– <strong>switch</strong> è¯­å¥ï¼Œç¨‹åºæµå°†ç»§ç»­æ‰§è¡Œç´§æ¥ç€ loop æˆ– switch çš„ä¸‹ä¸€æ¡è¯­å¥ã€‚</td></tr><tr><td style="text-align:center"><a href="https://www.w3cschool.cn/cpp/cpp-continue-statement.html">continue è¯­å¥</a></td><td style="text-align:center">å¼•èµ·å¾ªç¯è·³è¿‡ä¸»ä½“çš„å‰©ä½™éƒ¨åˆ†ï¼Œç«‹å³é‡æ–°å¼€å§‹æµ‹è¯•æ¡ä»¶ã€‚</td></tr><tr><td style="text-align:center"><a href="https://www.w3cschool.cn/cpp/cpp-goto-statement.html">goto è¯­å¥</a></td><td style="text-align:center">å°†æ§åˆ¶è½¬ç§»åˆ°è¢«æ ‡è®°çš„è¯­å¥ã€‚ä½†æ˜¯ä¸å»ºè®®åœ¨ç¨‹åºä¸­ä½¿ç”¨ goto è¯­å¥ã€‚</td></tr></tbody></table><h4 id="1-6-2-å¾ªç¯åˆ¤æ–­">1.6.2 å¾ªç¯åˆ¤æ–­</h4><p>C++ ç¼–ç¨‹è¯­è¨€æä¾›äº†ä»¥ä¸‹ç±»å‹çš„åˆ¤æ–­è¯­å¥ã€‚</p><table><thead><tr><th style="text-align:center">è¯­å¥</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">if è¯­å¥</td><td style="text-align:center">ä¸€ä¸ª if è¯­å¥ ç”±ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼åè·Ÿä¸€ä¸ªæˆ–å¤šä¸ªè¯­å¥ç»„æˆã€‚</td></tr><tr><td style="text-align:center">ifâ€¦else è¯­å¥</td><td style="text-align:center">ä¸€ä¸ª if è¯­å¥ åå¯è·Ÿä¸€ä¸ªå¯é€‰çš„ else è¯­å¥ï¼Œelse è¯­å¥åœ¨å¸ƒå°”è¡¨è¾¾å¼ä¸ºå‡æ—¶æ‰§è¡Œã€‚</td></tr><tr><td style="text-align:center">åµŒå¥— if è¯­å¥</td><td style="text-align:center">æ‚¨å¯ä»¥åœ¨ä¸€ä¸ª if æˆ– else if è¯­å¥å†…ä½¿ç”¨å¦ä¸€ä¸ª if æˆ– else if è¯­å¥ã€‚</td></tr><tr><td style="text-align:center">switch è¯­å¥</td><td style="text-align:center">ä¸€ä¸ª switch è¯­å¥å…è®¸æµ‹è¯•ä¸€ä¸ªå˜é‡ç­‰äºå¤šä¸ªå€¼æ—¶çš„æƒ…å†µã€‚</td></tr><tr><td style="text-align:center">åµŒå¥— switch è¯­å¥</td><td style="text-align:center">æ‚¨å¯ä»¥åœ¨ä¸€ä¸ª switch è¯­å¥å†…ä½¿ç”¨å¦ä¸€ä¸ª switch  è¯­å¥ã€‚</td></tr></tbody></table><h4 id="1-6-3-è¿ç®—ç¬¦">1.6.3 ?: è¿ç®—ç¬¦</h4><p>æ¡ä»¶è¿ç®—ç¬¦åœ¨å®é™…ç¼–ç ä¸­ï¼Œç”¨æ¥æ›¿ä»£ <strong>ifâ€¦else</strong> è¯­å¥ã€‚å› ä¸ºå¾ˆå¤šæ—¶å€™å¯ä»¥ç®€åŒ–ä»£ç ï¼Œç”¨çš„æ¯”è¾ƒå¤šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exp1 ? Exp2 : Exp3;</span><br></pre></td></tr></table></figure><h4 id="1-6-4-æ— é™å¾ªç¯">1.6.4 æ— é™å¾ªç¯</h4><p>å¦‚æœæ¡ä»¶<strong>æ°¸è¿œä¸ä¸ºå‡æˆ–ä¸å­˜åœ¨æ—¶</strong>ï¼Œåˆ™å¾ªç¯å°†å˜æˆæ— é™å¾ªç¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>( ; ; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This loop will run forever.\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ Ctrl + C é”®å¯ä»¥ç»ˆæ­¢ä¸€ä¸ªæ— é™å¾ªç¯ã€‚</p><h3 id="1-7-æ•°ç»„">1.7 æ•°ç»„</h3><p><strong>å­˜å‚¨ä¸€ä¸ªç”±ç›¸åŒç±»å‹å…ƒç´ æ„æˆçš„é¡ºåºé›†åˆï¼Œç§°ä¹‹ä¸ºæ•°ç»„</strong>ã€‚</p><h4 id="1-7-1-é™æ€æ•°ç»„">1.7.1 é™æ€æ•°ç»„</h4><p>é™æ€æ•°ç»„<strong>å£°æ˜ä¸”æœªåˆå§‹åŒ–æ—¶å¿…é¡»ç¡®å®šæ•°ç»„å¤§å°</strong>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><ul><li>åˆå§‹åŒ–ï¼šå¯ä»¥ä½¿ç”¨åˆ—è¡¨<code>&#123;...&#125;</code> å¿«é€Ÿèµ‹å€¼ï¼Œä¸å¯ä½¿ç”¨<code>new int[]&#123;...&#125;</code>èµ‹å€¼ï¼ˆè¿™æ˜¯æŒ‡é’ˆåˆ†é…ç©ºé—´çš„æ–¹å¼ï¼‰</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEN 3</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// é™æ€æ•°ç»„</span></span><br><span class="line">    <span class="comment">// ä¸€ç»´</span></span><br><span class="line">    <span class="comment">// ã€å£°æ˜ã€‘</span></span><br><span class="line">    <span class="keyword">int</span> array1[LEN] ;  <span class="comment">// æœªåˆå§‹åŒ–ï¼ŒæŒ‡å®šå¤§å°=3</span></span><br><span class="line">    <span class="comment">// ã€èµ‹å€¼ã€‘</span></span><br><span class="line">    <span class="keyword">int</span> array2[]  = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;  <span class="comment">// å·²åˆå§‹åŒ–ï¼Œç¼–è¯‘å™¨å¯æ¨æ–­å¤§å°=3</span></span><br><span class="line">    <span class="comment">// int array2[]  = new int[]&#123;1,2,3&#125;; // å‡ºé”™ï¼Œè¿™æ˜¯åŠ¨æ€æ•°ç»„èµ‹å€¼çš„æ–¹å¼</span></span><br><span class="line">    <span class="keyword">int</span> array3[LEN]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;   <span class="comment">// C++11æ”¯æŒä¸ç”¨=å·è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// äºŒç»´</span></span><br><span class="line">    <span class="comment">// ã€å£°æ˜ã€‘</span></span><br><span class="line">    <span class="keyword">int</span> array4[LEN][LEN];</span><br><span class="line">    <span class="comment">// ã€èµ‹å€¼ã€‘</span></span><br><span class="line">    array4[LEN][LEN] = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,</span><br><span class="line">                        &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;,</span><br><span class="line">                        &#123;<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;&#125;; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-7-2-åŠ¨æ€æ•°ç»„">1.7.2 åŠ¨æ€æ•°ç»„</h4><p>å£°æ˜é™æ€æ•°ç»„å¾ˆç®€å•ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ›´å¸Œæœ›ç”³è¯·ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼ˆæ¯”å¦‚å£°æ˜æ—¶å¹¶ä¸ç¡®å®šæ•°ç»„çš„å†…å®¹ï¼‰ã€‚</p><p>åŠ¨æ€æ•°ç»„å¯ä»¥<strong>å£°æ˜æ—¶ä¸æŒ‡å®šå¤§å°</strong> ï¼Œä½†æ˜¯ä½¿ç”¨å‰ä¸€å®šè¦<strong>åˆ†é…ç©ºé—´ï¼ˆå¯ä¸åˆå§‹åŒ–ï¼Œä¼šé»˜è®¤åˆå§‹åŒ–ï¼‰</strong>ã€‚</p><ul><li><p>åˆå§‹åŒ–ï¼šå¯ä½¿ç”¨<code>new int[]&#123;...&#125;</code>èµ‹å€¼ï¼Œä¸å¯ä»¥ä½¿ç”¨åˆ—è¡¨<code>&#123;...&#125;</code> å¿«é€Ÿèµ‹å€¼</p></li><li><p>åˆ é™¤ï¼šæ³¨æ„æ˜¯ä½¿ç”¨<code>delete[]</code> ï¼Œä¸æ˜¯<code>delete</code></p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1.ä¸€ç»´ </span></span><br><span class="line">    <span class="comment">// ã€å£°æ˜ã€‘</span></span><br><span class="line">    <span class="keyword">int</span>* array1;       <span class="comment">// åŠ¨æ€æ•°ç»„å¯ä¸å£°æ˜å¤§å°</span></span><br><span class="line">    <span class="comment">// array1[1] = 2;  // ç¼–è¯‘å‡ºé”™ï¼Œåˆ†é…ç©ºé—´å‰å°±ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">int</span>* array2 = <span class="keyword">new</span> <span class="keyword">int</span>[LEN];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ã€èµ‹å€¼ã€‘</span></span><br><span class="line">    <span class="comment">// C++11æ”¯æŒå¿«é€Ÿä¸ºåŠ¨æ€æ•°ç»„èµ‹å€¼</span></span><br><span class="line">    <span class="comment">// è€Œä¸æ˜¯Cé£æ ¼é‚£æ ·å‚»ä¹ä¹forå¾ªç¯æŒ¨ä¸ªèµ‹å€¼</span></span><br><span class="line">    <span class="keyword">int</span>* array3 = <span class="keyword">new</span> <span class="keyword">int</span>[LEN]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    <span class="comment">// ä½†ä¸‹åˆ—è¿™ç§é™æ€æ•°ç»„èµ‹å€¼æ–¹å¼æ˜¯é”™è¯¯çš„</span></span><br><span class="line">    <span class="comment">// int* array3 = &#123;1,2,3&#125;; //  ç¼–è¯‘å‡ºé”™ï¼Œrequires one element in initialize</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ã€é‡Šæ”¾ã€‘</span></span><br><span class="line">    <span class="keyword">delete</span>[] array3;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.äºŒç»´</span></span><br><span class="line">    <span class="comment">// ã€å£°æ˜ã€‘</span></span><br><span class="line">    <span class="keyword">int</span>** array4;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ã€èµ‹å€¼ã€‘</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    // ä¸èƒ½ç”¨ä¸‹é¢åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="comment">    int** array5 = new int[LEN] &#123;&#123;1,2,3&#125;,</span></span><br><span class="line"><span class="comment">                                &#123;4,5,6&#125;,</span></span><br><span class="line"><span class="comment">                                 &#123;7,8,9&#125;&#125;; ; </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span>** array5 = <span class="keyword">new</span> <span class="keyword">int</span>*[LEN] &#123;  <span class="keyword">new</span> <span class="keyword">int</span>[LEN]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="keyword">int</span>[LEN]&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="keyword">int</span>[LEN]&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆ–è€…</span></span><br><span class="line">    <span class="keyword">int</span>** array5 = <span class="keyword">new</span> <span class="keyword">int</span>*[LEN];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LEN; i++)</span><br><span class="line">        array5[i] = <span class="keyword">new</span> <span class="keyword">int</span>[LEN]&#123;(i+<span class="number">1</span>)*<span class="number">1</span>,(i+<span class="number">2</span>)*<span class="number">1</span>,(i+<span class="number">3</span>)*<span class="number">1</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ã€é‡Šæ”¾ã€‘</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LEN; i++)</span><br><span class="line">         <span class="keyword">delete</span>[] array5[i];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-7-3-æ•°ç»„é»˜è®¤åˆå§‹åŒ–">1.7.3 æ•°ç»„é»˜è®¤åˆå§‹åŒ–</h4><blockquote><p>åœ¨å‰é¢ï¼Œæˆ‘ä»¬äº†è§£åˆ°äº†å±€éƒ¨å˜é‡/å…¨å±€å˜é‡/é™æ€å˜é‡/ç±»æˆå‘˜çš„é»˜è®¤åˆå§‹åŒ–å€¼ã€‚æ•°ç»„çš„é»˜è®¤åˆå§‹åŒ–å€¼ä¼šä»€ä¹ˆå‘¢ï¼Ÿ</p></blockquote><p>ç»è¿‡å®éªŒï¼Œæ•°ç»„é»˜è®¤åˆå§‹åŒ–è§„åˆ™ï¼Œ<u>åŸºæœ¬ç­‰åŒå±€éƒ¨å˜é‡/å…¨å±€å˜é‡/é™æ€å˜é‡/ç±»æˆå‘˜çš„è§„åˆ™</u>ã€‚<strong>åªä¸è¿‡æ•°ç»„æ˜¯ä»¥é›†åˆå½¢å¼å‡ºç°çš„</strong>ã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">int/float/double</th><th style="text-align:center">bool</th><th style="text-align:center">string/char</th><th style="text-align:center">æŒ‡é’ˆ</th><th style="text-align:center">å¼•ç”¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>å±€éƒ¨å˜é‡</strong></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">0</td><td style="text-align:center"><code>&quot;&quot;</code>ï¼Œ<code>''</code></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">å‡ºé”™</td></tr><tr><td style="text-align:center"><strong>å…¨å±€å˜é‡/é™æ€å˜é‡</strong></td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center"><code>&quot;&quot;</code>ï¼Œ<code>''</code></td><td style="text-align:center">0</td><td style="text-align:center">å‡ºé”™</td></tr><tr><td style="text-align:center"><strong>ç±»æˆå‘˜</strong></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">é‡å€¼</td><td style="text-align:center"><code>&quot;&quot;</code>ï¼Œé‡å€¼</td><td style="text-align:center"><code>&quot;&quot;</code>/é‡å€¼</td><td style="text-align:center">å‡ºé”™</td></tr><tr><td style="text-align:center"><strong>å±€éƒ¨æ•°ç»„ï¼ˆå…¶å®ƒåŒï¼‰</strong></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">é‡å€¼</td><td style="text-align:center"><code>&quot;&quot;</code>ï¼Œ<code>''</code></td><td style="text-align:center">é‡å€¼</td><td style="text-align:center">å‡ºé”™</td></tr></tbody></table><p>ä½†æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»™ï¼ˆå±€éƒ¨ï¼‰æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼ˆæ¯”å¦‚0å€¼ï¼‰ã€‚å¦‚æœæ•°ç»„å¾ˆé•¿ï¼Œä½ è‚¯å®šä¸å¸Œæœ›é€ä¸ªè¿›è¡Œåˆå§‹åŒ–åŒ–ï¼Œè™½ç„¶å¯ä»¥ç”¨å¾ªç¯ä½†çœ‹èµ·æ¥ä¹Ÿä¸é‚£ä¹ˆèªæ˜çš„æ ·å­ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹åˆå§‹åŒ–æ•°ç»„çš„æŠ€å·§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEN 3</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¿«é€Ÿ0å€¼åˆå§‹åŒ–ï¼Œå…¶å®ƒç±»å‹åŒç†ï¼Œå¦‚flaot/double/bool</span></span><br><span class="line">    <span class="comment">// 1.é™æ€æ•°ç»„ï¼š&#123;0&#125;</span></span><br><span class="line">    <span class="keyword">int</span> array1[LEN] = &#123;<span class="number">0</span>&#125;;  <span class="comment">// 0,0,0</span></span><br><span class="line">    <span class="keyword">int</span> array2[LEN] = &#123;<span class="number">1</span>&#125;;  <span class="comment">// 1,0,0ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ•°å­—ä¸æ˜¯0ï¼Œåˆ™åªæœ‰å…¶å®ƒæ˜¯0</span></span><br><span class="line">    <span class="comment">// 2.åŠ¨æ€æ•°ç»„</span></span><br><span class="line">    <span class="keyword">int</span>* array3 = <span class="keyword">new</span> <span class="keyword">int</span>[LEN]();  <span class="comment">// 0,0,0,è®°å¾—æŒ‡å®šé•¿åº¦</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.æ›´é€šç”¨çš„åšæ³•: std::fill()</span></span><br><span class="line">    <span class="comment">// åˆ†åˆ«æŒ‡å®šï¼šæ•°ç»„èµ·å§‹åœ°å€ï¼Œåœ°å€ç»ˆåœ°å€ï¼Œè¦å¡«å……çš„å€¼</span></span><br><span class="line">    <span class="built_in">fill</span>(array1,array1+LEN,<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-7-4-æ•°ç»„ä¸æ˜¯æŒ‡é’ˆ">1.7.4 æ•°ç»„ä¸æ˜¯æŒ‡é’ˆ</h4><p><u>åœ¨å‰é¢æ•°ç»„å’ŒåŠ¨æ€æ•°ç»„ï¼ˆæŒ‡é’ˆæ–¹å¼ï¼‰ä¸åŒåˆå§‹åŒ–æ–¹å¼ï¼ˆæŒ‡é’ˆéœ€è¦newåˆ†é…</u>ï¼‰ï¼Œä½ ä¹Ÿåº”è¯¥éšéšçº¦çº¦æ„Ÿå—åˆ°æŒ‡é’ˆå’Œæ•°ç»„æ˜¯ä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚è™½ç„¶å¾ˆå¤šæ—¶å€™æ•°ç»„ä¼šé€€åŒ–ä¸ºæŒ‡é’ˆä½¿ç”¨ï¼Œä½†å°†æ•°ç»„è§†ä¸ºæŒ‡é’ˆè¿™æ˜¯ä¸å¯¹çš„ã€‚</p><p><strong>æ¯”å¦‚ï¼Œé™æ€æ•°ç»„ä¸€æ—¦åˆå§‹åŒ–æ˜¯ä¸èƒ½é‡æ–°èµ‹å€¼çš„ï¼Œä½†æ˜¯åŠ¨æ€æ•°ç»„å¯ä»¥</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr1[<span class="number">3</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> arr3[<span class="number">3</span>] = &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">arr1 = arr3; <span class="comment">// error</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>* arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;; </span><br><span class="line">arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œ<strong>æ•°ç»„å’ŒæŒ‡é’ˆç©¶ç«Ÿæœ‰å“ªäº›ä¸åŒï¼Ÿå®ƒä»€ä¹ˆæ—¶å€™é€€åŒ–ä¸ºæŒ‡é’ˆï¼Ÿæ€ä¹ˆå»æ›´æ·±å±‚æ¬¡çš„ç†è§£</strong>ï¼Ÿ</p><p>è¿™äº›ä¸œè¥¿ä¸é€‚åˆæ”¾åœ¨è¿™é‡Œè¯¦ç»†è®²è§£ï¼Œå› ä¸ºä½ è¿˜ä¸å…·å¤‡å¾ˆå¤šç›¸å…³çŸ¥è¯†ã€‚è¯·å‚è€ƒï¼š<u>2.1.3#æŒ‡é’ˆå’Œæ•°ç»„</u>ã€‚</p><h4 id="1-7-5-æ•°ç»„å°ç»“ğŸŒŸ">1.7.5 æ•°ç»„å°ç»“ğŸŒŸ</h4><p>ä¸‹é¢æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æ•°ç»„å¸¸ç”¨å£°æ˜ã€åˆå§‹åŒ–æ–¹å¼ã€‚</p><p>ã€æ³¨1ã€‘ä»…ä»¥ä¸€ç»´æ•°ç»„ä¸ºä¾‹ã€‚</p><p>ã€æ³¨2ã€‘åŠ¨æ€æ•°ç»„è®°å¾—ä½¿ç”¨<code>delete[]</code>é‡Šæ”¾ç©ºé—´ã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">å£°æ˜</th><th style="text-align:center">æ˜¾ç¤ºåˆå§‹åŒ–</th><th style="text-align:center">å¿«é€Ÿåˆå§‹åŒ–</th></tr></thead><tbody><tr><td style="text-align:center">é™æ€æ•°ç»„</td><td style="text-align:center">int arr[LEN];</td><td style="text-align:center"><strong>int arr[LEN]={â€¦}</strong>;<br>int arr[]={â€¦};<br>int arr[]{â€¦};</td><td style="text-align:center">int arr[LEN]={0};<br>fill(arr,arr+LEN,0);</td></tr><tr><td style="text-align:center">åŠ¨æ€æ•°ç»„</td><td style="text-align:center">int* arr;<br>int* arr = new int[LEN];</td><td style="text-align:center"><em><em>int</em> arr = new int[LEN]{â€¦}</em>*</td><td style="text-align:center">int* arr = new int[LEN]();<br>fill(arr,arr+LEN,0);</td></tr></tbody></table><h3 id="1-8-å­—ç¬¦ä¸²">1.8 å­—ç¬¦ä¸²</h3><h4 id="1-8-1-Cé£æ ¼å­—ç¬¦ä¸²">1.8.1 Cé£æ ¼å­—ç¬¦ä¸²</h4><p>åœ¨Cä¸­æˆ‘ä»¬ä½¿ç”¨å­—ç¬¦ä¸²å…¶å®æ˜¯å­—ç¬¦æ•°ç»„ã€‚</p><table><thead><tr><th>ç”¨å­—ç¬¦æ•°ç»„å­˜æ”¾</th><th>ç”¨å­—ç¬¦æŒ‡é’ˆç®¡ç†ä¸²</th></tr></thead><tbody><tr><td>char str1[ ]=â€œroyhuangâ€;</td><td>char *str2=â€œhwhâ€;</td></tr></tbody></table><ul><li><p><strong>charå­—ç¬¦æ•°ç»„</strong></p><p>å®šä¹‰ä¸€ä¸ªC é£æ ¼çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> my_name[] = <span class="string">&quot;royhuang&quot;</span> ;</span><br></pre></td></tr></table></figure><p>çŒœçŒœ<code>my_name</code>çš„é•¿åº¦ï¼Ÿ8ï¼Ÿä¸ï¼Œæ˜¯9ã€‚å› ä¸ºCé£æ ¼çš„å­—ç¬¦ä¸²è¿˜ä¼šè‡ªåŠ¨åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªç»ˆæ­¢ç¬¦ï¼Œå³ï¼š<code>royhuang\0</code> ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sizeof</span>(my_name)/<span class="keyword">sizeof</span>(my_name[<span class="number">0</span>]); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure><p><code>strlen</code> å¯ä»¥å¿½ç•¥ç©ºå­—ç¬¦ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">strlen</span>(my_name); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><p><strong>Cé£æ ¼å­—ç¬¦æ•°ç»„ï¼Œæ— æ³•äºŒæ¬¡èµ‹å€¼ï¼ˆæ•°ç»„æœ¬èº«æ˜¯å¸¸é‡æŒ‡é’ˆï¼Œ2.1.3èŠ‚ï¼‰ï¼Œä½†æ•°ç»„æœ¬èº«å¯ä»¥è¢«ä¿®æ”¹</strong>ã€‚</p><p>æ•°ç»„ç‰¹æ€§ä¸èƒ½äºŒæ¬¡èµ‹å€¼ï¼Œchar[]ä¸ä¾‹å¤–ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_name = <span class="string">&quot;hwh&quot;</span>;  <span class="comment">// errorï¼Œæ— æ³•è¢«ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>æ•°ç»„æœ¬èº«å¯ä»¥è¢«ä¿®æ”¹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_name[<span class="number">0</span>]=<span class="string">&#x27;z&#x27;</span></span><br><span class="line">cout&lt;&lt;my_name;  <span class="comment">// zoyhuang</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æŒ‡é’ˆæ•°ç»„</strong></p><p>å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* my_name = <span class="string">&quot;royhuang&quot;</span> ;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å¯¹æŒ‡é’ˆæœ‰æ‰€äº†è§£ï¼Œä¸€å®šä¼šçº³é—·ï¼š<strong>æŒ‡é’ˆéƒ½æ²¡ç»™å®ƒåˆ†é…æŒ‡å‘çš„ç©ºé—´ï¼Œæ€ä¹ˆå°±å¯ä»¥å­˜å…¥charæ•°ç»„</strong>ï¼Ÿ</p><p>ä¸‹é¢æ‰ç¬¦åˆæˆ‘ä»¬ä¹‹å‰å¯¹åŠ¨æ€æ•°ç»„çš„è®¤çŸ¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cé£æ ¼åŠ¨æ€æ•°ç»„</span></span><br><span class="line"><span class="comment">// mallocåˆ†é…ç©ºé—´</span></span><br><span class="line"><span class="keyword">char</span>* my_name = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">10</span>*<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">char</span>));</span><br><span class="line"><span class="comment">// forèµ‹å€¼</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ; i&lt;<span class="number">10</span> ; i++) <span class="comment">// forå¾ªç¯èµ‹å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">    my_name[i]=<span class="string">&#x27;&#x27;; </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">// C++é£æ ¼</span></span><br><span class="line"><span class="string">// newåˆ†é…ç©ºé—´ï¼Œè¿˜å¯ä»¥åŒæ—¶åˆå§‹åŒ–</span></span><br><span class="line"><span class="string">char* my_name = new char[10]&#123;&quot;royhuang&quot;&#125;;</span></span><br><span class="line"><span class="string">*/</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€åˆ‡éƒ½è¦æ„Ÿè°¢ç¼–è¯‘å™¨çš„â€œå¹•åå·¥ä½œâ€ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* my_name = <span class="string">&quot;royhuang&quot;</span> ;  <span class="comment">// å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</span></span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºï¼š</p><ol><li><p>ç¼–è¯‘å™¨é¦–å…ˆåœ¨å¸¸é‡åŒºåˆ†é…ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼ˆå¯ä»¥çœ‹åšæ˜¯åŒ¿åæ•°ç»„ï¼‰ï¼Œè¿™é‡Œå‡è®¾ä¸º<code>tmp_my_name</code> ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* tmp_my_name[] = <span class="string">&quot;royhuang\0&quot;</span>;</span><br></pre></td></tr></table></figure><p>é¢˜å¤–è¯ï¼Œæ­£å› ä¸º&quot;royhuang\0&quot;ä¿å­˜åœ¨å¸¸é‡åŒºï¼ˆåªè¯»ï¼‰ï¼Œæ‰€ä»¥<u>ä¸Šè¿°æ–¹å¼åˆ†é…çš„åŠ¨æ€æ•°ç»„æ— æ³•ä¿®æ”¹</u>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_name[<span class="number">0</span>] = <span class="string">&#x27;z&#x27;</span>; <span class="comment">// é”™è¯¯ï¼Œå°è¯•ä¿®æ”¹å¸¸é‡åŒºçš„å€¼</span></span><br></pre></td></tr></table></figure></li><li><p>ç„¶åå°†<code>tmp_my_name</code> æ‹·è´ç»™<code>my_name</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_name å¹¶æ²¡æœ‰åˆ†é…ç©ºé—´</span></span><br><span class="line"><span class="comment">// åªæ˜¯ä¿å­˜äº†æ•°ç»„ï¼ˆé¦–å…ƒç´ ï¼‰åœ°å€</span></span><br><span class="line">my_name = tmp_my_name;</span><br></pre></td></tr></table></figure><p>é¢˜å¤–è¯ï¼Œæ­£å› ä¸º<code>my_name</code> åªæ˜¯ä¿å­˜äº†æ•°ç»„åœ°å€ï¼ˆæœ¬è´¨æ˜¯æŒ‡é’ˆï¼Œè€Œä¸æ˜¯æ•°ç»„ï¼‰ï¼Œ<u>æ‰€ä»¥åŠ¨æ€æ•°ç»„å¯ä»¥é‡æ–°æ”¹å˜æŒ‡å‘</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_name = <span class="string">&quot;hwh&quot;</span>; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p><strong>å¸¸ç”¨æ–¹æ³•</strong></p><p>C++æä¾›äº†<code>cstring.h</code> ä¾›æˆ‘ä»¬æ“ä½œCå­—ç¬¦ä¸²ï¼ˆä¸é€‚ç”¨<code>std::string</code>ï¼ï¼‰ï¼Œè¿™é‡Œç»™å‡ºä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> source[]=<span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> dest[<span class="number">5</span>];</span><br></pre></td></tr></table></figure><ul><li><p><strong>å¤åˆ¶å­—ç¬¦ä¸²</strong></p><p>ä¸‹é¢è¿™ç§æ–¹å¼å®¹æ˜“é€ æˆæº¢å‡ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">strcpy</span>(dest, source); <span class="comment">// æº¢å‡º &gt; 5</span></span><br></pre></td></tr></table></figure><p>cä¸­å»ºè®®ä½¿ç”¨<code>strncpy</code>ï¼ŒC++11åˆ™é¦–é€‰<code>strcpy_s</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¡®ä¿ç¼–è¯‘å™¨æ”¯æŒæ­¤å‡½æ•°ï¼Œéœ€è¦å…ˆdefine</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __STDC_WANT_LIB_EXT1__ 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// linuxä¸‹strcpy_sæ— æ³•ä½¿ç”¨ï¼Œä½¿ç”¨strncpy</span></span><br><span class="line"><span class="comment">// strncpy(dest, source, 5);</span></span><br><span class="line"><span class="built_in">strcpy_s</span>(dest, <span class="number">5</span>, source); </span><br><span class="line">cout&lt;&lt;dest&lt;&lt;endl;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">royhu</span><br></pre></td></tr></table></figure></li><li><p><strong>é•¿åº¦å’Œå®¹é‡</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> name[<span class="number">10</span>] = <span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line"><span class="built_in">strlen</span>(name) ; <span class="comment">// 7ï¼Œä¸åŒ…å«ç»ˆæ­¢ç¬¦</span></span><br><span class="line"><span class="built_in">size</span>(name);    <span class="comment">// 10</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å…¶å®ƒæœ‰ç”¨çš„æ–¹æ³•</strong></p><ul><li><strong>strcmp</strong>() ï¼šæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ˆå¦‚æœç›¸ç­‰åˆ™è¿”å› 0 ï¼‰ï¼›</li><li><strong>strncmp</strong>() ï¼š æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²åˆ°ç‰¹å®šæ•°é‡çš„å­—ç¬¦ï¼ˆå¦‚æœç›¸ç­‰åˆ™è¿”å› 0ï¼‰ï¼›</li><li><strong>strcat</strong>() ï¼š å°†ä¸€ä¸ªå­—ç¬¦ä¸²é™„åŠ åˆ°å¦ä¸€ä¸ªï¼ˆå±é™©ï¼‰ï¼›</li><li><strong>strncat</strong>() ï¼šå°†ä¸€ä¸ªå­—ç¬¦ä¸²é™„åŠ åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå¸¦ç¼“å†²åŒºé•¿åº¦æ£€æŸ¥ï¼‰ã€‚</li></ul></li></ul></li><li><p><strong>æœ€ä½³å®è·µ</strong></p><p>Cé£æ ¼çš„å­—ç¬¦ä¸²é€šå¸¸ä½¿ç”¨éº»çƒ¦ï¼šåˆå¹¶å­—ç¬¦ä¸²ä¸æ–¹ä¾¿ã€<code>char*</code>éœ€ç®¡ç†å†…å­˜åˆ†é…ã€ä¸è‡ªåŠ¨å¢é•¿éœ€è€ƒè™‘è¶Šç•Œçš„é—®é¢˜ç­‰ã€‚</p><p>å› æ­¤åœ¨C++ä¸­æœ€ä½³å­—ç¬¦ä¸²å®è·µï¼š</p><ol><li>ä¸å»ºè®®ä½¿ç”¨Cé£æ ¼çš„å­—ç¬¦ä¸²ï¼Œè¯·å°½é‡ä½¿ç”¨<code>std::string</code>ï¼›</li><li>å¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨æœ‰å›ºå®šç¼“å†²åŒºå¤§å°çš„ C æ ·å¼å­—ç¬¦ä¸²ã€‚</li></ol><p>è®¤è¯†ä¸‹<code>std::string</code> ç©¶ç«Ÿæœ‰ä½•èˆ¬é­”åŠ›å§ã€‚</p></li></ul><h4 id="1-8-2-stringåˆè¯†">1.8.2 stringåˆè¯†</h4><h5 id="std-string-æ˜¯ä»€ä¹ˆï¼Ÿ"><code>std::string</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>C++ æ”¯æŒä¸¤ç§ä¸åŒç±»å‹çš„å­—ç¬¦ä¸²ï¼š<code>std::string</code>ï¼ˆä½œä¸ºæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼‰å’Œ C é£æ ¼çš„å­—ç¬¦ä¸²ï¼ˆä» C è¯­è¨€ç»§æ‰¿è€Œæ¥ï¼‰ã€‚</p><p><code>std::string</code> æ˜¯ä½¿ç”¨ C é£æ ¼çš„å­—ç¬¦ä¸²å®ç°çš„ï¼Œå‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/157169295">C++ string æºç å®ç°å¯¹æ¯”</a> ã€‚</p><p>å¯ä»¥çœ‹åˆ° string å…¶å®å°±æ˜¯ <code>basic_string&lt;char&gt;</code>ï¼Œé€šè¿‡ <code>basic_string</code> å¯ä»¥æ„é€ å‡ºä¸åŒå­—ç¬¦ç±»å‹çš„å­—ç¬¦ä¸²ç±»å‹ã€‚æ¯”å¦‚ <code>wstring</code> å°±æ˜¯ <code>basic_string&lt;wchar_t&gt;</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> basic_string&lt;<span class="keyword">char</span>&gt;    string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> basic_string&lt;<span class="keyword">char</span>, char_traits&lt;<span class="keyword">char</span>&gt;, allocator&lt;<span class="keyword">char</span>&gt; &gt; string; </span><br><span class="line"><span class="keyword">typedef</span> basic_string&lt;<span class="keyword">wchar_t</span>, char_traits&lt;<span class="keyword">wchar_t</span>&gt; allocator&lt;<span class="keyword">wchar_t</span>&gt; &gt; wstring; </span><br></pre></td></tr></table></figure><p><strong>ä¹Ÿå°±æ˜¯è¯´<code>std::string</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯æ•°ç»„</strong>ã€‚</p><p>åœ¨c++ä¸­å¯ä»¥é€šè¿‡ <code>#include &lt;string&gt;</code> å¼•å…¥å­—ç¬¦ä¸²<code>std::string</code> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// string my_name &#123;&#125;; // ç©ºä¸²</span></span><br><span class="line">    string my_name = <span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line">    cout&lt;&lt;my_name&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227223041128.png" alt="image-20211227223041128"></p><h5 id="std-string-å¥½åœ¨å“ªé‡Œï¼Ÿ"><code>std::string</code> å¥½åœ¨å“ªé‡Œï¼Ÿ</h5><p>å›å¿†æˆ‘ä»¬æåˆ°çš„Cé£æ ¼å­—ç¬¦ä¸²ç¼ºç‚¹ï¼š</p><blockquote><p>Cé£æ ¼çš„å­—ç¬¦ä¸²é€šå¸¸ä½¿ç”¨éº»çƒ¦ï¼šåˆå¹¶å­—ç¬¦ä¸²ä¸æ–¹ä¾¿ã€<code>char*</code>éœ€ç®¡ç†å†…å­˜åˆ†é…ã€ä¸è‡ªåŠ¨å¢é•¿éœ€è€ƒè™‘è¶Šç•Œçš„é—®é¢˜ç­‰ã€‚</p></blockquote><p><code>std::string</code> åˆ™ä¸å­˜åœ¨è¿™äº›é—®é¢˜ï¼š</p><ol><li><p><strong>åˆå¹¶å­—ç¬¦ä¸²æ–¹ä¾¿</strong>ï¼šstringå†…ç½®<code>append</code>æ–¹æ³•å’Œé‡è½½äº†<code>+</code>æ“ä½œç¬¦ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string s1 = <span class="string">&quot;royhuang&quot;</span>;</span><br><span class="line">s1.<span class="built_in">append</span>(<span class="string">&quot;cqu&quot;</span>); <span class="comment">//  royhuangcqu</span></span><br><span class="line">s1 = s1+<span class="string">&quot;1996&quot;</span>;   <span class="comment">//  royhuangcqu1996</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ— éœ€ç®¡ç†å†…å­˜</strong> ã€‚ä½¿ç”¨<code>char*</code> éœ€è¦æ˜¾ç¤ºä½¿ç”¨<code>delete[]</code> åˆ é™¤å†…å­˜ï¼Œstringä¼šè‡ªåŠ¨ç®¡ç†ã€‚</p></li><li><p><strong>è‡ªåŠ¨åŠ¨æ€å¢é•¿</strong>ã€‚åŒä¸Šï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s1.<span class="built_in">append</span>(<span class="string">&quot;cqu&quot;</span>);  <span class="comment">// å­—ç¬¦ä¸²é•¿åº¦è‡ªåŠ¨å¢é•¿</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="1-8-3-stringè½¬æ¢ä¸ºCé£æ ¼">1.8.3 stringè½¬æ¢ä¸ºCé£æ ¼</h4><p>å®é™…ç¼–ç ä¸­ï¼Œæ€»æœ‰æˆ–å¤šæˆ–å°‘çš„åŸå› ï¼Œæˆ‘ä»¬è¦å°†stringè½¬æ¢ä¸ºCé£æ ¼å­—ç¬¦ä¸²ï¼ˆCé£æ ¼å­—ç¬¦ä¸²å¦‚ä½•è½¬æ¢ä¸ºstringåœ¨<u>ä¸‹ä¸€èŠ‚ï¼šstringå¸¸ç”¨æ–¹æ³•</u>ä»‹ç»ï¼‰ã€‚</p><p>äº†è§£ä¸€ä¸‹å§ã€‚</p><ol><li><p><code>c_str()</code> æ–¹æ³•</p><p>åŸå‹ï¼š<code>const char* string::c_str () const</code> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string sSource&#123; <span class="string">&quot;abcdefg&quot;</span> &#125;;</span><br><span class="line">sSource.<span class="built_in">c_str</span>();</span><br></pre></td></tr></table></figure></li><li><p><code>data()</code> æ–¹æ³•</p><p>åŸå‹ï¼š<code>const char* string::data () const</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string sSource&#123; <span class="string">&quot;abcdefg&quot;</span> &#125;;</span><br><span class="line">sSource.<span class="built_in">data</span>();</span><br></pre></td></tr></table></figure></li><li><p><code>copy()</code> æ–¹æ³•</p><p>åŸå‹ï¼š<code>size_type string::copy(char *szBuf, size_type nLength, size_type nIndex = 0) const</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string sSource&#123; <span class="string">&quot;sphinx of black quartz, judge my vow&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">char</span> szBuf[<span class="number">20</span>];</span><br><span class="line">sSource.<span class="built_in">copy</span>(szBuf, <span class="number">5</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">black</span><br></pre></td></tr></table></figure></li></ol><p>ç»§ç»­çœ‹çœ‹stringæ›´å¤šçš„ç”¨æ³•å§ã€‚</p><h4 id="1-8-4-stringå¸¸ç”¨æ–¹æ³•">1.8.4 stringå¸¸ç”¨æ–¹æ³•</h4><p>å­—ç¬¦ä¸²æ˜¯ç¼–ç¨‹ä¸­ç»å¸¸è¦å¤„ç†çš„ï¼Œè¿™é‡Œåˆ—å‡ºå¸¸ç”¨çš„æ–¹æ³•ä¾›ç†Ÿæ‚‰å’ŒæŸ¥é˜…ã€‚</p><p>ä¸ºäº†å°½é‡ç®€æ´ï¼Œä¸‹é¢ä»…ç»™å‡ºå…³é”®æ€§ä»£ç ã€‚</p><div class="tabs" id="markdown"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#markdown-1">æ„é€ åˆå§‹åŒ–</button></li><li class="tab"><button type="button" data-href="#markdown-2">è®¿é—®</button></li><li class="tab"><button type="button" data-href="#markdown-3">å®¹é‡å¤§å°</button></li><li class="tab"><button type="button" data-href="#markdown-4">åŸºæœ¬ä¿®æ”¹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="markdown-1"><p><strong>æ³¨æ„åˆå§‹åŒ–stringçš„åªèƒ½æ˜¯å¸¸é‡ï¼ˆconstï¼‰ç±»å‹</strong>ã€‚</p><p>å½“ç„¶ä½ å¯èƒ½è§è¿‡æœ€ç®€å•çš„æ–¹æ³•ï¼Œä½¿ç”¨æ“ä½œç¬¦<code>=</code> æ¥åˆå§‹åŒ–å­—ç¬¦ä¸²ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string str = <span class="built_in">string</span>(<span class="string">&quot;royhuang&quot;</span>);</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ è¿˜å¯ä»¥ç”¨Cé£æ ¼çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯<strong>Cé£æ ¼å­—ç¬¦ä¸²å¦‚ä½•è½¬æ¢ä¸ºstring</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string str = <span class="string">&quot;royhuang&quot;</span>;  <span class="comment">// å­—ç¬¦ä¸²</span></span><br><span class="line">string str = <span class="string">&#x27;5&#x27;</span>;  <span class="comment">// å­—ç¬¦</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>=</code> æ˜¯é‡è½½è¿‡åçš„è¿ç®—ç¬¦ã€‚ç°åœ¨æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ï¼šå¦‚ä½•é€šè¿‡æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚</p><ul><li><p><code>string()</code> æ–¹æ³•</p><p>åŸå‹ï¼šstring::string()ã€‚åˆ›å»ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç©ºä¸²ï¼Œé»˜è®¤åˆå§‹åŒ–</span></span><br><span class="line">string sSource;  </span><br></pre></td></tr></table></figure></li><li><p><strong>string::string(const string&amp; strString)</strong></p><p>æ­¤æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å­—ç¬¦ä¸²ä½œä¸º strString çš„å‰¯æœ¬ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šå­—ç¬¦ä¸²å€¼åˆå§‹åŒ–</span></span><br><span class="line">string sSource&#123; <span class="string">&quot;my string&quot;</span> &#125;; </span><br><span class="line">string sNewSource&#123; sSource &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹åˆ«çš„ï¼Œè¿˜æ¥å—char* szCString ç±»å‹ä½œä¸ºå‚æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *szSource&#123; <span class="string">&quot;my string&quot;</span> &#125;;</span><br><span class="line">string sNewSource&#123; szSource &#125;;</span><br></pre></td></tr></table></figure></li><li><p><em><em>string::string(const char</em> szCString)</em>*</p><p>ä½¿ç”¨<u>å¸¸é‡</u><strong>Cé£æ ¼å­—ç¬¦ä¸²åˆå§‹åŒ–</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *szSource&#123; <span class="string">&quot;my string&quot;</span> &#125;;</span><br><span class="line">string sOutput&#123; szSource &#125;;</span><br></pre></td></tr></table></figure></li><li><p><strong>string::string(const string&amp; strString, size_type unIndex, size_type unLength)</strong></p><p>åˆ›å»ºä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œæœ€å¤šåŒ…å« strString ä¸­çš„ unLength å­—ç¬¦ï¼Œä»ç´¢å¼• unIndex å¼€å§‹ã€‚å¦‚æœé‡åˆ° NULLï¼Œå³ä½¿æœªè¾¾åˆ° unLengthï¼Œå­—ç¬¦ä¸²å¤åˆ¶ä¹Ÿä¼šç»“æŸã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆªå–æŒ‡å®šé•¿åº¦åˆå§‹åŒ–</span></span><br><span class="line">string sSource&#123; <span class="string">&quot;my string&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">string sOutput&#123; sSource, <span class="number">3</span> &#125;;</span><br><span class="line">std::cout &lt;&lt; sOutput&lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// string</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">sOutput2</span><span class="params">(sSource, <span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">std::cout &lt;&lt; sOutput2 &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// stri</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æƒ³ç”¨éå­—ç¬¦ä¸²ç±»å‹åˆå§‹åŒ–</strong>ï¼Ÿ</p><p>å¦‚æœä½ å°è¯•ç”¨éå­—ç¬¦ç±»å‹ä¸²åˆå§‹åŒ–ï¼Œæ¯”å¦‚æ•°å­—ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string sFour&#123; <span class="number">4</span> &#125;;</span><br></pre></td></tr></table></figure><p>ä¼šæŠ¥é”™ï¼š<code>æ— æ³•å°†å‚æ•° 1 ä»â€œintâ€è½¬æ¢ä¸ºâ€œstd::basic_stringâ€</code>  ã€‚ä¹Ÿå°±æ˜¯è¯´è¯•å›¾å°†intè½¬æ¢ä¸ºstringå¤±è´¥äº†ã€‚</p><blockquote><p>æœ‰ä»€ä¹ˆå¥½åŠæ³•å—ï¼Ÿå¥½åŠæ³•å°±æ˜¯æˆ‘ä»¬å…ˆå°†éstringç±»å‹ï¼Œæ¯”å¦‚ä¸Šæ–‡intç±»å‹ï¼Œè½¬æ¢ä¸ºstringã€‚</p></blockquote><p>å¥½å§ï¼Œæœç„¶æ˜¯ç»å…¸åºŸè¯å¤§å¸ˆã€‚å…·ä½“æ¥è¯´æˆ‘ä»¬æ˜¯ä½¿ç”¨<code>std::ostringstream</code> ç±»æ¥è½¬æ¢ä¸ºstringç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> std::string <span class="title">ToString</span><span class="params">(T tX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–--&gt;è¯»å…¥--&gt;è°ƒç”¨stræ–¹æ³•</span></span><br><span class="line">    ostringstream oStream;</span><br><span class="line">    oStream &lt;&lt; tX;  <span class="comment">// tXåŠ å…¥åˆ°æµä¸­</span></span><br><span class="line">    <span class="keyword">return</span> oStream.<span class="built_in">str</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string sFour&#123; <span class="built_in">ToString</span>(<span class="number">4</span>) &#125;;</span><br><span class="line">    string sSixPointSeven&#123; <span class="built_in">ToString</span>(<span class="number">6.7</span>) &#125;;</span><br><span class="line">    string sA&#123; <span class="built_in">ToString</span>(<span class="string">&#x27;A&#x27;</span>) &#125;;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; sFour &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;  <span class="comment">// 4</span></span><br><span class="line">    cout &lt;&lt; sSixPointSeven &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// 6.7</span></span><br><span class="line">    cout &lt;&lt; sA &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// A</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼ŒçŸ¥é“ä½ ä¸€å®šæ±‚çŸ¥è‹¥æ¸´ï¼šé‚£stringç±»å‹æ€ä¹ˆè½¬æ¢ä¸ºå…¶å®ƒç±»å‹å‘¢ï¼Ÿç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨std::istringstreamã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">FromString</span><span class="params">(<span class="keyword">const</span> std::string&amp; sString, T &amp;tX)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–--&gt;å†™å…¥--&gt;è°ƒç”¨stræ–¹æ³•</span></span><br><span class="line">    <span class="function">istringstream <span class="title">iStream</span><span class="params">(sString)</span></span>;</span><br><span class="line">    <span class="comment">// å°†æµä¸­æ•°æ®å†™å…¥åˆ°tXä¸­</span></span><br><span class="line">    <span class="keyword">return</span> !(iStream &gt;&gt; tX).<span class="built_in">fail</span>(); <span class="comment">// extract value into tX, return success or not</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> dX;</span><br><span class="line">    <span class="built_in">FromString</span>(<span class="string">&quot;3.4&quot;</span>, dX)</span><br><span class="line">    <span class="built_in">FromString</span>(<span class="string">&quot;ABC&quot;</span>, dX)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-2"><ul><li><p><strong>é‡è½½ç¬¦å·[]</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string sSource&#123; <span class="string">&quot;abc&quot;</span> &#125;;</span><br><span class="line">sSource[<span class="number">2</span>] = <span class="string">&#x27;D&#x27;</span>; <span class="comment">// abD</span></span><br></pre></td></tr></table></figure></li><li><p><strong>at() æ–¹æ³•</strong></p><p>ç›¸æ¯”æ€§èƒ½è¾ƒæ…¢ï¼Œå› ä¸ºå®ƒä¼šå¯¹ä¼ å…¥çš„å‚æ•°<code>index</code>è¿›è¡Œå¼‚å¸¸æ£€æŸ¥ã€‚ä½†æ˜¯ç›¸å¯¹çš„ï¼Œå¦‚æœä½ ä¸ç¡®å®šä¼ å…¥çš„<code>index</code>æ˜¯å¦æœ‰æ•ˆï¼š</p><p>just use it.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string sSource&#123; <span class="string">&quot;abc&quot;</span> &#125;;</span><br><span class="line">sSource.<span class="built_in">at</span>(<span class="number">2</span>) = <span class="string">&#x27;D&#x27;</span>; <span class="comment">// abD</span></span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-3"><ul><li><p><strong>size_type string::length() const</strong> å’Œ <strong>size_type string::size() const</strong></p><p>ä¸¤ä¸ªå‡½æ•°éƒ½å¯ä»¥è¿”å›å­—ç¬¦ä¸²ä¸­çš„å½“å‰<strong>å­—ç¬¦æ•°</strong>ï¼Œä¸åŒ…æ‹¬ç©ºç»ˆæ­¢ç¬¦ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string source&#123; <span class="string">&quot;012345678&quot;</span> &#125;;</span><br><span class="line">source.<span class="built_in">length</span>() <span class="comment">// 9 </span></span><br><span class="line">source.<span class="built_in">size</span>()   <span class="comment">// 9</span></span><br></pre></td></tr></table></figure></li><li><p><strong>bool string::empty() const</strong></p><p>å¦‚æœå­—ç¬¦ä¸²æ²¡æœ‰å­—ç¬¦åˆ™è¿”å›çœŸï¼Œå¦åˆ™è¿”å›å‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source.<span class="built_in">empty</span>()  <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li><li><p><strong>size_type string::capacity() const</strong></p><p>æ³¨æ„ï¼Œlength()æ–¹æ³•è¿”å›çš„æ˜¯å®é™…å­˜å‚¨çš„å­—ç¬¦æ•°é‡ï¼Œä½†æ˜¯capacity()æ–¹æ³•è¿”å›çš„ç¼–è¯‘å™¨ç»™stringç±»å‹åˆå§‹åŒ–åˆ†é…çš„å®¹é‡å¤§å°ã€‚</p><p>ç¼–è¯‘å™¨ä¸€èˆ¬ä¼šä¸ºç”¨æˆ·æä¾›äº†ä¸€äº›ç¼“å†²ç©ºé—´ï¼Œæ‰€ä»¥ä¸€èˆ¬<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>p</mi><mi>a</mi><mi>c</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo>&gt;</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">capacity()&gt;length()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string s &#123; <span class="string">&quot;012345678&quot;</span> &#125;;</span><br><span class="line">s.<span class="built_in">length</span>() ;   <span class="comment">// 9</span></span><br><span class="line">s.<span class="built_in">capacity</span>() ; <span class="comment">// 16</span></span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš</strong>ï¼Ÿ</p><p>è€ƒè™‘è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œä½ åˆå§‹åŒ–äº†ä¸€ä¸ªå­—ç¬¦ä¸²<code>str</code>ï¼Œlength()=8ã€‚å¦‚æœä½ åœ¨åé¢è¿˜ç»§ç»­ä¸²è”æ„é€ æ›´å¤§å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ—¶å€™<strong>æ¯ä¸²è”ä¸€æ¬¡ç¼–è¯‘å™¨å°±è¦é‡æ–°åˆ†é…<code>str</code>å¤§å°</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span> <span class="comment">// for rand() and srand()</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span> <span class="comment">// for time()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string str&#123;&#125;; <span class="comment">// length 0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> count&#123; <span class="number">0</span> &#125;; count &lt; <span class="number">16</span>; ++count)</span><br><span class="line">        str += <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸²è”çš„æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œæ˜¾ç„¶è¿™ä¼šå¯¹æ€§èƒ½é€ æˆè¾ƒå¤§çš„å½±å“ã€‚æ‰€ä»¥æ›´æ›´èªæ˜çš„åšæ³•ï¼Œ<strong>é™¤äº†ç³»ç»Ÿé»˜è®¤åˆ†é…æ›´å¤§çš„å®¹é‡ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æå‰reserveåˆ†é…æ›´å¤§çš„å®¹é‡</strong>ã€‚</p></li><li><p><strong>void string::reserve(size_type unSize)</strong></p><p>æå‰åˆ†é…æ›´å¤§çš„å®¹é‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.<span class="built_in">reserve</span>(<span class="number">16</span>);</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-4"><p>å®šä¹‰å…¬å…±ä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">sStr1</span><span class="params">(<span class="string">&quot;red&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">string <span class="title">sStr2</span><span class="params">(<span class="string">&quot;blue&quot;</span>)</span></span>;</span><br></pre></td></tr></table></figure><ul><li><p><strong>äº¤æ¢ä¸¤ä¸ªå­—ç¬¦ä¸²</strong></p><p>void swap (string &amp;str1, string &amp;str2)ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">swap</span>(sStr1, sStr2);</span><br></pre></td></tr></table></figure></li><li><p><strong>è¿½åŠ å­—ç¬¦ä¸²</strong></p><p>string&amp; string::operator+= (const string&amp; str)ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sStr1 += sStr2 ; <span class="comment">// æ–°å­—ç¬¦ä¸²ï¼šredblue</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨append()æ–¹æ³•ï¼Œæ•ˆæœä¸€æ ·ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sStr1.<span class="built_in">append</span>(sStr2)</span><br></pre></td></tr></table></figure><p><strong>ç‰¹åˆ«å¯¹äºCé£æ ¼å­—ç¬¦ä¸²</strong>ï¼Œå¦‚ä¸‹ã€‚</p><ol><li><p><code>+=/append</code> æ–¹å¼</p><p>è¦æ±‚éƒ½æ˜¯<strong>å¸¸é‡</strong>ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">sString</span><span class="params">(<span class="string">&quot;one&quot;</span>)</span></span>;</span><br><span class="line"><span class="comment">// &quot; two&quot;ã€&quot; three&quot;éƒ½æ˜¯Cé£æ ¼å­—ç¬¦ä¸²</span></span><br><span class="line">sString += <span class="string">&quot; two&quot;</span>;</span><br><span class="line">sString.<span class="built_in">append</span>(<span class="string">&quot; three&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>push_back</code> ï¼Œä»…é™<u>å­—ç¬¦</u></p><p><strong>ä¸è¦æ±‚æ˜¯å¸¸é‡</strong>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">sString</span><span class="params">(<span class="string">&quot;one&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">sString += <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">sString.<span class="built_in">push_back</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">cout &lt;&lt; sString &lt;&lt; endl;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one 2</span><br></pre></td></tr></table></figure></li></ol></li><li><p><strong>æ’å…¥å­—ç¬¦ä¸²</strong></p><p>string&amp; string::insert (size_type index, const string&amp; str)ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sStr1.<span class="built_in">insert</span>(<span class="number">2</span>,sStr2); <span class="comment">// reblued</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥æ’å…¥Cé£æ ¼å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åªèƒ½æ˜¯<strong>å¸¸é‡</strong>å­—ç¬¦ä¸²ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sStr1.<span class="built_in">insert</span>(<span class="number">2</span>,<span class="string">&quot;hwh&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><!-- tab æ¯”è¾ƒã€å­ä¸²ã€æœç´¢--><ul><li><p><strong>æ¯”è¾ƒ</strong></p><p>å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚</p><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">==, !=</td><td style="text-align:center">æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰/ä¸ç›¸ç­‰ï¼ˆè¿”å› boolï¼‰</td></tr><tr><td style="text-align:center">&lt;, &lt;=, &gt; &gt;=</td><td style="text-align:center">æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å°äº/å¤§äºå½¼æ­¤ï¼ˆè¿”å› boolï¼‰</td></tr><tr><td style="text-align:center">compare()</td><td style="text-align:center">æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰/ä¸ç›¸ç­‰ï¼ˆè¿”å› -1ã€0 æˆ– 1ï¼‰</td></tr></tbody></table></li><li><p><strong>å­ä¸²</strong></p><p>è§ä¸‹ã€‚</p><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">+</td><td style="text-align:center">å­ä¸²ç›¸åŠ </td></tr><tr><td style="text-align:center">substr()</td><td style="text-align:center">è·å–å­ä¸²</td></tr></tbody></table></li><li><p><strong>æœç´¢</strong></p><p>å¤§è‡´å¦‚ä¸‹ã€‚</p><table><thead><tr><th style="text-align:center">æ–¹æ³•</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">find()</td><td style="text-align:center">æŸ¥æ‰¾ç¬¬ä¸€ä¸ª<u>å­—ç¬¦/å­ä¸²</u></td></tr><tr><td style="text-align:center">find_first_of()</td><td style="text-align:center">æŸ¥æ‰¾æŒ‡å®šæœç´¢<u>å­—ç¬¦</u>çš„ç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®çš„ç´¢å¼•</td></tr><tr><td style="text-align:center">find_last_of()</td><td style="text-align:center">æŸ¥æ‰¾æŒ‡å®šæœç´¢<u>å­—ç¬¦</u>çš„æœ€åä¸€æ¬¡å‡ºç°ä½ç½®çš„ç´¢å¼•</td></tr></tbody></table></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="1-8-5-è¾“å…¥è¾“å‡ºæµ">1.8.5 è¾“å…¥è¾“å‡ºæµ</h4><p>åœ¨æœ¬ç¬”è®°ä¸­ï¼Œâ€œæµï¼ˆstreamï¼‰â€ä¸€è¯ä¼šè¢«å¤§é‡æåˆ°ã€‚ä¸å¯é¿å…çš„ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹å…¶åŸºæœ¬æ¦‚å¿µã€‚</p><ul><li><p><strong>ä»€ä¹ˆæ˜¯æµ</strong>ï¼Ÿ</p><p>æŠ½è±¡åœ°è¯´ï¼Œ<strong>æµåªæ˜¯ä¸€ä¸ªå¯ä»¥é¡ºåºè®¿é—®çš„å­—èŠ‚åºåˆ—</strong>ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæµå¯èƒ½ä¼šäº§ç”Ÿæˆ–æ¶ˆè€—æ— é™é‡çš„æ•°æ®ã€‚</p><p>ä»¥æˆ‘ä»¬é€šå¸¸å¤„ç†çš„è¾“å…¥æµå’Œè¾“å‡ºæµä¸ºä¾‹ã€‚</p><ul><li><strong>è¾“å…¥æµï¼šä¿å­˜æ¥è‡ªæ•°æ®ç”Ÿæˆå™¨ï¼ˆä¾‹å¦‚é”®ç›˜ã€æ–‡ä»¶æˆ–ç½‘ç»œï¼‰çš„è¾“å…¥</strong>ã€‚ä¾‹å¦‚ï¼Œä¿å­˜ç”¨æˆ·å½“å‰é”®ç›˜çš„è¾“å…¥ã€‚</li><li><strong>è¾“å‡ºæµï¼šç”¨äºä¿å­˜ç‰¹å®šæ•°æ®ä½¿ç”¨è€…çš„è¾“å‡ºï¼Œä¾‹å¦‚ç›‘è§†å™¨ã€æ–‡ä»¶æˆ–æ‰“å°æœº</strong>ã€‚å°†æ•°æ®å†™å…¥è¾“å‡ºè®¾å¤‡æ—¶ï¼Œè¯¥è®¾å¤‡å¯èƒ½å°šæœªå‡†å¤‡å¥½æ¥å—è¯¥æ•°æ®â€”â€”ä¾‹å¦‚ï¼Œå½“ç¨‹åºå°†æ•°æ®å†™å…¥å…¶è¾“å‡ºæµæ—¶ï¼Œæ‰“å°æœºå¯èƒ½ä»åœ¨é¢„çƒ­ã€‚æ•°æ®å°†ä½äºè¾“å‡ºæµä¸­ï¼Œç›´åˆ°æ‰“å°æœºå¼€å§‹ä½¿ç”¨å®ƒã€‚</li></ul></li><li><p><strong>C++ä¸­çš„è¾“å…¥ã€è¾“å‡ºæµ</strong></p><ul><li><strong>istreamç±»æ˜¯ä¸è¾“å…¥æµå¤„ç†æ—¶çš„ä¸»ç±»</strong>ã€‚å¯¹äºè¾“å…¥æµï¼Œ**æå–è¿ç®—ç¬¦ (&gt;&gt;)**ç”¨äºä»æµä¸­<u>åˆ é™¤</u>å€¼ã€‚</li><li><strong>ostreamç±»æ˜¯ä¸è¾“å‡ºæµå¤„ç†æ—¶çš„ä¸»ç±»</strong>ã€‚å¯¹äºè¾“å‡ºæµï¼Œ**æ’å…¥è¿ç®—ç¬¦ (&lt;&lt;)**ç”¨äºå°†å€¼<u>åŠ å…¥</u>æµä¸­ã€‚</li></ul><p>å½“ç„¶ï¼ŒC++å·²ç»é¢„å®šä¹‰å¥½å››ä¸ªæ ‡å‡†æµå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬ï¼š</p><ol><li><strong>cin</strong> ï¼šæ ‡å‡†è¾“å…¥æµå¯¹è±¡ï¼ˆé€šå¸¸æ˜¯é”®ç›˜ï¼‰ï¼›</li><li><strong>cout</strong> ï¼šæ ‡å‡†è¾“å‡ºæµå¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ç›‘è§†å™¨ï¼‰ï¼›</li><li><strong>cerr</strong> ï¼šæ ‡å‡†é”™è¯¯è¾“å‡ºæµå¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ç›‘è§†å™¨ï¼‰ï¼Œæä¾›<strong>æ— ç¼“å†²è¾“å‡º</strong>ï¼›</li><li><strong>clog</strong> ï¼šæ ‡å‡†é”™è¯¯è¾“å‡ºæµå¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ç›‘è§†å™¨ï¼‰ï¼Œæä¾›<strong>ç¼“å†²è¾“å‡º</strong>ã€‚</li></ol><p>æ— ç¼“å†²è¾“å‡ºé€šå¸¸è¢«ç«‹å³å¤„ç†ï¼Œè€Œç¼“å†²è¾“å‡ºé€šå¸¸ä½œä¸ºå—å­˜å‚¨å’Œå†™å‡ºã€‚å› ä¸º clog ä¸ç»å¸¸ä½¿ç”¨ï¼Œæ‰€ä»¥ç»å¸¸ä»æ ‡å‡†æµåˆ—è¡¨ä¸­çœç•¥å®ƒã€‚</p></li></ul><div class="tabs" id="markdown"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#markdown-1">istream</button></li><li class="tab"><button type="button" data-href="#markdown-2">ostream</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="markdown-1"><ul><li><p><strong>istreamæœ€ä½³å®è·µ</strong></p><ul><li><p>ï¼ˆCé£æ ¼ï¼‰<strong>ä½¿ç”¨setwé¿å…ç¼“å­˜åŒºæº¢å‡º</strong></p><p>ä½¿ç”¨æå–è¿ç®—ç¬¦<code>&gt;&gt;</code>ä»è¾“å…¥æµä¸­è¯»å–ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªå¸¸è§é—®é¢˜ä¾¿æ˜¯è¦é¿å…ç¼“å†²åŒºæº¢å‡ºã€‚<strong>å°¤å…¶æ˜¯åœ¨Cé£æ ¼çš„å­—ç¬¦ä¸²ä¸­</strong>ï¼Œè¿™åº”è¯¥æˆä¸ºä½ çš„è‚Œè‚‰ååº”ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buf[<span class="number">10</span>]; </span><br><span class="line">cin&gt;&gt;buf;  <span class="comment">// è¾“å…¥ï¼š12345678910</span></span><br></pre></td></tr></table></figure><ul><li><strong>æµç¨‹</strong>ï¼šä¸Šä¾‹ä¸­ï¼Œè¾“å…¥æµä¸­å­˜åœ¨ï¼š12345678910ï¼Œ<strong>cinæ¯æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²æ”¾å…¥bufä¸­ï¼Œé‡åˆ°ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦æ‰ä¼šç»ˆæ­¢</strong>ã€‚</li></ul><p>ä½†ç”±äºä½ çš„å°è°ƒçš®ï¼Œè¾“å…¥äº†è¶…è¿‡10ä¸ªå­—ç¬¦ã€‚å› ä¸ºè¿™è¶…è¿‡äº†ç¼“å­˜é¢„å®šå¤§å°ï¼ˆ10ï¼‰ï¼Œå¾ˆä¸å¹¸å‘ç”Ÿäº†Segmentation faultã€‚</p><p>æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼Œæˆ‘ä»¬è¦<strong>é™åˆ¶ä»æµä¸­è¯»å–çš„æœ€å¤§å­—ç¬¦æ•°</strong>ï¼ˆå°äº10ï¼‰ï¼Œç„¶åå†æ”¾å…¥bufä¸­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">10</span>];</span><br><span class="line">cin&gt;&gt;<span class="built_in">setw</span>(<span class="number">10</span>)&gt;&gt;buf;</span><br><span class="line">cout&lt;&lt;buf;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç¨‹åºåªè¯»å–æµä¸­çš„å‰ <strong>9</strong> ä¸ªå­—ç¬¦ï¼ˆä¸ºç»ˆæ­¢ç¬¦ç•™å‡ºç©ºé—´ï¼‰ã€‚ä»»ä½•å‰©ä½™çš„å­—ç¬¦éƒ½å°†ç•™åœ¨æµä¸­ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡æå–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123456789</span><br></pre></td></tr></table></figure></li><li><p>ï¼ˆCé£æ ¼ï¼‰<strong>ä½¿ç”¨getlineè¯»å–æ•´è¡Œ</strong></p><p>å¦‚å‰æåˆ°ï¼Œcinå¦‚æœé‡åˆ°ï¼šç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ï¼Œå°±ä¼šè‡ªåŠ¨åœæ­¢æå–ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">cin&gt;&gt;<span class="built_in">setw</span>(<span class="number">20</span>)&gt;&gt;buf; <span class="comment">// è¾“å…¥ï¼ši am royhuang</span></span><br><span class="line">cout&lt;&lt;buf;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå´ä¸å¦‚æ„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œèªæ˜çš„ä½ æƒ³åˆ°ç›´æ¥ç”¨å¾ªç¯è¯»å–å­—ç¬¦ï¼šé‡åˆ°ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰å¼€å§‹ä¸‹ä¸€ä¸ªå¾ªç¯ï¼Œç›´è‡³é‡åˆ°<code>\n</code> æ‰ç»“æŸå¾ªç¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (cin&gt;&gt;buf[i++]);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i am royhuang</span><br></pre></td></tr></table></figure><p>ä½†ä¸Šé¢çš„æ–¹å¼å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š1ï¼‰å¾ªç¯ä¸å¤Ÿä¼˜é›…ï¼›2ï¼‰æ²¡æœ‰é™åˆ¶è¾“å…¥å­—ç¬¦æœ€å¤§é•¿åº¦ã€‚</p><p>ä¸ºæ­¤ï¼Œä½ è¯´å¯ä»¥ä½¿ç”¨getæ–¹æ³•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">cin.<span class="built_in">get</span>(buf,<span class="number">20</span>);</span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šå»ä¸€åˆ‡éƒ½å¾ˆç¾å¥½ã€‚ä½†æ˜¯è¿™é‡Œå¿½ç•¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>æ¢è¡Œç¬¦<code>\n</code>è¿˜åœ¨æµä¸­</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">cin.<span class="built_in">get</span>(buf,<span class="number">20</span>);</span><br><span class="line">cout&lt;&lt;buf&lt;&lt;endl;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">char</span> company[<span class="number">10</span>];</span><br><span class="line">cin.<span class="built_in">get</span>(company,<span class="number">10</span>);</span><br><span class="line">cout&lt;&lt;company&lt;&lt;endl;</span><br></pre></td></tr></table></figure><p>companyè¿˜æœªæ¥å¾—åŠè¾“å…¥ï¼Œä¾¿ç»“æŸï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211229165225112.png" alt="image-20211229165225112"></p><p>ä½¿ç”¨getlineå¯è¯»å…¥æ¢è¡Œç¬¦ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">cin.<span class="built_in">getline</span>(buf,<span class="number">20</span>);  <span class="comment">// \n ä¹Ÿå¹¶è¯»å…¥</span></span><br><span class="line">cout&lt;&lt;buf&lt;&lt;endl;  </span><br><span class="line">    </span><br><span class="line"><span class="keyword">char</span> company[<span class="number">10</span>];</span><br><span class="line">cin.<span class="built_in">get</span>(company,<span class="number">10</span>);</span><br><span class="line">cout&lt;&lt;company&lt;&lt;endl;</span><br></pre></td></tr></table></figure><p>ä¸€åˆ‡æ­£å¸¸äº†ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211229165358871.png" alt="image-20211229165358871"></p></li></ul></li><li><p>ï¼ˆstringï¼‰<strong>std::string+cin</strong></p><p>å’Œå‰é¢Cé£æ ¼å­—ç¬¦ä¸²è¯»å–å¤§åŒå°å¼‚ï¼Œä¸è¿‡C++ä¸­ä½¿ç”¨çš„æ˜¯æ ‡å‡†åº“ä¸­<code>std::get</code>å’Œ<code>std::getline</code> å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="comment">// è™½ç„¶uniåˆå§‹åŒ–ä¸ºç©ºä¸²ï¼Œä½†æ˜¯èµ‹å€¼åè¶…è¿‡é•¿åº¦ï¼ˆlengthï¼‰ä¼šè‡ªåŠ¨å¢é•¿å®¹é‡ï¼ˆcapacityï¼‰</span></span><br><span class="line">    string name&#123;&#125;;</span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;input your name: &quot;</span>;</span><br><span class="line">    cin&gt;&gt;name;</span><br><span class="line">    </span><br><span class="line">    string uni&#123;&#125;;</span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;input your university: &quot;</span>;</span><br><span class="line">    <span class="built_in">getline</span>(cin,uni);</span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;your university is: &quot;</span>&lt;&lt;uni&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡ºç°å‰è¿°ç±»ä¼¼è¯»å…¥<code>\n</code>é—®é¢˜ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227224535931.png" alt="image-20211227224535931"></p><p>æˆ‘ä»¬è¾“å…¥<code>royhuang</code>å¹¶æŒ‰ä¸‹å›è½¦æ—¶ï¼Œç­‰äºè¾“å…¥äº†<code>royhuang\n</code> ï¼š<code>royhuang</code> è¢«æ­£ç¡®èµ‹å€¼ç»™<code>name</code> ï¼Œä½†æ˜¯<code>\n</code> ç•™åœ¨äº†ç¼“å†²åŒºç­‰å¾…ä¸‹ä¸€æ¬¡<code>cin</code>è¯»å–ã€‚ä¸‹ä¸€æ¬¡çš„<code>cin</code>è¿˜æ²¡ç­‰æˆ‘ä»¬å†æ¬¡è¾“å…¥ï¼Œä¾¿å‘ç°äº†ç¼“å†²åŒº<code>\n</code>å°±å®Œæˆæ­¤æ¬¡è¯»å–äº†ã€‚</p><p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªåŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><ol><li>æå‰è¯»å…¥<code>\n</code>ï¼šç¬¬6è¡Œ<code>cin&gt;&gt;name;</code> æ›¿æ¢â€”&gt;<code>getline(cin,name);</code> ï¼›</li><li>å¿½ç•¥<code>\n</code>ï¼šç¬¬13è¡Œ<code> getline(cin,uni);</code>â€”&gt;<code>getline(cin&gt;&gt;ws,uni);</code>ï¼Œ<code>ws</code> è¡¨ç¤ºå¿½ç•¥å‰é¢çš„ç©ºç™½å­—ç¬¦ã€‚</li></ol><p>å¥½äº†ï¼Œä¸–ç•Œåˆå¥½èµ·æ¥äº†ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227225611265.png" alt="image-20211227225611265"></p></li><li><p><strong>å…¶å®ƒæœ‰ç”¨çš„istreamå‡½æ•°</strong></p><ul><li><strong>ignore</strong>()ä¸¢å¼ƒæµä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚</li><li><strong>ignore(int nCount</strong>)ä¸¢å¼ƒå‰ nCount ä¸ªå­—ç¬¦ã€‚</li><li><strong>peek(</strong>)å…è®¸æ‚¨ä»æµä¸­è¯»å–å­—ç¬¦ï¼Œè€Œæ— éœ€å°†å…¶ä»æµä¸­åˆ é™¤ã€‚</li><li><strong>unget(</strong>)å°†è¯»å›çš„æœ€åä¸€ä¸ªå­—ç¬¦è¿”å›åˆ°æµä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥å†æ¬¡è¯»å–ã€‚</li><li><strong>putback(char ch</strong>)å…è®¸æ‚¨å°†æ‚¨é€‰æ‹©çš„å­—ç¬¦æ”¾å›æµä¸­ä»¥ä¾›ä¸‹ä¸€æ¬¡è°ƒç”¨è¯»å–ã€‚</li></ul></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-2"><p>è¿™ä¸ªå°èŠ‚ä¸»è¦å¦‚ä½• iostream è¾“å‡ºç±» (ostream) æ ¼å¼åŒ–è¾“å‡ºå†…å®¹ã€‚</p><ul><li><p><strong>å‰ç¼€æ­£æ•°+</strong></p><p>std::ios::showposï¼šå¦‚æœè®¾ç½®ï¼Œåˆ™ç”¨ + å‰ç¼€æ­£æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; showpos &lt;&lt; <span class="number">5</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211229172847173.png" alt="image-20211229172847173"></p></li><li><p><strong>boolæ ‡è¯†</strong></p><p>std::ios::boolalphaï¼šå¦‚æœè®¾ç½®ï¼Œå¸ƒå°”å€¼æ‰“å°â€œçœŸâ€æˆ–â€œå‡â€ã€‚å¦‚æœæœªè®¾ç½®ï¼Œå¸ƒå°”å€¼æ‰“å° 0 æˆ– 1ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; boolalpha &lt;&lt; <span class="literal">true</span> &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="literal">false</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211229172619002.png" alt="image-20211229172619002"></p></li><li><p><strong>ç§‘å­¦è®¡æ•°æ³•</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; uppercase &lt;&lt; <span class="number">12345678.9</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211229173207449.png" alt="image-20211229173207449"></p></li><li><p><strong>10/2/8/è¿›åˆ¶</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; hex &lt;&lt; <span class="number">11</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">cout &lt;&lt; dec &lt;&lt; <span class="number">11</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">cout &lt;&lt; oct &lt;&lt; <span class="number">11</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211229173531290.png" alt="image-20211229173531290"></p></li><li><p><strong>è®¾ç½®å®½åº¦ã€å¡«å……å­—ç¬¦ã€å¯¹é½æ–¹å¼</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="number">-12345</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br><span class="line">cout &lt;&lt; <span class="built_in">setw</span>(<span class="number">10</span>) &lt;&lt; <span class="number">-12345</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">cout &lt;&lt; <span class="built_in">setw</span>(<span class="number">10</span>) &lt;&lt; left &lt;&lt; <span class="number">-12345</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br><span class="line">cout &lt;&lt; <span class="built_in">setw</span>(<span class="number">10</span>) &lt;&lt; right &lt;&lt; <span class="number">-12345</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br><span class="line">cout &lt;&lt; <span class="built_in">setw</span>(<span class="number">10</span>) &lt;&lt; internal &lt;&lt; <span class="number">-12345</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-12345 </span><br><span class="line">    -12345 </span><br><span class="line">-12345 </span><br><span class="line">    -12345 </span><br><span class="line">- 12345</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h2><div class="timeline"><div class="timenode"><div class="meta"><p><p>2021-12-25 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ç¬¬ä¸€æ¬¡æ›´æ–°</li></ol></div></div></div><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">c++ä¸­çš„å˜é‡åˆå§‹åŒ–ï¼šhttps://www.dyxmq.cn/program/code/c-cpp/cpp-variable-default-init.html<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">cppç±»åˆå§‹åŒ–ï¼šhttps://aiden-dong.gitee.io/2020/01/08/cpp%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96/<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ æ•™ç¨‹ï¼šhttps://cloud.tencent.com/edu/learning/course-1844-21266<a href="#fnref:3" rev="footnote"> â†©</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Cè¯­è¨€externå…³é”®è¯ï¼šhttp://c.biancheng.net/cpp/html/448.html<a href="#fnref:4" rev="footnote"> â†©</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ ä¸­çš„staticå…³é”®å­—ä½¿ç”¨åœºæ™¯ï¼šhttps://cloud.tencent.com/developer/article/1695037<a href="#fnref:5" rev="footnote"> â†©</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ å¾ªç¯ï¼šhttps://www.w3cschool.cn/cpp/cpp-loops.html<a href="#fnref:6" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++åŸºç¡€ </tag>
            
            <tag> å¿«é€Ÿå…¥é—¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŠ¡å®åŸºç¡€ï¼ˆä¸­ï¼‰æŒ‡é’ˆå’Œå¼•ç”¨</title>
      <link href="/p/24237/"/>
      <url>/p/24237/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><h2 id="äºŒã€æŒ‡é’ˆ-å¼•ç”¨">äºŒã€æŒ‡é’ˆ&amp;å¼•ç”¨</h2><p>ç¬¬ä¸€æ¬¡å­¦C++ï¼ŒæŒ‡é’ˆå’Œå¼•ç”¨ä»¤å½“æ—¶è¿˜æ˜¯åˆå­¦è€…çš„æˆ‘æ„Ÿåˆ°éå¸¸çš„å›°æƒ‘ï¼š</p><ul><li>æ™®é€šå˜é‡å°±å¯ä»¥ä»£è¡¨ä¸€å—å†…å­˜åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨åŸå§‹å˜é‡ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦æŒ‡é’ˆï¼Ÿ</li><li>æŒ‡é’ˆè§£å†³äº†æ™®é€šå˜é‡çš„ä¸è¶³ï¼Œä¸ºä»€ä¹ˆåˆå¼•å…¥å¼•ç”¨çš„æ¦‚å¿µï¼Ÿ</li><li>å¼•ç”¨æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæ“ä½œå¼•ç”¨ç­‰ä»·æ“ä½œå˜é‡æœ¬ä½“ï¼Ÿ</li></ul><p>å¸Œæœ›æ›¾ç»çš„æˆ‘ï¼Œç°åœ¨çš„ä½ å¯ä»¥åœ¨æœ¬ç« æ‰¾åˆ°ç­”æ¡ˆã€‚</p><h3 id="2-1-æŒ‡é’ˆ">2.1 æŒ‡é’ˆ</h3><h4 id="2-1-1-ä¸ºä»€ä¹ˆéœ€è¦æŒ‡é’ˆ">2.1.1 ä¸ºä»€ä¹ˆéœ€è¦æŒ‡é’ˆ</h4><h5 id="é‡æ–°å®¡è§†å˜é‡">é‡æ–°å®¡è§†å˜é‡</h5><p><u>å˜é‡</u>å¯ä»¥ç†è§£ä¸ºæŸå—å†…å­˜åŒºåŸŸ<u>åœ°å€åˆ«å</u>ï¼Œè¿™å—å†…å­˜åŒºåŸŸä¿å­˜å˜é‡çš„å€¼ã€‚</p><p>ä¸‹é¢ä¸¾ä¸€ä¸ªå®ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">x = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>å¯¹åº”æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movl    $0, -12(%rbp)</span><br><span class="line">movl    $1, -12(%rbp)</span><br></pre></td></tr></table></figure><ol><li>å½“CPUæ‰§è¡Œ<code>int x = 0</code>ï¼Œä¼šåœ¨å†…å­˜ï¼ˆè¿™é‡Œæ˜¯æ ˆï¼‰è…¾å‡ºä¸€å—åŒºåŸŸï¼ˆ<code>-12(%rbp)</code>ï¼‰ç”¨æ¥å­˜å‚¨å˜é‡<code>x</code>ï¼›ç„¶å<code>x</code>æ‰€ä»£è¡¨çš„å†…å­˜åŒºåŸŸï¼ˆ<code>-12(%rbp)</code>ï¼‰è¢«å­˜å…¥0ã€‚</li><li>ç»§ç»­æ‰§è¡Œ<code>x=1</code>ï¼Œ1è¢«å­˜å…¥å˜é‡<code>x</code>æ‰€ä»£è¡¨çš„å†…å­˜åŒºåŸŸã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå˜é‡çš„å­˜åœ¨ä½¿å¾—æˆ‘ä»¬ï¼šä¸ç”¨è®°ä½ä¸ºåˆ†é…<code>x</code>çš„å†…å­˜åœ°å€æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬é€šè¿‡å˜é‡å<code>x</code>å°±å¯ä»¥ä½¿ç”¨åˆ†é…çš„å†…å­˜åŒºåŸŸã€‚<strong>å› ä¸ºä½¿ç”¨<code>x</code>æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å˜é‡<code>x</code>éšå¼è‡ªåŠ¨ç¿»è¯‘æˆå¯¹åº”çš„å†…å­˜åœ°å€ï¼ŒåŒæ—¶è¿›è¡Œé—´æ¥å¯»å€</strong>ï¼ˆå¯ä»¥ç†è§£ä¸ºä½¿ç”¨<code>x</code>ç­‰ä»·äº<code>*x</code>ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;   <span class="comment">// ç¼–è¯‘å™¨çœ¼é‡Œï¼šint* x = -12(%rbp); *x = 0;</span></span><br><span class="line">x = <span class="number">1</span>;       <span class="comment">// ç¼–è¯‘å™¨çœ¼é‡Œï¼š *x = 1;</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æœ‰å¥½ç”¨åˆå¥½è®°çš„å˜é‡<code>x</code>å°±å¯ä»¥ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”»è›‡æ·»è¶³èˆ¬åœ°æ˜¾ç¤ºä½¿ç”¨<u>æŒ‡é’ˆå˜é‡</u>ï¼Œå»å­˜å‚¨å†…å­˜åœ°å€ï¼Œå†æ¥æ“ä½œå˜é‡<code>x</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå®ƒå­˜å…¥xçš„åœ°å€</span></span><br><span class="line"><span class="keyword">int</span>* p_x = &amp;x;</span><br><span class="line"><span class="comment">// ä½¿ç”¨é—´æ¥æ“ä½œç¬¦*ï¼Œè®¿é—®p_xå­˜å‚¨çš„å†…å­˜åŒºåŸŸ</span></span><br><span class="line">*p_x = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„æ±‡ç¼–ä»£ç ä¹Ÿå˜å¾—è‡ƒè‚¿èµ·æ¥ï¼Œå› ä¸ºè¿˜å¤šäº†ç©ºé—´å»å­˜å‚¨æŒ‡é’ˆ<code>p_x</code>ï¼ˆå³ä½¿æ²¡æœ‰æ±‡ç¼–ç›¸å…³åŸºç¡€ä¹Ÿå»ºè®®é˜…è¯»ä¸€éï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># -12(%rbp)åœ°å€èµ‹å€¼ç»™å¯„å­˜å™¨raxï¼Œä¹Ÿå°±æ˜¯å˜é‡xçš„åœ°å€</span><br><span class="line">leaq    -12(%rbp), %rax </span><br><span class="line"># cpuè…¾å‡ºä¸€å—å†…å­˜åŒºåŸŸï¼ˆå¯¹åº”åœ°å€-8(%rbp)ï¼‰ç»™æŒ‡é’ˆp_xï¼Œ</span><br><span class="line"># å¹¶æŠŠå˜é‡xçš„åœ°å€èµ‹å€¼ç»™p_x</span><br><span class="line">movq    %rax, -8(%rbp)</span><br><span class="line"># p_xçš„å€¼å­˜å‚¨åˆ°å¯„å­˜å™¨raxä¸­</span><br><span class="line">movq    -8(%rbp), %rax</span><br><span class="line"># å°†ç«‹å³æ•°10å­˜å‚¨åˆ°å˜é‡xä»£è¡¨çš„å†…å­˜åŒºåŸŸä¸­</span><br><span class="line">movl    $10, (%rax)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ¥è¯´è¯´C++ä¸­æŒ‡é’ˆçš„å¥½å¤„ã€‚</p><h5 id="æŒ‡é’ˆçš„å¥½å¤„">æŒ‡é’ˆçš„å¥½å¤„</h5><p>äº‹å®è¯æ˜ï¼ŒæŒ‡é’ˆåœ¨è®¸å¤šæƒ…å†µä¸‹éƒ½å¾ˆæœ‰ç”¨ï¼ˆä¸Šé¢çš„ä¾‹å­å½“ç„¶æ˜¯ä½¿ç”¨å˜é‡æ›´å¥½ï¼‰ï¼š</p><ul><li><strong>éå†æ•°ç»„</strong>ã€‚æŒ‡é’ˆå¯ä»¥å¾ˆæ–¹ä¾¿çš„éå†æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„æ˜¯ä½¿ç”¨æŒ‡é’ˆå®ç°çš„ï¼›</li><li><strong>åŠ¨æ€åˆ†é…å†…å­˜</strong>ã€‚åœ¨C++ä¸­åªèƒ½ä½¿ç”¨æŒ‡é’ˆæ¥åŠ¨æ€åˆ†é…å†…å­˜ï¼›</li><li><strong>å‡½æ•°ä½œä¸ºå‚æ•°æ—¶</strong>ã€‚å¯ä»¥ç”¨æ¥å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œå³å‡½æ•°æŒ‡é’ˆï¼›</li><li><strong>å®ç°å¤šæ€æ€§</strong>ã€‚å®ƒä»¬å¯ç”¨äºå®ç°å¤šæ€æ€§ï¼Œåœ¨é¢å¯¹å¯¹è±¡ä¸­ä¼šè¯¦ç»†ä»‹ç»ï¼›</li><li><strong>æŒ‡å‘å¦ä¸€ä¸ªç»“æ„/ç±»</strong>ã€‚åœ¨ä¸€äº›æ›´é«˜çº§çš„æ•°æ®ç»“æ„ä¸­å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚é“¾è¡¨å’Œæ ‘ã€‚</li></ul><p>ä½†å¦ä¸€ä¸ªäº‹å®æ˜¯ï¼Œé™¤äº†åœ¨C++ä¸­ï¼ŒæŒ‡é’ˆçš„ä½¿ç”¨å¹¶éé‚£ä¹ˆå¿…è¦ã€‚å…¶å®ƒçš„é«˜çº§è¯­è¨€ä¸­ï¼Œå¾ˆå¤šå·²ç»æ‘’å¼ƒäº†æŒ‡é’ˆï¼ˆå¦‚.NETæˆ–Javaï¼‰ï¼š</p><ul><li><strong>éå†æ•°ç»„</strong>ï¼šä¼ ç»Ÿçš„forå¾ªç¯ã€è¿­ä»£å™¨éƒ½å¯ä»¥æ›¿ä»£ï¼›</li><li><strong>åŠ¨æ€åˆ†é…å†…å­˜</strong>ï¼šå¾ˆå¤šé«˜çº§è¯­è¨€å¦‚Javaä¸ç”¨æŒ‡é’ˆå³å¯åŠ¨æ€åˆ†é…å†…å­˜ï¼ˆnewæ–¹å¼ï¼‰ï¼›</li><li><strong>å‡½æ•°ä½œä¸ºå‚æ•°</strong>ï¼šåœ¨javaä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨æ¥å£å®ä¾‹ç­‰æ–¹å¼é—´æ¥å®ç°ï¼›</li><li><strong>å®ç°å¤šæ€æ€§</strong>ï¼šjavaæ— éœ€æŒ‡é’ˆå³å¯å®ç°ï¼›</li><li><strong>æŒ‡å‘å¦å¤–ä¸€ä¸ªç»“æ„ç±»</strong> ï¼šjavaç­‰ç›´æ¥ä½¿ç”¨<strong>å¼•ç”¨</strong>å³å¯ã€‚</li></ul><h5 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h5><p>æ ¹æ®å¤šä½C++å¤§å¸ˆçš„å»ºè®®ï¼Œ<u>å®é™…ç¼–ç å°½é‡ä¸è¦ä½¿ç”¨æŒ‡é’ˆ</u>ï¼Œæ›¿ä»£ä½¿ç”¨<u>å¼•ç”¨</u>æˆ–è€…<u>æ ‡å‡†åº“</u>æ˜¯ç§æ›´å¥½çš„æ–¹å¼ã€‚</p><p>ä½†ç§ç§åŸå› ï¼Œä½œä¸ºä¸€ä¸ªC++ç¨‹åºå‘˜ï¼Œå¾ˆå¤šæƒ…å†µè¿˜æ˜¯é¿å…ä¸äº†å»æ¥è§¦å’Œä½¿ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾ˆæœ‰å¿…è¦æ·±å±‚æ¬¡äº†è§£æŒ‡é’ˆçš„ç”¨æ³•å’ŒåŸç†ã€‚</p><h4 id="2-1-2-æŒ‡é’ˆç®€ä»‹">2.1.2 æŒ‡é’ˆç®€ä»‹</h4><h5 id="æŒ‡é’ˆåˆè¯†">æŒ‡é’ˆåˆè¯†</h5><p><strong>å£°æ˜</strong>æŒ‡é’ˆä½¿ç”¨<code>*</code>ï¼Œè¿™ä¸ªæ—¶å€™<code>*</code>ä¸æ˜¯é—´æ¥æ“ä½œç¬¦ï¼Œå®ƒåªæ˜¯æŒ‡é’ˆè¯­æ³•çš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>* p_a; <span class="comment">// p_aä¹Ÿæ˜¯å˜é‡ï¼Œä¸è¿‡æ˜¯æŒ‡é’ˆå˜é‡ï¼Œå­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼ˆaçš„ï¼‰ï¼Œä¸‹é¢ç®€ç§°ä¸ºæŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ³¨æ„äº‹é¡¹ï¼š</p><ul><li>æŒ‡é’ˆå˜é‡åœ¨å£°æ˜æ—¶å¦‚æœæ²¡è¢«åˆå§‹åŒ–ï¼Œé»˜è®¤åˆå§‹åŒ–è§„åˆ™å’Œæ™®é€šå˜é‡ä¸€æ ·ï¼Œå¯èƒ½åŒ…å«åƒåœ¾å€¼ï¼ˆæ¯”å¦‚å±€éƒ¨æŒ‡é’ˆå˜é‡ï¼‰ï¼›</li><li><code>p_a</code>è¢«ç§°ä¸ºâ€œæ•´æ•°æŒ‡é’ˆâ€ï¼Œå®é™…å«ä¹‰åº”è¯¥æ˜¯â€œæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆâ€ã€‚</li></ul><blockquote><p>ğŸ‘€ çœ¼ä¿å¥æ“ç¯èŠ‚ã€‚</p></blockquote><p>åŒºåˆ†ä»¥ä¸‹æŒ‡é’ˆç±»å‹ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *p[<span class="number">10</span>]</span><br><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*p)[<span class="number">10</span>]</span><br><span class="line"><span class="function"><span class="keyword">int</span> *<span class="title">p</span><span class="params">(<span class="keyword">int</span>)</span></span></span><br></pre></td></tr></table></figure><p>æŒ‡é’ˆå’Œæ•°ç»„<code>[]</code> ç»“åˆä¸€èˆ¬æ‰è¦æ³¨æ„åŒºåˆ†ï¼Œå…¶ä½™æƒ…å†µå¤§å¤šæ˜¯è¡¨ç¤ºæŒ‡é’ˆã€‚</p><ol><li><code>int *p[10]</code> ï¼Œå¼ºè°ƒæ•°ç»„æ¦‚å¿µï¼Œæ­¤æ—¶<code>p</code>è¡¨ç¤ºæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯<code>int*</code> ç±»å‹ï¼›</li><li><code>int (*p)[10]</code> ï¼Œç”¨<code>()</code> åœˆä½<code>*p</code> ï¼Œå¼ºè°ƒæŒ‡é’ˆæ¦‚å¿µï¼Œæ­¤æ—¶æŒ‡é’ˆ<code>p</code> æŒ‡å‘ä¸€ä¸ª<code>int</code> ç±»å‹æ•°ç»„ï¼Œç­‰ä»·äº <code>int *p = new int(10*sizeof(int));</code> ï¼›</li><li><code>int *p(int)</code> ï¼Œè¿™æ˜¯å‡½æ•°å£°æ˜æœ¬è´¨è¿˜æ˜¯æŒ‡é’ˆï¼ŒæŒ‡é’ˆ<code>p</code> å­˜å‚¨çš„å‡½æ•°çš„åœ°å€ï¼Œåé¢çš„<code>(int)</code> è¡¨ç¤ºæ˜¯ä¸ª<u>å‡½æ•°</u>ã€‚</li></ol><p>ç‰¹åˆ«çš„è¿˜æœ‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*p)(<span class="keyword">int</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>åŒå‰ï¼Œç”¨<code>()</code> åœˆä½<code>*p</code> ï¼Œæ›´å¼ºè°ƒæŒ‡é’ˆæ¦‚å¿µï¼Œåé¢çš„<code>(int)</code> è¡¨ç¤ºæ˜¯ä¸ª<u>å‡½æ•°</u>ã€‚</li></ol><p><strong>èµ‹å€¼</strong>æ˜¯ä½¿ç”¨åœ°å€è¿ç®—ç¬¦<code>&amp;</code>ï¼š</p><p>ä»ä¸‹ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œ<strong>æŒ‡é’ˆå’Œæ™®é€šå˜é‡åœ¨cpuçœ¼ä¸­æ— å¤šå¤§åŒºåˆ«ï¼Œåªä¸è¿‡æŒ‡é’ˆç”¨æ¥å­˜å‚¨åœ°å€</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p_a = &amp;a;   <span class="comment">// &amp;aè·å–äº†å˜é‡açš„åœ°å€ã€‚</span></span><br></pre></td></tr></table></figure><p><code>&amp;p_a</code>å¯è·å–æŒ‡é’ˆ<code>p_a</code>çš„åœ°å€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cout&lt;&lt;p_a&lt;&lt;endl;  <span class="comment">// açš„åœ°å€ï¼Œ0x7ffc4f78721c</span></span><br><span class="line">cout&lt;&lt;&amp;p_a&lt;&lt;endl; <span class="comment">// æŒ‡é’ˆp_açš„åœ°å€ï¼Œ0x7ffe903aae20</span></span><br></pre></td></tr></table></figure><p>åœ°å€è¿ç®—ç¬¦éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p>åœ°å€è¿ç®—ç¬¦ (&amp;) è¿”å›<strong>ä¸æ˜¯å˜é‡çš„åœ°å€</strong>ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒ…å«<strong>å˜é‡åœ°å€çš„æŒ‡é’ˆ</strong> ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; <span class="built_in"><span class="keyword">typeid</span></span>(&amp;a).<span class="built_in">name</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int *</span><br></pre></td></tr></table></figure></li><li><p><strong>æŒ‡é’ˆåªèƒ½ä½¿ç”¨å·¦å€¼è¿›è¡Œèµ‹å€¼</strong></p><p>ä»€ä¹ˆæ˜¯å·¦ï¼ˆlï¼‰å€¼å’Œå³ï¼ˆrï¼‰å€¼ï¼Ÿå¯å‚è€ƒä¸‹ä¸€å°èŠ‚ï¼š<u>lå€¼å’Œrå€¼</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>* b = a; <span class="comment">// åˆæ³•ï¼Œå˜é‡bæ˜¯å·¦å€¼</span></span><br><span class="line"><span class="keyword">int</span>* b = <span class="number">1</span>; <span class="comment">// éæ³•ï¼Œæ–‡å­—1æ˜¯å³å€¼</span></span><br><span class="line"><span class="keyword">int</span>* b = a+<span class="number">1</span>; <span class="comment">// éæ³•ï¼Œè¡¨è¾¾å¼a+1ä¹Ÿæ˜¯å³å€¼</span></span><br></pre></td></tr></table></figure></li></ul><p>å˜é‡å¯ä»¥ä¿®æ”¹å­˜å‚¨å…¶å®ƒçš„å€¼ï¼ŒæŒ‡é’ˆä¹Ÿå¯ä»¥æŒ‡å‘å…¶ä»–çš„å†…å­˜åŒºåŸŸï¼ˆå­˜å–å®ƒçš„åœ°å€ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> b = <span class="number">11</span>; </span><br><span class="line">p_a  = &amp;b;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨</strong>æŒ‡é’ˆæ˜¯é€šè¿‡é—´æ¥æ“ä½œç¬¦<code>*</code> ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cout&lt;&lt; *p_a &lt;&lt;endl ; <span class="comment">// 10, è¯»å–å€¼</span></span><br><span class="line">*p_a = <span class="number">11</span>;  <span class="comment">// ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p><strong>æŒ‡é’ˆå¤§å°</strong>å–å†³äºç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶çš„ä½“ç³»ç»“æ„â€”â€”32 ä½å¯æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨ 32 ä½å†…å­˜åœ°å€â€”â€”å› æ­¤ï¼Œ32 ä½æœºå™¨ä¸Šçš„æŒ‡é’ˆæ˜¯ 32 ä½ï¼ˆ4 å­—èŠ‚ï¼‰ã€‚å¯¹äº 64 ä½å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒæŒ‡é’ˆå°†æ˜¯ 64 ä½ï¼ˆ8 å­—èŠ‚ï¼‰ã€‚</p><p>å®ƒå’ŒæŒ‡å‘çš„å¯¹è±¡å¤§å°æ— å…³ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>* p_a = &amp;a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> b = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="keyword">char</span>* p_b = &amp;b;</span><br><span class="line"></span><br><span class="line">cout&lt;&lt;<span class="built_in"><span class="keyword">sizeof</span></span>(p_a)&lt;&lt;endl;</span><br><span class="line">cout&lt;&lt;<span class="built_in"><span class="keyword">sizeof</span></span>(p_b)&lt;&lt;endl;</span><br></pre></td></tr></table></figure><p>åœ¨ä½œè€…64ä½æœºå™¨ä¸Šè¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">8</span><br></pre></td></tr></table></figure><h5 id="lå€¼å’Œrå€¼">lå€¼å’Œrå€¼</h5><p>ä»€ä¹ˆæ˜¯å·¦å€¼ï¼ˆlå€¼ï¼‰ï¼Ÿ</p><p><strong>å·¦å€¼æ˜¯å…·æœ‰åœ°å€ï¼ˆåœ¨å†…å­˜ä¸­ï¼‰çš„å€¼</strong>ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å˜é‡æ˜¯ä¸€ç§å·¦å€¼ï¼ˆè¯»ä½œ ell-valueï¼‰ï¼Œå› ä¸ºæ‰€æœ‰å˜é‡éƒ½æœ‰åœ°å€ï¼›</li></ul><p>å½“æˆ‘ä»¬è¿›è¡Œèµ‹å€¼æ—¶ï¼Œ<strong>èµ‹å€¼è¿ç®—ç¬¦=çš„å·¦ä¾§å¿…é¡»æ˜¯å·¦å€¼ï¼Œä½†=å³ä¾§å¯ä»¥æ˜¯å·¦å€¼ä¹Ÿå¯ä»¥æ˜¯å³å€¼</strong>ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;  <span class="comment">// æ­£ç¡®ï¼Œå˜é‡aå¯ä½œä¸ºå·¦å€¼</span></span><br><span class="line"><span class="keyword">int</span> b = a;  <span class="comment">// æ­£ç¡®ï¼Œå˜é‡bä¹Ÿå¯ä½œä¸ºå³å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span> = <span class="number">6</span>;   <span class="comment">// å‡ºé”™ï¼Œ5ä¸æ˜¯å·¦å€¼ï¼Œæ²¡æœ‰åœ°å€</span></span><br><span class="line">a+<span class="number">1</span> = <span class="number">3</span>; <span class="comment">// é”™è¯¯ï¼Œa+1æ˜¯å³å€¼</span></span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆè¡¨è¾¾å¼<code>a</code> æ˜¯å·¦å€¼ï¼Œ<code>a+1</code> æ˜¯å·¦å€¼ï¼Ÿ</p><p>å› ä¸º<code>a+1</code>æ²¡æœ‰è‡ªå·±çš„åœ°å€ï¼ˆä¸´æ—¶è®¡ç®—çš„ç»“æœå­˜å…¥å¯„å­˜å™¨ä¸­ï¼‰ï¼Œä»æ ¹æœ¬å¦å®šäº†å®ƒæ˜¯å·¦å€¼ã€‚</p><p>é‚£ä»€ä¹ˆåˆæ˜¯å³å€¼ï¼Ÿ</p><p><strong>ä¸å·¦å€¼ç›¸åçš„ä¾¿æ˜¯å³å€¼ï¼ˆrå€¼ï¼Œå³æ²¡æœ‰å†…å­˜åœ°å€</strong>ï¼‰ï¼Œå³å€¼å¯ä»¥æ–‡å­—ã€è¡¨è¾¾å¼ç­‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>; <span class="comment">// æ­£ç¡®ï¼Œ1æ˜¯å³å€¼</span></span><br><span class="line">a = a+<span class="number">1</span>; <span class="comment">// æ­£ç¡®ï¼Œa+1æ˜¯å³å€¼</span></span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ï¼Œåœ¨èµ‹å€¼è¿ç®—æ—¶ï¼Œ<u>æ‰€æœ‰å·¦å€¼ä¼šéšå¼è½¬æ¢ä¸ºå³å€¼</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> b = a; <span class="comment">// aè¢«éšå¼è½¬æ¢ä¸ºå³å€¼</span></span><br></pre></td></tr></table></figure><h5 id="ç©ºæŒ‡é’ˆ">ç©ºæŒ‡é’ˆ</h5><p>ç©ºæŒ‡é’ˆæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡â€œ0â€æ¥ä¸ºæŒ‡é’ˆåˆ†é…ç©ºå€¼ï¼Œè¡¨ç¤ºæ²¡æœ‰æŒ‡å‘ä»»ä½•ä¸œè¥¿ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *p = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p><strong>è¿™ä¼¼ä¹å¬èµ·æ¥æ²¡ä»€ä¹ˆç”¨</strong>ï¼Ÿ</p><p>æ ¹æ®å˜é‡çš„æœ€ä½³å®è·µï¼Œå£°æ˜æ—¶æœ€å¥½è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å°†æŒ‡é’ˆè®¾ä¸ºç©ºå€¼å®Œæˆæœ€ä½³å®è·µã€‚</p><p>å¦‚ä¸‹ï¼Œæ­¤æ—¶æŒ‡é’ˆ<code>p</code>æœªè¢«åˆå§‹åŒ–ï¼ˆä¹Ÿç§°<strong>é‡æŒ‡é’ˆ</strong>ï¼‰ï¼Œå°±è¢«ä½¿ç”¨äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">int</span>* p;     <span class="comment">// æœªåˆå§‹åŒ–</span></span><br><span class="line">    std::cout&lt;&lt; *p &lt;&lt; std::endl; <span class="comment">// æœªåˆå§‹åŒ–å°±è¢«ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®æœ€ä½³å®è·µå£°æ˜åŒæ—¶è¿›è¡Œåˆå§‹åŒ–ï¼Œ<code>int* p = 0</code> ï¼Œç„¶åå†ä½¿ç”¨ã€‚</p><p><strong>ä½†ä½¿ç”¨0å€¼è¡¨ç¤ºç©ºæŒ‡é’ˆä¸å®‰å…¨ï¼Œè¯·ä½¿ç”¨nullptrå…³é”®å­—</strong>ã€‚</p><p>å› ä¸ºæ–‡å­—0ä¸æ˜¯ä»»ä½•ç±»å‹ï¼Œåœ¨å°‘æ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨æ— æ³•åˆ¤æ–­æˆ‘ä»¬æ˜¯ä½¿ç”¨ç©ºæŒ‡é’ˆè¿˜æ˜¯æ•´æ•°0ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;int* &quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;int &quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">0</span>);  <span class="comment">// è™½ç„¶æˆ‘ä»¬å¸Œæœ›ä¼ å…¥ç©ºæŒ‡é’ˆï¼Œä½†æ˜¯ç¼–è¯‘å™¨è§£é‡Šä¸ºint</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒC++11 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å…³é”®å­—nullptr ï¼Œç§°ä¸º <strong>ç©ºæŒ‡é’ˆ</strong>ã€‚</p><p>C++ ä¼šéšå¼åœ°å°† nullptr è½¬æ¢ä¸ºä»»ä½•æŒ‡é’ˆç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *p = <span class="literal">nullptr</span> ;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<strong>nullptrè¢«éšå¼è½¬æ¢ä¸ºæ•´æ•°æŒ‡é’ˆï¼Œç„¶åå°†nullptrçš„å€¼èµ‹ç»™ptr</strong>ã€‚è¿™å…·æœ‰ä½¿æ•´æ•°æŒ‡é’ˆ ptr æˆä¸ºç©ºæŒ‡é’ˆçš„æ•ˆæœã€‚</p><h5 id="voidæŒ‡é’ˆ">voidæŒ‡é’ˆ</h5><p>voidæŒ‡é’ˆï¼Œä¹Ÿç§°ä¸ºæ³›å‹æŒ‡é’ˆï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æŒ‡é’ˆï¼Œå¯ä»¥æŒ‡å‘ä»»ä½•æ•°æ®ç±»å‹çš„å¯¹è±¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> nValue;</span><br><span class="line"><span class="keyword">float</span> fValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* ptr;</span><br><span class="line">ptr = &amp;nValue;</span><br><span class="line">ptr = &amp;fValue;</span><br></pre></td></tr></table></figure><p>ä½†ä¹Ÿæœ‰ç”±äºè¿™ç§ä¸ç¡®å®šçš„åŒ…å®¹ç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨voidæŒ‡é’ˆæ—¶è½¬æ¢ä¸ºå…·ä½“çš„æŒ‡é’ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>*&gt;(voidPtr)  =  <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><strong>voidæŒ‡é’ˆæœ‰ä»€ä¹ˆç”¨</strong>ï¼Ÿ</p><p>è¿™ç§ç‰¹æ€§ä½¿å¾—voidæŒ‡é’ˆå¯ä»¥åœ¨<strong>ä¸€ä¸ªå‡½æ•°å¤„ç†å¤šç§ç±»å‹</strong>çš„æ•°æ®ã€‚</p><p>ä»¥ä¸‹å‡½æ•°å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨â€œæ³›å‹æŒ‡é’ˆâ€ä½œä¸ºå‡½æ•°å‚æ•°ï¼ˆC++20å‰æ˜¯ä¸å…è®¸ä½¿ç”¨autoç±»å‹çš„å‚æ•°ï¼‰ï¼Œå»å¤„ç†å¤šç§ç±»å‹çš„å®å‚ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title">Type</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">tInt,</span><br><span class="line">    tFloat,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printValue</span><span class="params">(<span class="keyword">void</span>* ptr, Type type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (type)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> Type::tInt:</span><br><span class="line">            std::cout &lt;&lt; *<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>*&gt;(ptr) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> Type::tFloat:</span><br><span class="line">            std::cout &lt;&lt; *<span class="keyword">static_cast</span>&lt;<span class="keyword">float</span>*&gt;(ptr) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">assert</span>(<span class="literal">false</span> &amp;&amp; <span class="string">&quot;type not found&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> nValue&#123; <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="keyword">float</span> fValue&#123; <span class="number">7.5f</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printValue</span>(&amp;nValue, Type::tInt);</span><br><span class="line">    <span class="built_in">printValue</span>(&amp;fValue, Type::tFloat);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†ä¸€æ–¹é¢å®ƒçœ‹èµ·æ¥ä¹Ÿå¾ˆå‚»ï¼š</p><ol><li><p>å› ä¸ºæˆ‘ä»¬å¾€å¾€æœ‰æ›´å¥½çš„åŠæ³•æ›¿ä»£voidæŒ‡é’ˆï¼Œæ¯”å¦‚æ¨¡æ¿ã€‚</p><p>ç›¸æ¯”å‰é¢ä»£ç æ›´åŠ æ¸…æ™°ï¼Œç®€æ´ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printValue</span><span class="params">(T ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; ptr &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>voidæŒ‡é’ˆä¹Ÿå¹¶ä¸å®‰å…¨ï¼Œå®ƒæ²¡æœ‰ç±»å‹æ£€æŸ¥</p><p>æ²¡æœ‰ç¼–è¯‘å™¨è‡ªåŠ¨çš„ç±»å‹æ£€æŸ¥ï¼Œä½ åˆç²—å¿ƒå†™ä½œäº†ä¼ å…¥çš„å‚æ•°ç±»å‹ï¼Œè¿™æ˜¾ç„¶å¾ˆç³Ÿç³•ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> fValue2&#123; <span class="number">5.4</span> &#125;;</span><br><span class="line"><span class="built_in">printValue</span>(&amp;fValue2, Type::tInt);</span><br></pre></td></tr></table></figure></li></ol><p><strong>æœ€ä½³å®è·µï¼šå°½é‡å‡å°‘ä½¿ç”¨voidæŒ‡é’ˆï¼Œé™¤éçœŸçš„æ‰¾ä¸åˆ°ç¬¬äºŒä¸ªæ›´å¥½çš„åŠæ³•æ¥è¿›è¡Œæ›¿ä»£</strong>ã€‚</p><h5 id="ç®­å¤´è¿ç®—ç¬¦å†æ€è€ƒ">ç®­å¤´è¿ç®—ç¬¦å†æ€è€ƒ</h5><p>å¯¹äºæ™®é€šç±»/ç»“æ„ä½“çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆå‘˜é€‰æ‹©è¿ç®—ç¬¦<code>.</code>é€‰æ‹©æˆå‘˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">double</span> weight;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Person person;</span><br><span class="line">person.age = <span class="number">5</span>;</span><br></pre></td></tr></table></figure><p>ä½†æˆ‘ä»¬ä¹Ÿè¢«å‘ŠçŸ¥ï¼Œå¦‚æœæ˜¯ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼Œè¯·ä½¿ç”¨ç®­å¤´<code>-&gt;</code>è¿ç®—ç¬¦ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person* p_person = &amp;person ;</span><br><span class="line">p_person-&gt;age = <span class="number">6</span>;</span><br></pre></td></tr></table></figure><p>ä½†è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¸ç¦æƒ³èµ·ä»¥å‰å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>* p_a = &amp;a;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é—´æ¥æ“ä½œç¬¦<code>*</code> è®©æˆ‘ä»¬è·å–äº†æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡ï¼Œç„¶åè¿›è¡Œæ“ä½œï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*p_a = <span class="number">11</span>;</span><br></pre></td></tr></table></figure><p><strong>é‚£ä¹ˆæˆ‘ä»¬ç”¨<code>*</code> è·å–<code>p_person</code> æŒ‡å‘çš„ç»“æ„ä½“å¯¹è±¡ï¼Œä¸å°±å¯ä»¥åƒæ™®é€šç»“æ„ä½“å¯¹è±¡ä¸€æ ·ä½¿ç”¨æˆå‘˜è¿ç®—ç¬¦<code>.</code>å—</strong>ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(*p_person).age = <span class="number">6</span>;  <span class="comment">// ç­‰ä»·äºï¼šperson.age = 6;</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šçš„ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person* p_person2 = <span class="keyword">new</span> <span class="built_in">Person</span>();</span><br><span class="line">(*p_person2).age = <span class="number">7</span>;</span><br></pre></td></tr></table></figure><h4 id="2-1-3-æŒ‡é’ˆå’Œæ•°ç»„">2.1.3 æŒ‡é’ˆå’Œæ•°ç»„</h4><p>æŒ‡é’ˆå’Œæ•°ç»„å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æœ‰æ—¶å¾ˆå…·æœ‰è¿·æƒ‘æ€§ï¼Œç‰¹åˆ«æ˜¯<u>å¾ˆå¤šæ—¶å€™ç¼–è¯‘å™¨ä¼šå°†æ•°ç»„é€€åŒ–æˆæŒ‡é’ˆä½¿ç”¨</u>ã€‚ä»¥è‡³äºæœ‰äº›äººé”™è¯¯åœ°å°†æ•°ç»„ç­‰ä»·äºæŒ‡é’ˆã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥è¿›è¡Œä»”ç»†çš„åŒºåˆ†å’Œæ€»ç»“ã€‚</p><p><strong>æŒ‡é’ˆåŠ å‡æ³•</strong></p><p>ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹æŒ‡é’ˆåŠ å‡æ³•æœ‰åˆ©äºæ›´å¥½åœ°ç»§ç»­å¾€ä¸‹åˆ†æã€‚</p><p>C++ è¯­è¨€å…è®¸å¯¹æŒ‡é’ˆæ‰§è¡Œæ•´æ•°åŠ å‡è¿ç®—ï¼š</p><ul><li>å¦‚æœ<code>ptr</code>æŒ‡å‘ä¸€ä¸ªæ•´æ•°ï¼Œ<code>ptr + 1</code>åˆ™ä¸º <code>ptr</code> ä¹‹åå†…å­˜ä¸­ä¸‹ä¸€ä¸ªæ•´æ•°çš„åœ°å€ï¼›<code>ptr - 1</code>æ˜¯å‰ä¸€ä¸ªæ•´æ•°çš„åœ°å€<code>ptr</code>ã€‚</li></ul><p>æ¢å¥è¯è¯´ï¼Œåœ¨è®¡ç®—æŒ‡é’ˆç®—æœ¯è¡¨è¾¾å¼çš„ç»“æœæ—¶ï¼Œ<strong>ç¼–è¯‘å™¨æ€»æ˜¯å°†æ•´æ•°æ“ä½œæ•°ä¹˜ä»¥æ‰€æŒ‡å‘å¯¹è±¡çš„å¤§å°</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value&#123; <span class="number">7</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span>* ptr&#123; &amp;value &#125;;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; ptr &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; ptr+<span class="number">1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; ptr+<span class="number">2</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; ptr+<span class="number">3</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x7ffd05328dfc</span><br><span class="line">0x7ffd05328e00</span><br><span class="line">0x7ffd05328e04</span><br><span class="line">0x7ffd05328e08</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ¯ä¸ªåœ°å€ç›¸å·®4å­—èŠ‚ï¼ˆä¸€ä¸ªintå¤§å°ï¼‰ï¼Œæ¯”å¦‚ï¼š0x7ffd05328e00-0x7ffd05328dfc=4ã€‚è¿™é‡Œçš„åœ°å€æ˜¯è™šæ‹Ÿåœ°å€ï¼Œ4å°±è¡¨ç¤º4ä¸ªå­—èŠ‚ã€‚</p><h5 id="æŒ‡é’ˆå’Œæ•°ç»„çš„åŒºåˆ«ğŸŒŸ">æŒ‡é’ˆå’Œæ•°ç»„çš„åŒºåˆ«ğŸŒŸ</h5><blockquote><p>â€œä¸‡ç‰©çš†ä¸ºæŒ‡é’ˆï¼Œæ•°ç»„é¦–å½“å…¶å†²â€ã€‚</p></blockquote><p>å£°æ˜ä¸€ä¸ªï¼ˆé™æ€ï¼‰æ•°ç»„å¾ˆç®€å•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr1[<span class="number">3</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> new_arr[<span class="number">3</span>] = &#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">arr1 = new_arr;  <span class="comment">// errorï¼Œæ•°ç»„æ— æ³•é‡æ–°åˆ†é…æŒ‡å‘æ–°ï¼Œå¯ä»¥ç†è§£ä¸ºæ­¤æ—¶æ•°ç»„æ˜¯å¸¸é‡æŒ‡é’ˆï¼ˆåŒºåˆ†æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼‰</span></span><br></pre></td></tr></table></figure><p>ä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ›´å¸Œæœ›ç”³è¯·ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼ˆæ¯”å¦‚å£°æ˜æ—¶å¹¶ä¸ç¡®å®šæ•°ç»„çš„å†…å®¹ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]&#123;<span class="number">1</span>,<span class="number">2</span>&#125;; <span class="comment">// okï¼ŒæŒ‡é’ˆå¯ä»¥åˆ†é…æ–°å†…å­˜åŒºåŸŸ</span></span><br></pre></td></tr></table></figure><p><code>new int[3]&#123;1,2,3&#125;</code> è¿”å›äº†ä¸€ä¸ª<code>int*</code> æŒ‡é’ˆï¼Œå­˜å‚¨åˆ†é…çš„æ•°ç»„ç©ºé—´é¦–åœ°å€ï¼Œç„¶åèµ‹å€¼ç»™<code>arr2</code> ã€‚</p><p>ä½“ä¼šä¸€ä¸‹ä¸‹é¢åœºæ™¯ä¸‹çš„<code>arr2</code> å’Œ <code>arr1</code> è¡¨ç°ä½•å…¶åƒï¼š</p><ul><li><p><strong>ä½œä¸ºè¡¨è¾¾å¼ä½¿ç”¨æ—¶</strong></p><p>æ­¤æ—¶æ•°ç»„è¡¨ç°çš„å°±æ˜¯æŒ‡é’ˆï¼Œå­˜å‚¨äº†æ•°ç»„å…ƒç´ é¦–åœ°å€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr1[<span class="number">3</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">int</span>* arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.æ‰“å°æ•°ç»„/æŒ‡é’ˆ</span></span><br><span class="line">cout&lt;&lt;arr1&lt;&lt;endl; <span class="comment">// 0x7fff61b6b7d0ï¼Œæ•°ç»„é¦–å…ƒç´ åœ°å€</span></span><br><span class="line">cout&lt;&lt;arr2&lt;&lt;endl; <span class="comment">// 0x97b010ï¼Œæ•°ç»„é¦–å…ƒç´ åœ°å€ï¼Œå› ä¸ºåŠ¨æ€æ•°ç»„åˆ†é…åœ¨å †ä¸Šä¸åœ¨æ ˆä¸Šï¼Œåœ°å€ç©ºé—´ä½æ•°æ˜¾å¾—æœ‰äº›ä¸åŒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.æ‰“å°æ•°ç»„/æŒ‡é’ˆé¦–å…ƒç´ </span></span><br><span class="line">cout&lt;&lt;*arr1&lt;&lt;endl; <span class="comment">// 1</span></span><br><span class="line">cout&lt;&lt;*arr2&lt;&lt;endl; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.æ‰“å°ç¬¬äºŒä¸ªå…ƒç´ </span></span><br><span class="line">cout&lt;&lt;*(arr1+<span class="number">1</span>)&lt;&lt;endl; <span class="comment">// 2</span></span><br><span class="line">cout&lt;&lt;*(arr2+<span class="number">1</span>)&lt;&lt;endl; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º<strong>C++ä¸­å¦‚æœæŠŠæ•°ç»„ä½œä¸ºè¡¨è¾¾å¼ä½¿ç”¨ï¼Œä¼šè¡°å‡ä¸ºä¸€ä¸ªæŒ‡é’ˆ</strong>ã€‚</p></li><li><p><strong>æ•°ç»„ä½œä¸ºå‚æ•°æ—¶</strong></p><p>å°†æ•°ç»„ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œæ•°ç»„åœ¨å‡½æ•°å†…éƒ¨è¡¨ç°å¾—å·²ç»æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printSize</span><span class="params">(<span class="keyword">int</span> arr[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;in printArray: &quot;</span> &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(arr) &lt;&lt; endl; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> array[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    cout &lt;&lt;<span class="string">&quot;in main: &quot;</span> &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(array) &lt;&lt; endl; </span><br><span class="line">    <span class="built_in">printSize</span>(array); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">in main: 20</span><br><span class="line">in printArray: 8</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µæ˜¯å› ä¸ºï¼Œåœ¨C++ä¸­å¤åˆ¶æ•°ç»„ä»£ä»·å¯èƒ½ä¼šæ˜‚è´µã€‚å› æ­¤<strong>å°†æ•°ç»„ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œä¸ä¼šå¤åˆ¶æ•°ç»„ï¼Œè€Œæ˜¯å›ºå®šæ•°ç»„è¡°å‡ä¸ºæŒ‡é’ˆï¼Œç„¶åå°†æŒ‡é’ˆä¼ é€’ç»™å‡½æ•°</strong>ã€‚</p><ul><li>ä¸Šè¿°è¿°ä»£ç ä¸­ï¼Œæ•°ç»„<code>array</code>ç±»å‹æ˜¯<code>int[5]</code> ï¼Œä½œä¸ºå®å‚æ—¶ï¼Œé€€åŒ–ä¸ºæŒ‡é’ˆ<code>int *</code> ï¼Œä¿å­˜çš„æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€å³<code>&amp;array[0]</code>ï¼Œç„¶åå¤åˆ¶ä¸€ä»½ç»™å½¢å‚<code>arr</code>ã€‚</li><li>é¢˜å¤–è¯ï¼Œå½“æ•´ä¸ªç»“æ„æˆ–ç±»ä¼ é€’ç»™å‡½æ•°æ—¶ä¸ä¼šè¡°å‡ã€‚</li></ul><p>ä¹Ÿæ­£æ˜¯å› ä¸º<strong>C++ ä½¿ç”¨æ•°ç»„è¯­æ³• [] ä¼šå°†æ•°ç»„è¡°å‡ä¸ºæŒ‡é’ˆ</strong>ã€‚è¿™æ„å‘³ç€ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°å£°æ˜æ˜¯ç›¸åŒçš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printSize</span><span class="params">(<span class="keyword">int</span> array[])</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">printSize</span><span class="params">(<span class="keyword">int</span>* array)</span></span>; <span class="comment">// æœ€ä½³å®è·µï¼šæŒ‡é’ˆè¯­æ³• (*) ä¼˜äºæ•°ç»„è¯­æ³• ([])ï¼Œå®ƒæ›´è¡¨æ˜å®é™…æ¥å—çš„å‚æ•°ç±»å‹ï¼ŒC++ä¹Ÿä¸ç”¨éšå¼è½¬æ¢</span></span><br></pre></td></tr></table></figure></li></ul><p>æ‰€ä»¥è¯´ï¼Œæ•°ç»„â‰ æŒ‡é’ˆï¼Œåªæ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹é€€åŒ–æˆäº†æŒ‡é’ˆè€Œå·²ï¼Œæ¯”å¦‚ä½œä¸ºè¡¨è¾¾å¼æˆ–è€…å‡½æ•°å‚æ•°æ—¶ã€‚</p><blockquote><p><strong>æ›´å‡†ç¡®æ¥è¯´æ˜¯é€€åŒ–æˆäº†å¸¸é‡æŒ‡é’ˆï¼å› ä¸ºæ•°ç»„æœ¬èº«é»˜è®¤æ˜¯å¸¸é‡æ•°ç»„ï¼Œæ— æ³•ä½œä¸ºå·¦å€¼</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> arr[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr = <span class="number">0x778555622</span>; <span class="comment">// errorï¼Œä½œä¸ºå·¦å€¼</span></span><br><span class="line">    new_arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    arr = new_arr;   v <span class="comment">// errorï¼Œä½œä¸ºå·¦å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>é¢˜å¤–è¯ï¼Œæ­£ç”±äºè¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬å¾€å¾€ä¸å¾—ä¸ä¼ é€’æ•°ç»„å‚æ•°æ—¶<u>è¿˜ä¼ é€’æ•°ç»„é•¿åº¦</u>ã€‚å› ä¸ºä½ æ— æ³•æ ¹æ®æŒ‡é’ˆè·å–åˆ°å…¶é•¿åº¦ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span> arr[],<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len; i++)</span><br><span class="line">        cout&lt;&lt;arr[i]&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> len = <span class="built_in"><span class="keyword">sizeof</span></span> (arr) / <span class="built_in"><span class="keyword">sizeof</span></span> (arr[<span class="number">0</span>]);</span><br><span class="line">   <span class="built_in">printArray</span>(array,len); </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œæˆ‘ä»¬è¿›è¡Œæ›´è¯¦ç»†çš„æ€»ç»“ï¼Œæ•°ç»„å’ŒæŒ‡é’ˆçš„åŒºåˆ«</strong>ã€‚</p><p>æ•°ç»„å’ŒæŒ‡é’ˆå…³é”®åŒºåˆ«åœ¨äºï¼šç±»å‹ã€æ˜¯ç¬¦å·ä¸æ˜¯å˜é‡ã€sizeofç­‰ã€‚</p><ol><li><p><code>sizeof</code> ï¼š<code>sizeof(æ•°ç»„)</code> æ‰“å°çš„æ˜¯æ•°ç»„çš„é•¿åº¦ï¼ˆå®¹é‡<code>*</code>å­˜å‚¨ç±»å‹æ‰€å å­—èŠ‚æ•°ï¼‰ï¼Œä½†æ˜¯<code>sizeof(æŒ‡é’ˆ)</code> æ‰“å°çš„æ˜¯æŒ‡é’ˆé•¿åº¦ï¼Œä¸€èˆ¬æ˜¯4å­—èŠ‚æˆ–8å­—èŠ‚ï¼›</p></li><li><p><strong>ç±»å‹</strong>ï¼šæ•°ç»„ç±»å‹æ˜¯ <code>type[LEN]</code> ï¼ŒæŒ‡é’ˆç±»å‹æ˜¯ <code>type*</code> ï¼›</p></li><li><p><strong>å®šä¹‰</strong>ï¼š<strong>æ•°ç»„æ˜¯ä¸€ä¸ªç¬¦å·</strong>ï¼Œæ²¡æœ‰è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼›<strong>æŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡</strong>ï¼Œæœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ï¼Œå­˜å‚¨å…¶å®ƒå˜é‡çš„åœ°å€ã€‚</p><p>å¯ä»¥ä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">array = <span class="literal">NULL</span>; <span class="comment">// æ­£ç¡®ï¼Œarrayæ˜¯æŒ‡é’ˆï¼Œå­˜å‚¨æ˜¯æ•°ç»„é¦–åœ°å€</span></span><br></pre></td></tr></table></figure><p>ä½†ä½ å°è¯•ä¿®æ”¹æ•°ç»„å†…å®¹æ˜¯ä¼šå‡ºé”™çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> array[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">array = <span class="literal">NULL</span>;  <span class="comment">// ç¼–è¯‘é”™è¯¯ï¼Œarrayæ˜¯ç¬¦å·ï¼Œä¸æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„å·¦å€¼</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå¦‚æœä½ å°è¯•æ‰“å°<code>array</code>çš„åœ°å€ï¼Œä¹Ÿä¼šå‘ç°å®ƒå¹¶æ²¡æœ‰å±äºè‡ªå·±çš„åœ°å€ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> array[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">cout&lt;&lt;array;       <span class="comment">// 0x7ffffabf61f0ï¼Œarray[0]çš„åœ°å€</span></span><br><span class="line">cout&lt;&lt;&amp;array;      <span class="comment">// 0x7ffffabf61f0ï¼Œæ²¡æœ‰æ•°ç»„è‡ªå·±çš„åœ°å€ï¼Œè€Œæ˜¯array[0]çš„åœ°å€</span></span><br></pre></td></tr></table></figure><p><code>&amp;array</code> è¿”å›ä¸€ä¸ªæŒ‡å‘æ•´ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆä¹ŸæŒ‡å‘æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåªæ˜¯ç±»å‹ä¿¡æ¯ä¸åŒï¼ˆç±»å‹<code>&amp;array</code> æ˜¯ <code>int(*)[5]</code>ï¼‰ã€‚</p><p>ä½†æ˜¯æ¯ä¸ªæŒ‡é’ˆéƒ½æœ‰è‡ªå·±çš„åœ°å€ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">cout&lt;&lt;array;       <span class="comment">// 0x7f3010ï¼Œarray[0]çš„åœ°å€</span></span><br><span class="line">cout&lt;&lt;&amp;array;      <span class="comment">// 0x7ffcff233b48ï¼ŒæŒ‡é’ˆæœ¬èº«çš„åœ°å€</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®æ”¹</strong>ã€‚æ•°ç»„æ— æ³•è¢«é‡æ–°åˆå§‹åŒ–/åˆ†é…ï¼ŒæŒ‡é’ˆï¼ˆåŠ¨æ€æ•°ç»„ï¼‰å¯ä»¥ã€‚</p></li></ol><h5 id="å†ç†è§£">[]å†ç†è§£</h5><p>å‰é¢æˆ‘ä»¬æåˆ°ï¼Œ<u>C++ ä½¿ç”¨æ•°ç»„è¯­æ³• <code>[]</code> ä¼šå°†æ•°ç»„è¡°å‡ä¸ºæŒ‡é’ˆ<code>*</code></u> ï¼Œè®©æˆ‘ä»¬æ›´å¥½åœ°è®¿é—®æ•°ç»„å…ƒç´ ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr1[<span class="number">3</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line">arr[<span class="number">1</span>]; <span class="comment">// ç­‰ä»·äº *(arr+1)</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°äº‹å®è¯æ˜ï¼Œå½“ç¼–è¯‘å™¨çœ‹åˆ°ä¸‹æ ‡è¿ç®—ç¬¦ï¼ˆ[]ï¼‰æ—¶ï¼Œå®ƒå®é™…ä¸Šå°†å…¶è½¬æ¢ä¸ºæŒ‡é’ˆåŠ æ³•å’Œé—´æ¥å¯»å€ã€‚</p><p>ä¸ºäº†æ›´å¥½è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè¯·çœ‹ä¸‹é¢ä»£ç ï¼šè¾“å‡ºä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> arr[]&#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="number">2</span>[arr] &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><p>ä¸‹æ ‡è¿ç®—ç¬¦ ( <code>[]</code>) ç­‰åŒäºåŠ æ³•å’Œé—´æ¥æ³•ï¼Œæ“ä½œæ•°å¯ä»¥äº¤æ¢ï¼Œå› æ­¤å®ƒç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*(<span class="number">2</span>+arr)</span><br></pre></td></tr></table></figure><h5 id="cout-å’Œæ•°ç»„">cout å’Œæ•°ç»„</h5><p>ä¸çŸ¥é“è¯»è€…æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…ï¼Œcoutä¼šè‡ªåŠ¨éå†charæ•°ç»„æ‰“å°æ‰€æœ‰å­—ç¬¦ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> c_arr[] = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">cout&lt;&lt;c_arr&lt;&lt;endl;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br></pre></td></tr></table></figure><p>ç†è®ºä¸Šï¼Œæ­¤æ—¶è¾“å‡ºåº”è¯¥æ˜¯æ•°ç»„é¦–é€‰ç»„<code>h</code>çš„é¦–åœ°å€ã€‚å°±åƒä¸‹é¢çš„intæ•°ç»„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i_arr[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">cout&lt;&lt;i_arr&lt;&lt;endl;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7fff74ecdc70</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º<code>std::cout</code>ä¸Šçš„<code>&lt;&lt;</code>è¿ç®—ç¬¦å·²é‡è½½ï¼Œ å®é™…ä¸Šæ˜¯å‡ ä¸ªä¸åŒçš„å‡½æ•°ï¼Œéƒ½å‘½åä¸º<code>operator&lt;&lt;</code>ã€‚å®ƒçš„è¡Œä¸ºå–å†³äºæ“ä½œæ•°ç±»å‹ï¼Œç¼–è¯‘å™¨ç”±æ­¤å†³å®šè¦è°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚</p><p>å¦‚æœç»™å®ƒä¸€ä¸ª<code>char*</code>æˆ–<code>const char*</code>ï¼Œå®ƒä¼šæŠŠæ“ä½œæ•°å½“ä½œä¸€ä¸ªæŒ‡å‘Cæ ·å¼å­—ç¬¦ä¸²(ç¬¬ä¸€ä¸ªå­—ç¬¦)çš„æŒ‡é’ˆï¼Œå¹¶é¡ºåºç§»åŠ¨è¾“å‡ºå‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚</p><p><strong>ä¸Šé¢99% çš„æƒ…å†µä¸‹éƒ½å¾ˆæ£’ï¼Œä½†å®ƒä¾æ—§å¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœ</strong>ã€‚</p><p>ä¸‹é¢ä»£ç å°è¯•æ‰“å°ä¸€ä¸ªcharç±»å‹å­—ç¬¦çš„åœ°å€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c&#123; <span class="string">&#x27;Q&#x27;</span> &#125;;</span><br><span class="line">    std::cout &lt;&lt; &amp;c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Qâ• â• â• â• â•œâ•¡4;Â¿â– A</span><br></pre></td></tr></table></figure><p>å¥½å§ï¼Œè¿™ç§æƒ…å†µä¸ä¸€å®šä¼šå‘ç”Ÿï¼Œç¼–è¯‘å™¨å¯èƒ½å·²ç»ç»™æˆ‘ä»¬åšäº†ä¼˜åŒ–ã€‚ä½†æ˜¯å¦‚æœå‘ç”Ÿäº†ï¼Œä½ éœ€è¦çŸ¥é“ä¸ºä»€ä¹ˆï¼š</p><ul><li><code>&amp;c</code> å…·æœ‰ <code>char*</code> ç±»å‹ï¼Œå› æ­¤ <code>std::cout</code> å°è¯•å°†å…¶æ‰“å°ä¸ºå­—ç¬¦ä¸²ï¼Œç›´åˆ°é‡åˆ°<code>\0</code>;</li><li>ä½†å¾ˆä¸å¹¸åœ°ä¸‹ä¸€ä¸ªåœ°å€æ˜¯åƒåœ¾å€¼ï¼Œç›´åˆ°å®ƒç»ˆæ­¢å‰æ‰“å°äº†ä¸€å †åƒåœ¾å­—ç¬¦ä¸²ã€‚</li></ul><p>è¿™ä¸ªä¾‹å­åœ¨ç°å®æƒ…å†µä¸å¤ªå¯èƒ½å‘ç”Ÿï¼Œä½†å¯¹æˆ‘ä»¬ç†è§£<code>std::cout</code> å¦‚ä½•å·¥ä½œå¾ˆæœ‰å¸®åŠ©ã€‚</p><h4 id="2-1-4-æŒ‡é’ˆå’Œconst">2.1.4 æŒ‡é’ˆå’Œconst</h4><p>æŒ‡é’ˆå’Œconstçš„ç»„åˆé€šå¸¸è®©äººæ„Ÿè§‰å¾ˆè¿·æƒ‘ï¼Œå›½å†…çš„ç›¸å…³è€ƒè¯•ä¹Ÿæ²¡å°‘æŠ˜ç£¨è¿‡ä½œè€…ã€‚æœ¬èŠ‚ï¼Œä½œè€…å°†å°½é‡å°è¯•ç”¨æ¸…æ™°ã€ç®€æ´çš„è¯­è¨€è¯´æ˜ã€‚</p><h5 id="æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆ">æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆ</h5><p>ä¸€ä¸ª<strong>æŒ‡å‘å¸¸é‡å€¼çš„æŒ‡é’ˆ</strong>æ˜¯æŒ‡å‘å¸¸é‡å€¼çš„ï¼ˆéå¸¸é‡ï¼‰æŒ‡é’ˆï¼Œå®ƒé€šå¸¸è¢«å¦‚æ­¤å£°æ˜ï¼ˆconstä½äº<code>*</code>å·¦ä¾§å³å¯ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> value = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// ä¸‹é¢ä¸¤ç§å£°æ˜æ–¹å¼ç­‰åŒ</span></span><br><span class="line"><span class="comment">// åªèƒ½ä½¿ç”¨å³å€¼è¿›è¡Œåˆå§‹åŒ–/èµ‹å€¼</span></span><br><span class="line"><span class="comment">// å¯ä»¥æŒ‡å‘éå¸¸é‡å˜é‡ï¼Œä½†é€šè¿‡æŒ‡é’ˆè®¿é—®æ—¶è¯¥å˜é‡è¢«è§†ä¸ºå¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* p_value = &amp;value;</span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> * p_value = &amp;value;</span><br></pre></td></tr></table></figure><p>â€œæŒ‡å‘å¸¸é‡å€¼çš„æŒ‡é’ˆâ€ï¼Œè¿™é‡Œå¼ºè°ƒäº†ä¸¤ä¸ªè¦ç´ ï¼š</p><ol><li><strong>æŒ‡é’ˆæ˜¯éconstçš„</strong>ï¼Œæ‰€ä»¥å®ƒæœ¬èº«å¯ä»¥è¢«ä¿®æ”¹ï¼ˆå­˜å‚¨çš„åœ°å€ï¼‰ï¼›</li><li><strong>æŒ‡é’ˆæŒ‡å‘çš„å˜é‡æ˜¯constçš„</strong>ï¼Œå®ƒä¸èƒ½é€šè¿‡æŒ‡é’ˆè¢«ä¿®æ”¹ï¼ˆå­˜å‚¨çš„åœ°å€å¯¹åº”çš„å†…å­˜åŒºåŸŸï¼Œå³å˜é‡ï¼‰ã€‚</li></ol><p>å¬èµ·æ¥æœ‰ç‚¹ç»•ï¼Œä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼š</p><ul><li><p><strong>æŒ‡é’ˆæŒ‡å‘çš„å˜é‡æ— æ³•è¢«ä¿®æ”¹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> value = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* p_value = &amp;value; <span class="comment">// æŒ‡å‘â€œconst intâ€</span></span><br><span class="line"><span class="comment">// å°è¯•ä¿®æ”¹å˜é‡valueçš„å€¼</span></span><br><span class="line">*p_value = <span class="number">6</span>; <span class="comment">// éæ³•</span></span><br></pre></td></tr></table></figure><p>æ›´æ·±åˆ»åœ°ç†è§£ï¼š<strong>æŒ‡é’ˆæŒ‡å‘æ•´ä¸ªå†…å­˜åŒºåŸŸéƒ½ä¸èƒ½è¢«ä¿®æ”¹</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* p_array = <span class="keyword">new</span> <span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">cout&lt;&lt;*(p_array+<span class="number">1</span>)&lt;&lt;endl; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><p><code>p_array</code>æŒ‡å‘çš„å¥½åƒåªæ˜¯æ˜¯é¦–å…ƒç´ ï¼ˆä¿å­˜çš„æ˜¯é¦–å…ƒç´ åœ°å€ï¼‰ï¼Œä½†å…¶å®åº”è¯¥ç†è§£ä¸ºï¼ŒæŒ‡å‘çš„æ˜¯åˆ†é…ç»™æ•°ç»„çš„æ•´ä¸ªè¿ç»­å†…å­˜åŒºåŸŸã€‚</p><p>å¦‚ä¸‹ï¼Œ<code>p_array</code>æ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸä»»æ„æ•°ç»„å…ƒç´ éƒ½ä¸èƒ½è¢«ä¿®æ”¹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*(p_array+<span class="number">1</span>) = <span class="number">0</span>; <span class="comment">// ç­‰ä»·äºï¼šp_array[1] = 0;</span></span><br></pre></td></tr></table></figure><p>å‡ºé”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: assignment of read-only location â€˜*(p_array + 4u)â€™</span><br></pre></td></tr></table></figure><p>è¿™ç§åšæ³•ä¹Ÿä½¿å¾—æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°å®šä¹‰<u>æŒ‡å‘å¸¸é‡çš„æ•°ç»„</u>ã€‚</p></li><li><p><strong>æŒ‡é’ˆæœ¬èº«å¯ä»¥è¢«ä¿®æ”¹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> value = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* p_value = &amp;value; <span class="comment">// æŒ‡å‘â€œconst intâ€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è¯•ä¿®æ”¹æŒ‡é’ˆçš„å€¼</span></span><br><span class="line"><span class="keyword">int</span> value1 = <span class="number">6</span>;</span><br><span class="line">p_value = &amp;value1; <span class="comment">// åˆæ³•</span></span><br></pre></td></tr></table></figure></li></ul><p>é‚£æ€ä¹ˆè®©æŒ‡é’ˆæœ¬èº«å¯ä»¥æ— æ³•è¢«ä¿®æ”¹ï¼Ÿ</p><h5 id="å¸¸é‡æŒ‡é’ˆ">å¸¸é‡æŒ‡é’ˆ</h5><p>å¸¸é‡æŒ‡é’ˆï¼Œå¯ä»¥ä½¿å¾—æŒ‡é’ˆæœ¬èº«æ— æ³•è¢«ä¿®æ”¹ï¼Œå³æŒ‡é’ˆå¯¹åº”å†…å­˜åŒºåŸŸå­˜å‚¨çš„å€¼ï¼ˆé€šå¸¸æ˜¯å­˜å‚¨ä¸€ä¸ªåœ°å€ï¼‰ã€‚</p><p>å®ƒé€šå¸¸è¢«å¦‚æ­¤å£°æ˜ï¼ˆconstä½äº<code>*</code>å³ä¾§ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> value = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// å£°æ˜å¸¸é‡æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// åªèƒ½ä½¿ç”¨å³å€¼è¿›è¡Œåˆå§‹åŒ–/èµ‹å€¼</span></span><br><span class="line"><span class="keyword">int</span>* <span class="keyword">const</span> p_value = &amp;value;</span><br></pre></td></tr></table></figure><p>â€œå¸¸é‡æŒ‡é’ˆâ€ï¼ŒåŒæ ·åŒ…å«äº†ä¸¤ä¸ªè¦ç´ ï¼š</p><ol><li><strong>æŒ‡é’ˆæ˜¯constçš„</strong>ï¼Œæ‰€ä»¥å®ƒæœ¬èº«ä¸å¯ä»¥è¢«ä¿®æ”¹ï¼ˆå­˜å‚¨çš„åœ°å€ï¼‰ï¼›</li><li><strong>æŒ‡é’ˆæŒ‡å‘çš„å˜é‡æ˜¯éconstçš„</strong>ï¼Œå®ƒèƒ½é€šè¿‡æŒ‡é’ˆè¢«ä¿®æ”¹ã€‚</li></ol><p>ä¾æ—§æ˜¯ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> value1 = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* p_value1 = &amp;value1; <span class="comment">// æŒ‡å‘â€œintâ€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è¯•ä¿®æ”¹æŒ‡å‘çš„å˜é‡</span></span><br><span class="line">*p_value1 = <span class="number">7</span>; <span class="comment">// åˆæ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è¯•ä¿®æ”¹æŒ‡é’ˆçš„å€¼</span></span><br><span class="line"><span class="keyword">int</span> value2 = <span class="number">6</span>;</span><br><span class="line">p_value1 = &amp;value2; <span class="comment">// éæ³•</span></span><br></pre></td></tr></table></figure><p>å¥½å§ï¼Œæˆ–è®¸æœ‰äº›å˜æ€èˆ¬çš„éœ€æ±‚ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å€¼å’ŒæŒ‡é’ˆéƒ½ä¸å¯ä»¥è¢«ä¿®æ”¹ã€‚è¯·çœ‹ä¸‹ä¸ªå°èŠ‚ã€‚</p><h5 id="æŒ‡å‘å¸¸é‡çš„å¸¸é‡æŒ‡é’ˆ">æŒ‡å‘å¸¸é‡çš„å¸¸é‡æŒ‡é’ˆ</h5><p>æœ€åï¼Œå¯ä»¥é€šè¿‡åœ¨ç±»å‹ä¹‹å‰å’Œå˜é‡åä¹‹å‰ä½¿ç”¨constå…³é”®å­—ï¼Œæ¥å£°æ˜<u>æŒ‡å‘const å€¼çš„ const æŒ‡é’ˆ</u>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> value =  <span class="number">5</span> ;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* <span class="keyword">const</span> ptr = &amp;value ;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä½ æ‰€éœ€è¦çš„ï¼ŒæŒ‡é’ˆå’Œå…¶æŒ‡å‘çš„å˜é‡éƒ½æ— æ³•è¢«ä¿®æ”¹ã€‚</p><h5 id="æœ€ä½³å®è·µ-2">æœ€ä½³å®è·µ</h5><p>æˆ–è®¸ä½ æœ‰äº›ç–‘é—®ï¼šconstå¯ä»¥è®©æŒ‡é’ˆæˆ–å˜é‡ä¸è¢«ä¿®æ”¹ï¼Œå¾ˆå¤šæ—¶å€™å¯ä»¥ä¿æŒç¨‹åºçš„ä¸¥è°¨ã€å¥å£®æ€§ã€‚è¿™çœ‹èµ·æ¥ç¡®å®æœ‰äº›ä¼˜ç‚¹ï¼Œä½†å®ƒçœŸçš„é‚£ä¹ˆé‡è¦å—ï¼Ÿ</p><p>äº‹å®ä¸Šï¼Œconstéå¸¸é‡è¦&amp;æœ‰ç”¨ï¼</p><ul><li>å¤šä½å¤§å¸ˆï¼Œæ¯”å¦‚å€™æ·å°±æ›¾è¯´è¿‡ï¼šâ€œç¨‹åºå†™å¾—æ˜¯å¦å¤§æ°”ä¸¥è°¨ï¼Œå¤§èƒ†ä½¿ç”¨constå°±æ˜¯ç›´è§‚çš„è¯„ä»·æŒ‡æ ‡â€ã€‚</li><li>æ‰€ä»¥ï¼Œ<u>å¤§èƒ†çš„åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨constå§</u>ã€‚</li></ul><h5 id="æ‰©å±•ï¼šå‡½æ•°ä¸const">æ‰©å±•ï¼šå‡½æ•°ä¸const</h5><blockquote><p>é€‰æ‹©æ€§é˜…è¯»ï¼šæœ¬èŠ‚é¢å¤–æ¶‰åŠåˆ°ï¼Œ<u>3.4 å‡½æ•°å‚æ•°</u> &amp; é¢å¯¹å¯¹è±¡åŸºæœ¬çŸ¥è¯†ã€‚</p></blockquote><p>constæ˜¯è¡¡é‡ä¸€ä¸ªç¨‹åºå‘˜æ˜¯å¦è€é“çš„ä¸€ä¸ªæ ‡å‡†ï¼Œé™¤äº†ä¿®é¥°å˜é‡ä¹‹å¤–ï¼Œä¸»è¦ä¾¿ç”¨äºä¿®é¥°å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">fun</span><span class="params">(<span class="keyword">int</span>&amp; a)</span></span>; <span class="comment">// ä¿®é¥°è¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">int</span>&amp; <span class="title">fun</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a)</span></span>; <span class="comment">// ä¿®é¥°å½¢å‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span>&amp; <span class="title">fun</span><span class="params">(<span class="keyword">int</span>&amp; a)</span> <span class="keyword">const</span></span>&#123;&#125; <span class="comment">// constæˆå‘˜å‡½æ•°</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>constä¿®é¥°è¿”å›å€¼</strong></p><p>constå¸¸ç”¨äºè¿”å›å€¼æ˜¯å¼•ç”¨ç±»å‹çš„æ—¶å€™ã€‚</p><p>ç”±äºé€šå¸¸ä¸ä¼šæ˜¯å±€éƒ¨å˜é‡çš„å¼•ç”¨ï¼ˆè¿”å›å±€éƒ¨å¼•ç”¨æ˜¯å±é™©çš„ï¼Œ<u>3.5.3èŠ‚</u>ï¼‰ï¼Œé‚£ä¹ˆé€šå¸¸æ˜¯è¿”å›æ˜¯ï¼Œ<u>å‡½æ•°å‚æ•°/æˆå‘˜å˜é‡/å…¨å±€å˜é‡</u>ç­‰ã€‚å¦‚æœæˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®ƒä»¬è¢«ä¿®æ”¹ï¼Œä½¿ç”¨constä¿®é¥°ä¾¿å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ã€‚</p><p>ä¸‹é¢æ¼”ç¤ºäº†æ²¡æœ‰constä¿®é¥°å‡½æ•°è¿”å›å€¼æ—¶ï¼Œå‡ºç°äº†æˆ‘ä»¬å¹¶ä¸æœŸæœ›çš„æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Salary</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> base;  <span class="comment">// baseæ˜¯ä¸æœŸæœ›è¢«ä¿®æ”¹çš„ï¼Œä½†æ— æ³•åœ¨è¿™é‡Œè¢«å£°æ˜ä¸ºconst</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Salary</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        base = <span class="number">20000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Salary</span>()&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> base;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    Salary s;</span><br><span class="line">    <span class="comment">// ä¿®æ”¹base</span></span><br><span class="line">    s.<span class="built_in">get_base</span>() = <span class="number">22000</span>;</span><br><span class="line">    <span class="comment">// ä¿®æ”¹æˆåŠŸ</span></span><br><span class="line">    cout&lt;&lt;s.<span class="built_in">get_base</span>()&lt;&lt;endl; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">22000</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¦‚æœç”¨constä¿®é¥°å‡½æ•°è¿”å›å€¼ï¼Œç§æœ‰æˆå‘˜<code>base</code> ä¾¿æ— æ³•è¢«ä¿®æ”¹ï¼ˆæ— æ³•ä½œä¸ºå·¦å€¼ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡å°è¯•ä¿®æ”¹ä¼šæŠ¥é”™ï¼š<code>error: assignment of read-only location â€˜s.Salary::get_base()â€™</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†æ¬¡å°è¯•ä¿®æ”¹baseï¼Œéæ³•</span></span><br><span class="line">s.<span class="built_in">get_base</span>() = <span class="number">22000</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>constä¿®é¥°å½¢å‚</strong></p><p>å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šé€‰æ‹© pass by referenceï¼ˆæŒ‰å¼•ç”¨ä¼ é€’å‚æ•°ï¼‰ã€‚å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›ä¿®æ”¹å®å‚çš„è¯ï¼Œä¼ é€’çš„å¼•ç”¨å‚æ•°è¯·åŠ¡å¿…ä¼˜å…ˆè€ƒè™‘åŠ ä¸Šconstå…³é”®å­—ã€‚</p><p>è¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onlyPrint</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    b = <span class="number">1</span>;   <span class="comment">// errorï¼Œbæ— æ³•ä½œä¸ºå·¦å€¼</span></span><br><span class="line">    cout&lt;&lt;b&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">onlyPrint</span>(a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ï¼Œ<strong>å€¼ä¼ é€’ä¼ é€’ç”¨constä¿®é¥°æ²¡æœ‰æ„ä¹‰</strong>ï¼Œå› ä¸ºå½¢å‚æœ¬æ¥å°±æ˜¯æ‹·è´äº†å®å‚ä¸€ä»½ï¼Œå’Œå®å‚æ— å…³ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onlyPrint</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> b)</span> <span class="comment">// æ— æ„ä¹‰ï¼Œå½¢å‚bå’Œå®å‚aå®Œå…¨ç‹¬ç«‹</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>constæˆå‘˜å‡½æ•°</strong></p><p>è¿™ç§æƒ…å†µå¤šæ•°æƒ…å½¢ä¸‹å¾ˆå®¹æ˜“è¢«å¿½è§†ï¼Œå…¶å®è¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªå†…å®¹ã€‚</p><p>åœ¨å‰é¢<u>constè¿”å›å€¼</u>é¿å…äº†ç§æœ‰æˆå‘˜<code>base</code>è¢«ä¿®æ”¹ï¼Œä½†æ˜¯ä¾æ—§å¯èƒ½åœ¨å‡½æ•°è¿”å›å‰å°±ä¸å°å¿ƒæŠŠ<code>base</code> ä¿®æ”¹äº†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Salary</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> base;  <span class="comment">// baseæ˜¯ä¸æœŸæœ›è¢«ä¿®æ”¹çš„</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Salary</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        base = <span class="number">20000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Salary</span>()&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        base = <span class="number">22000</span>; <span class="comment">// ä¸å°å¿ƒåœ¨returnå‰å°±ä¿®æ”¹äº†base</span></span><br><span class="line">        <span class="keyword">return</span> base;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Salary s;</span><br><span class="line">    cout&lt;&lt;s.<span class="built_in">get_base</span>()&lt;&lt;endl; <span class="comment">// 22000</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨constä¿®é¥°æ•´ä¸ªæˆå‘˜å‡½æ•°ï¼Œ<strong>å»é¿å…æˆå‘˜å‡½æ•°ä¿®æ”¹å¯¹è±¡æˆå‘˜å˜é‡</strong> ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    base = <span class="number">22000</span>; <span class="comment">// errorï¼Œæ— æ³•ä¿®æ”¹base</span></span><br><span class="line"><span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸è¿‡æˆ‘ä»¬ä¾ç„¶æœ‰ç–‘é—®ï¼Œconstæˆå‘˜å‡½æ•°ä¿®é¥°äº†ç©¶ç«Ÿæ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆè¦å‘å‡ºè¿™ç§ç–‘é—®ï¼Œä½œè€…æ˜¯ä¸æ˜¯ç¥ç»è´¨äº†ï¼Ÿè¯·çœ‹ä¸‹ä¾‹ã€‚</p><p>å‡è®¾æ­¤æ—¶çš„<code>get_data()</code> è¿˜æ²¡æœ‰è¢«constä¿®é¥°ï¼Œä¹Ÿæ²¡åšä»€ä¹ˆä¿®æ”¹å¯¹è±¡æˆå‘˜çš„äº‹ï¼ˆå¾ˆä¹–ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å°è¯•è°ƒç”¨<code>get_data</code>æ–¹æ³•å‡ºé”™äº†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Salary s;</span><br><span class="line">s.<span class="built_in">get_base</span>();</span><br></pre></td></tr></table></figure><p>æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: passing â€˜const Salaryâ€™ as â€˜thisâ€™ argument of â€˜const int&amp; Salary::get_base()â€™ </span><br></pre></td></tr></table></figure><blockquote><p>å¥½å§ï¼Œä¸è¦å’Œæˆ‘è¯´å¸¸é‡å¯¹è±¡ä¸èƒ½è°ƒç”¨éå¸¸é‡å‡½æ•°ä¹‹ç±»çš„ï¼Œæˆ‘æ›´æƒ³çŸ¥é“ä¸Šé¢çš„æŠ¥é”™æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ·±å±‚æ¬¡çš„åŸå› æ˜¯ä»€ä¹ˆâ€¦</p></blockquote><p>æŠ¥é”™å¤§æ„æ˜¯è¯´ï¼Œ<code>get_base()</code> å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°å«åš<code>this</code>ï¼Œå°è¯•å°†å®å‚ <code>const Salary</code> ä¼ é€’ç»™<code>this</code> æ—¶å‡ºé”™ã€‚è¿™ç”±æ­¤éœ€è¦è§£é‡Šä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li><code>get_base()</code> å“ªæ¥çš„å«åš<code>this</code>å‚æ•°ï¼Ÿ</li><li><code>this</code> æŒ‡é’ˆæ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>å…¶å®åœ¨C++ä¸­ä»»ä½•æˆå‘˜å‡½æ•°çš„å‚æ•°éƒ½éšå«<code>this</code> æŒ‡é’ˆï¼Œä¸è¿‡ä¸éœ€è¦ä½ æ˜¾ç¤ºå†™å‡ºæ¥ï¼ˆç†Ÿæ‚‰pythonçš„åŒå­¦æ˜¯ä¸æ˜¯ç«‹é©¬æƒ³åˆ°<code>self</code>ï¼Ÿï¼‰ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬çš„<code>get_base</code> åœ¨ç¼–è¯‘å™¨çœ¼ä¸­åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">(Salary* <span class="keyword">this</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>this</code> æŒ‡é’ˆæŒ‡å‘æ­£åœ¨æ“ä½œæˆå‘˜å‡½æ•°çš„å¯¹è±¡ï¼ˆåœ¨è¿™é‡Œæ˜¯<code>s</code> ï¼‰,æ­¤æ—¶å¯¹è±¡çš„ç±»å‹æ˜¯<code>const Salary</code> ã€‚</p><p>è°ƒç”¨<code>s.get_base()</code> åœ¨ç¼–è¯‘å™¨çœ¼é‡Œç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Salary s;</span><br><span class="line">s.<span class="built_in">get_base</span>(&amp;s);</span><br></pre></td></tr></table></figure><p>è€Œæˆ‘ä»¬çš„<code>get_base</code>å‡½æ•°å‚æ•°ç±»å‹æ˜¯<code>Salary*</code> ï¼Œä¼ é€’çš„å½¢å‚<code>&amp;s</code>ç±»å‹æ˜¯<code>const Salary*</code> ã€‚å®ƒä»¬æ˜¯ä¸åŒ¹é…çš„ï¼Œæ•…æŠ¥é”™ã€‚</p><p>è¿™ä¹Ÿè¯´æ˜äº†ï¼Œ<strong>const æˆå‘˜å‡½æ•°å…¶å®å°±æ˜¯ä¿®é¥°äº†æˆå‘˜å‡½æ•°ä¸­thiså‚æ•°ï¼Œä¹Ÿå°±æ˜¯å½“å‰å¯¹è±¡</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">  </span>&#123;       </span><br><span class="line">    base = <span class="number">22000</span>; <span class="comment">// ä¸å°å¿ƒåœ¨returnå‰å°±ä¿®æ”¹äº†base</span></span><br><span class="line">      <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">get_base</span><span class="params">(<span class="keyword">const</span> Salary* <span class="keyword">this</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123;       </span><br><span class="line">    <span class="keyword">this</span>-&gt;base = <span class="number">22000</span>; <span class="comment">// ä¿®æ”¹å¸¸é‡å¯¹è±¡thisï¼Œæ•…å‡ºé”™</span></span><br><span class="line">    <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="æ‰©å±•ï¼šç±»å¯¹è±¡å’Œconst">æ‰©å±•ï¼šç±»å¯¹è±¡å’Œconst</h5><p>constä¿®é¥°çš„å¯¹è±¡ï¼Œä¸èƒ½è¿›è¡Œä¿®æ”¹å¯¹è±¡æˆå‘˜å˜é‡çš„å°è¯•ã€‚</p><p>æœ€æ˜æ˜¾çš„ä¸€ç‚¹å°±æ˜¯ï¼Œconstä¿®é¥°çš„å¯¹è±¡ä¸èƒ½è°ƒç”¨éconstä¿®é¥°çš„å‡½æ•°ï¼Œå³ä½¿å‡½æ•°æ²¡æœ‰ä¿®æ”¹ä»»ä½•æ•°æ®æˆå‘˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Salary</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> base;  <span class="comment">// baseæ˜¯ä¸æœŸæœ›è¢«ä¿®æ”¹çš„</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Salary</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        base = <span class="number">20000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Salary</span>()&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">int</span>&amp; <span class="title">print_base</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout&lt;&lt;base&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> base;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Salary s;  <span class="comment">// constä¿®é¥°å¯¹è±¡</span></span><br><span class="line">    s.print_base;    <span class="comment">// errorï¼Œä¸èƒ½è°ƒç”¨éconstçš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç¼–è¯‘ä¹Ÿå¾ˆç®€å•ï¼Œconstä¿®é¥°å‡½æ•°å³å¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>&amp; <span class="title">print_base</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;base&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> base;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-X-æ™ºèƒ½æŒ‡é’ˆğŸŒŸ">2.1.X æ™ºèƒ½æŒ‡é’ˆğŸŒŸ</h4><h5 id="ä»å†…å­˜æ³„æ¼è¯´èµ·">ä»å†…å­˜æ³„æ¼è¯´èµ·</h5><blockquote><p>å’Œå†…å­˜ç¢ç‰‡æ¦‚å¿µåŒºåˆ†ã€‚</p></blockquote><p>ä¸€èˆ¬æˆ‘ä»¬å¸¸è¯´çš„å†…å­˜æ³„æ¼æ˜¯æŒ‡<strong>å †å†…å­˜çš„æ³„æ¼</strong>ã€‚</p><p>ä½¿ç”¨malloc,ã€reallocã€ newç­‰å‡½æ•°ä»å †ä¸­åˆ†é…åˆ°å—å†…å­˜åï¼Œæ²¡æœ‰ç›¸åº”çš„è°ƒç”¨freeæˆ–deleteé‡Šæ”¾è¯¥å†…å­˜å—ï¼Œ<strong>å¯¼è‡´è¿™å—å†…å­˜å°±ä¸èƒ½è¢«å†æ¬¡ä½¿ç”¨</strong>ã€‚è¿™å°±æ˜¯å†…å­˜æ³„æ¼ã€‚</p><ul><li><p>ä¾‹1ï¼ŒåŒé‡åˆ†é…æ³„æ¼å†…å­˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* ptr = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>();</span><br><span class="line">ptr = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>();  <span class="comment">// ptræŒ‡å‘äº†æ–°ä¸€å—å†…å­˜ï¼ŒåŸæ¥å­˜å‚¨çš„å†…å­˜åœ°å€ä¸¢å¤±</span></span><br></pre></td></tr></table></figure></li><li><p>ä¾‹2ï¼Œç±»ä¼¼æŒ‡é’ˆä¸é‡Šæ”¾åŸå…ˆæŒ‡å‘çš„å†…å­˜åŒºåŸŸã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> value = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span>* ptr = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(); <span class="comment">// å †ä¸Šåˆ†é…å†…å­˜ï¼Œè¿”å›åˆ†é…çš„å†…å­˜é¦–åœ°å€</span></span><br><span class="line">ptr = &amp;value; <span class="comment">// å †ä¸Šå†…å­˜æ²¡æœ‰é‡Šæ”¾ï¼Œå…¶pträ¿å­˜çš„åœ°å€ä¸¢å¤±</span></span><br></pre></td></tr></table></figure></li></ul><p>ä¸Šé¢æ„Ÿå—å¯èƒ½ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªå…·ä½“ä¾‹å­ã€‚</p><p>ä¸‹é¢ä¸€ä¸ªå¾ˆç®€å•<code>int</code>å †å†…å­˜ï¼ˆ4å­—èŠ‚ï¼‰å¿˜è®°ä½¿ç”¨deleteé‡Šæ”¾ï¼Œæ‰§è¡Œäº†ç™¾ä¸‡æ¬¡ï¼ˆæ¯”å¦‚çº¿ä¸Šä»£ç çš„é«˜é¢‘åŸºç¡€å‡½æ•°ï¼‰ï¼Œä¾¿æŸå¤±äº†40Må†…å­˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;free -m&quot;</span>);</span><br><span class="line">    <span class="comment">// å†…å­˜æ³„æ¼*100Wæ¬¡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">1000000</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span>* s = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>();</span><br><span class="line">        s = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>();</span><br><span class="line">        <span class="comment">// delete s;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;free -m&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼ˆæ ˆå ç”¨äº†1Må†…å­˜ï¼‰ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220116122756258.png" alt="image-20220116122756258"></p><p>è¯•æƒ³ï¼šå¦‚æœä¸æ˜¯ç®€å•intï¼Œè€Œæ˜¯å¤æ‚çš„å¤§å¯¹è±¡ï¼Œå¾ˆå¿«å°±èƒ½æŠŠæœåŠ¡å™¨æ‰€æœ‰å†…å­˜å¹²å®Œã€‚</p><p><strong>é¿å…å†…å­˜æ³„æ¼çš„å‡ ç§æ–¹å¼</strong></p><p>åœ¨C++11å‰ï¼Œæˆ‘ä»¬é€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹æ³•å°½é‡ä¿è¯å†…å­˜ä¸è¢«æ³„æ¼ã€‚</p><ol><li><p>åˆ©ç”¨&quot;æŸ¥æ‰¾&quot;åŠŸèƒ½ï¼ŒæŸ¥è¯¢<code>new</code>ä¸<code>delete</code>ï¼Œçœ‹çœ‹å†…å­˜çš„ç”³è¯·ä¸é‡Šæ”¾æ˜¯ä¸æ˜¯æˆå¯¹é‡Šæ”¾çš„ï¼Œè¿™ä½¿ä½ è¿…é€Ÿå‘ç°ä¸€äº›é€»è¾‘è¾ƒä¸ºç®€å•çš„å†…å­˜æ³„æ¼æƒ…å†µã€‚</p></li><li><p>è®¡æ•°æ³•ï¼šä½¿ç”¨newæˆ–è€…mallocæ—¶ï¼Œè®©è¯¥æ•°+1ï¼Œdeleteæˆ–freeæ—¶ï¼Œè¯¥æ•°-1ï¼Œç¨‹åºæ‰§è¡Œå®Œæ‰“å°è¿™ä¸ªè®¡æ•°ï¼Œå¦‚æœä¸ä¸º0åˆ™è¡¨ç¤ºå­˜åœ¨å†…å­˜æ³„æ¼ï¼›</p></li><li><p>å°†åŸºç±»çš„ææ„å‡½æ•°å£°æ˜ä¸º<strong>è™šå‡½æ•°</strong>ï¼Œè®©å­ç±»å»è°ƒç”¨çˆ¶ç±»çš„ææ„å‡½æ•°ï¼Œé¿å…çˆ¶ç±»æ²¡æœ‰ç”³è¯·çš„ç©ºé—´æ²¡æœ‰è¢«é‡Šæ”¾ã€‚</p></li></ol><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›æ£€æµ‹å·¥å…·ï¼š</p><ul><li>Linuxä¸‹å¯ä»¥ä½¿ç”¨<strong>Valgrindå·¥å…·</strong></li><li>Windowsä¸‹å¯ä»¥ä½¿ç”¨<strong>CRTåº“</strong></li></ul><p><strong>ä½†æ— è®ºå¦‚ä½•ï¼Œåœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œã€è®°å¾—ã€æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼Œæ€»ä¸æ˜¯æœ€ä½³å®è·µ</strong>ã€‚</p><p>äººè¿œæ²¡æœ‰æœºå™¨å¯é ï¼Œæˆ‘ä»¬æ€»å¯èƒ½åœ¨ä»€ä¹ˆæ—¶å€™å°±å¿˜è®°å»æ˜¯å¦å†…å­˜èµ„æºã€‚å¹¸è¿çš„æ˜¯ï¼Œ<strong>åœ¨C++11<u>æ™ºèƒ½æŒ‡é’ˆ</u>çš„æ¦‚å¿µä¸­ï¼Œå¯¹å¯¹è±¡ä½¿ç”¨äº†<u>å¼•ç”¨è®¡æ•°</u>ï¼Œè®©ç¨‹åºå‘˜ä¸å†éœ€è¦å…³å¿ƒå†…å­˜é‡Šæ”¾é—®é¢˜</strong>ã€‚</p><h5 id="æ™ºèƒ½æŒ‡é’ˆç®€ä»‹">æ™ºèƒ½æŒ‡é’ˆç®€ä»‹</h5><p>ä¸ºäº†å‡å°‘å‡ºç°å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œåœ¨C++ 11 ä¸­ï¼Œç§»åŠ¨è¯­ä¹‰çš„å¼•å…¥ï¼Œç»“åˆ RAII ï¼Œé‡‡ç”¨ä»£ç†æ¨¡å¼çš„æ€æƒ³ï¼Œç®¡ç†åŠ¨æ€åˆ†é…å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>C++11æä¾›å››ç§æ™ºèƒ½æŒ‡é’ˆä¾›ä½¿ç”¨:</p><table><thead><tr><th style="text-align:center">æŒ‡é’ˆç±»åˆ«</th><th style="text-align:center">æ”¯æŒ</th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><code>unique_ptr</code></td><td style="text-align:center">C++ 11</td><td style="text-align:center">æ‹¥æœ‰ç‹¬æœ‰å¯¹è±¡æ‰€æœ‰æƒè¯­ä¹‰çš„æ™ºèƒ½æŒ‡é’ˆ</td></tr><tr><td style="text-align:center"><code>shared_ptr</code></td><td style="text-align:center">C++ 11</td><td style="text-align:center">æ‹¥æœ‰å…±äº«å¯¹è±¡æ‰€æœ‰æƒè¯­ä¹‰çš„æ™ºèƒ½æŒ‡é’ˆ</td></tr><tr><td style="text-align:center"><code>weak_ptr</code></td><td style="text-align:center">C++ 11</td><td style="text-align:center">std::shared_ptr æ‰€ç®¡ç†å¯¹è±¡çš„å¼±å¼•ç”¨</td></tr><tr><td style="text-align:center"><code>auto_ptr</code></td><td style="text-align:center">C++ 17ä¸­ç§»é™¤</td><td style="text-align:center">æ‹¥æœ‰ä¸¥æ ¼å¯¹è±¡æ‰€æœ‰æƒè¯­ä¹‰çš„æ™ºèƒ½æŒ‡é’ˆ</td></tr></tbody></table><p>æœ¬æ–‡ä¸»è¦å…³æ³¨ï¼Œ  <code>std::shared_ptr</code>ã€<code>std::unique_ptr</code>ã€<code>std::weak_ptr</code>ï¼Œä½¿ç”¨å®ƒä»¬éœ€è¦åŒ…å«å¤´æ–‡ä»¶ <code>&lt;memory&gt;</code>ã€‚</p><h5 id="std-shared-ptr">std::shared_ptr</h5><p><code>std::shared_ptr</code> æ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆï¼Œä¸€ä¸ªåŠ¨æ€åˆ†é…çš„å¯¹è±¡å¯ä»¥åœ¨å¤šä¸ª <code>std::shared_ptr</code> ä¹‹é—´å…±äº«ã€‚</p><ul><li><p>å¯¹è±¡æ¯å¤šä¸€ä¸ª<code>shared_ptr</code> æŒ‡é’ˆè®¡æ•°å°±+1ï¼Œåä¹‹-1ï¼›</p><blockquote><p>ä¸ºä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¼•ç”¨è®¡æ•°çš„å¢å‡å¿…é¡»æ˜¯åŸå­æ“ä½œã€‚</p></blockquote></li><li><p>åŠ¨æ€åˆ†é…çš„æ§åˆ¶å—åŒ…æ‹¬äº†å¼•ç”¨è®¡æ•°ï¼Œå¼±å¼•ç”¨è®¡æ•°ï¼Œè‡ªå®šä¹‰çš„ææ„å™¨ç­‰ç­‰æ•°æ®ã€‚</p></li></ul><p>é…å¥—ä½¿ç”¨çš„è¿˜æœ‰<code>std::make_shared</code>æ–¹æ³• ï¼š</p><ul><li>æ¶ˆé™¤æ˜¾å¼çš„ä½¿ç”¨ <code>new</code>ï¼Œåˆ†é…åˆ›å»ºä¼ å…¥å‚æ•°ä¸­çš„å¯¹è±¡ï¼Œ å¹¶è¿”å›è¿™ä¸ªå¯¹è±¡ç±»å‹çš„<code>std::shared_ptr</code>æŒ‡é’ˆã€‚</li></ul><p>è¿™æ ·ä¸€æ¥ï¼Œ<code>std::shared_ptr</code> èƒ½å¤Ÿé€šè¿‡è®¿é—®å¼•ç”¨è®¡æ•°æ¥<u>ç¡®å®šè‡ªèº«æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„</u>ï¼šå¦‚æœæ˜¯ï¼Œåˆ™ææ„è¯¥å¯¹è±¡ï¼›å¦åˆ™å°†å¼•ç”¨è®¡æ•°å‡ä¸€ã€‚</p><p>ä¸€ä¸ªç®€å•ä½¿ç”¨å®ä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(std::shared_ptr&lt;<span class="keyword">int</span>&gt; i)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    (*i)++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åŸå…ˆåˆ›å»ºå¯¹è±¡éœ€æ˜¾ç¤ºnewå£°æ˜ï¼šint* pointer = new int&#123;10&#125;;</span></span><br><span class="line">    <span class="comment">// shared_ptræ¶ˆé™¤äº†newæ˜¾ç¤ºå£°æ˜</span></span><br><span class="line">    std::shared_ptr&lt;<span class="keyword">int</span>&gt; pointer = std::make_shared&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">foo</span>(pointer);</span><br><span class="line">    std::cout &lt;&lt; *pointer &lt;&lt; std::endl; <span class="comment">// 11</span></span><br><span class="line">    <span class="comment">// pointerç¦»å¼€ä½œç”¨åŸŸï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°ä¸º1ï¼Œåˆ¤æ–­å‡ºè‡ªå·±æ˜¯æœ€åä¸€ä¸ªæŒ‡å‘å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// è‡ªåŠ¨è°ƒç”¨deleteææ„è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>std::shared_ptr</code> è¿˜æœ‰å…¶å®ƒçš„ä¸€äº›æœ‰ç”¨æ–¹æ³•ï¼š</p><ul><li><code>get()</code> æ–¹æ³•æ¥è·å–åŸå§‹æŒ‡é’ˆï¼›</li><li><code>reset()</code> æ¥å‡å°‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼›</li><li><code>use_count()</code>æ¥æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚</li></ul><p>ä½¿ç”¨<code>auto</code> å…³é”®å­—æ›¿ä»£<code>std::shared_ptr&lt;int&gt;</code> å£°æ˜ã€‚</p><p>*æ³¨é‡Šçš„æ•°å­—è¡¨ç¤ºä¸€å¼€å§‹å£°æ˜çš„å¯¹è±¡ï¼Œè¢«å¤šå°‘shared_ptræ‰€æŒ‡å‘ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pointer = std::make_shared&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">auto</span> pointer2 = pointer; <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">auto</span> pointer3 = pointer; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> *p = pointer.<span class="built_in">get</span>(); <span class="comment">// ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°</span></span><br><span class="line">pointer.<span class="built_in">use_count</span>(); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">pointer2.<span class="built_in">reset</span>();</span><br><span class="line">pointer3.<span class="built_in">reset</span>();</span><br><span class="line">pointer.<span class="built_in">use_count</span>(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p><strong><code>std::shared_ptr</code> çœ‹ç€å¾ˆç¾å¥½ï¼Œä½†å®ƒå­˜åœ¨å¾ªç¯å¼•ç”¨çš„é—®é¢˜</strong>ã€‚</p><p>è¯·çœ‹ä¸‹ä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    std::shared_ptr&lt;B&gt; pointer;</span><br><span class="line">    ~<span class="built_in">A</span>() </span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;A è¢«é”€æ¯&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    std::shared_ptr&lt;A&gt; pointer;</span><br><span class="line">    ~<span class="built_in">B</span>() </span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B è¢«é”€æ¯&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> a = std::make_shared&lt;A&gt;(); <span class="comment">// æ­¤æ—¶æŒ‡é’ˆaæŒ‡å‘çš„å¯¹è±¡è®°ä¸ºAå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">auto</span> b = std::make_shared&lt;B&gt;(); <span class="comment">// æ­¤æ—¶æŒ‡é’ˆbæŒ‡å‘çš„å¯¹è±¡è®°ä¸ºBå¯¹è±¡</span></span><br><span class="line">    cout&lt;&lt;a.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Aå¯¹è±¡è®¡æ•°ï¼š1</span></span><br><span class="line">    cout&lt;&lt;b.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Bå¯¹è±¡è®¡æ•°ï¼š1</span></span><br><span class="line">    a-&gt;pointer = b; </span><br><span class="line">    b-&gt;pointer = a; </span><br><span class="line">    cout&lt;&lt;a.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Aå¯¹è±¡è®¡æ•°ï¼š2ï¼Œå†…éƒ¨å¼•ç”¨Bå¯¹è±¡</span></span><br><span class="line">    cout&lt;&lt;b.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Bå¯¹è±¡è®¡æ•°ï¼š2ï¼Œå†…éƒ¨å¼•ç”¨Aå¯¹è±¡ï¼Œå‘ç”Ÿå¾ªç¯å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è¿è¡Œå¯¹è±¡Aã€Bå‡ä¸ä¼šè¢«é”€æ¯ï¼ˆå¼•ç”¨è®¡æ•°ä¸ä¸ºï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">2</span><br></pre></td></tr></table></figure><ul><li>main å‡½æ•°é€€å‡ºå‰ï¼ŒB å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º2ï¼ŒA å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 2ï¼›</li><li>main å‡½æ•°é€€å‡ºåï¼šb æŒ‡é’ˆé”€æ¯ï¼ŒB å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º 1ï¼›a æŒ‡é’ˆé”€æ¯ï¼ŒA å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º1ï¼›</li></ul><p>è¿™æ ·å°±å¯¼è‡´äº† å¯¹è±¡Aã€Bçš„å†…å­˜åŒºåŸŸå¼•ç”¨è®¡æ•°ä¸ä¸ºé›¶ï¼Œè€Œå¤–éƒ¨å·²ç»æ²¡æœ‰åŠæ³•æ‰¾åˆ°è¿™å—åŒºåŸŸäº†ï¼Œä¹Ÿå°±é€ æˆäº†å†…å­˜æ³„æ¼ã€‚</p><p><img src="https://changkun.de/modern-cpp/assets/figures/pointers1.png" alt="å›¾ 5.1"></p><p><code>std::weak_ptr</code> çš„å­˜åœ¨ä¾¿å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h5 id="std-weak-ptr">std::weak_ptr</h5><p><code>std::weak_ptr</code>æ˜¯ä¸€ç§å¼±å¼•ç”¨ï¼ˆç›¸æ¯”è¾ƒè€Œè¨€ <code>std::shared_ptr</code> å°±æ˜¯ä¸€ç§å¼ºå¼•ç”¨ï¼‰ã€‚</p><p><code>std::weak_ptr</code> æ˜¯é’ˆå¯¹ <code>std::shared_ptr</code> åŠŸèƒ½çš„æ‰©å±•ï¼Œ ä¸èƒ½è§£å¼•ç”¨ï¼Œä¹Ÿä¸èƒ½æ£€æŸ¥æ˜¯å¦ä¸ºç©ºï¼Œ<u>ä¸»è¦ä½œç”¨æ˜¯ç”¨äºè§‚å¯Ÿ <code>std::shared_ptr</code> çš„å†…éƒ¨çŠ¶æ€ï¼ŒæŸ¥çœ‹å…¶å¼•ç”¨è®¡æ•°</u>ï¼Œ<u>æŸ¥çœ‹æŒ‡é’ˆæ˜¯å¦ç©ºæ‚¬</u>ï¼Œæ˜¯ä¸€ç§å…·æœ‰ä¸´æ—¶æ‰€æœ‰æƒè¯­ä¹‰çš„æ™ºèƒ½æŒ‡é’ˆã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦<code>std::weak_ptr</code></strong>ï¼Ÿ</p><p>ä¸€ç§å¸¸ç”¨çš„ç”¨æ³•å°±æ˜¯å‰é¢æ‰€è¯´ï¼Œæ‰“æ–­ <code>std::shared_ptr</code> æ‰€ç®¡ç†çš„å¯¹è±¡ç»„æˆçš„ç¯çŠ¶å¼•ç”¨ã€‚</p><p>ä¸Šä»£ç è§£é‡Šã€‚</p><p>å’Œå‰é¢å”¯ä¸€çš„åŒºåˆ«æ˜¯<u>åªåœ¨</u>ç»“æ„ä½“<code>B</code>å†…éƒ¨æ›¿æ¢äº†<code>std::shared_ptr</code>  --&gt; <code>std::weak_ptr</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    std::shared_ptr&lt;B&gt; pointer; <span class="comment">// å¼ºå¼•ç”¨</span></span><br><span class="line">    ~<span class="built_in">A</span>() </span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;A è¢«é”€æ¯&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    std::weak_ptr&lt;A&gt; pointer; <span class="comment">// æ›¿æ¢ä¸ºå¼±å¼•ç”¨</span></span><br><span class="line">    ~<span class="built_in">B</span>() </span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B è¢«é”€æ¯&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸»å‡½æ•°ä¸­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> a = std::make_shared&lt;A&gt;(); <span class="comment">// æ­¤æ—¶æŒ‡é’ˆaæŒ‡å‘çš„å¯¹è±¡è®°ä¸ºAå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">auto</span> b = std::make_shared&lt;B&gt;(); <span class="comment">// æ­¤æ—¶æŒ‡é’ˆbæŒ‡å‘çš„å¯¹è±¡è®°ä¸ºBå¯¹è±¡</span></span><br><span class="line">    cout&lt;&lt;a.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Aå¯¹è±¡è®¡æ•°ï¼š1</span></span><br><span class="line">    cout&lt;&lt;b.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Bå¯¹è±¡è®¡æ•°ï¼š1</span></span><br><span class="line">    a-&gt;pointer = b; </span><br><span class="line">    b-&gt;pointer = a; </span><br><span class="line">    cout&lt;&lt;a.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Aå¯¹è±¡è®¡æ•°ï¼š1ï¼Œå†…éƒ¨å¼±å¼•ç”¨Bå¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°æ²¡æœ‰å¢åŠ </span></span><br><span class="line">    cout&lt;&lt;b.<span class="built_in">use_count</span>()&lt;&lt;endl; <span class="comment">// Bå¯¹è±¡è®¡æ•°ï¼š2ï¼Œå†…éƒ¨å¼•ç”¨Aå¯¹è±¡ï¼Œå‘ç”Ÿå¾ªç¯å¼•ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼Œä¸€åˆ‡å²æœˆé™å¥½ï¼ˆææ„å‡½æ•°è¢«æ‰§è¡Œï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">A è¢«é”€æ¯</span><br><span class="line">B è¢«é”€æ¯</span><br></pre></td></tr></table></figure><p>å¯è§å¼±å¼•ç”¨ä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°å¢åŠ ï¼ˆAå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å§‹ç»ˆæ˜¯1ï¼‰ï¼Œå½“æ¢ç”¨å¼±å¼•ç”¨æ—¶å€™ï¼Œæœ€ç»ˆçš„é‡Šæ”¾æµç¨‹å¦‚å›¾æ‰€ç¤ºï¼ˆè™šçº¿è¡¨ç¤ºå¼±å¼•ç”¨ï¼‰ï¼š</p><p><img src="https://changkun.de/modern-cpp/assets/figures/pointers2.png" alt="å›¾ 5.2"></p><ul><li>main å‡½æ•°é€€å‡ºå‰ï¼ŒB å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º2ï¼ŒA å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 1ï¼›</li><li>b æŒ‡é’ˆé”€æ¯ï¼ŒB å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º 1ï¼›</li><li>a æŒ‡é’ˆé”€æ¯ï¼ŒA å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º0ï¼ŒA å¯¹è±¡ç«‹åˆ»ææ„ï¼ŒA å¯¹è±¡ææ„çš„è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´å…¶åŒ…å«çš„ b æŒ‡é’ˆè¢«é”€æ¯ï¼Œä»è€Œå¯¼è‡´ B å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œä½¿å¾— B å¯¹è±¡ä¹Ÿè¢«æ­£å¸¸ææ„ã€‚</li></ul><h5 id="std-unique-ptr">std::unique_ptr</h5><p>åœ¨å‰é¢<code>std::shared_ptr</code>ï¼Œå¯ä»¥ä½¿å¾—å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆå…±æœ‰ä¸€ä¸ªå¯¹è±¡ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pointer = std::make_shared&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>); <span class="comment">// å¼•ç”¨è®¡æ•°ï¼š1</span></span><br><span class="line"><span class="keyword">auto</span> pointer2 = pointer; <span class="comment">// å¼•ç”¨è®¡æ•°ï¼š2</span></span><br><span class="line"><span class="keyword">auto</span> pointer3 = pointer; <span class="comment">// å¼•ç”¨è®¡æ•°ï¼š3</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œ<code>std::unique_ptr</code> æ˜¯ä¸€ç§ç‹¬å çš„æ™ºèƒ½æŒ‡é’ˆï¼Œ æ˜¯å…·æœ‰<u>ä¸“å±æ‰€æœ‰æƒè¯­ä¹‰</u>ï¼ˆexclusive ownership semanticsï¼‰çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒç¦æ­¢å…¶ä»–æ™ºèƒ½æŒ‡é’ˆä¸å…¶å…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä¿è¯ä»£ç çš„å®‰å…¨ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦<code>std::unique_ptr</code></strong>ï¼Ÿ</p><ol><li>é¿å…å†…å­˜æ³„æ¼ï¼Œè¿™æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼›</li><li>é¿å…æ›´å¤§å¼€é”€ï¼Œç›¸æ¯”äºshared_ptrï¼Œå®ƒçš„å¼€é”€æ›´å°ï¼Œç”šè‡³å¯ä»¥è¯´å’Œè£¸æŒ‡é’ˆç›¸å½“ï¼Œå®ƒ<u>ä¸éœ€è¦ç»´æŠ¤å¼•ç”¨è®¡æ•°çš„åŸå­æ“ä½œ</u>ç­‰ç­‰ã€‚</li></ol><p>å›åˆ°å‰é¢ï¼Œæ—¢ç„¶<code>std::unique_ptr</code>æ˜¯ç‹¬å ï¼Œä¹Ÿå°±æ˜¯ä¸å¯å¤åˆ¶ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pointer = std::make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>); <span class="comment">// å¼•ç”¨è®¡æ•°ï¼š1</span></span><br><span class="line"><span class="keyword">auto</span> pointer2 = pointer; <span class="comment">// æŠ¥é”™ï¼Œæ­¤æ—¶pointer2æ— æ³•ä½œä¸ºå·¦å€¼ï¼Œå³æ— æ³•å°†pointerå¤åˆ¶ç»™pointer2</span></span><br></pre></td></tr></table></figure><p><code>std::make_unique</code>  åœ¨C++14æ‰è¢«æ”¯æŒï¼ˆC++11å§”å‘˜ä¸»å¸­åŸè¯è¯´ä»–å¿˜äº†ï¼‰éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> ...Args&gt;</span></span><br><span class="line"><span class="function">std::unique_ptr&lt;T&gt; <span class="title">make_unique</span><span class="params">( Args&amp;&amp; ...args )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::unique_ptr&lt;T&gt;( <span class="keyword">new</span> <span class="built_in">T</span>( std::forward&lt;Args&gt;(args)... ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶<code>unique_ptr</code>ä¸èƒ½å¤åˆ¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>std::move</code> å°†å¯¹è±¡æ‰€æœ‰æƒè½¬ç§»ç»™å…¶å®ƒçš„ <code>unique_ptr</code>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="built_in">Foo</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;æ‰§è¡ŒFooæ„é€ å‡½æ•°&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    ~<span class="built_in">Foo</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;æ‰§è¡ŒFooææ„å‡½æ•°&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;æ‰§è¡ŒFooå‡½æ•°foo&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::unique_ptr&lt;Foo&gt; p1 = make_unique&lt;Foo&gt;();</span><br><span class="line">    p1-&gt;<span class="built_in">foo</span>();</span><br><span class="line">    <span class="comment">// std::moveè½¬ç§»p1æŒ‡å‘çš„Fooå¯¹è±¡æ‰€æœ‰æƒç»™p2</span></span><br><span class="line">    std::unique_ptr&lt;Foo&gt; p2 = std::<span class="built_in">move</span>(p1);</span><br><span class="line">    p2-&gt;<span class="built_in">foo</span>();</span><br><span class="line">    <span class="comment">// å‡½æ•°é€€å‡ºå‰ï¼ˆå‡†ç¡®æ¥è¯´ï¼Œæ˜¯ç¦»å¼€ä½œç”¨åŸŸå‰ï¼‰ï¼ŒFooå¯¹è±¡è¢«é”€æ¯</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡ŒFooæ„é€ å‡½æ•°</span><br><span class="line">æ‰§è¡ŒFooå‡½æ•°foo</span><br><span class="line">æ‰§è¡ŒFooå‡½æ•°foo</span><br><span class="line">æ‰§è¡ŒFooææ„å‡½æ•°</span><br></pre></td></tr></table></figure><ol><li>åˆ›å»ºå¯¹è±¡ï¼Œæ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–å¹¶ç”±æ™ºèƒ½æŒ‡é’ˆ<code>p1</code> ç®¡ç†ï¼Œè¾“å‡ºâ€œæ‰§è¡ŒFooæ„é€ å‡½æ•°â€ï¼›</li><li>æ‰§è¡Œfooå‡½æ•°ï¼Œè¾“å‡ºâ€œæ‰§è¡ŒFooå‡½æ•°fooâ€ï¼›</li><li><code>std::move</code>è½¬ç§»åŸå…ˆ<code>p1</code> æ‰€æŒ‡å‘çš„Fooå¯¹è±¡ï¼ˆå†…å­˜åŒºåŸŸï¼‰æ‰€æœ‰æƒè½¬ç§»ç»™äº†<code>p2</code> ï¼Œå› æ­¤å¹¶æ²¡æœ‰åˆ›å»ºæ–°å¯¹è±¡ï¼Œæ•…ä»£ç 16è¡Œå¤„ä¸ä¼šäº§ç”Ÿè¾“å‡ºï¼›</li><li>æ‰§è¡Œfooå‡½æ•°ï¼Œâ€œæ‰§è¡ŒFooå‡½æ•°fooâ€ï¼›</li><li><code>p2</code> ç®¡ç†çš„å¯¹è±¡ç¦»å¼€ä½œç”¨èŒƒå›´ï¼Œææ„å‡½æ•°è‡ªåŠ¨æ‰§è¡Œï¼Œâ€œæ‰§è¡ŒFooææ„å‡½æ•°â€ã€‚</li></ol><h3 id="2-2-å¼•ç”¨">2.2 å¼•ç”¨</h3><p>åœ¨æœ¬ç« å¼€ç¯‡æˆ‘ä»¬ä¾¿å·²æåˆ°ï¼Œå°½é‡é¿å…ä½¿ç”¨æŒ‡é’ˆã€‚æœ€é‡è¦çš„åŸå› ä¾¿æ˜¯æŒ‡é’ˆå®ƒçš„ä¸å®‰å…¨æ€§ä¸ä¸ç¡®å®šæ€§ï¼Œä¸€ä¸ªcrazyçš„é‡æŒ‡é’ˆå¯èƒ½ä¼šè®©ä½ æ›´åŠ crazyã€‚</p><p>æ¡ä»¶å…è®¸çš„è¯ï¼Œè¯·å¤šå¤šä½¿ç”¨å¼•ç”¨ï¼š</p><ol><li><strong>æ›´å®‰å…¨</strong>ã€‚å¼•ç”¨ä½¿ç”¨å‰å¿…é¡»åˆå§‹åŒ–ï¼Œä¸”ä¸èƒ½ä¸ºç©ºï¼›æŒ‡é’ˆå¯ä»¥éšæ„æ”¹å˜ä»–çš„æŒ‡å‘çš„å¯¹è±¡ï¼ˆé‡æŒ‡é’ˆçš„ä¸€å¤§æ¸©åºŠï¼‰ï¼Œä½†å¼•ç”¨ä¸å¯ä»¥ã€‚</li><li><strong>æ•ˆç‡æ›´é«˜</strong>ã€‚æŒ‡é’ˆæœ€åææ„æ—¶ï¼Œè¦å¤„ç†å†…å­˜é‡Šæ”¾é—®é¢˜ã€‚</li><li><strong>æ•°ç»„ä¸ä¼šé€€åŒ–ä¸ºæŒ‡é’ˆ</strong>ã€‚å°†æ•°ç»„å¼•ç”¨ä½œä¸ºå‚æ•°æ—¶ï¼Œä¸ä¼šåƒæŒ‡é’ˆä¼ é€’ä¸€æ ·é€€åŒ–ä¸ºæŒ‡é’ˆã€‚</li></ol><p>ç°åœ¨æˆ‘ä»¬æ¥è¿›è¡Œæ›´è¯¦ç»†çš„ä»‹ç»ã€‚</p><h4 id="2-2-1-å¼•ç”¨ç®€ä»‹">2.2.1 å¼•ç”¨ç®€ä»‹</h4><h5 id="å¼•ç”¨åˆè¯†">å¼•ç”¨åˆè¯†</h5><p><strong>å£°æ˜</strong>ä¸€ä¸ªå¼•ç”¨å¾ˆç®€å•ï¼Œç±»å‹+<code>&amp;</code> å³å¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span>&amp; b = a;  <span class="comment">// å¼•ç”¨å£°æ˜å¿…é¡»åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p><strong>å¼•ç”¨å°±æ˜¯å˜é‡çš„åˆ«å</strong>ï¼Œå¯¹å¼•ç”¨çš„ä»»ä½•æ“ä½œç­‰ä»·äºæ“ä½œäºæœ¬ä½“ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="number">1</span>;</span><br><span class="line">cout&lt;&lt;a&lt;&lt;endl; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>å˜é‡aã€bè¢«è§†ä¸ºåŒä¹‰è¯ã€‚åœ¨<code>b</code>ä¸Šè¿”å›åœ°å€ï¼Œä¼šæ‰“å°<code>a</code>çš„åœ°å€ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; &amp;a &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// 0x7fff16db208c</span></span><br><span class="line">std::cout &lt;&lt; &amp;b &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// 0x7fff16db208c</span></span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„å¼•ç”¨è¿˜æœ‰ä¸¤ä¸ªé‡è¦ç‰¹æ€§ï¼š</p><ol><li><p><strong>æ— æ³•ä¿®æ”¹å¼•ç”¨æŒ‡å‘ï¼Œå¯ä»¥ç†è§£ä¸ºå¼•ç”¨é»˜è®¤å°±æ˜¯å¸¸é‡å¼•ç”¨</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> c = <span class="number">2</span>;</span><br><span class="line">b = c;  <span class="comment">// ç­‰ä»·äºï¼šb=2ï¼Œæ— æ³•é‡æ–°æŒ‡å‘c</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å°±åƒæŒ‡é’ˆä¸€æ ·ï¼Œå¼•ç”¨åªèƒ½ç”¨å·¦å€¼ï¼ˆlå€¼ï¼‰è¿›è¡Œèµ‹å€¼</strong></p><p>ï¼ˆç»“åˆä¸‹èŠ‚ç†è§£ï¼‰å› ä¸ºåªæœ‰å·¦å€¼æ‰æœ‰å±äºè‡ªå·±å†…å­˜åœ°å€ï¼Œæ‰èƒ½å¼•ç”¨æ—¶é—´æ¥å¯»å€æ‰¾åˆ°æœ¬ä½“å˜é‡ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>&amp; b = a; <span class="comment">// åˆæ³•ï¼Œå˜é‡bæ˜¯å·¦å€¼</span></span><br><span class="line"><span class="keyword">int</span>&amp; b = <span class="number">1</span>; <span class="comment">// éæ³•ï¼Œæ–‡å­—1æ˜¯å³å€¼</span></span><br><span class="line"><span class="keyword">int</span>&amp; b = a+<span class="number">1</span>; <span class="comment">// éæ³•ï¼Œè¡¨è¾¾å¼a+1ä¹Ÿæ˜¯å³å€¼</span></span><br></pre></td></tr></table></figure></li></ol><h5 id="ä»æ±‡ç¼–è§’åº¦çœ‹å¼•ç”¨">ä»æ±‡ç¼–è§’åº¦çœ‹å¼•ç”¨</h5><p>å¼•ç”¨åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå˜é‡çš„åˆ«åï¼Ÿæ˜¯æŒ‡é’ˆï¼Ÿåˆå­¦è€…éš¾å…éƒ½è¦è¢«ç»•æ™•ã€‚</p><p>è¿™é‡Œå…ˆç»™å‡ºç»“è®ºï¼š<strong>å¼•ç”¨çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼ŒæŒ‡é’ˆåœ¨CPUçœ¼ä¸­ä¹Ÿå’Œä¸€ä¸ªæ™®é€šå˜é‡æ²¡ä»€ä¹ˆåŒºåˆ«</strong>ã€‚</p><p>é“è¯å¦‚ä¸‹ï¼Œå ‚ä¸‹å¼•ç”¨è¿˜ä¸éœ²å‡ºåŸå‹ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">int</span>&amp; b = a;</span><br><span class="line">    b = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">int</span>* c = &amp;a;</span><br><span class="line">    *c = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹åº”æ±‡ç¼–ä»£ç ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220116151955111.png" alt="image-20220116151955111"></p><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨æŒ‡é’ˆï¼ˆâ‘¡å¤„ï¼‰å’Œä½¿ç”¨å¼•ç”¨ï¼ˆâ‘ å¤„ï¼‰æ±‡ç¼–ä»£ç åŸºæœ¬ä¸€è‡´ã€‚ä»¥æŒ‡é’ˆæ±‡ç¼–ä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å°†å˜é‡açš„åœ°å€ï¼ˆ-20(%rbp)ï¼‰å­˜å…¥å¯„å­˜å™¨rax</span><br><span class="line">leaq    -20(%rbp), %rax</span><br><span class="line"># ä¸ºæŒ‡é’ˆcåˆ†é…å†…å­˜ï¼ˆ-16(%rbp)ï¼‰ï¼ŒåŒæ—¶å°†å˜é‡açš„åœ°å€å­˜å…¥</span><br><span class="line">movq    %rax, -16(%rbp)</span><br><span class="line"># æŒ‡é’ˆçš„å€¼ï¼ˆå˜é‡açš„åœ°å€ï¼‰å­˜å…¥å¯„å­˜å™¨rax</span><br><span class="line">movq    -16(%rbp), %rax</span><br><span class="line"># å°†ç«‹å³æ•°é€šè¿‡é—´æ¥å¯»å€(),èµ‹å€¼ç»™å˜é‡a</span><br><span class="line">movl    $2, (%rax)</span><br></pre></td></tr></table></figure><p>è¿™è¯´æ˜ï¼Œ<strong>å¼•ç”¨åœ¨ç¼–è¯‘å™¨çœ¼é‡Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå­˜å‚¨äº†å˜é‡åœ°å€ï¼Œä½¿ç”¨å¼•ç”¨æ—¶ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åŠ ä¸Šé—´æ¥æ“ä½œç¬¦<code>*</code>ï¼Œæœ¬è´¨è¿˜æ˜¯ä¸€æ ·çš„</strong> ã€‚</p><p>ä¸è¿‡è¿™ä¸ªâ€œæŒ‡é’ˆâ€è¿˜æ˜¯â€œå¸¸é‡æŒ‡é’ˆâ€ï¼Œæ‰€ä»¥å¼•ç”¨æœ¬èº«æ— æ³•è¢«ä¿®æ”¹ä¸”å¿…é¡»åˆå§‹åŒ–ï¼ˆconstä¿®é¥°çš„ç‰¹æ€§ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>&amp; b = a;  <span class="comment">// ç¼–è¯‘å™¨çœ¼é‡Œç­‰ä»·äºï¼šint* const b = &amp;a;</span></span><br><span class="line">b = <span class="number">1</span>;       <span class="comment">// ç¼–è¯‘å™¨çœ¼é‡Œç­‰ä»·äºï¼š*b=1</span></span><br></pre></td></tr></table></figure><p>å¸Œæœ›çœ‹åˆ°è¿™å„¿çš„ä½ æœ‰ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰ã€‚</p><h4 id="2-2-2-å¼•ç”¨å’Œconst">2.2.2 å¼•ç”¨å’Œconst</h4><p>å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œå¼•ç”¨æœ¬èº«å°±ä¸èƒ½æ”¹å˜ï¼Œå› æ­¤â€œå¼•ç”¨â€æœ¬æ¥å°±å…·å¤‡â€œå¸¸é‡å¼•ç”¨â€ç‰¹æ€§ï¼ˆæ— æ³•ä¿®æ”¹ï¼‰ã€‚</p><p>åœ¨C++ä¸­ä¹Ÿä¸å­˜åœ¨â€œå¸¸é‡å¼•ç”¨â€è¿™ä¸ªæ¦‚å¿µï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span>&amp; <span class="keyword">const</span> b = a;  <span class="comment">// error: â€˜constâ€™ qualifiers cannot be applied to â€˜int&amp;â€™</span></span><br></pre></td></tr></table></figure><p>ä½†å­˜åœ¨æŒ‡å‘<u>æŒ‡å‘å¸¸é‡çš„å¼•ç”¨</u>ã€‚</p><h5 id="æŒ‡å‘å¸¸é‡çš„å¼•ç”¨">æŒ‡å‘å¸¸é‡çš„å¼•ç”¨</h5><p>å°±åƒâ€œæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆâ€ï¼ŒæŒ‡å‘å¸¸é‡çš„å¼•ç”¨å¯ä»¥ç”¨<u>å¸¸é‡æˆ–éå¸¸é‡çš„<strong>å·¦å€¼</strong></u>è¿›è¡Œ<strong>åˆå§‹åŒ–</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> b = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>&amp; c = a;  <span class="comment">// okï¼Œaæ˜¯å·¦å€¼</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>&amp; d = b;  <span class="comment">// okï¼Œbæ˜¯å·¦å€¼</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">2</span> ; <span class="comment">// ok</span></span><br><span class="line">c = <span class="number">3</span> ; <span class="comment">// errorï¼ŒæŒ‡å‘å¸¸é‡çš„å¼•ç”¨å°†å˜é‡å½“åšå¸¸é‡ï¼Œå³ä½¿å˜é‡æœ¬èº«ä¸æ˜¯å£°æ˜ä¸ºå¸¸é‡</span></span><br></pre></td></tr></table></figure><p>ä½†æŒ‡å‘å¸¸é‡çš„å¼•ç”¨ï¼Œ<strong>è¿˜å¯ä»¥ä½¿ç”¨<u>æ–‡å­—å³å€¼</u>åˆå§‹åŒ–</strong>ï¼ˆè¿™å’Œæ™®é€šå¼•ç”¨/æŒ‡é’ˆä¸åŒï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>&amp; e = <span class="number">5</span>; <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><h5 id="å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°">å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°</h5><p>å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°ç›¸æ¯”æŒ‡é’ˆä½œä¸ºå‚æ•°æ›´åŠ æ¨èï¼ŒåŸå› å°±æ˜¯æœ¬èŠ‚å¼€å¤´æ‰€è¯´ï¼šå®‰å…¨ã€æ•ˆç‡é«˜ã€é¿å…äº†æ•°ç»„é€€åŒ–é—®é¢˜ã€‚</p><p>æ¡ä»¶å…è®¸çš„è¯ï¼Œæˆ‘ä»¬è¿˜å»ºè®®ä½ <u>å°½é‡ä½¿ç”¨constä¿®é¥°å¼•ç”¨</u>ï¼Œè¿™å¯ä»¥é¿å…ä¼ é€’çš„å‚æ•°è¢«ä¿®æ”¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printIt</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// x = 1 ; // ä¸åˆæ³•</span></span><br><span class="line">    std::cout &lt;&lt; x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-3-æŒ‡é’ˆå’Œå¼•ç”¨å°ç»“">2.2.3 æŒ‡é’ˆå’Œå¼•ç”¨å°ç»“</h4><p>å‰é¢æ ¸å¿ƒå†…å®¹æ€»ç»“ï¼š</p><ul><li><strong>æœ¬è´¨</strong>ï¼šå¼•ç”¨æœ¬è´¨å°±æ˜¯<u>å¸¸é‡æŒ‡é’ˆ</u>ï¼ŒæŒ‡é’ˆæœ¬è´¨å°±æ˜¯<u>å­˜å‚¨äº†å…¶å®ƒå˜é‡åœ°å€çš„å˜é‡</u>ã€‚</li><li><strong>å£°æ˜/èµ‹å€¼</strong>ï¼šå¼•ç”¨å’ŒæŒ‡é’ˆéƒ½<u>åªèƒ½ç”¨å·¦å€¼</u>è¿›è¡Œåˆå§‹åŒ–/èµ‹å€¼ï¼ˆä½†<u>æŒ‡å‘å¸¸é‡çš„å¼•ç”¨å¯ä»¥ç”¨å³å€¼</u>åˆå§‹åŒ–ï¼‰ï¼Œå¼•ç”¨è¿˜å¿…é¡»å£°æ˜æ—¶å°±åˆå§‹åŒ–ã€‚</li><li><strong>const+æŒ‡é’ˆ/å¼•ç”¨</strong>ï¼šconstä½äº<code>&amp;</code> / <code>*</code> å‰åå…·æœ‰ä¸åŒè¯­ä¹‰ï¼›constè®©ä¿®é¥°çš„å˜é‡æ— æ³•è¢«ä¿®æ”¹ã€‚</li><li><strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼šå–„äºä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå¸®æˆ‘ä»¬è‡ªåŠ¨ç®¡ç†å†…å­˜é‡Šæ”¾ï¼Œå¾ªç¯å¼•ç”¨ä½¿ç”¨<code>std::weak_ptr</code>è¿›è¡Œè§£å†³ã€‚</li></ul><p>æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«ï¼š</p><ol><li><strong>æœ¬è´¨</strong>ï¼šæŒ‡é’ˆæœ¬è´¨æ˜¯å˜é‡ï¼Œå¼•ç”¨æœ¬è´¨æ˜¯æŒ‡é’ˆä¹Ÿæ˜¯å˜é‡ï¼›</li><li><strong>åˆå§‹åŒ–</strong>ï¼šå¼•ç”¨å¿…é¡»åˆå§‹åŒ–ï¼ˆä¸”ä¸èƒ½ä¸ºNULLï¼‰ï¼ŒæŒ‡é’ˆä¸å¿…è¦åˆå§‹åŒ–ï¼ˆä½†ä¸åˆå§‹åŒ–å°±ä½¿ç”¨æ˜¯ä½¿ç”¨é‡æŒ‡é’ˆï¼‰ï¼›</li><li><strong>èµ‹å€¼</strong>ï¼šå¼•ç”¨å’ŒæŒ‡é’ˆéƒ½<u>åªèƒ½ç”¨å·¦å€¼</u>è¿›è¡Œåˆå§‹åŒ–/èµ‹å€¼ï¼ˆä½†<u>æŒ‡å‘å¸¸é‡çš„å¼•ç”¨å¯ä»¥ç”¨å³å€¼</u>åˆå§‹åŒ–ï¼‰ï¼›</li><li><strong>ä¿®æ”¹</strong>ï¼šå¼•ç”¨ä¸€æ—¦åˆå§‹åŒ–ä¹‹åå°±ä¸å¯ä»¥å†æ”¹å˜ï¼ŒæŒ‡é’ˆå˜é‡å¯ä»¥é‡æ–°æŒ‡å‘åˆ«çš„å˜é‡ï¼›</li><li>â€¦</li></ol><h3 id="2-3-åŠŸåŠ›æå‡">2.3 åŠŸåŠ›æå‡</h3><h4 id="2-3-1-å¾ªç¯ä½ çœŸçš„ä¼šäº†å—ï¼šfor-each-è¿­ä»£å™¨">2.3.1 å¾ªç¯ä½ çœŸçš„ä¼šäº†å—ï¼šfor_each&amp;è¿­ä»£å™¨</h4><p>å°‘å¹´ï¼Œæƒ³æ›´ä¼˜é›…çš„éå†å‡è£…é«˜æ‰‹å—ï¼Ÿ</p><p>æ¥ä½¿ç”¨æ›´ç®€å•ã€æ›´å®‰å…¨çš„å¾ªç¯ç§°ä¸º<strong>for-each</strong>å¾ªç¯ã€<strong>è¿­ä»£å™¨</strong>æ›¿æ¢æ™®é€šçš„forå¾ªç¯å§ã€‚</p><h5 id="for-each">for_each</h5><p><em>for</em> å¾ªç¯éå†å…ƒç´ æ—¶æ›´åŠ çš„çµæ´»ï¼ˆæ¯”å¦‚<u>æŒ‡å®šé•¿åº¦çš„æ•°ç»„å…ƒç´ </u>ï¼‰ï¼Œä½†ä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ã€‚æ¯”å¦‚ä½ ä¸å°å¿ƒå†™é”™äº†æ•°ç»„é•¿åº¦ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span> ; i&lt;<span class="number">4</span> ; i++)</span><br><span class="line">   std::cout&lt;&lt;arr[i]&lt;&lt;std::endl; <span class="comment">// å‡ºé”™ï¼Œè®¿é—®arr[3]è¶Šç•Œ</span></span><br></pre></td></tr></table></figure><p><em>for-each</em> æä¾›äº†æ›´ç®€å•ã€å®‰å…¨çš„æ–¹å¼ï¼Œç‰¹åˆ«ä½ éœ€è¦è·å–<u>æ‰€æœ‰å…ƒç´ </u>çš„æƒ…å†µã€‚</p><ul><li><em>for-each</em> è¿˜é€‚åˆ<code>std::array</code>ã€<code>std::vector</code>ç­‰å®¹å™¨ï¼›</li><li><em>for-each</em> ä¸é€‚åˆæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼ˆåŠ¨æ€æ•°ç»„ï¼‰ï¼Œå› ä¸ºæŒ‡é’ˆä¸æ˜¯æ•°ç»„ï¼Œæ— æ³•éå†ï¼ˆæ ¹æœ¬åŸå› æ˜¯æ— æ³•æ ¹æ®æŒ‡é’ˆçŸ¥é“æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚</li></ul><p><em>for-each</em>è¯­å¥çš„è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (element_declaration : array)</span><br><span class="line">   statement;</span><br></pre></td></tr></table></figure><p>è¯•ä¸€è¯•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> num:arr)</span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;num&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½èµ·æ¥äº†ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä¼˜åŒ–ä¸Šé¢çš„ç¨‹å¼ï¼Œè®©ä¸–ç•Œæ›´ç¾å¥½ï¼š</p><ul><li><strong>ä½¿ç”¨å¼•ç”¨</strong>ã€‚<em>for-each</em> ç”¨<u>å€¼å¤åˆ¶</u>æ–¹å¼æŠŠæ•°ç»„æ¯ä¸ªå…ƒç´ å¤åˆ¶ç»™<code>num</code> ï¼Œè¿™æ˜¾ç„¶æœ‰ç‚¹ç³Ÿç³•ï¼Œä½¿ç”¨<u>å¼•ç”¨æ›´å¥½</u>ã€‚</li><li><strong>constä¿®é¥°</strong>ã€‚ä¸€ä¸ªå¤§æ°”çš„ç¨‹åºå‘˜è¦å–„äºä½¿ç”¨constï¼Œè¿™é‡Œæ˜¾ç„¶ä¸éœ€è¦æ”¹åŠ¨</li></ul><p>è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨autoå…³é”®å­—è‡ªåŠ¨æ¨æ–­ç±»å‹ï¼ˆæ‡’è›‹ç‹‚å–œï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// autoå…³é”®å­—ä¼šæ¶ˆé™¤&amp;å’Œconstè¯­ä¹‰ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¾ç¤ºå£°æ˜</span></span><br><span class="line"><span class="comment">// è¯·å‚è€ƒï¼Œ3.XèŠ‚ï¼šå†è°ˆauto</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; num:arr)</span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;num&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¾å¥½çš„ä¸–ç•Œå€¼å¾—åŸè¯—ä¸€é¦–ã€‚</p><blockquote><p>æ·±åœ³å¤å¤©çš„é˜³å…‰åˆºå¾—çœ¼ç›çœ¯æˆä¸€æ¡ç¼</p><p>è…¾è®¯å¤§å¦å¤–å¤©ç©ºè“å¾—å¯ä»¥çœ‹è§ç™½äº‘</p><p>æ„Ÿè§‰ä¸€åˆ‡æš–æ´‹æ´‹ã€è½¯ç»µç»µ</p><p>æˆ‘ä¹Ÿæ…¢æ‚ æ‚ ã€æ™ƒè¡è¡</p><p>å¥½åƒå°±è¦é£˜å»å¤–å¤ªç©º</p><p>â€” by royhuang</p></blockquote><h5 id="è¿­ä»£å™¨">è¿­ä»£å™¨</h5><p><strong>è¿­ä»£å™¨</strong> æ—¨åœ¨ç”¨æ¥éå†å®¹å™¨çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œæ•°ç»„ä¸­çš„å€¼ï¼Œæˆ–å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼‰ï¼Œæä¾›å¯¹æ¯ä¸ªå…ƒç´ çš„<u>è®¿é—®</u>ã€‚</p><p>è¿­ä»£å™¨å¹¶æ²¡æœ‰é‚£ä¹ˆç¥ç§˜ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„æŒ‡é’ˆï¼ˆåº”è¯¥å·²ç»ç†Ÿæ‚‰äº†å§ï¼Ÿï¼‰å°±å¯ä»¥å½“åšè¿­ä»£å™¨ã€‚</p><p>ä¾æ—§æ˜¯æ”¹å†™ä¹‹å‰çš„ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* begin = arr; </span><br><span class="line"><span class="comment">// æ³¨æ„ï¼Œæ­¤æ—¶endæŒ‡å‘çš„æ•°ç»„å°¾å…ƒç´ ä¸‹ä¸€ä¸ªä½ç½®ï¼Œä¸æ˜¯å°¾å…ƒç´ </span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* end = begin+<span class="built_in"><span class="keyword">sizeof</span></span>(arr)/<span class="built_in"><span class="keyword">sizeof</span></span>(arr[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">// æ­¤æ—¶ptrå°±æ˜¯è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">int</span>* ptr = begin ; ptr != end ; ptr++)</span><br><span class="line">&#123;</span><br><span class="line">std::cout&lt;&lt;*ptr&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº<u>æ ‡å‡†åº“å®¹å™¨</u> è¿˜é€šå¸¸ä¼šç›´æ¥æä¾›å¯¹è¿­ä»£çš„æ”¯æŒï¼Œæ— éœ€è‡ªå·±å†™ã€‚</p><p>ä»¥<code>std::array</code> ä¸ºä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array array = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> begin =  array.<span class="built_in">begin</span>(); </span><br><span class="line">    <span class="keyword">auto</span> end =  array.<span class="built_in">end</span>() ; <span class="comment">// æ•°ç»„å°¾å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="comment">// è¿­ä»£å™¨åŸºäºforå¾ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> p=begin ; p != end; ++p) </span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; *p &lt;&lt; <span class="string">&#x27; &#x27;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä½ ä½¿ç”¨<em>for</em> æˆ–è€… <em>for_each</em> å¾ªç¯éå†åº“å®¹å™¨ä¹Ÿæ˜¯okçš„ã€‚</p><h5 id="å°ç»“">å°ç»“</h5><ul><li><p>éå†æ•°ç»„ã€åº“å®¹å™¨ç­‰å¯ä»¥ä½¿ç”¨<em>for</em>å¾ªç¯ã€<em>for_each</em>å¾ªç¯ä»¥åŠ<u>è¿­ä»£å™¨ï¼ˆåŸºäº<em>for</em>å¾ªç¯</u>ï¼‰ã€‚</p></li><li><p>åº“å®¹å™¨éƒ½æ”¯æŒè¿­ä»£å™¨ï¼Œå› æ­¤å¯¹äºåº“å®¹å™¨ï¼Œä½¿ç”¨<em>for</em>å¾ªç¯+è¿­ä»£å™¨æ›´å¥½ï¼ˆå¤æ‚çš„å¾ªç¯æœ€å¥½çš„åšæ³•æ˜¯ç»“åˆåº“å‡½æ•°ä½¿ç”¨ï¼Œæ¯”å¦‚<code>std::sort</code> ï¼Œ2.3.3èŠ‚ä»‹ç»ï¼‰ã€‚</p></li></ul><h4 id="2-3-2-ä½¿ç”¨æ›´å¥½çš„æ•°ç»„ï¼šarray-vector">2.3.2 ä½¿ç”¨æ›´å¥½çš„æ•°ç»„ï¼šarray&amp;vector</h4><p>åœ¨å‰é¢æˆ‘ä»¬è¯¦ç»†è®¨è®ºäº†å›ºå®šæ•°ç»„å’ŒåŠ¨æ€æ•°ç»„ï¼Œå°½ç®¡ä¸¤è€…éƒ½å†…ç½®äº C++ è¯­è¨€ä¸­ï¼Œä½†å®ƒä»¬éƒ½æœ‰ç¼ºç‚¹ï¼š</p><ol><li>å›ºå®šæ•°ç»„è¡°å‡ä¸ºæŒ‡é’ˆï¼Œè¿™æ ·åšæ—¶ä¼šä¸¢å¤±æ•°ç»„é•¿åº¦ä¿¡æ¯ï¼›</li><li>åŠ¨æ€æ•°ç»„å­˜åœ¨æ··ä¹±çš„é‡Šæ”¾é—®é¢˜ï¼Œå¹¶ä¸”éš¾ä»¥æ— è¯¯åœ°è°ƒæ•´å¤§å°ã€‚</li></ol><p>å› æ­¤æˆ‘ä»¬è¯´ä½¿ç”¨<u>array&amp;vector</u>æ›¿ä»£C++å†…ç½®æ•°ç»„ï¼Œæ˜¯æ›´å¥½çš„ç¼–ç¨‹å®è·µã€‚</p><h5 id="std-arrayï¼šæ›¿ä»£é™æ€æ•°ç»„">std::arrayï¼šæ›¿ä»£é™æ€æ•°ç»„</h5><p><code>std::array</code> æä¾›<u>å›ºå®š</u>çš„æ•°ç»„åŠŸèƒ½ï¼Œ<u>å½“ä¼ é€’ç»™å‡½æ•°æ—¶ä¸ä¼šè¡°å‡ï¼Œè€Œä¸”è¶…å‡ºèŒƒå›´æ—¶ä¼šè‡ªè¡Œæ¸…ç†</u>ã€‚</p><p>å£°æ˜å’Œä½¿ç”¨ä¸€ä¸ª<code>std::array</code>å˜é‡å¾ˆç®€å•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17å‰ä¸å…è®¸çœç•¥é•¿åº¦</span></span><br><span class="line">std::array&lt;<span class="keyword">int</span>, 3&gt; my_array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">my_array[<span class="number">1</span>];  <span class="comment">// å’Œæ™®é€šæ•°ç»„ä¸€æ ·ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°<code>std::array</code> å’Œæ™®é€šæ•°ç»„å·®åˆ«å¾ˆå¤§ï¼ˆå¯ä»¥é‡æ–°èµ‹å€¼ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_array = &#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;  <span class="comment">// é‡æ–°èµ‹å€¼ï¼Œå†…ç½®çš„æ•°ç»„æ›´åƒæ˜¯ä¸ªå¸¸é‡æŒ‡é’ˆï¼Œä¸€æ—¦åˆå§‹åŒ–ä¸èƒ½é‡æ–°èµ‹å€¼</span></span><br></pre></td></tr></table></figure><p>éªŒè¯ä¸€ä¸‹<code>std::array</code> ä½œä¸ºå‡½æ•°å‚æ•°ä¸ä¼šé€€åŒ–ä¸ºæŒ‡é’ˆã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> std::array&lt;<span class="keyword">float</span>, <span class="number">5</span>&gt;&amp; my_array)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; elem : my_array) <span class="comment">// ä¸ä¼šè¡°å‡ä¸ºæŒ‡é’ˆï¼Œå¯ä»¥ä½¿ç”¨for_eachå¾ªç¯</span></span><br><span class="line">        std::cout &lt;&lt; elem &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;<span class="keyword">float</span>, 5&gt; my_array = &#123; <span class="number">9.0</span>, <span class="number">7.2</span>, <span class="number">5.4</span>, <span class="number">3.6</span>, <span class="number">1.8</span> &#125;;</span><br><span class="line">    <span class="built_in">printArray</span>(my_array);  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// my_arrayè¢«è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9 7.2 5.4 3.6 1.8 </span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–ï¼šä½¿ç”¨æ¨¡æ¿è®©å‡½æ•°æ”¯æŒ<u>ä»»æ„ç±»å‹çš„å‚æ•°ã€é•¿åº¦</u>çš„æ•°ç»„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, std::<span class="keyword">size_t</span> size&gt; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> std::array&lt;T, size&gt;&amp; my_array)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; elem : my_array)</span><br><span class="line">        std::cout &lt;&lt; elem &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ¶‰åŠåˆ°æ¨¡æ¿ç›¸å…³çŸ¥è¯†ï¼Œæš‚ä¸ç»†è¡¨ã€‚</p><p>å½“ç„¶ï¼Œ<code>std::array</code>ä¸é™äºæ•°å­—ä½œä¸ºå…ƒç´ ï¼Œå¯ä»¥åœ¨å¸¸è§„æ•°ç»„ä¸­ä½¿ç”¨çš„æ¯ç§ç±»å‹éƒ½å¯ä»¥åœ¨<code>std::array</code>ä¸­ä½¿ç”¨ã€‚</p><p><strong>è¯·çœ‹ä¸‹é¢çš„ç»“æ„æ•°ç»„</strong>ã€‚</p><p>æ³¨æ„ç›¸æ¯”æ™®é€šç»“æ„ä½“æ•°ç»„ï¼Œarrayç»“æ„ä½“æ•°ç»„åˆå§‹åŒ–è¿˜è¦å¤šä¸€å¯¹å¤§æ‹¬å·ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">House</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> number&#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> stories&#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> roomsPerStory&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    House houses[] = </span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        &#123; 13, 4, 30 &#125;,</span></span><br><span class="line"><span class="comment">        &#123; 14, 3, 10 &#125;,</span></span><br><span class="line"><span class="comment">        &#123; 15, 3, 40 &#125;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    std::array&lt;House, 3&gt; houses = </span><br><span class="line">    &#123; </span><br><span class="line">        &#123;  <span class="comment">// å¤–ä¾§å¤šäº†ä¸€å¯¹å¤§æ‹¬å·ï¼Œå¦åˆ™åˆå§‹åŒ–ä¼šå‡ºé”™</span></span><br><span class="line">            &#123;<span class="number">13</span>, <span class="number">4</span>, <span class="number">30</span> &#125;,  </span><br><span class="line">            &#123;<span class="number">14</span>, <span class="number">3</span>, <span class="number">10</span> &#125;, </span><br><span class="line">            &#123;<span class="number">15</span>, <span class="number">3</span>, <span class="number">40</span> &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; house : houses)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;House number &quot;</span> &lt;&lt; house.number</span><br><span class="line">                  &lt;&lt; <span class="string">&quot; has &quot;</span> &lt;&lt; (house.stories * house.roomsPerStory)</span><br><span class="line">                  &lt;&lt; <span class="string">&quot; rooms\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">House number 13 has 120 rooms</span><br><span class="line">House number 14 has 30 rooms</span><br><span class="line">House number 15 has 120 rooms</span><br></pre></td></tr></table></figure><blockquote><p><code>std::array</code>  æœ‰ç”¨çš„æ–¹æ³•ã€‚</p></blockquote><p>å…¬å…±ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::array&lt;<span class="keyword">int</span>, 5&gt; my_array = &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> &#125;;</span><br></pre></td></tr></table></figure><ol><li><p>è·å–å¤§å°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myArray.<span class="built_in">size</span>(); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure></li><li><p>æ’åº</p><p>2.3.3èŠ‚æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span> <span class="comment">// for std::sort</span></span></span><br><span class="line"></span><br><span class="line">std::<span class="built_in">sort</span>(myArray.<span class="built_in">begin</span>(), myArray.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure></li></ol><p><strong>å°ç»“</strong>ï¼š<code>std::array</code> å£°æ˜æ—¶å¿…é¡»è¦æŒ‡å®šé•¿åº¦æœ‰ç‚¹ç¬¨æ‹™ï¼Œä½†å®ƒæœ‰å¾ˆå¤šä¼˜ç‚¹----<u>æ¯”å¦‚ä¸ä¼šé€€åŒ–ä¸ºæŒ‡é’ˆ</u>ã€<u>ä¸ç”¨æ‰‹åŠ¨é‡Šæ”¾å†…å­˜</u>ï¼Œ<u>æ ‡å‡†åº“ä¼—å¤šå‡½æ•°æ”¯æŒ</u>ã€‚æ‰€ä»¥å°½å¯èƒ½åœ°å»ä½¿ç”¨å®ƒæ›¿ä»£æ™®é€šé™æ€æ•°ç»„å§ã€‚</p><h5 id="std-vectorï¼šæ›¿ä»£åŠ¨æ€æ•°ç»„">std::vectorï¼šæ›¿ä»£åŠ¨æ€æ•°ç»„</h5><p>ç›¸æ¯”<code>std::array</code> æä¾›<u>å›ºå®š</u>çš„æ•°ç»„ ï¼Œ<code>std::vector</code> åŒæ ·ä¼šè‡ªåŠ¨ç®¡ç†æ•°ç»„å†…å­˜ï¼Œä¸è¡°å‡ä¸ºæŒ‡é’ˆã€‚</p><p>è€Œä¸”<code> std::vector</code> è¿˜æ”¯æŒ<u>å¯å˜</u>çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯<u>åŠ¨æ€æ•°ç»„</u>ã€‚</p><p>ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œæ³¨æ„åˆ° <code>std::vector</code>å£°æ˜æ—¶ä¸å¿…æŒ‡æ˜é•¿åº¦ï¼ˆåŠ¨æ€æ•°ç»„ç‰¹æ€§ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; array;  <span class="comment">// åŠ¨æ€æ•°ç»„ï¼Œå¯ç¨ååˆå§‹åŒ–ï¼Œä¸å¿…æŒ‡é’ˆé•¿åº¦</span></span><br><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; array2 = &#123; <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line">array2 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;  <span class="comment">// å¯ä»¥é‡æ–°åˆ†é…</span></span><br><span class="line">array[<span class="number">1</span>]; <span class="comment">// ä½¿ç”¨å’Œæ™®é€šæ•°ç»„ä¸€æ ·</span></span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œ<code>std::vector</code> ä½œä¸ºå‡½æ•°å‚æ•°ä¸ä¼šé€€åŒ–ä¸ºæŒ‡é’ˆï¼Œè¿™é‡Œä¸å†é‡å¤éªŒè¯ã€‚</p><blockquote><p><code>std::vector</code>  æœ‰ç”¨çš„æ–¹æ³•ã€‚</p></blockquote><p>å…¬å…±ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; my_array = &#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> &#125;;</span><br></pre></td></tr></table></figure><ol><li><p>è·å–å¤§å°</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_array.<span class="built_in">size</span>(); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure></li><li><p>è°ƒæ•´å¤§å°</p><p>è°ƒå¤§åå¤šä½™ç©ºé—´é»˜è®¤ç”¨<code>0</code>å¡«å……ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_array.<span class="built_in">resize</span>(<span class="number">8</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i : my_array)</span><br><span class="line">    std::cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>; <span class="comment">// 1 2 3 4 5 0 0 0</span></span><br></pre></td></tr></table></figure><p>å‘ä¸‹è°ƒæ•´ï¼Œåªæ‰“å°resizeåé•¿åº¦åŒ…å«çš„å…ƒç´ ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_array.<span class="built_in">resize</span>(<span class="number">3</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i : my_array)</span><br><span class="line">    std::cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>; <span class="comment">// 1 2 3</span></span><br></pre></td></tr></table></figure></li></ol><blockquote><p>å°ç»†èŠ‚ï¼š<code>std::vector</code>  ä¸­å®¹é‡å’Œé•¿åº¦å¹¶ä¸ç›¸ç­‰ã€‚</p></blockquote><p><strong>é•¿åº¦</strong>æ˜¯æ•°ç»„ä¸­ä½¿ç”¨äº†å¤šå°‘å…ƒç´ ï¼Œè€Œ<strong>å®¹é‡</strong>æ˜¯åœ¨å†…å­˜ä¸­åˆ†é…äº†å¤šå°‘å…ƒç´ ã€‚</p><p>ä¸ºäº†é¿å…é¢‘ç¹çš„<code>resize</code>åˆ†é…ç©ºé—´ï¼ˆè°ƒæ•´æ•°ç»„å¤§å°é€šå¸¸<u>ä»£ä»·æ¯”è¾ƒæ˜‚è´µ</u>ï¼‰ï¼Œ<code>std::vector</code> ä¸­é•¿åº¦å’Œå®¹é‡ä¸ä¸€å®šç›¸ç­‰ã€‚</p><p>ä¸‹é¢ä»£ç çœ‹èµ·æ¥å¥½åƒä¸€åˆ‡æ­£å¸¸ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; array2 = &#123; <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; array2.<span class="built_in">size</span>() &lt;&lt;std::endl;</span><br><span class="line">std::cout &lt;&lt; array2.<span class="built_in">capacity</span>() &lt;&lt;std::endl;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">5</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬å¦‚æœè¿›è¡Œ<code>resize</code>åå†çœ‹ ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array2.<span class="built_in">resize</span>(<span class="number">3</span>);</span><br><span class="line">std::cout &lt;&lt; array2.<span class="built_in">size</span>() &lt;&lt;std::endl; <span class="comment">// []åŸºäºé•¿åº¦ï¼Œarray[4]éæ³•</span></span><br><span class="line">std::cout &lt;&lt; array2.<span class="built_in">capacity</span>() &lt;&lt;std::endl;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">5</span><br></pre></td></tr></table></figure><p>å®¹é‡ä¾æ—§æ˜¯<code>5</code> å¹¶æ²¡æœ‰éšä¹‹æ”¹å˜ï¼Œå³é¢„ç•™äº†ä¸€äº›ç©ºé—´ï¼Œ<u>è¿™æ ·å¦‚æœå†æ¬¡å‘ç”Ÿresize&lt;=5å¯ä»¥ä¸ç”¨é‡æ–°åˆ†é…ç©ºé—´</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array2.<span class="built_in">resize</span>(<span class="number">4</span>);</span><br><span class="line">std::cout &lt;&lt; array2.<span class="built_in">size</span>() &lt;&lt;std::endl;</span><br><span class="line">std::cout &lt;&lt; array2.<span class="built_in">capacity</span>() &lt;&lt;std::endl;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span>  # æ•°ç»„å®é™…ä¸Šæ²¡æœ‰è¿›è¡Œresizeï¼Œè¿˜æ˜¯ä¹‹å‰çš„å®¹é‡<span class="number">4</span></span><br></pre></td></tr></table></figure><blockquote><p>leetcodeç¥å™¨ï¼š<code>std::vector</code> è¿˜æœ‰ä¸€å¤§ç”¨é€”æ˜¯ä½œä¸ºå †æ ˆä½¿ç”¨ã€‚</p></blockquote><p>ä¸€ä¸ªç®€å•çš„å°ä¾‹å­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printStack</span><span class="params">(<span class="keyword">const</span> std::vector&lt;<span class="keyword">int</span>&gt;&amp; stack)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> element : stack)</span><br><span class="line">std::cout &lt;&lt; element &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;(cap &quot;</span> &lt;&lt; stack.<span class="built_in">capacity</span>() &lt;&lt; <span class="string">&quot; length &quot;</span> &lt;&lt; stack.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; stack&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printStack</span>(stack);   <span class="comment">// (cap 0 length 0)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3--&gt;2--&gt;1 ä¾æ¬¡å‹å…¥</span></span><br><span class="line">stack.<span class="built_in">push_back</span>(<span class="number">3</span>); </span><br><span class="line"><span class="built_in">printStack</span>(stack);   <span class="comment">// 3 (cap 1 length 1)</span></span><br><span class="line"></span><br><span class="line">stack.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">printStack</span>(stack);   <span class="comment">// 3 2 (cap 2 length 2)</span></span><br><span class="line"></span><br><span class="line">stack.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line"><span class="built_in">printStack</span>(stack);  <span class="comment">// 3 2 1 (cap 4 length 3)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1--&gt;2--&gt;3 ä¾æ¬¡å¼¹å‡º</span></span><br><span class="line">stack.<span class="built_in">pop_back</span>(); </span><br><span class="line"><span class="built_in">printStack</span>(stack); <span class="comment">// 3 2 (cap 4 length 2)</span></span><br><span class="line"></span><br><span class="line">stack.<span class="built_in">pop_back</span>();</span><br><span class="line"><span class="built_in">printStack</span>(stack); <span class="comment">// 3 (cap 4 length 1)</span></span><br><span class="line"></span><br><span class="line">stack.<span class="built_in">pop_back</span>();</span><br><span class="line"><span class="built_in">printStack</span>(stack); <span class="comment">// (cap 4 length 0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ä¸ªç»†èŠ‚éœ€æ³¨æ„ï¼š</p><ol><li>å®¹é‡ç»è¿‡ï¼š0â€“&gt;1â€“&gt;2â€“&gt;4ï¼Œå››æ¬¡è°ƒæ•´å®¹é‡ï¼Œæ¯”è¾ƒå½±å“æ€§èƒ½ï¼›</li><li>å½“<code>vector</code>è¢«è°ƒæ•´å¤§å°æ—¶ï¼Œå¯èƒ½ä¼šåˆ†é…æ¯”éœ€è¦çš„æ›´å¤šçš„å®¹é‡ï¼ˆç¬¬ä¸‰æ¬¡pushè¿›<code>1</code>åï¼Œå®¹é‡ä»2â€“&gt;4ï¼Œè€Œä¸æ˜¯2â€“&gt;3ï¼‰ã€‚</li></ol><p>ä¸ºäº†é¿å…å®¹é‡è¢«é¢‘ç¹è°ƒæ•´ï¼Œæˆ‘ä»¬å¯ä»¥æå‰åˆ†é…ä¸€å®šå®¹é‡ï¼ˆleetcodeé¿å…è¶…æ—¶ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ åˆ°ä»£ç 14è¡Œå¤„</span></span><br><span class="line">stack.<span class="built_in">reserve</span>(<span class="number">5</span>);   <span class="comment">// é¢„åˆ†é…å®¹é‡5</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰“å°å‡ºå®¹é‡å˜åŒ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(cap 5 length 0)</span><br><span class="line">3 (cap 5 length 1)</span><br><span class="line">3 2 (cap 5 length 2)</span><br><span class="line">3 2 1 (cap 5 length 3)</span><br><span class="line">3 2 (cap 5 length 2)</span><br><span class="line">3 (cap 5 length 1)</span><br><span class="line">(cap 5 length 0)</span><br></pre></td></tr></table></figure><p>perfect~æ•´ä¸ªè¿‡ç¨‹é™¤äº†ç¬¬ä¸€æ¬¡è°ƒæ•´è¿‡å®¹é‡ï¼Œä¾¿æ²¡æœ‰å†æ¬¡è°ƒæ•´è¿‡äº†ã€‚</p><h4 id="2-3-3-å¤šä½¿ç”¨æ ‡å‡†åº“ç®—æ³•">2.3.3 å¤šä½¿ç”¨æ ‡å‡†åº“ç®—æ³•</h4><p>å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œåº“å®¹å™¨<code>std::array</code>ã€<code>std::vector</code>ä¸€å¤§å¥½å¤„å°±æ˜¯è¢«æ ‡å‡†åº“æ”¯æŒå¾ˆå¤šç›¸å…³ç®—æ³•ã€‚</p><ul><li><p>å¯¹äºæ–°æ‰‹ç¨‹åºå‘˜ç©å®¶æ¥è¯´ï¼Œ<u>è‡ªå·±å†™å¾ªç¯éå†æ•°ç»„æ˜¯ç»å¸¸éœ€è¦åšçš„äº‹</u>ã€‚ç®€å•çš„å¯èƒ½åªæ˜¯ä¸ºäº†<u>æ‰“å°</u>ä¸‹æ•°ç»„ï¼Œå¤æ‚ç‚¹å¯èƒ½è¿˜è¦å»å¤„ç†æ•°ç»„<u>æ’åº</u>ã€<u>æŸ¥æ‰¾</u>ã€<u>è®¡æ•°</u>ç­‰ã€‚</p></li><li><p>ä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„<u>åº“å®¹å™¨</u>ï¼Œå°±å¯ä»¥å¾ˆå¥½é…åˆC++æ ‡å‡†åº“å‡½æ•°ï¼Œè½»æ¾åœ°å®Œæˆå¤æ‚çš„å¾ªç¯å¤„ç†æ“ä½œï¼ˆå¤§ä½¬é¢„å…ˆå¸®ä½ å†™å¥½æ¥å£ä¸èˆ’æœå˜›ï¼Ÿï¼‰ã€‚</p></li></ul><p>C++æ ‡å‡†åº“æä¾›çš„å‡½æ•°åŠŸèƒ½åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li><strong>Inspectors</strong> ï¼šæ£€æŸ¥å™¨ï¼Œä»…åªè¯»å®¹å™¨ä¸­çš„æ•°æ®ï¼Œæ¯”å¦‚æœç´¢å’Œè®¡æ•°ï¼›</li><li><strong>Mutators</strong> ï¼šä¿®æ”¹å™¨ï¼Œä¿®æ”¹å®¹å™¨ä¸­æ•°æ®ï¼Œæ¯”å¦‚æ’åºæˆ–åˆ†å‘ï¼›</li><li><strong>Facilitators</strong>ï¼šä¿ƒè¿›å™¨ï¼Œæ ¹æ®æ•°æ®æˆå‘˜çš„å€¼ç”Ÿæˆç»“æœã€‚</li></ul><p>æœ¬èŠ‚å°†ä»‹ç»å¸¸ç”¨çš„ä¸€äº›ç®—æ³•ï¼Œè™½ç„¶åªæ˜¯ä¸€å°éƒ¨åˆ†ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ç®—æ³•å·¥ä½œæ–¹å¼ç›¸ä¼¼ã€‚å…³é”®åœ¨äºäº†è§£å…¶å·¥ä½œåŸç†ï¼Œå°±å¯ä»¥è½»æ¾ä½¿ç”¨å…¶å®ƒç®—æ³•ã€‚</p><h5 id="éå†ï¼šstd-for-each">éå†ï¼šstd::for_each</h5><p><code>std::for_each</code>ç®€ä»‹ï¼š</p><ul><li>è¾“å…¥ï¼šåˆ—è¡¨ï¼Œæ¯ä¸ªåˆ—è¡¨å…ƒç´ çš„æ“ä½œè§„åˆ™ï¼›</li><li>è¾“å‡ºï¼šæŒ‡å®šæ“ä½œåçš„åˆ—è¡¨ï¼›</li><li>åº”ç”¨ï¼šå½“æˆ‘ä»¬å¸Œæœ›<u>å¯¹åˆ—è¡¨æ‰§è¡Œç›¸åŒæ“ä½œ</u>æ—¶ã€‚</li></ul><p>ä¸¾ä¾‹è¯´æ˜ï¼šå¯¹åˆ—è¡¨æ¯ä¸ªå…ƒç´ è¶…çº§åŠ å€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doubleNumber</span><span class="params">(<span class="keyword">int</span>&amp; i)</span>  <span class="comment">// è¶…çº§åŠ å€</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    i *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;<span class="keyword">int</span>,6&gt; arr = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line">    <span class="comment">// å¯¹è¿­ä»£å™¨è·å–çš„æ¯ä¸ªå…ƒç´ è¿›è¡ŒæŒ‡å®šæ“ä½œï¼ˆdoubleNumberï¼‰</span></span><br><span class="line">    std::for_each(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), doubleNumber);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : arr)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 4 6 8</span><br></pre></td></tr></table></figure><p><strong>ç›¸æ¯”ä¹‹ä¸‹ä¼¼ä¹å†…ç½®çš„<em>for_each</em> å¾ªç¯è¿˜èƒ½å®ç°å¾—æ›´ç®€å•ï¼Ÿè¿™ä¸ªä¾‹å­æ²¡çœ‹åˆ°ç›¸æ¯”<em>for</em> å¾ªç¯æœ‰ä»€ä¹ˆä¼˜åŠ¿</strong>ï¼Ÿ</p><ul><li>ç›¸æ¯”<em>for</em> å¾ªç¯ï¼Œ<em>for_each</em> èƒ½æ›´æ¸…æ™°è¡¨è¾¾æˆ‘ä»¬çš„æ„å›¾ä¹Ÿæ›´ä¸å®¹æ˜“å‡ºé”™ï¼ˆä¸ç”¨å®šä¹‰é¢å¤–çš„ç´¢å¼•å˜é‡<code>i</code>ï¼‰ï¼›</li><li><code>std::for_each</code>æ”¯æŒå¹¶è¡ŒåŒ–ï¼Œæ›´é€‚åˆå¤§é¡¹ç›®/å¤§æ•°æ®ã€‚</li></ul><h5 id="æ’åºï¼šstd-sort">æ’åºï¼šstd::sort</h5><p><code>std::sort</code>ç®€ä»‹ï¼š</p><ul><li>è¾“å…¥ï¼šåˆ—è¡¨ï¼Œä¸¤ä¸ªå…ƒç´ æ¯”è¾ƒè§„åˆ™ï¼›</li><li>è¾“å‡ºï¼šæ’åºåçš„åˆ—è¡¨ï¼›</li><li>åº”ç”¨ï¼šå½“æˆ‘ä»¬å¸Œæœ›<u>å¯¹åˆ—è¡¨è¿›è¡Œæ’åº</u>æ—¶ã€‚</li></ul><p><code>std::sort</code> æ’åºå®ä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">greater</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Order @a before @b if @a is greater than @b.</span></span><br><span class="line">    <span class="keyword">return</span> (a &gt; b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;<span class="keyword">int</span>,6&gt; arr = &#123; <span class="number">13</span>, <span class="number">90</span>, <span class="number">99</span>, <span class="number">5</span>, <span class="number">40</span>, <span class="number">80</span> &#125;;</span><br><span class="line">    <span class="comment">// greaterå®šä¹‰åˆ—è¡¨ä¸¤ä¸ªå…ƒç´ æ¯”è¾ƒè§„åˆ™</span></span><br><span class="line">    std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), greater);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : arr)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">99 90 80 40 13 5</span><br></pre></td></tr></table></figure><p>å¥½æ¶ˆæ¯ï¼Œå› ä¸ºé™åºæ’åºå¾ˆæ™®éï¼ŒC++å¤§å¼€æ–¹ä¾¿ä¹‹é—¨æä¾›äº†<u>è‡ªå®šä¹‰ç±»å‹</u><code>std::greater</code> ï¼Œè€Œä¸ç”¨æˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), std::greater&lt;<span class="keyword">int</span>&gt;());</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°ï¼Œ<code>std::greater</code> è°ƒç”¨æœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºå®ƒæ˜¯ä¸ªæ¨¡æ¿ç±»ï¼ˆå‚æ•°ç±»å‹è¦æ±‚æ˜¯å‡½æ•°æŒ‡é’ˆï¼‰ï¼š1ï¼‰<code>&lt;int&gt;</code> ä¼ å…¥æ¨¡æ¿å‚æ•°ï¼Œ2ï¼‰ç±»ä¸­é‡è½½äº†æ“ä½œç¬¦<code>()</code> ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚</p><h5 id="æŸ¥æ‰¾ï¼šstd-find-std-find-if">æŸ¥æ‰¾ï¼šstd::find  &amp; std::find_if</h5><p><code>std::find</code>ç®€ä»‹ï¼š</p><ul><li>è¾“å…¥ï¼šåˆ—è¡¨ï¼Œè¢«æŸ¥æ‰¾çš„å…ƒç´ ï¼›</li><li>è¾“å‡ºï¼šï¼ˆæ‰¾åˆ°æ—¶ï¼‰å…ƒç´ çš„æŒ‡é’ˆï¼Œï¼ˆæœªæ‰¾åˆ°æ—¶ï¼‰å°¾å…ƒç´ çš„æŒ‡é’ˆï¼›</li><li>åº”ç”¨ï¼šå½“æˆ‘ä»¬å¸Œæœ›<u>æŸ¥æ‰¾æŸä¸ªå…ƒç´ æ—¶</u>æ—¶ã€‚</li></ul><p>ä¸‹é¢ä»£ç å±•ç¤ºï¼šæ‰¾åˆ°å®¹å™¨æŒ‡å®šçš„æŸä¸ªå…ƒç´ ï¼Œå¹¶è¿›è¡Œä¿®æ”¹æ›¿æ¢ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::array&lt;<span class="keyword">int</span>,6&gt; arr = &#123; <span class="number">13</span>, <span class="number">90</span>, <span class="number">99</span>, <span class="number">5</span>, <span class="number">40</span>, <span class="number">80</span> &#125;;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;è¾“å…¥è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œå’Œæ¬²æ›¿æ¢çš„å€¼: &quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> search=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> replace=<span class="number">-1</span>;</span><br><span class="line">    std::cin &gt;&gt; search &gt;&gt; replace;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾å…ƒç´ </span></span><br><span class="line">    <span class="keyword">auto</span> found =  std::<span class="built_in">find</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), search);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æ‰¾åˆ°</span></span><br><span class="line">    <span class="keyword">if</span> (found == arr.<span class="built_in">end</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æœªæ‰¾åˆ°æŒ‡å®šå…ƒç´ ï¼š &quot;</span> &lt;&lt; search &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰¾åˆ°ï¼Œè¿˜è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">        *found = replace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt;<span class="string">&quot;found: &quot;</span> &lt;&lt; *found &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@roy-cpp <span class="built_in">test</span>]<span class="comment"># ./test.out </span></span><br><span class="line">è¾“å…¥è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œå’Œæ¬²æ›¿æ¢çš„å€¼ 99 -1</span><br><span class="line">found: -1</span><br><span class="line">[root@roy-cpp <span class="built_in">test</span>]<span class="comment"># ./test.out </span></span><br><span class="line">è¾“å…¥è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œå’Œæ¬²æ›¿æ¢çš„å€¼ 12 -1</span><br><span class="line">æœªæ‰¾åˆ°æŒ‡å®šå…ƒç´ ï¼š 12</span><br><span class="line">found: 1767305032</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿˜å¸Œæœ›æ›´çµæ´»å»è‡ªå®šä¹‰æŸ¥æ‰¾è§„åˆ™ï¼Œè¯·ä½¿ç”¨<code>std::find_if</code> ã€‚</p><p><code>std::find_if</code>ç®€ä»‹ï¼š</p><ul><li>è¾“å…¥ï¼šåˆ—è¡¨ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„æŸ¥æ‰¾è§„åˆ™ï¼›</li><li>è¾“å‡ºï¼šï¼ˆæ‰¾åˆ°æ—¶ï¼‰å…ƒç´ çš„æŒ‡é’ˆï¼Œï¼ˆæœªæ‰¾åˆ°æ—¶ï¼‰å°¾å…ƒç´ çš„æŒ‡é’ˆï¼›</li><li>åº”ç”¨ï¼šå½“æˆ‘ä»¬å¸Œæœ›<u>è‡ªå®šä¹‰æŸ¥æ‰¾æŸä¸ªå…ƒç´ æ—¶</u>æ—¶ã€‚</li></ul><p>ä¸€ä¸ªç¤ºä¾‹ï¼Œ<code>std::find_if</code>æŸ¥æ‰¾å­å­—ç¬¦ä¸²â€œnutâ€ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string_view&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">containsNut</span><span class="params">(std::string_view str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// str.findå¯ç”¨æ¥æŸ¥æ‰¾æŒ‡å®šå­ä¸²</span></span><br><span class="line">    <span class="comment">// æ‰¾åˆ°è¿”å›trueï¼Œå¦åˆ™false</span></span><br><span class="line">    <span class="keyword">return</span> (str.<span class="built_in">find</span>(<span class="string">&quot;nut&quot;</span>) != std::string_view::npos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// &quot;walnut&quot;åŒ…å«è¦æŸ¥æ‰¾çš„å­ä¸²&quot;nut&quot;</span></span><br><span class="line">    std::array&lt;std::string_view, 4&gt; arr = &#123; <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;walnut&quot;</span>, <span class="string">&quot;lemon&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> found = &#123; std::<span class="built_in">find_if</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), containsNut) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (found == arr.<span class="built_in">end</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ²¡æ‰¾åˆ°â€œnutsâ€\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ‰¾åˆ°äº†ï¼š &quot;</span> &lt;&lt; *found &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ‰¾åˆ°äº†ï¼š walnut</span><br></pre></td></tr></table></figure><p>æœ¬æ¥è‡³å°‘éœ€è¦ä¸‰ä¸ªå¾ªç¯ï¼Œä½¿ç”¨æ ‡å‡†åº“å‡½æ•°åªç”¨å‡ è¡Œä»£ç å°±å®Œæˆäº†ã€‚</p><h5 id="ç»Ÿè®¡ï¼šstd-count-std-count-if">ç»Ÿè®¡ï¼šstd::count &amp; std::count_if</h5><p><code>std::count</code>å’Œ<code>std::count_if</code>ç»Ÿè®¡æŒ‡å®šå…ƒç´ æˆ–æ»¡è¶³è‡ªå®šä¹‰çš„æŸ¥æ‰¾è§„åˆ™çš„å…ƒç´ å‡ºç°æ¬¡æ•°ã€‚</p><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¡ç®—æœ‰å¤šå°‘å…ƒç´ åŒ…å«å­å­—ç¬¦ä¸²â€œnutâ€ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string_view&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">containsNut</span><span class="params">(std::string_view str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (str.<span class="built_in">find</span>(<span class="string">&quot;nut&quot;</span>) != std::string_view::npos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::array&lt;std::string_view, 5&gt; arr = &#123; <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;walnut&quot;</span>, <span class="string">&quot;lemon&quot;</span>, <span class="string">&quot;peanut&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">auto</span> nuts = &#123; std::<span class="built_in">count_if</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), containsNut) &#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;å…±è®¡ï¼š&quot;</span> &lt;&lt; nuts &lt;&lt; <span class="string">&quot; nut(s)\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å…±è®¡ï¼š2 nut(s)</span><br></pre></td></tr></table></figure><h4 id="2-3-X-æœ€ä½³å®è·µ">2.3.X æœ€ä½³å®è·µ</h4><ul><li>å–„äºä½¿ç”¨å®¹å™¨+ç®—æ³•åº“ä¸­çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯ç¼–å†™è‡ªå·±çš„å‡½æ•°æ¥åšåŒæ ·çš„äº‹æƒ…ï¼Œè¿™å¯ä»¥ä½¿æˆ‘ä»¬çš„ä»£ç æ›´ç®€å•ã€æ›´å¥å£®ã€‚</li><li>å…·ä½“æ¥è¯´ï¼Œæ•°ç»„ç«‹é©¬æƒ³åˆ°<code>std::array</code>ã€<code>std::vector</code> ï¼›<u>ç®€å•</u>å¾ªç¯ç«‹é©¬æƒ³åˆ°<em>for_each</em> æˆ–è€… <em>std::for_each</em> ï¼›å¾ªç¯è¿˜éœ€è¦ç»“åˆ<u>å¤æ‚</u>çš„æ“ä½œï¼Œè¯·å°½é‡ä½¿ç”¨<code>std::sort</code> ç­‰æ ‡å‡†åº“ç®—æ³•ã€‚</li></ul><h3 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h3><div class="timeline"><div class="timenode"><div class="meta"><p><p>2021-01-30 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ä¿®æ”¹æ™ºèƒ½æŒ‡é’ˆç›¸å…³æè¿°</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-01-07 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ç¬¬ä¸€æ¬¡æ›´æ–°</li></ol></div></div></div><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">æ¢³ç†c++ const ä¿®é¥°å‡½æ•°ï¼šhttps://zhuanlan.zhihu.com/p/110159656<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ç¬¬ 5 ç«  æ™ºèƒ½æŒ‡é’ˆä¸å†…å­˜ç®¡ç†ï¼šhttps://changkun.de/modern-cpp/zh-cn/05-pointers/#5-1-RAII-%E4%B8%8E%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ç†è§£ C++ æ™ºèƒ½æŒ‡é’ˆï¼šhttps://supwills.com/post/understanding-cpp-smart-pointer/<a href="#fnref:3" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++åŸºç¡€ </tag>
            
            <tag> æŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŠ¡å®åŸºç¡€ï¼ˆä¸‹ï¼‰å‡½æ•°</title>
      <link href="/p/51595/"/>
      <url>/p/51595/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><h2 id="ä¸‰ã€å‡½æ•°">ä¸‰ã€å‡½æ•°</h2><h3 id="3-1-åŸºæœ¬æ¦‚å¿µ">3.1 åŸºæœ¬æ¦‚å¿µ</h3><blockquote><p>æ€ä¹ˆå®šä¹‰å‡½æ•°ï¼Ÿ</p></blockquote><p>ä»¥å‰ï¼Œæˆ‘æ¯”è¾ƒå€¾å‘å°†å‡½æ•°å®šä¹‰ä¸º<strong>é¡ºåºæ‰§è¡Œçš„è¯­å¥é›†åˆ</strong>ã€‚ç°åœ¨æˆ‘è®¤ä¸ºæ›´æ°å½“çš„è¯´æ³•åº”è¯¥æ˜¯ï¼š<strong>å‡½æ•°æ˜¯ä¸€ä¸ª<u>å¯é‡ç”¨</u>çš„è¯­å¥åºåˆ—ï¼Œæ—¨åœ¨å®Œæˆç‰¹å®šçš„å·¥ä½œ</strong>ã€‚<br>C++ ä¸­å‡½æ•°ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">return_type <span class="title">function_name</span><span class="params">( parameter_list )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// body of the function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢åŒ…å«ä¸€ä¸ªå‡½æ•°çš„æ‰€æœ‰ç»„æˆéƒ¨åˆ†ï¼š</p><ul><li><strong>è¿”å›ç±»å‹(return_type)</strong>ï¼šä¸€ä¸ªå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå€¼ï¼Œ<strong>return_type</strong> æ˜¯å‡½æ•°è¿”å›çš„å€¼çš„æ•°æ®ç±»å‹ã€‚ä¸éœ€è¦è¿”å›å€¼ï¼Œreturn_type æ˜¯å…³é”®å­— <strong>void</strong>ã€‚</li><li><strong>å‡½æ•°åç§°(function_name)</strong>ï¼šå‡½æ•°çš„å®é™…åç§°ï¼Œ<strong>å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ä¸€èµ·æ„æˆäº†å‡½æ•°ç­¾å</strong>ã€‚<ul><li>æ‰€è°“â€ç­¾åâ€œåˆ™æ„å‘³ç€è¿™å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå‡½æ•°ã€‚</li></ul></li><li><strong>å‚æ•°åˆ—è¡¨(parameter_list)</strong>ï¼šå‚æ•°å°±åƒæ˜¯å ä½ç¬¦ã€‚å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯å‘å‚æ•°ä¼ é€’ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼è¢«ç§°ä¸ºå®é™…å‚æ•°ï¼Œå‚æ•°åˆ—è¡¨åŒ…æ‹¬å‡½æ•°å‚æ•°çš„<strong>ç±»å‹ã€é¡ºåºã€æ•°é‡</strong>ã€‚<ul><li>å‚æ•°åˆ—è¡¨çš„é¡ºåºã€ç±»å‹ã€æ•°é‡ä¸å®Œå…¨ä¸€è‡´çš„è¯ï¼Œå½¢æˆä¸åŒå‡½æ•°ç­¾åï¼Œå³æ˜¯ä¸åŒå‡½æ•°ã€‚</li></ul></li><li><strong>å‡½æ•°ä¸»ä½“(boby)</strong>ï¼šå‡½æ•°ä¸»ä½“åŒ…å«ä¸€ç»„å®šä¹‰å‡½æ•°æ‰§è¡Œä»»åŠ¡çš„è¯­å¥ã€‚</li></ul><p>ç‰¹åˆ«çš„ï¼ŒC++æ˜¯ä¸æ”¯æŒåµŒå¥—å‡½æ•°çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å‡ºé”™</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">max1</span><span class="params">(<span class="keyword">int</span> num1=<span class="number">0</span>, <span class="keyword">int</span> num2)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1&gt;num2?num1:num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-1-1-å‰å‘å£°æ˜ğŸŒŸ">3.1.1 å‰å‘å£°æ˜ğŸŒŸ</h4><h5 id="å‰å‘å£°æ˜åˆè¯†">å‰å‘å£°æ˜åˆè¯†</h5><p>åœ¨å¾ˆå¤šIDEä¸­ï¼Œå¦‚æœä½ å°è¯•åœ¨mainå‡½æ•°ä½¿ç”¨æœªåœ¨ä¹‹å‰å®šä¹‰çš„å‡½æ•°ï¼Œä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">max</span>(<span class="number">1</span>,<span class="number">2</span>); <span class="comment">// ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°è¿”å›ä¸¤ä¸ªæ•°ä¸­è¾ƒå¤§çš„é‚£ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> num1&gt;num2?num1:num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º<strong>maxå‡½æ•°å®šä¹‰åœ¨mainå‡½æ•°ä¹‹åï¼Œé¡ºåºç¼–è¯‘åˆ°ä»£ç ç¬¬6è¡Œmax(1,2)æ—¶æ‰¾ä¸åˆ°maxçš„å®šä¹‰</strong>ï¼Œæ‰€ä»¥mainä¸çŸ¥é“maxæ˜¯ä»€ä¹ˆï¼ˆæ˜¯çš„æ€ä¹ˆè¿™ä¹ˆç¬¨ï¼Ÿï¼‰ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ï¼š</p><ul><li><p><strong>å°†maxå‡½æ•°æ•´ä½“å®šä¹‰åœ¨mainå‡½æ•°å‰</strong>ï¼›</p></li><li><p><strong>å‰å‘å£°æ˜</strong>ã€‚</p><p>å‰å‘å£°æ˜å‘Šè¯‰ç¼–è¯‘å™¨æ ‡è¯†ç¬¦åœ¨å®é™…å®šä¹‰ä¹‹å‰å°±å·²ç»å­˜åœ¨ï¼Œè¿™æ ·ç¼–è¯‘å™¨ä¼š<u>åœ¨é“¾æ¥æ—¶è¿›è¡Œç¬¦å·é“¾æ¥å¯»æ‰¾æ ‡è¯†ç¬¦çš„å®šä¹‰</u>ã€‚</p><blockquote><p>æ„Ÿè§‰å’Œexternå…³é”®å­—å¾ˆåƒï¼Ÿè¯·è§ä¸‹èŠ‚å¯¹æ¯”ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>; <span class="comment">// å‰å‘å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">max</span>(<span class="number">1</span>,<span class="number">2</span>); <span class="comment">// ç¼–è¯‘æ­£ç¡®</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°è¿”å›ä¸¤ä¸ªæ•°ä¸­è¾ƒå¤§çš„é‚£ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> num1&gt;num2?num1:num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœmaxå®šä¹‰åœ¨å…¶å®ƒæ–‡ä»¶ï¼ˆmax.cppï¼‰ä¸­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*max.cpp*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> num1&gt;num2?num1:num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ åœ¨mainä¸­ï¼ˆå®šä¹‰åœ¨main.cppï¼‰ä¸­ï¼Œå¯ä»¥ä¸é€šè¿‡include â€œmain.cppâ€è€Œä½¿ç”¨å‰ç½®å£°æ˜ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*main.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>; <span class="comment">// å‰å‘å£°æ˜,ä¼šåœ¨é“¾æ¥çš„æ—¶å€™å¯»æ‰¾maxçš„å®šä¹‰ï¼Œç¼–è¯‘å™¨æ—¶ä¸æŠ¥é”™</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">max</span>(<span class="number">1</span>,<span class="number">2</span>); <span class="comment">// ç¼–è¯‘æ­£ç¡®</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼ˆä¸€åˆ‡æ­£å¸¸ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cpp max.cpp -o main.out</span><br><span class="line">./main.out</span><br></pre></td></tr></table></figure></li></ul><p>ä½†ç»è¿‡æˆ‘çš„å®è·µï¼Œåœ¨å¾ˆå¤šç¼–è¯‘å™¨ä¸­è¿›è¡Œäº†ä¼˜åŒ–ã€‚<strong>åŒä¸€ä¸ªæ–‡ä»¶çš„å‡½æ•°</strong>å³ä½¿ä¸è¿›è¡Œå‰å‘å£°æ˜ï¼Œä¸Šé¢çš„ä»£ç ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚</p><p>è€Œä¸”ï¼Œåœ¨<a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/headers/?highlight=%E5%89%8D%E5%90%91%E5%A3%B0%E6%98%8E#forward-declarations">Google code style</a> ä¹Ÿæ˜ç¡®æŒ‡å‡ºå°½é‡ä¸è¦ä½¿ç”¨å‰ç½®å£°æ˜ï¼š</p><blockquote><p>å°½å¯èƒ½åœ°é¿å…ä½¿ç”¨å‰ç½®å£°æ˜ã€‚ä½¿ç”¨ <code>#include</code> åŒ…å«éœ€è¦çš„å¤´æ–‡ä»¶å³å¯ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220116163129065.png" alt="image-20220116163129065"></p></blockquote><p><strong>é‚£ä¹ˆï¼Œå‰å‘å£°æ˜è¿˜å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</p><ol><li>å‡å°‘ç¼–è¯‘æ—¶é—´ã€‚ä½¿ç”¨includeä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«çš„çš„æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ï¼Œä½†æ˜¯ä¹Ÿä¼šæŠŠå¤´æ–‡ä»¶å…¶å®ƒä¸éœ€è¦çš„å˜é‡å¼•å…¥ã€‚å¦‚æœåªæ˜¯éœ€è¦ä½¿ç”¨å¾ˆå°‘çš„å¤–éƒ¨å˜é‡ï¼Œä½¿ç”¨å‰å‘å£°æ˜èƒ½å‡å°‘ç¼–è¯‘çš„å¤´æ–‡ä»¶å±•å¼€ã€‚</li><li>æ‰“ç ´å¾ªç¯å¼•ç”¨ã€‚</li></ol><h5 id="å¾ªç¯å¼•ç”¨">å¾ªç¯å¼•ç”¨</h5><p>å‰ç½®å£°æ˜ç°åœ¨<strong>ç”¨æ¥è§£å†³å¤šæ–‡ä»¶ä¸­å¾ªç¯å¼•ç”¨çš„é—®é¢˜</strong>ã€‚</p><p>ä»¥ç±»å¾ªç¯å¼•ç”¨ä¸ºä¾‹ã€‚</p><p><strong>æƒ³è±¡è¿™ä¹ˆä¸€ä¸ªæƒ…å†µï¼šA.hå®šä¹‰äº†Class Aï¼Œå®ƒéœ€è¦å¼•ç”¨B.hå®šä¹‰çš„Class Bï¼Œä¹Ÿå°±æ˜¯è¦å†™å…¥#include â€œB.hâ€ ï¼›ç±»ä¼¼çš„æƒ…å†µï¼ŒB.hä¹Ÿéœ€è¦å†™å…¥#include â€œA.hâ€</strong>ã€‚</p><p>è¿™å°±é€ æˆäº†ä¸¤ä¸ªç±»äº’ç›¸å¼•ç”¨ï¼Œä½†ç”±äºC++è›‹ç–¼é¡ºåºç¼–è¯‘çš„è§„åˆ™ã€‚å¦‚æœæ˜¯å…ˆç¼–è¯‘A.hï¼Œå¼•ç”¨çš„ç±»Båˆ™æ‰¾ä¸åˆ°å®ç°çš„å®šä¹‰ï¼›å¦‚æœæ˜¯å…ˆç¼–è¯‘B.hï¼Œåˆ™æ‰¾ä¸åˆ°ç±»Açš„å®šä¹‰ã€‚å½¢æˆâ€œå…ˆæœ‰é¸¡è¿˜æœ‰å…ˆæœ‰è›‹â€çš„ä¸–çºªéš¾é¢˜ã€‚</p><p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* A.h */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> A_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> A_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;B.h&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      B *b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* B.h */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> B_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> B_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;A.h&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      A *a;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*test.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;A.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;B.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   A a;</span><br><span class="line">   B b;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è¯•ç¼–è¯‘ä¸€ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++  test.cpp -o test.out</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºåœ¨<code>B.h</code>ä¸­æ‰¾ä¸åˆ°<code>A</code>çš„å®šä¹‰ï¼š<img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227163519959.png" alt="image-20211227163519959"></p><p><strong>ç°åœ¨æˆ‘ä»¬ä»åº•å±‚ç¼–è¯‘è¿‡ç¨‹æ¢è®¨ä¸‹è¿™ä¸ªå¾ªç¯å¼•ç”¨å‡ºç°çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ</strong>ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ç¼–è¯‘å››å¤§æµç¨‹ä¸ºï¼šé¢„ç¼–è¯‘â†’ç¼–è¯‘â†’æ±‡ç¼–â†’é“¾æ¥ï¼Œå…ˆçœ‹çœ‹é¢„ç¼–è¯‘æºæ–‡ä»¶test.cppäº§ç”Ÿçš„test.iã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -E  test.cpp  -o test.i</span><br></pre></td></tr></table></figure><p>é¢„ç¼–è¯‘åå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227171957061.png" alt="image-20211227171957061"></p><p>ä¸‹é¢æ˜¯<code>test.i</code>ä¸­å…·ä½“å†…å®¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      A *a;  <span class="comment">// å‰é¢æ²¡æœ‰Açš„å®šä¹‰</span></span><br><span class="line">&#125;;</span><br><span class="line"># <span class="number">4</span> <span class="string">&quot;A.h&quot;</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      B *b;</span><br><span class="line">&#125;;</span><br><span class="line"># <span class="number">10</span> <span class="string">&quot;test.cpp&quot;</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   A a;</span><br><span class="line">   B b;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œtest.iä¸­<strong>ç¬¬6è¡Œä»£ç <code>A* a</code>ï¼Œåœ¨ç±»Bä¸­å¼•ç”¨äº†<code>A</code> ï¼Œä½†æ˜¯å‰é¢æ²¡æœ‰å…³äº<code>A</code> çš„å®šä¹‰</strong>ã€‚è¿™ä¸ºåé¢ç¼–è¯‘å‡ºé”™åŸ‹ä¸‹äº†ä¼ç¬”ã€‚</p><p>é¢„ç¼–è¯‘åå®Œæˆåï¼Œæˆ‘ä»¬è¿›è¡Œç¬¬2ä¸ªé˜¶æ®µï¼šç¼–è¯‘ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -S test.cpp -o  test.s</span><br></pre></td></tr></table></figure><p>Errorï¼å‡ºç°äº†æœ€å¼€å§‹çš„â€œæœªå®šä¹‰â€é”™è¯¯ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227210145942.png" alt="image-20211227210145942"></p><p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªé”™è¯¯åœ¨ç¼–è¯‘é˜¶æ®µå°±äº§ç”Ÿäº†ï¼šå½“C++<strong>æŒ‰é¡ºåºç¼–è¯‘</strong>åˆ° <code>A *a</code> è¿™è¡Œæ—¶ï¼Œç¼–è¯‘å™¨è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå‘ç°<strong>åœ¨å‰é¢æ‰¾ä¸åˆ°<code>A</code>ç›¸å…³çš„å®šä¹‰</strong>ï¼Œäºæ˜¯æŠ¥é”™ã€‚</p><p><strong>æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜</strong>ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥åœ¨<code>B.h</code> ä¸­è¿›è¡Œå‰å‘å£°æ˜ï¼Œè§£å†³è¿™ä¸ªé”™è¯¯ã€‚</p><ul><li><strong>ç±»ä¼¼äºå…¨å±€å˜é‡ï¼Œè¿™æ ·<code>A</code>ä½œç”¨èŒƒå›´å°±åˆ°æœ¬æ–‡ä»¶ç»“å°¾ï¼šå³ç¼–è¯‘å™¨è¿˜ä¼šåœ¨<code>test.i</code> ä¸­å…¶å®ƒä½ç½®å¯»æ‰¾<code>A</code>çš„å®šä¹‰</strong>ï¼›</li><li><strong>ä¸ä»…å¦‚æ­¤ï¼Œå³ä½¿<code>test.i</code>ä¸­ä¸å­˜åœ¨ï¼Œç¼–è¯‘å™¨è¿˜ä¼šåœ¨é“¾æ¥æ—¶ç¬¦å·è§£ææ—¶å¯»æ‰¾Açš„å®šä¹‰ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶å°±æŠ¥é”™</strong>ã€‚</li></ul><p>è¿™æ ·ç¼–è¯‘å™¨å°±ä¸ä¼šåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥é”™äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> B_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> B_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;A.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>;</span>  <span class="comment">// å‰å‘å£°æ˜ï¼Œ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   <span class="keyword">private</span>:</span><br><span class="line">      A *a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>æ–°çš„é¢„ç¼–è¯‘æ–‡ä»¶<code>test.i</code>æ–‡ä»¶ä¹Ÿåœ¨ç›¸åº”ä½ç½®å¤šäº†ä¸€è¡Œ<code>Class A;</code>ï¼ˆå…¶ä½™æ— å˜åŒ–ï¼‰:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœä¸ä½¿ç”¨#ifndef ã€#define å’Œ#endif</strong>ï¼Ÿ</p><p>#ifndef ã€#define å’Œ#endifï¼Œå³æ¡ä»¶ç¼–è¯‘ï¼šåªæœ‰æ»¡è¶³è¦æ±‚ä»£ç æ‰å‚ä¸ç¼–è¯‘ï¼Œå¦åˆ™ä¸å‚ä¸ç¼–è¯‘ã€‚åŸºæœ¬ç”¨æ³•ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> æ ‡è¯†ç¬¦  </span></span><br><span class="line">ç¨‹åºæ®µ<span class="number">1</span>  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span>  </span></span><br><span class="line">ç¨‹åºæ®µ<span class="number">2</span>  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œå¯¹B.hå’ŒA.héƒ½ä½¿ç”¨äº†æ¡ä»¶ç¼–è¯‘ï¼š<strong>é˜²æ­¢å¤´æ–‡ä»¶è¢«é‡å¤å®šä¹‰ï¼Œåœ¨é“¾æ¥æ—¶å‡ºç°å¤§é‡é‡å®šä¹‰é”™è¯¯</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> A_H <span class="comment">// æˆ–B_H</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> A_H <span class="comment">// æˆ–B_H</span></span></span><br><span class="line"><span class="comment">// A_Hæˆ–B_Hä¸­çš„ä»£ç  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>ä»¥<code>A.h</code>ä¸ºä¾‹ï¼š</p><ol><li>å¦‚æœ<code>A.h</code>è¢«<u>ç¬¬ä¸€ä¸ªæ–‡ä»¶</u>å¼•å…¥æ—¶ï¼Œä¼šå®šä¹‰æ ‡è¯†ç¬¦<code>A_H</code> ï¼Œè¿™ä¸ªæ—¶å€™<code>A.h</code>å…¶åçš„ä»£ç ä¼šè¢«é¢„ç¼–è¯‘æ’å…¥åˆ°æ–‡ä»¶ä¸­ï¼›</li><li>å¦‚æœ<u>å…¶å®ƒæ–‡ä»¶</u>å­˜åœ¨ä»£ç <code>#include â€œA.hâ€</code> ï¼Œå°è¯•é¢„ç¼–è¯‘æ›¿æ¢ä¸º<code>A.h</code>ä¸­å†…å®¹ï¼›</li><li>å› ä¸º<code>A_H</code> å·²è¢«å®šä¹‰ï¼Œç›´æ¥è·³è½¬åˆ°<code>#endif</code>ç»“æŸï¼Œ<strong>é¿å…äº†å¤´æ–‡ä»¶é‡å¤å¼•å…¥</strong>ã€‚</li></ol><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œå¦‚æœå¯¹B.hå’ŒA.héƒ½<u>ä¸ä½¿ç”¨</u>æ¡ä»¶ç¼–è¯‘ï¼Œ<strong>é¢„ç¼–è¯‘æ—¶ä¸ä½†ä¼šå‡ºç°é‡å®šä¹‰é”™è¯¯è¿˜ä¼šå‡ºç°æ— é™åµŒå¥—</strong>ï¼š</p><ol><li>main.cppä¸­ï¼š#include â€œA.hâ€ è¢«æ›¿æ¢ä¸ºA.hä¸­å…·ä½“å†…å®¹ï¼›</li><li>A.hä¸­ï¼š ç”±äºåœ¨å¤´æ–‡ä»¶å¼•å…¥äº† #include â€œB.hâ€ ï¼Œæ‰€ä»¥ #include â€œB.hâ€ä¹Ÿä¼šè¢«æ›¿æ¢ä¸ºB.hä¸­å…·ä½“å†…å®¹ï¼›</li><li>B.hä¸­ï¼š é‡å¤å¼•å…¥äº† #include â€œA.hâ€ï¼Œé‡å¤æ›¿æ¢å¤´æ–‡ä»¶A.hï¼Œè·³è½¬åˆ°æ­¥éª¤2å‘ç”Ÿæ— é™åµŒå¥—ã€‚</li></ol><h5 id="externå’Œå‰å‘å£°æ˜">externå’Œå‰å‘å£°æ˜</h5><p>externå’Œå‰å‘å£°æ˜ä½œç”¨éå¸¸ç›¸ä¼¼ï¼š<strong>éƒ½å¯ä»¥ç”¨æ¥å£°æ˜<u>å‡½æ•°/ç»“æ„ä½“/ç±»</u>ç­‰æ˜¯åœ¨å¤–éƒ¨å®šä¹‰çš„ï¼Œè¿™æ ·åœ¨ç¼–è¯‘æ—¶ä¸å‡ºé”™ï¼Œåœ¨é“¾æ¥æ—¶ä¼šåœ¨å…¶å®ƒ<code>.o</code>å¯»æ‰¾ç›¸å…³å®šä¹‰</strong>ã€‚</p><p>ä½†æ˜¯externå…³é”®å­—å’Œå‰å‘å£°æ˜ä¹Ÿæœ‰äº›ä¸åŒï¼š</p><ol><li><strong>externå¯ä»¥ä½œç”¨äºå˜é‡</strong>ï¼Œå‰å‘å£°æ˜æ— æ³•å£°æ˜å˜é‡ï¼ˆå˜é‡ä¼šé»˜è®¤åˆå§‹åŒ–ï¼‰ï¼Œåªèƒ½å£°æ˜å‡½æ•°/ç»“æ„ä½“/ç±»ç­‰ï¼›</li><li><strong>externè¿˜æœ‰extern â€œCâ€ç›¸å…³ç”¨æ³•</strong>ï¼›</li><li><strong>externæ˜¯ä¸€ä¸ªå…³é”®å­—</strong>ï¼Œå‰å‘å£°æ˜æ˜¯ç§å£°æ˜æ–¹å¼ï¼ˆä½¿ç”¨å‰å£°æ˜ï¼‰ã€‚</li></ol><h5 id="æœ€ä½³å®è·µï¼šextern-å‰å‘å£°æ˜-include">æœ€ä½³å®è·µï¼šextern/å‰å‘å£°æ˜/include</h5><ul><li><p><strong>å¦‚æœåªæ˜¯<u>å°‘é‡</u>åœ°è¦ä½¿ç”¨åˆ«çš„æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡/å‡½æ•°/ç»“æ„ä½“/ç±»ç­‰</strong>ï¼šè¯·ä½¿ç”¨externå…³é”®å­—ï¼Œå®ƒå¯ä»¥å‡å°‘ç¼–è¯‘æ—¶é—´ï¼›</p><p>è™½ç„¶å‡½æ•°/ç»“æ„ä½“/ç±»ç­‰ä½¿ç”¨å‰å‘å£°æ˜ä¹Ÿå¯ä»¥ä½†ä¸æ¨èï¼Œä½¿ç”¨externæ›´å¥½ã€‚</p></li><li><p><strong>æ‰“ç ´å¾ªç¯å¼•ç”¨</strong>ã€‚å‰å‘å£°æ˜ã€‚</p></li><li><p><strong>å…¶ä½™æƒ…å†µä½¿ç”¨includeæ›´å¥½</strong>ï¼Œä»£ç é€»è¾‘æ›´æ¸…æ™°ã€‚</p></li></ul><h4 id="3-1-2-æœ€ä½³å®è·µï¼šä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‡½æ•°">3.1.2 æœ€ä½³å®è·µï¼šä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‡½æ•°</h4><p>ä½œä¸ºæ›¾ç»ç¨šå«©çš„ï¼ˆç°åœ¨ä¸é‚£ä¹ˆç¨šå«©çš„ï¼‰ç¨‹åºå‘˜ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‡½æ•°æ˜¯ä¸€ä¸ªæŒºçº ç»“çš„é—®é¢˜ã€‚å‚è€ƒ<a href="learncpp.com">learncpp</a> ä¸­å»ºè®®ï¼š</p><ul><li><strong>å¤šæ¬¡å‡ºç°çš„è¯­å¥åº”è¯¥ç»„æˆä¸€ä¸ªå‡½æ•°</strong>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼å¤šæ¬¡è¯»å–ç”¨æˆ·çš„è¾“å…¥ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‡½æ•°å€™é€‰ã€‚</li><li><strong>å…·æœ‰æ˜ç¡®å®šä¹‰çš„è¾“å…¥å’Œè¾“å‡ºç›®æ ‡çš„ä»£ç </strong>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè¦æ’åºçš„é¡¹ç›®åˆ—è¡¨ï¼Œé‚£ä¹ˆè¿›è¡Œæ’åºçš„ä»£ç å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŠŸèƒ½ï¼Œ<u>å³ä½¿å®ƒåªå®Œæˆäº†ä¸€æ¬¡</u>ã€‚è¾“å…¥æ˜¯æœªæ’åºçš„åˆ—è¡¨ï¼Œè¾“å‡ºæ˜¯æ’åºçš„åˆ—è¡¨ã€‚</li><li><strong>ä¸€ä¸ªå‡½æ•°åº”è¯¥æ‰§è¡Œæœ‰ä¸”åªæœ‰ä¸€é¡¹ä»»åŠ¡</strong>ã€‚</li><li><strong>å½“ä¸€ä¸ªå‡½æ•°å˜å¾—å¤ªé•¿ã€å¤ªå¤æ‚æˆ–éš¾ä»¥ç†è§£æ—¶</strong>ã€‚å¯ä»¥å°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªå­å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯é‡æ„ã€‚</li></ul><h3 id="3-2-å‡½æ•°é‡è½½">3.2 å‡½æ•°é‡è½½</h3><p>åœ¨å‰é¢æˆ‘ä»¬æåˆ°ï¼šå‡½æ•°é€šè¿‡å‡½æ•°ç­¾åæ¥å”¯ä¸€ç¡®å®šä¸€ä¸ªå‡½æ•°ï¼Œè€Œå‡½æ•°ç­¾åç”± <u>å‡½æ•°å&amp;å‚æ•°åˆ—è¡¨</u> ç»„æˆã€‚</p><p>æ¯”å¦‚ï¼Œ<strong>ä¸¤ä¸ªå‡½æ•°å‡½æ•°åç›¸åŒè€Œå‚æ•°åˆ—è¡¨ä¸åŒï¼Œè¿™ä¸ªæ—¶å€™æ˜¯åŒä¸€å‡½æ•°å—</strong>ï¼Ÿ</p><p>æ˜¾ç„¶ä¸æ˜¯ï¼Œå› ä¸ºå‡½æ•°ç­¾åä¸­çš„å‚æ•°åˆ—è¡¨ä¸åŒï¼Œå› æ­¤æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™ä¹Ÿå°±æ˜¯<strong>å‡½æ•°é‡è½½</strong>ã€‚</p><h4 id="3-2-1-ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°é‡è½½ï¼Ÿ">3.2.1 ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°é‡è½½ï¼Ÿ</h4><p>é‡è½½å‡½æ•°é€šå¸¸ç”¨æ¥å‘½åä¸€ç»„åŠŸèƒ½ç›¸ä¼¼çš„å‡½æ•°ã€‚è¿™æ ·åšçš„å¥½å¤„ï¼š</p><ol><li>å‡å°‘äº†å‡½æ•°åçš„æ•°é‡ï¼›</li><li>é¿å…äº†åå­—ç©ºé—´çš„æ±¡æŸ“ï¼Œå¯¹äºç¨‹åºçš„å¯è¯»æ€§æœ‰å¾ˆå¤§çš„å¥½å¤„ã€‚</li></ol><p>è¯·çœ‹ä¸‹ä¾‹ã€‚</p><p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡½æ•°ï¼šä¸€ä¸ªè¿”å›ä¸¤ä¸ªæ•´æ•°ç›¸åŠ çš„å€¼ï¼Œä¸€ä¸ªè¿”å›ä¸¤ä¸ªæµ®ç‚¹æ•°ç›¸åŠ çš„å€¼ã€‚æˆ‘ä»¬<strong>å®šä¹‰äº†å¤šä¸ªåç§°ä½†æå…¶ç›¸ä¼¼ï¼ˆåŠŸèƒ½ã€åå­—etc.ï¼‰çš„å‡½æ•°</strong>ã€‚å®ƒä»¬æ ¸å¿ƒåŠŸèƒ½è™½ç„¶éƒ½æ˜¯addï¼Œä½†å´å¯¹åº”å¤šä¸ªä¸åŒçš„å‡½æ•°åï¼Œå¢åŠ äº†è®°å¿†è´Ÿæ‹…ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">addInteger</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">addDouble</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜é›…çš„åšæ³•åº”è¯¥æ˜¯ï¼š<strong>æ¯ä¸ªå‡½æ•°åŒåï¼Œç¼–è¯‘å™¨é å‚æ•°<u>ç±»å‹</u>ã€<u>æ•°é‡</u>ã€<u>é¡ºåº</u>æ¥è‡ªåŠ¨åŒ¹é…è°ƒç”¨</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y,<span class="keyword">int</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">add</span>(<span class="number">1</span>,<span class="number">2</span>);   <span class="comment">// åŒ¹é…ç¬¬ä¸€ä¸ªadd</span></span><br><span class="line">    <span class="built_in">add</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>); <span class="comment">// åŒ¹é…ç¬¬äºŒä¸ªadd</span></span><br><span class="line">    <span class="built_in">add</span>(<span class="number">3.4</span>,<span class="number">5</span>); <span class="comment">// åŒ¹é…ç¬¬ä¸‰ä¸ªadd</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-2-äºŒä¹‰æ€§åŒ¹é…">3.2.2 äºŒä¹‰æ€§åŒ¹é…</h4><p>å‰é¢ä»‹ç»çš„éƒ½æ˜¯ä¼ é€’çš„å‚æ•°å’Œå®šä¹‰å‡½æ•°å‚æ•°å®Œå…¨åŒ¹é…çš„ç®€å•æƒ…å†µã€‚ä½†å®é™…ä¸Šï¼Œè¿˜ä¼šå‡ºç°<strong>å‡½æ•°è°ƒç”¨ä¸­çš„å‚æ•°ç±»å‹ä¸ä»»ä½•é‡è½½å‡½æ•°ä¸­çš„å‚æ•°ç±»å‹ä¸å®Œå…¨åŒ¹é…</strong> ã€‚</p><p>è¿™ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     cout &lt;&lt; <span class="string">&quot;print int : &quot;</span>&lt;&lt; x &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">double</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     cout &lt;&lt; <span class="string">&quot;print double : &quot;</span>&lt;&lt; d &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print int : 97</span><br></pre></td></tr></table></figure><p>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ<code>print('a')</code> åŒ¹é…äº† <code>print(int)</code>? <code>97</code>åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨å¦‚æœæ‰¾ä¸åˆ°å®Œå…¨åŒ¹é…çš„å‡½æ•°ï¼Œ<strong>ä¼šè‡ªåŠ¨è¿›è¡Œéšå¼è½¬æ¢å°†æŸäº›çª„æ•´æ•°å’Œæµ®ç‚¹ç±»å‹è‡ªåŠ¨æå‡ä¸ºæ›´å®½ç±»å‹</strong>ã€‚æ‰€æœ‰è¿™é‡Œçš„<code>char('a')</code> è‡ªåŠ¨æå‡ä¸º<code>int</code> ï¼ŒåŒ¹é…åˆ°äº†<code>print(int)</code> , <code>97</code>æ˜¯<code>a</code> çš„ASCIIç¼–ç ã€‚</p><p>ç‰¹åˆ«çš„ï¼Œç”±äºåŒ¹é…åˆ°äº†<code>print(int)</code> ï¼Œä¾¿ä¸ä¼šè‡ªåŠ¨ç»§ç»­æå‡ç±»å‹å»åŒ¹é…<code>print(double)</code>ã€‚</p><p>å…³äº<u>ç±»å‹è½¬æ¢</u> ä¼šåœ¨ç¬¬åç« ç»Ÿä¸€æ€»ç»“ï¼Œè¿™é‡Œå…ˆç®€å•äº†è§£ä¸‹å³å¯ã€‚</p><blockquote><p>ç‰¹åˆ«çš„ï¼Œ<strong>å¦‚æœä¸Šè¿°è¿‡ç¨‹ï¼ˆæ•°å­—è½¬æ¢æ‰¾ä¸åˆ°ï¼‰æœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œç¼–è¯‘å™¨å°†å°è¯•é€šè¿‡ä»»ä½•ç”¨æˆ·å®šä¹‰çš„è½¬æ¢æ‰¾åˆ°åŒ¹é…é¡¹</strong>ã€‚</p></blockquote><p>è¿™æ¶‰åŠåˆ°<u>ç±»å‹é‡è½½</u>ï¼Œä¼šåœ¨ä¸‹ç¯‡æ–‡ç« <u>é¢å¯¹å¯¹è±¡</u> è¿›è¡Œè®²è§£ã€‚è¿™é‡Œåªè¦äº†è§£è¿™ä¸ªä¾‹å­å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">int</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">0</span>; &#125; <span class="comment">// ç”¨æˆ·è‡ªå®šä¹‰ä»Xè½¬æ¢int</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">double</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    X x; </span><br><span class="line">    <span class="built_in">print</span>(x);  <span class="comment">// åŒ¹é…print(int)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œä¾‹å­ä¸­ï¼ˆä¹Ÿæ˜¯ä¸€èˆ¬å‡½æ•°å‚æ•°åŒ¹é…æµç¨‹æ€»ç»“ï¼‰ï¼š</p><ol><li>ç¼–è¯‘å™¨å¯»æ‰¾æ˜¯å¦å­˜åœ¨<code>print(X)</code> ï¼Œä¸å­˜åœ¨è½¬è‡³ç¬¬2æ­¥ï¼›</li><li>ç¼–è¯‘å™¨æ£€æŸ¥<code>x</code>æ˜¯å¦å¯ä»¥ç±»å‹æå‡ï¼Œä¸èƒ½è¿›è¡Œç¬¬3æ­¥ï¼›</li><li>ç¼–è¯‘å™¨å°†æŸ¥æ‰¾ä»»ä½•ç”¨æˆ·å®šä¹‰çš„è½¬æ¢ï¼Œå­˜åœ¨ï¼Œè¿›è¡Œè½¬æ¢ã€‚</li></ol><h3 id="3-3-å‡½æ•°æ¨¡æ¿">3.3 å‡½æ•°æ¨¡æ¿</h3><p>åœ¨å‰é¢<u>å‡½æ•°é‡è½½</u>ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å°†ä¸¤ä¸ª<u>åŠŸèƒ½ç›¸ä¼¼ä»…å‚æ•°åˆ—è¡¨ä¸åŒ</u>çš„å‡½æ•°ï¼Œ<u>æ”¹ä¸ºåŒåå‡½æ•°</u>è®©ç¼–è¯‘å™¨é€šè¿‡å‡½æ•°ç­¾åæ¥åŒºåˆ†ï¼Œå‡å°‘äº†æ€ç»´è´Ÿæ‹…ã€‚</p><p>ä½†æ˜¯è€ƒè™‘ä¸€ç§æ›´ç‰¹æ®Šçš„æƒ…å†µï¼Œ<u>ä¸¤ä¸ªå‡½æ•°ä¸ä»…åŠŸèƒ½æå…¶ç›¸ä¼¼ï¼Œè¿å‚æ•°åˆ—è¡¨çš„ä¸ªæ•°éƒ½ç›¸åŒ</u>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     cout &lt;&lt; <span class="string">&quot;print result : &quot;</span>&lt;&lt; x+y &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     cout &lt;&lt; <span class="string">&quot;print result : &quot;</span>&lt;&lt; x+y &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">3.0</span>,<span class="number">4.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»æ„Ÿè§‰å“ªé‡Œä¸å¯¹ï¼Œä¼¼ä¹é€ æˆäº†å¾ˆå¤šä»£ç é‡å¤ï¼Ÿå®ƒä»¬åªæ˜¯å‚æ•°ç±»å‹ä¸åŒå•Šï¼Œå‡½æ•°ä½“ã€åå­—ä»€ä¹ˆéƒ½ä¸€æ ·ï¼Ÿ</p><p>åœ¨C++ä¸­æä¾›äº†å‡½æ•°æ¨¡æ¿ï¼Œç”¨æ¥ä¼˜é›…åœ°åº”å¯¹è¿™ç§æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;    <span class="comment">// templateå’Œtypenameæ˜¯å…³é”®å­—ï¼ŒTæ˜¯ç±»å‹å</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(T x, T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     cout &lt;&lt; <span class="string">&quot;print result : &quot;</span>&lt;&lt; x+y &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">   <span class="built_in">print</span>(<span class="number">3.0</span>,<span class="number">4.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸é”™ï¼Œä¸€åˆ‡é¡ºçœ¼äº†å¾ˆå¤šã€‚</p><h4 id="3-3-1-æ¨¡æ¿å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ">3.3.1 æ¨¡æ¿å‡½æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4><p>åœ¨å‰æ–‡æˆ‘ä»¬ä»‹ç»äº†å‡½æ•°æ¨¡æ¿ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;    </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(T x, T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     cout &lt;&lt; <span class="string">&quot;print result : &quot;</span>&lt;&lt; x+y &lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å‡½æ•°æ¨¡æ¿å®é™…ä¸Šå¹¶ä¸æ˜¯å‡½æ•°â€”â€”å®ƒä»¬çš„ä»£ç ä¸æ˜¯ç›´æ¥ç¼–è¯‘æˆ–æ‰§è¡Œçš„ã€‚å‡½æ•°æ¨¡æ¿åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼š<strong>ä¸ºæ¯ä¸ªå…·æœ‰ä¸€ç»„å”¯ä¸€å‚æ•°ç±»å‹çš„å‡½æ•°ï¼Œè°ƒç”¨åˆ›å»ºï¼ˆå¹¶ç¼–è¯‘ï¼‰ä¸€ä¸ªå‡½æ•°</strong>ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºäº†ä¸€ä¸ªä¸åŒä»¥å¾€çš„æ¨¡æ¿å‡½æ•°è°ƒç”¨æ–¹å¼<code>funName&lt;actual_type&gt;(arg1, arg2)</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(T x, T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;print result : &quot;</span>&lt;&lt; x+y &lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    print&lt;<span class="keyword">int</span>&gt;(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// print(1,2);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†ç›¸æ¯”<code>funName(arg1, arg2)</code> è¿™ç§æ–¹å¼ï¼Œä¸Šé¢çš„æ‰æ˜¯æ›´æ¥è¿‘æœ¬è´¨çš„è°ƒç”¨æ–¹å¼ã€‚</p><p>å› ä¸º<code>print(1,2)</code>ï¼Œæœ¬è´¨å°±æ˜¯ç¼–è¯‘å™¨å…‹éš†äº†å‡½æ•°æ¨¡æ¿<code>void print(T x, T y)</code>ï¼Œå°†æ¨¡æ¿ç±»å‹<code>T</code>æ›¿æ¢ä¸ºæˆ‘ä»¬æŒ‡å®šçš„å®é™…ç±»å‹<code>&lt;int&gt;</code>ï¼Œæœ€ç»ˆç”ŸæˆæŒ‡å®šç±»å‹çš„å‡½æ•°<code>void print&lt;int&gt;(int x, int y)</code> ã€‚</p><blockquote><p>äº²çœ¼çœ‹ä¸€çœ‹ï¼šå®ä¾‹åŒ–å®Œæˆåç¼–è¯‘çš„å†…å®¹ã€‚</p></blockquote><p>ç”±äºç›´æ¥ä½¿ç”¨ <code>g++ -S</code> ç”Ÿæˆçš„æ˜¯æ±‡ç¼–ä»£ç ï¼Œä¸å¤ªç›´è§‚ï¼Œæˆ‘ä»¬å€ŸåŠ©https://cppinsights.io/ è§‚å¯Ÿæ¨¡æ¿å®ä¾‹åŒ–åçš„ä»£ç ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print&lt;<span class="keyword">int</span>&gt;(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">print&lt;<span class="keyword">double</span>&gt;(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220111224749061.png" alt="image-20220111224749061"></p><p>å®ä¾‹åŒ–åï¼Œç¼–è¯‘å™¨ç¡®å®ç”Ÿæˆäº†ä¸¤ä¸ªå‡½æ•°ï¼š<code>void print&lt;int&gt;(int x, int y)</code>ã€<code>void print&lt;double&gt;(double x, double y)</code>ä¾›æˆ‘ä»¬è°ƒç”¨ã€‚</p><p>ä¸Šè¿°<strong>ä»å‡½æ•°æ¨¡æ¿åˆ›å»ºæŒ‡å®šç±»å‹çš„å‡½æ•°çš„è¿‡ç¨‹ï¼Œç§°ä¸ºå‡½æ•°æ¨¡æ¿å®ä¾‹åŒ–</strong>ã€‚å¦‚æœè¿™ä¸ªè¿‡ç¨‹æ˜¯å› ä¸ºå‡½æ•°è°ƒç”¨è€Œäº§ç”Ÿçš„ï¼Œåˆ™ç§°ä¸º<strong>éšå¼å®ä¾‹åŒ–</strong>ã€‚</p><ul><li><p><strong>å®ä¾‹åŒ–å‡½æ•°æ¯æ¬¡è°ƒç”¨éƒ½ä¼šå‘ç”Ÿå—</strong>ï¼Ÿä»…åœ¨<strong>ç¬¬ä¸€æ¬¡</strong>å‡½æ•°è°ƒç”¨æ—¶å®ä¾‹åŒ–ï¼Œå¯¹è¯¥å‡½æ•°çš„è¿›ä¸€æ­¥è°ƒç”¨å°†è·¯ç”±ï¼ˆæŒ‡å‘ï¼‰åˆ°å·²å®ä¾‹åŒ–çš„å‡½æ•°ã€‚</p></li><li><p><strong>æœ€ä½³å®è·µ</strong>ï¼šä¼˜å…ˆä½¿ç”¨æ™®é€šå‡½æ•°è°ƒç”¨æ–¹å¼ï¼Œå³<code>print(1,2)</code> ã€‚</p></li></ul><h4 id="3-3-2-å¤šä¸ªå‡½æ•°æ¨¡æ¿ç±»å‹">3.3.2 å¤šä¸ªå‡½æ•°æ¨¡æ¿ç±»å‹</h4><p>å¤šä¸ªå‡½æ•°æ¨¡æ¿ç±»å‹é€‚ç”¨äºå‡½æ•°æ‹¥æœ‰å¤šä¸ªä¸åŒç±»å‹å‚æ•°çš„æƒ…å†µã€‚</p><p>è¯·çœ‹ä¸‹ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">max</span><span class="params">(T x, T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &gt; y) ? x : y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">max</span>(<span class="number">2</span>, <span class="number">3.5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;  <span class="comment">// compile error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­å¾€ä¸‹é˜…è¯»å‰ï¼Œè¯·æ€è€ƒï¼šä¸ºä»€ä¹ˆç¼–è¯‘ä¼šå‡ºé”™ï¼Ÿæœ‰ä»€ä¹ˆå¥½çš„è§£å†³åŠæ³•å—ï¼Ÿ</p><ul><li><p><strong>ä¸ºä»€ä¹ˆç¼–è¯‘å‡ºé”™</strong>ï¼Ÿ</p><ol><li>æ ¹æ®è°ƒç”¨çš„å‡½æ•°<code>max(2, 3.5)</code> ï¼Œç¼–è¯‘å™¨ä¼šå°è¯•å¯»æ‰¾åŒ¹é…çš„å‡½æ•°ï¼Œæ²¡æ‰¾åˆ°è½¬ä¸‹ä¸€æ­¥ï¼›</li><li>ç¼–è¯‘å™¨å°è¯•æ ¹æ®å‡½æ•°æ¨¡æ¿<code>max(T,T)</code>ï¼Œç”Ÿæˆå‡½æ•°<code>max(int,double)</code> ã€‚æ˜¾ç„¶è¿™æ˜¯ä¸å¯èƒ½ç”Ÿæˆ<strong>ä¸åŒç±»å‹</strong>çš„å‚æ•°ã€‚</li><li>å‡½æ•°è°ƒç”¨è§£æå‡ºé”™ã€‚</li></ol><p>å½“ç„¶ä½ å¯èƒ½è¿˜ä¼šé—®ï¼š<strong>ä¸ºä»€ä¹ˆç¼–è¯‘å™¨ä¸ä¼šç”Ÿæˆå‡½æ•°<code>max(double,double)</code>ï¼Œè¿™è°ƒç”¨æ—¶<code>max(int,double)</code> ä¸­<code>int</code>å¯ä»¥éšå¼è½¬æ¢ä¸º<code>double</code>å‘¢</strong>?</p><p>å› æ­¤ï¼Œç±»å‹è½¬æ¢ä»…åœ¨è§£æå‡½æ•°é‡è½½æ—¶è¿›è¡Œï¼Œè€Œä¸æ˜¯åœ¨æ‰§è¡Œæ¨¡æ¿å‚æ•°æ¨å¯¼æ—¶è¿›è¡Œã€‚</p></li><li><p><strong>æœ‰ä»€ä¹ˆå¥½çš„è§£å†³åŠæ³•å—</strong>ï¼Ÿ</p><p>å½“ç„¶ï¼Œæœ€ç®€å•åŠæ³•æ˜¯ä¼ å‚æ—¶ä¾¿è¿›è¡Œç±»å‹è½¬æ¢ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="built_in">max</span>(<span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(<span class="number">2</span>), <span class="number">3.5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å‡½æ•°æ¨¡æ¿å°±å¯ä»¥ç”Ÿæˆå‡½æ•°<code>max(double,double)</code>ï¼Œä»è€Œæ­£ç¡®è¢«è°ƒç”¨äº†ã€‚ä½†è¿™å¾ˆä¸coolã€‚</p><p>æˆ–è€…ä½ åˆæƒ³åˆ°äº†ï¼Œæˆ‘ä»¬ä¸æ˜¯æ–°å­¦ä¼šä¸€ç§è°ƒç”¨å‡½æ•°æ¨¡æ¿çš„æ–¹æ³•å—ï¼Œå®ƒå¯ä»¥<u>æ˜¾ç¤ºæŒ‡å®šè½¬æ¢ç±»å‹ï¼Œç¼–è¯‘å™¨å°±ä¸ç”¨è‡ªå·±å»æ¨å¯¼äº†</u>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; max&lt;<span class="keyword">double</span>&gt;(<span class="number">2</span>, <span class="number">3.5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯okçš„ã€‚</p><p>ä½†æœ€ä½³çš„è§£å†³åŠæ³•ï¼Œè¿˜æ˜¯ä»æ ¹æºè§£å†³ï¼šæ—¢ç„¶æ˜¯è°ƒç”¨å‚æ•°ç±»å‹æœ‰å¤šä¸ªï¼Œè€Œæ¨¡æ¿å‡½æ•°å‚æ•°ç±»å‹åªæœ‰ä¸€ä¸ªå¯¼è‡´å‡ºç°ä¸Šé¢çš„é—®é¢˜ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥å®šä¹‰æ¨¡æ¿å‡½æ•°æ—¶ä¹Ÿå®šä¹‰ä¸ºå¤šä¸ªç±»å‹å‘¢ï¼Ÿ</p></li><li><p><strong>å¤šä¸ªæ¨¡æ¿ç±»å‹å‚æ•°</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="function">T <span class="title">max</span><span class="params">(T x, U y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &gt; y) ? x : y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">max</span>(<span class="number">2</span>, <span class="number">3.5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;  <span class="comment">// compile error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œä¸€åˆ‡çœ‹èµ·æ¥æŒºä¸é”™ï¼Œè®©æˆ‘ä»¬è¾“å‡ºä¸€ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><p>å•Šï¼Ÿå¤§æƒŠå¤±è‰²ã€‚ä¸ºä»€ä¹ˆè¾“å‡ºç»“æœæ˜¯3è€Œä¸æ˜¯3.5ï¼Ÿ</p><p>å› ä¸ºå‡½æ•°å†…éƒ¨ç»“æœ<code>3.5</code>ä¸º<code>double</code> ç±»å‹ï¼Œè¿”å›çš„æ˜¯<code>T</code>ç±»å‹ï¼Œå·²ç»è¢«ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ï¼ˆæ ¹æ®ä¼ çš„å‚æ•°<code>2</code>ï¼‰æ›¿æ¢ä¸º<code>int</code> ç±»å‹ã€‚å› æ­¤å°†3.5å¼ºåˆ¶è½¬æ¢ä¸º3ã€‚</p><p>é‚£æˆ‘ä»¬ç›´æ¥æŒ‡å®šè¿”å›ç±»å‹<code>T</code> å˜ä¸º<code>U</code> ä¸å°±è¡Œäº†å—ï¼Ÿå¾ˆå¯æƒœï¼Œä¸è¡Œã€‚<strong>å› ä¸ºTã€Uçš„å®é™…ç±»å‹éƒ½æ˜¯æ ¹æ®è°ƒç”¨æ—¶ä¼ çš„å‚æ•°è¿›è¡Œæ¨æ–­çš„ï¼Œè€Œè°ƒç”¨æ—¶ä¼ é€’å‚æ•°çš„ä½ç½®å¯ä»¥éšæ„æ¢åŠ¨</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cout &lt;&lt; max(2, 3.5) &lt;&lt; &#x27;\n&#x27;; </span></span><br><span class="line">cout &lt;&lt; <span class="built_in">max</span>(<span class="number">3.5</span>, <span class="number">2</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>U</code>è¢«æ¨æ–­ä¸º<code>int</code> ç±»å‹ã€‚æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨<code>auto</code>å…³é”®å­—ï¼Œ<strong>è‡ªåŠ¨æ¨å¯¼å‡½æ•°çš„è¿”å›ç±»å‹</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">max</span><span class="params">(T x, U y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &gt; y) ? x : y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.5</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œä¸€åˆ‡éƒ½å¥½èµ·æ¥äº†ã€‚å…³äº<code>auto</code>å…³é”®å­—è¿˜ä¼šåœ¨åé¢åšæ›´è¯¦ç»†çš„æ€»ç»“ï¼Œå¸Œæœ›ä½ æœ‰äº†ä¸ªåˆæ­¥çš„è®¤è¯†ã€‚</p></li></ul><h3 id="3-4-å‡½æ•°å‚æ•°ğŸŒŸ">3.4 å‡½æ•°å‚æ•°ğŸŒŸ</h3><blockquote><p>âš ï¸ æœ¬èŠ‚çŸ¥è¯†è®¾è®¡åˆ°è¾ƒå¤šæŒ‡é’ˆå’Œå¼•ç”¨ç›¸å…³å†…å®¹ï¼Œæ­¤å‰æ— åŸºç¡€å»ºè®®å…ˆé˜…è¯»ï¼š<u>ç¬¬äºŒç« ï¼šæŒ‡é’ˆå’Œå¼•ç”¨</u>ã€‚</p></blockquote><p>åœ¨æ­£å¼æ¢è®¨å‡½æ•°å‚æ•°å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹å‡½æ•°ä¸­çš„ä¸¤ç§å‚æ•°ï¼š</p><ul><li><strong>å½¢å¼å‚æ•°</strong>ï¼šå‡½æ•°å£°æ˜æ—¶è¡¨ç¤ºçš„å˜é‡ï¼Œå‡½æ•°è°ƒç”¨æ—¶æ‰åˆ†é…å†…å­˜ã€‚</li><li><strong>å®é™…å‚æ•°</strong>ï¼šè°ƒç”¨å‡½æ•°æ•°å®é™…ä¼ é€’çš„å‚æ•°å€¼ï¼Œå¿…é¡»æ˜¯ç¡®å®šçš„å€¼ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> <span class="comment">// x,y æ˜¯å½¢å‚</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">foo</span>(<span class="number">6</span>, <span class="number">7</span>); <span class="comment">// 6,7 æ˜¯å®å‚ï¼Œè¢«èµ‹å€¼ç»™å½¢å‚x,y</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬æ›´å¤šçš„åŒºåˆ«ä¼šåœ¨3.4.6èŠ‚ä¸­è¿›è¡Œå¯¹æ¯”ã€‚</p><p>æœ¬èŠ‚æ ¸å¿ƒï¼šæŒ‰å€¼ä¼ é€’ã€æŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’ï¼Œè¿™ 3 ç§å‘å‡½æ•°ä¼ é€’å‚æ•°çš„ä¸»è¦æ–¹å¼ã€‚æˆ‘ä»¬ä¸€èµ·äº†è§£ä¸‹å§ã€‚</p><h4 id="3-4-1-æŒ‰å€¼ä¼ é€’">3.4.1 æŒ‰å€¼ä¼ é€’</h4><ul><li><p><strong>ä»€ä¹ˆæ˜¯æŒ‰å€¼ä¼ é€’</strong>ï¼Ÿ</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<strong>C++ ä¸­çš„éæŒ‡é’ˆå‚æ•°éƒ½æ˜¯æŒ‰å€¼ä¼ é€’ï¼šå®å‚çš„å€¼è¢«å¤åˆ¶åˆ°ç›¸åº”å‡½æ•°å½¢å‚ä¸­</strong>ã€‚</p><p>æŒ‰å€¼ä¼ é€’æ—¢ç„¶æ˜¯å¤åˆ¶ï¼Œå³åªæ˜¯å°†å®å‚çš„å‰¯æœ¬ä¼ é€’ç»™å‡½æ•°ï¼Œé‚£ä¹ˆå‡½æ•°ä¿®æ”¹å‰¯æœ¬ï¼ˆå½¢å‚ï¼‰çš„å€¼æ˜¯ä¸èƒ½å½±å“åˆ°å®å‚å€¼ã€‚è¯·çœ‹ä¸‹ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    y = <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x&#123; <span class="number">5</span> &#125;;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="built_in">foo</span>(x); <span class="comment">// å®å‚xå¤åˆ¶ä¸€ä»½ç»™y</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = 5</span><br><span class="line">x = 5</span><br></pre></td></tr></table></figure><p><code>x</code>çš„å€¼å¹¶æ²¡æœ‰è¢«æ”¹å˜ï¼Œè™½ç„¶<code>foo</code> å‡½æ•°å†…å®¹ä¿®æ”¹äº†ä¼ é€’è¿‡æ¥çš„å€¼ï¼Œä½†é‚£åªæ˜¯<code>x</code>çš„å‰¯æœ¬ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211231000603042.png" alt="image-20211231000603042" style="zoom:80%;" /><p>ä¸Šå›¾å¯¹è¿™ä¸€è¿‡ç¨‹è¿›è¡Œå½¢è±¡è¯´æ˜ï¼Œæ³¨æ„åˆ°å®å‚xã€å½¢å‚yå¯¹åº”çš„æ˜¯ä¸åŒå†…å­˜åŒºåŸŸï¼ˆåœ°å€éƒ½ä¸ä¸€æ ·ï¼‰ã€‚</p></li><li><p><strong>ä»€ä¹ˆæ—¶å€™ç”¨å€¼ä¼ é€’</strong>ï¼Ÿ</p><p>æŒ‰å€¼ä¼ é€’é€šå¸¸ç”¨äºéœ€è¦ä¼ é€’çš„å‚æ•°ä¸å¸Œæœ›è¢«ä¿®æ”¹çš„æ—¶å€™ï¼Œå®å‚å¯ä»¥æ˜¯ï¼š<u>å˜é‡ï¼ˆä¾‹å¦‚ xï¼‰ã€æ•°å­—ï¼ˆä¾‹å¦‚ 6ï¼‰ã€è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ x+1ï¼‰ã€ç»“æ„å’Œç±»ä»¥åŠæšä¸¾æ•°</u>ã€‚</p><p>ä½†æ˜¯æŒ‰å€¼ä¼ é€’ä¹Ÿæœ‰æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œåº”è¯¥é¿å…ä»¥ä¸‹å‡ ç§æƒ…å†µä½¿ç”¨ï¼š</p><ol><li>å¤åˆ¶ç»“æ„å’Œç±»ã€‚å¤åˆ¶ç»“æ„å’Œç±»å¼€é”€è¿‡å¤§ï¼Œå¯¼è‡´æ˜æ˜¾æ€§èƒ½æŸå¤±ï¼›</li><li>å¸Œæœ›å‚æ•°è¢«æ”¹å˜ï¼›</li><li>è¿”å›å¤šä¸ªå€¼ã€‚</li></ol><p>å…¶å®ƒæƒ…å†µä¼˜å…ˆè€ƒè™‘å€¼ä¼ é€’ã€‚</p></li></ul><h4 id="3-4-2-æŒ‰å¼•ç”¨ä¼ é€’">3.4.2 æŒ‰å¼•ç”¨ä¼ é€’</h4><ul><li><p><strong>ä¸ºä»€ä¹ˆéœ€è¦å¼•ç”¨ä¼ é€’</strong>ï¼Ÿ</p><p>åœ¨å‰é¢æˆ‘ä»¬è¯´åˆ°å€¼ä¼ é€’çš„å‡ ä¸ªç¼ºç‚¹ï¼šå¤åˆ¶ç»“æ„å’Œç±»å¼€é”€å¤§ã€æ— æ³•æ”¹å˜å‚æ•°ã€åªèƒ½è¿”å›ä¸€ä¸ªå€¼ã€‚</p><p>å¯¹åº”ï¼Œå¦‚æœä½ ä¸å¸Œæœ›ä»¥ä¸Šå‘ç”Ÿï¼Œè¯·ä½¿ç”¨å¼•ç”¨ä¼ é€’ã€‚</p><p><strong>å¼•ç”¨å°±ç›¸å½“äºå˜é‡åˆ«åï¼Œæ“ä½œå¼•ç”¨ç­‰ä»·äºç›´æ¥æ“ä½œæœ¬ä½“å˜é‡</strong>ã€‚è¯·çœ‹ä¸‹ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getAdd</span><span class="params">(<span class="keyword">int</span> x_add_1, <span class="keyword">int</span>&amp; y_add_2,<span class="keyword">int</span>&amp; z_add_3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x_add_1 += <span class="number">1</span>;</span><br><span class="line">    y_add_2 += <span class="number">2</span>;</span><br><span class="line">    z_add_3 += <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// print(1.2,2);</span></span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span> ,y = <span class="number">0</span> , z =<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">getAdd</span>(x,y,z);</span><br><span class="line">    cout &lt;&lt; x &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; y &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; z &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è¿‡ç¨‹ç®€ç•¥åˆ†æã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211231160958522.png" alt="image-20211231160958522" style="zoom:80%;" /><ul><li>å¼•ç”¨ä¼ é€’å˜é‡ <code>y</code> ã€<code>z</code> å‡è¢«ä¿®æ”¹ï¼ˆ<code>x</code>å€¼ä¼ é€’æœªè¢«ä¿®æ”¹ï¼‰ã€‚</li></ul><p>ç±»ä¼¼å€¼ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œå¼•ç”¨ä¼ é€’ä¸­çš„<code>y_add_2</code> ä¹Ÿæ˜¯è¢«è°ƒå‡½æ•°æ ˆä¸Šçš„ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå®ƒä¿å­˜äº†<code>y</code>çš„åœ°å€ã€‚å¯¹äºå¼•ç”¨å‚æ•°çš„<strong>ä»»ä½•å¤„ç†éƒ½ä¼šé€šè¿‡é—´æ¥å¯»å€ï¼Œç­‰ä»·ç›´æ¥æ“ä½œå®å‚<code>y</code>æœ¬ä½“</strong>ã€‚</p><p>ç‰¹åˆ«çš„ï¼Œå¼•ç”¨è¿˜æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼ˆ2.2èŠ‚ï¼‰ï¼š</p><ul><li>å¼•ç”¨å¿…é¡»ä½¿ç”¨å³å€¼è¿›è¡Œåˆå§‹åŒ–ï¼Œé™¤éæ˜¯æ‰§è¡Œå¸¸é‡çš„å¼•ç”¨ï¼›</li><li>å¼•ç”¨ä¼ é€’å€¼å¿…é¡»è¢«åˆå§‹åŒ–ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒç©ºå€¼ã€‚</li></ul></li><li><p><strong>è¿™ä¹ˆæ£’äº†ä½ åé¢è¿˜è®²æŒ‡é’ˆä¼ é€’å¹²å˜›</strong>ï¼Ÿ</p><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç¡®å®æ¨èå°½é‡ä½¿ç”¨å¼•ç”¨ä¼ é€’å‚æ•°ï¼Œä½†æ˜¯åœ°å€ä¼ é€’å‚æ•°è¿˜æ˜¯æœ‰å®ƒçš„ç”¨æ­¦ä¹‹åœ°ã€‚</p></blockquote><p>æ¯”å¦‚ï¼Œå¼•ç”¨ä¼ é€’å€¼å¯ä»¥ä½¿å¾—å‡½æ•°â€œè¿”å›â€å¤šä¸ªå€¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getAdd</span><span class="params">(<span class="keyword">int</span> x_add_1, <span class="keyword">int</span>&amp; y_add_2,<span class="keyword">int</span>&amp; z_add_3)</span></span>;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è§‚å¯Ÿè¿™ä¸ªè¡¨è¾¾å¼ï¼Œè¾“å…¥å‚æ•°<code>x_add_1</code> ï¼Œå’Œè¾“å‡ºå‚æ•°ï¼ˆè¿”å›å€¼ï¼‰<code>y_add_2</code>ã€<code>z_add_3</code> æ”¾åœ¨ä¸€å—ï¼Œæ— æ³•å¾ˆå¥½çš„åŒºåˆ†å“ªäº›æ˜¯è¦è¢«ä¿®æ”¹çš„ï¼ˆè¾“å‡ºå‚æ•°ï¼‰ã€‚æ¯•ç«Ÿï¼Œ<strong>å®ƒä»¬è¿è°ƒç”¨éƒ½æ˜¯è¿™ä¹ˆç›¸ä¼¼</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">int</span> x = <span class="number">0</span> ,y = <span class="number">0</span> , z =<span class="number">0</span>;</span><br><span class="line"><span class="built_in">getAdd</span>(x,y,z);</span><br></pre></td></tr></table></figure><p>ä½ èƒ½åŒºåˆ†å“ªäº›æ˜¯<code>xã€yã€z</code>å“ªäº›è¾“å‡ºå‚æ•°å—ï¼Ÿ</p></li></ul><h4 id="3-4-3-æŒ‰æŒ‡é’ˆä¼ é€’">3.4.3 æŒ‰æŒ‡é’ˆä¼ é€’</h4><ul><li><p><strong>ä¸ºä»€ä¹ˆè¦éœ€è¦æŒ‡é’ˆä¼ é€’å€¼</strong>?</p><p>å‰é¢è¯´åˆ°ï¼Œå¼•ç”¨ä¼ å€¼ç”¨æ¥â€œè¿”å›â€å¤šä¸ªå‚æ•°æ—¶ï¼Œå¾ˆéš¾åŒºåˆ†å“ªäº›å‚æ•°æ˜¯è¾“å‡ºå‚æ•°ï¼Œè¿è°ƒç”¨æ—¶éƒ½è¿‡åˆ†ç›¸ä¼¼ï¼ˆå¤šèƒèƒæäººå¿ƒæ€æ˜¯å§ï¼Ÿï¼‰ã€‚</p><p>ä¸Šé¢ä»£ç ä¿®æ”¹ä¸ºæŒ‡é’ˆä¼ å€¼åï¼Œå‡½æ•°å½¢å‚ç”±<code>&amp;</code>å˜ä¸º<code>*</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getAdd</span><span class="params">(<span class="keyword">int</span> x_add_1, <span class="keyword">int</span>* y_add_2,<span class="keyword">int</span>* z_add_3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     x_add_1 += <span class="number">1</span>;</span><br><span class="line">    *y_add_2 += <span class="number">2</span>;  <span class="comment">// y_add_2å­˜çš„æ˜¯yçš„åœ°å€ï¼Œä½¿ç”¨*æ“ä½œç¬¦å–å€¼</span></span><br><span class="line">    *z_add_3 += <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ—¶ï¼ˆ<strong>yã€zå¯ä»¥å¾ˆå¥½çš„è®¤å‡ºæ˜¯è¾“å‡ºå‚æ•°</strong>ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">0</span> ,y = <span class="number">0</span> , z =<span class="number">0</span>;</span><br><span class="line"><span class="built_in">getAdd</span>(x,&amp;y,&amp;z);  <span class="comment">// &amp;--å–åœ°å€è¿ç®—ç¬¦</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ï¼Œ<code>y_add_2</code> è·å–äº†å½¢å‚<code>&amp;y</code>ä¿å­˜çš„å€¼ï¼Œå³å˜é‡<code>y</code>çš„å†…å­˜åœ°å€ã€‚é€šè¿‡å–å€¼è¿ç®—ç¬¦<code>*y_add_2</code> ï¼Œå¯ä»¥è·å–å˜é‡<code>y</code>çš„å†…å­˜åŒºåŸŸæ“ä½œæƒï¼Œå³å¯ä»¥ä¿®æ”¹<code>y</code>çš„å€¼äº†ï¼ˆ+2ï¼‰ã€‚å› æ­¤å˜é‡<code>y</code>çš„å€¼è¢«ä¿®ï¼Œ<code>z</code>åŒç†ã€‚</p></li><li><p><strong>æƒŠè®¶ï¼æŒ‡é’ˆå…¶å®å€¼ä¼ é€’</strong>ï¼Ÿ</p><p>è¿™å°±æ˜¯è¯´æˆ‘ä»¬åƒå€¼ä¼ é€’ä¸€æ ·å°†<strong>å®å‚çš„å€¼ï¼ˆä¸€èˆ¬æ˜¯æŸä¸ªå˜é‡çš„åœ°å€ï¼‰å¤åˆ¶äº†ä¸€ä»½ç»™å½¢å‚</strong>ï¼Œå½¢å‚<u>ä¹Ÿä½œä¸ºå±€éƒ¨å˜é‡åœ¨æ ˆä¸­å¼€è¾Ÿäº†å†…å­˜ç©ºé—´</u>ã€‚</p><p>æ¢å¥è¯è¯´ï¼ŒæŒ‡é’ˆæ˜¯æŒ‰å€¼ä¼ é€’çš„ï¼å½“ç„¶ï¼Œè¿™å…¶å®æ²¡å¤šå¤§æƒŠè®¶ï¼ˆé™¤éä½ å’Œä½œè€…ä¸€æ ·æ˜¯ä¸ªæƒŠè®¶æ€ªï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬æ—©åœ¨<u>2.1èŠ‚</u>åˆ†æè¿‡ï¼ŒæŒ‡é’ˆæœ¬è´¨å°±æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒæœ‰è‡ªå·±çš„å€¼ï¼ˆå…¶å®ƒå˜é‡çš„åœ°å€ï¼‰å’Œè‡ªå·±çš„åœ°å€ã€‚</p><p>è¯·çœ‹ä¸‹ä¾‹ï¼Œè¯•åˆ†æï¼š<strong>ä¸ºä»€ä¹ˆ<code>pfive</code>å€¼æ²¡æœ‰è¢«ä¿®æ”¹æˆåŠŸï¼Ÿ</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å˜é‡ pträ¿å­˜äº†p_fiveçš„å€¼ï¼ˆfiveçš„åœ°å€ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setNull</span><span class="params">(<span class="keyword">int</span>* ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ptr = <span class="literal">NULL</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> five = <span class="number">5</span>;</span><br><span class="line">    cout&lt;&lt;&amp;five&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">int</span>* pfive = &amp;five; <span class="comment">// p_five = &amp;five = 0x7ffdb136b8e4</span></span><br><span class="line">    cout&lt;&lt;&amp;pfive&lt;&lt;endl;</span><br><span class="line">    <span class="built_in">setNull</span>(pfive); <span class="comment">// å°†p_fiveæŒ‡å‘null</span></span><br><span class="line">    cout&lt;&lt;pfive&lt;&lt;endl; <span class="comment">// è¾“å‡ºæ­¤æ—¶p_fiveå†…å­˜åœ°å€</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x7ffd037a0ecc</span><br><span class="line">0x7ffd037a0ec0</span><br><span class="line">0x7ffd037a0ea8</span><br><span class="line">0x7ffd037a0ecc</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶<code>pfive</code>æ²¡æœ‰ä¿®æ”¹æˆåŠŸï¼ˆNULLï¼‰ã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220109145535610.png" alt="image-20220109145535610"></p></li></ul><ol><li><p>å±€éƒ¨å˜é‡<code>pfive</code> ä¿å­˜äº†<code>&amp;five</code>çš„å€¼ï¼Œå³<code>five</code> çš„åœ°å€ï¼›</p></li><li><p>éšå<code>pfive</code>ä½œä¸ºå®å‚ï¼Œå…¶å€¼ï¼ˆ<code>five</code>åœ°å€ï¼‰å¤åˆ¶ç»™å½¢å‚<code>ptr</code>ï¼Œç¼–è¯‘å™¨ç»™å½¢å‚<code>ptr</code>å¼€è¾Ÿäº†ç©ºé—´ä¸“é—¨ä¿å­˜<code>five</code>åœ°å€ï¼›</p></li><li><p>éšå<code>ptr=NULL</code>ï¼Œä½†æ˜¯å½±å“ä¸åˆ°<code>pfive</code>ï¼ŒäºŒè€…æ˜¯ä¸åŒçš„å˜é‡æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„ç©ºé—´ã€‚</p></li></ol><p>è¿™éªŒè¯äº†æˆ‘ä»¬ä¹‹å‰çš„ç»“è®ºï¼š<strong>æŒ‡é’ˆä¼ å€¼åªæ˜¯å¤åˆ¶äº†å®å‚å€¼ç»™å½¢å‚ï¼Œåªä¸è¿‡è¿™ä¸ªå®å‚å€¼ä¸€èˆ¬æ˜¯æŸä¸ªå˜é‡çš„åœ°å€</strong>ã€‚</p><p><strong>é‚£å¦‚æœæˆ‘ä»¬æƒ³åœ¨æŒ‡é’ˆä¼ å€¼æ—¶ä¿®æ”¹å½¢å‚å°±å¯ä»¥å½±å“å®å‚</strong>ï¼Ÿ</p><p>æ˜¾ç„¶è¿™å°±æ˜¯å¼•ç”¨çš„åšæ³•ï¼Œå¯¹å½¢å‚çš„ä»»ä½•ä¿®æ”¹ç›´æ¥ç­‰ä»·æ“ä½œå®å‚æœ¬ä½“ã€‚ä¸è¿‡ä¸ºäº†æ›´å¥½çš„è®²è§£ï¼Œæˆ‘ä»¬å…ˆæ€»ç»“ä¸€ä¸‹å‰é¢å¼•ç”¨ã€æŒ‡é’ˆä¼ å€¼çš„ç”¨æ³•ã€‚</p><p>æˆ‘ä»¬çŸ¥é“å¼•ç”¨ç›¸å½“äºå˜é‡çš„åˆ«åï¼Œä½¿ç”¨å¼•ç”¨æ—¶å¯ä»¥è®¤ä¸ºå°±æ˜¯åœ¨ä½¿ç”¨å˜é‡æœ¬èº«ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>&amp; a_ref = a;  <span class="comment">// ä½¿ç”¨a_refå’Œä½¿ç”¨aæ²¡ä»€ä¹ˆåŒºåˆ«</span></span><br></pre></td></tr></table></figure><p>åˆå¦‚ä¹‹å‰çš„å¼•ç”¨ä¼ å€¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>&amp; var)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// var = ...;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">func</span>(tmp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å½¢å‚æ˜¯<code>int&amp; var</code> ï¼Œå®å‚<code>tmp</code> ï¼Œå®å‚å€¼åˆå§‹åŒ–å½¢å‚<code>var</code>ï¼Œå°±ç›¸å½“äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>&amp; var = tmp;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ¨å¹¿åˆ°å‡½æ•°å…¶ä½™å‚æ•°ä¼ é€’æƒ…å†µï¼š</p><ul><li><p>å€¼ä¼ é€’</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> var)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// var = ...;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">func</span>(tmp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®å‚å€¼åˆå§‹åŒ–å½¢å‚<code>var</code>ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> var = tmp;</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡é’ˆä¼ é€’</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>* var)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// *var = ...;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">func</span>(&amp;tmp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®å‚å€¼åˆå§‹åŒ–å½¢å‚<code>var</code>ç­‰ä»·äºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* var = &amp;tmp;</span><br></pre></td></tr></table></figure></li></ul><p>å¥½äº†ï¼Œæ¥å—äº†ä¸Šé¢çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´<strong>æ€ä¹ˆä¿®æ”¹å½¢å‚<code>ptr</code> ç­‰ä»·äºä¿®æ”¹å®å‚<code>pfive</code></strong>ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å˜é‡ pträ¿å­˜äº†p_fiveçš„å€¼ï¼ˆfiveçš„åœ°å€ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setNull</span><span class="params">(<span class="keyword">int</span>* ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ptr = <span class="literal">NULL</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> five = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span>* pfive = &amp;five; </span><br><span class="line">    <span class="built_in">setNull</span>(pfive); <span class="comment">// å°†p_fiveæŒ‡å‘null</span></span><br><span class="line">    cout&lt;&lt;p_five&lt;&lt;endl; <span class="comment">// è¾“å‡ºæ­¤æ—¶p_fiveå†…å­˜åœ°å€</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œ<strong>å¼•ç”¨</strong>å¯ä»¥åšåˆ°è¿™ç‚¹ï¼šå°†<code>ptr</code> è§†ä¸º<code>pfive</code>çš„åˆ«åï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>*&amp; ptr = pfive;</span><br></pre></td></tr></table></figure><p>åªéœ€å°†ç¬¬5è¡Œä¿®æ”¹ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setNull</span><span class="params">(<span class="keyword">int</span>*&amp; ptr)</span></span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†å°è¯•è¾“å‡ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="comment">// è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘NULL</span></span><br></pre></td></tr></table></figure><h4 id="3-4-4-æœ€ä½³å®è·µ">3.4.4 æœ€ä½³å®è·µ</h4><h5 id="ä¼ å¼•ç”¨å¿«è¿˜æ˜¯ä¼ æŒ‡é’ˆå¿«ï¼Ÿ">ä¼ å¼•ç”¨å¿«è¿˜æ˜¯ä¼ æŒ‡é’ˆå¿«ï¼Ÿ</h5><p>è™½ç„¶å‰é¢çš„åˆ†æï¼Œä½ å¯¹å¼•ç”¨å’ŒæŒ‡é’ˆä¼ é€’æœ‰ä¸€å®šçš„äº†è§£ã€åŒºåˆ†ã€‚</p><p><strong>ä½†å¦‚æœè¦ä½ å›ç­”è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼šæ˜¯ä¼ å¼•ç”¨å¿«è¿˜æ˜¯ä¼ æŒ‡é’ˆå¿«</strong>ï¼Ÿ</p><p>å…ˆä¸Šç»“è®ºï¼šä¸€æ ·å¿«ã€‚</p><p><strong>å› ä¸ºå¼•ç”¨å°±æ˜¯ç‰¹æ®Šçš„æŒ‡é’ˆï¼Œå®ƒåº•å±‚å®ç°å’ŒæŒ‡é’ˆæ˜¯ä¸€è‡´çš„</strong>ã€‚</p><p>å‡†å¤‡ä¸€æ®µåœ°å€ä¼ å‚ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>* y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    *y = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span> ;</span><br><span class="line">    <span class="built_in">func</span>(&amp;x);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>main</code>å¯¹åº”æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">        # ä¿å­˜mainæ ˆå¸§ä¿¡æ¯</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        subq    $16, %rsp </span><br><span class="line">        # ç”¨0åˆå§‹åŒ–xï¼ˆå¯¹åº”åœ°å€ä¸º-4(%rbp)ï¼Œå¹¶å°†xå‹æ ˆ</span><br><span class="line">        movl    $0, -4(%rbp)</span><br><span class="line">        # å°†xåœ°å€ä¿å­˜åˆ°å¯„å­˜å™¨raxä¸­ï¼Œç„¶åä¿å­˜åœ¨rdiä¸­</span><br><span class="line">        leaq    -4(%rbp), %rax </span><br><span class="line">        movq    %rax, %rdi</span><br><span class="line">        # è°ƒç”¨å‡½æ•°func</span><br><span class="line">        call    _Z4funcPi</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>main</code>ä¸­æœ€ç»ˆå°†å®å‚<code>&amp;x</code>ï¼ˆå˜é‡<code>x</code>çš„åœ°å€ï¼‰ä¿å­˜åœ¨å¯„å­˜å™¨<code>rdi</code>ä¸­ ã€‚</p><p>æ¥ç€æˆ‘ä»¬å¼€å§‹é‡å¤´æˆ<code>func</code>å‡½æ•°ï¼š<strong>æŒ‡é’ˆé€šè¿‡ä¿å­˜å˜é‡åœ°å€åˆ°å¯„å­˜å™¨ä¸­ï¼Œå®ç°å¯¹å˜é‡æ‰€åœ¨å†…å­˜åŒºåŸŸè¿›è¡Œä¿®æ”¹</strong>ï¼Œå› æ­¤ä¿®æ”¹æŒ‡é’ˆå°±æ˜¯ç›´æ¥å½±å“å˜é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">_Z4funcPi:</span><br><span class="line">        # ä¿å­˜funcæ ˆå¸§ç›¸å…³ä¿¡æ¯</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        # è¿›è¡Œåœ°å€å¤åˆ¶ï¼šå°†å¯„å­˜å™¨rdiçš„å€¼ï¼ˆå®å‚&amp;xï¼‰å¤åˆ¶ç»™å½¢å‚yï¼ˆå¯¹åº”åœ°å€-8(%rbp)ï¼‰ï¼Œå¹¶å°†yå‹æ ˆ</span><br><span class="line">        movq    %rdi, -8(%rbp)</span><br><span class="line">        # è¿›è¡Œèµ‹å€¼è¿ç®—ï¼šå…ˆç”¨å¯„å­˜å™¨raxä¿å­˜å½¢å‚yçš„çš„å€¼ï¼ˆxçš„åœ°å€ï¼‰ï¼Œç„¶åå°†2å¤åˆ¶ç»™x</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movl    $2, (%rax)</span><br><span class="line">        nop</span><br><span class="line">        popq    %rbp</span><br><span class="line">        # è¿”å›main</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°†ä¸Šè¿°ä»£ç ä»åœ°å€ä¼ é€’æ”¹ä¸ºå¼•ç”¨ä¼ é€’ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>&amp; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    y = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span> ;</span><br><span class="line">    <span class="built_in">func</span>(x);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å…¶æ±‡ç¼–ä»£ç ï¼šä¸èƒ½è¯´æ¯«ä¸ç›¸å¹²ï¼Œåªèƒ½è¯´å’Œä¹‹å‰æŒ‡é’ˆä¼ å€¼çš„æ±‡ç¼–ä»£ç å®Œå…¨<strong>ä¸€æ¨¡ä¸€æ ·</strong>ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220109193419428.png" alt="image-20220109193419428"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¼•ç”¨æœ¬è´¨å’ŒæŒ‡é’ˆä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡ä¿å­˜å˜é‡å¯¹åº”å†…å­˜åŒºåŸŸåœ°å€ï¼Œæ¥å®ç°æ“ä½œå˜é‡</strong>ã€‚å¯¹å¼•ç”¨çš„ä»»ä½•æ“ä½œï¼Œéƒ½ä¼šé€šè¿‡é—´æ¥å¯»å€ç›´æ¥æ“ä½œå˜é‡æœ¬èº«ï¼Œåªä¸è¿‡ç›¸æ¯”æŒ‡é’ˆéšè—äº†ä¸€äº›ç»†èŠ‚ï¼ˆç¼–è¯‘å™¨å¯¹ä½¿ç”¨å¼•ç”¨ä¼šè‡ªåŠ¨åŠ ä¸Š<code>*</code>ï¼Œ<u>2.2.1èŠ‚</u>ï¼‰ã€‚</p><h5 id="å‚æ•°ä¼ é€’é€‰æ‹©è§„åˆ™">å‚æ•°ä¼ é€’é€‰æ‹©è§„åˆ™</h5><blockquote><p>æœ‰å¼•é€‰å¼•ã€‚</p></blockquote><p><strong>ä¼˜å…ˆé€‰ç”¨å¼•ç”¨ä¼ é€’ï¼ˆå¼•ç”¨ï¼šæ‹œæ‰˜äº†</strong>ï¼‰ï¼Œé™¤éï¼š</p><ol><li><strong>å¸Œæœ›å‚æ•°ä¸è¢«ä¿®æ”¹</strong>ï¼Œé€‰æ‹©æŒ‰å€¼ä¼ é€’ï¼Œå¦åˆ™è½¬ä¸‹ä¸€æ­¥ï¼›</li><li><u><strong>éœ€è¦è¿”å›ç©ºæŒ‡é’ˆã€orè¿”å›å±€éƒ¨å˜é‡å†…å­˜ã€ORæ•°ç»„</strong></u>ï¼Œé€‰æ‹©æŒ‰æŒ‡é’ˆä¼ é€’ï¼Œå¦åˆ™è½¬ä¸‹ä¸€æ­¥ã€‚</li></ol><h5 id="æ•°ç»„æ€ä¹ˆä½¿ç”¨å¼•ç”¨ä¼ å‚ï¼Ÿ">æ•°ç»„æ€ä¹ˆä½¿ç”¨å¼•ç”¨ä¼ å‚ï¼Ÿ</h5><p>è¿™æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ã€‚</p><p>å…ˆçœ‹çœ‹æ•°ç»„çš„å¼•ç”¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> array[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="built_in"><span class="keyword">int</span></span> (&amp;arr)[<span class="number">5</span>] = array;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ•°ç»„çš„ç±»å‹å¯ä»¥è®¤ä¸ºæ˜¯<code>int [5]</code> ï¼Œ<code>&amp;arr</code> ä¾¿æ˜¯å£°æ˜ä¸€ä¸ª<code>array</code>çš„åˆ«åã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¦‚æ­¤ä½¿ç”¨æ•°ç»„çš„å¼•ç”¨ä½œä¸ºå‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify_array</span><span class="params">(<span class="keyword">int</span> (&amp;arr)[<span class="number">5</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> array[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">   <span class="built_in">modify_array</span>(array);</span><br><span class="line">   cout&lt;&lt;array[<span class="number">0</span>]&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç¡®å®è¢«æˆåŠŸä¿®æ”¹äº†ã€‚ä½†<code>int (&amp;arr)[5]</code> ç¼–è¯‘å™¨<u>è¦æ£€æŸ¥æ•°ç»„å®å‚å’Œå½¢å‚çš„å¤§å°</u>ï¼Œæ‰©å±•æ€§å¤ªå·®ï¼</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿è¿›è¡Œæ”¹è¿›ï¼ˆå…¶ä½™ä¸å˜ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="keyword">int</span> N&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify_array</span><span class="params">(T (&amp;arr)[N])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> array[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">   <span class="built_in">modify_array</span>(array);</span><br><span class="line">   cout&lt;&lt;array[<span class="number">0</span>]&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œç¾ï¼</p><h4 id="3-4-5-å‚æ•°ä¼ é€’æ€»ç»“">3.4.5 å‚æ•°ä¼ é€’æ€»ç»“</h4><blockquote><p>ä¸€äº›é¢è¯•å¸¸è€ƒé¢˜å¯¹å‰é¢æ‰€å­¦è¿›è¡Œæ€»ç»“å’ŒéªŒè¯ã€‚</p></blockquote><ul><li><p><strong>å½¢å‚å’Œå®å‚çš„åŒºåˆ«</strong>ï¼Ÿ</p><ul><li><strong>ä½•æ—¶åˆ†é…å†…å­˜</strong>ï¼š<strong>å½¢å‚å˜é‡åªæœ‰åœ¨è¢«è°ƒç”¨æ—¶æ‰åˆ†é…å†…å­˜å•å…ƒ</strong>ï¼Œåœ¨è°ƒç”¨ç»“æŸæ—¶ï¼Œ å³åˆ»é‡Šæ”¾æ‰€åˆ†é…çš„å†…å­˜å•å…ƒï¼ˆè¿™ä¸€éƒ¨åˆ†å†…å®¹è¿˜ä¼šåœ¨<u>8.6å‡½æ•°è¿”å›å€¼</u> è¯¦ç»†ä¸¾ä¾‹ï¼‰ï¼›å®å‚åœ¨è°ƒç”¨å‰å°±å·²ç»åˆ†é…äº†å†…å­˜ã€‚</li><li><strong>å‚æ•°ç±»å‹</strong>ï¼š å®å‚å¯ä»¥æ˜¯å¸¸é‡ã€å˜é‡ã€è¡¨è¾¾å¼ã€å‡½æ•°ç­‰ï¼Œåœ¨è¿›è¡Œå‡½æ•°è°ƒç”¨æ—¶ï¼Œå®ƒä»¬<strong>éƒ½å¿…é¡»å…·æœ‰ç¡®å®šçš„å€¼</strong>ï¼›å®å‚å’Œå½¢å‚åœ¨æ•°é‡ä¸Šï¼Œç±»å‹ä¸Šï¼Œé¡ºåºä¸Šåº”ä¸¥æ ¼ä¸€è‡´ï¼Œ å¦åˆ™ä¼šå‘ç”Ÿâ€œç±»å‹ä¸åŒ¹é…â€çš„é”™è¯¯ã€‚</li><li><strong>å•å‘ä¼ é€’</strong>ã€‚åªèƒ½æŠŠå®å‚çš„å€¼ä¼ é€ç»™å½¢å‚ï¼Œè€Œä¸èƒ½æŠŠå½¢å‚çš„å€¼åå‘åœ°ä¼ é€ç»™å®å‚ã€‚</li></ul></li><li><p><strong>å€¼ä¼ é€’ã€æŒ‡é’ˆä¼ é€’ã€å¼•ç”¨ä¼ é€’çš„åŒºåˆ«</strong>ï¼Ÿ</p><p>è¯·çœ‹ä¸‹è¡¨ã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">å€¼ä¼ é€’</th><th style="text-align:center">å¼•ç”¨ä¼ é€’</th><th style="text-align:center">æŒ‡é’ˆï¼ˆåœ°å€ï¼‰ä¼ é€’</th></tr></thead><tbody><tr><td style="text-align:center"><strong>æ‹·è´å†…å®¹</strong></td><td style="text-align:center">å®å‚çš„å‰¯æœ¬ï¼ˆæ•°ç»„ä¾‹å¤–ï¼Œä¼šé€€åŒ–ä¸ºæŒ‡é’ˆï¼‰</td><td style="text-align:center">ç»™å®å‚èµ·ä¸ªåˆ«å</td><td style="text-align:center">æŒ‡é’ˆï¼ˆ4å­—èŠ‚æˆ–8å­—èŠ‚ï¼‰</td></tr><tr><td style="text-align:center"><strong>æ•ˆç‡</strong></td><td style="text-align:center">ä½ï¼Œç‰¹åˆ«æ˜¯æ‹·è´ç»“æ„ä½“æˆ–ç±»å¯¹è±¡æ—¶</td><td style="text-align:center">é«˜ï¼ˆæ¨èï¼‰ï¼Œèµ·ä¸ªåˆ«åå³å¯</td><td style="text-align:center">é«˜ï¼Œæ‹·è´æŒ‡é’ˆå³å¯</td></tr><tr><td style="text-align:center"><strong>æ˜¯å¦ä¿®æ”¹</strong></td><td style="text-align:center">æ˜¯</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">ä¸èƒ½ä¿®æ”¹ä¸ºå…¶å®ƒå¯¹è±¡çš„å¼•ç”¨</td></tr><tr><td style="text-align:center"><strong>åˆå§‹åŒ–</strong></td><td style="text-align:center">ä¸å¿…è¦</td><td style="text-align:center">ä¸€å®šè¦</td><td style="text-align:center">ä¸å¿…è¦</td></tr><tr><td style="text-align:center"><strong>ä½•æ—¶ä½¿ç”¨</strong></td><td style="text-align:center">å‚æ•°ä¸å¸Œæœ›è¢«ä¿®æ”¹æ—¶</td><td style="text-align:center"><strong>ä¼˜å…ˆé€‰ç”¨å¼•ç”¨</strong>ã€ä¼ é€’<strong>ç»“æ„æˆ–ç±»å¯¹è±¡</strong>ã€å¸Œæœ›å‚æ•°è¢«ä¿®æ”¹</td><td style="text-align:center">è¿”å›å¤šä¸ªå€¼ã€éœ€ä¼ é€’ç©ºæŒ‡é’ˆï¼ˆå¼•ä¼ é€’ç”¨ä¸å…è®¸ç©ºå€¼ï¼‰ã€è¿”å›<strong>å±€éƒ¨å˜é‡å†…å­˜ï¼ˆ3.5ä¸­è¯¦è¿°ï¼‰</strong></td></tr></tbody></table></li><li><p><strong>æŒ‡é’ˆä¼ é€’ã€å¼•ç”¨ä¼ é€’åº•å±‚åŒºåˆ«</strong>ï¼Ÿ</p><ul><li><p><strong>æŒ‡é’ˆä¼ é€’æœ¬è´¨æ˜¯å€¼ä¼ é€’</strong>ã€‚å€¼ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œè¢«è°ƒå‡½æ•°çš„å½¢å¼å‚æ•°ä½œä¸ºè¢«è°ƒå‡½æ•°çš„å±€éƒ¨å˜é‡å¤„ç†ï¼Œä¼šåœ¨æ ˆä¸­å¼€è¾Ÿå†…å­˜ç©ºé—´ä»¥å­˜æ”¾ç”±ä¸»è°ƒå‡½æ•°ä¼ é€’è¿›æ¥çš„<strong>å®å‚å€¼</strong>ï¼Œä»è€Œå½¢æˆäº†å®å‚çš„ä¸€ä¸ªå‰¯æœ¬ï¼ˆæ›¿èº«ï¼‰ã€‚</p><p>æ‰€ä»¥å½¢å‚æŒ‡é’ˆï¼ˆå†…å®¹ï¼‰å˜äº†ï¼ˆä¿å­˜äº†å…¶å®ƒå˜é‡åœ°å€ï¼‰ï¼Œå®å‚æŒ‡é’ˆä¸ä¼šå˜ã€‚</p></li><li><p><strong>å¼•å‡ºä¼ é€’æœ¬è´¨æ˜¯é—´æ¥å¯»å€</strong>ã€‚å¼•ç”¨å‚æ•°ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œè¢«è°ƒå‡½æ•°çš„å½¢å¼å‚æ•°ä¹Ÿä½œä¸ºå±€éƒ¨å˜é‡åœ¨æ ˆä¸­å¼€è¾Ÿäº†å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯è¿™æ—¶å­˜æ”¾çš„æ˜¯ç”±ä¸»è°ƒå‡½æ•°æ”¾è¿›æ¥çš„<strong>å®å‚çš„åœ°å€</strong>ã€‚è¢«è°ƒå‡½æ•°å¯¹å½¢å‚ï¼ˆæœ¬ä½“ï¼‰çš„ä»»ä½•æ“ä½œéƒ½è¢«å¤„ç†æˆ<strong>é—´æ¥å¯»å€</strong>ï¼Œé€šè¿‡æ ˆä¸­å­˜æ”¾çš„åœ°å€è®¿é—®ä¸»è°ƒå‡½æ•°ä¸­çš„å®å‚å˜é‡ã€‚</p></li><li><p><strong>ç¬¦å·è¡¨ä¸åŒ</strong>ã€‚ç¨‹åºåœ¨ç¼–è¯‘æ—¶åˆ†åˆ«å°†æŒ‡é’ˆå’Œå¼•ç”¨æ·»åŠ åˆ°ç¬¦å·è¡¨ä¸Šï¼Œç¬¦å·è¡¨ä¸­è®°å½•çš„æ˜¯å˜é‡ååŠå˜é‡æ‰€å¯¹åº”åœ°å€ã€‚æŒ‡é’ˆå˜é‡åœ¨ç¬¦å·è¡¨ä¸Šå¯¹åº”çš„<u>åœ°å€å€¼</u>ä¸º<strong>æŒ‡é’ˆå˜é‡çš„åœ°å€å€¼</strong>ï¼Œè€Œå¼•ç”¨åœ¨ç¬¦å·è¡¨ä¸Šå¯¹åº”çš„<u>åœ°å€å€¼</u>ä¸º<strong>å¼•ç”¨å¯¹è±¡çš„åœ°å€å€¼</strong>ï¼ˆä¸å®å‚åå­—ä¸åŒï¼Œåœ°å€ç›¸åŒï¼Œç¼–è¯‘å™¨ç›´æ¥å¤„ç†ä¸ºæ“ä½œå¼•ç”¨å¯¹è±¡ï¼‰ã€‚</p></li></ul></li></ul><h4 id="3-4-6-ç‰¹æ®Šå‚æ•°">3.4.6 ç‰¹æ®Šå‚æ•°</h4><p>åœ¨è¿™ä¸€å°èŠ‚å°†æ¥è®¤è¯†ä¸‹æ¯”è¾ƒç‰¹æ®Šçš„ä¸¤ç±»å‚æ•°ã€‚</p><ul><li><p><strong>å‘½ä»¤è¡Œå‚æ•°</strong></p><p>å¦‚æœä½ è¿è¡Œè¿‡ä¸€äº›å¼€æºä»£ç /åº“ï¼Œç»å¸¸ä¼šè¦æ±‚ä½ è¾“å…¥æŒ‡å®šå‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ program arg1 arg2</span><br></pre></td></tr></table></figure><p>è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<strong>å¯ä»¥å‘å…¶ä»–å‡½æ•°è¾“å…¥å‚æ•°çš„æ–¹æ³•</strong>ï¼Œç‰¹åˆ«æ˜¯<u>ä½ æ— æ³•ä¿®æ”¹æºç æˆ–ç¨‹åºéœ€è¦ç”¨æˆ·æä¾›å‚æ•°æ—¶</u>ã€‚å½“ç„¶ï¼Œè¿˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å®ç°ï¼Œè¿™é‡Œæš‚ä¸è¡¨ã€‚</p><p>ä¸‹é¢å½¢å¼çš„mainå‡½æ•°å¯ä»¥æ¥å—å‘½ä»¤è¡Œå‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li><code>argc</code>ï¼šä¼ é€’çš„å‚æ•°é‡ä¸ªæ•°ï¼Œè‡³å°‘ä¸º1ï¼Œå› ä¸ºè‡³å°‘å­˜åœ¨<code>argv[0]</code> æŒ‡å‘å‡½æ•°æœ¬èº«åç§°ï¼›</li><li><code>argv</code>ï¼š Cé£æ ¼äºŒç»´æ•°ç»„ï¼Œå­˜å‚¨å‚æ•°ã€‚ä¾‹å¦‚ï¼Œ<code>argv[0][0]</code>æŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œ<code>argv[0]</code>æ˜¯ç¬¬ä¸€ä¸ªæ•°ç»„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„åœ°å€ã€‚</li></ul><p>ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œæ‰“å°ç”¨æˆ·è¾“å…¥çš„å§“åå’Œå¹´é¾„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc , <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;the count of paramters: &quot;</span>&lt;&lt; argc&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;the name of program: &quot;</span>&lt;&lt; argv[<span class="number">0</span>] &lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;your name: &quot;</span>&lt;&lt; argv[<span class="number">1</span>]&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;your age: &quot;</span>&lt;&lt; argv[<span class="number">2</span>]&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220102165327119.png" alt="image-20220102165327119"></p><p>ç‰¹åˆ«çš„ï¼Œæ“ä½œç³»ç»Ÿå¯¹å¦‚ä½•å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼ˆ<strong>å¦‚åŒå¼•å·å’Œåæ–œæ </strong>ï¼‰æœ‰ç‰¹æ®Šçš„è§„åˆ™ã€‚</p><ul><li><p><strong>åŒå¼•å·</strong>ï¼šä»¥åŒå¼•å·ä¼ é€’çš„å­—ç¬¦ä¸²è¢«è®¤ä¸ºæ˜¯åŒä¸€å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼ˆå³ä½¿å®ƒä»¬ä¹‹é—´å­˜åœ¨ç©ºæ ¼ï¼‰ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test.out <span class="string">&quot;royhuang cqu&quot;</span>  <span class="number">25</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ–œæ </strong>ï¼šå¦‚æœè¦åŒ…å«æ–‡å­—åŒå¼•å·ï¼Œåˆ™å¿…é¡»åæ–œæ åŒå¼•å·ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./test.out \<span class="string">&quot;royhuang\&quot;  25</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>çœç•¥å·ï¼ˆå¯å˜å‚æ•°</strong>ï¼‰</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æˆ‘ä»¬çœ‹åˆ°çš„æ‰€æœ‰å‡½æ•°ä¸­ï¼Œå‡½æ•°å°†é‡‡ç”¨çš„å‚æ•°æ•°é‡å¿…é¡»äº‹å…ˆçŸ¥é“ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå°†<u>å¯å˜æ•°é‡</u>çš„å‚æ•°ä¼ é€’ç»™å‡½æ•°ä¼šå¾ˆæœ‰ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">return_type <span class="title">function_name</span><span class="params">(argument_list, ...)</span></span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼šæˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—ä¸€ç»„æ•´æ•°çš„å¹³å‡å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdarg&gt;</span> <span class="comment">// needed to use ellipsis</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">findAverage</span><span class="params">(<span class="keyword">int</span> count, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> sum&#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡é¢„å®šä¹‰å®va_listè·å–å‚æ•°åˆ—è¡¨</span></span><br><span class="line">    va_list list;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡å®va_startå¯¹va_liståˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">va_start</span>(list, count);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚å’Œ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> arg&#123; <span class="number">0</span> &#125;; arg &lt; count; ++arg)</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="comment">// é€šè¿‡å®va_argè·å–å…·ä½“å‚æ•°</span></span><br><span class="line">         sum += <span class="built_in">va_arg</span>(list, <span class="keyword">int</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨å®Œåé€šè¿‡å®va_endæ¸…ç†va_list</span></span><br><span class="line">    <span class="built_in">va_end</span>(list);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum / count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">findAverage</span>(<span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">findAverage</span>(<span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ç»“æœè¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">3.5</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥è¿™å¾ˆæ£’ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸æ¨èä½¿ç”¨çœç•¥å·ï¼š</p><ol><li><p><strong>çœç•¥å·å¾ˆå±é™©ï¼šæ— æ³•åˆ¤æ–­ä¼ é€’çš„å‚æ•°ä¸ªæ•°æ˜¯æ­£ç¡®</strong></p><p>å‡è®¾ä½ åªä¼ é€’äº†5ä¸ªå‚æ•°ï¼Œè€Œå®é™…è¦æ±‚æ˜¯6ä¸ªï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">findAverage</span>(<span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>åœ¨ä½œè€…çš„æœºå™¨ä¸Šï¼Œè¿™äº§ç”Ÿäº†å¥‡æ€ªçš„ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">699773</span><br></pre></td></tr></table></figure><p><code>va_arg(list, int)</code> è¿”å›çš„å‰5ä¸ªå€¼æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å€¼ã€‚å®ƒè¿”å›çš„ç¬¬ 6 ä¸ªå€¼ï¼ˆ<strong>æ²¡æœ‰æŠ¥é”™</strong>ï¼‰æ˜¯ä¸€ä¸ªåƒåœ¾å€¼å †æ ˆã€‚ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªåƒåœ¾ç­”æ¡ˆã€‚</p></li><li><p><strong>çœç•¥å·å¾ˆå±é™©ï¼šç±»å‹æ£€æŸ¥è¢«æš‚åœ</strong></p><p>å¦‚æœä½ å°è¯•ä¼ é€’ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆ<code>1.0</code>ï¼‰ä½œä¸ºå‚æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">findAverage</span>(<span class="number">6</span>, <span class="number">1.0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure><p>ç»“æœä¸€å®šè®©ä½ å¤§åƒä¸€æƒŠï¼ˆè¿™æ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¹ˆå¤§çš„æ•°å­—ï¼Ÿï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.78782e+008</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º<code>va_arg(list, int)</code> æŒ‡å®šé¢„æœŸç±»å‹æ˜¯<code>int</code> ï¼Œä½†æ˜¯æˆ‘ä»¬åˆä¼ é€’doubleç±»å‹å‚æ•°ã€‚è¿™å¯¼è‡´ï¼š</p><ul><li>va_arg çš„ç¬¬ä¸€æ¬¡è°ƒç”¨å°†åªè¯»å– double çš„å‰ 4 ä¸ªå­—èŠ‚ï¼ˆäº§ç”Ÿåƒåœ¾ç»“æœï¼‰ï¼›</li><li>va_arg çš„ç¬¬äºŒæ¬¡è°ƒç”¨å°†è¯»å– double çš„å 4 ä¸ªå­—èŠ‚ï¼ˆäº§ç”Ÿå¦ä¸€ä¸ªåƒåœ¾ç»“æœï¼‰ï¼›</li><li>å› æ­¤ï¼Œæˆ‘ä»¬çš„æ€»ä½“ç»“æœæ˜¯åƒåœ¾ã€‚</li></ul></li><li><p><strong>é™å®šçœç•¥å·ï¼šå‚æ•°æ•°é‡å’Œç±»å‹</strong></p><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥äººä¸ºçš„ä¼ é€’ä¸€ä¸ªâ€œè§£ç å™¨å­—ç¬¦ä¸²â€ï¼Œå®ƒå‘Šè¯‰ç¨‹åºå¦‚ä½•è§£é‡Šå‚æ•°ï¼ˆé™å®šäº†æ•°é‡å’Œç±»å‹ï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdarg&gt;</span> <span class="comment">// needed to use ellipsis</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">findAverage</span><span class="params">(std::string decoder, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">double</span> sum&#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">va_list list;</span><br><span class="line"></span><br><span class="line"><span class="built_in">va_start</span>(list, decoder);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">char</span> codetype&#123; decoder[count] &#125;;</span><br><span class="line"><span class="built_in"><span class="keyword">switch</span></span> (codetype)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;\0&#x27;</span>:</span><br><span class="line"><span class="built_in">va_end</span>(list);</span><br><span class="line"><span class="keyword">return</span> sum / count;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;i&#x27;</span>:</span><br><span class="line">sum += <span class="built_in">va_arg</span>(list, <span class="keyword">int</span>);</span><br><span class="line">++count;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">sum += <span class="built_in">va_arg</span>(list, <span class="keyword">double</span>);</span><br><span class="line">++count;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="built_in">findAverage</span>(<span class="string">&quot;iiiii&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">cout &lt;&lt; <span class="built_in">findAverage</span>(<span class="string">&quot;iiiiii&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">cout &lt;&lt; <span class="built_in">findAverage</span>(<span class="string">&quot;iiddi&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3.5</span>, <span class="number">4.5</span>, <span class="number">5</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µæˆ‘ä»¬å®Œå…¨æœ‰å…¶å®ƒåˆç†çš„è§£å†³æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼š<strong>ä¸ºä»€ä¹ˆä¸å°†<code>...</code> æ¢æˆä¸€ä¸ªæ•°ç»„</strong>ï¼Ÿ</p></li><li><p><strong>æ¢æˆå…¶å®ƒæ–¹æ¡ˆï¼šåŠ¨æ€æ•°ç»„</strong></p><p>ä¸€èˆ¬æƒ…å†µï¼Œæˆ‘ä»¬éƒ½è¦é¿å…ä½¿ç”¨çœç•¥å·ï¼Œé€‰æ‹©å…¶å®ƒçš„æ–¹æ¡ˆã€‚æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¼ é€’ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">findAverage</span><span class="params">(<span class="keyword">int</span> len, <span class="keyword">int</span>* nums)</span></span>;</span><br></pre></td></tr></table></figure></li></ol></li></ul><h3 id="3-5-å‡½æ•°è¿”å›å€¼">3.5 å‡½æ•°è¿”å›å€¼</h3><p>åœ¨å‰é¢æˆ‘ä»¬å­¦ä¹ äº†<u>æŒ‰å€¼ã€å¼•ç”¨å’Œåœ°å€</u>å‘å‡½æ•°<strong>ä¼ é€’å‚æ•°</strong>ï¼Œå¦‚æœä½œä¸ºå‡½æ•°<strong>è¿”å›å€¼</strong>ä¼šæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><ul><li>æŒ‰å€¼è¿”å›çš„æ˜¯<code>value</code>çš„å‰¯æœ¬ï¼Ÿ</li><li>æŒ‰æŒ‡é’ˆè¿”å›çš„æ˜¯<code>value</code>çš„åœ°å€ï¼Ÿå±€éƒ¨å˜é‡åœ¨é€€å‡ºå‡½æ•°è¢«é”€æ¯æ—¶ï¼Œå®ƒçš„åœ°å€ä¸æ˜¯æ²¡æœ‰äº†å—ï¼Ÿ</li><li>æŒ‰å¼•ç”¨è¿”å›çš„æ˜¯<code>value</code>çš„åˆ«åï¼Ÿå±€éƒ¨å˜é‡åœ¨é€€å‡ºå‡½æ•°è¢«é”€æ¯æ—¶ï¼Œåˆ«åè¿˜æœ‰ç”¨å—ï¼Ÿ</li></ul><p>è¯·çœ‹ä¸‹æ–‡åˆ†è§£ã€‚</p><h4 id="3-5-1-æŒ‰å€¼è¿”å›">3.5.1 æŒ‰å€¼è¿”å›</h4><p>å’ŒæŒ‰å€¼ä¼ å‚ä¸€æ ·ï¼ŒæŒ‰å€¼è¿”å›å¾ˆå®‰å…¨ï¼Œå› ä¸ºå®ƒ<strong>åªè¿”å›<code>value</code>çš„å‰¯æœ¬ï¼Œä¸ç”¨æ‹…å¿ƒè¿”å›ä¹‹å<code>value</code>å‘ç”Ÿä»€ä¹ˆå˜åŒ–</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">doubleValue</span><span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value&#123; x * <span class="number">2</span> &#125;;</span><br><span class="line">    <span class="keyword">return</span> value; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="built_in">doubleValue</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿå’ŒæŒ‰å€¼ä¼ å‚ä¸€è‡´ï¼Œè¿”å›å¤§å‹ç»“æ„æˆ–ç±»æ—¶å¾ˆæ…¢ã€‚ä¸€èˆ¬å¸Œæœ›å€¼ä¸è¢«ä¿®æ”¹æˆ–è€…è¿”å›å±€éƒ¨å˜é‡æ—¶ä½¿ç”¨å€¼ä¼ é€’ã€‚</p><p><strong>è¿”å›å±€éƒ¨å˜é‡ï¼Ÿå‡½æ•°è°ƒç”¨ç»“æŸæ—¶å±€éƒ¨å˜é‡ä¸å°±è¢«é”€æ¯äº†ï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½è¿”å›</strong>ï¼Ÿ</p><p>åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­æ˜¯å±€éƒ¨å˜é‡è¢«å‹åˆ°æ ˆä¸­ï¼Œå½“å‡½æ•°é€€å‡ºæ—¶ï¼Œä¸´æ—¶å˜é‡å‡ºæ ˆï¼Œç¡®å®å·²ç»è¢«é”€æ¯ã€‚</p><p><strong>ä½†å±€éƒ¨å˜é‡ä½œä¸ºè¿”å›å€¼æ—¶åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œæœ‰äº›ç‰¹åˆ«çš„å˜åŒ–</strong>ã€‚</p><ul><li><p>Cè¯­è¨€é‡Œè§„å®šï¼š16bitç¨‹åºä¸­ï¼Œè¿”å›å€¼ä¿å­˜åœ¨axå¯„å­˜å™¨ä¸­ï¼Œ32bitç¨‹åºä¸­ï¼Œè¿”å›å€¼ä¿æŒåœ¨eaxå¯„å­˜å™¨ä¸­ï¼Œå¦‚æœæ˜¯64bitè¿”å›å€¼ï¼Œedxå¯„å­˜å™¨ä¿å­˜é«˜32bitï¼Œeaxå¯„å­˜å™¨ä¿å­˜ä½32bitã€‚</p></li><li><p>ç”±æ­¤å¯è§ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸåï¼Œ<strong>è¿”å›å€¼è¢«ä¸´æ—¶å­˜å‚¨åˆ°å¯„å­˜å™¨ä¸­</strong>ï¼Œå¹¶æ²¡æœ‰æ”¾åˆ°å †æˆ–æ ˆä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å†…å­˜æ²¡æœ‰å…³ç³»äº†ã€‚</p><p>ä¸‹å›¾çš„æ±‡ç¼–ä»£ç ä¹Ÿè¡¨æ˜äº†è¿™ä¸€ç‚¹ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220112002905629.png" alt="image-20220112002905629"></p></li></ul><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºå•¥ï¼šä¸Šè¿°ä»£ç valueè™½ç„¶ä½œä¸ºè¿”å›å€¼ä½†ä¹Ÿæ˜¯å±€éƒ¨å˜é‡ï¼Œå‡½æ•°è°ƒç”¨ç»“æŸæ—¶ï¼Œä¾æ—§æ­£ç¡®è¿”å›äº†å…¶å€¼ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ¥ç‰¹åˆ«å…³æ³¨ä¸€ä¸‹æŒ‰åœ°å€/å¼•ç”¨è¿”å›å±€éƒ¨å˜é‡çš„æƒ…å†µã€‚</p><h4 id="3-5-2-æŒ‰æŒ‡é’ˆè¿”å›">3.5.2 æŒ‰æŒ‡é’ˆè¿”å›</h4><p>å’ŒæŒ‰æŒ‡é’ˆä¼ é€’å‚æ•°ç±»ä¼¼ï¼ŒæŒ‰æŒ‡é’ˆè¿”å›çš„åªæ˜¯<strong>å°†<code>value</code> çš„åœ°å€å¤åˆ¶ä¸€ä»½è¿”å›</strong>ï¼Œæ‰€ä»¥é€Ÿåº¦å¾ˆå¿«ã€‚</p><ul><li><p><strong>å±é™©ï¼šè¿”å›å±€éƒ¨å˜é‡åœ°å€</strong></p><p>å±€éƒ¨å˜é‡åœ¨å‡½æ•°é€€å‡ºæ—¶å°±ä¼šè¢«é”€æ¯ï¼Œå¦‚æœå°è¯•è¿”å›å±€éƒ¨å˜é‡çš„åœ°å€ï¼Œè¿™ç§è¡Œä¸ºéå¸¸çš„å±é™©ï¼ˆåœ°å€å¯¹åº”çš„å†…å­˜å¯èƒ½å·²è¢«é‡Šæ”¾ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">doubleValue</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> d_value = i*<span class="number">2</span>;</span><br><span class="line">     <span class="keyword">return</span> &amp;d_value; <span class="comment">// è¿”å›å±€éƒ¨å˜é‡åœ°å€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span>* p = <span class="built_in">doubleValue</span>(value);</span><br><span class="line">    cout&lt;&lt;*p&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220103143317023.png" alt="image-20220103143317023"></p><p>ç¼–è¯‘å™¨ï¼ˆVSCodeï¼‰ç»™å‡ºäº†è­¦å‘Šï¼Œè™½ç„¶è¾“å‡ºå€¼å¾ˆå¹¸è¿æ˜¯æ­£ç¡®çš„ã€‚ä½†è¿™æ˜¯å› ä¸ºå±€éƒ¨å˜é‡<code>d_value</code>å¯¹åº”æ ˆç©ºé—´è¿˜å­˜åœ¨æ²¡æœ‰è¢«é‡æ–°åˆ†é…ä½¿ç”¨ï¼Œé€šè¿‡åœ°å€è·å–åˆ°äº†æ­£ç¡®çš„å€¼ã€‚</p><p>å¾ˆæ˜¾ç„¶è¿™ç§åšæ³•å¾ˆå±é™©ï¼Œä½ å¹¶ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å°±è¿”å›çš„æ˜¯ä¸€ä¸ªåƒåœ¾å€¼ï¼Œå› æ­¤ä¸å»ºè®®ä½ å»å°è¯•ã€‚</p></li><li><p><strong>é‚£æŒ‰æŒ‡é’ˆè¿”å›è¿˜æœ‰ä»€ä¹ˆç”¨é€”å—</strong>ï¼Ÿ</p><p><strong>æŒ‰æŒ‡é’ˆè¿”å›å¸¸ç”¨äºå°†åŠ¨æ€å†…å­˜è¿”å›ç»™è°ƒç”¨è€…</strong>ï¼Œå› ä¸ºåŠ¨æ€åˆ†é…çš„å†…å­˜ä¸ä¼šåœ¨å‡½æ•°é€€å‡ºæ—¶è¢«é”€æ¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">allocateArray</span><span class="params">(<span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[size]; <span class="comment">// åŠ¨æ€åˆ†é…ç©ºé—´</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span>* array&#123; <span class="built_in">allocateArray</span>(<span class="number">25</span>) &#125;;</span><br><span class="line">    <span class="keyword">delete</span>[] array;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œåˆ†é…ç©ºé—´ï¼ˆnew[]ï¼‰å’Œåˆ é™¤ç©ºé—´ï¼ˆdelete[]ï¼‰åœ¨ä»£ç ä¸åŒçš„å‡½æ•°ä¸­ï¼Œä½¿å¾—è°è´Ÿè´£åˆ é™¤èµ„æºå’Œæ˜¯å¦éœ€è¦åˆ é™¤èµ„æºå˜å¾—æœ‰ç‚¹éš¾ä»¥ç†è§£ã€‚</p><p>è¿™é‡Œæ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œç¬¬äºŒç« æœ‰ç›¸å…³ä»‹ç»ã€‚</p><p><strong>å¦å¤–ä¸€ä¸ªç”¨é€”å°±æ˜¯è¿”å›æŒ‰åœ°å€ä¼ é€’çš„å‚æ•°</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">doubleValue</span><span class="params">(<span class="keyword">int</span>* p_i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     *p_i = (*p_i)*<span class="number">2</span>;</span><br><span class="line">     <span class="keyword">return</span> p_i; <span class="comment">// è¿”å›æŒ‡é’ˆå‚æ•°p_i</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span>* p = <span class="built_in">doubleValue</span>(&amp;value);</span><br><span class="line">    cout&lt;&lt;p&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸è¯´è¯´è¿”å›åœ°å€å…¶å®ƒç”¨é€”å—</strong>ï¼Ÿ</p><p>æ—¢ç„¶æåˆ°è¿”å›åœ°å€å¾ˆå¿«ï¼Œé‚£ç”¨æ¥è¿”å›ç»“æ„ä½“ã€ç±»ä¸åº”è¯¥å¾ˆå¥½å—ï¼Ÿç„¶è€Œå¹¶ä¸æ˜¯ã€‚é“ç†åŒå‚æ•°ä¼ é€’ä¸­å°½é‡å»ºè®®ä½¿ç”¨å¼•ç”¨ä¸€æ ·ï¼š</p><ol><li>å¼•ç”¨æ›´å®‰å…¨ã€‚å¼•ç”¨ä¸€å®šä¼šè¢«åˆå§‹åŒ–ï¼Œä¸èƒ½ä¸ºç©ºã€‚</li><li>å¼•ç”¨æ•ˆç‡æ›´å¥½ã€‚æ¯”å¦‚å®ƒä¸ç”¨ç®¡ç†æŒ‡é’ˆææ„é‡Šæ”¾ä¹‹ç±»çš„é—®é¢˜ã€‚</li></ol></li></ul><h4 id="3-5-3-æŒ‰å¼•ç”¨è¿”å›">3.5.3 æŒ‰å¼•ç”¨è¿”å›</h4><p>ä¸æŒ‰æŒ‡é’ˆè¿”å›ç±»ä¼¼ï¼ŒæŒ‰å¼•ç”¨è¿”å›çš„å€¼ä¸èƒ½æ˜¯å±€éƒ¨å˜é‡ã€‚</p><ul><li><p><strong>å±é™©ï¼šä¸è¦è¿”å›å±€éƒ¨å¼•ç”¨</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>&amp; <span class="title">doubleValue</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> d_value = i*<span class="number">2</span>;</span><br><span class="line">     <span class="keyword">return</span> d_value;  <span class="comment">// è¿”å›å±€éƒ¨å¼•ç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span>&amp; ref = <span class="built_in">doubleValue</span>(value);</span><br><span class="line">    cout&lt;&lt;ref&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é“ç†åŒä¸ŠæŒ‰æŒ‡é’ˆè¿”å›ï¼Œé™¤éä½ æƒ³å“ªå¤©æ”¶åˆ°ä¸€ä¸ªå¯¹åƒåœ¾çš„å¼•ç”¨ã€‚</p></li><li><p><strong>ä»€ä¹ˆæ—¶å€™æŒ‰å¼•ç”¨è¿”å›</strong></p><p>é™¤äº†ä¸Šè¿°è¯´çš„æŒ‰å€¼è¿”å›ã€æŒ‰æŒ‡é’ˆè¿”å›çš„æƒ…å†µï¼Œå…¶å®ƒæ—¶å€™ä¸€èˆ¬éƒ½å»ºè®®æŒ‰å¼•ç”¨è¿”å›ã€‚</p><p><strong>æ¯”å¦‚è¿”å›å¤§å‹æ•°æ®ç»“æ„ã€ç±»ç­‰ï¼Œä»¥åŠè¿”å›æŒ‰å¼•ç”¨ä¼ é€’å‚æ•°æ—¶</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>&amp; <span class="title">doubleValue</span><span class="params">(<span class="keyword">int</span>&amp; i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     i = i*<span class="number">2</span>;</span><br><span class="line">     <span class="keyword">return</span> i;    <span class="comment">// è¿”å›æŒ‰å¼•ç”¨ä¼ é€’çš„å‚æ•°i</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span>&amp; ref = <span class="built_in">doubleValue</span>(value);</span><br><span class="line">    cout&lt;&lt;ref&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-5-4-å°ç»“">3.5.4 å°ç»“</h4><p><strong>ç¼–ç æ—¶é€‰æ‹©ä½•ç§æ–¹å¼è¿”å›å‚æ•°</strong>ï¼Ÿ</p><p>å’Œé€‰æ‹©ä½•ç§æ–¹å¼ä¼ é€’å‚æ•°å¾ˆåƒï¼š</p><ol><li>ä¸æƒ³ä¿®æ”¹<code>value</code>å°±æ˜¯æƒ³è¿”å›<code>value</code>ä¸€ä¸ªå‰¯æœ¬ï¼Œorè¿”å›å±€éƒ¨å˜é‡ï¼ˆè§ä¸‹èŠ‚è¿°ï¼‰ç”¨å€¼ä¼ é€’ï¼Œå¦åˆ™è½¬ä¸‹ä¸€æ­¥ï¼›</li><li>éœ€è¦åŠ¨æ€å†…å­˜åˆ†é…æ—¶ã€è¿”å›æŒ‰åœ°å€ä¼ é€’çš„å‚æ•°ï¼Œé€‰æ‹©åœ°å€ä¼ é€’ï¼Œå¦åˆ™è½¬ä¸‹ä¸€æ­¥ï¼›</li><li>å…¶å®ƒæƒ…å†µï¼Œä¸€èˆ¬é€‰ç”¨å¼•ç”¨ä¼ é€’ï¼ˆè¿”å¤§å‹ç»“æ„ä½“ã€ç±»ã€æŒ‰å¼•ç”¨ä¼ é€’çš„å‚æ•°ï¼‰ã€‚</li></ol><h4 id="3-5-5-è¿”å›å¤šä¸ªå€¼">3.5.5 è¿”å›å¤šä¸ªå€¼</h4><p>åœ¨<u>3.4.3</u> ä»‹ç»äº†ä½¿ç”¨åœ°å€ä¼ é€’å‚æ•°ï¼Œè¾¾åˆ°ç±»ä¼¼è¿”å›å¤šä¸ªå‚æ•°çš„æ•ˆæœã€‚ä½†æ˜¯è¿™ç§åšæ³•æ¯”è¾ƒåˆ«æ‰­ï¼Œä¹Ÿä¸å¤Ÿä¼˜é›…ã€‚C++æœ‰ä¸¤ç§æ¯”è¾ƒå¥½çš„æ–¹å¼ï¼š</p><ol><li><p><strong>ä½¿ç”¨ç»“æ„ä½“</strong></p><p>å°†è¦è¿”å›çš„å¤šä¸ªå‚æ•°å®šä¹‰ä¸ºä¸€ä¸ªç»“æ„ä½“ï¼Œæœ€åç›´æ¥è¿”å›ç»“æ„ä½“ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">int</span> m_x;</span><br><span class="line"><span class="keyword">double</span> m_y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">S <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">S s;</span><br><span class="line">s.m_x++;</span><br><span class="line">s.m_y++;</span><br><span class="line"><span class="keyword">return</span> s;  <span class="comment">// å€¼ä¼ é€’ï¼Œå¤åˆ¶ä¸€ä¸ªsçš„å‰¯æœ¬è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">S s = <span class="built_in">add</span>();</span><br><span class="line">cout &lt;&lt; s.m_x &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; s.m_y &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”è¿”å›æ•°ç»„ï¼Œç»“æ„ä½“å…è®¸å®šä¹‰æ›´å¤šç±»å‹çš„å€¼ï¼Œæ˜¾ç„¶æ›´çµæ´»ã€‚å…ƒç»„ <code>std::tuple</code> ä¹Ÿå¯ä»¥å®šä¹‰ä¸åŒç±»å‹å…ƒç´ åºåˆ—ã€‚</p></li><li><p><strong>ä½¿ç”¨å…ƒç»„</strong></p><p>è§ä¸‹ä¾‹ï¼Œä½¿ç”¨å…ƒç»„è¿”å›å¤šä¸ªä¸åŒç±»å‹çš„å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">tuple&lt;<span class="keyword">int</span>, <span class="keyword">double</span>&gt; <span class="title">returnTuple</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> &#123; <span class="number">5</span>, <span class="number">6.7</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">tuple s&#123; <span class="built_in">returnTuple</span>() &#125;; </span><br><span class="line">cout &lt;&lt; get&lt;<span class="number">0</span>&gt;(s) &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; get&lt;<span class="number">1</span>&gt;(s) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-6-å†…è”å‡½æ•°">3.6 å†…è”å‡½æ•°</h3><p>å‡½æ•°ç»™æˆ‘ä»¬æä¾›äº†éå¸¸å¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼š</p><ul><li>ä»£ç å¯ä»¥é‡å¤ä½¿ç”¨ï¼›</li><li>æä¾›ç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿å‚æ•°ç±»å‹åŒ¹é…ï¼ˆç±»ä¼¼å‡½æ•°çš„å®ä¸ä¼šï¼‰ï¼›</li><li>ä¾¿äºé˜…è¯»ã€è°ƒè¯•ï¼›</li><li>â€¦</li></ul><h4 id="3-6-1-é‚£å‡½æ•°æœ‰ä»€ä¹ˆç¼ºç‚¹å—ï¼Ÿ">3.6.1 é‚£å‡½æ•°æœ‰ä»€ä¹ˆç¼ºç‚¹å—ï¼Ÿ</h4><p>å‡½æ•°çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æ˜¯æ¯æ¬¡<strong>è°ƒç”¨å‡½æ•°</strong>æ—¶ï¼Œéƒ½ä¼šå‘ç”Ÿä¸€å®šé‡çš„æ€§èƒ½å¼€é”€ï¼ˆä¸­æ–­ç­‰ï¼‰ï¼Œæ¯”å¦‚ï¼š</p><ol><li>CPU å¿…é¡»å­˜å‚¨å®ƒæ­£åœ¨æ‰§è¡Œçš„å½“å‰æŒ‡ä»¤çš„åœ°å€ï¼ˆå› æ­¤å®ƒçŸ¥é“ç¨åè¿”å›åˆ°å“ªé‡Œï¼‰ä»¥åŠå…¶ä»–å¯„å­˜å™¨ï¼›</li><li>å¿…é¡»åˆ›å»ºæ‰€æœ‰å‡½æ•°å‚æ•°å¹¶èµ‹å€¼ï¼Œå¹¶ä¸”ç¨‹åºå¿…é¡»è·³è½¬åˆ°æ–°ä½ç½®ï¼›</li><li>â€¦</li></ol><p>å½“ç„¶ï¼Œ<strong>å¯¹äºå¤§å‹å¤æ‚çš„å‡½æ•°ï¼Œå‡½æ•°è°ƒç”¨æ—¶é—´ç›¸æ¯”å‡½æ•°è¿è¡Œæ—¶é—´å¾®ä¸è¶³é“ã€‚ä½†æ˜¯å¯¹äºæ¯”è¾ƒè½»å·§çš„å‡½æ•°ï¼Œè‹¥æ˜¯é¢‘ç¹è°ƒç”¨ï¼Œå‡½æ•°è°ƒç”¨çš„æ—¶é—´ä¾¿å¾ˆå¯è§‚äº†</strong>ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›è½»å·§åˆè¢«ç»å¸¸è°ƒç”¨çš„å‡½æ•°ï¼Œæœ€å¥½ä¸å¥½è¿›è¡Œè¿™äº›å¤æ‚è°ƒç”¨ã€è¿”å›æ“ä½œã€‚</p><p>å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿç±»ä¼¼äºé¢„ç¼–è¯‘å¤´æ–‡ä»¶çš„æ›¿æ¢ï¼Œç›´æ¥æŠŠ<strong>å‡½æ•°ä½“åµŒå…¥åˆ°æ¯ä¸€ä¸ªè°ƒç”¨äº†å®ƒçš„åœ°æ–¹ï¼Œé‡å¤åœ°åµŒå…¥</strong>ã€‚</p><p>è¯·çœ‹ä¸‹ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">min</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &gt; y ? y : x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">min</span>(<span class="number">5</span>, <span class="number">6</span>) ;</span><br><span class="line">    <span class="built_in">min</span>(<span class="number">3</span>, <span class="number">2</span>) ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>min(int,int)</code> è¢«å£°æ˜ä¸ºå†…è”å‡½æ•°ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œç›¸å½“ç›´æ¥åœ¨ç›¸åº”è°ƒç”¨ä½ç½®æ›¿æ¢ä¸ºå®é™…<code>min(int,int)</code>å‡½æ•°ä½“ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span> &gt; <span class="number">6</span> ? <span class="number">6</span> : <span class="number">5</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span> &gt; <span class="number">2</span> ? <span class="number">2</span> : <span class="number">3</span> ;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å°é—®é¢˜ï¼šå†…è”å‡½æ•°è¿™ä¹ˆæ£’ï¼Œé‚£æŠŠæ‰€æœ‰çš„å‡½æ•°å†™æˆå†…è”å‡½æ•°?</p></blockquote><p>å†…è”å‡½æ•°ä»¥ä»£ç å¤æ‚ä¸ºä»£ä»·ï¼Œå®ƒä»¥çœå»å‡½æ•°è°ƒç”¨çš„å¼€é”€æ¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚</p><ul><li><strong>åªé€‚åˆæ¯”è¾ƒç®€å•çš„å‡½æ•°</strong>ã€‚æ‰€ä»¥ä¸€æ–¹é¢å¦‚æœå†…è”å‡½æ•°ä½“å†…ä»£ç æ‰§è¡Œæ—¶é—´ç›¸æ¯”å‡½æ•°è°ƒç”¨å¼€é”€è¾ƒå¤§ï¼Œåˆ™æ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ï¼›</li><li><strong>å ç”¨å†…å­˜ç©ºé—´å¤š</strong>ã€‚å¦ä¸€æ–¹é¢æ¯ä¸€å¤„å†…è”å‡½æ•°çš„è°ƒç”¨éƒ½è¦å¤åˆ¶ä»£ç ï¼Œæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚</li></ul><p>å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´ç­–ç•¥ã€‚</p><h4 id="3-6-2-å†…è”å‡½æ•°ä»€ä¹ˆæ—¶å€™è¢«æ›¿æ¢ï¼Ÿ">3.6.2 å†…è”å‡½æ•°ä»€ä¹ˆæ—¶å€™è¢«æ›¿æ¢ï¼Ÿ</h4><p>åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œå®ä¼šç”±é¢„å¤„ç†å™¨å¯¹å®è¿›è¡Œæ›¿ä»£ï¼ˆé¢„ç¼–è¯‘é˜¶æ®µï¼‰ã€‚è€Œå†…è”å‡½æ•°ä¹Ÿä¼šé€šè¿‡ç¼–è¯‘å™¨æ¥å®ç°å±•å¼€æ›¿æ¢ï¼ˆç¼–è¯‘é˜¶æ®µï¼‰ã€‚</p><blockquote><p>ä¸ºäº†æ›´å¥½åœ°éªŒè¯æ‰€å­¦ï¼Œæˆ‘ä»¬é€šè¿‡åæ±‡ç¼–æ¥å¯¹æ¯”åŠ ä¸Š<code>inline</code>å‰åä»£ç çš„ä¸åŒä¹‹å¤„å¯¹æ¯”ã€‚</p></blockquote><p>å‡†å¤‡ä¸€ä¸ªæ›´ç®€å•çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span>  <span class="title">add</span><span class="params">(<span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    y++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">add</span>(x);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶åè¿›è¡Œåæ±‡ç¼–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -save-temps -fverbose-asm -g  test.cpp -o test.out</span><br><span class="line">objdump -S --disassemble test.out</span><br></pre></td></tr></table></figure><p>å…³é”®æ€§ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220103183107580.png" alt="image-20220103183107580" style="zoom:80%;" /><p>å¯ä»¥çœ‹åˆ°<code>main</code> <strong>å‡½æ•°ä½“å†…</strong>è¢«ç›´æ¥æ’å…¥äº†<code>add</code>å‡½æ•°çš„ä»£ç ï¼ˆç»¿è‰²æ¡†ï¼‰ã€‚</p><p>ä½†æ˜¯å¦‚æœ<code>add</code>å‡½æ•°æ˜¯éå†…è”å‡½æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é˜²æ­¢ç¼–è¯‘å™¨è‡ªå·±ä¼˜åŒ–ï¼Œå¼ºåˆ¶å£°æ˜ä¸ºéå†…è”å‡½æ•°</span></span><br><span class="line"><span class="keyword">int</span> __attribute__ ((noinline)) <span class="built_in">add</span>(<span class="keyword">int</span> y)</span><br></pre></td></tr></table></figure><p>åæ±‡ç¼–ç»“æœå¦‚å›¾æ‰€ç¤ºï¼Œ<code>add</code>å‡½æ•°ä»£ç å¹¶æ²¡æœ‰æ’å…¥åˆ°<code>main</code>å‡½æ•°ä½“å†…ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220103183933062.png" alt="image-20220103183933062" style="zoom:80%;" /><h4 id="3-6-3-å†…è”å‡½æ•°å’Œå®å¯¹æ¯”">3.6.3 å†…è”å‡½æ•°å’Œå®å¯¹æ¯”</h4><p>ä¸€ä¸ªå¸¸è€ƒçš„é¢è¯•é¢˜ï¼ŒåŠ æ·±ä¸‹å°è±¡ã€‚</p><ol><li><strong>æ›¿æ¢æ—¶æœº</strong>ã€‚å®åœ¨é¢„ç¼–è¯‘æ—¶è¢«æ›¿æ¢ï¼Œå†…è”å‡½æ•°æ˜¯åœ¨è¿è¡Œæ—¶ï¼ˆè‡³å°‘ä¸æ˜¯é¢„ç¼–è¯‘æ—¶ï¼‰ï¼›</li><li><strong>è°ƒè¯•</strong>ã€‚å†…è”å‡½æ•°åœ¨è¿è¡Œæ—¶å¯è°ƒè¯•ï¼Œè€Œå®å®šä¹‰ä¸å¯ä»¥;</li><li><strong>å®‰å…¨</strong>ã€‚ç¼–è¯‘å™¨ä¼šå¯¹å†…è”å‡½æ•°çš„å‚æ•°ç±»å‹åšå®‰å…¨æ£€æŸ¥æˆ–è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆåŒæ™®é€šå‡½æ•°ï¼‰ï¼Œè€Œå®å®šä¹‰åˆ™ä¸ä¼šï¼›</li><li><strong>è®¿é—®</strong>ã€‚å†…è”å‡½æ•°å¯ä»¥è®¿é—®ç±»çš„æˆå‘˜å˜é‡ï¼Œå®å®šä¹‰åˆ™ä¸èƒ½ã€‚</li></ol><h3 id="3-7-å‡½æ•°æŒ‡é’ˆ">3.7 å‡½æ•°æŒ‡é’ˆ</h3><h4 id="3-7-1-å‡½æ•°å’ŒæŒ‡é’ˆ">3.7.1 å‡½æ•°å’ŒæŒ‡é’ˆ</h4><p>åœ¨å‰ä¸€èŠ‚ï¼Œé€šè¿‡åæ±‡ç¼–ï¼Œä½ ä¹Ÿçœ‹åˆ°äº†ï¼ˆåœ¨<code>main</code>å‡½æ•°ä¸­ï¼‰è°ƒç”¨ï¼ˆ<code>add</code>ï¼‰å‡½æ•°æ˜¯é€šè¿‡ä¸€ä¸ªåœ°å€ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callq 40052d&lt;_Z3addi&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>40052d</code> ä¾¿æ˜¯å‡½æ•°<code>add</code> çš„åœ°å€ã€‚è®©æˆ‘ä»¬å°è¯•æ‰“å°ä¸€ä¸‹å‡½æ•°åœ°å€ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// å¦‚æœä½ çš„ç¼–è¯‘å™¨æ‰“å°å‡ºæ¥çš„åœ°å€æ˜¯1</span></span><br><span class="line">   <span class="comment">// éœ€è¦è½¬æ¢ä¸ºç©ºæŒ‡é’ˆï¼Œå¼ºåˆ¶ç¼–è¯‘å™¨æ‰“å°å‡ºåœ°å€ï¼š(void*)func</span></span><br><span class="line">   cout&lt;&lt;func&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x4007ad</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå°±åƒæŒ‡é’ˆä¸€æ ·ï¼Œ<code>func</code> ä¿å­˜çš„ä¹Ÿæ˜¯ä¸€ä¸ªåœ°å€ï¼Œåªä¸è¿‡å®ƒä¿å­˜çš„æ˜¯å‡½æ•°åœ°å€ã€‚<strong>æœ‰å‡½æ•°åœ°å€å°±å¯ä»¥è°ƒç”¨å‡½æ•°ï¼Œæ­¤æ—¶å¯å°†å‡½æ•°å‹å…¥æ ˆ</strong>ï¼ˆ3.8èŠ‚è¯¦è¿°ï¼‰ã€‚</p><p>åƒæŒ‡é’ˆä¸€æ ·ï¼Ÿé‚£ä¹ˆå¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼Œä½¿ç”¨<code>int*</code>æŒ‡é’ˆä¿å­˜å‡½æ•°æŒ‡é’ˆå—ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* p_func = func;</span><br><span class="line"><span class="built_in">p_func</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>å¾ˆä¸å¹¸æŠ¥é”™äº†ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220104223733205.png" alt="image-20220104223733205"></p><p>ä¸»è¦åŸå› æ˜¯å› ä¸ºï¼šè™½ç„¶<code>func</code> å’Œ<code>p_func</code>éƒ½æ˜¯æŒ‡é’ˆï¼Œä½†å®ƒä»¬ç±»å‹æ˜¯ä¸ä¸€æ ·çš„ã€‚å‡½æ•°<code>func</code> ç±»å‹æ˜¯<code>int(*)()</code> ,è€Œæˆ‘ä»¬ç»™å‡ºçš„æŒ‡é’ˆ<code>p_func</code>ç±»å‹æ˜¯<code>int*</code> ï¼Œæ— æ³•èµ‹å€¼ã€‚å°±åƒä½ ä¸èƒ½å°†<code>string*</code> ç±»å‹æŒ‡é’ˆèµ‹å€¼ç»™<code>int*</code> ç±»å‹æŒ‡é’ˆã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è‡³å°‘è¿˜å¾—è®©ä»–ä»¬å‚æ•°ç±»å‹ä¸€è‡´ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*p_func)() = func;</span><br><span class="line"><span class="built_in">p_func</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>ä¾æ—§æŠ¥é”™äº†ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220104224700403.png" alt="image-20220104224700403"></p><p>è¿™æ˜¯å› ä¸º<u>å‡½æ•°æŒ‡é’ˆ<code>p_func</code>çš„ç±»å‹å‚æ•°å’Œå‡½æ•°<code>func</code>ä¸ä¸€è‡´</u>ï¼Œç¼–è¯‘å™¨ç±»å‹æ£€æŸ¥æ—¶å‡ºé”™ã€‚</p><blockquote><p>é¢˜å¤–è¯ï¼šä¸ºä»€ä¹ˆæ˜¯åœ¨è¿è¡Œæ—¶æŠ¥é”™ï¼Œè€Œä¸åœ¨ç¼–è¯‘ä»£ç æ—¶æŠ¥é”™ï¼Ÿ</p><p>å› ä¸ºå‡½æ•°æŒ‡é’ˆæ˜¯åœ¨è¿è¡Œæ—¶æ‰ä¼šè¿›è¡Œè§£æã€‚</p></blockquote><p>æˆ‘ä»¬è¿˜åº”è¯¥æŒ‡å®šå…¶å‚æ•°ç±»å‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*p_func)(<span class="keyword">int</span>) = func;</span><br><span class="line"><span class="built_in">p_func</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>ä¸€åˆ‡åˆ°æ­¤å°±å¥½èµ·æ¥äº†ã€‚<code>p_func</code>æ­¤æ—¶è·å¾—äº†å‡½æ•°çš„åœ°å€ï¼Œå°±å¯ä»¥åƒ<code>func</code>ä¸€æ ·ä½¿ç”¨äº†ã€‚</p><p>ç‰¹åˆ«çš„ä¸‹é¢è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*p_func)(<span class="keyword">int</span>) = &amp;func; <span class="comment">// å‡½æ•°åå¤šäº†ä¸ª&amp;ï¼Œfuncå’Œ&amp;funcæ‰“å°å‡ºæ¥å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å‡½æ•°åœ°å€</span></span><br><span class="line"><span class="built_in">p_func</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><h4 id="3-7-2-ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°æŒ‡é’ˆï¼šå›è°ƒå‡½æ•°">3.7.2 ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°æŒ‡é’ˆï¼šå›è°ƒå‡½æ•°</h4><p>è™½ç„¶ï¼Œå‰é¢æˆ‘ä»¬äº†è§£äº†æ€ä¹ˆå®šä¹‰å’Œä½¿ç”¨å‡½æ•°æŒ‡é’ˆã€‚ä½†ä¸ç¦è¿˜æ˜¯æœ‰ç–‘æƒ‘ï¼š<strong>ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ<code>p_func</code> è°ƒç”¨å‡½æ•°<code>func</code>ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿç›´æ¥ä½¿ç”¨<code>func</code>ä¸å°±å¥½äº†</strong>ï¼Ÿ</p><p>æƒ³è±¡è¿™ä¹ˆä¸€ç§æƒ…å†µï¼š</p><ul><li>ä½ æœ‰ä¸€ä¸ªå‡½æ•°å‡å®šä¸º<code>funcA</code> , ä½†ä½ çš„åŠŸèƒ½éœ€è¦å¤–éƒ¨è‡ªå®šä¹‰ä¸€äº›è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼›</li><li>æ‰€ä»¥ä½ éœ€è¦ä¸€ä¸ªâ€œå‚æ•°â€æ¥ä¿å­˜è¿™äº›ç‰¹å®šçš„è§„åˆ™ï¼Œè€Œè¿™ä¸ªè§„åˆ™æ˜¾ç„¶æ˜¯ä¸€ä¸ªé€»è¾‘é›†åˆâ€”â€”æ¢å¥è¯ï¼Œå®ƒåº”è¯¥æ˜¯ä¸ªå‡½æ•°ã€‚</li></ul><p>é‚£ä¹ˆè¿™ä¸ªâ€œå‚æ•°â€æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯å‡½æ•°ç±»å‹ï¼ŸæŸä¸ªå‡½æ•°å¦‚æœä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯<strong>å›è°ƒå‡½æ•°</strong>ã€‚</p><p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­ï¼š</p><ul><li>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ’åºå‡½æ•°ï¼Œå°†æ•°å­—è¿›è¡Œæ’åºï¼šä½†æ’åºçš„è§„åˆ™ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œå®ƒå¯èƒ½æ˜¯ä»å¤§åˆ°å°æ’åˆ—ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»å°åˆ°å¤§æˆ–è€…å…¶å®ƒâ€”â€”æ€»ä¹‹å®ƒå–å†³äºç”¨æˆ·æ€ä¹ˆå®šä¹‰â€œè§„åˆ™â€ã€‚</li></ul><p>æˆ‘ä»¬ç»™å®šä¸€ä¸ªæ’åºå‡½æ•°å¦‚ä¸‹ï¼Œå®ƒæœ‰ä¸€ä¸ªå‚æ•°<code>bool (*comparisonFcn)(int, int)</code>ç”¨æ¥å®šä¹‰æ’åºè§„åˆ™ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº¤æ¢æ•°ç»„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>* arr,<span class="keyword">int</span> idx_i,<span class="keyword">int</span> idx_j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = arr[idx_i];</span><br><span class="line">    arr[idx_i] = arr[idx_j];</span><br><span class="line">    arr[idx_j] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ’åºè§„åˆ™</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">myCompare</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†’æ³¡æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> len, <span class="keyword">bool</span> (*compare)(<span class="keyword">int</span>,<span class="keyword">int</span>))</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)   <span class="comment">// å¤–è½®=n-1</span></span><br><span class="line">        <span class="comment">// * j=0,æ¯æ¬¡éƒ½æ˜¯ä»å¤´å¼€å§‹æ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt; len-i<span class="number">-1</span>; j++ ) <span class="comment">// å†…è½®=ä½™ä¸‹ä¹±åºæ•°-1</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">compare</span>(arr[j],arr[j+<span class="number">1</span>]))</span><br><span class="line">                <span class="built_in">swap</span>(arr,j,j+<span class="number">1</span>); </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> array[] = &#123;<span class="number">5</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>&#125;;</span><br><span class="line">   <span class="keyword">int</span> len = <span class="built_in"><span class="keyword">sizeof</span></span>(array)/<span class="built_in"><span class="keyword">sizeof</span></span>(array[<span class="number">0</span>]);</span><br><span class="line">   <span class="built_in">bubbleSort</span>(array,len,myCompare);</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len  ;i++)</span><br><span class="line">       cout&lt;&lt;array[i]&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶è¿™ç§æ–¹å¼ï¼Œä¼˜é›…ä¸”çµæ´»ï¼Œ<u>é™¤äº†å®šä¹‰çš„å‡½æ•°æŒ‡é’ˆå®åœ¨è¿‡äºä¸‘é™‹</u>ã€‚å½“ç„¶åœ¨ä¸Šè¿°<code>myCompare</code> å‡½æ•°ä¸­ï¼Œä½ ç”šè‡³å¯ä»¥å®šä¹‰ä¸€äº›å¥‡æ€ªçš„è§„åˆ™ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">myCompare2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span> ((a % <span class="number">2</span> == <span class="number">0</span>) &amp;&amp; !(b % <span class="number">2</span> == <span class="number">0</span>))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥å°è¯•è¾“å‡ºè¯•ä¸€è¯•ã€‚</p><h4 id="3-7-3-æ›´ä¼˜é›…åœ°ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ">3.7.3 æ›´ä¼˜é›…åœ°ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ</h4><p>å‰é¢æˆ‘ä»¬æåˆ°ï¼Œå‡½æ•°æŒ‡é’ˆçš„å£°æ˜å®åœ¨è¿‡äºä¸‘é™‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">bool</span></span> (*compare)(<span class="keyword">int</span>,<span class="keyword">int</span>);</span><br><span class="line"><span class="built_in"><span class="keyword">bool</span></span> (*)(<span class="keyword">int</span>,<span class="keyword">int</span>) compare;</span><br></pre></td></tr></table></figure><p>å¥½æ¶ˆæ¯ä½ ç°åœ¨æœ‰ä¸¤ç§æ–¹å¼è®©å®ƒçœ‹èµ·æ¥é¡ºçœ¼å¾ˆå¤šï¼š</p><h5 id="1-ç±»å‹åˆ«å">1. ç±»å‹åˆ«å</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹åˆ«å</span></span><br><span class="line"><span class="keyword">using</span>  bool_compare = <span class="built_in"><span class="keyword">bool</span></span>(*)(<span class="keyword">int</span>,<span class="keyword">int</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°ä¸­ä½¿ç”¨ï¼šå°±è¡Œä½¿ç”¨æ™®é€šçš„ç±»å‹ä¸€æ ·</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> len, bool_compare compare)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-function">2. function</h5><p>std::functionæ˜¯æ ‡å‡†åº“ <code>&lt;functional&gt;</code> å¤´æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä¹‹å‰çš„æ’åºå‡½æ•°ï¼Œé‡æ–°å®šä¹‰ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> len, std::function&lt;<span class="keyword">bool</span>(<span class="keyword">int</span>,<span class="keyword">int</span>)&gt;)</span></span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸»å‡½æ•°ä¸­ï¼Œå¦‚æ­¤è°ƒç”¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¶ä½™å‡½æ•°ä»£ç åŒå‰ï¼Œç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> array[] = &#123;<span class="number">5</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>&#125;;</span><br><span class="line">   <span class="keyword">int</span> len = <span class="built_in"><span class="keyword">sizeof</span></span>(array)/<span class="built_in"><span class="keyword">sizeof</span></span>(array[<span class="number">0</span>]);</span><br><span class="line">   std::function&lt;<span class="built_in"><span class="keyword">bool</span></span>(<span class="keyword">int</span>,<span class="keyword">int</span>)&gt; compare = myCompare;</span><br><span class="line">   <span class="built_in">bubbleSort</span>(array,len,compare);</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len  ;i++)</span><br><span class="line">       cout&lt;&lt;array[i]&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure><h5 id="3-functionæ˜¯ä»€ä¹ˆï¼Ÿ">3. functionæ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>æœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„äº‹æƒ…ï¼Œå‡½æ•°å®šä¹‰å¿…é¡»è¦å’Œä¸»å‡½æ•°ä¸­ä¼ é€’çš„å‚æ•°ç±»å‹ä¸€è‡´ï¼ˆéƒ½æ˜¯<code>std::function</code>ï¼‰ï¼Œä¸èƒ½å®šä¹‰ä¸ºæŒ‡é’ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> len, <span class="keyword">bool</span>(*)(<span class="keyword">int</span>,<span class="keyword">int</span>) compare)</span></span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è¿™ä¸ªæ—¶å€™è¿™æ ·è°ƒç”¨å‡½æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨mainä¸­</span></span><br><span class="line">std::function&lt;<span class="built_in"><span class="keyword">bool</span></span>(<span class="keyword">int</span>,<span class="keyword">int</span>)&gt; compare = myCompare;</span><br><span class="line"><span class="built_in">bubbleSort</span>(array,len,compare);</span><br></pre></td></tr></table></figure><p>ä¼šæŠ¥é”™ï¼š<code>error: cannot convert â€˜std::function&lt;bool(int, int)&gt;â€™ to â€˜bool (*)(int, int)â€™</code>ã€‚</p><p>å› ä¸º<code>std::function</code>æœ¬è´¨æ˜¯ä¸€ç§<strong>ç±»æ¨¡æ¿ï¼Œä¸æ˜¯å‡½æ•°</strong>ï¼Œæ˜¯å¯¹é€šç”¨ã€å¤šæ€çš„å‡½æ•°å°è£…ã€‚</p><ul><li>é€šè¿‡<code>std::function</code>å¯¹C++ä¸­å„ç§å¯è°ƒç”¨å®ä½“ï¼ˆæ™®é€šå‡½æ•°ã€Lambdaè¡¨è¾¾å¼ã€å‡½æ•°æŒ‡é’ˆã€ä»¥åŠå…¶å®ƒå‡½æ•°å¯¹è±¡ç­‰ï¼‰çš„å°è£…ï¼Œå½¢æˆä¸€ä¸ªstd::functionå¯¹è±¡ã€‚è®©æˆ‘ä»¬ä¸å†çº ç»“é‚£ä¹ˆå¤šçš„å¯è°ƒç”¨å®ä½“ï¼Œä¸€åˆ‡å˜çš„ç®€å•ç²—æš´ã€‚</li><li>æ¢å¥è¯è¯´ï¼Œ<code>std::function</code><strong>å°±æ˜¯å‡½æ•°çš„å®¹å™¨ï¼Œå®ƒè‡ªå·±æ˜¯ä¸ªç±»å¯¹è±¡</strong>ã€‚å½“æˆ‘ä»¬æœ‰äº†å‡½æ•°çš„å®¹å™¨ä¹‹åä¾¿èƒ½å¤Ÿ<strong>æ›´åŠ æ–¹ä¾¿çš„å°†å‡½æ•°ã€å‡½æ•°æŒ‡é’ˆä½œä¸ºå¯¹è±¡è¿›è¡Œå¤„ç†</strong>ã€‚</li></ul><p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„åŸå‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt; <span class="class"><span class="keyword">class</span> <span class="title">R</span>, <span class="title">class</span>... <span class="title">Args</span> &gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">function</span>&lt;</span><span class="built_in">R</span>(Args...)&gt;</span><br></pre></td></tr></table></figure><p>ç±»ä¸ºfunctionï¼ŒRæ˜¯è¿”å›å€¼ç±»å‹ï¼ŒArgsæ˜¯å‡½æ•°çš„å‚æ•°ç±»å‹ã€‚å†å›æƒ³æˆ‘ä»¬ä¹‹å‰çš„è°ƒç”¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::function&lt;<span class="built_in"><span class="keyword">bool</span></span>(<span class="keyword">int</span>,<span class="keyword">int</span>)&gt; compare = myCompare;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œ<strong>æ­¤æ—¶<code>compare</code> æœ¬è´¨æ˜¯ä¸€ä¸ªfunctionç±»å¯¹è±¡ï¼Œåªä¸è¿‡é‡è½½äº†å…¶å‡½æ•°è°ƒç”¨æ“ä½œç¬¦()ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç›´æ¥åƒå‡½æ•°ä¸€æ ·è°ƒç”¨</strong>ã€‚</p><p>ç‰¹åˆ«çš„ï¼Œ<strong>functionç±»è¿˜é‡è½½äº†èµ‹å€¼æ“ä½œç¬¦=ï¼Œè¿™æ ·å¯ä»¥å°†å¯è°ƒç”¨çš„å‡½æ•°å®ä½“èµ‹å€¼ç»™å®ƒ</strong>ã€‚å…¶å‡½æ•°è°ƒç”¨æ“ä½œç¬¦é‡è½½å‡½æ•°é‡Œé—´æ¥çš„è°ƒç”¨èµ‹å€¼æ—¶ä¼ è¿›æ¥çš„è°ƒç”¨å®ä½“ã€‚</p><h5 id="4-ä½¿ç”¨auto">4. ä½¿ç”¨auto</h5><p>ä½¿ç”¨autoå…³é”®å­—è‡ªåŠ¨æ¨æ–­ç±»å‹ï¼Œå¯æ›´ç®€ä¾¿åœ°ä½¿ç”¨å‡½æ•°æŒ‡é’ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> compare = myCompare;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™<code>compare</code>éšè—äº†ç±»å‹å…·ä½“å®šä¹‰ï¼Œå¦‚æœå¸Œæœ›è¯»è€…æ›´äº†è§£è¿™æ®µä»£ç æ„ä¹‰ï¼Œä½¿ç”¨<code>typedef</code> åº”è¯¥æ˜¯ä¸ªæ›´å¥½çš„åšæ³•ã€‚</p><h4 id="3-7-4-CPUçœ¼ä¸­çš„å‡½æ•°æŒ‡é’ˆï¼šå˜é‡">3.7.4  CPUçœ¼ä¸­çš„å‡½æ•°æŒ‡é’ˆï¼šå˜é‡</h4><p>å»ç¹å½’çœŸï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹CPUçœ¼ä¸­çš„å‡½æ•°æŒ‡é’ˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç­”æ¡ˆå¯èƒ½ä¼šè®©ä½ æƒŠå¥‡ï¼šå®ƒåœ¨CPUçœ¼ä¸­ä¸è¿‡æ˜¯ä¸€ä¸ªè¿‡åº¦åŒ…è£…çš„å˜é‡è€Œå·²ï¼Œå°±åƒæŒ‡é’ˆä¸€æ ·ä¹Ÿåªæ˜¯å˜é‡ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.zhihu.com/zvideo/1433792635044048898">CPUçœ¼é‡Œçš„â€œå‡½æ•°æŒ‡é’ˆâ€ï¼šè¿‡åº¦åŒ…è£…çš„â€œå˜é‡â€ - é˜¿å¸ƒçš„è§†é¢‘ - çŸ¥ä¹ </a></p><h4 id="3-7-5-å°ç»“">3.7.5 å°ç»“</h4><ul><li><p><strong>ä»€ä¹ˆæ˜¯å‡½æ•°æŒ‡é’ˆ</strong>ï¼Ÿ</p><p>å‡½æ•°æŒ‡é’ˆæ˜¯æŒ‡å‘ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼ˆå³å‡½æ•°ï¼‰çš„æŒ‡é’ˆå˜é‡ã€‚</p><ul><li>å‡½æ•°çš„åå­—ä¹Ÿå¯è§†ä¸ºæ˜¯å‡½æ•°çš„æŒ‡é’ˆï¼›</li><li>ä½¿ç”¨é‡è½½åçš„<code>()</code> å³<code>å‡½æ•°å()</code> ä¾¿æ˜¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚</li></ul><p>å®ƒåœ¨CPUçœ¼ä¸­ä¸è¿‡æ˜¯è¿‡åº¦åŒ…è£…çš„â€œå˜é‡â€ã€‚</p></li><li><p><strong>å‡½æ•°æŒ‡é’ˆçš„å£°æ˜&amp;èµ‹å€¼æ–¹å¼</strong>ï¼Ÿ</p><p>ä»¥ä¸‹ä¸ºä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*p_func)(<span class="keyword">int</span>) = func </span><br><span class="line"><span class="built_in"><span class="keyword">int</span></span> (*p_func)(<span class="keyword">int</span>) = &amp;func</span><br></pre></td></tr></table></figure></li><li><p><strong>å‡½æ•°æŒ‡é’ˆçš„ç”¨é€”</strong>ï¼Ÿ</p><p>å‡½æ•°æŒ‡é’ˆè¿˜å…è®¸å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œå³å›è°ƒå‡½æ•°ã€‚</p></li></ul><h3 id="3-8-æ ˆå’Œå †ğŸŒŸ">3.8 æ ˆå’Œå †ğŸŒŸ</h3><p>åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¥äº†è§£ç¨‹åºè¿è¡Œæ—¶ï¼Œå‡½æ•°è°ƒç”¨æ›´åº•å±‚çš„è¿‡ç¨‹ã€‚ä¸è¿‡åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹å†…å­˜å¸ƒå±€ã€‚</p><h4 id="3-8-1-å†…å­˜å¸ƒå±€">3.8.1 å†…å­˜å¸ƒå±€</h4><blockquote><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>32</mn></mrow><annotation encoding="application/x-tex">32</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">32</span></span></span></span>ä½ç³»ç»Ÿ4GBï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>32</mn></msup><mo>=</mo><mn>4</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">2^{32}=4GB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span></span></span></span>ï¼‰ã€‚</p></blockquote><p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªè™šæ‹Ÿè¿›ç¨‹ï¼ˆç¨‹åºï¼‰å†…å­˜ç©ºé—´<u>è¿è¡Œæ—¶</u>åˆ†å¸ƒå¸ƒå±€ï¼Œæ³¨æ„åˆ°æ­¤æ—¶è¿˜<u>å¤šäº†å †&amp;æ ˆç”¨æ¥ç»™ç¨‹åºè¿è¡Œæ—¶è¿›è¡Œç©ºé—´åˆ†é…</u>ã€‚</p><ul><li><p><strong>ä¸€ä¸ªç¨‹åºï¼ˆæ¯”å¦‚hello.outï¼‰æœ¬è´¨æ˜¯ç”±æ•°æ®æ®µã€ä»£ç æ®µã€.bssæ®µï¼ˆå›¾ä¸­å’Œæ•°æ®æ®µåˆå¹¶äº†ï¼‰ä¸‰ä¸ªç»„æˆçš„ã€‚</strong></p></li><li><p>å¦å¤–ï¼Œé«˜åœ°å€çš„1GBï¼ˆWindowsé»˜è®¤2GBï¼‰ç©ºé—´åˆ†é…ç»™å†…æ ¸ï¼Œä¹Ÿç§°ä¸º<strong>å†…æ ¸ç©ºé—´</strong>ï¼›å‰©ä¸‹çš„3GBåˆ†ç»™ç”¨æˆ·ï¼Œä¹Ÿç§°<strong>ç”¨æˆ·ç©ºé—´</strong>ï¼ˆç¨‹åºä½¿ç”¨çš„ï¼‰ã€‚</p></li></ul><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/5e8d39d19a216fd03392d36081e70b7e.jpg" alt="ä½ ç¡®å®šä½ ç†è§£å†…å­˜åˆ†é…å—ï¼Ÿ" style="zoom:80%;" /><p>ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬æ›´å…³æ³¨çš„æ˜¯ç”¨æˆ·ç©ºé—´ä¸­çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><ul><li><p><strong>æ ˆï¼ˆStack</strong>ï¼‰ï¼šå­˜å‚¨ä»£ç ä¸­è°ƒç”¨å‡½æ•°ã€å®šä¹‰<u><strong>å±€éƒ¨</strong>å˜é‡</u>(ä½†ä¸åŒ…å«staticä¿®é¥°çš„å˜é‡)ã€ä¿å­˜çš„ä¸Šä¸‹æ–‡ç­‰ï¼›</p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾çš„æ•°æ®ä»<strong>æ ˆé¡¶ï¼ˆä½åœ°å€</strong>ï¼‰å‹å…¥ï¼Œä¹Ÿæ˜¯ä»<strong>æ ˆé¡¶ï¼ˆä½åœ°å€</strong>ï¼‰å¼¹å‡ºï¼Œæ‰€ä»¥æœ‰äººè¯´æ ˆæ˜¯<strong>å‘ä¸‹ç”Ÿé•¿</strong>çš„ã€‚å‡½æ•°é€€å‡ºæ—¶ï¼Œæ‰€æœ‰æ•°æ®ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼ˆå‡ºæ ˆï¼‰ã€‚</p><img src="https://pic1.zhimg.com/v2-4a47248b485bc764430e802f87ee950c_b.webp" alt="img" style="zoom:67%;" /></li></ul></li><li><p><strong>æ–‡ä»¶æ˜ å°„åŒºåŸŸ ï¼š</strong> æ ˆå’Œå †ä¸­é—´é‚£ä¸ªç©ºç™½åŒºåŸŸã€‚åŠ¨æ€åº“ã€å…±äº«å†…å­˜ç­‰æ˜ å°„ç‰©ç†ç©ºé—´çš„å†…å­˜ï¼Œä¸€èˆ¬æ˜¯ <code>mmap</code> å‡½æ•°æ‰€åˆ†é…çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p></li><li><p><strong>å †ï¼ˆHeap</strong>ï¼‰ï¼šå­˜å‚¨é‚£äº›ç”Ÿå­˜æœŸ<u>ä¸å‡½æ•°è°ƒç”¨æ— å…³çš„æ•°æ®</u>ï¼Œå¦‚åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚å †ï¼ˆåŠ¨æ€ï¼‰åˆ†é…çš„æ¥å£é€šå¸¸æœ‰malloc()ã€calloc()ã€realloc()ã€newç­‰ã€‚</p><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šç›¸å¯¹äºæ ˆï¼Œå †æ˜¯<strong>å‘ä¸Šç”Ÿé•¿</strong>çš„ï¼›å †ç©ºé—´éœ€è¦ä¸»åŠ¨é‡Šæ”¾ï¼Œå¦åˆ™ä¼šä¾ç„¶å­˜åœ¨ã€‚</li></ul></li><li><p><strong>.bssæ®µ</strong>ï¼šå…¨ç§°Block Started by Symbolï¼Œä¹Ÿå°±æ˜¯æœªè¢«åˆå§‹åŒ–çš„<strong>å…¨å±€</strong>å˜é‡ã€<strong>é™æ€</strong>å˜é‡çš„å†…å®¹çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚æ¯”å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span>  <span class="keyword">int</span> a;  <span class="comment">// ä¿å­˜.bssæ®µ</span></span><br><span class="line"><span class="keyword">int</span> b = <span class="number">2</span>;     <span class="comment">// å…¨å±€å˜é‡ï¼Œä¿å­˜åœ¨.bssæ®µ</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ•°æ®æ®µï¼ˆ.data</strong>ï¼‰ï¼šä¿å­˜<strong>å…¨å±€</strong>å˜é‡ã€<strong>å¸¸é‡</strong>ã€é™æ€å˜é‡çš„å†…å®¹çš„ä¸€å—å†…å­˜åŒºåŸŸï¼ŒåŒºåˆ«.bssæ®µåœ¨äºå˜é‡å·²ç»è¢«åˆå§‹åŒ–ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span>  <span class="keyword">int</span> a = <span class="number">1</span>;  <span class="comment">// ä¿å­˜åœ¨.dataæ®µä¸­é™æ€åŒº</span></span><br><span class="line"><span class="keyword">int</span> b = <span class="number">2</span>;  <span class="comment">// ä¿å­˜åœ¨.dataæ®µä¸­å…¨å±€åŒº</span></span><br><span class="line"><span class="keyword">char</span>* str =  <span class="string">&quot;royhuang&quot;</span>; <span class="comment">// &quot;royhuang&quot;æ˜¯æ–‡å­—å¸¸é‡ï¼Œä¿å­˜åœ¨å¸¸é‡åŒº</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> c = <span class="number">3</span>;   <span class="comment">// åŒä¸Š</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä»£ç æ®µï¼ˆ.text &amp; .init</strong>ï¼‰ï¼š <code>.text</code> ç”¨äºå­˜æ”¾æ•´ä¸ªç¨‹åºä¸­çš„ä»£ç ï¼› <code>.init</code> ç”¨äºå­˜æ”¾ç³»ç»Ÿä¸­ç”¨æ¥åˆå§‹åŒ–å¯åŠ¨ä½ çš„ç¨‹åºçš„ä¸€æ®µä»£ç  ã€‚</p></li></ul><p><strong>ä¸€ä¸ªç¨‹åºæœ¬è´¨å…¶å®éƒ½æ˜¯ç”±.bssæ®µã€æ•°æ®æ®µã€ä»£ç æ®µä¸‰ä¸ªç»„æˆçš„ã€‚</strong></p><h4 id="3-8-2-å‡½æ•°è°ƒç”¨è¿‡ç¨‹">3.8.2 å‡½æ•°è°ƒç”¨è¿‡ç¨‹</h4><p>åœ¨è¿™ä¸€å°èŠ‚æˆ‘ä»¬æ¥æ·±å…¥æ¢è®¨ä¸‹å‡½æ•°è°ƒç”¨æ—¶çš„åŸç†å’Œè¿‡ç¨‹ã€‚</p><h5 id="æ ˆå¸§">æ ˆå¸§</h5><p>å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œæ ˆæ˜¯ä½äºè¿›ç¨‹çš„é«˜åœ°å€ä½ç½®ï¼Œä¸”æ ˆé¡¶æ˜¯å‘ä¸‹å¢é•¿çš„ã€‚åœ¨<u>å‡½æ•°è°ƒç”¨</u>æ—¶ï¼Œ<strong>æ ˆä¼šä¸“é—¨ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„æ ˆå¸§ä¿å­˜å‡½æ•°è°ƒç”¨éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯</strong>ã€‚è¿™å¯¹åé¢ç†è§£å‡½æ•°æ‰§è¡Œè¿‡ç¨‹å¾ˆå…³é”®ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„æ ˆå¸§å¦‚ä¸‹ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/stack1.png" alt="img"></p><ul><li><strong>æ ˆå¸§ä¿å­˜çš„å†…å®¹</strong>ï¼šæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨éœ€è¦çš„å‡½æ•°è¿”å›åœ°å€ã€å‚æ•°ã€ä¸´æ—¶å˜é‡ã€ä¿å­˜çš„ä¸Šä¸‹æ–‡ç­‰ï¼›</li><li><strong><code>esp</code>å’Œ<code>ebp</code></strong> ï¼šéå¸¸é‡è¦çš„ä¸¤ä¸ªå¯„å­˜å™¨ï¼Œè®°å½•äº†å½“å‰<strong>æ ˆå¸§</strong>çš„<strong>æ ˆé¡¶ä½ç½®å’Œæ ˆåº•ä½ç½®</strong>ï¼ˆå¯¹äº<code>X86-64</code>å¹³å°ä¸Šæ¥è¯´ï¼Œå¯¹åº”çš„å¯„å­˜å™¨åˆ™ä¸º<code>rsp</code>åŠ<code>rbp</code>ï¼‰ ã€‚<ul><li>å¯ä»¥çœ‹åˆ°åœ¨ä¸Šå›¾å‹æ ˆï¼ˆpushï¼‰ä¼šä½¿å¾—espå‘ä¸‹ç§»åŠ¨ï¼ˆåœ°å€å˜å°ï¼‰ã€‚</li></ul></li></ul><h5 id="æ±‡ç¼–åˆ†æ">æ±‡ç¼–åˆ†æ</h5><p>æˆ‘ä»¬å‡†å¤‡çš„éªŒè¯ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> sp1, <span class="keyword">int</span> sp2)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res = sp1 + sp2;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> res =  <span class="built_in">foo</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åæ±‡ç¼–çš„ä»£ç åŠåˆ†æå¦‚ä¸‹ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220109134057556.png" alt="image-20220109134057556"></p><ul><li><p>mainå‡½æ•°æ±‡ç¼–ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">        pushq   %rbp   # å¯„å­˜å™¨rbpä¿å­˜ä¸Šä¸€ä¸ªæ ˆå¸§æ ˆåº•ä½ç½® </span><br><span class="line">        movq    %rsp, %rbp # å¯„å­˜å™¨rspæŒ‡å‘æ ˆé¡¶ä½ç½®ï¼Œç”¨rspå†…å®¹åˆå§‹åŒ–å¯„å­˜å™¨rbq</span><br><span class="line">        subq    $16, %rsp</span><br><span class="line">        movl    $2, %esi # ç«‹å³æ•°å¯»å€ï¼Œå°†fooç¬¬äºŒä¸ªå‚æ•°å­˜å…¥å¯„å­˜å™¨esiä¸­</span><br><span class="line">        movl    $1, %edi # å°†fooçš„ç¬¬ä¸€ä¸ªå‚æ•°å­˜å…¥å¯„å­˜å™¨ediä¸­</span><br><span class="line">        call    _Z3fooii # è°ƒç”¨fooï¼Œè½¬åˆ°åˆ†æfooå‡½æ•°æ±‡ç¼–ä»£ç ï¼Œæ­¤æ—¶callè¿˜å°†ä¸‹ä¸€æ¡æŒ‡ä»¤å½“åšè¿”å›åœ°å€å‹å…¥åˆ°æ ˆä¸­</span><br><span class="line">        movl    %eax, -4(%rbp) # è¿”å›å‡½æ•°ç»“æœç»™resï¼Œå®ƒçš„åœ°å€æ˜¯-4(%rbp)</span><br><span class="line">        movl    $0, %eax # eaxè¢«ç½®ä¸º0ï¼Œä¸»å‡½æ•°é€€å‡º</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure></li><li><p>fooå‡½æ•°æ±‡ç¼–ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">_Z3fooii:</span><br><span class="line">        pushq   %rbp  # ä¿å­˜mainçš„æ ˆåº•åœ°å€rbpï¼Œç”¨äºè¿”å›</span><br><span class="line">        movq    %rsp, %rbp # é‡ç½®fooå‡½æ•°çš„æ ˆå¸§</span><br><span class="line">        movl    %edi, -20(%rbp) # å‚æ•°1å…¥æ ˆ</span><br><span class="line">        movl    %esi, -24(%rbp) # å‚æ•°2å…¥æ ˆ</span><br><span class="line">        movl    -20(%rbp), %edx # å‚æ•°1å­˜å…¥edx</span><br><span class="line">        movl    -24(%rbp), %eax # å‚æ•°2å­˜å…¥eax</span><br><span class="line">        addl    %edx, %eax      # åŠ æ³•è¿ç®—ï¼Œç»“æœä¿å­˜åœ¨eaxä¸­</span><br><span class="line">        movl    %eax, -4(%rbp)  # å°†è¿ç®—ç»“æœèµ‹å€¼ç»™result,å®ƒçš„ä½ç½®ä¸ºrbp-4 </span><br><span class="line">        movl    -4(%rbp), %eax  # å°†resultèµ‹å€¼ç»™eaxï¼Œeaxä¸ºå‡½æ•°è¿”å›å€¼</span><br><span class="line">        popq    %rbp # è·³è½¬åˆ°mainå‡½æ•°ï¼ˆæ ˆåº•ï¼‰ï¼Œç„¶åè¿˜éœ€è¦è·³åˆ°è¿”å›åœ°å€</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure></li></ul><blockquote><p><strong>æ ˆå‹å…¥é¡ºåº</strong>ï¼šå½“å‰æ ˆå¸§çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚rbpï¼‰â€”&gt; å½“å‰å‡½æ•°çš„å‚æ•°ï¼ˆé€†åºï¼‰â€”&gt;å½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡ç­‰â€”&gt;â€¦â€”&gt;é€€å‡ºã€‚</p></blockquote><ul><li><strong>åœ¨è°ƒç”¨å‡½æ•°ï¼ˆmainï¼‰å‡½æ•°ä¸­</strong><ol><li><strong>ä¿å­˜ä¸Šä¸€ä¸ªæ ˆå¸§çš„rbpï¼Œé‡ç½®mainæ ˆå¸§çš„rbp</strong>ï¼›</li><li>æŒ‰ç…§ä¸è¢«è°ƒå‡½æ•°fooçš„<strong>å½¢å‚é¡ºåºç›¸åçš„é¡ºåº</strong>å‹å…¥æ ˆä¸­ï¼ˆåœ¨æœ¬ä¾‹æ˜¯ç›´æ¥å­˜å…¥å¯„å­˜å™¨ä¸­ï¼Œå› ä¸ºç›´æ¥ä¼ å…¥å¸¸é‡foo(1,2)ï¼‰ï¼›</li><li><strong>callæŒ‡ä»¤è°ƒç”¨</strong>ï¼š è°ƒç”¨è€…å‡½æ•°ï¼ˆmainï¼‰ä½¿ç”¨callæŒ‡ä»¤è°ƒç”¨è¢«è°ƒå‡½æ•°ï¼ˆfooï¼‰ï¼Œä¸ºfooå‡½æ•°åˆ†é…æ ˆå¸§ç©ºé—´ï¼Œ<strong>å¹¶æŠŠcallæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å½“æˆè¿”å›åœ°å€</strong>å‹å…¥æ ˆä¸­ï¼ˆè¿™ä¸ªå‹æ ˆæ“ä½œæ˜¯éšå«çš„ï¼‰</li></ol></li><li><strong>åœ¨è¢«è°ƒç”¨å‡½æ•°ï¼ˆfooï¼‰å‡½æ•°ä¸­</strong><ol><li>ä¿å­˜mainæ ˆå¸§çš„rbpï¼Œé‡ç½®fooæ ˆå¸§çš„rbpï¼›</li><li>è¢«è°ƒå‚æ•°sp1ã€sp2å‹å…¥æ ˆä¸­ï¼›</li><li>æ‰§è¡Œfooå‡½æ•°ä½“ä¸­ä»£ç ï¼Œè¿”å›å€¼reså…¥æ ˆï¼Œ<strong>ç„¶åä¿å­˜åœ¨å¯„å­˜å™¨eaxä¸­</strong> ï¼›</li><li>æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆå¸§æ‰€æœ‰æ•°æ®å‡ºæ ˆï¼›</li><li><code> popq %rbp å’Œ ret</code> è·³è½¬mainä¸­callæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ç»§ç»­æ‰§è¡Œã€‚</li></ol></li><li><strong>å›åˆ°è°ƒç”¨å‡½æ•°ï¼ˆmainï¼‰å‡½æ•°ä¸­</strong><ol><li>è¿”å›å€¼resï¼ˆå¯„å­˜å™¨eaxä¸­å†…å®¹ï¼‰å‹å…¥æ ˆï¼›</li><li>ç»§ç»­mainå‡½æ•°ä¸­åç»­ä»£ç æ‰§è¡Œï¼›</li><li>mainå‡½æ•°é€€å‡ºã€‚</li></ol></li></ul><h4 id="3-8-3-malloc-free-åŸç†">3.8.3 malloc/free åŸç†</h4><h5 id="ä»é™æ€åˆ†é…è¯´èµ·">ä»é™æ€åˆ†é…è¯´èµ·</h5><p>æˆ‘ä»¬ä¹‹å‰æ¥è§¦æ•°æ®é€šå¸¸ä¿å­˜åœ¨ï¼š</p><ol><li><strong>æ ˆ</strong>ï¼Œæ¯”å¦‚å‡½æ•°å†…éƒ¨å±€éƒ¨å˜é‡ï¼›</li><li><strong>æ•°æ®æ®µ</strong>ï¼Œé™æ€åŒºã€å…¨å±€åŒºã€å¸¸é‡åŒºï¼›</li><li><strong>.bssæ®µ</strong>ï¼Œæœªåˆå§‹åŒ–çš„æ•°æ®ã€‚</li></ol><p>ä¸Šé¢çš„æ•°æ®æœ‰ä¸¤ä¸ªå…±åŒç‚¹ï¼š</p><ul><li><strong>å˜é‡/æ•°ç»„çš„å¤§å°å¿…é¡»åœ¨ç¼–è¯‘æ—¶çŸ¥é“</strong>ã€‚</li><li><strong>å†…å­˜åˆ†é…å’Œé‡Šæ”¾è‡ªåŠ¨å‘ç”Ÿï¼ˆå½“å˜é‡è¢«å®ä¾‹åŒ–/é”€æ¯æ—¶</strong>ï¼‰ã€‚</li></ul><p>å¤§å¤šæ•°æ—¶å€™ï¼Œè¿™å¾ˆå¥½ã€‚é‚£ä»€ä¹ˆæ—¶å€™åœ¨<strong>å †</strong>ä¸Šåˆ†é…å†…å­˜ï¼Ÿ</p><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦<u>åœ¨å †ä¸ŠåŠ¨æ€ç”³è¯·/é‡Šæ”¾å†…å­˜</u>ã€‚</p><ol><li><strong>ä¸çŸ¥é“åˆ†é…å¯¹è±¡çš„å¤§å°</strong>ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³åˆ›å»ºå£°æ˜ä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯äº‹å…ˆå¹¶ä¸çŸ¥é“æ•°ç»„çš„å¤§å°ï¼ˆç¨åæ‰èƒ½çŸ¥é“ï¼‰ã€‚è¿™ä¸ªæ—¶å€™<u>æ— æ³•ä½¿ç”¨é™æ€æ•°ç»„åˆ†é…</u>ï¼Œå› ä¸ºå®ƒå¿…é¡»æŒ‡å®šæ•°ç»„çš„å¤§å°ï¼›</li><li><strong>åˆ†é…çš„å¯¹è±¡å¤ªå¤§</strong>ã€‚æ ˆç­‰ç©ºé—´ä¸å¤Ÿã€‚</li></ol><p>åœ¨Cä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨malloc/freeåœ¨å †ä¸Šåˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†é…ï¼šå¤§å°ä¸º4çš„intæ•°ç»„</span></span><br><span class="line"><span class="keyword">int</span>* <span class="built_in">array</span> ;</span><br><span class="line"><span class="built_in">array</span> = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="number">4</span>*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line"><span class="comment">// é‡Šæ”¾</span></span><br><span class="line"><span class="built_in">free</span>(<span class="built_in">array</span>);</span><br></pre></td></tr></table></figure><p><strong>mallocå’Œfreeå‡½æ•°åº•å±‚æ˜¯å¦‚ä½•å»å®ç°çš„ï¼Œå¦‚ä½•åœ¨å †ä¸Šåˆ†é…å†…å­˜çš„</strong>ï¼Ÿ</p><h5 id="ä»å †å—è¯´èµ·">ä»å †å—è¯´èµ·</h5><blockquote><p>ä¸»è¦å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/57863097">malloc çš„å®ç°åŸç† å†…å­˜æ±  mmap sbrk é“¾è¡¨</a></p></blockquote><p><strong>ä»€ä¹ˆæ˜¯å †</strong>ï¼Ÿ</p><p>C++ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…å™¨ï¼ˆä¸‹ç®€ç§°åˆ†é…å™¨ï¼‰è¿›è¡ŒåŠ¨æ€å†…å­˜åˆ†é…ï¼Œå®ƒç»´æŠ¤ä¸€ä¸ª<u>è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸ</u>ï¼Œä¹Ÿå°±æ˜¯å †ã€‚</p><p><strong>åˆ†é…å™¨çœ¼é‡Œçš„å †æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è¿›è¡Œç®¡ç†</strong>ï¼Ÿ</p><p>åˆ†é…å™¨å°†å †è§†ä¸º<strong>ä¸€ç»„ä¸åŒå¤§å°çš„å—ï¼ˆblockï¼‰<strong>çš„é›†åˆæ¥ç»´æŠ¤ã€‚æ¯ä¸ªå—å°±æ˜¯</strong>ä¸€ä¸ªè¿ç»­çš„è™šæ‹Ÿå†…å­˜ç‰‡ï¼ˆchunkï¼‰</strong>,è¦ä¹ˆæ˜¯å·²åˆ†é…çš„ï¼Œè¦ä¹ˆæ˜¯ç©ºé—²çš„ã€‚</p><p>chunkç»“æ„å›¾ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/10681867-ce8d3eeabf100d45.png" alt="img"></p><ul><li>æ­£åœ¨ä½¿ç”¨çš„chunkæ ‡è¯†æ„ä¹‰<ul><li><code>prev_size</code>ï¼š è¡¨ç¤ºå‰ä¸€ä¸ª chunk çš„ size,ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™ä¸ªå€¼æ¥æ‰¾åˆ°å‰ä¸€ä¸ª chunk çš„å¼€å§‹åœ°å€ï¼ˆ<code>P=0</code>æ‰æœ‰æ•ˆï¼‰ï¼›</li><li><code>size</code>ï¼š è¡¨ç¤ºå½“å‰chunkçš„sizeå¤§å°ï¼›</li><li><code>A</code>ï¼šä¸º1è¡¨ç¤ºå±äºä¸»åˆ†é…åŒºï¼ˆå·²åˆ†é…ï¼‰ï¼Œå¦åˆ™å±äºéä¸»åˆ†é…åŒºï¼ˆæœªåˆ†é…ï¼‰ï¼›</li><li><code>M</code>ï¼šä¸º 1 è¡¨ç¤ºè¯¥ chunk æ˜¯ä» mmap æ˜ å°„åŒºåŸŸåˆ†é…çš„ï¼Œå¦åˆ™æ˜¯ä» heap åŒºåŸŸåˆ†é…çš„ï¼›</li><li><code>P</code>ï¼šä¸º1è¡¨ç¤ºå‰ä¸€ä¸ªchunkåœ¨ä½¿ç”¨ä¸­ï¼Œä¸º0è¡¨ç¤ºç©ºé—²ã€‚</li></ul></li><li>ç©ºé—²chunkæ ‡è¯†æ„ä¹‰<ul><li><code>fdã€bk</code> ï¼šåˆ†åˆ«æŒ‡å‘å‰ã€åçš„ç©ºé—²chunkï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°†å°†å¤§å°ç›¸è¿‘çš„chunkè¿æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼›</li></ul></li></ul><p>å…·ä½“æ¥è¯´ï¼Œ<strong>åˆ†é…å™¨é€šè¿‡bins+ç©ºé—²é“¾è¡¨ï¼ˆéå¸¸ç±»ä¼¼å“ˆå¸Œè¡¨ï¼‰ï¼Œå¯¹å †å—è¿›è¡Œç®¡ç†</strong>ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„å †æ•´ä½“ç»“æ„ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/10681867-9c09c94096413f83.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜åˆ†æˆäº†å¤§å°ä¸åŒçš„chunkï¼Œç„¶åé€šè¿‡<strong>bins</strong>æ¥ç»„ç»‡èµ·æ¥ï¼›ç›¸ä¼¼å¤§å°çš„chunkç”¨<strong>åŒå‘é“¾è¡¨</strong>é“¾æ¥èµ·æ¥ï¼Œä¸€ä¸ªé“¾è¡¨è¢«ç§°ä¸º<strong>bin</strong>ã€‚</p><ul><li><strong>unsorted bin</strong>ï¼šå³bin[1]ï¼ˆbin[0]æ²¡æœ‰è¢«ä½¿ç”¨ï¼‰ï¼Œç”¨äº<u>ç»´æŠ¤freeé‡Šæ”¾çš„chunk</u>ï¼›</li><li><strong>small_bins</strong>ï¼šå³bins[2,63)ï¼Œç”¨äºç»´æŠ¤ï¼œ512å­—èŠ‚çš„å†…å­˜å—ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ å¯¹åº”çš„é“¾è¡¨ä¸­çš„chunkå¤§å°ç›¸åŒï¼Œå‡ä¸º<code>index*8</code>ï¼›</li><li><strong>large_bins</strong>ï¼šå³bins[64,127)ï¼Œç”¨äºç»´æŠ¤&gt;512å­—èŠ‚çš„å†…å­˜å—ï¼Œæ¯ä¸ªå…ƒç´ å¯¹åº”çš„é“¾è¡¨ä¸­çš„chunkå¤§å°ä¸åŒï¼Œindexè¶Šå¤§ï¼Œé“¾è¡¨ä¸­chunkçš„å†…å­˜å¤§å°ç›¸å·®è¶Šå¤§ï¼›</li></ul><p>åœ¨å †ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„top chunkã€‚</p><ul><li><strong>äº§ç”Ÿæ—¶æœº</strong>ï¼šç¨‹åºç¬¬ä¸€æ¬¡è¿›è¡Œ malloc çš„æ—¶å€™ï¼Œheap ä¼šè¢«åˆ†ä¸ºä¸¤å—ï¼Œä¸€å—ç»™ç”¨æˆ·ï¼Œå‰©ä¸‹çš„é‚£å—å°±æ˜¯ top chunkï¼Œæ‰€ä»¥å®ƒä¸å±äºä»»ä½•ä¸€ä¸ª binï¼›</li><li><strong>ä½œç”¨</strong>ï¼šåœ¨äºå½“æ‰€æœ‰çš„ bin éƒ½æ— æ³•æ»¡è¶³ç”¨æˆ·è¯·æ±‚çš„å¤§å°æ—¶ï¼Œå°±ä½¿ç”¨top chunkè¿›è¡Œåˆ†é…ï¼Œå¹¶å°†å‰©ä¸‹çš„éƒ¨åˆ†ä½œä¸ºæ–°çš„ top chunkã€‚å †é¡¶æŒ‡é’ˆbrkä½äºtop chunkçš„é¡¶éƒ¨ï¼Œç§»åŠ¨brkæŒ‡é’ˆï¼Œå³å¯æ‰©å……top chunkçš„å¤§å°ã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬å†æ¥æ¢è®¨mallocåˆ†é…çš„è¿‡ç¨‹ã€‚</p><h5 id="mallocåŸç†">mallocåŸç†</h5><p>glibcåœ¨å†…å­˜æ± ä¸­æŸ¥æ‰¾åˆé€‚çš„chunkæ—¶ï¼Œé‡‡ç”¨äº†<strong>æœ€ä½³é€‚åº”</strong>çš„ä¼™ä¼´ç®—æ³•ã€‚</p><p><strong>ç¬¬ä¸€æ¬¡åˆ†é…å†…å­˜æ—¶ä¼šè¿›è¡Œå †åˆå§‹åŒ–</strong>ï¼š</p><ol><li>ä¸€å¼€å§‹æ—¶ï¼Œbrkå’Œstart_brkæ˜¯ç›¸ç­‰çš„ï¼Œè¿™æ—¶å®é™…heapå¤§å°ä¸º0ï¼›</li><li>å¦‚æœç¬¬ä¸€æ¬¡ç”¨æˆ·è¯·æ±‚çš„å†…å­˜å¤§å°&lt; <strong>mmapåˆ†é…é˜ˆå€¼</strong>ï¼Œåˆ™ï¼ˆ<strong>é€šè¿‡ç§»åŠ¨brkæŒ‡é’ˆæ‰©å±•å †å¤§å°</strong>ï¼‰mallocä¼šç”³è¯·(chunk_size+128kb) align 4kbå¤§å°çš„ç©ºé—´ä½œä¸ºåˆå§‹çš„heapã€‚</li></ol><p><strong>å¾€åä¼šæŒ‰ç…§é¡ºåºï¼šbinsæŸ¥æ‰¾åˆ†é…â€“&gt;brkæ‰©å±•å †åˆ†é…â€”&gt;mmapåˆ†é…</strong>ï¼š</p><ol><li><p><strong>å¦‚æœåˆ†é…å†…å­˜&lt;max_fast=é»˜è®¤64B</strong>ï¼Œåœ¨fast bins ä¸­æŸ¥æ‰¾ç›¸åº”çš„ç©ºé—²å—ï¼›</p></li><li><p><strong>å¦‚æœåˆ†é…å†…å­˜&lt;512å­—èŠ‚</strong>ï¼Œåˆ™é€šè¿‡å†…å­˜å¤§å°å®šä½åˆ°smallbinså¯¹åº”çš„indexä¸Šï¼š</p><ul><li>å¦‚æœsmallbins[index]ä¸ºç©ºï¼Œè¿›å…¥æ­¥éª¤3ï¼›</li><li>å¦‚æœsmallbins[index]éç©ºï¼Œç›´æ¥è¿”å›ç¬¬ä¸€ä¸ªchunkã€‚</li></ul></li><li><p><strong>å¦‚æœåˆ†é…å†…å­˜&gt;512å­—èŠ‚</strong>ï¼Œå®šä½åˆ°largebinså¯¹åº”çš„indexä¸Šï¼š</p><ul><li>å¦‚æœlargebins[index]ä¸ºç©ºï¼Œè¿›å…¥æ­¥éª¤3ï¼›</li><li>å¦‚æœlargebins[index]éç©ºï¼Œæ‰«æé“¾è¡¨ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§å°æœ€åˆé€‚çš„chunkï¼Œå¦‚size=12.5Kï¼Œåˆ™ä½¿ç”¨chunk Bï¼Œ<u>å‰©ä¸‹çš„0.5ké‡Šæ”¾å¹¶æ”¾å…¥unsorted_listä¸­</u>ã€‚</li></ul></li><li><p><strong>éå†unsorted_list</strong>ï¼š</p><ul><li>æŸ¥æ‰¾åˆé€‚sizeçš„chunkï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›ï¼›</li><li>å¦åˆ™ï¼Œå°†è¿™äº›chunkéƒ½å½’ç±»æ”¾åˆ°smallbinså’Œlargebinsé‡Œé¢ã€‚</li></ul></li><li><p><strong>åœ¨binæ›´å¤§çš„é“¾è¡¨å¯»æ‰¾</strong>ï¼šä»index++æ›´å¤§çš„é“¾è¡¨ç»§ç»­å¯»æ‰¾ï¼š</p><ul><li>æŸ¥æ‰¾åˆé€‚sizeçš„chunkï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›ï¼Œ<u>åŒæ—¶è¿˜ä¼šå°†chunkæ‹†åˆ†</u>ï¼Œå¹¶å°†<u>å‰©ä½™çš„åŠ å…¥åˆ°unsorted_listä¸­</u>ã€‚</li><li>æ‰¾ä¸åˆ°åˆ™é€šè¿‡top chunkã€‚</li></ul></li><li><p><strong>é€šè¿‡top chunkåˆ†é…</strong>ï¼šé»˜è®¤top chunkåˆ†é…çš„æœ€å¤§å¤§å°ä¸º128Kï¼ˆä¹Ÿæ˜¯mmapåˆ†é…çš„é˜ˆå€¼ï¼‰ï¼š</p><ul><li><p>top chunkå¤§å°&gt;åˆ†é…çš„å†…å­˜ï¼Œåˆ™è¿”å›åˆé€‚å¤§å°chunkï¼Œå‰©ä½™çš„ä½œä¸ºæ–°çš„ top chunkï¼›</p></li><li><p>top chunkå¤§å°&lt;åˆ†é…çš„å†…å­˜&lt;128Kï¼Œ<u>ç§»åŠ¨brkæŒ‡é’ˆ</u>æ‰©å±•top chunkå¤§å°ï¼Œæ»¡è¶³åˆ†é…ï¼›</p></li><li><p>åˆ†é…çš„å†…å­˜&gt;128Kï¼Œé€šè¿‡mmapåˆ†é…å†…å­˜ã€‚</p></li></ul></li><li><p><strong>é€šè¿‡mmapåˆ†é…</strong>ã€‚åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼ˆå †å’Œæ ˆä¸­é—´çš„æ–‡ä»¶æ˜ å°„åŒºåŸŸï¼‰æ‰¾ä¸€å—ç©ºé—²çš„è™šæ‹Ÿå†…å­˜è¿”å›åœ°å€ã€‚</p></li></ol><p>æ€»ç»“ä»¥ä¸Šï¼Œå†…å­˜åˆ†é…ï¼ˆmallocï¼‰ä¸»è¦ç”±ä¸¤ç§ç³»ç»Ÿè°ƒç”¨å®Œæˆï¼šbrkå’Œmmapï¼ˆä¸è€ƒè™‘å…±äº«å†…å­˜ï¼‰ã€‚</p><ul><li><strong>brk</strong>ï¼šåˆ†é…å†…å­˜ &lt; DEFAULT_MMAP_THRESHOLDï¼Œèµ°<code>__brk</code>ï¼Œå°†æ•°æ®æ®µ(.data)çš„æœ€é«˜åœ°å€æŒ‡é’ˆ<code>_edata</code>ï¼Œå¾€é«˜åœ°å€æ¨ï¼›</li><li><strong>mmap</strong>ï¼šåˆ†é…å†…å­˜ &gt; DEFAULT_MMAP_THRESHOLDï¼Œèµ°<code>__mmap</code>ï¼Œç›´æ¥è°ƒç”¨mmapç³»ç»Ÿè°ƒç”¨ã€‚åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼ˆå †å’Œæ ˆä¸­é—´çš„æ–‡ä»¶æ˜ å°„åŒºåŸŸï¼‰æ‰¾ä¸€å—ç©ºé—²çš„è™šæ‹Ÿå†…å­˜ã€‚</li></ul><p>å…¶ä¸­ï¼ŒDEFAULT_MMAP_THRESHOLDæ˜¯mmapåˆ†é…é˜ˆå€¼ï¼Œé»˜è®¤ä¸º128Kã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ç§æ–¹å¼åˆ†é…çš„<strong>éƒ½æ˜¯è™šæ‹Ÿå†…å­˜</strong>ï¼Œæ²¡æœ‰åˆ†é…ç‰©ç†å†…å­˜ã€‚åªæœ‰å®é™…è°ƒç”¨å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œæ‰ä¼šå»ºç«‹è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p><blockquote><p>ä¸è¿‡è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œ<strong>æ—¢ç„¶<code>brkã€mmap</code>æä¾›äº†å†…å­˜åˆ†é…çš„åŠŸèƒ½ï¼Œç›´æ¥ä½¿ç”¨<code>brkã€mmap</code>è¿›è¡Œå†…å­˜ç®¡ç†ä¸æ˜¯æ›´ç®€å•å—ï¼Œä¸ºä»€ä¹ˆéœ€è¦glibcå‘¢</strong>ï¼Ÿ</p></blockquote><p>å› ä¸ºç³»ç»Ÿè°ƒç”¨æœ¬èº«ä¼šäº§ç”Ÿè½¯ä¸­æ–­ï¼Œå¯¼è‡´ç¨‹åºä»ç”¨æˆ·æ€é™·å…¥å†…æ ¸æ€ï¼Œæ¯”è¾ƒæ¶ˆè€—èµ„æºã€‚è¯•æƒ³ï¼Œ<strong>å¦‚æœé¢‘ç¹åˆ†é…å›æ”¶å°å—å†…å­˜åŒºï¼Œé‚£ä¹ˆå°†æœ‰å¾ˆå¤§çš„æ€§èƒ½è€—è´¹åœ¨ç³»ç»Ÿè°ƒç”¨ä¸­</strong>ã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†å‡å°‘ç³»ç»Ÿè°ƒç”¨å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œglibcé‡‡ç”¨äº†å†…å­˜æ± çš„è®¾è®¡ï¼Œå¢åŠ äº†ä¸€ä¸ªä»£ç†å±‚ï¼Œæ¯æ¬¡å†…å­˜åˆ†é…ï¼Œéƒ½ä¼˜å…ˆä»å†…å­˜æ± ä¸­å¯»æ‰¾ï¼Œå¦‚æœå†…å­˜æ± ä¸­æ— æ³•æä¾›ï¼Œå†å‘æ“ä½œç³»ç»Ÿç”³è¯·ã€‚</p><h5 id="freeåŸç†">freeåŸç†</h5><p>å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼ŒC++å°†å¯¹è§†ä¸ºå †è§†ä¸ºä¸€ä¸ªä¸ªchunkï¼ˆblockï¼‰çš„é›†åˆï¼Œæ¯ä¸ªchunkçš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/10681867-ce8d3eeabf100d45.png" alt="img"></p><p>mallocåˆ†é…å¥½å†…å­˜ï¼Œè¿”å›çš„æ˜¯<strong>User dataçš„èµ·å§‹åœ°å€</strong>ï¼Œ<strong>header</strong>åˆ™ä¿å­˜äº†å½“å‰chunkçš„ä¸€äº›ä¿¡æ¯ã€‚</p><p>ä½†freeå¹¶éçœŸçš„ç›´æ¥å°†ç›¸åº”å†…å­˜åŒºåŸŸè¿”å›æ“ä½œç³»ç»Ÿï¼š</p><ul><li><p><strong>å¦‚æœ<code>free</code> é‡Šæ”¾<code>mmap</code> åˆ†é…å†…å­˜</strong>ï¼Œ<code>free</code>å¯ä»¥å¾ˆé¡ºåˆ©å°±é‡Šæ”¾æ‰å…¶ç›¸å…³çš„è™šæ‹Ÿå’Œç‰©ç†å†…å­˜ï¼Œè¿”å›æ“ä½œç³»ç»Ÿï¼›</p></li><li><p><strong>å¦‚æœ<code>free</code> é‡Šæ”¾ <code>brk</code>åˆ†é…çš„å†…å­˜</strong>ï¼Œ<strong><code>free</code>åªæ˜¯æ ‡è®°chunkå¯è¢«é‡æ–°åˆ†é…å¹¶åŠ å…¥ç©ºé—²é“¾è¡¨ï¼ˆA=0ï¼‰ï¼Œä½†æ²¡æœ‰çœŸçš„åˆ é™¤ä»»ä½•æ•°æ®</strong>ï¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* a  = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(<span class="number">1</span>);</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;a = &quot;</span>&lt;&lt;*a&lt;&lt;endl; <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">free</span>(a);</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;a = &quot;</span>&lt;&lt;*a&lt;&lt;endl; <span class="comment">// 0ï¼Œæ•°æ®è¢«æ¸…é™¤ï¼Œä½†æ²¡è¢«æ“ä½œç³»ç»Ÿå›æ”¶</span></span><br><span class="line">*a=<span class="number">2</span>;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;a = &quot;</span>&lt;&lt;*a&lt;&lt;endl; <span class="comment">// 2ï¼Œä¾æ®å¯ä»¥è¢«ä½¿ç”¨ï¼Œè™½ç„¶è¿™å¾ˆå±é™©</span></span><br></pre></td></tr></table></figure><p>å…·ä½“åŠ å…¥åˆ°ç©ºé—²é“¾è¡¨ä½•å¤„ï¼Œä¹Ÿåˆ†ä¸‰ç§æƒ…å†µè€ƒè™‘ï¼š</p><ul><li>å¦‚æœè¯¥chunk<u>å’Œtop chunkç›¸é‚»ï¼Œåˆ™å°†å…¶å’Œtop chunkåˆå¹¶</u>ï¼›<ul><li>ç‰¹åˆ«çš„ï¼Œå¦‚æœtop chunk&gt;128Kï¼Œä¼šæ‰§è¡Œå†…å­˜ç´§ç¼©ï¼ˆtrimï¼‰æ“ä½œç§»åŠ¨brkæŒ‡é’ˆã€‚</li></ul></li><li>å¦‚æœfreeçš„chunkçš„å¤§å°åœ¨0x20~0x80ä¹‹é—´ï¼ˆfastbinçš„èŒƒå›´ï¼‰ï¼Œ<u>é‚£ä¹ˆè¯¥chunkç›´æ¥æ”¾åˆ°fast binä¸Š</u>ï¼›</li><li>å¦‚æœfreeçš„chunkçš„å¤§å°å¤§äº0x80ï¼ˆå¤§äºfast binçš„èŒƒå›´ï¼‰ï¼Œæ­¤æ—¶ä¸ä¼šç›´æ¥æ”¾åˆ°small binæˆ–è€…large binä¸Šé¢ï¼Œ<u>è€Œæ˜¯æ”¾åˆ°unsorted binä¸Šé¢</u>ï¼›</li></ul></li><li><p><strong>æœ€ä½³å®è·µï¼šåˆ é™¤ä¸€ä¸ªæŒ‡é’ˆæ—¶ï¼Œè¯·å°†æŒ‡é’ˆè®¾ç½®ä¸º nullptr</strong>ã€‚</p><p>å¦åˆ™çš„è¯ï¼Œä½¿ç”¨ä¸€ä¸ªæŒ‡å‘çš„å†…å­˜å·²ç»è¢«é‡Šæ”¾çš„ä¸€ç§æŒ‡é’ˆï¼Œæ˜¯ä½¿ç”¨<strong>æ‚¬ç©ºæŒ‡é’ˆ</strong>ã€‚</p><p>ï¼ˆåŒºåˆ†é‡æŒ‡é’ˆæ˜¯æŒ‡ä½¿ç”¨æ—¶è¿˜æ²¡è¢«åˆå§‹åŒ–ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cout&lt;&lt;*a&lt;&lt;endl; <span class="comment">// å±ï¼Œæ­¤æ—¶aæ˜¯æ‚¬ç©ºæŒ‡é’ˆï¼Œå·²ç»è¢«free(a)</span></span><br><span class="line">a = <span class="literal">nullptr</span>;    <span class="comment">// æœ€ä½³å®è·µï¼šå°†å·²ç»é‡Šæ”¾çš„æŒ‡é’ˆç½®ç©º</span></span><br><span class="line">cout&lt;&lt;*a&lt;&lt;endl; <span class="comment">// æ­¤æ—¶ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œok</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœfreeçš„chunkæ²¡æœ‰å’Œtop chunkç›¸é‚»è¢«åˆå¹¶ï¼Œå…¶åˆå¤ªå°çš„è¯ï¼Œå¯èƒ½æ°¸è¿œä¸ä¼šè¢«ä½¿ç”¨</strong>â€”â€”è¿™å°±æ˜¯äº§ç”Ÿäº†å†…å­˜ç¢ç‰‡ã€‚</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/10681867-4b414b22810c9e9d.png" alt="img"></p><p>free(A)åï¼Œç”±äºchunk Aæ— æ³•å’Œtop chunkåˆå¹¶ï¼Œåœ¨å †ä¸­ä¾¿äº§ç”Ÿäº†å†…å­˜ç©ºæ´ï¼Œä¹Ÿå°±æ˜¯å†…å­˜ç¢ç‰‡ã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ƒè¿˜è¶³å¤Ÿå¤§ï¼ˆ40Kï¼‰ï¼Œæœ‰å¾ˆå¤§æ¦‚ç‡å…¶ç©ºé—´æ˜¯èƒ½å¤Ÿè¢«åˆ©ç”¨çš„ã€‚</p><p><strong>å°ç»†èŠ‚ï¼šfreeå¦‚ä½•çŸ¥é“é‡Šæ”¾å¤šå¤§ç©ºé—´</strong>ï¼Ÿ</p><p>åœ¨å‰é¢åœ°å€ä¼ é€’æˆ‘ä»¬çŸ¥é“ï¼š<strong>å‘ä¸€ä¸ªå‡½æ•°ä¼ é€’æŒ‡é’ˆçš„æ—¶å€™ï¼Œå®ƒçš„é•¿åº¦ä¿¡æ¯å¾€å¾€ä¼šè¢«æˆªæ–­ï¼ˆå¦‚æœæ˜¯æ•°ç»„åï¼‰ï¼Œæ— æ³•æ ‡ç¤ºæ•°ç»„çš„é•¿åº¦</strong>ã€‚å› æ­¤ï¼Œåœ¨å‡½æ•°ä¸­æˆ‘ä»¬ä¹Ÿæ— æ³•è·å–å®ƒçš„é•¿åº¦ä¿¡æ¯ï¼Œé™¤éæ˜¾ç¤ºä¼ é€’ä¸€ä¸ªé•¿åº¦å‚æ•°ã€‚</p><p>é‚£freeå¦‚ä½•çŸ¥é“é‡Šæ”¾å¤šå¤§çš„ç©ºé—´ï¼Ÿ</p><p>åŸå› å¾ˆç®€å•ï¼Œfreeæ ¹æœ¬ä¸ç”¨å…³ç³»chunkå¤§å°ï¼Œmallocåˆ†é…çš„æ—¶å€™å°±æ˜¯åˆ†é…ä¸€ä¸ªåˆé€‚å¤§å°chunkã€‚chunkåŒ…å«headerå’Œuser dataã€‚<strong>freeåªæ˜¯å°†headerä¸­çš„ç›¸å…³æ ‡è®°ä¸ºå¯ç”¨ï¼ŒåŠ å…¥ç©ºé—²é“¾è¡¨ä¸­å³å¯</strong>ã€‚</p><h4 id="3-8-4-new-delete-åŸç†">3.8.4 new /delete åŸç†</h4><p>åœ¨3.8.3èŠ‚ä»‹ç»äº†Cè¯­è¨€ä¸­çš„åŠ¨æ€å†…å­˜åˆ†é…æ–¹å¼ï¼šmallocï¼Œmallocå‡½æ•°åˆ†é…å¤±è´¥è¿”å›æŒ‡é’ˆç©ºå€¼ï¼ŒæˆåŠŸè¿”å›é¦–åœ°å€ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹C++ä¸­çš„åŠ¨æ€å†…å­˜ç®¡ç†æ–¹å¼ï¼šnewå’Œdeleteã€‚</p><p>å‡†å¤‡å¥½ä¸€ä¸ªå…¬å…±ç±»<code>Stu</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span>                           </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stu</span>                                          </span></span><br><span class="line"><span class="class">&#123;</span>                   </span><br><span class="line">  <span class="keyword">public</span>:    </span><br><span class="line">    <span class="built_in">Stu</span>()           </span><br><span class="line">    &#123;                         </span><br><span class="line">      cout &lt;&lt; <span class="string">&quot;é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;;                     </span><br><span class="line">    <span class="built_in">Stu</span>(<span class="keyword">int</span> num, string name):_num(num), _name(name)</span><br><span class="line">    &#123;                         </span><br><span class="line">      cout &lt;&lt; <span class="string">&quot;è‡ªå®šä¹‰æ„é€ å‡½æ•°åˆå§‹åŒ–&quot;</span> &lt;&lt; endl;   </span><br><span class="line">    &#125;                      </span><br><span class="line">    ~<span class="built_in">Stu</span>()              </span><br><span class="line">    &#123;                       </span><br><span class="line">      cout &lt;&lt; <span class="string">&quot;ææ„é”€æ¯&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;                         </span><br><span class="line">  <span class="keyword">private</span>:   </span><br><span class="line">    <span class="keyword">int</span> _num;               </span><br><span class="line">    string _name;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure><h5 id="newåŸç†">newåŸç†</h5><p>æ— è®ºæ˜¯newè¿˜æ˜¯deleteï¼Œå®ƒä»¬åœ¨<u>å†…ç½®ç±»å‹/è‡ªå®šä¹‰ç±»å‹</u>ä¸Šä½¿ç”¨æœ‰äº›ä¸åŒã€‚</p><ul><li><p><strong>newåº•å±‚å®ç°ï¼ˆå†…ç½®ç±»å‹</strong>ï¼‰</p><p>å¯¹äºå†…ç½®ç±»å‹æ¥è¯´ï¼Œnewå’ŒmallocåŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œä¸è¿‡newè¿˜å¯ä»¥è¿›è¡Œ<strong>åˆå§‹åŒ–</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–å•ä¸ªï¼šç­‰åŒäºint* a = (int*)malloc(sizeof(int));</span></span><br><span class="line"><span class="keyword">int</span>* a = <span class="keyword">new</span> <span class="keyword">int</span>;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å•ä¸ªï¼šåŒæ—¶è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">int</span>* c = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>newåœ¨C++ä¸­è¢«å®šä¹‰ä¸ºä¸€ä¸ª<strong>è¿ç®—ç¬¦</strong>ï¼Œå®ƒä¼šåœ¨åº•å±‚è°ƒç”¨å…¨å±€å‡½æ•°operator newã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹<code>int* array = new int;</code> å¯¹åº”æ±‡ç¼–æºç éªŒè¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># é¦–å…ˆåœ¨å¯„å­˜å™¨ediä¸­å­˜å…¥æ•°ç»„å¤§å°ï¼ˆ4ï¼Œä¸€ä¸ªintå¤§å°ï¼‰</span><br><span class="line">movl    $4, %edi</span><br><span class="line"># è°ƒç”¨operator newåˆ†é…ç©ºé—´</span><br><span class="line">call    operator new(unsigned long)</span><br><span class="line"># å¯„å­˜å™¨raxä¿å­˜newè¿”å›çš„é¦–åœ°å€ç»™aï¼ˆå¯¹åº”åœ°å€ -16(%rbp)ï¼‰</span><br><span class="line">movq    %rax, -16(%rbp)</span><br></pre></td></tr></table></figure><p>operator newåªæ˜¯mallocçš„ä¸€å±‚å°è£…ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>* __CRTDECL <span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span> <span class="keyword">const</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// malloc</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">void</span>* <span class="keyword">const</span> block = <span class="built_in">malloc</span>(size))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> block;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (_callnewh(size) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (size == SIZE_MAX)</span><br><span class="line">            &#123;</span><br><span class="line">                __scrt_throw_std_bad_array_new_length();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                __scrt_throw_std_bad_alloc();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The new handler was successful; try to allocate again...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æ‰§è¡Œæµç¨‹ï¼š</p><ol><li><p>å½“mallocç”³è¯·ç©ºé—´æˆåŠŸæ—¶ç›´æ¥è¿”å›<code>return (p)</code>ï¼›</p></li><li><p>ç”³è¯·ç©ºé—´å¤±è´¥ï¼Œå°è¯•æ‰§è¡Œç©ºé—´ä¸è¶³åº”å¯¹æªæ–½ï¼ˆ<strong>mallocä¸­å¤±è´¥ç›´æ¥è¿”å›ç©ºæŒ‡é’ˆ</strong>ï¼‰ï¼›</p></li><li><p>å¦‚æœæ”¹åº”å¯¹æªæ–½ç”¨æˆ·è®¾ç½®äº†ï¼Œåˆ™ç»§ç»­ç”³è¯·ï¼Œå¦åˆ™æŠ›å¼‚å¸¸ã€‚</p></li></ol></li><li><p>ä»æºç ä¸­èƒ½çœ‹å‡ºçš„æ˜¯<strong>operator new</strong>åœ¨åº•å±‚æ˜¯åˆ©ç”¨mallocåˆ†é…å†…å­˜ï¼Œå› æ­¤å¯ä»¥è¯´<strong>newå…¶å®åªæ˜¯mallocä¸€å±‚å°è£…</strong>ã€‚</p></li></ul></li><li><p><strong>newåº•å±‚å®ç°ï¼ˆè‡ªå®šä¹‰ç±»å‹</strong>ï¼‰</p><p>ä½†å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œnewè¿˜ä¼šè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–ï¼š</p><ol><li>è°ƒç”¨operator newä¸ºå¯¹è±¡åˆ†é…ç©ºé—´ï¼ˆå†…ç½®ç±»å‹ï¼‰ï¼›</li><li><strong>è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°</strong>å¯¹å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ol><p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­åˆ†æï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>     </span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">  <span class="comment">// mallocåˆ†é…å¯¹è±¡  </span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;malloc:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  Stu* a = (Stu*)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(Stu));</span><br><span class="line">  <span class="comment">// newåˆ†é…å¯¹è±¡</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;new:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  Stu* b = <span class="keyword">new</span> <span class="built_in">Stu</span>(<span class="number">1</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);             </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">malloc:</span><br><span class="line">new:</span><br><span class="line">è‡ªå®šä¹‰æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°mallocåˆ†é…çš„æ–¹å¼ä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼Œä½†æ˜¯newè¿˜ä¼šè°ƒç”¨æ„é€ å‡½æ•°ã€‚</p><p>å› æ­¤ä¹Ÿå¯ä»¥ç†è§£ä¸º<strong>mallocåˆ†é…å‡ºæ¥çš„åªä¸è¿‡æ˜¯ä¸€ä¸ªå’Œç±»ä¸€æ ·å¤§å°çš„ç©ºé—´ï¼ˆåœ¨å‰é¢æˆ‘ä»¬ç§°ä¸ºchunkï¼‰ï¼Œå¹¶ä¸èƒ½ç§°ä½œæ˜¯ä¸€ä¸ªå¯¹è±¡</strong>ï¼Œè€Œnewå’Œdeleteåˆ†é…å‡ºæ¥çš„æ‰èƒ½è¢«æˆä¸ºå¯¹è±¡ã€‚</p></li><li><p><strong>newä¸new[]</strong></p><p>new[]å’Œnewæœ‰äº›ç»†å¾®åŒºåˆ«ï¼š</p><ul><li><p>new[]æ˜¯è°ƒç”¨operator new[]å¯¹å¤šä¸ªå¯¹è±¡è¿›è¡Œåˆ†é…ï¼Œ<strong>operator new[]æœ¬è´¨è¿˜æ˜¯å¤šæ¬¡è°ƒç”¨operator new</strong>ï¼›</p><p>ä½†operator new[]è¿˜ä¼šå¤šç”³è¯·4ä¸ªå­—èŠ‚çš„ç©ºé—´ä¿å­˜æ­¤æ¬¡å¯¹è±¡ä¸ªæ•°ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220110001617014.png" alt="image-20220110001617014"></p><p><strong>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš</strong>ï¼Ÿ</p><p>ä½¿ç”¨delete[] é‡Šæ”¾ç©ºé—´æ—¶å¯ä»¥çŸ¥é“è¢«é‡Šæ”¾çš„å¯¹è±¡ä¸ªæ•°ã€‚</p></li><li><p>å½“ç„¶ï¼Œ<strong>å¯¹äºè‡ªå®šä¹‰ç±»å‹</strong>ï¼Œç±»ä¼¼newï¼Œè¿˜ä¼šè°ƒç”¨Næ¬¡æ„é€ å‡½æ•°å¯¹Nä¸ªå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ã€‚</p><blockquote><p>ä¸¾ä¾‹è¯´æ˜ã€‚</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mallocåˆ†é…å¯¹è±¡  </span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;malloc:&quot;</span> &lt;&lt; endl;</span><br><span class="line">Stu* a = (Stu*)<span class="built_in">malloc</span>(<span class="number">3</span>*<span class="built_in"><span class="keyword">sizeof</span></span>(Stu));</span><br><span class="line"><span class="comment">// newåˆ†é…å¯¹è±¡</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;new:&quot;</span> &lt;&lt; endl;</span><br><span class="line">Stu* b = <span class="keyword">new</span> Stu[<span class="number">3</span>];  </span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">malloc:</span><br><span class="line">new:</span><br><span class="line">é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br><span class="line">é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br><span class="line">é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="deleteåŸç†">deleteåŸç†</h5><p>deleteä¹Ÿåˆ†ä¸¤ç§æƒ…å†µè®¨è®ºï¼š</p><ul><li>å¯¹äºå†…ç½®ç±»å‹ï¼šåº•å±‚è°ƒç”¨freeå®ç°ï¼Œå’Œfreeæ— å¤šå¤§åŒºåˆ«ï¼ˆä¹Ÿæ²¡æœ‰å¼‚å¸¸å¤„ç†ï¼‰ï¼›</li><li>å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼šé™¤äº†è°ƒç”¨freeé‡Šæ”¾å¯¹è±¡ç©ºé—´ï¼Œåœ¨æ­¤ä¹‹å‰è¿˜ä¼šè°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å…·ä½“ä¾‹å­æ¥çœ‹çœ‹ã€‚</p><ul><li><p><strong>deleteåº•å±‚å®ç°ï¼ˆå†…ç½®ç±»å‹</strong>ï¼‰</p><p>å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* a = <span class="keyword">new</span> <span class="keyword">int</span>;</span><br><span class="line"><span class="keyword">delete</span> a;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å¯¹åº”çš„æ±‡ç¼–æºç ï¼Œæ ¸å¿ƒæ˜¯è°ƒç”¨operator deleteï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/*int* a = new int;*/</span><br><span class="line"># é¦–å…ˆåœ¨å¯„å­˜å™¨ediä¸­å­˜å…¥æ•°ç»„å¤§å°ï¼ˆ4ï¼Œä¸€ä¸ªintå¤§å°ï¼‰</span><br><span class="line">movl    $4, %edi</span><br><span class="line"># è°ƒç”¨operator newåˆ†é…ç©ºé—´</span><br><span class="line">call    operator new(unsigned long)</span><br><span class="line"># å¯„å­˜å™¨raxä¿å­˜newè¿”å›çš„é¦–åœ°å€ç»™aï¼ˆå¯¹åº”åœ°å€ -16(%rbp)ï¼‰</span><br><span class="line">movq    %rax, -16(%rbp)</span><br><span class="line"></span><br><span class="line">/*delete a*/</span><br><span class="line">movq    -16(%rbp), %rax</span><br><span class="line">testq   %rax, %rax</span><br><span class="line">je      .L2</span><br><span class="line">movl    $4, %esi</span><br><span class="line">movq    %rax, %rdi</span><br><span class="line"># æ ¸å¿ƒæ˜¯è°ƒç”¨operator delete</span><br><span class="line"># å‰é¢åœ¨å¹²ä»€ä¹ˆï¼Ÿæš‚ä¸æ¸…æ¥šã€‚</span><br><span class="line">call    operator delete(void*, unsigned long)</span><br></pre></td></tr></table></figure><p>operator deleteä¹Ÿåªæ˜¯freeçš„ä¸€å±‚å°è£…ï¼ˆæ²¡æœ‰å¼‚å¸¸å¤„ç†ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __CRTDECL <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="keyword">void</span>* <span class="keyword">const</span> block)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG</span></span><br><span class="line">    _free_dbg(block, _UNKNOWN_BLOCK);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="built_in">free</span>(block);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>deleteåº•å±‚å®ç°ï¼ˆè‡ªå®šä¹‰ç±»å‹</strong>ï¼‰</p><p>ä½†å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œdeleteè¿˜ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼š</p><ol><li><strong>è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°</strong>æ¸…ç†å¯¹è±¡ï¼›</li><li>è°ƒç”¨operator deleteæ¸…ç†å†…å­˜ï¼›</li></ol><p>ä¸€ä¸ªå°ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>     </span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">  <span class="comment">// mallocåˆ†é…å¯¹è±¡  </span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;malloc:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  Stu* a = (Stu*)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(Stu));</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;free:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="built_in">free</span>(a);</span><br><span class="line">  <span class="comment">// newåˆ†é…å¯¹è±¡</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;new:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  Stu* b = <span class="keyword">new</span> Stu;  </span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;delete:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">delete</span> b;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;           </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">malloc:</span><br><span class="line">free:</span><br><span class="line">new:</span><br><span class="line">é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br><span class="line">delete:</span><br><span class="line">ææ„é”€æ¯</span><br></pre></td></tr></table></figure><p>å¯è§freeä¸ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼Œä½†deleteä¼šã€‚</p></li><li><p><strong>deleteä¸delte[]</strong></p><p>delete[]ç”¨æ¥åˆ é™¤å¤šä¸ªå¯¹è±¡ï¼ˆå’Œnew[]æˆå¯¹å‡ºç°ï¼‰ï¼Œæœ¬è´¨æ˜¯å¯¹æ¯ä¸ªå¯¹è±¡è°ƒç”¨deleteæ¸…ç†ã€‚</p><p>å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>é¦–å…ˆæ ¹æ®å¯¹è±¡æ•°ç»„å‰4ä¸ªå­—èŠ‚ï¼Œè·å–å¯¹è±¡ä¸ªæ•°Nï¼›</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220110001617014.png" alt="image-20220110001617014"></p></li><li><p>å¯¹åç»­æ¯ä¸ªå¯¹è±¡ä½¿ç”¨deleteåˆ é™¤ã€‚</p></li></ol><p>åŒæ ·çš„ï¼Œå¯¹äºè‡ªå®šä¹‰ç±»å‹è¿˜ä¼šè°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>     </span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">  <span class="comment">// mallocåˆ†é…å¤šä¸ªå¯¹è±¡  </span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;malloc:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  Stu* a = (Stu*)<span class="built_in">malloc</span>(<span class="number">3</span>*<span class="built_in"><span class="keyword">sizeof</span></span>(Stu));</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;free:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="comment">// freeé‡Šæ”¾å†…å­˜</span></span><br><span class="line">  <span class="built_in">free</span>(a);</span><br><span class="line">  <span class="comment">// new[]åˆ†é…å¯¹è±¡</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;new:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  Stu* b = <span class="keyword">new</span> Stu[<span class="number">3</span>];  </span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;delete:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="comment">// delete[] é‡Šæ”¾å†…å­˜</span></span><br><span class="line">  <span class="keyword">delete</span>[] b;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;           </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">malloc:</span><br><span class="line">free:</span><br><span class="line">new:</span><br><span class="line">é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br><span class="line">é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br><span class="line">é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–</span><br><span class="line">delete:</span><br><span class="line">ææ„é”€æ¯</span><br><span class="line">ææ„é”€æ¯</span><br><span class="line">ææ„é”€æ¯</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæœ‰æ„æ€çš„å°ç»†èŠ‚ï¼š</p><ul><li><p><code>malloc</code>å‡ºçš„å¯¹è±¡ä¸ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼›</p></li><li><p>æˆ‘ä»¬åªç”¨äº†ä¸€æ¬¡<code>free(a)</code> é‡Šæ”¾äº†åˆ†é…å¯¹è±¡æ•°ç»„<code>a</code> ï¼Œè€Œå¯¹è±¡æ•°ç»„<code>b</code>å®é™…é€šè¿‡<code>delete[]</code> è°ƒç”¨äº†å¤šæ¬¡<code>delete</code>ã€‚</p></li></ul><p>è¿™ä¸ªç»†èŠ‚ä¹ŸéªŒè¯äº†æˆ‘ä»¬ä¹‹å‰ç»“è®ºï¼š</p><ul><li><code>malloc</code>åˆ†é…å‡ºæ¥çš„åªä¸è¿‡æ˜¯ä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„å¤§å°ï¼ˆè¿™é‡Œæ˜¯3ä¸ª<code>stu</code>ï¼‰çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¹¶æ²¡æœ‰çœŸçš„åˆ†é…äº†3ä¸ª<code>stu</code>å¯¹è±¡ï¼Œæ‰€ä»¥<code>free</code>ä¸€æ¬¡å°±å¯ä»¥é‡Šæ”¾è¿™å—å†…å­˜ã€‚</li><li>ä½†<code>new[]</code>æ˜¯çœŸæ­£åˆ†é…äº†3ä¸ª<code>stu</code>å¯¹è±¡å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥è¦<code>delete</code>å¤šæ¬¡ä¸”ä¼šæ‰§è¡Œææ„å‡½æ•°ã€‚</li></ul></li></ul><h5 id="plain-nothrow-placement-new">plain/nothrow/placement new</h5><p>åœ¨C++ä¸­ï¼Œnewæœ‰ä¸‰ç§å…¸å‹çš„ä½¿ç”¨æ–¹æ³•ï¼šplain newï¼Œnothrow newå’Œplacement newã€‚</p><p><strong>plain new</strong></p><p>è¨€ä¸‹ä¹‹æ„å°±æ˜¯æ™®é€šçš„newï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„newï¼Œåœ¨C++ä¸­å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plain newåŸå‹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="keyword">operator</span> <span class="title">new</span><span class="params">(std::<span class="keyword">size_t</span>)</span> <span class="title">throw</span><span class="params">(std::bad_alloc)</span></span>;</span><br><span class="line"><span class="comment">// plain newå¯¹åº”delete</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="keyword">void</span> *)</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>å¯è§<code>plain new</code>åœ¨ç©ºé—´åˆ†é…å¤±è´¥çš„æƒ…å†µä¸‹ï¼ŒæŠ›å‡ºå¼‚å¸¸<code>std::bad_alloc</code>è€Œä¸æ˜¯è¿”å›NULLã€‚</p><p>å› æ­¤é€šè¿‡åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä¸ºNULLæ˜¯å¾’åŠ³çš„ï¼Œè¯·ä½¿ç”¨<code>try-catch</code>æ•è·å¼‚å¸¸ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> *p = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">10e11</span>];</span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in"><span class="keyword">catch</span></span> (<span class="keyword">const</span> std::bad_alloc &amp;ex)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; ex.<span class="built_in">what</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bad allocation</span><br></pre></td></tr></table></figure><p><strong>nothrow new</strong></p><p>nothrow newåœ¨ç©ºé—´åˆ†é…å¤±è´¥çš„æƒ…å†µä¸‹ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å›NULLï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nothrow newåŸå‹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> * <span class="keyword">operator</span> <span class="title">new</span><span class="params">(std::<span class="keyword">size_t</span>,<span class="keyword">const</span> std::<span class="keyword">nothrow_t</span>&amp;)</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// å¯¹åº”deleteåŸå‹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="keyword">void</span>*)</span> <span class="title">throw</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *p = <span class="built_in"><span class="keyword">new</span></span>(nothrow) <span class="keyword">char</span>[<span class="number">10e11</span>];</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;alloc failed&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alloc failed</span><br></pre></td></tr></table></figure><p><strong>placement new</strong></p><p><code>placement new</code>å…è®¸åœ¨ä¸€å—<u>å·²ç»åˆ†é…æˆåŠŸçš„å†…å­˜</u>ä¸Šé‡æ–°æ„é€ å¯¹è±¡æˆ–å¯¹è±¡æ•°ç»„ã€‚</p><p><code>placement new</code>ä¸ç”¨æ‹…å¿ƒå†…å­˜åˆ†é…å¤±è´¥ï¼Œå› ä¸ºå®ƒæ ¹æœ¬ä¸åˆ†é…å†…å­˜ï¼Œå®ƒåšçš„å”¯ä¸€ä¸€ä»¶äº‹æƒ…å°±æ˜¯è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// placement newåŸå‹</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="keyword">size_t</span>,<span class="keyword">void</span>*)</span></span>;</span><br><span class="line"><span class="comment">// å¯¹åº”delete</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="keyword">void</span>*,<span class="keyword">void</span>*)</span></span>;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸»è¦ç”¨é€”</strong>ï¼šåå¤ä½¿ç”¨ä¸€å—è¾ƒå¤§çš„åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œæ¥æ„é€ ä¸åŒç±»å‹çš„å¯¹è±¡æˆ–è€…ä»–ä»¬çš„æ•°ç»„ï¼›</li><li><strong>ä½¿ç”¨ææ„å‡½æ•°åˆ é™¤è€Œä¸æ˜¯delete</strong>ï¼šplacement newæ„é€ èµ·æ¥çš„å¯¹è±¡æ•°ç»„ï¼Œè¦æ˜¾å¼çš„è°ƒç”¨ä»–ä»¬çš„ææ„å‡½æ•°æ¥é”€æ¯ï¼ˆææ„å‡½æ•°å¹¶ä¸é‡Šæ”¾å¯¹è±¡çš„å†…å­˜ï¼‰ã€‚è¿™æ˜¯å› ä¸ºplacement newæ„é€ èµ·æ¥çš„å¯¹è±¡æˆ–æ•°ç»„å¤§å°å¹¶ä¸ä¸€å®šç­‰äºåŸæ¥åˆ†é…çš„å†…å­˜å¤§å°ï¼Œä½¿ç”¨deleteä¼šé€ æˆå†…å­˜æ³„æ¼æˆ–è€…ä¹‹åé‡Šæ”¾å†…å­˜æ—¶å‡ºç°è¿è¡Œæ—¶é”™è¯¯ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ADT</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ADT</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        i = <span class="number">10</span>;</span><br><span class="line">        j = <span class="number">100</span>;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;ADT construct i=&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;,j=&quot;</span>&lt;&lt;j &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">ADT</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;ADT destruct&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *p = <span class="built_in"><span class="keyword">new</span></span>(nothrow) <span class="keyword">char</span>[<span class="keyword">sizeof</span> ADT + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;alloc failed&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æŒ‡é’ˆpç”³è¯·çš„å†…å­˜æ¥æ„å»ºç±»ADTå¯¹è±¡adt</span></span><br><span class="line">    <span class="comment">// placement newï¼šä¸å¿…æ‹…å¿ƒå¤±è´¥ï¼Œåªè¦pæ‰€æŒ‡å¯¹è±¡çš„çš„ç©ºé—´è¶³å¤ŸADTåˆ›å»ºå³å¯</span></span><br><span class="line">    ADT *adt = <span class="built_in"><span class="keyword">new</span></span>(p) ADT;  </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    delete adt; // errorï¼Œä¸èƒ½åœ¨æ­¤å¤„è°ƒç”¨delete</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨ææ„å‡½æ•°åˆ é™¤adt</span></span><br><span class="line">    adt-&gt;ADT::~<span class="built_in">ADT</span>(); </span><br><span class="line">    <span class="comment">// deleteåˆ é™¤p</span></span><br><span class="line">    <span class="keyword">delete</span>[] p;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ADT construct i=10,j=100</span><br><span class="line">ADT destruct</span><br></pre></td></tr></table></figure><h5 id="å°ç»“">å°ç»“</h5><ol><li>newå’Œdeleteåˆ†åˆ«æ˜¯mallocå’Œfreeçš„ä¸€å±‚å°è£…ï¼Œå¯¹äºè‡ªå®šä¹‰ç±»å‹è¿˜ä¼šåˆ†åˆ«è°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–/ææ„å‡½æ•°æ¸…ç†å†…å­˜ã€‚<strong>ä¸è¿‡newç›¸æ¯”mallocè¿˜ä¼šæœ‰ä¸€å±‚ç”³è¯·ç©ºé—´å¤±è´¥åº”å¯¹æªæ–½ï¼Œä»¥åŠå¯ä»¥åˆå§‹åŒ–</strong>ã€‚</li><li>new[]/delete[]ï¼Œæ˜¯åˆ†åˆ«ç”¨æ¥åˆ†é…å¯¹è±¡æ•°ç»„/æ¸…ç†å¯¹è±¡æ•°ç»„çš„ï¼Œæœ¬è´¨æ˜¯å¤šæ¬¡è°ƒç”¨äº†new/freeã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>new[]åˆ†é…çš„å¯¹è±¡æ•°ç»„ï¼Œè¿˜ä¼šå¤šåˆ†é…4ä¸ªå­—èŠ‚æ ‡è¯†å¯¹è±¡çš„ä¸ªæ•°</strong>ã€‚</li><li>åœ¨C++ä¸­æœ‰plain newï¼Œnothrow newå’Œplacement newã€‚plain newå°±æ˜¯æœ€æ™®é€šçš„newï¼Œåˆ†é…é”™è¯¯è¿”å›bad allocå¼‚å¸¸ï¼›nothrow newåˆ†é…å¤±è´¥è¿”å›NULLå¼‚å¸¸ï¼›placement newä¸åˆ†é…å†…å­˜ï¼Œè¯·åªè°ƒç”¨ææ„å‡½æ•°è¿›è¡Œé‡Šæ”¾ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´double freeã€‚</li></ol><h4 id="3-8-5-é—®ç­”æµ‹éªŒ">3.8.5 é—®ç­”æµ‹éªŒ</h4><p>æœ¬èŠ‚æ˜¯å…«è‚¡é‡ç¾åŒºï¼Œå› ä¸ºç‰¹åœ°å‡†å¤‡ä¸€äº›å¸¸è§é¢è¯•é—®é¢˜æ¥å·©å›ºæ‰€å­¦ã€‚</p><ol><li><p><strong>å †æ ˆçš„åŒºåˆ«</strong>ï¼Ÿ</p><p>ä¸»è¦çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><p><strong>ç”³è¯·æ–¹å¼</strong>ï¼š<strong>æ ˆç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…</strong>ï¼Œæ¯”å¦‚å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡<code>int a</code> ï¼Œè°ƒç”¨å‡½æ•°æ—¶ä¼šè‡ªåŠ¨ä¸º<code>a</code>å¼€è¾Ÿç©ºé—´ï¼›<strong>å †æ˜¯ç¨‹åºå‘˜ç”³è¯·å¹¶è´Ÿè´£é‡Šæ”¾</strong>ï¼Œå¹¶æŒ‡æ˜å¤§å°ï¼Œä¾‹å¦‚ <code>int* array= new int[LEN]&#123;1,2,3&#125;;</code> ï¼Œä½†æŒ‡é’ˆ<code>array</code>æœ¬èº«æ˜¯å­˜äºæ ˆä¸­ã€‚</p></li><li><p><strong>å­˜å‚¨å†…å®¹</strong>ï¼šæ ˆå­˜æ”¾å’Œå‡½æ•°ç›¸å…³çš„æ•°æ®ï¼Œå¦‚å®šä¹‰<u><strong>å±€éƒ¨</strong>å˜é‡</u>(ä½†ä¸åŒ…å«staticä¿®é¥°çš„å˜é‡)ã€ä¿å­˜çš„ä¸Šä¸‹æ–‡ç­‰ï¼›å †å­˜æ”¾å‡½æ•°æ— å…³çš„æ•°æ®ï¼Œå¦‚åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚</p></li><li><p><strong>å¤§å°é™åˆ¶</strong>ï¼šæ ˆç©ºé—´é»˜è®¤æ˜¯4Mï¼Œè¿ç»­çš„ ï¼›å †æ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œä¸€èˆ¬æ˜¯ 1G - 4Gï¼Œå¤§å°å—é™äºè®¡ç®—æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„è™šæ‹Ÿå†…å­˜ã€‚</p></li><li><p><strong>ç”³è¯·æ•ˆç‡</strong>ï¼šæ ˆç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼Œè®¡ç®—æœºåœ¨åº•å±‚å¯¹æ ˆæä¾›æ”¯æŒï¼Œé€Ÿåº¦å¿«ï¼›å †æ˜¯ç”±ç¨‹åºå‘˜newåˆ†é…çš„å†…å­˜ï¼Œä¸€èˆ¬é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œä½†æ›´çµæ´»ã€‚</p></li><li><p><strong>å­˜å‚¨æ•ˆç‡</strong>ï¼šæ ˆçš„å­˜å–æ•ˆç‡æ›´é«˜ã€‚è¯·çœ‹ä¸‹ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> arr1[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span>* arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a = arr1[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span> b = arr2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½¬æˆæ±‡ç¼–è¯­è¨€åˆ†æï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220108202348644.png" alt="image-20220108202348644"></p></li></ul></li><li><p><strong>new / malloc çš„å¼‚åŒ</strong>ï¼Ÿ</p><p>éƒ½å¯ç”¨äºå†…å­˜çš„åŠ¨æ€ç”³è¯·ï¼Œè¿”å›ç”¨æˆ·åˆ†é…ä½¿ç”¨ç©ºé—´çš„é¦–åœ°å€ã€‚</p><ul><li><p><strong>æœ¬è´¨</strong>ï¼šnewæ˜¯å…³é”®å­—ï¼Œmallocæ˜¯å‡½æ•°ï¼Œæ‰€ä»¥mallocè¿˜éœ€è¦å¼•å…¥åº“æ–‡ä»¶ï¼Œnewä¸ç”¨ï¼›</p></li><li><p><strong>è¿”å›å€¼ç±»å‹</strong>ï¼šmallocè¿”å›çš„æ˜¯voidç±»å‹æŒ‡é’ˆï¼ˆå¿…é¡»è¿›è¡Œç±»å‹è½¬æ¢ï¼‰ï¼Œnewè¿”å›çš„æ˜¯å…·ä½“ç±»å‹æŒ‡é’ˆï¼›</p></li><li><p><strong>ç©ºé—´è®¡ç®—</strong>ï¼šnewä¼šè‡ªåŠ¨åˆ†é…ç©ºé—´å¤§å°ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®ç±»å‹ä¿¡æ¯è‡ªè¡Œè®¡ç®—ï¼Œmallocéœ€è¦æ‰‹å·¥è®¡ç®—ï¼›</p></li><li><p><strong>ç±»å‹å®‰å…¨</strong>ï¼šnewæ˜¯ç±»å‹å®‰å…¨çš„ï¼Œmallocä¸æ˜¯ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> *p = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">2</span>]; <span class="comment">// ç¼–è¯‘é”™è¯¯</span></span><br><span class="line"><span class="keyword">int</span> *p = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="number">2</span> * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">double</span>));<span class="comment">// ç¼–è¯‘æ— é”™è¯¯</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ„é€ å‡½æ•°</strong>ï¼š newè°ƒç”¨åä¸º<strong>operator new</strong>çš„æ ‡å‡†åº“å‡½æ•°åˆ†é…è¶³å¤Ÿç©ºé—´ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹è¿˜ä¼šè°ƒç”¨ç›¸å…³å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œmallocåˆ™ä¸ä¼šï¼›</p></li><li><p><strong>åˆ†é…å¤±è´¥æªæ–½</strong>ï¼šnewæ˜¯mallocçš„ä¸€å±‚å°è£…ï¼Œå¦‚æœåˆ†é…å¤±è´¥è¿˜ä¼šæœ‰ç›¸åº”æªæ–½æ‰§è¡Œï¼ŒæŠ›å‡ºbac_allocå¼‚å¸¸ï¼›mallocè¿”å›nullã€‚</p></li></ul></li><li><p><strong>free / delete çš„å¼‚åŒ</strong>ï¼Ÿ</p><p>éƒ½å¯ç”¨äºå†…å­˜çš„åŠ¨æ€é‡Šæ”¾ã€‚</p><ul><li><strong>æœ¬è´¨</strong>ï¼šdelete æ˜¯å…³é”®å­—ï¼Œfree æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥free è¿˜éœ€è¦å¼•å…¥åº“æ–‡ä»¶ï¼Œdelete ä¸ç”¨ï¼›</li><li><strong>è¿”å›å€¼ç±»å‹</strong>ï¼šfreeè¿”å›çš„æ˜¯voidç±»å‹æŒ‡é’ˆï¼ˆå¿…é¡»è¿›è¡Œç±»å‹è½¬æ¢ï¼‰ï¼Œdelete è¿”å›çš„æ˜¯å…·ä½“ç±»å‹æŒ‡é’ˆï¼›</li><li><strong>ææ„å‡½æ•°</strong>ï¼š delete è°ƒç”¨åä¸º<strong>operator delete</strong>çš„æ ‡å‡†åº“å‡½æ•°åˆ†é…è¶³å¤Ÿç©ºé—´ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹è¿˜ä¼šè°ƒç”¨ç›¸å…³å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œfree åˆ™ä¸ä¼šã€‚</li></ul></li><li><p><strong>newå®ç°åŸç†ï¼Ÿdeleteå®ç°åŸç†</strong>ï¼Ÿ</p><ul><li><strong>newåŸç†</strong>ï¼šoperator newåˆ†é…å†…å­˜ ï¼ˆåº•å±‚æ˜¯mallocå®ç°ï¼‰â€”&gt; ï¼ˆè‡ªå®šä¹‰ç±»å‹ï¼‰åˆ†é…çš„å†…å­˜ä¸Šè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–â€”&gt;è¿”å›æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆï¼›</li><li><strong>deleteåŸç†</strong>ï¼šoperator deleteæ¸…ç†å†…å­˜ ï¼ˆåº•å±‚æ˜¯freeå®ç°ï¼‰â€”&gt; ï¼ˆè‡ªå®šä¹‰ç±»å‹ï¼‰åˆ é™¤å†…å­˜å‰è¿˜ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼›</li></ul></li><li><p><strong>malloc/freeåº•å±‚åŸç†</strong>ï¼Ÿ</p><p>å‚è€ƒå‰æ–‡ã€‚è¿™é‡Œåªç®€ç•¥è¯´æ˜ï¼š</p><ul><li>mallocï¼šbrkåˆå§‹åŒ–åˆ†é…â€“&gt;åç»­åˆ†é…é€šè¿‡å†…å­˜æ± ï¼šbins+åŒå‘é“¾è¡¨å®ç°â€”&gt;å¤ªå¤§åˆ™top chunk å’Œmmapåˆ†é…ï¼›</li><li>freeï¼šå°†chunkæ ‡è®°å¯ä½¿ç”¨ï¼Œå¹¶åŠ å…¥ç©ºé—²é“¾è¡¨ã€‚åœ¨ä¸Šä¸€ä¸ªæ­¥éª¤freeçš„æ—¶å€™ï¼Œå‘ç°æœ€é«˜åœ°å€ç©ºé—²å†…å­˜è¶…è¿‡128Kï¼Œè¿˜ä¼šå†…å­˜ç´§ç¼©ã€‚</li></ul></li><li><p><strong>è¢«freeå›æ”¶çš„å†…å­˜æ˜¯ç«‹å³è¿”è¿˜ç»™æ“ä½œç³»ç»Ÿå—</strong>ï¼Ÿ</p><p>å¦‚å‰ï¼Œfreeå›æ”¶åªæ˜¯æ ‡è¯†è¿™å—å†…å­˜ç©ºé—²ï¼ŒåŒæ—¶ä¼šåŠ å…¥ç©ºé—²é“¾è¡¨ä¸­ç­‰å¾…ä¸‹ä¸€æ¬¡åˆ†é…ã€‚</p></li><li><p><strong>deleteå’Œfreeå¯ä»¥æ··ç”¨å—</strong>?</p><p>æˆ‘ä»¬çŸ¥é“deleteä¹Ÿåªæ˜¯freeä¸€ç§å°è£…ï¼Œåªæœ‰è‡ªå®šä¹‰ç±»å‹æ—¶deleteä¼šè°ƒç”¨ææ„å‡½æ•°ã€‚newå’ŒmallocåŒç†ã€‚</p><p>æ‰€ä»¥åœ¨ä»¥ä¸‹æƒ…å†µæ˜¯<strong>å¯ä»¥free/deleteæ··ç”¨</strong>ï¼š</p><ol><li><p><strong>å¯¹è±¡æ˜¯åŸºæœ¬ç±»å‹æ—¶</strong>ã€‚</p><p>freeæ‰newç”³è¯·çš„å†…å­˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>* a  = <span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// delete a;</span></span><br><span class="line"><span class="built_in">free</span>(a); </span><br></pre></td></tr></table></figure><p>deleteæ‰mallocç”³è¯·çš„å†…å­˜ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">int</span>* a  = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>));</span><br><span class="line"><span class="keyword">delete</span> a;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¹Ÿé€‚ç”¨äºnew/mallocæ··ç”¨ã€‚</p></li><li><p><strong>è‡ªå®šä¹‰çš„ç±»å‹ï¼Œä½†æ²¡æœ‰æ˜¾ç¤ºå®šä¹‰ææ„å‡½æ•°</strong>ã€‚</p><p>deleteå’Œfreeæ··ç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span>  </span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">test</span>()&#123;a = <span class="number">0</span>;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>     </span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    test* t1 = (test*)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(test));</span><br><span class="line">  <span class="built_in"><span class="keyword">delete</span></span>(t1);</span><br><span class="line">    </span><br><span class="line">  test* t2 = <span class="keyword">new</span> <span class="built_in">test</span>();</span><br><span class="line">  <span class="built_in">free</span>(t2);       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œ<strong>mallocæ··ç”¨newéœ€è¦æ˜¾ç¤ºè°ƒç”¨æ„é€ å‡½æ•°çš„é€»è¾‘å®ç°ï¼ˆæˆ–è€…è¯¥ç±»ä¸ä¼šæœ‰æ„é€ å‡½æ•°ä½œç”¨ï¼‰</strong>ã€‚</p></li><li><p><strong>mallocã€reallocã€callocçš„åŒºåˆ«</strong>ï¼Ÿ</p><ul><li><p>malloc</p><p>mallocç”³è¯·20ä¸ªintç±»å‹çš„ç©ºé—´ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// void* malloc(unsigned int num_size);</span></span><br><span class="line"><span class="keyword">int</span> *p = <span class="built_in">malloc</span>(<span class="number">20</span>*<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>));</span><br></pre></td></tr></table></figure></li><li><p>realloc</p><p>mallocç”³è¯·çš„ç©ºé—´çš„å€¼æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œcallocç”³è¯·çš„ç©ºé—´çš„å€¼æ˜¯åˆå§‹åŒ–ä¸º0çš„ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// void* calloc(size_t n,size_t size);</span></span><br><span class="line"><span class="keyword">int</span> *p = <span class="built_in">calloc</span>(<span class="number">20</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">int</span>));</span><br></pre></td></tr></table></figure></li><li><p>realloc</p></li></ul><p>ç»™åŠ¨æ€åˆ†é…çš„ç©ºé—´åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œç”¨äºæ‰©å……å®¹é‡ã€‚</p>  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// void realloc(void *p, size_t new_size);</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸ºä»€ä¹ˆC++æ²¡æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿè¿™ç‚¹è·ŸJavaä¸å¤ªä¸€æ ·</strong>ã€‚</p><ul><li><strong>èµ„æºæ¶ˆè€—</strong>ã€‚å®ç°ä¸€ä¸ªåƒåœ¾å›æ”¶å™¨ä¼šå¸¦æ¥é¢å¤–çš„ç©ºé—´å’Œæ—¶é—´å¼€é”€ï¼›<ul><li>ä½ éœ€è¦å¼€è¾Ÿä¸€å®šçš„ç©ºé—´ä¿å­˜æŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°å’Œå¯¹ä»–ä»¬è¿›è¡Œæ ‡è®°markï¼›</li><li>ç„¶åéœ€è¦å•ç‹¬å¼€è¾Ÿä¸€ä¸ªçº¿ç¨‹åœ¨ç©ºé—²çš„æ—¶å€™è¿›è¡Œfreeæ“ä½œã€‚</li></ul></li><li><strong>C++æœ¬èº«åŸå› </strong>ã€‚åƒåœ¾å›æ”¶ä¼šä½¿å¾—C++ä¸é€‚åˆè¿›è¡Œå¾ˆå¤šåº•å±‚çš„æ“ä½œã€‚</li></ul></li></ol><h3 id="3-9-Lambdaè¡¨è¾¾å¼">3.9 Lambdaè¡¨è¾¾å¼</h3><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸¸å¸¸éœ€è¦å®šä¹‰ä¸€ä¸ª<strong>ç®€å•ã€ç”šè‡³åªè¢«ä½¿ç”¨ä¸€æ¬¡</strong>çš„å‡½æ•°ï¼Œé¢å¤–åœ°å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ—¢æµªè´¹äº†ç©ºé—´ï¼Œç”šè‡³æœªå¿…æœ‰<strong>ç®€åŒ–æˆä¸€è¡Œä»£ç </strong>å¥½ç†è§£ã€‚</p><p>å¦å¤–ï¼Œå‰é¢çš„å­¦ä¹ æˆ‘ä»¬äº†è§£åˆ°C++æ˜¯ä¸å…è®¸å‡½æ•°åµŒå¥—çš„ï¼Œä½†lambdaå¯ä»¥è¢«å‡½æ•°åµŒå¥—ï¼ˆlambdaå¹¶ä¸æ˜¯å‡½æ•°ï¼Œä¸‹æ–‡ç»†è¯´ï¼‰ã€‚</p><p>lambdaè¡¨è¾¾å¼å°±ä¸ºæˆ‘ä»¬åšäº†è¿™ä¹ˆä¸€ä»¶äº‹ï¼š<strong>å°†ä¸€ä¸ªç®€å•å‡½æ•°ç®€åŒ–ä¸ºä¸€è¡Œï¼Œè¿˜å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°è¿›è¡ŒåµŒå¥—lambda</strong>ã€‚</p><h4 id="3-9-1-lambdaåˆè¯†">3.9.1 lambdaåˆè¯†</h4><h5 id="ç¬¬ä¸€ä¸ªlambda">ç¬¬ä¸€ä¸ªlambda</h5><p>C++ä¸­lambdaè¡¨è¾¾å¼æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ captureClause ] ( parameters ) -&gt; returnType</span><br><span class="line">&#123;</span><br><span class="line">    Statement;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>captureClause</code>ï¼šå…è®¸æˆ‘ä»¬ä½¿ç”¨lambdaå¤–éƒ¨çš„å˜é‡ï¼Œè¿™ä¸€ç‚¹åœ¨3.9.5ä¸­è¯¦è¿°ï¼Œè¿™é‡Œå…ˆç•¥è¿‡ï¼›</li><li><code>parameters</code>ï¼šä¼ é€’çš„å‚æ•°ï¼Œå¯ç©ºï¼›</li><li><code>returnType</code>ï¼šè¿”å›ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨æ–­ï¼Œå¯ç©ºï¼›</li><li><code>Statement</code>ï¼šä»£ç ä½“ï¼Œä¸€èˆ¬å°±ä¸€è¡Œï¼Œå½“ç„¶å¤šè¡Œä¹Ÿè¡Œã€‚</li></ul><p>ä¸€ä¸ªæœ€ç®€å•çš„lambdaè¡¨è¾¾å¼å¯å®šä¹‰ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]()&#123;&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä¸¾ä¾‹è¯´æ˜ç”¨æ³•ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰å†™è¿‡ä¸€ä¸ªå†’æ³¡å‡½æ•°<code>bubbleSort</code>ï¼šå®ƒæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå…è®¸æˆ‘ä»¬ä¼ é€’å®šä¹‰æ’åºè§„åˆ™ï¼Œå³<code>myCompare</code>å‡½æ•°æ¥å®ç°æ’åºã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº¤æ¢æ•°ç»„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>* arr,<span class="keyword">int</span> idx_i,<span class="keyword">int</span> idx_j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = arr[idx_i];</span><br><span class="line">    arr[idx_i] = arr[idx_j];</span><br><span class="line">    arr[idx_j] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ’åºè§„åˆ™</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">myCompare</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†’æ³¡æ’åº</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> len, <span class="keyword">bool</span> (*compare)(<span class="keyword">int</span>,<span class="keyword">int</span>))</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)   <span class="comment">// å¤–è½®=n-1</span></span><br><span class="line">        <span class="comment">// * j=0,æ¯æ¬¡éƒ½æ˜¯ä»å¤´å¼€å§‹æ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt; len-i<span class="number">-1</span>; j++ ) <span class="comment">// å†…è½®=ä½™ä¸‹ä¹±åºæ•°-1</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">compare</span>(arr[j],arr[j+<span class="number">1</span>]))</span><br><span class="line">                <span class="built_in">swap</span>(arr,j,j+<span class="number">1</span>); </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> array[] = &#123;<span class="number">5</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>&#125;;</span><br><span class="line">   <span class="keyword">int</span> len = <span class="built_in"><span class="keyword">sizeof</span></span>(array)/<span class="built_in"><span class="keyword">sizeof</span></span>(array[<span class="number">0</span>]);</span><br><span class="line">   <span class="built_in">bubbleSort</span>(array,len,myCompare);</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len  ;i++)</span><br><span class="line">       cout&lt;&lt;array[i]&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†è¿™ä¸ª<code>myCompare</code>å‡½æ•°æ”¹ä¸ºæ›´ç®€æ´<code>lambda</code>è¡¨è¾¾å¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">myCompare</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[](<span class="keyword">int</span> a, <span class="keyword">int</span> b)&#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å¦‚æ­¤è°ƒç”¨bubbleSortå‡½æ•°ï¼šä»£ç æ›´åŠ çš„ç´§å‡‘ï¼Œä¸Šä¸‹æ–‡æ›´æ¸…æ™°ï¼Œä¸€çœ¼æ˜ç™½æˆ‘ä»¬æ’åºçš„è§„åˆ™ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bubbleSort(array,len,myCompare);</span></span><br><span class="line"><span class="built_in">bubbleSort</span>(array,len,[](<span class="keyword">int</span> a, <span class="keyword">int</span> b)&#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h5 id="lambdaæœ¬è´¨æ¢è®¨ğŸŒŸ">lambdaæœ¬è´¨æ¢è®¨ğŸŒŸ</h5><p>è™½ç„¶3.9.2èŠ‚ï¼ˆä¸‹èŠ‚ï¼‰çš„åå­—å«åšâ€œlambdaä¸å‡½æ•°æŒ‡é’ˆâ€ï¼Œä½†å€¼å¾—æå‰å£°æ˜çš„ä¸€ç‚¹æ˜¯ï¼š<strong>lambdaå¹¶ä¸æ˜¯å‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œç§°ä¸ºå‡½æ•°å¯¹è±¡ï¼ˆä¹Ÿç§°ä¸ºå‡½æ•°å­ï¼‰ã€‚å‡½æ•°ä¸èƒ½åµŒå¥—ï¼Œä½†lambdaå¯ä»¥</strong>ã€‚</p><p><strong>æ€ä¹ˆç†è§£å‡½æ•°å¯¹è±¡</strong>ï¼Ÿ</p><p><strong>C++å‡½æ•°å¯¹è±¡å®è´¨ä¸Šæ˜¯å®ç°äº†å¯¹()æ“ä½œç¬¦çš„é‡è½½</strong>ã€‚C++å‡½æ•°å¯¹è±¡ä¸æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œä½†å®ƒçš„è°ƒç”¨æ–¹å¼ä¸å‡½æ•°æŒ‡é’ˆä¸€æ ·ï¼Œåé¢åŠ ä¸ªæ‹¬å·å°±å¯ä»¥äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Add</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">const</span> <span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> a,<span class="keyword">const</span> <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// addFunctionçš„Addç±»å¯¹è±¡ï¼Œæ­¤ä¹Ÿæ˜¯å‡½æ•°å¯¹è±¡</span></span><br><span class="line">    Add addFunction;</span><br><span class="line">    <span class="comment">// åƒå‡½æ•°ï¼ˆæŒ‡é’ˆï¼‰ä¸€æ ·è°ƒç”¨</span></span><br><span class="line">    cout&lt;&lt;<span class="built_in">addFunction</span>(<span class="number">2</span>,<span class="number">3</span>)&lt;&lt;endl;  <span class="comment">// 5</span></span><br><span class="line">    cout&lt;&lt;addFunction.<span class="built_in"><span class="keyword">operator</span></span>()(<span class="number">2</span>,<span class="number">3</span>)&lt;&lt;endl;    <span class="comment">// 5</span></span><br><span class="line">    cout&lt;&lt;<span class="built_in">Add</span>()(<span class="number">2</span>,<span class="number">3</span>)&lt;&lt;endl;   <span class="comment">// 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‡½æ•°å¯¹è±¡ç›¸æ¯”æ™®é€šå‡½æ•°æœ‰ä»€ä¹ˆå¥½å¤„å—</strong>ï¼Ÿ</p><ul><li><p><strong>å‡½æ•°å¯¹è±¡å¸¦æœ‰çŠ¶æ€</strong>ï¼šå‡½æ•°å¯¹è±¡ç›¸å¯¹äºæ™®é€šå‡½æ•°æ˜¯â€œæ™ºèƒ½å‡½æ•°â€ï¼Œè¿™å°±å¦‚åŒæ™ºèƒ½æŒ‡é’ˆç›¸è¾ƒäºä¼ ç»ŸæŒ‡é’ˆã€‚å› ä¸ºå‡½æ•°å¯¹è±¡é™¤äº†æä¾›å‡½æ•°è°ƒç”¨ç¬¦æ–¹æ³•ï¼Œè¿˜å¯ä»¥æ‹¥æœ‰å…¶ä»–æ–¹æ³•å’Œæ•°æ®æˆå‘˜ã€‚æ‰€ä»¥å‡½æ•°å¯¹è±¡æœ‰çŠ¶æ€ã€‚å³ä½¿åŒä¸€ä¸ªç±»å®ä¾‹åŒ–çš„ä¸åŒçš„å‡½æ•°å¯¹è±¡å…¶çŠ¶æ€ä¹Ÿä¸ç›¸åŒï¼Œè¿™æ˜¯æ™®é€šå‡½æ•°æ‰€æ— æ³•åšåˆ°çš„ã€‚è€Œä¸”å‡½æ•°å¯¹è±¡æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶åˆ›å»ºã€‚</p></li><li><p><strong>æ¯ä¸ªå‡½æ•°å¯¹è±¡æœ‰è‡ªå·±çš„ç±»å‹</strong>ï¼šå¯¹äºæ™®é€šå‡½æ•°æ¥è¯´ï¼Œåªè¦ç­¾åä¸€è‡´ï¼Œå…¶ç±»å‹å°±æ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯è¿™å¹¶ä¸é€‚ç”¨äºå‡½æ•°å¯¹è±¡ï¼Œå› ä¸ºå‡½æ•°å¯¹è±¡çš„ç±»å‹æ˜¯å…¶ç±»çš„ç±»å‹ã€‚è¿™æ ·ï¼Œå‡½æ•°å¯¹è±¡æœ‰è‡ªå·±çš„ç±»å‹ï¼Œè¿™æ„å‘³ç€å‡½æ•°å¯¹è±¡å¯ä»¥ç”¨äºæ¨¡æ¿å‚æ•°ï¼Œè¿™å¯¹æ³›å‹ç¼–ç¨‹æœ‰å¾ˆå¤§æå‡ã€‚</p></li><li><p><strong>å‡½æ•°å¯¹è±¡ä¸€èˆ¬å¿«äºæ™®é€šå‡½æ•°</strong>ï¼šå› ä¸ºå‡½æ•°å¯¹è±¡ä¸€èˆ¬ç”¨äºæ¨¡æ¿å‚æ•°ï¼Œæ¨¡æ¿ä¸€èˆ¬ä¼šåœ¨ç¼–è¯‘æ—¶ä¼šåšä¸€äº›ä¼˜åŒ–ã€‚</p></li></ul><p>å›åˆ°lambdaè¡¨è¾¾å¼ã€‚</p><p><strong>æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªlambdaè¡¨è¾¾å¼æ˜¯å¦‚ä½•è¢«è½¬æ¢æˆå‡½æ•°å¯¹è±¡</strong>ã€‚</p><p>å‡†å¤‡ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> add = [](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y) &#123; <span class="keyword">return</span> x + y; &#125;;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="built_in">add</span>(<span class="number">2</span>, <span class="number">3</span>);         <span class="comment">// 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾æ—§æ˜¯https://cppinsights.io/ï¼Œè§‚å¯Ÿç¼–è¯‘è¿‡ç¨‹å˜åŒ–ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220112200056709.png" alt="image-20220112200056709"></p><p>ç¼–è¯‘å™¨å¦‚ä½•å°†æˆ‘ä»¬å†™çš„lambdaè¡¨è¾¾å¼è½¬æ¢ä¸ºå‡½æ•°å¯¹è±¡ä¾¿ä¸€ç›®äº†ç„¶ï¼š</p><ol><li>é¦–å…ˆä¸ºæˆ‘ä»¬ç”Ÿæˆç±»<code>__lambda_3_16</code> ï¼ˆâ‘ å¤„ï¼‰ï¼Œå®ƒæœ‰ä¸€ä¸ªå†…è”å‡½æ•°ï¼ˆâ‘¡å¤„ï¼‰ï¼Œé‡è½½äº†ç¬¦å·<code>()</code>ï¼›</li><li>ä»£ç 30è¡Œå¤„ï¼Œä¸ºæˆ‘ä»¬ç”Ÿæˆäº†lambdaå‡½æ•°å¯¹è±¡<code>add</code>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„lambdaè¡¨è¾¾å¼åï¼›</li><li>éšåè°ƒç”¨äº†å‡½æ•°å¯¹è±¡<code>add</code> ï¼ˆâ‘¢å¤„ï¼‰ï¼Œå®Œæˆæ•´ä¸ªè½¬æ¢è¿‡ç¨‹ã€‚</li></ol><h5 id="å­˜å‚¨lambda">å­˜å‚¨lambda</h5><p>è™½ç„¶ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¸éœ€è¦åƒå‡½æ•°ä¸€æ ·ç»™lambdaè¡¨è¾¾å¼ä¸€ä¸ªåå­—ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¹Ÿéœ€è¦èƒ½å°†lambdaè¡¨è¾¾å¼ï¼ˆä½œä¸ºå³å€¼ï¼‰å­˜å‚¨èµ·æ¥ï¼Œä¾›ä»¥åä½¿ç”¨ã€‚</p><p>åœ¨C++ä¸­æä¾›ä¸‰ç§æ–¹å¼ï¼š</p><ol><li><strong>ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæ–¹å¼å­˜å‚¨</strong>ï¼šåªæœ‰åœ¨<code>capture clause</code>ä¸ºç©ºæ—¶ï¼›</li><li><strong>ä½¿ç”¨functionæ–¹å¼å­˜å‚¨</strong>ï¼š<code>capture clause</code>ä¸ä¸ºç©ºæ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ï¼›</li></ol><p>å…ˆæ¥çœ‹çœ‹å‡½æ•°æŒ‡é’ˆæ–¹å¼ã€‚</p><p>å‡½æ•°æŒ‡é’ˆæŒ‡å‘ä¸ä»…é™äºå‡½æ•°ï¼Œåªè¦æ˜¯å‡½æ•°å¯¹è±¡éƒ½å¯ä»¥æŒ‡å‘ã€‚lambdaä½œä¸ºå‡½æ•°å¯¹è±¡ï¼Œè‡ªç„¶æ˜¯å¯ä»¥è¢«å…¶å­˜å‚¨çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">bool</span></span> (*myCompare)(<span class="keyword">int</span>, <span class="keyword">int</span>) = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;;</span><br></pre></td></tr></table></figure><p>ç”¨ <code>auto</code> å…³é”®å­—å¯ç®€åŒ–å‡½æ•°æŒ‡é’ˆç±»å‹ä¹¦å†™ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> myCompare = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;;</span><br></pre></td></tr></table></figure><p>å†æ¥å…³æ³¨ä¸‹<code>std::function</code>æ–¹å¼ã€‚</p><p>å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼š<code>std::function</code>æœ¬è´¨å°±æ˜¯ç±»æ¨¡æ¿ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°å®¹å™¨ï¼Œå¯ä»¥å°†<strong>å‡½æ•°æŒ‡é’ˆ/å‡½æ•°è½¬æ¢æˆï¼ˆå‡½æ•°ï¼‰å¯¹è±¡</strong>è¿›è¡Œå¤„ç†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function&lt;<span class="built_in"><span class="keyword">bool</span></span>(<span class="keyword">int</span>,<span class="keyword">int</span>)&gt; myCompare = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;;</span><br></pre></td></tr></table></figure><h5 id="lambdaå‚æ•°">lambdaå‚æ•°</h5><p>Lambdaè¡¨è¾¾å¼çš„å‚æ•°å’Œæ™®é€šå‡½æ•°çš„å‚æ•°ç›¸æ¯”æœ‰äº›é™åˆ¶ï¼ˆC++11ï¼‰ï¼š</p><ol><li><p>å‚æ•°åˆ—è¡¨ä¸­ä¸èƒ½æœ‰é»˜è®¤å‚æ•°ï¼›</p></li><li><p>ä¸æ”¯æŒå¯å˜å‚æ•°ï¼ˆæ¯”å¦‚ä½¿ç”¨autoå…³é”®å­—ï¼‰ï¼›</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++11:ç¼–è¯‘å‡ºé”™ï¼Œå‚æ•°ç±»å‹æ— æ³•ä½¿ç”¨auto</span></span><br><span class="line"><span class="keyword">auto</span> myCompare = [](<span class="keyword">auto</span> a, <span class="keyword">auto</span> b) &#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;;</span><br></pre></td></tr></table></figure></li><li><p>æ‰€æœ‰å‚æ•°å¿…é¡»æœ‰å‚æ•°åã€‚</p></li></ol><p>å…³äºç¬¬2ç‚¹ï¼Œä»<code>C++14</code>å¼€å§‹ï¼Œ<code>lambda</code>è¡¨è¾¾å¼æ”¯æŒæ³›å‹ï¼šå…¶å‚æ•°å¯ä»¥ä½¿ç”¨è‡ªåŠ¨æ¨æ–­ç±»å‹çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦æ˜¾ç¤ºåœ°å£°æ˜å…·ä½“ç±»å‹ã€‚</p><p>å…·ä½“ä»‹ç»å‚è€ƒ3.9.2èŠ‚ã€‚</p><h4 id="3-9-2-æ³›å‹lambdaï¼ˆC-14ï¼‰">3.9.2 æ³›å‹lambdaï¼ˆC++14ï¼‰</h4><h5 id="ä»€ä¹ˆæ˜¯æ³›å‹lambdaï¼Ÿ">ä»€ä¹ˆæ˜¯æ³›å‹lambdaï¼Ÿ</h5><p>ä» C++14 å¼€å§‹ï¼Œæˆ‘ä»¬è¢«å…è®¸<code>auto</code>ç”¨äºå‚æ•°ã€‚å½“ lambda å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª<code>auto</code>å‚æ•°æ—¶ï¼Œç¼–è¯‘å™¨å°†ä»å¯¹ lambda çš„è°ƒç”¨ä¸­æ¨æ–­å‡ºéœ€è¦å“ªäº›å‚æ•°ç±»å‹ã€‚</p><p>è¿™ä½¿å¾—<strong>å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª<code>auto</code>å‚æ•°çš„lambdaå¯é€‚ç”¨äºå¤šç§ç±»å‹ï¼Œ<strong>å®ƒä»¬ä¹Ÿè¢«ç§°ä¸º</strong>æ³›å‹ lambda</strong>ã€‚</p><p>çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> add = [](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y) &#123; <span class="keyword">return</span> x + y; &#125;;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="built_in">add</span>(<span class="number">2</span>, <span class="number">3</span>);         <span class="comment">// 5</span></span><br><span class="line">    <span class="keyword">double</span> y = <span class="built_in">add</span>(<span class="number">2.5</span>, <span class="number">3.4</span>);  <span class="comment">// 5.9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯éå¸¸åƒæ¨¡æ¿å‡½æ•°ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">add</span><span class="params">(T x, T y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="built_in">add</span>(<span class="number">2</span>, <span class="number">3</span>);         <span class="comment">// 5</span></span><br><span class="line">    <span class="keyword">double</span> y = <span class="built_in">add</span>(<span class="number">2.5</span>, <span class="number">3.4</span>);  <span class="comment">// 5.9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>add(2, 3)</code> ã€<code>add(2.5, 3.4)</code> åˆ†åˆ«è®©å‡½æ•°æ¨¡æ¿ç”Ÿæˆäº†å‡½æ•°å®ä¾‹<code> add(int, int)</code>ã€<code> add(double, double)ã€‚</code></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220112193845733.png" alt="image-20220112193845733"></p><p><strong>autoå…³é”®å­—è‡ªåŠ¨æ¨æ–­lambdaå‚æ•°ç±»å‹</strong>ï¼Œè®©lambdaè¡¨è¾¾å¼èµ·åˆ°äº†å’Œæ¨¡æ¿å‡½æ•°ç›¸åŒçš„æ•ˆæœã€‚å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œ<strong>æ¨¡æ¿å‡½æ•°ä¼šä¸ºæ¯ç§ä¸åŒç±»å‹ç”Ÿæˆå®ä¾‹å‡½æ•°ï¼šé‚£æ³›å‹lambdaä¹Ÿä¼šä¸ºä¸åŒç±»å‹ç”Ÿæˆä¸€ä¸ªlambdaè¡¨è¾¾å¼å—</strong>ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220112194112575.png" alt="image-20220112194112575"></p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">  <span class="class"><span class="keyword">class</span> __<span class="title">lambda_3_16</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="keyword">public</span>: </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">type_parameter_0_0</span>, <span class="keyword">class</span> <span class="title">type_parameter_0_1</span>&gt;</span></span><br><span class="line">    <span class="keyword">inline</span> <span class="comment">/*constexpr */</span> <span class="function"><span class="keyword">auto</span> <span class="title">operator</span><span class="params">()</span><span class="params">(type_parameter_0_0 x, type_parameter_0_1 y)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> INSIGHTS_USE_TEMPLATE</span></span><br><span class="line">    <span class="keyword">template</span>&lt;&gt;</span><br><span class="line">    <span class="keyword">inline</span> <span class="comment">/*constexpr */</span> <span class="function"><span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> INSIGHTS_USE_TEMPLATE</span></span><br><span class="line">    <span class="keyword">template</span>&lt;&gt;</span><br><span class="line">    <span class="keyword">inline</span> <span class="comment">/*constexpr */</span> <span class="function"><span class="keyword">double</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span>: </span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">type_parameter_0_0</span>, <span class="keyword">class</span> <span class="title">type_parameter_0_1</span>&gt;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">auto</span> __invoke(type_parameter_0_0 x, type_parameter_0_1 y)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  __lambda_3_16 add = __lambda_3_16&#123;&#125;;</span><br><span class="line">  <span class="keyword">int</span> x = add.<span class="built_in"><span class="keyword">operator</span></span>()(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">double</span> y = add.<span class="built_in"><span class="keyword">operator</span></span>()(<span class="number">2.5</span>, <span class="number">3.3999999999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼š</p><ol><li><p>ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆäº†lambdaç±»<code>__lambda_3_16</code></p></li><li><p>ç±»<code>__lambda_3_16</code> ï¼Œæ ¹æ®40ã€41è¡Œå‡½æ•°è°ƒç”¨çš„ä¸åŒå‚æ•°ç±»å‹ï¼Œåˆ†åˆ«ç”Ÿæˆäº†ä¸¤ä¸ªæˆå‘˜å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line">    <span class="keyword">inline</span> <span class="comment">/*constexpr */</span> <span class="function"><span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span> <span class="comment">/*constexpr */</span> <span class="keyword">double</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> <span class="keyword">const</span></span></span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°ï¼Œä¸¤ä¸ªå‡½æ•°éƒ½é‡è½½äº†æ“ä½œç¬¦<code>()</code> ã€‚</p></li><li><p>ä»£ç 39è¡Œï¼Œç”Ÿæˆäº†ç±»<code>__lambda_3_16</code> å¯¹è±¡<code>add</code>ï¼Œ<code>add</code>å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„æ³›å‹lambdaåï¼Œæ˜¾ç„¶æ­¤æ—¶<code>add</code>ä¹Ÿæ˜¯å‡½æ•°å¯¹è±¡ï¼Œå¯ä»¥ç”¨<code>åå­—()</code>æ–¹å¼è°ƒç”¨ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__lambda_3_16 add = __lambda_3_16&#123;&#125;;</span><br></pre></td></tr></table></figure></li><li><p>ä»£ç 40ã€41è¡Œè°ƒç”¨äº†ä¸åŒçš„ç±»<code>__lambda_3_16</code> ä¸åŒé‡è½½å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = add.<span class="built_in"><span class="keyword">operator</span></span>()(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">double</span> y = add.<span class="built_in"><span class="keyword">operator</span></span>()(<span class="number">2.5</span>, <span class="number">3.3999999999999999</span>);</span><br></pre></td></tr></table></figure></li></ol><h5 id="æ›´å¥½åœ°ç†è§£æ³›å‹é—­åŒ…è¡Œä¸ºğŸŒŸ">æ›´å¥½åœ°ç†è§£æ³›å‹é—­åŒ…è¡Œä¸ºğŸŒŸ</h5><p>å‰é¢å·²ç»è¯´åˆ°ï¼Œæ³›å‹lambdaä¼šä¸ºæ¯ç§ä¸åŒç±»å‹ç”Ÿæˆæˆå‘˜å‡½æ•° ã€‚</p><p>åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿäº†è§£å±€éƒ¨é™æ€å˜é‡åŒæ ·å…·æœ‰å…¨å±€çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†è¿™ç§ç‰¹æ€§ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">myCount</span><span class="params">(<span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;the type of your input:&quot;</span>&lt;&lt;<span class="built_in"><span class="keyword">typeid</span></span>(value).<span class="built_in">name</span>()&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> count++; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout&lt;&lt;<span class="built_in">myCount</span>(<span class="number">0</span>)&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;<span class="built_in">myCount</span>(<span class="number">0</span>)&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">the type of your input:i</span><br><span class="line">1</span><br><span class="line">the type of your input:d</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p><code>count</code> è™½ç„¶æ˜¯å±€éƒ¨å˜é‡ï¼Œä½†æ˜¯ç”±äºæ˜¯é™æ€å˜é‡å‡½æ•°å­˜å‚¨åœ¨å…¨å±€æ•°æ®æ®µï¼Œå’Œå †æ ˆæ— å…³ï¼Œé€€å‡ºä¹Ÿä¸ä¼šé”€æ¯ã€‚<strong>æ‰€ä»¥è¢«myCountå‡½æ•°å…±äº«ï¼Œå¯è¿›è¡Œè®¡æ•°</strong>ã€‚</p><p><strong>ä½†æ˜¯å¦‚æœæˆ‘ä»¬<code>myCount</code>æ›¿æ¢æˆæ³›å‹å‡½æ•°ï¼Œå³å…è®¸å‚æ•°ç±»å‹ä¸ºautoï¼Œä¸€åˆ‡å¼€å§‹å˜å¾—ä¸ä¸€æ ·äº†</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++20æ”¯æŒå‚æ•°ç±»å‹ä¸ºauto</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">myCount</span><span class="params">(<span class="keyword">auto</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;the type of your input:&quot;</span>&lt;&lt;<span class="built_in"><span class="keyword">typeid</span></span>(value).<span class="built_in">name</span>()&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> count++; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout&lt;&lt;<span class="built_in">myCount</span>(<span class="number">1</span>)&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;<span class="built_in">myCount</span>(<span class="number">1.2</span>)&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">the type of your input:i</span><br><span class="line">1</span><br><span class="line">the type of your input:d</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é™æ€å˜é‡<code>count</code>æ²¡æœ‰è¢«<code>myCount</code>å‡½æ•°å…±äº«ï¼Ÿè¿™æ˜¯å› ä¸ºæ­¤æ—¶<code>myCount</code>å‡½æ•°å·²ç»æ˜¯æ³›å‹å‡½æ•°ã€‚</p><ul><li>æ‰§è¡Œä»£ç ç¬¬13è¡Œï¼Œæ¨æ–­å‡º<code>value</code>ä¸º<code>int</code>ç±»å‹ï¼Œç¼–è¯‘å™¨ç”Ÿæˆå‡½æ•°<code>int myCount&lt;int&gt;(int value)</code>ï¼Œå®ƒæ‹¥æœ‰è‡ªå·±ä½œç”¨èŒƒå›´çš„é™æ€å˜é‡<code>count</code>ï¼›</li><li>æ‰§è¡Œä»£ç ç¬¬14è¡Œï¼Œç±»ä¼¼çš„ï¼Œ<strong>æ— æ³•åŒ¹é…ä¸Šä¸€æ¬¡ç”Ÿæˆå‡½æ•°<code>int myCount&lt;int&gt;(int value)</code></strong>ã€‚æ‰€ä»¥ç¼–è¯‘å™¨è¿˜éœ€ç”Ÿæˆå‡½æ•°<code>int myCount&lt;double&gt;(double value)</code>ï¼Œå®ƒä¹Ÿæ‹¥æœ‰è‡ªå·±ä½œç”¨èŒƒå›´çš„é™æ€å˜é‡<code>count</code>ã€‚</li></ul><p>ä¸¤ä¸ª<code>myCount</code> æ˜¯é‡è½½å‡½æ•°ï¼Œä½†å®ƒä»¬å¹¶ä¸ä¸€æ ·ï¼Œè‡ªç„¶æ— æ³•å…±äº«å„è‡ªçš„å±€éƒ¨é™æ€å˜é‡<code>count</code>ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220113000047727.png" alt="image-20220113000047727"></p><p><strong>ç±»ä¼¼çš„ç»“æœä¹Ÿå‡ºç°åœ¨æ³›å‹lambdaã€å‡½æ•°æ¨¡æ¿ä¸­</strong>ã€‚</p><p>ä¸‹é¢ä»¥æ³›å‹lambdaä¸ºä¾‹è¿›è¡Œå±•ç¤ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> myCount</span><br><span class="line">&#123;</span><br><span class="line">   [](<span class="keyword">auto</span> value)</span><br><span class="line">   &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;the type of your input:&quot;</span>&lt;&lt;<span class="built_in"><span class="keyword">typeid</span></span>(value).<span class="built_in">name</span>()&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> count++; </span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   cout&lt;&lt;<span class="built_in">myCount</span>(<span class="number">1</span>)&lt;&lt;endl;</span><br><span class="line">   cout&lt;&lt;<span class="built_in">myCount</span>(<span class="number">1.2</span>)&lt;&lt;endl;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">the type of your input:i</span><br><span class="line">1</span><br><span class="line">the type of your input:d</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç¼–è¯‘è½¬æ¢åçš„ä»£ç éªŒè¯ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220113000753408.png" alt="image-20220113000753408"></p><h4 id="3-9-3-ä½¿ç”¨æ ‡å‡†åº“å‡½æ•°">3.9.3 ä½¿ç”¨æ ‡å‡†åº“å‡½æ•°</h4><p>å’Œarrayé…åˆæ—¶ï¼Œlambdaè¡¨è¾¾å¼ä¼šæ¥å—æ•°ç»„ä¸¤ä¸ªå…ƒç´ ï¼Œå®šä¹‰å®ƒä»¬çš„æ¯”è¾ƒè§„åˆ™</p><p>lambdaè¡¨è¾¾å¼å¸¸é…åˆæ ‡å‡†åº“å‡½æ•°ä½¿ç”¨ï¼Œç®€æ´ä¼˜é›…ã€‚</p><p>ä¸‹é¢å±•ç¤ºäº†å‡ ä¸ªæ’åºç”¨ä¾‹ã€‚</p><ul><li><p><strong>ä¾‹1ï¼š<code>std::sort</code>å’Œlambdaé…åˆç”¨åœ¨<code>std::array</code>ä¸Š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span> <span class="comment">// for std::greater</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  std::array&lt;<span class="keyword">int</span>,6&gt; arr = &#123; <span class="number">13</span>, <span class="number">90</span>, <span class="number">99</span>, <span class="number">5</span>, <span class="number">40</span>, <span class="number">80</span> &#125;;</span><br><span class="line">  <span class="comment">// æ­¤æ—¶lambdaå‚æ•°æ¥å—æ•°ç»„ä¸¤ä¸ªå…ƒç´ ï¼Œè¿”å›å®ƒä»¬çš„æ¯”è¾ƒè§„åˆ™ï¼ˆboolç±»å‹ï¼‰</span></span><br><span class="line">  <span class="comment">// å¯ä»¥ç»“åˆä¹‹å‰æˆ‘ä»¬å†™çš„å†’æ³¡æ’åºè‡ªå®šä¹‰è§„åˆ™ç†è§£ï¼Œæ­¤æ—¶æ˜¯åœ¨åŒé‡forå¾ªç¯ä¸­æ¥å—æ•°ç»„ç›¸é‚»ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">  std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), [](<span class="keyword">int</span> a,<span class="keyword">int</span> b )&#123;<span class="keyword">return</span> a&gt;b;&#125;); </span><br><span class="line">    </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i : arr)</span><br><span class="line">  &#123;</span><br><span class="line">     std::cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">99 90 80 40 13 5</span><br></pre></td></tr></table></figure><p>å¯¹äºå¸¸è§çš„æ“ä½œï¼ˆä¾‹å¦‚åŠ æ³•ã€æ±‚åæˆ–æ¯”è¾ƒï¼‰ï¼Œæ ‡å‡†åº“é™„å¸¦äº†è®¸å¤šå¯ç›´æ¥ä½¿ç”¨çš„å‡½æ•°å¯¹è±¡ã€‚</p><p>æ¯”å¦‚è¿™ä¸ªä¾‹å­å¯ç”¨<code>std::greater</code>æ›¿ä»£æˆ‘ä»¬å†™çš„lambdaè¡¨è¾¾å¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), std::greater);</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¾‹2ï¼šæ’åºå¯¹è±¡æ˜¯ç»“æ„æ•°ç»„ã€ç±»æ•°ç»„ã€RDDç­‰</strong></p><p><code>struct Student</code>ç”¨æ¥å­˜å‚¨å­¦ç”Ÿå§“åå’Œåˆ†æ•°çš„ï¼Œå°†ä¸‹é¢<code>Student</code>æ•°ç»„æŒ‰æˆç»©è¿›è¡Œæ’åºã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    std::string name&#123;&#125;;</span><br><span class="line">    <span class="keyword">int</span> points&#123;&#125;;</span><br><span class="line">    <span class="comment">// éœ€è¦åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Student</span>(<span class="keyword">const</span> <span class="keyword">char</span> my_name[],<span class="keyword">const</span> <span class="keyword">int</span> my_points)  </span><br><span class="line">    &#123;</span><br><span class="line">         name = std::<span class="built_in">string</span>(my_name);</span><br><span class="line">         points = my_points;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::array&lt;Student, 8&gt; arr</span><br><span class="line">&#123;</span><br><span class="line">    &#123; </span><br><span class="line">        &#123; <span class="string">&quot;Albert&quot;</span>, <span class="number">3</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;Ben&quot;</span>, <span class="number">5</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;Christine&quot;</span>, <span class="number">2</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;Dan&quot;</span>, <span class="number">8</span> &#125;, </span><br><span class="line">        &#123; <span class="string">&quot;Enchilada&quot;</span>, <span class="number">4</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;Francis&quot;</span>, <span class="number">1</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;Greg&quot;</span>, <span class="number">3</span> &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;Hagrid&quot;</span>, <span class="number">5</span> &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®ç°æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æ˜ç¡®lambdaæ¥å—çš„å‚æ•°æ˜¯æ•°ç»„ä¸¤ä¸ªå…ƒç´ ï¼Œè¿™é‡Œå…ƒç´ æ˜¯ç»“æ„ä½“<code>Student</code>å¯¹è±¡ï¼›</li><li>å‡è®¾ä¸¤ä¸ª<code>Student</code>å¯¹è±¡åˆ†åˆ«æ˜¯stu1ã€stu2ï¼Œå®ƒä»¬æ¯”è¾ƒçš„è§„åˆ™åº”è¯¥æ˜¯ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>u</mi><mn>1.</mn><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>s</mi><mo>&gt;</mo><mi>s</mi><mi>t</mi><mi>u</mi><mn>2.</mn><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">stu1.points&gt;stu2.points</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord">1.</span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord">2.</span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span></span></span></span> ã€‚</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ’åº</span></span><br><span class="line">    std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(),arr.<span class="built_in">end</span>(),[](Student s1,Student s2)&#123;<span class="keyword">return</span> s1.points&gt;s2.points;&#125;);</span><br><span class="line">    <span class="comment">// è¾“å‡º</span></span><br><span class="line">    std::for_each(arr.<span class="built_in">begin</span>(),arr.<span class="built_in">end</span>(),[](Student s)&#123;std::cout&lt;&lt;s.name&lt;&lt;std::endl;&#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-9-4-æ•è·">3.9.4 æ•è·</h4><h5 id="ä¸ºä»€ä¹ˆéœ€è¦æ•è·">ä¸ºä»€ä¹ˆéœ€è¦æ•è·</h5><p>å‰é¢æˆ‘ä»¬è¯´è¿‡lambdaè¡¨è¾¾å¼åŸç†ï¼š</p><ol><li>æ¯å®šä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œä¼šç”Ÿæˆä¸€ä¸ªåŒ¿åç±»ï¼Œè¿™ä¸ªç±»é‡è½½äº†<code>()</code>è¿ç®—ç¬¦ï¼›</li><li>ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œå…¶å®å°±æ˜¯è¿”å›ä¸€ä¸ªé—­åŒ…ç±»å®ä¾‹ã€‚</li></ol><p>æ—¢ç„¶æ˜¯é—­åŒ…ï¼Œå½“ç„¶æ— æ³•ä½¿ç”¨å¤–éƒ¨çš„å˜é‡ï¼Œè¯·çœ‹ä¸‹ä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    []()</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;a&lt;&lt;endl;  <span class="comment">// æ— æ³•ä½¿ç”¨å¤–éƒ¨å˜é‡a</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ•è·å¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨å¤–éƒ¨å˜é‡<code>a</code>ã€‚</p><h5 id="æŒ‰å€¼æ•è·">æŒ‰å€¼æ•è·</h5><p>ä¸‹é¢å±•ç¤ºäº†æŒ‰å€¼æ•è·æ–¹å¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    [a]()</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;a&lt;&lt;endl;  </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰å€¼æ•è·åªæ˜¯å°†å˜é‡<code>a</code> å¤åˆ¶ä¸€ä»½ï¼Œè€Œä¸”ç”±äºlambdaåŒ¿åç”Ÿæˆäº†é‡è½½å‡½æ•°<code>()</code> è¢«<code>const</code>ä¿®é¥°ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨lambdaè¡¨è¾¾å¼å†…éƒ¨ä¿®æ”¹æ•°æ®æˆå‘˜<code>a</code>çš„å€¼ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220113145733566.png" alt="image-20220113145733566"></p><p>è¦æƒ³ä¿®æ”¹<code>a</code>çš„å€¼ï¼Œéœ€è¦å£°æ˜ä¸º<code>mutable</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[a]()<span class="keyword">mutable</span></span><br><span class="line">&#123;</span><br><span class="line">    cout&lt;&lt;a++&lt;&lt;endl;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é‡è½½å‡½æ•°çš„<code>const</code>å…³é”®å­—ä¸ä¼šè¢«å£°æ˜ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20220113150219048.png" alt="image-20220113150219048"></p><p>ä½†<code>mutable</code>è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¾æ—§æ— æ³•ä¿®æ”¹lambdaå¤–éƒ¨å˜é‡<code>a</code>çš„å€¼ï¼Œæ¯•ç«Ÿlambdaå†…éƒ¨å˜é‡<code>a</code>åªæ˜¯å€¼å¤åˆ¶äº†ä¸€ä»½ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> print = [a]() <span class="keyword">mutable</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;a++&lt;&lt;endl;  </span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>();</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>è¦æƒ³èƒ½ä¿®æ”¹lambdaå¤–éƒ¨çš„å˜é‡ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>å£°æ˜å¤–éƒ¨å˜é‡ä¸º<code>a</code>ä¸ºstaticï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> print = []() </span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;a++&lt;&lt;endl;  </span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>();  <span class="comment">// 1</span></span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl; <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æ­¤æ—¶ï¼Œä¸ç”¨mutableä¹Ÿå¯ä»¥æ•è·å¤–éƒ¨é™æ€å˜é‡<code>a</code>ï¼Œå› ä¸ºæ­¤æ—¶<code>a</code>å…·æœ‰å…¨å±€ç”Ÿå‘½å‘¨æœŸï¼Œå¯è¢«<strong>éšå¼æ•è·</strong>ï¼ˆä¸‹ä¸ªå°èŠ‚è¯¦ç»†åˆ—å‡ºï¼‰ã€‚</p></li><li><p>ç”¨å¼•ç”¨æ•è·çš„æ–¹å¼ã€‚</p></li></ol><h5 id="æŒ‰å¼•ç”¨æ•è·">æŒ‰å¼•ç”¨æ•è·</h5><p>å¼•ç”¨æ•è·æ–¹å¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> print = [&amp;a]() <span class="comment">// å¼•ç”¨æ•è·</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;a++&lt;&lt;endl;  </span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>();</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><p>åŸå› å¾ˆç®€å•ï¼Œä¿®æ”¹å¼•ç”¨æ—¶ä¼šé€šè¿‡é—´æ¥å¯»å€åˆ°æœ¬ä½“å¤–éƒ¨çš„å˜é‡<code>a</code>ï¼Œç„¶åè¿›è¡Œä¿®æ”¹çš„ã€‚</p><h5 id="æ··åˆæ•è·">æ··åˆæ•è·</h5><p>ä¸Šé¢çš„ä¾‹å­ï¼Œè¦ä¹ˆæ˜¯å€¼æ•è·ï¼Œè¦ä¹ˆæ˜¯å¼•ç”¨æ•è·ï¼ŒLambdaè¡¨è¾¾å¼è¿˜æ”¯æŒæ··åˆçš„æ–¹å¼æ•è·å¤–éƒ¨å˜é‡ï¼Œè¿™ç§æ–¹å¼ä¸»è¦æ˜¯ä»¥ä¸Šå‡ ç§æ•è·æ–¹å¼çš„ç»„åˆä½¿ç”¨ã€‚</p><table><thead><tr><th style="text-align:center">æ•è·å½¢å¼</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">[]</td><td style="text-align:center">ä¸æ•è·ä»»ä½•å¤–éƒ¨å˜é‡</td></tr><tr><td style="text-align:center"><strong>[å˜é‡å, â€¦]</strong></td><td style="text-align:center">é»˜è®¤ä»¥å€¼å¾—å½¢å¼æ•è·æŒ‡å®šçš„å¤šä¸ªå¤–éƒ¨å˜é‡ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼Œå¦‚æœå¼•ç”¨æ•è·ï¼Œéœ€è¦æ˜¾ç¤ºå£°æ˜ï¼ˆä½¿ç”¨&amp;è¯´æ˜ç¬¦ï¼‰</td></tr><tr><td style="text-align:center">[this]</td><td style="text-align:center">ä»¥å€¼çš„å½¢å¼æ•è·thisæŒ‡é’ˆ</td></tr><tr><td style="text-align:center">[=]</td><td style="text-align:center">ä»¥å€¼çš„å½¢å¼æ•è·<strong>æ‰€æœ‰</strong>å¤–éƒ¨å˜é‡</td></tr><tr><td style="text-align:center">[&amp;]</td><td style="text-align:center">ä»¥å¼•ç”¨å½¢å¼æ•è·<strong>æ‰€æœ‰</strong>å¤–éƒ¨å˜é‡</td></tr><tr><td style="text-align:center">[=, &amp;x]</td><td style="text-align:center">å˜é‡xä»¥å¼•ç”¨å½¢å¼æ•è·ï¼Œå…¶ä½™å˜é‡ä»¥ä¼ å€¼å½¢å¼æ•è·</td></tr><tr><td style="text-align:center">[&amp;, x]</td><td style="text-align:center">å˜é‡xä»¥å€¼çš„å½¢å¼æ•è·ï¼Œå…¶ä½™å˜é‡ä»¥å¼•ç”¨å½¢å¼æ•è·</td></tr></tbody></table><h5 id="éšå¼æ•è·">éšå¼æ•è·</h5><p>å‰é¢ä»‹ç»çš„éƒ½æ˜¯æ˜¾ç¤ºæ•è·ï¼Œåœ¨C++ä¸­ï¼Œå¦‚æœå˜é‡è¢«å£°æ˜ä¸ºstaticæˆ–è€…constï¼Œå…¶å®æ˜¯å¯ä»¥éšå¼æ•è·ä½¿ç”¨çš„ã€‚</p><p>è¯·å›ç­”ï¼šä¸‹é¢å˜é‡å“ªäº›å¯ä»¥åœ¨<code>main</code>ä¸æ˜¾å¼æ•è·å®ƒä»¬çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Ÿ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i&#123;&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> j&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> a&#123;&#125;;</span><br><span class="line">  <span class="keyword">constexpr</span> <span class="keyword">int</span> b&#123;&#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> c&#123;&#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">int</span> d&#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> e&#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> f&#123; <span class="built_in">getValue</span>() &#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> g&#123;&#125;;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> h&#123; <span class="built_in">getValue</span>() &#125;;</span><br><span class="line"></span><br><span class="line">  []()</span><br><span class="line">  &#123;</span><br><span class="line">    a;</span><br><span class="line">    b;</span><br><span class="line">    c;</span><br><span class="line">    d;</span><br><span class="line">    e;</span><br><span class="line">    f;</span><br><span class="line">    g;</span><br><span class="line">    h;</span><br><span class="line">    i;</span><br><span class="line">    j;</span><br><span class="line">  &#125;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†aã€fï¼Œå…¶ä½™éƒ½æ˜¯è¢«staticæˆ–è€…constä¿®é¥°ï¼Œå¯ä»¥éšå¼è¢«lambdaæ•è·ã€‚</p><h3 id="3-X-å†è°ˆ-auto">3.X å†è°ˆ auto</h3><p>å‰é¢æˆ‘ä»¬æˆ–å¤šæˆ–å°‘äº†ä½¿ç”¨äº†autoå…³é”®å­—ï¼Œå®ƒçš„ä½œç”¨ä¹Ÿå¾ˆæ˜æ˜¾ï¼š<strong>è‡ªåŠ¨ç±»å‹æ¨æ–­</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="built_in"><span class="keyword">typeid</span></span>(a).<span class="built_in">name</span>() <span class="comment">// i</span></span><br></pre></td></tr></table></figure><p>ä½†åƒè¿™ç§<strong>ç®€å•ç±»å‹å˜é‡å£°æ˜ä¸å»ºè®®ä½¿ç”¨autoå…³é”®å­—</strong>ï¼Œç›´æ¥å†™å‡ºå˜é‡çš„ç±»å‹æ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚</p><p>ç°åœ¨è¿›è¡Œå¸¸è§åœºæ™¯ä¸‹autoæ€»ç»“&amp;ä½¿ç”¨ã€‚</p><h4 id="autoç”¨æ³•æ€»ç»“">autoç”¨æ³•æ€»ç»“</h4><ol><li><p><strong>ä»£æ›¿å†—é•¿å¤æ‚ã€å˜é‡ä½¿ç”¨èŒƒå›´ä¸“ä¸€çš„å˜é‡å£°æ˜</strong></p><p>æ¯”å¦‚ï¼šå­˜å‚¨å‡½æ•°æŒ‡é’ˆæˆ–lambdaè¡¨è¾¾å¼ã€æ¨¡æ¿å¯¹è±¡å£°æ˜ç­‰ã€‚</p><blockquote><p>STLæ ‡å‡†åº“å°†åœ¨åç»­è¿›è¡Œæ€»ç»“ã€‚</p></blockquote><p>æƒ³è±¡ä¸€ä¸‹åœ¨æ²¡æœ‰autoçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ“ä½œæ ‡å‡†åº“æ—¶ç»å¸¸éœ€è¦è¿™æ ·ï¼ˆéš¾å—å•Šå…„å¼Ÿï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;std::string&gt; vs;</span><br><span class="line">    <span class="keyword">for</span> (std::vector&lt;std::string&gt;::iterator i = vs.<span class="built_in">begin</span>(); i != vs.<span class="built_in">end</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨autoèƒ½ç®€åŒ–ä»£ç ï¼ˆèˆ’æœäº†ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;std::string&gt; vs;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = vs.<span class="built_in">begin</span>(); i != vs.<span class="built_in">end</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå¦‚å‡½æ•°æŒ‡é’ˆå£°æ˜æ¯”è¾ƒå¤æ‚ï¼Œå­˜å‚¨æ—¶ä¸å¥½ä¹¦å†™ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in"><span class="keyword">int</span></span> (*p_func)(<span class="keyword">int</span>,<span class="keyword">int</span>) = func;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰lambdaè¡¨è¾¾å¼ï¼Œç±»ä¼¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">bool</span></span> (*myCompare)(<span class="keyword">int</span>, <span class="keyword">int</span>) = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;;</span><br></pre></td></tr></table></figure><p>autoä¼˜åŒ–åï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in"><span class="keyword">auto</span></span> (*myCompare)(<span class="keyword">int</span>, <span class="keyword">int</span>) = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;<span class="keyword">return</span> a &gt; b? <span class="literal">false</span>: <span class="literal">true</span>;&#125;;</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨å®šä¹‰æ¨¡æ¿å‡½æ•°æ—¶ï¼Œç”¨äºå£°æ˜ä¾èµ–æ¨¡æ¿å‚æ•°çš„å˜é‡ç±»å‹</strong></p><p>è‹¥ä¸ä½¿ç”¨autoå˜é‡æ¥å£°æ˜<code>v</code>ï¼Œåˆ™æ— æ³•è¿›è¡Œå®šä¹‰ï¼Œå› ä¸ºå…¶ç±»å‹æ— æ³•ç¡®å®šã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _Tx,<span class="keyword">typename</span> _Ty&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Multiply</span><span class="params">(_Tx x, _Ty y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> v = x*y;</span><br><span class="line">    std::cout &lt;&lt; v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨C++11ä¸­å¦‚æœ<code>v</code>ä½œä¸ºè¿”å›å€¼ï¼Œè¿˜éœ€è¦åœ¨å°¾éƒ¨æŒ‡å®šè¿”å›ç±»å‹ï¼ˆå¦åˆ™ä¼šå‘å‡ºè­¦å‘Šï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> _Tx, <span class="keyword">typename</span> _Ty&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">multiply</span><span class="params">(_Tx x, _Ty y)</span>-&gt;<span class="title">decltype</span><span class="params">(x*y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x*y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>decltypeç”¨äºè®¡ç®—å‡ºè¡¨è¾¾å¼<code>x*y</code>çš„ç±»å‹ã€‚</p></li></ol><h4 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h4><ol><li><p><strong>autoå…³é”®å­—å¿…é¡»åˆå§‹åŒ–</strong></p><p>éœ€è¦åœ¨å£°æ˜æ—¶autoå°±å¯ä»¥æ¨æ–­å‡ºå˜é‡ç±»å‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> a = <span class="number">10</span>; <span class="comment">// ok</span></span><br><span class="line"><span class="keyword">auto</span> b;  <span class="comment">// error</span></span><br></pre></td></tr></table></figure></li><li><p><strong>autoä¼šè‡ªåŠ¨å»é™¤å³å€¼çš„å¼•ç”¨ã€constè¯­ä¹‰ï¼Œéœ€è¦æ˜¾ç¤ºå£°æ˜</strong></p><p>å³å€¼å¼•ç”¨è¯­ä¹‰è¢«å»é™¤ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>&amp; b = a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> c = b; <span class="comment">// æ­¤æ—¶cçš„ç±»å‹æ˜¯intä¸æ˜¯int&amp;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ˜¾ç¤ºå£°æ˜ä¸ºå¼•ç”¨ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span>&amp; c = b; <span class="comment">// æ­¤æ—¶cçš„ç±»å‹æ‰æ˜¯int&amp;</span></span><br></pre></td></tr></table></figure><p>autoè¿˜ä¼šå»é™¤constè¯­ä¹‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> b = a; <span class="comment">// æ­¤æ—¶bä¸ºintç±»å‹ï¼Œè€Œä¸æ˜¯const int</span></span><br><span class="line">b = <span class="number">100</span>;  <span class="comment">// bå¯ä»¥è¢«ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ˜¾ç¤ºå£°æ˜ä¸ºconstå¸¸é‡ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">auto</span> b = a;</span><br><span class="line">b = <span class="number">100</span>; <span class="comment">// éæ³•ï¼Œæ— æ³•è¢«ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><blockquote><p>æœ‰ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼šå¦‚æœauto&amp; è¿˜ä¼šå»é™¤constè¯­ä¹‰å—ï¼Ÿç†è®ºä¸Šæ¥è¯´ï¼Œæ­¤æ—¶å¼•ç”¨æ˜¯æŸç§æ„ä¹‰ä¸Šç­‰ä»·æœ¬ä½“çš„ï¼Œè‡ªç„¶ç±»å‹ä¹Ÿåº”è¯¥æ˜¯ä¸€è‡´çš„ã€‚</p></blockquote><p>ç­”æ¡ˆæ˜¯ä¸ä¼šçš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span>&amp; b = a; <span class="comment">// æ­¤æ—¶bä¸ºconst intï¼Œconstè¯­ä¹‰æœªè¢«å»é™¤</span></span><br><span class="line">b = <span class="number">100</span>;     <span class="comment">// éæ³•</span></span><br></pre></td></tr></table></figure></li><li><p><strong>autoå…³é”®å­—ä¸å»é™¤æŒ‡é’ˆçš„è¯­ä¹‰</strong></p><p>è¯·çœ‹ä¸‹ä¾‹ï¼Œautoæ­£ç¡®æ¨å¯¼é™¤äº†å˜é‡çš„ç±»å‹ä¸ºæŒ‡é’ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">auto</span> b = &amp;a;  <span class="comment">// bæ˜¯int*ç±»å‹</span></span><br><span class="line">    </span><br><span class="line">    cout&lt;&lt;*b&lt;&lt;endl; <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>autoä¸èƒ½ä½œä¸ºå‡½æ•°å½¢å‚</strong></p><p>è¿™æ ·åšçš„è¯ï¼Œå£°æ˜çš„å‡½æ•°å®é™…ä¸Šå°±æ˜¯ä¸ªå‡½æ•°æ¨¡æ¿äº†ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">func</span><span class="params">(<span class="keyword">auto</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¿™ç§åšæ³•åœ¨C++20ä¸­å·²è¢«æ”¯æŒã€‚</p></li></ol><h2 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h2><div class="timeline"><div class="timenode"><div class="meta"><p><p>2021-01-16 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>ç¬¬ä¸€æ¬¡æ›´æ–°</li></ol></div></div></div><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ä¸­å¼•ç”¨ä¼ é€’ä¸æŒ‡é’ˆä¼ é€’çš„åŒºåˆ«ï¼šhttps://blog.csdn.net/u013130743/article/details/80806179<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C/C++ ç¨‹åºçš„å†…å­˜å¸ƒå±€ï¼šhttps://blog.csdn.net/m0_45047300/article/details/118389444<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">å†…å­˜åˆ†é…çš„åŸç†--molloc/brk/mmapï¼šhttp://abcdxyzk.github.io/blog/2015/08/05/kernel-mm-malloc/<a href="#fnref:3" rev="footnote"> â†©</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ lambdaè¡¨è¾¾å¼ä¸å‡½æ•°å¯¹è±¡ï¼šhttps://www.jianshu.com/p/d686ad9de817<a href="#fnref:4" rev="footnote"> â†©</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++ auto å…³é”®å­—çš„ä½¿ç”¨ï¼šhttps://cloud.tencent.com/developer/article/1660750<a href="#fnref:5" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++åŸºç¡€ </tag>
            
            <tag> å‡½æ•° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºï¼ˆä¸Šï¼‰VSCodeè¿œç¨‹å¼€å‘</title>
      <link href="/p/18652/"/>
      <url>/p/18652/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><p>å®ä¹ çš„æ—¶å€™ï¼Œå…¬å¸ä¼šç»™æ¯ä¸ªäººé…ç½®ä¸€å°è¿œç¨‹æœåŠ¡å™¨ï¼Œç”¨äºæ—¥å¸¸å¼€å‘ã€‚ä½“éªŒä¸‹æ¥æ„Ÿè§‰å¾ˆä¸é”™çš„ï¼š</p><ul><li>æ‰€æœ‰çš„å¼€å‘ä»£ç ã€ç¯å¢ƒå‡è¿è¡Œåœ¨äº‘ç«¯ï¼Œä»»ä½•ä¸€å°æœºå™¨å¯ç›´è¿å¿«é€Ÿå¼€å‘ï¼Œ<strong>æœ¬åœ°æ— éœ€ä»»ä½•éƒ¨ç½²ç¯å¢ƒæˆ–è€…ä»£ç </strong>ç­‰ï¼›</li><li>å®é™…C/C++å¼€å‘å¤§éƒ¨åˆ†ä¹Ÿæ˜¯åœ¨<strong>Linux</strong>ç¯å¢ƒä¸Šå®Œæˆçš„ï¼Œæ‹¥æœ‰ä¸€å°è‡ªå·±çš„ï¼ˆäº‘ï¼‰Linuxå¼€å‘æœºè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼ˆ<strong>çœå»äº†Winä¸Šå¼€å‘å„ç§æ€ªé—®é¢˜</strong>ï¼‰ã€‚</li></ul><p>å› æ­¤ï¼Œåœ¨è¿™ä¸ªC++ç³»åˆ—ä¸­ï¼Œæ‰€æœ‰çš„ä»£ç ä¹Ÿå°†ä»¥ï¼šæœ¬åœ°ï¼ˆWinï¼‰+è¿œç¨‹ï¼ˆLinuxï¼‰å½¢å¼è¿›è¡Œå¼€å‘ã€‚</p><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå¼€å§‹å§ã€‚</p><h3 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h3><blockquote><p>æœ¬æ–‡å¼€å‘ç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li>æœ¬åœ°ï¼šWin10 + VSCode</li><li>è¿œç¨‹ï¼šCentOS 7 ï¼ˆè…¾è®¯äº‘ï¼‰</li></ul></blockquote><h4 id="äº‘ä¸Šå¼€å‘">äº‘ä¸Šå¼€å‘</h4><p>è…¾è®¯äº‘/é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ½æœ‰å­¦ç”Ÿä¼˜æƒ â‰ˆ10å…ƒ/æœˆï¼Œä»¥ä¸‹æ˜¯æ’¸ç¾Šæ¯›è¯¦ç»†è¿‡ç¨‹ã€‚</p><ol><li><p>è¿›å…¥å­¦ç”Ÿä¼˜æƒ è´­ä¹°ç•Œé¢ï¼Œä»¥è…¾è®¯äº‘ä¸ºä¾‹ï¼š<a href="https://cloud.tencent.com/act/campus">è…¾è®¯äº‘å­¦ç”Ÿä¼˜æƒ </a></p><p>åœ°åŒºå¯é€‰ <code>ä¸Šæµ·ä¸‰åŒº</code> &amp; <code>å¹¿å·å››åŒº</code>ç­‰ï¼Œå¹¿å·ç¦»é‡åº†æ›´è¿‘ä¸€ç‚¹æ‰€ä»¥é€‰æ‹© <code>å¹¿å·å››åŒº</code> ã€‚</p><p>é€‰æ‹©æ“ä½œç³»ç»Ÿä¸ºï¼š<code>CentOS 7.6.64</code></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/qiJSVvHcUyPTGOr.png" alt="1579750584238"></p></li><li><p>ä»˜è´¹&amp;è®¾ç½®å¯†ç </p><p>ç‚¹å‡»ç«‹å³è´­ä¹°åï¼Œ<strong>è®°å¾—è®¾ç½®å¥½ç›¸åº”rootå¯†ç </strong>ã€‚</p><p>ç°åœ¨ä½ å¯ä»¥å³ä¸Šè§’ç‚¹å‡»ï¼šæ§åˆ¶å°â€“&gt;äº‘æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹ä½ è´­ä¹°çš„äº‘æœåŠ¡å™¨ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/s7R9KFTe1oaYIcC.png" alt="1579755304749"></p><p>ä½ åº”è¯¥çœ‹åˆ°ä¸Šå›¾ç±»ä¼¼ç•Œé¢ã€‚çº¢æ¡†éƒ¨åˆ†æ˜¯å¯¹åº” <strong>å†…ç½‘&amp;å…¬ç½‘IP</strong>ï¼Œè®°å½•ä¸‹æ¥åé¢å¤šæ¬¡è¦ç”¨åˆ°ã€‚</p></li></ol><h4 id="æœ¬åœ°é…ç½®">æœ¬åœ°é…ç½®</h4><ol><li><p>é…ç½®SSH</p><p>Win10é»˜è®¤è‡ªå¸¦å®‰è£…OpenSSHï¼Œä¸‹é¢æˆ‘ä»¬ç›´æ¥è¿›å…¥åˆ°ç¯å¢ƒå˜é‡é…ç½®ç¯èŠ‚ã€‚</p><ul><li><p>ç”¨<a href="https://www.voidtools.com/zh-cn/">everything</a>è¿›è¡Œæœç´¢<code>ssh.exe</code> ï¼Œå¹¶è®°å½•OpenSSHæ–‡ä»¶å¤¹è·¯å¾„ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206162135005.png" alt="image-20211206162135005"></p></li><li><p>win10æœç´¢ç¯å¢ƒå˜é‡â€”&gt;ç¼–è¾‘ç³»ç»Ÿç¯å¢ƒå˜é‡â€”&gt;ç¯å¢ƒå˜é‡ï¼Œæ‰¾åˆ°ç³»ç»Ÿå˜é‡(S)â€”&gt;é€‰æ‹©Pathâ€”&gt;ç¼–è¾‘ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206162428787.png" alt="image-20211206162428787"></p></li><li><p>é€‰æ‹©ï¼šæ–°å»ºâ€“&gt;è¾“å…¥OpenSSHè·¯å¾„</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206162532446.png" alt="image-20211206162532446"></p><p>ä¿å­˜åé€€å‡ºã€‚</p></li><li><p>æµ‹è¯•ï¼šæ‰“å¼€CMDï¼Œè¾“å…¥<code>ssh</code> ï¼Œå‡ºç°å¦‚ä¸‹åˆ™ç¯å¢ƒå˜é‡é…ç½®æˆåŠŸï¼ˆè¢«ç³»ç»ŸæˆåŠŸè¯†åˆ«ï¼‰ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206162726410.png" alt="image-20211206162726410"></p></li></ul></li><li><p>å®‰è£…ç›¸å…³æ’ä»¶</p><ul><li><p>å®‰è£…Remote-SSHï¼šå·¦ä¾§Extensionå›¾æ ‡ â€”&gt; è¾“å…¥ <code>Remote-SSH</code> â€”&gt;å®‰è£…å³å¯ã€‚æ³¨æ„ï¼Œéœ€è¦<strong>è¿œç¨‹å’Œæœ¬åœ°éƒ½è¿›è¡Œå®‰è£…</strong>ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206163014391.png" alt="image-20211206163014391"></p></li><li><p>å®‰è£…C/C++æ’ä»¶ï¼šåŒä¸Šå®‰è£…ä¸å†èµ˜è¿°ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206163953436.png" alt="image-20211206163953436"></p></li></ul></li><li><p>é…ç½®Remote-SSH</p><p>å¦‚å›¾æ‰€ç¤ºé€‰æ‹©<code>.ssh/config</code> æ–‡ä»¶è¿›è¡Œé…ç½®ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206163445062.png" alt="image-20211206163445062"></p><p>æ‰“å¼€æ–‡ä»¶åï¼Œéœ€è¦è®¾ç½®ä»¥ä¸‹å­—æ®µï¼š</p><ul><li>Hostï¼šè‡ªå®šä¹‰å³å¯</li><li>HostNameï¼šäº‘ä¸»æœºå…¬ç½‘IP</li><li>Userï¼šç™»é™†çš„ç”¨æˆ·</li></ul><p>ä»¥ä¸‹ä¸ºç¤ºä¾‹ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206163758522.png" alt="image-20211206163758522"></p></li><li><p>ç™»é™†æµ‹è¯•</p><p>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®è¿›è¡Œç™»é™†ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206164334870.png" alt="image-20211206164334870"></p><p>è¾“å…¥å¯†ç åï¼Œä¾¿å¯ä»¥çœ‹åˆ°è¿œç¨‹æœåŠ¡å™¨å·²ç»æˆåŠŸè¿æ¥ã€‚</p></li><li><p>hello cpp!</p><p>ç°åœ¨æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªç®€å•çš„cppæ–‡ä»¶ï¼Œä½“éªŒè¿œç¨‹ç¼–ç çš„å¿«æ„Ÿã€‚</p><ul><li><p>æ‰“å¼€è¿œç¨‹æœåŠ¡å™¨æ–‡ä»¶å¤¹</p><p>Fileâ€”&gt;Open Folderâ€”&gt;æŒ‡å®šæ–‡ä»¶å¤¹è·¯å¾„ã€‚</p></li><li><p>hello.cppæ–‡ä»¶ç¼–å†™</p><p>æ–°å»ºæ–‡ä»¶hello.cppâ€“&gt;ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;Hello Cpp!&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘è¾“å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -g hello.cpp -o hello.out </span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæˆ‘ä»¬åˆšåˆšç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š<code>hello.out</code></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206165317305.png" alt="image-20211206165317305"></p></li></ul></li></ol><p>è‡³æ­¤ï¼Œé¡ºåˆ©å®Œæˆäº†åˆæ­¥çš„è¿œç¨‹å¼€å‘ç¯å¢ƒé…ç½®ã€‚</p><p>æˆ–è®¸èªæ˜çš„ä½ å·²ç»æƒ³åˆ°ï¼š<strong>è¿œç¨‹å¼€å‘æ€ä¹ˆåœ¨æœ¬åœ°è¿›è¡Œdebugå‘¢ï¼Ÿ</strong></p><h3 id="è¿œç¨‹Debug">è¿œç¨‹Debug</h3><p>VSCodeä¸­è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œé€šå¸¸éœ€é…ç½®ä»¥ä¸‹æ–‡ä»¶<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="vscodeä¸­c++çš„ä¸‰ä¸ªé…ç½®æ–‡ä»¶çš„ä½œç”¨ï¼šhttps://blog.csdn.net/zhxue_11/article/details/89457545 ">[1]</span></a></sup>ï¼š</p><ol><li><code>launch.json</code>ï¼šæœ€é‡è¦çš„æ–‡ä»¶ï¼Œé…ç½®<strong>è°ƒè¯•å™¨</strong>ä¸<strong>éœ€è¦è°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶</strong>è¿›è¡Œè°ƒè¯•ï¼›</li><li><code>c_cpp_properties.json</code>ï¼š cä¸cppé€‰é¡¹ï¼Œå®é™…å¼€å‘ä¸»è¦ä½œç”¨æ˜¯ï¼Œ<strong>è§£å†³ç³»ç»Ÿç¯å¢ƒçš„å¤´æ–‡ä»¶æ‰¾ä¸åˆ°</strong>çš„æƒ…å†µï¼›</li><li><code>setting.json</code> ï¼šå¯ä»¥å¯¹VS Codeè¿›è¡Œé¡µé¢é£æ ¼ã€ä»£ç æ ¼å¼ã€å­—ä½“é¢œè‰²å¤§å°ç­‰çš„ç¼–è¾‘è®¾ç½®ï¼Œè¿™é‡Œåªç”¨æ¥<strong>å°†å…¶å®ƒè¯­è¨€è¯†åˆ«ä¸ºcpp</strong>ï¼›<ul><li>æ›´å¤šä½œç”¨å¯å‚è€ƒï¼š<a href="https://www.zhihu.com/question/366164002">settings.jsonæ˜¯ä»€ä¹ˆ?å¯¹VS Codeæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a></li></ul></li><li><code>tasks.json</code>ï¼šé€šå¸¸ç”¨æ¥æ‰§è¡Œ<strong>æ¯”è¾ƒç®€å•çš„ç¼–è¯‘æŒ‡ä»¤</strong>ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ç”¨ï¼Œä¸è¿›è¡Œè¿‡å¤šä»‹ç»ã€‚</li></ol><p>ä¸‹é¢æ­£å¼è¿›è¡Œç›¸å…³é…ç½®ä»‹ç»<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="vscode C++è¿œç¨‹è°ƒè¯•è¿è¡Œï¼šhttps://zhuanlan.zhihu.com/p/104131448">[2]</span></a></sup>ã€‚</p><blockquote><p>âš ï¸ ä»¥ä¸‹è¿‡ç¨‹æ‰§è¡Œå‰æï¼š</p><ol><li>ä½ å·²ç»æ ¹æ®å‰é¢æ­¥éª¤ï¼ŒæˆåŠŸç¼–è¯‘ç”Ÿæˆäº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚ï¼š<code>hello.out</code> ï¼›</li><li>ç¼–è¯‘ç”Ÿæˆçš„æ‰§è¡Œæ–‡ä»¶<strong>å¯ä»¥è¢«Debug</strong>ï¼Œe.g.ï¼Œg++å¸¦ä¸Š<code>-g</code>å‚æ•°ã€‚</li></ol></blockquote><h4 id="launch-json">launch.json</h4><p>èœå•æ ä¾æ¬¡é€‰æ‹©ï¼šDebug â€”&gt; Add Configurationâ€”&gt; é€‰æ‹©C++ (GDB/LLDB) â€”&gt; é€‰æ‹©g++ build and debug active fileã€‚</p><blockquote><p>å¦‚æœä»¥ä¸Šåˆ›å»ºè¿‡ç¨‹æŠ¥é”™ï¼š<strong>VScodeæ‰¾ä¸åˆ°ä»»åŠ¡c/c++ï¼šg++.exeç”Ÿæˆæ´»åŠ¨æ–‡ä»¶</strong> ã€‚</p><ul><li>éœ€è¦ä½ <strong>å…ˆæ‰“å¼€ä¸€ä¸ªcppæ–‡ä»¶</strong>ï¼Œå†æ‰§è¡Œä¸Šé¢æ­¥éª¤ã€‚</li></ul></blockquote><p>VSCode<strong>ä¼šæ ¹æ®ä½ çš„æœºå™¨ç¯å¢ƒ</strong>ï¼Œè‡ªåŠ¨åˆ›å»º<code>launch.json</code> ã€‚æ­£å¦‚å‰æ‰€è¨€è¯¥æ–‡ä»¶çš„ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š</p><ul><li><p><strong>é…ç½®è°ƒè¯•å™¨ä¿¡æ¯</strong>ï¼šåˆ›å»ºæ–‡ä»¶æ—¶ç³»ç»Ÿè‡ªåŠ¨é…ç½®å¥½äº†ï¼Œæ‰€ä»¥ä¸ç”¨ç®¡ï¼›</p></li><li><p><strong>é…ç½®å¯æ‰§è¡Œæ–‡ä»¶</strong>ï¼šä¹Ÿå°±æ˜¯æˆ‘ä»¬<strong>ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„</strong></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206173236205.png" alt="image-20211206173236205"></p><p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºå¯æ‰§è¡Œæ–‡ä»¶<strong>è®¾ç½®å‚æ•°</strong>ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š<br><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206173526162.png" alt="image-20211206173526162" style="zoom:67%;" /></p></li><li><p><strong>æ³¨é‡Šå¤šä½™å‚æ•°</strong>ï¼š<code>preLaunchTask</code>ï¼ˆè°ƒè¯•ä¼šè¯å¼€å§‹å‰æ‰§è¡Œçš„ä»»åŠ¡ï¼‰ï¼Œä¸éœ€è¦ã€‚</p></li></ul><p>æœ€ç»ˆå®Œæ•´çš„é…ç½®ç¤ºä¾‹æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;(gdb) Launch&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;cppdbg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">            <span class="comment">// å°†è¦è¿›è¡Œè°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/bin/hello.out&quot;</span>,   </span><br><span class="line">            <span class="comment">// è°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶å‚æ•°</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span>: <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;environment&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span>: <span class="string">&quot;gdb&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Enable pretty-printing for gdb&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;-enable-pretty-printing&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="comment">// &quot;miDebuggerPath&quot;: &quot;/usr/bin/gdb&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="c-cpp-properties-json">c_cpp_properties.json</h4><p>VSCodeå¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸å®¹æ˜“å‡ºç°ï¼š<strong>æ˜æ˜è·¯å¾„æ­£ç¡®å¼•ç”¨å…¶å®ƒå¤´æ–‡ä»¶ï¼Œä½†VSCodeå°±æ˜¯ä¸€ç›´æç¤ºæ— æ³•æ‰¾åˆ°</strong>ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæä¾›äº†<code>includePath</code>å‚æ•°ï¼Œè®©ç¼–è¯‘å™¨é¡ºåˆ©æ‰¾åˆ°å…¶å®ƒè·¯å¾„çš„æ–‡ä»¶ã€‚</p><p>åœ¨èœå•æ ä¸­ï¼šF1â€”&gt;é€‰æ‹©C/Cpp: Edit configurationsï¼Œè®©VSCodeæ ¹æ®å®é™…ç¯å¢ƒè‡ªåŠ¨ç”Ÿæˆc_cpp_properties.jsonã€‚</p><p>ä»¥ä¸‹ç»™å‡ºç¤ºä¾‹é…ç½®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Linux&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;/**&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;defines&quot;</span>: [],</span><br><span class="line">            <span class="attr">&quot;compilerPath&quot;</span>: <span class="string">&quot;/usr/bin/gcc&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cStandard&quot;</span>: <span class="string">&quot;gnu11&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cppStandard&quot;</span>: <span class="string">&quot;gnu++11&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;intelliSenseMode&quot;</span>: <span class="string">&quot;linux-gcc-x64&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="setting-json">setting.json</h4><p>è¿™é‡Œåªç”¨æ¥ï¼Œå°†å…¶å®ƒè¯­è¨€è¯†åˆ«ä¸ºCPPï¼Œä¸å¤ªé‡è¦ã€‚æŒ‰ä»¥ä¸‹é…ç½®å¥½äº†å°±è¡Œã€‚</p><p>åœ¨èœå•æ ä¸­ï¼šF1â€”&gt;è¾“å…¥ â€œOpen Settingsâ€â€”&gt; é€‰æ‹© â€œPreferences: Open Settings (JSON)â€ ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚</p><p>ç¼–è¾‘ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;files.associations&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;*.tcc&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cctype&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;clocale&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cstdarg&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cstdint&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cstdio&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cstdlib&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cwchar&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cwctype&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;exception&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;initializer_list&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;iosfwd&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;iostream&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;istream&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;limits&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;new&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;ostream&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;streambuf&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;type_traits&quot;</span>: <span class="string">&quot;cpp&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;typeinfo&quot;</span>: <span class="string">&quot;cpp&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;C_Cpp.errorSquiggles&quot;</span>: <span class="string">&quot;Enabled&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•">æµ‹è¯•</h4><p>ç°åœ¨è®©æˆ‘ä»¬æ³¢æ¾œä¸æƒŠçš„åœ¨<code>hello.cpp</code> ï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼ŒæŒ‰ä¸Š<code>F5</code> è¿›è¡Œè°ƒè¯•ã€‚</p><p>å‘ç°å¯ä»¥é¡ºåˆ©è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œè·¨è¶Šäº†ä½ ç¦»æŠ€æœ¯ä¸“å®¶çš„ä¸€å°æ­¥ ğŸ˜ƒ ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206180754574.png" alt="image-20211206180754574"></p><h3 id="ä½“éªŒä¼˜åŒ–">ä½“éªŒä¼˜åŒ–</h3><h4 id="å…å¯†ç™»é™†">å…å¯†ç™»é™†</h4><p>æ¯æ¬¡è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨è¦è¾“å…¥å¯†ç ï¼Œå®åœ¨è®©æš´èºå¼€å‘çš„æˆ‘éš¾ä»¥å¿å—ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥é…ç½®å…å¯†ç™»é™†ï¼Œå‡å°‘æœåŠ¡å™¨è¢«æˆ‘å†æ¬¡remakeçš„é£é™©ã€‚</p><ol><li><p><strong>æœ¬åœ°</strong>ç”Ÿæˆå¯†é’¥å¯¹</p><p>æ‰“å¼€cmd â€”&gt; è¾“å…¥ <code>ssh-keygen -t  rsa</code> ç”Ÿæˆå¯†é’¥å¯¹ã€‚</p><ul><li>åœ¨è¯¥è¿‡ç¨‹ä¼šæœ‰ä¸‰ä¸ªç³»ç»Ÿæç¤ºï¼Œä¸€ç›´å›è½¦å³å¯ï¼›</li><li>è¯¥è¿‡ç¨‹ä¼šæ˜¾ç¤º<strong>å¯†é’¥ä¿å­˜è·¯å¾„</strong>ï¼Œè®°å½•ä¸‹æ¥ã€‚</li></ul><p>æ‰“å¼€å¯†é’¥ä¿å­˜è·¯å¾„â€”&gt;æ‰“å¼€<code>id_rsa.pub</code> æ–‡ä»¶ï¼Œå¹¶<strong>å¤åˆ¶å…¶å…¨éƒ¨å†…å®¹</strong>ã€‚</p></li><li><p><strong>è¿œç¨‹</strong>å¯†é’¥é…ç½®</p><p>åœ¨VSCodeæ‰“å¼€è¿œç¨‹æœåŠ¡å™¨ç»ˆç«¯ï¼Œè¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>æŒ‰ä¸‹ <code>i</code> è¿›å…¥æ’å…¥æ¨¡å¼ â€”&gt; ç²˜è´´åˆšåˆšå¤åˆ¶çš„å¯†é’¥â€”&gt;æŒ‰ä¸‹<code>:</code>ï¼Œè¾“å…¥<code>wq!</code> è¿›è¡Œä¿å­˜ã€‚</p></li><li><p>ç™»é™†æµ‹è¯•</p><p>ç°åœ¨ä½ å¯ä»¥é‡æ–°ç™»é™†è¿œç¨‹æœåŠ¡å™¨ï¼Œå‘ç°å¯ä»¥æ„‰å¿«çš„å…å¯†ç™»é™†äº†ã€‚</p><ul><li>å¦‚æœä¾æ—§ä¸è¡Œï¼Œå»ºè®®åœ¨ç¬¬ä¸€æ­¥ç”Ÿæˆå¯†é’¥å¯¹æ—¶ï¼Œ<strong>é€‰æ‹©è¦†ç›–ä¹‹å‰å¯†é’¥</strong>ã€‚</li></ul></li></ol><h4 id="æ–‡ä»¶åŒæ­¥">æ–‡ä»¶åŒæ­¥</h4><p>å·¥ä½œä¸­ç»å¸¸éœ€è¦<strong>åŒæ­¥æœ¬åœ°å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ–‡ä»¶</strong>ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li><code>FileZilla</code>è½¯ä»¶åŒæ­¥ ï¼›</li><li>VSCode ä¸­<code>STFP</code>æ’ä»¶åŒæ­¥ï¼›</li><li>å‘½ä»¤è¡Œ<code>SCP</code>å‘½ä»¤åŒæ­¥ã€‚</li></ol><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»1ã€2ä¸¤ç§æ–¹å¼ã€‚</p><div class="tabs" id="æ–‡ä»¶åŒæ­¥æ–¹å¼"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#æ–‡ä»¶åŒæ­¥æ–¹å¼-1">STFPæ’ä»¶</button></li><li class="tab"><button type="button" data-href="#æ–‡ä»¶åŒæ­¥æ–¹å¼-2">FileZilla</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="æ–‡ä»¶åŒæ­¥æ–¹å¼-1"><p>å› ä¸ºæœ¬æ–‡ä¸»è¦æ˜¯åŸºäºVSCodeå¼€å‘ï¼Œæ‰€ä»¥ä»‹ç»ä¸€ä¸‹ä½¿ç”¨VSCodeç›¸å…³æ’ä»¶è¿›è¡ŒåŒæ­¥<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="vscodeä½¿ç”¨sftpå¿«é€ŸåŒæ­¥æœåŠ¡å™¨æ–‡ä»¶ï¼šhttps://blog.csdn.net/qq_24798295/article/details/90228795">[3]</span></a></sup>ã€‚</p><ol><li><p>å®‰è£…SFTPæ’ä»¶</p><p>å·¦ä¾§Extensionå›¾æ ‡ â€”&gt; è¾“å…¥ <code>STFP</code> â€”&gt;å®‰è£…å³å¯ã€‚æ³¨æ„ï¼Œéœ€è¦<strong>è¿œç¨‹å’Œæœ¬åœ°éƒ½è¿›è¡Œå®‰è£…</strong>ã€‚</p></li><li><p>å·¥ä½œåŒºï¼šå‡†å¤‡</p><p>åœ¨<strong>æœ¬åœ°</strong>è·¯å¾„ä¸‹ï¼šåˆ›å»ºæ–°æ–‡ä»¶å¤¹â€”&gt;ä½¿ç”¨VSCodeæ‰“å¼€ï¼Œæ–‡ä»¶å¤¹è¢«è‡ªåŠ¨åŠ å…¥åˆ°å·¥ä½œåŒºä¸­ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206154403565.png" alt="image-20211206154403565"></p></li><li><p>é…ç½®<code>sftp.json</code></p><p>åœ¨ï¼šF1â€”&gt; è¾“å…¥SFTP â€”&gt;é€‰æ‹© SFTP: config ï¼Œè¿›è¡Œæ–‡ä»¶é…ç½®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;roy-cpp&quot;</span>, <span class="comment">// éšæ„</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;119.111.111.111&quot;</span>, <span class="comment">// ä½ çš„äº‘ä¸»æœºå…¬ç½‘IP</span></span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;sftp&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;port&quot;</span>: <span class="number">22</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,  <span class="comment">// ç™»é™†ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">&quot;remotePath&quot;</span>: <span class="string">&quot;/home/royhuang/syn&quot;</span>, <span class="comment">// éšæ„ï¼Œä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">    <span class="attr">&quot;uploadOnSave&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šæœ¬åœ°åŒæ­¥æ–‡ä»¶å¤¹</p><p>åœ¨ï¼šF1â€”&gt;è¾“å…¥SFTP â€”&gt;é€‰æ‹©SFTP: Sync Local -&gt; Remote ï¼Œå°†ä¼šæ˜¾ç¤ºæœ¬åœ°å·¥ä½œåŒºçš„æ–‡ä»¶å¤¹ã€‚</p><p>é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä½œä¸ºæˆ‘ä»¬åŒæ­¥åˆ°è¿œç«¯çš„æœ¬åœ°è·¯å¾„ï¼ˆè¾“å…¥ç™»é™†ç”¨æˆ·å¯†ç åç¡®å®šï¼‰ã€‚</p><p>åŒæ­¥è®¾ç½®å®Œæˆåï¼Œåœ¨VSCodeåº•éƒ¨ä¼šæ˜¾ç¤ºSFTPæ ‡è¯†ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211206160159444.png" alt="image-20211206160159444"></p></li><li><p>ï¼ˆå¯é€‰ï¼‰BUGè§£å†³ï¼šNo Such File</p><p>è¿™æ˜¯SFTPçš„ä¸€ä¸ªBugï¼Œå‚è€ƒ<a href="https://stackoverflow.com/questions/67506693/error-no-such-file-sftp-liximomo-extension">stackoverflow</a>è¿›è¡Œè§£å†³ã€‚</p><ul><li><p>æ‰¾åˆ°<code>sftp.js</code>ï¼ˆWinä¸‹å¯ç”¨<a href="https://www.voidtools.com/zh-cn/">everything</a>è¿›è¡Œæœç´¢ï¼‰ï¼Œé€šå¸¸æ˜¯åœ¨ä»¥ä¸‹è·¯å¾„ï¼š<code>C:\Users\account_name\.vscode\extensions\liximomo.sftp-1.12.9\node_modules\ssh2-streams\lib\sftp.js</code></p></li><li><p>ä¿®æ”¹ç¬¬388è¡Œï¼Œå°† ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( code === STATUS_CODE . OK ) &#123;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢ä¸ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (code === STATUS_CODE.OK || code === STATUS_CODE.NO_SUCH_FILE) &#123;</span><br></pre></td></tr></table></figure></li><li><p>ä¿å­˜æ–‡ä»¶åï¼Œé‡å¯VSCodeä¸€èˆ¬å¯è§£å†³ã€‚</p></li></ul></li><li><p>æµ‹è¯•</p><ul><li><p>æœ¬åœ°</p><ol><li>å‡†å¤‡æµ‹è¯•æ–‡ä»¶ï¼Œæ”¾å…¥ä¹‹å‰è®¾ç½®çš„<strong>æœ¬åœ°åŒæ­¥æ–‡ä»¶å¤¹</strong>ä¸­</li><li>ç”¨VSCodeæ‰“å¼€è¯¥åŒæ­¥æ–‡ä»¶å¤¹ï¼šé€‰æ‹©æµ‹è¯•æ–‡ä»¶â€“&gt;å³å‡»â€“&gt;é€‰æ‹©<strong>åº•éƒ¨Upload</strong> ä¸Šä¼ </li></ol></li><li><p>è¿œç¨‹æœåŠ¡å™¨</p><ol><li>VSCodeæ‰“å¼€<strong>è¿œç¨‹æœåŠ¡å™¨åŒæ­¥æ–‡ä»¶å¤¹</strong> ï¼Œå‘ç°æ–‡ä»¶å·²ç»è¢«é¡ºåˆ©ä¸Šä¼ </li><li>å½“ç„¶è¿œç¨‹æ–‡ä»¶ä¹Ÿå¯åŒæ­¥åˆ°æœ¬åœ°ï¼šé€‰æ‹©æµ‹è¯•æ–‡ä»¶â€“&gt;å³å‡»â€“&gt;é€‰æ‹©<strong>åº•éƒ¨DownLoad</strong>ä¸‹è½½å³å¯ã€‚</li></ol></li></ul><p>å°½æƒ…æ„‰å¿«ç©è€å§ï¼</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="æ–‡ä»¶åŒæ­¥æ–¹å¼-2"><blockquote><p>è¿™é‡Œå¼•ç”¨<a href="https://github.com/Wanghui-Huang/CQU_bigdata/blob/master/Experiment/Ex2_WordCount/ex2.md">ä¹‹é—´å†™çš„æ•™ç¨‹</a> ï¼Œæ–‡ä»¶è·¯å¾„å¯èƒ½æœ‰ç‚¹å¥‡æ€ªï¼Œä½†ä¸å½±å“é˜…è¯»ã€‚</p></blockquote><p>è¯¥å°èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨FTPè½¯ä»¶å°†æœ¬åœ°ï¼ˆWindowsï¼‰æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨(Linux)ã€‚</p><ol><li><p>ä¸‹è½½è½¯ä»¶</p><p>FTPå·¥å…·æˆ‘ä»¬é€‰æ‹©<code>Filezilla</code> ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://pc.qq.com/search.html#!keyword=fielzilla">Filezillaä¸‹è½½</a></p><p><img src="https://i.loli.net/2020/09/17/RLvUt4bDNa69X1Y.png" alt="1579960280360"></p><p>ç‚¹å‡»è¿›è¡Œä¸‹è½½å®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹è¾ƒä¸ºç®€å•ä¸å†èµ˜è¿°ã€‚</p></li><li><p>è¿æ¥æœåŠ¡å™¨</p><p>ä¾æ¬¡ç‚¹å‡»ï¼šæ–‡ä»¶ --&gt; ç«™ç‚¹ç®¡ç†å™¨ --&gt;  æ–°ç«™ç‚¹</p><p><img src="https://i.loli.net/2020/09/17/snKEbvuzyc2CXLR.png" alt="1580056871863"></p></li><li><p>ä¸Šä¼ æ–‡ä»¶</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§ä¸ºæœ¬åœ°æ–‡ä»¶ï¼Œå³ä¾§ä¸ºæœåŠ¡å™¨æ–‡ä»¶ç›®å½•ï¼ˆé»˜è®¤ä¸º <code>/home/hadoop</code>ï¼‰</p><p><img src="https://i.loli.net/2020/09/17/aWGltFuJnEXmvpV.png" alt="1580057006302"></p><p>ä¸Šä¼ å®Œæ¯•åï¼Œå¯åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹æ–‡ä»¶ï¼š</p><p><img src="https://i.loli.net/2020/09/17/c12v7n9fI4h5BSi.png" alt="1580057304136"></p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h3><p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡èªæ˜çš„ä½ å·²ç»å°†è¿œç¨‹å¼€å‘ç¯å¢ƒé¡ºåˆ©æ­å»ºèµ·æ¥ã€‚åŒæ—¶ï¼Œä½¿ç”¨g++ç¼–è¯‘äº†ä¸ªå°demoï¼Œè¿˜é¡ºæ‰‹è¿›è¡Œäº†ä¸€æ¬¡ä¸é”™çš„è°ƒè¯•ä½“éªŒã€‚</p><p>ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯¹äº<strong>å¦‚ä½•ä¼˜é›…å»ç¼–è¯‘æˆ‘ä»¬çš„é¡¹ç›®</strong>ï¼Œæ˜¯ä¸ªä¸å°çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å­¦ä¹ ä¸‹ï¼š</p><ul><li>g++/Makefile/CMake åŸç†åŠåŸºç¡€å‘½ä»¤ï¼›</li><li>é¡¹ç›®æ„å»ºé€»è¾‘åŠç¼–è¯‘ã€‚</li></ul><p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.hwh.zone/p/2834">ç¯å¢ƒæ­å»ºï¼ˆä¸‹ï¼‰g++/Makefile/CMakeå¿«é€Ÿå…¥é—¨</a> ï¼Œå’Œæˆ‘ä¸€èµ·å­¦ä¹ ä¸‹å§ã€‚</p><h3 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h3><div class="timeline"><div class="timenode"><div class="meta"><p><p>2021-12-06 ï¼šç¬¬ä¸€æ¬¡æ›´æ–°</p></p></div><div class="body"><ol><li>åˆç¨¿å®Œæˆå¹¶å‘å¸ƒ</li></ol></div></div></div><h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">vscodeä¸­c++çš„ä¸‰ä¸ªé…ç½®æ–‡ä»¶çš„ä½œç”¨ï¼šhttps://blog.csdn.net/zhxue_11/article/details/89457545<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">vscode C++è¿œç¨‹è°ƒè¯•è¿è¡Œï¼šhttps://zhuanlan.zhihu.com/p/104131448<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">vscodeä½¿ç”¨sftpå¿«é€ŸåŒæ­¥æœåŠ¡å™¨æ–‡ä»¶ï¼šhttps://blog.csdn.net/qq_24798295/article/details/90228795<a href="#fnref:3" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++åŸºç¡€ </tag>
            
            <tag> è¿œç¨‹å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºï¼ˆä¸‹ï¼‰g++/Makefile/CMakeå¿«é€Ÿå…¥é—¨</title>
      <link href="/p/2834/"/>
      <url>/p/2834/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸŒŸ<a href="https://hwh.zone/p/62712/">ã€ŠC++ä»é›¶å¼€å§‹ã€‹</a> ç³»åˆ—ï¼Œå¼€å§‹æ›´æ–°ä¸­â€¦</p></blockquote><div class="tag link"><a class="link-card" title="C++ä»é›¶å¼€å§‹" href="https://hwh.zone/p/62712"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">C++ä»é›¶å¼€å§‹</p><p class="url">https://hwh.zone/p/62712</p></div></a></div><p>ä½œä¸ºä¸€åC/C++ç¨‹åºå‘˜ï¼Œg++/Makefile/CMakeç­‰ç›¸å…³å·¥å…·æ˜¯å¿…å¤‡çš„åŸºç¡€ã€‚ä½†ä¹‹å‰ä½¿ç”¨ä¸­ä¸€ç›´å­˜åœ¨ä¸€äº›å›°æƒ‘ï¼Œå› æ­¤å‚è€ƒäº†ä¸€äº›èµ„æ–™<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="g++ï¼ŒCMakeå’ŒMakefileäº†è§£ä¸€ä¸‹ ï¼š https://zhuanlan.zhihu.com/p/55027085">[1]</span></a></sup><sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Linuxä¸‹ä½¿ç”¨CMakeç¼–è¯‘C++ï¼šhttps://zhuanlan.zhihu.com/p/373256365">[2]</span></a></sup><sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="é˜®ä¸€å³°--ç¼–è¯‘å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼šhttp://www.ruanyifeng.com/blog/2014/11/compiler.html">[3]</span></a></sup>ï¼ŒåŠ¨ç¬”å†™äº†è¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©è‡ªå·±æˆ–å¤§å®¶ï¼š</p><ul><li>å¯¹ç¼–è¯‘å¤„ç†è¿‡ç¨‹æœ‰ä¸ªåŸºæœ¬è®¤çŸ¥ï¼›</li><li>èƒ½åˆæ­¥ä½¿ç”¨ç¼–è¯‘å·¥å…·g++/Makefile/CMakeï¼›</li><li>èƒ½åˆæ­¥ä½¿ç”¨CMakeç¼–è¯‘å¤§å‹é¡¹ç›®ã€‚</li></ul><p>æ‰ç–å­¦æµ…ï¼Œè‹¥æœ‰é”™è¯¯ä¸åæŒ‡æ­£ã€‚</p><h3 id="g">g++</h3><p>åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å¤šæ¬¡åˆ©ç”¨äº†g++ç¼–è¯‘ä»£ç ã€‚ä¸ºäº†æ–¹ä¾¿åç»­å­¦ä¹ Makefileå’ŒCMakeï¼Œæˆ‘ä»¬å…ˆè¿›è¡Œç®€å•æ€»ç»“ã€‚</p><p>ä»¥hello.cppä¸ºä¾‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello, World!&quot;</span> &lt;&lt;endl;   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</h4><p>ç¨‹åº g++ æ˜¯å°† gcc é»˜è®¤è¯­è¨€è®¾ä¸º C++ çš„ä¸€ä¸ªç‰¹æ®Šçš„ç‰ˆæœ¬ï¼Œé“¾æ¥æ—¶å®ƒè‡ªåŠ¨ä½¿ç”¨ C++ æ ‡å‡†åº“è€Œä¸ç”¨ C æ ‡å‡†åº“ã€‚</p><p>å½“ç„¶ï¼Œç”¨ gcc æ¥ç¼–è¯‘é“¾æ¥ C++ ç¨‹åºæ˜¯å¯è¡Œçš„ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc hello.cpp -lstdc++ -o hello.out</span><br></pre></td></tr></table></figure><p>ä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯ä¸»è¦ç†Ÿæ‚‰g++åŸºæœ¬ç”¨æ³•æ¥ç¼–è¯‘C++ä»£ç ã€‚</p><ol><li><p>g++æœ€ç®€å•çš„ç¼–è¯‘æ–¹å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> g++ hello.cpp</span></span><br></pre></td></tr></table></figure><p>ç”±äºå‘½ä»¤è¡Œä¸­æœªæŒ‡å®šå¯æ‰§è¡Œç¨‹åºçš„æ–‡ä»¶åï¼Œç¼–è¯‘å™¨é‡‡ç”¨é»˜è®¤çš„ a.outã€‚ç¨‹åºå¯ä»¥è¿™æ ·æ¥è¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./a.out</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šå¯æ‰§è¡Œç¨‹åºæ–‡ä»¶å</p><p>æˆ‘ä»¬ä½¿ç”¨ <strong>-o</strong> é€‰é¡¹æŒ‡å®šå¯æ‰§è¡Œç¨‹åºçš„æ–‡ä»¶åï¼Œä»¥ä¸‹å®ä¾‹ç”Ÿæˆä¸€ä¸ª åä¸ºhello.out çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ hello.cpp -o hello.out</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ hello.out:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./hello.out</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure></li><li><p>å¤šä¸ª C++ ä»£ç æ–‡ä»¶</p><p>å¦‚ a.cppã€b.cppï¼Œç¼–è¯‘å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ g++ a.cpp cppã€b.cpp -o test.out</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆä¸€ä¸ª test.outå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li></ol><p>g++ æœ‰äº›ç³»ç»Ÿé»˜è®¤æ˜¯ä½¿ç”¨ C++98ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä½¿ç”¨ C++11 æ¥ç¼–è¯‘ hello.cpp æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -g -Wall -std=c++11 hello.cpp -o hello.out</span><br></pre></td></tr></table></figure><h4 id="g-å¸¸ç”¨å‘½ä»¤é€‰é¡¹">g++ å¸¸ç”¨å‘½ä»¤é€‰é¡¹</h4><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:center">-ansi</td><td style="text-align:center">åªæ”¯æŒ ANSI æ ‡å‡†çš„ C è¯­æ³•ã€‚è¿™ä¸€é€‰é¡¹å°†ç¦æ­¢ GNU C çš„æŸäº›ç‰¹è‰²ï¼Œ ä¾‹å¦‚ asm æˆ– typeof å…³é”®è¯ã€‚</td></tr><tr><td style="text-align:center">-c</td><td style="text-align:center">åªç¼–è¯‘å¹¶ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚</td></tr><tr><td style="text-align:center">-DMACRO</td><td style="text-align:center">ä»¥å­—ç¬¦ä¸²&quot;1&quot;å®šä¹‰ MACRO å®ã€‚</td></tr><tr><td style="text-align:center">-DMACRO=DEFN</td><td style="text-align:center">ä»¥å­—ç¬¦ä¸²&quot;DEFN&quot;å®šä¹‰ MACRO å®ã€‚</td></tr><tr><td style="text-align:center">-E</td><td style="text-align:center">åªè¿è¡Œ C é¢„ç¼–è¯‘å™¨ã€‚</td></tr><tr><td style="text-align:center">-g</td><td style="text-align:center">ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ã€‚GNU è°ƒè¯•å™¨å¯åˆ©ç”¨è¯¥ä¿¡æ¯ã€‚</td></tr><tr><td style="text-align:center">-IDIRECTORY</td><td style="text-align:center">æŒ‡å®šé¢å¤–çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„DIRECTORYã€‚</td></tr><tr><td style="text-align:center">-LDIRECTORY</td><td style="text-align:center">æŒ‡å®šé¢å¤–çš„å‡½æ•°åº“æœç´¢è·¯å¾„DIRECTORYã€‚</td></tr><tr><td style="text-align:center">-lLIBRARY</td><td style="text-align:center">è¿æ¥æ—¶æœç´¢æŒ‡å®šçš„å‡½æ•°åº“LIBRARYã€‚</td></tr><tr><td style="text-align:center">-m486</td><td style="text-align:center">é’ˆå¯¹ 486 è¿›è¡Œä»£ç ä¼˜åŒ–ã€‚</td></tr><tr><td style="text-align:center">-o</td><td style="text-align:center">FILE ç”ŸæˆæŒ‡å®šçš„è¾“å‡ºæ–‡ä»¶ã€‚ç”¨åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ã€‚</td></tr><tr><td style="text-align:center">-O0</td><td style="text-align:center">ä¸è¿›è¡Œä¼˜åŒ–å¤„ç†ã€‚</td></tr><tr><td style="text-align:center">-O</td><td style="text-align:center">æˆ– -O1 ä¼˜åŒ–ç”Ÿæˆä»£ç ã€‚</td></tr><tr><td style="text-align:center">-O2</td><td style="text-align:center">è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</td></tr><tr><td style="text-align:center">-O3</td><td style="text-align:center">æ¯” -O2 æ›´è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ inline å‡½æ•°ã€‚</td></tr><tr><td style="text-align:center">-shared</td><td style="text-align:center">ç”Ÿæˆå…±äº«ç›®æ ‡æ–‡ä»¶ã€‚é€šå¸¸ç”¨åœ¨å»ºç«‹å…±äº«åº“æ—¶ã€‚</td></tr><tr><td style="text-align:center">-static</td><td style="text-align:center">ç¦æ­¢ä½¿ç”¨å…±äº«è¿æ¥ã€‚</td></tr><tr><td style="text-align:center">-UMACRO</td><td style="text-align:center">å–æ¶ˆå¯¹ MACRO å®çš„å®šä¹‰ã€‚</td></tr><tr><td style="text-align:center">-w</td><td style="text-align:center">ä¸ç”Ÿæˆä»»ä½•è­¦å‘Šä¿¡æ¯ã€‚</td></tr><tr><td style="text-align:center">-Wall</td><td style="text-align:center">ç”Ÿæˆæ‰€æœ‰è­¦å‘Šä¿¡æ¯ã€‚</td></tr></tbody></table><h3 id="ç¼–è¯‘è¿‡ç¨‹åˆæ¢">ç¼–è¯‘è¿‡ç¨‹åˆæ¢</h3><p>ç°åœ¨è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥ä¸€æ­¥æ­¥æ¢è®¨ä¸‹ç¼–è¯‘è¿‡ç¨‹ã€‚</p><p>å‡†å¤‡çš„<code>hello.cpp</code>ç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello, World!&quot;</span> &lt;&lt;endl;   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œç®€å•çš„ç¼–è¯‘&amp;è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++  hello.cpp -o hello.out  <span class="comment"># æ–‡ä»¶åå¯åŒ…å«æŒ‡å®šè·¯å¾„</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰è·¯å¾„ç”Ÿæˆäº†<code>hello.out</code>æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p><strong>hello.outæœ¬è´¨æ˜¯ä»€ä¹ˆ</strong> ?</p><p><strong>ä¸€ä¸ªç¨‹åºï¼ˆæ¯”å¦‚hello.outï¼‰æœ¬è´¨æ˜¯ç”±æ•°æ®æ®µã€ä»£ç æ®µã€.bssæ®µç»„æˆã€‚</strong></p><p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªè™šæ‹Ÿè¿›ç¨‹ï¼ˆç¨‹åºï¼‰å†…å­˜ç©ºé—´<u>è¿è¡Œæ—¶</u>åˆ†å¸ƒå¸ƒå±€ï¼ˆä¸‹å›¾.bssæ®µå’Œæ•°æ®æ®µåˆå¹¶äº†ï¼‰ï¼š</p><ul><li><p>æ³¨æ„åˆ°æ­¤æ—¶<u>è¿˜å¤šäº†å †&amp;æ ˆç”¨æ¥ç»™ç¨‹åºè¿è¡Œæ—¶è¿›è¡Œç©ºé—´åˆ†é…</u>ï¼›</p></li><li><p>é«˜åœ°å€çš„1GBï¼ˆLinuxä¸‹å¦‚æ­¤ï¼ŒWindowsé»˜è®¤2GBï¼‰ç©ºé—´åˆ†é…ç»™å†…æ ¸ï¼Œä¹Ÿç§°ä¸º<strong>å†…æ ¸ç©ºé—´</strong>ï¼›å‰©ä¸‹çš„3GBåˆ†ç»™ç”¨æˆ·ï¼Œä¹Ÿç§°<strong>ç”¨æˆ·ç©ºé—´</strong>ã€‚</p></li></ul><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/5e8d39d19a216fd03392d36081e70b7e.jpg" alt="ä½ ç¡®å®šä½ ç†è§£å†…å­˜åˆ†é…å—ï¼Ÿ" style="zoom:80%;" /><ul><li><p><strong>æ ˆï¼ˆStack</strong>ï¼‰ï¼šå­˜å‚¨ä»£ç ä¸­è°ƒç”¨å‡½æ•°ã€å®šä¹‰<u><strong>å±€éƒ¨</strong>å˜é‡</u>(ä½†ä¸åŒ…å«staticä¿®é¥°çš„å˜é‡)ã€ä¿å­˜çš„ä¸Šä¸‹æ–‡ç­‰ï¼›</p></li><li><p><strong>æ–‡ä»¶æ˜ å°„åŒºåŸŸ ï¼š</strong> æ ˆå’Œå †ä¸­é—´é‚£ä¸ªç©ºç™½åŒºåŸŸã€‚åŠ¨æ€åº“ã€å…±äº«å†…å­˜ç­‰æ˜ å°„ç‰©ç†ç©ºé—´çš„å†…å­˜ï¼Œä¸€èˆ¬æ˜¯ <code>mmap</code> å‡½æ•°æ‰€åˆ†é…çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p></li><li><p><strong>å †ï¼ˆHeap</strong>ï¼‰ï¼šå­˜å‚¨é‚£äº›ç”Ÿå­˜æœŸ<u>ä¸å‡½æ•°è°ƒç”¨æ— å…³çš„æ•°æ®</u>ï¼Œå¦‚åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚</p></li><li><p><strong>.bssæ®µ</strong>ï¼šå…¨ç§°Block Started by Symbolï¼Œä¹Ÿå°±æ˜¯æœªè¢«åˆå§‹åŒ–çš„<strong>å…¨å±€</strong>å˜é‡ã€<strong>é™æ€</strong>å˜é‡çš„å†…å®¹çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚</p></li><li><p><strong>æ•°æ®æ®µï¼ˆ.data</strong>ï¼‰ï¼šä¿å­˜<strong>å…¨å±€</strong>å˜é‡ã€<strong>å¸¸é‡</strong>ã€é™æ€å˜é‡çš„å†…å®¹çš„ä¸€å—å†…å­˜åŒºåŸŸï¼ŒåŒºåˆ«.bssæ®µåœ¨äºå˜é‡å·²ç»è¢«åˆå§‹åŒ–ã€‚æ¯”å¦‚ï¼š</p></li><li><p><strong>ä»£ç æ®µï¼ˆ.text &amp; .init</strong>ï¼‰ï¼š <code>.text</code> ç”¨äºå­˜æ”¾æ•´ä¸ªç¨‹åºä¸­çš„ä»£ç ï¼› <code>.init</code> ç”¨äºå­˜æ”¾ç³»ç»Ÿä¸­ç”¨æ¥åˆå§‹åŒ–å¯åŠ¨ä½ çš„ç¨‹åºçš„ä¸€æ®µä»£ç  ã€‚</p></li></ul><p>å›æ¥ç¥æ¥ï¼Œè®©æˆ‘ä»¬ç»§ç»­æ‰§è¡Œä¸€ä¸‹è¯•è¯•ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211208140718480.png" alt="image-20211208140718480"></p><p>æˆ‘ä»¬çš„ä»£ç è¢«æ­£ç¡®æ‰§è¡Œäº†ã€‚ä½†è¿™æ•´ä¸ªè¿‡ç¨‹çš„ç»†èŠ‚è¢«éšè—äº†ï¼Œå¦‚æœä¸äº†è§£æ¸…æ¥šå¯¹æˆ‘ä»¬ä»¥åçš„å­¦ä¹ å·¥ä½œé˜»ç¢å¾ˆå¤§ã€‚</p><p>æ­£å¼å¼€å§‹æ¥è§¦ç»†èŠ‚å‰ï¼Œæˆ‘ä»¬å…ˆå¤§è‡´äº†è§£ä¸‹ä¸Šè¿°ç¼–è¯‘è¿‡ç¨‹ï¼ˆå››æ­¥ï¼‰ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/20200423003518622.png" alt="C/C++ç¨‹åºç¼–è¯‘çš„è¿‡ç¨‹| ç å†œå®¶å›­"></p><ol><li><code>é¢„å¤„ç†</code>ï¼šèµ„æºè¿›è¡Œç­‰ä»·æ›¿æ¢ï¼Œç”Ÿæˆ<strong>é¢„ç¼–è¯‘æ–‡ä»¶</strong>ï¼ˆ<strong>.i</strong>æ–‡ä»¶ï¼‰ï¼›</li><li><code>ç¼–è¯‘</code> ï¼šç”Ÿæˆ<strong>æ±‡ç¼–ä»£ç </strong>ï¼ˆ<strong>.s</strong>æ–‡ä»¶ï¼‰ï¼›</li><li><code>æ±‡ç¼–</code> ï¼šå°†æ±‡ç¼–ä»£ç æœ€ç»ˆç”Ÿæˆ<strong>æœºå™¨ä»£ç </strong>ï¼ˆ<strong>.o</strong>æ–‡ä»¶ï¼‰ï¼›</li><li><code>é“¾æ¥</code>ï¼šåŠ¨æ€æˆ–é™æ€é“¾æ¥å¤–éƒ¨å‡½æ•°/åº“(lib)/å˜é‡ï¼Œç”Ÿæˆ<strong>å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶(hex)æ–‡ä»¶/é™æ€åº“(.a)æ–‡ä»¶/åŠ¨æ€åº“(.so)æ–‡ä»¶</strong>ã€‚</li></ol><p>ç°åœ¨è®©æˆ‘ä»¬æ¥é€æ­¥åˆ†æã€‚</p><h4 id="é¢„å¤„ç†">é¢„å¤„ç†</h4><p>é¢„å¤„ç†çš„ä¸»è¦ä½œç”¨ï¼šé€šè¿‡å†…å»ºåŠŸèƒ½å¯¹<strong>é¢„å¤„ç†æŒ‡ä»¤è¿›è¡Œç­‰ä»·æ–‡æœ¬æ›¿æ¢</strong>ã€‚</p><p>ä¸€èˆ¬åœ°ï¼Œ<code>C/C++</code> ç¨‹åºçš„æºä»£ç ä¸­åŒ…å«ä»¥ <code>#</code> å¼€å¤´çš„å„ç§ç¼–è¯‘æŒ‡ä»¤ï¼Œè¢«ç§°ä¸º<strong>é¢„å¤„ç†æŒ‡ä»¤</strong>ã€‚æ ¹æ®ANSI C å®šä¹‰ï¼Œä¸»è¦åŒ…æ‹¬ï¼š<strong>æ–‡ä»¶åŒ…å«ã€å®å®šä¹‰ã€æ¡ä»¶ç¼–è¯‘å’Œç‰¹æ®Šæ§åˆ¶</strong>ç­‰4å¤§ç±»<sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="gccç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼šhttps://blog.csdn.net/albertsh/article/details/89309107">[7]</span></a></sup>ã€‚</p><ul><li><p><strong>æ–‡ä»¶åŒ…å«</strong>ï¼šä¾‹å¦‚å¸¸ç”¨çš„é¢„å¤„ç†æŒ‡ä»¤ <code>#include &lt;iostream&gt;</code> ï¼Œé¢„ç¼–è¯‘é˜¶æ®µä¼šä½¿ç”¨ç³»ç»Ÿç›®å½•ä¸‹<code>iostream</code>æ–‡ä»¶ä¸­çš„å…¨éƒ¨å†…å®¹ï¼Œæ›¿æ¢ <code>#include &lt;iostream&gt;</code> ã€‚</p><blockquote><p><code>#include &quot;xxx.h&quot;</code> ï¼Œè¡¨ç¤ºä½¿ç”¨å½“å‰ç›®å½•ä¸‹xxx.hæ–‡ä»¶ï¼Œ<code>&lt;&gt;</code> æ˜¯åœ¨ç³»ç»Ÿç›®å½•ä¸‹æŸ¥æ‰¾ã€‚</p></blockquote></li><li><p><strong>å®å®šä¹‰å±•å¼€åŠå¤„ç†</strong>ï¼š é¢„å¤„ç†é˜¶æ®µä¼šå°†å®šä¹‰çš„å¸¸é‡ç¬¦å·è¿›è¡Œç­‰ä»·æ›¿æ¢ï¼Œe.g. <code>#define A 100</code> , æ‰€æœ‰çš„å®å®šä¹‰ç¬¦å·Aéƒ½ä¼šè¢«æ›¿æ¢æˆ<code>100</code>ã€‚è¿˜ä¼šå°†ä¸€äº›å†…ç½®çš„å®å±•å¼€ï¼Œæ¯”å¦‚ç”¨äºæ˜¾ç¤ºæ–‡ä»¶å…¨è·¯å¾„çš„<code>__FILE__</code>ã€‚</p></li><li><p><strong>æ¡ä»¶ç¼–è¯‘å¤„ç†</strong>: å¦‚ <code>#ifdefï¼Œ#ifndefï¼Œ#elseï¼Œ#elifï¼Œ#endif</code>ç­‰ï¼Œè¿™äº›æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤çš„å¼•å…¥ï¼Œä½¿å¾—ç¨‹åºå‘˜å¯ä»¥é€šè¿‡å®šä¹‰ä¸åŒçš„å®æ¥å†³å®šç¼–è¯‘ç¨‹åºå¯¹å“ªäº›ä»£ç è¿›è¡Œå¤„ç†ã€‚é¢„å¤„ç†æ—¶ä¼šå°†é‚£äº›ä¸å¿…è¦çš„ä»£ç è¿‡æ»¤æ‰ï¼Œé˜²æ­¢æ–‡ä»¶é‡å¤åŒ…å«ç­‰ã€‚</p></li><li><p>å…¶å®ƒï¼šç‰¹æ®Šæ§åˆ¶å¤„ç†â€¦</p></li></ul><p>ç‰¹åˆ«çš„ï¼Œé¢„å¤„ç†è¿‡ç¨‹è¿˜ä¼šå‘ç”Ÿï¼š</p><ul><li><strong>æ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†</strong>ï¼š æ¯”å¦‚åœ¨æ–‡ä»¶<code>hello.i</code>ä¸­å°±æœ‰ç±»ä¼¼ <code># 2 &quot;main.c&quot; 2</code> çš„å†…å®¹ï¼Œä»¥ä¾¿äºç¼–è¯‘æ—¶ç¼–è¯‘å™¨äº§ç”Ÿè°ƒè¯•ç”¨çš„è¡Œå·ä¿¡æ¯ï¼Œç¼–è¯‘æ—¶äº§ç”Ÿç¼–è¯‘é”™è¯¯æˆ–è­¦å‘Šæ—¶èƒ½å¤Ÿæ˜¾ç¤ºè¡Œå·ï¼›</li><li>æ¸…ç†æ³¨é‡Šå†…å®¹ç­‰ã€‚</li></ul><p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬äº²çœ¼ç§ç§<strong>é¢„å¤„ç†çš„ç­‰ä»·æ–‡æœ¬æ›¿æ¢</strong>ç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -E hello.cpp &gt; hello.i  <span class="comment"># è¾“å‡ºæ–‡ä»¶é‡å®šå‘åˆ°hello.iä¸­</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ol><li><p><strong>æ–‡ä»¶åŒ…å«</strong>ï¼šæˆ‘ä»¬ä¹‹å‰å¼•å…¥çš„å¤´æ–‡ä»¶ <code>#include &lt;iostream&gt;</code> ï¼Œ<strong>é¢„å¤„ç†åä¼šå°†<code>#include &lt;iostream&gt;</code> ä»£ç æ›¿æ¢ä¸ºiostreamæ–‡ä»¶çš„å†…å®¹ï¼Œæ’å…¥åˆ°<code>hello.i</code>ä¸­</strong>ã€‚</p><p>æ–‡ä»¶è¿‡é•¿ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†æˆªå›¾ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211208235953948.png" alt="image-20211208235953948"></p><p>ç‰¹åˆ«çš„ï¼Œ<strong>iostreamæ–‡ä»¶æœ¬èº«ä¹Ÿ#includeäº†å¤´æ–‡ä»¶ï¼ŒåŒæ ·ä¼šè¢«æ›¿æ¢</strong>ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œå¤§æ‚çƒ©åµŒå¥—æ‹¼æ¥ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/20200422202617233.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:80%;" /></li><li><p>å…¶å®ƒï¼Œ<u>æ¡ä»¶ç¼–è¯‘å¤„ç†</u>ã€<u>æ·»åŠ è¡Œå·å’Œæ ‡è¯†</u>ç­‰ä¹Ÿä¸€å¹¶å¯ä»¥ï¼ˆå·¦å›¾ï¼‰è§‚å¯Ÿåˆ°ã€‚</p></li></ol><h4 id="ç¼–è¯‘">ç¼–è¯‘</h4><p>ç¼–è¯‘è¿‡ç¨‹æ˜¯æ•´ä¸ªç¨‹åºæ„å»ºçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†ä¹‹ä¸€ï¼Œå…¶å·¥ä½œå°±æ˜¯æŠŠé¢„å¤„ç†å®Œç”Ÿæˆçš„ <code>.i</code> æ–‡ä»¶è¿›è¡Œä¸€ç³»åˆ—çš„<strong>è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æä»¥åŠä»£ç ä¼˜åŒ–</strong>ï¼Œæœ€ç»ˆäº§ç”Ÿç›¸åº”çš„æ±‡ç¼–ä»£ç æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ <code>.s</code> æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -S hello.cpp -o hello.s  <span class="comment"># è¯¥å‘½ä»¤åŒ…å«ç­‰ä»·æ›¿æ¢è¿‡ç¨‹</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€å½“å‰ç›®å½•ä¸‹<code>hello.s</code> ï¼Œå…¥ç›®å³æ˜¯ç†Ÿæ‚‰çš„æ±‡ç¼–å¤©ä¹¦ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211208150625682.png" alt="image-20211208150625682"></p><h4 id="æ±‡ç¼–">æ±‡ç¼–</h4><p>ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œæ¯ä¸ªæ±‡ç¼–è¯­å¥éƒ½æœ‰ç›¸å¯¹åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œåªéœ€æ ¹æ®æ±‡ç¼–ä»£ç è¯­æ³•å’Œæœºå™¨æŒ‡ä»¤çš„å¯¹ç…§è¡¨ç¿»è¯‘è¿‡æ¥å°±å¯ä»¥äº†ã€‚</p><p>æœ‰äº†ä¸Šè¿°æ±‡ç¼–ä»£ç åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å°†å…¶è½¬æ¢ä¸ºæœºå™¨ç ï¼ˆ<code>.o</code>æ–‡ä»¶ï¼Œå³object fileï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -c hello.cpp -o hello.o  <span class="comment"># -c è¡¨ç¤ºä¸è¿›è¡Œé“¾æ¥ï¼Œåªç”Ÿæˆç›®æ ‡æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211208151441286.png" alt="image-20211208151441286"></p><p>ä½†æ˜¯åœ¨è¿™ä¸€æ­¥è¿˜ä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œä¼šæŠ¥é”™ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211208151833947.png" alt="image-20211208151833947"></p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜<strong>æ²¡æœ‰é“¾æ¥å…¶å®ƒç›¸åº”çš„æ–‡ä»¶</strong>ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚æˆ‘ä»¬æ¥è¯•è¯•é“¾æ¥å†ç”Ÿæˆå¯æ‰§è¡Œä»£ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ hello.o -o hello.out</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œï¼š<code>./hello.out</code></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211208160023661.png" alt="image-20211208160023661"></p><p>å‡è£…æƒŠå–œçš„å‘ç°ï¼ˆæ˜¯çš„å°±æ˜¯è¿™ä¹ˆæˆç²¾ï¼‰ï¼Œæ–‡ä»¶ç¡®å®å·²ç»è¢«æˆåŠŸæ‰§è¡Œäº†ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>é“¾æ¥è¿‡ç¨‹ä¸­ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¸€å®šè¦é“¾æ¥åæ‰èƒ½æ‰§è¡Œ</strong>ï¼Ÿ</p><h4 id="é“¾æ¥">é“¾æ¥</h4><h5 id="é“¾æ¥è¿‡ç¨‹ç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Ÿ">é“¾æ¥è¿‡ç¨‹ç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Ÿ</h5><p><strong>é“¾æ¥å°±æ˜¯è¿›è¡Œç¬¦å·è§£æå’Œé‡å®šä½</strong>çš„è¿‡ç¨‹<sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="ç¬¦å·è§£æï¼šhttps://www.jianshu.com/p/2786533a34c9">[4]</span></a></sup>ã€‚</p><ul><li>ç¬¦å·è§£æï¼šæ¯ä¸ªç¬¦å·å¯¹åº”äºä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªå…¨å±€å˜é‡æˆ–ä¸€ä¸ªé™æ€å˜é‡ï¼Œç¬¦å·è§£æçš„ç›®çš„æ˜¯å°†æ¯ä¸ªç¬¦å·å¼•ç”¨ä¸ä¸€ä¸ªç¬¦å·å®šä¹‰å…³è”èµ·æ¥ã€‚</li><li>é‡å®šä½ï¼šé“¾æ¥å™¨é€šè¿‡æŠŠæ¯ä¸ªç¬¦å·å®šä¹‰ä¸ä¸€ä¸ªå†…å­˜ä½ç½®å…³è”èµ·æ¥ï¼Œç„¶åä¿®æ”¹æ‰€æœ‰å¯¹è¿™äº›ç¬¦å·çš„å¼•ç”¨ï¼Œä½¿å¾—å®ƒä»¬æŒ‡å‘è¿™ä¸ªå†…å­˜ä½ç½®ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆä¸€å®šè¦è¿›è¡Œç¬¦å·è§£æå’Œé‡å®šä½</strong>ï¼Ÿ</p><p>æ¯”å¦‚æˆ‘ä»¬ä¸Šä¸€æ­¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶<code>hello.o</code> æ‰§è¡Œå‡ºé”™ï¼Œå°±æ˜¯å› ä¸º<strong>ç¬¦å·<code>std::cout</code>æ²¡æœ‰è¿›è¡Œè§£æå’Œé‡å®šä½</strong>ã€‚</p><p>åœ¨å‰é¢é¢„å¤„ç†é˜¶æ®µï¼Œæˆ‘ä»¬çŸ¥é“ <code>#include&lt;iostream&gt;</code> ä¼šè¢«æ›¿æ¢ä¸ºå¤´æ–‡ä»¶<code>iostream</code>ä¸­çš„å†…å®¹ã€‚</p><p>ä½†å¤´æ–‡ä»¶<code>iostream</code>ä¸­çš„ç¬¦å·ï¼Œå¦‚<code>cout</code>åªæ˜¯è¢«å®šä¹‰ï¼Œå¹¶æ²¡æœ‰å®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> ostream cout;<span class="comment">/// Linked to standard output</span></span><br></pre></td></tr></table></figure><p>å…·ä½“æ˜¯åœ¨<code>libstdc++.so.6</code>ä¸­è¢«å®ç°çš„ã€‚æˆ‘ä»¬å¿…é¡»è¦è®©ç¼–è¯‘å™¨æ‰¾åˆ°<code>libstdc++.so</code>ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡é“¾æ¥ï¼Œç„¶åå°†<strong>coutç¬¦å·è§£æé‡å®šå‘libstdc++.soä¸­</strong>ã€‚è¿™æ ·ï¼Œ<code>cout</code>æ‰å¯ä»¥è¢«æ­£å¸¸æ‰§è¡Œã€‚</p><h5 id="å‡†å¤‡ä»£ç ç‰‡æ®µ">å‡†å¤‡ä»£ç ç‰‡æ®µ</h5><p>ä¸ºäº†æ›´æ¸…æ¥šçš„è¯´æ˜æ•´ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸å¦¨æ¢ä¸€ä¸ªä¾‹å­ï¼Œ<strong>ä¸ä½¿ç”¨ç³»ç»Ÿåº“æ–‡ä»¶</strong>ï¼ˆé¢„å¤„ç†åçš„æ–‡ä»¶å¤ªå¤æ‚ï¼‰ã€‚</p><ul><li><p>Main.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> shared;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>*,<span class="keyword">int</span>*)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> a = <span class="number">100</span>;</span><br><span class="line">   <span class="built_in">swap</span>(&amp;a, &amp;shared);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Libtest.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> shared = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> *a, <span class="keyword">int</span> *b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   *a ^= *b ^= *a ^= *b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼šLibtest.cpp<strong>ä¸å¼•ç”¨</strong>ä»»ä½•å¤–éƒ¨å˜é‡ç¬¦å·ï¼Œä½†Main.cppæ–‡ä»¶ä¼š<strong>å¼•ç”¨</strong>Libtest.cppä¸­çš„<strong>sharedå˜é‡</strong> å’Œ <strong>swapå‡½æ•°</strong>ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>Main.cppä¸­å¤–éƒ¨ç¬¦å·å³sharedå’Œswapï¼Œæ€ä¹ˆæ ·æ‰èƒ½è¢«æ­£ç¡®è§£æåˆ°Libtest.cppä¸­</strong>ï¼Ÿ</p><h5 id="é“¾æ¥å‰ç½®çŸ¥è¯†">é“¾æ¥å‰ç½®çŸ¥è¯†</h5><blockquote><p>ä¸‹é¢æœ‰ä¸ç†è§£çš„åœ°æ–¹ï¼Œå»ºè®®é˜…è¯»ï¼š<a href="https://www.cnblogs.com/fellow1988/p/6158240.html">ELFå­¦ä¹ â€“é‡å®šä½æ–‡ä»¶</a></p></blockquote><p>ç»§ç»­è®²è§£å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¡¥å……å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="è®¡ç®—æœºåŸç†ç³»åˆ—ä¹‹ä¸ƒ-é“¾æ¥è¿‡ç¨‹åˆ†æï¼šhttps://luomuxiaoxiao.com/?p=572">[5]</span></a></sup>ï¼š</p><ul><li><p><strong>ç¬¦å·å’Œå¤–éƒ¨ç¬¦å·</strong></p><ul><li>åœ¨é“¾æ¥ä¸­ï¼Œæˆ‘ä»¬å°†å‡½æ•°å’Œå˜é‡ç»Ÿç§°ä¸º<strong>ç¬¦å·</strong>ï¼ˆ<strong>Symbol</strong>ï¼‰ï¼›</li><li>åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œè€Œåˆæ²¡æœ‰åœ¨æœ¬ç›®æ ‡æ–‡ä»¶ä¸­å®šä¹‰çš„å…¨å±€ç¬¦å·ï¼Œç§°ä¸º<strong>å¤–éƒ¨ç¬¦å·</strong>ï¼ˆ<strong>External Symbol</strong>ï¼‰ã€‚</li></ul></li><li><p><strong>é‡å®šä½è¡¨</strong></p><p>ç”±äº<strong>å¤–éƒ¨ç¬¦å·åœ¨ç¼–è¯‘åå¹¶ä¸èƒ½ç¡®å®šå…¶ä½ç½®åœ°å€ï¼ˆé“¾æ¥é‡å®šä½åæ‰èƒ½ç¡®å®š</strong>ï¼‰ã€‚æ‰€ä»¥éœ€è¦è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶ï¼š<strong>å°†éœ€è¦é‡å®šä½çš„å¤–éƒ¨ç¬¦å·è¿›è¡Œæ ‡è®°</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œç¼–è¯‘å<code>Main.o</code> æ–‡ä»¶ç¬¦å·è¡¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -c Main.cpp -o Main.o # -cå‚æ•°è¡¨ç¤ºä¸è¿›è¡Œé“¾æ¥</span><br><span class="line">objdump -r Main.o</span><br></pre></td></tr></table></figure><ul><li><p>å¯è§ï¼Œ<code>shared</code>å’Œ<code>swap()</code>ä¸ºå¤–éƒ¨ç¬¦å·è¢«æ ‡è®°è®°å½•ï¼Œæ˜¾ç„¶ï¼Œ<strong>è¿™äº›ç¬¦å·æ˜¯éœ€è¦è¢«è§£æé‡å®šå‘</strong>çš„ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227201402682.png" alt="image-20211227201402682"></p></li></ul><p>ä½†æ˜¯<strong>Libtest.oä¸­æ²¡æœ‰å¤–éƒ¨ç¬¦å·</strong>ï¼Œå› æ­¤å…¶é‡å®šä½è¡¨ä¸ºç©ºã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -c Libtest.cpp -o Libtest.o</span><br><span class="line">objdump -r Libtest.o</span><br></pre></td></tr></table></figure><p>é‡å®šä½è¡¨ä¸ºç©ºã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227215524264.png" alt="image-20211227215524264"></p></li><li><p><strong>ç¬¦å·è¡¨</strong></p><p>ç›®æ ‡æ–‡ä»¶ä½¿ç”¨<strong>ç¬¦å·è¡¨</strong>ï¼ˆ<strong>Symbol Table</strong>ï¼‰æ¥è®°å½•æœ¬ç›®æ ‡æ–‡ä»¶ä¸­çš„<strong>å…¨å±€ç¬¦å·</strong>çš„ä¿¡æ¯ã€‚</p><p>e.g. <strong>è‡ªå®šä¹‰çš„å…¨å±€ç¬¦å·åœ°å€</strong>ï¼Œè¿™æ ·åˆ«çš„æ–‡ä»¶ä¸­å¼•ç”¨äº†è¯¥è‡ªå®šä¹‰çš„å…¨å±€ç¬¦å·ï¼Œå°±å¯ä»¥æŸ¥æ‰¾å…¶çœŸå®åœ°å€ã€‚</p><ul><li><p><strong>Main.oç¬¦å·è¡¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -s Main.o</span><br></pre></td></tr></table></figure><ul><li><p>Main.oå®šä¹‰äº†å…¨å±€ç¬¦å·<code>main</code>ï¼Œä½¿ç”¨åˆ°äº†å¤–éƒ¨ç¬¦å·<code>shared</code>å’Œ<code>swap</code>ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227201514728.png" alt="image-20211227201514728"></p><p><code>UND</code> å³è¡¨ç¤ºæœªå®šä¹‰éœ€è¦é‡å®šä¹‰ã€‚</p></li></ul></li><li><p><strong>Libtest.oçš„ç¬¦å·è¡¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -s Libtest.o</span><br></pre></td></tr></table></figure><p>Libtest.oå®šä¹‰äº†ç¬¦å·<code>shared</code>å’Œ<code>swap</code>ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°å¤–éƒ¨ç¬¦å·</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227201608874.png" alt="image-20211227201608874"></p></li></ul></li></ul><h5 id="é™æ€é“¾æ¥è¿‡ç¨‹">é™æ€é“¾æ¥è¿‡ç¨‹</h5><blockquote><p><strong>é™æ€é“¾æ¥çš„ä¸»è¦ç›®çš„ï¼š1ï¼‰å°†å¤šä¸ªç›®æ ‡æ–‡ä»¶åˆå¹¶ï¼Œ2ï¼‰å¹¶å¤„ç†å„ç›®æ ‡æ–‡ä»¶ç”¨åˆ°çš„å¤–éƒ¨ç¬¦å·ï¼ˆe.g. main.cpp ä¸­çš„ swapå’Œsharedï¼‰</strong>ï¼Œå¯¹å¤–éƒ¨ç¬¦å·é‡å®šä½ï¼ˆ è°ƒæ•´åœ°å€åˆ°çœŸæ­£å®šä¹‰å®ç°çš„åœ°æ–¹ï¼Œe.g.ï¼Œswapâ†’Libtest.oï¼‰ï¼Œæœ€åç”Ÿæˆ<strong>å¯ç‹¬ç«‹è¿è¡Œ</strong>çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></blockquote><p>ç°åœ¨æˆ‘ä»¬è¿›è¡Œé™æ€é“¾æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g++ -static Main.cpp Libtest.cpp -o main.out</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰ä»·äº</span></span><br><span class="line">g++ -c Main.cpp  -o Main.o</span><br><span class="line">g++ -c Libtest.cpp  -o Libtest.o</span><br><span class="line">g++ -static Main.o Libtest.o -o main.out <span class="comment"># ç›®æ ‡æ–‡ä»¶ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼‰é™æ€é“¾æ¥</span></span><br></pre></td></tr></table></figure><p>é™æ€é“¾æ¥ä¸€èˆ¬é‡‡ç”¨<strong>ä¸¤æ­¥é“¾æ¥</strong>ï¼ˆ<strong>Two-pass Linking</strong>ï¼‰çš„æ–¹æ³•ï¼Œä¸‹é¢ä»¥é“¾æ¥ Main.cpp å’Œ Libtest.cppä¸ºä¾‹å…·ä½“è¯´æ˜ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼Œç©ºé—´ä¸åœ°å€åˆ†é…ã€‚</strong></p><p>æ‰«æ<strong>æ‰€æœ‰çš„ç¼–è¯‘ç”Ÿæˆçš„å¯é‡å®šå‘æ–‡ä»¶ï¼ˆMain.oå’ŒLibtest.oï¼‰å¹¶åˆå¹¶</strong>ï¼ŒåŒæ—¶è·å¾—å…¶ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ol><li><p><strong>å…¨å±€ç¬¦å·è¡¨</strong>ï¼šåŒ…å«æ‰€æœ‰çš„ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨ï¼›</p><table><thead><tr><th style="text-align:center">ç¬¦å·å</th><th style="text-align:center">çŠ¶æ€</th><th style="text-align:center">æ‰€åœ¨ç›®æ ‡æ–‡ä»¶</th><th style="text-align:center">â€¦</th></tr></thead><tbody><tr><td style="text-align:center">main</td><td style="text-align:center">å®šä¹‰</td><td style="text-align:center">Main</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">shared</td><td style="text-align:center"><strong>å¼•ç”¨</strong></td><td style="text-align:center">Main</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">swap</td><td style="text-align:center"><strong>å¼•ç”¨</strong></td><td style="text-align:center">Mian</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">shared</td><td style="text-align:center">å®šä¹‰</td><td style="text-align:center">Lib</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">swap</td><td style="text-align:center">å®šä¹‰</td><td style="text-align:center">Lib</td><td style="text-align:center"></td></tr></tbody></table></li><li><p><strong>æ®µä¿¡æ¯</strong>ï¼šå„ä¸ªæ®µçš„é•¿åº¦ã€å±æ€§å’Œä½ç½®ã€‚</p></li></ol><p><strong>ç¬¬äºŒæ­¥ï¼Œç¬¦å·è§£æä¸é‡å®šä½ã€‚</strong></p><ol><li><p>æŸ¥çœ‹<strong>å…¨å±€ç¬¦å·è¡¨</strong>ï¼Œå‘ç°<code>shared</code>éœ€è¦é‡å®šä½ï¼›</p></li><li><p>åœ¨<strong>å…¨å±€ç¬¦å·è¡¨</strong>å‘ç°Libtest.oå®šä¹‰äº†<code>shared</code>ï¼›</p></li><li><p>æŸ¥çœ‹<strong>Libtest.oçš„ç¬¦å·è¡¨</strong>ä»¥åŠç¬¬ä¸€æ­¥çš„<strong>æ®µä¿¡æ¯</strong>ï¼Œç¡®å®š<code>shared</code>çš„åœ°å€ï¼›</p></li><li><p>å†æŸ¥çœ‹<strong>Main.oçš„é‡å®šä½è¡¨</strong>ï¼Œæ‰¾åˆ°æ‰€æœ‰<code>shared</code>éœ€è¦é‡å®šä½çš„åœ°å€ï¼Œä¿®æ”¹ä¸º<code>shared</code>çš„çœŸå®åœ°å€ï¼›</p><blockquote><p>Main.oå’ŒLibtest.oè¢«åˆå¹¶ï¼Œå¿…é¡»è¦æŸ¥çœ‹é‡å®šä½è¡¨ï¼ŒçŸ¥é“å“ªäº›æ˜¯å±äºMainçš„<code>share</code>ï¼Œè¿›è¡Œé‡å®šä½ã€‚</p></blockquote></li><li><p>ç»§ç»­æŸ¥çœ‹<strong>å…¨å±€ç¬¦å·è¡¨</strong>ï¼Œå‘ç°<code>swap</code> éœ€è¦é‡å®šä½ï¼Œè¿‡ç¨‹åŒä¸Šï¼›</p></li><li><p>ç›´è‡³æ‰€æœ‰çš„<strong>ç¬¦å·å¼•ç”¨éƒ½è¢«ä¿®æ”¹ä¸ºçœŸå®åœ°å€</strong>ï¼Œç»“æŸã€‚</p></li></ol><p>æˆ‘ä»¬å¯ä»¥åç¼–è¯‘ä¸€ä¸‹æœ€åçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œçœ‹çœ‹æ˜¯å¦å¦‚ä¸Šæ‰€ç¤ºå·²ç»å…¨éƒ¨é‡å®šä¹‰å®Œæˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d main.out &gt; tmp.txt</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œä¸»å‡½æ•°ä¸­è°ƒç”¨çš„swapå‡½æ•°çš„åœ°å€è¢«ä¿®æ­£ä¸º40050dã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211227204728883.png" alt="image-20211227204728883"></p><p><strong>å…¶å®ƒä¿¡æ¯åˆå¹¶</strong></p><p>åœ¨é™æ€é“¾æ¥ä¸‹ï¼Œé“¾æ¥å™¨è¿˜ä¼šå°†<strong>å„ä¸ªç›®æ ‡æ–‡ä»¶çš„ä»£ç æ®µå’Œæ•°æ®æ®µã€åˆå¹¶æ‹·è´ã€‘åˆ°å¯æ‰§è¡Œæ–‡ä»¶</strong>ï¼Œå› æ­¤é™æ€é“¾æ¥ä¸‹å¯æ‰§è¡Œæ–‡ä»¶å½“ä¸­<strong>åŒ…å«äº†æ‰€ä¾èµ–çš„æ‰€æœ‰ä»£ç å’Œæ•°æ®</strong>ã€‚</p><ul><li><p>åœ¨æœ¬ä¾‹ä¸­ï¼ŒMain.oå’ŒLibtest.oä¸­çš„ä»£ç æ®µå’Œæ•°æ®æ®µè¢«åˆå¹¶æ‹·è´åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œç„¶åè¿›è¡Œè§£æé‡å®šä½ã€‚</p></li><li><p>ä¸‹å›¾è¿›è¡Œäº†å›¾è§£å±•ç¤ºåˆå¹¶è¿‡ç¨‹ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/807220-2e1bc10a88be493b" alt="img"></p></li></ul><p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å·²ç»æ˜ç™½ï¼Œåœ¨é™æ€é“¾æ¥ä¸­å¤–éƒ¨ç¬¦å·ï¼š</p><ul><li><strong>ä¸ºä»€ä¹ˆè¦è¢«è§£æé‡å®šä½</strong>ï¼šå¤–éƒ¨ç¬¦å·èƒ½è¢«å®šä½åˆ°çœŸæ­£å®ç°çš„åœ°æ–¹ï¼›</li><li><strong>å¦‚ä½•è¢«è§£æé‡å®šä½</strong>ï¼šé€šè¿‡ç¬¦å·è¡¨å®ç°ã€‚</li></ul><p>åŒæ—¶ï¼Œé™æ€é“¾æ¥è¿˜ä¼šå°†éœ€è¦çš„ç›®æ ‡æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå› æ­¤ä½“ç§¯æ¯”è¾ƒå¤§ã€‚</p><h5 id="åŠ¨æ€é“¾æ¥è¿‡ç¨‹">åŠ¨æ€é“¾æ¥è¿‡ç¨‹</h5><p><strong>ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€é“¾æ¥</strong>ï¼Ÿ</p><p>è¯•è¯•æƒ³æƒ³ä»¥ä¸‹ä¸¤ç§ç³Ÿç³•çš„æƒ…å†µï¼š</p><ul><li><p><strong>ç©ºé—´æµªè´¹</strong>ï¼š å‡è®¾ä½ æ˜¯ä¸ªè…¾è®¯æŠ€æœ¯ä¸“å®¶ï¼Œä½ å†™çš„ä»£ç Libtest.cppæ€§èƒ½æŒºå¥½ï¼Œäºæ˜¯å¼€æºå‡ºæ¥<strong>ç”Ÿæˆä¸€ä¸ªé™æ€åº“</strong>ç»™å…¶å®ƒäººä¹Ÿç”¨ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -c Libtest.cpp -o libtest.o</span><br><span class="line">ar cqs libtest.a libtest.o</span><br></pre></td></tr></table></figure><p>githubååº”ä¸é”™ï¼Œä½ çš„å¤§ä½œå¾ˆå—æ¬¢è¿ï¼ŒåŸºæœ¬æœºå™¨ä¸Šæ¯ä¸ªç¨‹åºéƒ½è°ƒç”¨äº†ä½ çš„åº“ã€‚ä½†æ˜¯<strong>ç”±äºæ¯ä¸ªç¨‹åºéƒ½é™æ€é“¾æ¥ä½ çš„é™æ€åº“libtest.aï¼Œå¯¼è‡´æ¯ä¸ªç¨‹åºéƒ½ä¼šã€æ‹·è´ã€‘Libtest.aä¸­çš„ä»£ç </strong>ï¼Œé€ æˆäº†å¾ˆå¤§çš„ç©ºé—´æµªè´¹ã€‚</p></li><li><p><strong>æ›´æ–°å›°éš¾</strong>ï¼š ä¸å¹¸çš„æ˜¯ï¼Œä½ ä¸ä½†æŠ€æœ¯ç²¾æ¹›<s>å¤´å‘ç¨€å°‘</s>åŒæ—¶ç²¾åŠ›æ—ºç››ï¼Œç»å¸¸å¯¹ä½ çš„å¤§ä½œlibtest.aè¿›è¡Œæ›´æ–°ã€‚è¿™æ ·ä½ æ¯æ›´æ–°ä¸€æ¬¡ï¼Œ<strong>ä¸ºäº†è·Ÿä¸Šä½ æŠ€æœ¯ä¸“å®¶çš„æ­¥ä¼ï¼Œæ‰€æœ‰çš„ç¨‹åºéƒ½è¦é‡æ–°ç¼–è¯‘ä¸€æ¬¡ï¼Œæ¥é™æ€é“¾æ¥æ‹·è´ä½ çš„æœ€æ–°ä»£ç </strong>ã€‚æƒ…å†µä¸¥é‡çš„è¯ï¼Œè¿™å¯èƒ½æ”¶åˆ°ä¸€äº›ç¤¼è²Œçš„é—®å€™ã€‚</p></li></ul><p>èªæ˜çš„ä½ ï¼Œè‡ªç„¶æƒ³åˆ°å·å¬å¤§å®¶ä½¿ç”¨<strong>åŠ¨æ€é“¾æ¥</strong>ï¼š</p><ul><li>å¯¹é‚£äº›ç»„æˆç¨‹åºçš„ç›®æ ‡æ–‡ä»¶ï¼Œæ¯”å¦‚ä½ çš„libtestï¼Œä¸è¿›è¡Œç›´æ¥é“¾æ¥ï¼Œè€Œåªæ˜¯å°†<strong>å¿…è¦ä¿¡æ¯å†™å…¥äº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç­‰åˆ°ç¨‹åºè¦è¿è¡Œæ—¶æ‰è¿›è¡Œé“¾æ¥</strong>ã€‚è¿™æ ·ä»–ä»¬åªç”¨ä¸‹è½½ä½ å¤§ä½œlibtest.soæœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶å°±ä¼šè‡ªåŠ¨ï¼ˆåŠ¨æ€ï¼‰é“¾æ¥æ–°ç‰ˆæœ¬ï¼Œä»è€Œ<strong>ä¸ç”¨é‡æ–°ç¼–è¯‘</strong>äº†ã€‚</li></ul><p>äºæ˜¯ä½ å¼€å¿ƒåœ°å¼€å§‹å°è¯•ä¸‹åŠ¨æ€é“¾æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”ŸæˆåŠ¨æ€åº“</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆçš„åŠ¨æ€åº“çš„åå­—å¿…é¡»æ˜¯lib+åå­—.so</span></span><br><span class="line">g++ -shared  -o libtest.so Libtest.cpp</span><br><span class="line"><span class="comment"># ä¿å­˜åœ¨/usr/lib64/ä¸‹</span></span><br><span class="line">mv libtest.so  /usr/lib64/</span><br><span class="line"><span class="comment"># åŠ¨æ€é“¾æ¥ä½ çš„å¤§ä½œlibtest.soï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨-ltestæ¥å¼•ç”¨</span></span><br><span class="line">g++  Main.cpp  -L/usr/lib64/ -ltest -o main.out</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶<code>main.out</code>ã€‚</p><p>ä½†æ˜¯<code>main.out</code><strong>ä»…åŒ…å«äº†<code>libtest.so</code> çš„ç›¸å…³ç¬¦å·ä¿¡æ¯</strong>ï¼Œå¹¶æ²¡æœ‰å°† <code>libtest.so</code>å’Œ <code>main.out</code>åˆå¹¶ã€‚åªæœ‰å½“æˆ‘ä»¬æ‰§è¡Œ <code>./main.out</code> ï¼Œæ­¤æ—¶æ‰ä¼šåŠ¨æ€åŠ è½½<code>Libtest.so</code> ã€‚</p><blockquote><p>å‰é¢æåˆ°çš„<code>hello.out</code>ä¸­çš„<code>std::cout</code> ä¹Ÿæ˜¯åŠ¨æ€é“¾æ¥çš„ï¼š</p><ol><li>ç¼–è¯‘ç”Ÿæˆäº†å¯æ‰§è¡Œæ–‡ä»¶<code>hello.out</code> ï¼Œä½†æ­¤æ—¶<code>hello.out</code>åªåŒ…å«äº†<code>cout</code>ç¬¦å·ä¿¡æ¯ï¼›</li><li>æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶<code>hello.out</code>æ—¶ ï¼Œæ ¹æ®<code>cout</code>ç¬¦å·ä¿¡æ¯åŠ è½½<code>libstdc++.so.6</code> åŠ¨æ€åº“ã€‚</li></ol></blockquote><p>ä»ä¸Šä¹Ÿå›ç­”æœ¬èŠ‚å¼€å¤´çš„é—®é¢˜ï¼š<strong>åŠ¨æ€é“¾æ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯å°ï¼Œé¿å…äº†ç©ºé—´æµªè´¹ï¼ŒåŒæ—¶çµæ´»æ€§å¼º</strong>ã€‚è¿™ä¹Ÿå°±æ˜¯ä½¿ç”¨åŠ¨æ€é“¾æ¥çš„ä¸»è¦åŸå› ã€‚</p><p>é‚£ä¹ˆï¼ŒåŠ¨æ€é“¾æ¥çš„éœ€è¦çš„åŠ¨æ€åº“ï¼Œå’Œé™æ€é“¾æ¥éœ€è¦çš„é™æ€åº“åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><h5 id="é™æ€åº“å’ŒåŠ¨æ€åº“">é™æ€åº“å’ŒåŠ¨æ€åº“</h5><blockquote><p>Windowsä¸‹çš„é™æ€åº“å’ŒåŠ¨æ€åº“åˆ†åˆ«ä¸º<code>.lib</code>å’Œ<code>.dll</code> ç»“å°¾çš„æ–‡ä»¶ï¼Œæœ¬èŠ‚ä¸­ä»…ä»¥åœ¨Linuxç³»ç»Ÿä¸­è¯´æ˜ç›¸å…³æ¦‚å¿µã€‚</p></blockquote><p>Linux ä¸‹çš„åº“æœ‰ä¸¤ç§<sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="C/C++ä¸­å…³äºé™æ€é“¾æ¥åº“(.a)ã€åŠ¨æ€é“¾æ¥åº“ï¼ˆ.soï¼‰çš„ç¼–è¯‘ä¸ä½¿ç”¨ï¼šhttps://blog.csdn.net/qq_27825451/article/details/105700361">[8]</span></a></sup>ï¼š<strong>é™æ€åº“(.a</strong>)å’Œ<strong>å…±äº«åº“ï¼ˆåŠ¨æ€åº“ï¼Œ.so</strong>ï¼‰ ï¼Œéƒ½é‡‡ç”¨ä»¥ä¸‹æ–¹å¼è¿›è¡Œé“¾æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ã€ä¾‹ã€‘Main.cppåŠ¨æ€é“¾æ¥libtest.soï¼Œé™æ€é“¾æ¥éœ€åŠ ä¸Š-staticå‚æ•°</span></span><br><span class="line"><span class="comment"># -Lï¼šæŒ‡å®šæœç´ è·¯å¾„ï¼Œ:å¯åˆ†éš”å¤šä¸ªè·¯å¾„</span></span><br><span class="line"><span class="comment"># -lï¼šæŒ‡å®šåº“åï¼Œå‰ç¼€&quot;lib&quot;å’Œåç¼€&quot;.a&quot; æˆ–&quot;.so&quot;çœç•¥</span></span><br><span class="line">g++  Main.cpp  -L/usr/lib64/ -ltest -o main.out</span><br></pre></td></tr></table></figure><ul><li><p><strong>é™æ€åº“</strong></p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šç¼–è¯‘è¿‡ç¨‹ä¸­å·²ç»è¢«è½½å…¥å¯æ‰§è¡Œç¨‹åºï¼Œå› æ­¤ä½“ç§¯è¾ƒå¤§ï¼›</p></li><li><p><strong>å‘½å</strong>ï¼š.aä¸ºåç¼€ï¼Œlibä¸ºå‰ç¼€ï¼Œ ä¾‹å¦‚ <code>libtest.a</code> ï¼›</p></li><li><p><strong>ç”Ÿæˆ</strong>ï¼šå…ˆç”Ÿæˆ<code>.o</code> æ–‡ä»¶ï¼Œå†ç”¨<code>ar</code>å·¥å…·å¯ç”Ÿæˆï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -c Libtest.cpp -o libtest.o</span><br><span class="line">ar cqs libtest.a libtest.o</span><br></pre></td></tr></table></figure></li><li><p><strong>é“¾æ¥è·¯å¾„</strong>ï¼š</p><ol><li><strong>å‚æ•°-L</strong>ï¼šldä¼šå»æ‰¾gcc/g++å‘½ä»¤ä¸­çš„å‚æ•°<code>-L</code>æŒ‡å®šçš„è·¯å¾„ï¼›</li><li><strong>ç¯å¢ƒå˜é‡</strong>ï¼šgccçš„ç¯å¢ƒå˜é‡<code>LIBRARY_PATH</code>ï¼Œå®ƒæŒ‡å®šç¨‹åº<strong>é™æ€</strong>é“¾æ¥åº“æ–‡ä»¶æœç´¢è·¯å¾„ï¼›</li><li><strong>é»˜è®¤åº“</strong>ï¼šå†æ‰¾é»˜è®¤åº“ç›®å½• <code>/lib</code>ã€ <code>/usr/lib</code>ã€ <code>/usr/local/lib</code>ã€‚</li></ol></li></ul></li><li><p><strong>åŠ¨æ€åº“</strong></p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼šå¯æ‰§è¡Œç¨‹åºè¿è¡Œæ—¶æ‰è½½å…¥å†…å­˜çš„ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä»…ç®€å•çš„å¼•ç”¨ï¼Œå› æ­¤ä»£ç ä½“ç§¯è¾ƒå°ï¼›</p></li><li><p><strong>å‘½å</strong>ï¼š.soä¸ºåç¼€ï¼Œlibä¸ºå‰ç¼€ï¼Œé€šå¸¸è¿˜ä¼šåŠ ä¸Šç‰ˆæœ¬å·ï¼Œ ä¾‹å¦‚ <code>libtest.a.0.1</code> ;</p></li><li><p><strong>ç”Ÿæˆ</strong>ï¼š<code>g++</code>å·¥å…·å¯ç”Ÿæˆï¼›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -c Libtest.cpp -o libtest.o</span><br><span class="line">g++ -shared  libtest.o -o libtest.so.1.0</span><br></pre></td></tr></table></figure></li><li><p><strong>é“¾æ¥è·¯å¾„</strong>ï¼š</p><ol><li><strong>å‚æ•°-L</strong>ï¼šldä¼šå»æ‰¾gcc/g++å‘½ä»¤ä¸­çš„å‚æ•°<code>-L</code>æŒ‡å®šçš„è·¯å¾„ï¼›</li><li><strong>ç¯å¢ƒå˜é‡</strong>ï¼šgccçš„ç¯å¢ƒå˜é‡<code>LD_LIBRARY_PATH</code>ï¼Œå®ƒæŒ‡å®šç¨‹åº<strong>åŠ¨æ€</strong>é“¾æ¥åº“æ–‡ä»¶æœç´¢è·¯å¾„ï¼›</li><li><strong>é…ç½®æ–‡ä»¶</strong>ï¼šé…ç½®æ–‡ä»¶ <code>/etc/ld.so.conf</code> ä¸­æŒ‡å®šåŠ¨æ€åº“è·¯å¾„ï¼›</li><li><strong>é»˜è®¤åº“</strong>ï¼šå†æ‰¾é»˜è®¤åº“ç›®å½• <code>/lib</code>ã€ <code>/usr/lib</code>ã€‚</li></ol></li></ul></li></ul><h4 id="å…¨è¿‡ç¨‹æ€»ç»“">å…¨è¿‡ç¨‹æ€»ç»“</h4><blockquote><p>æºç åˆ°æ‰§è¡Œå…¨è¿‡ç¨‹åˆ†æã€‚</p></blockquote><p>åœ¨linuxä¸­ç¨‹åºçš„åŠ è½½ï¼ˆä¸æ˜¯é“¾æ¥ï¼‰ï¼Œæ¶‰åŠåˆ°linkerå’Œloaderä¸¤ä¸ªå·¥å…·ã€‚linkerä¸»è¦æ¶‰åŠåŠ¨æ€é“¾æ¥åº“çš„ä½¿ç”¨ï¼Œloaderä¸»è¦æ¶‰åŠè½¯ä»¶çš„åŠ è½½ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/807220-3b44242bee5ba363" alt="img" style="zoom:80%;" /><p>ä¸Šå›¾æ˜¯ä¸€ä¸ªå…¸å‹çš„ç¼–è¯‘å°†æºæ–‡ä»¶<code>main.cpp</code> ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶<code>myProc.out</code> å¹¶æ‰§è¡Œçš„è¿‡ç¨‹ ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cpp -L/usr/lib -laaa  -lbbb -o myProc.out </span><br><span class="line">./myProc.out </span><br></pre></td></tr></table></figure><ol><li><p><strong>é“¾æ¥å‰</strong>ï¼šä¾æ¬¡æŒ‰é¢„å¤„ç†â†’ç¼–è¯‘â†’æ±‡ç¼–ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶<code>main.o</code> ï¼›</p></li><li><p><strong>é“¾æ¥</strong>ï¼šåˆ†é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ã€‚</p><ul><li><strong>é™æ€é“¾æ¥</strong>ï¼šå¯¹<code>main.o</code> ä¸­æœªå®šä¹‰çš„ç¬¦å·è¿›è¡Œè§£æé‡å®šä½åˆ°é™æ€åº“<code>aaa.o</code> ä¸­ï¼Œç„¶åæŠŠéœ€è¦çš„ç›®æ ‡æ–‡ä»¶<code>lib1.o</code> ã€<code>lib2.o</code> å’Œ<code>main.o</code> çš„.textæ®µã€.dataæ®µã€.bssæ®µè¿›è¡Œåˆå¹¶ç”Ÿæˆåˆæ­¥çš„å¯æ‰§è¡Œæ–‡ä»¶<code>myProc.out</code> ï¼›</li><li><strong>åŠ¨æ€é“¾æ¥</strong>ï¼šæ­¤æ—¶<code>main.o</code> ä¸­ä¾æ—§æœ‰éƒ¨åˆ†ç¬¦å·æ²¡æœ‰è¢«è§£æï¼Œå®ƒä»¬çš„å®ç°å­˜äºåŠ¨æ€åº“<code>bbb.so</code>ä¸­ ï¼Œä½†åŠ¨æ€é“¾æ¥ä»…å°†<code>bbb.so</code> ç›¸å…³<u>ç¬¦å·ä¿¡æ¯</u>ä¿å­˜åœ¨<code>myProc.out</code>ä¸­ã€‚</li></ul><p>ç°åœ¨æˆ‘ä»¬è·å–æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶<code>myProc.out</code>ã€‚</p></li><li><p><strong>æ‰§è¡Œ</strong>ï¼šæ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p><code>myProc.out</code> ç”±ä»£ç æ®µï¼ˆ.textï¼Œåªè¯»å¯æ‰§è¡Œï¼‰ï¼Œæ•°æ®æ®µï¼ˆ.dataï¼Œåªè¯»ï¼‰ï¼Œ.bssæ®µç»„æˆï¼Œç°åœ¨çœ‹çœ‹å¦‚ä½•è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./myProc.out  <span class="comment"># å¼€å§‹æ‰§è¡Œç¨‹åºï¼Œé€šè¿‡loaderåŠ è½½å™¨åŠ è½½ç¨‹åº</span></span><br></pre></td></tr></table></figure><ul><li><strong>å†…å­˜æ˜ å°„</strong>ã€‚loaderå¯åŠ¨é€šè¿‡mmapç³»ç»Ÿè°ƒç”¨ï¼Œå°†ä»£ç æ®µå’Œæ•°æ®æ®µæ˜ å°„åˆ°<u>è™šæ‹Ÿå†…å­˜</u>ä¸­ ï¼Œä¸å ç‰©ç†å†…å­˜ï¼›</li><li><strong>åŠ¨æ€åº“åŠ è½½</strong>ã€‚åŠ¨æ€é“¾æ¥å™¨å°†ç¼–è¯‘æ—¶æŒ‡æ˜ä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“ï¼Œæ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸­ï¼›</li><li><strong>æ‰§è¡Œ<code>.text</code> ä¸­æŒ‡ä»¤</strong>ã€‚ç¨‹åºå¼€å§‹è¿è¡Œï¼Œé€šå¸¸ä¼´éšç€æ ˆã€å †ç©ºé—´åˆ†é…ç­‰ã€‚</li></ul></li></ol><h3 id="ç¼–è¯‘å·¥å…·ç®€ä»‹">ç¼–è¯‘å·¥å…·ç®€ä»‹</h3><p>åœ¨å‰é¢æˆ‘ä»¬ç®€å•ä½¿ç”¨g++è¿›è¡Œæ–‡ä»¶ç¼–è¯‘ã€æ‰§è¡Œã€‚å½“ç„¶ï¼Œä¸»è¦è¿˜æ˜¯åâ€œ<strong>åŠ¡è™š</strong>â€æ¢è®¨äº†ä¸‹ç¼–è¯‘çš„è¿‡ç¨‹åŠåŸç†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åâ€<strong>åŠ¡å®</strong>â€œçš„ä»‹ç»ä¸€ä¸‹åŸºæœ¬ä¸‰å¤§ç¼–è¯‘å·¥å…·çš„ä½¿ç”¨ ï¼šg++/Makefile/CMakeã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/catkin.jpg" alt="ROSè¯¾ç¨‹è®²ä¹‰--2.1 Catkinç¼–è¯‘ç³»ç»Ÿ_jinking01çš„ä¸“æ -CSDNåšå®¢"></p><p>ä¸‰è€…å…³ç³»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><ul><li><strong>gcc/g++</strong>ï¼šLinuxç¼–è¯‘å™¨æœ‰gcc/g++ï¼Œéšç€æºæ–‡ä»¶çš„å¢åŠ ï¼Œç›´æ¥ç”¨gcc/g++å‘½ä»¤çš„æ–¹å¼<strong>æ•ˆç‡è¾ƒä½</strong>ï¼Œäºæ˜¯å‘æ˜äº†Makefileæ¥è¿›è¡Œç¼–è¯‘ï¼›</li><li><strong>Makefile</strong>ï¼š Makefileæè¿°äº†æ•´ä¸ªå·¥ç¨‹çš„ç¼–è¯‘ã€é“¾æ¥ç­‰è§„åˆ™ï¼Œå¯ä»¥<strong>æœ‰æ•ˆçš„å‡å°‘å¤§å·¥ç¨‹ä¸­éœ€è¦ç¼–è¯‘å’Œé“¾æ¥çš„æ–‡ä»¶ï¼Œåªç¼–è¯‘å’Œé“¾æ¥é‚£äº›éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶</strong>ã€‚ç„¶è€Œéšç€å·¥ç¨‹ä½“é‡çš„å¢å¤§ï¼ŒMakefileä¹Ÿä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œäºæ˜¯ä¾¿å‡ºç°äº†Cmakeå·¥å…·ï¼›</li><li><strong>CMake</strong>ï¼šCMakeæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç¼–è¯‘(Build)å·¥å…·ï¼Œå¯ä»¥ç”¨ç®€å•çš„è¯­å¥æ¥æè¿°æ‰€æœ‰å¹³å°çš„ç¼–è¯‘è¿‡ç¨‹ã€‚æ—©æœŸçš„makeéœ€è¦ç¨‹åºå‘˜å†™Makefileæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œè€Œç°åœ¨CMakeèƒ½å¤Ÿé€šè¿‡å¯¹<a href="https://www.zhihu.com/search?q=cmakelists.txt&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22article%22%2C%22sourceId%22%3A%2255027085%22%7D">CMakeLists.txt</a>çš„ç¼–è¾‘ï¼Œ<strong>è½»æ¾å®ç°å¯¹å¤æ‚å·¥ç¨‹çš„ç»„ç»‡</strong>ã€‚</li></ul><p>å…·ä½“å®æ“ç»ƒä¹ æŒæ¡ã€‚</p><h3 id="Makefile">Makefile</h3><h4 id="å¿«é€Ÿå…¥é—¨-2">å¿«é€Ÿå…¥é—¨</h4><p>MakefileåŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;target&gt; : &lt;prerequisites&gt; </span><br><span class="line">[tab]  &lt;commands&gt;</span><br></pre></td></tr></table></figure><ul><li><p><strong>targetï¼ˆç›®æ ‡ï¼‰</strong> ï¼š ç›®æ ‡æ–‡ä»¶, å¯ä»¥æ˜¯ Object File, ä¹Ÿå¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼›</p></li><li><p><strong>prerequisitesï¼ˆå‰ç½®æ¡ä»¶ï¼‰</strong> ï¼š ç”Ÿæˆtargetæ‰€éœ€è¦çš„æ–‡ä»¶æˆ–è€…ç›®æ ‡ï¼›</p></li><li><p><strong>commandï¼ˆå‘½ä»¤ï¼‰</strong>ï¼š makeéœ€è¦æ‰§è¡Œçš„å‘½ä»¤(ä»»æ„çš„shellå‘½ä»¤)ï¼ŒMakefileä¸­çš„å‘½ä»¤å¿…é¡»ä»¥ <code>[tab],å³å››ä¸ªç©ºæ ¼</code> å¼€å¤´ã€‚</p></li></ul><p><strong>åŸºæœ¬è¯­æ³•</strong></p><blockquote><p>å…ˆç†Ÿæ‚‰ä»¥ä¸‹åç†è®ºæ€»ç»“ä¸Šçš„ä¸œè¥¿ï¼Œå®è·µæ—¶äº’ç›¸éªŒè¯æ•ˆæœæ›´å¥½~</p></blockquote><p>MakefileåŒ…å«äº†äº”ä¸ªé‡è¦çš„ä¸œè¥¿ï¼š<strong>æ˜¾ç¤ºè§„åˆ™ã€éšæ™¦è§„åˆ™ã€å˜é‡å®šä¹‰ã€æ–‡ä»¶æŒ‡ç¤ºå’Œæ³¨é‡Š</strong>ã€‚</p><ul><li><strong>æ˜¾ç¤ºè§„åˆ™</strong>ï¼š å³<strong>éœ€è¦æŒ‡æ˜targetå’Œprerequisiteæ–‡ä»¶</strong>ã€‚<ul><li><u>ä¸€æ¡è§„åˆ™å¯ä»¥åŒ…å«å¤šä¸ªtarget</u>ï¼Œè¿™æ„å‘³ç€å…¶ä¸­æ¯ä¸ªtargetçš„prerequisiteéƒ½æ˜¯ç›¸åŒçš„ï¼›</li><li><u>å½“å…¶ä¸­çš„ä¸€ä¸ªtargetè¢«ä¿®æ”¹å</u>ï¼Œæ•´ä¸ªè§„åˆ™ä¸­çš„å…¶ä»–targetæ–‡ä»¶éƒ½ä¼šè¢«é‡æ–°ç¼–è¯‘æˆ–æ‰§è¡Œã€‚</li></ul></li><li><strong>éšæ™¦è§„åˆ™</strong>ï¼šmakeè‡ªåŠ¨æ¨å¯¼åŠŸèƒ½æ‰€æ‰§è¡Œçš„è§„åˆ™ã€‚</li><li><strong>å˜é‡å’Œå®šä¹‰</strong>ï¼šMakefileä¸­å®šä¹‰çš„å˜é‡ï¼Œä¸€èˆ¬æ˜¯å­—ç¬¦ä¸²ã€‚</li><li><strong>æ–‡ä»¶æŒ‡ç¤º</strong>ï¼šé€šå¸¸æŒ‡ä»¥ä¸‹<ol><li>Makefileä¸­å¼•ç”¨å…¶ä»–Makefileï¼›</li><li>æŒ‡å®šMakefileä¸­æœ‰æ•ˆéƒ¨åˆ†ï¼›</li><li>å®šä¹‰ä¸€ä¸ªå¤šè¡Œå‘½ä»¤ã€‚</li></ol></li><li><strong>æ³¨é‡Š</strong>ï¼šåªæœ‰è¡Œæ³¨é‡Š<code>#</code> ã€‚</li></ul><h5 id="ä¸€èµ·è¯•è¯•">ä¸€èµ·è¯•è¯•</h5><p>æˆ‘ä»¬å‡†äº†ä¸€æ®µä»£ç <code>DisplayImage.cpp</code>ï¼šä½¿ç”¨c++å’Œopencvå¯¹å›¾ç‰‡è¿›è¡Œè¯»å–å’Œæ˜¾ç¤ºã€‚</p><p>ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä»£ç å·²ç»å°½é‡ç²¾ç®€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¯»å–</span></span><br><span class="line">    Mat image = cv.<span class="built_in">imread</span>( argv[<span class="number">1</span>], <span class="number">1</span> );</span><br><span class="line">    <span class="comment">// æ˜¾ç¤º</span></span><br><span class="line">    cv.<span class="built_in">namedWindow</span>(<span class="string">&quot;Display Image&quot;</span>, WINDOW_AUTOSIZE );</span><br><span class="line">    cv.<span class="built_in">imshow</span>(<span class="string">&quot;Display Image&quot;</span>, image);</span><br><span class="line">    cv.<span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆç»™å‡ºå·²å®Œæˆçš„Makefileæ–‡ä»¶ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/home/royhuang/lib/pkgconfig</span><br><span class="line"></span><br><span class="line">CXXFLAGS:=<span class="variable">$(<span class="built_in">shell</span> pkg-config --cflgs --libs opencv)</span></span><br><span class="line"></span><br><span class="line"><span class="section">DispalyImage:DispalyImage.o</span></span><br><span class="line">g++ DispalyImage.o -o DispalyImage</span><br><span class="line"><span class="section">DispalyImage.o:DispalyImage.cpp</span></span><br><span class="line">        g++ -c DispalyImage.cpp -o DispalyImage.o</span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">rm *o test</span><br></pre></td></tr></table></figure><p>ç°åœ¨å»ºè®®æˆ‘ä»¬<strong>ä»ä¸‹å¾€ä¸Š</strong>åˆ†æï¼š</p><ol><li><p><strong>ç¼–å†™clean</strong> ï¼šåˆ é™¤æ‰€æœ‰çš„.oæ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé¿å…è¿‡å¤šçš„ä¸­é—´æ–‡ä»¶äº§ç”Ÿï¼›</p></li><li><p><strong>ç¼–å†™ DispalyImage.o:DispalyImage.cpp</strong> ï¼šæ ¹æ®ä¹‹å‰çš„æ ¼å¼ï¼Œ<code>target  : prerequisites</code> ï¼Œè¿™ä¸ªæ—¶å€™ <code>target</code> ä¸º   <strong>DispalyImage.o</strong> ï¼Œ<code>prerequisites</code> ä¸º<strong>DispalyImage.cpp</strong> ã€‚</p><p>ä¸‹ä¸€è¡Œçš„g++å‘½ä»¤ï¼Œå°†cppæ–‡ä»¶è¿›è¡Œç¼–è¯‘ä¸ºobject fileï¼ˆ<code>.o</code> æ–‡ä»¶ï¼‰ã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">DispalyImage.o:DispalyImage.cpp</span></span><br><span class="line">        g++ -c DispalyImage.cpp -o DispalyImage.o</span><br></pre></td></tr></table></figure></li><li><p><strong>ç¼–å†™ DispalyImage:DispalyImage.o</strong> ï¼šåœ¨ä¸Šä¸€æ­¥æˆ‘ä»¬å¾—åˆ°äº†ç¼–è¯‘åçš„ç›®æ ‡æ–‡ä»¶ DispalyImage.o ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥buildç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶DispalyImageã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">DispalyImage:DispalyImage.o</span></span><br><span class="line">g++ DispalyImage.o -o DispalyImage</span><br></pre></td></tr></table></figure></li><li><p><strong>åº”ç”¨OpenCVåº“å’Œå¤´æ–‡ä»¶</strong> ã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/home/royhuang/lib/pkgconfig</span><br><span class="line"></span><br><span class="line">CXXFLAGS:=<span class="variable">$(<span class="built_in">shell</span> pkg-config --cflgs --libs opencv)</span></span><br></pre></td></tr></table></figure><ul><li><p><code>PKG_CONFIG_PATH</code> ï¼šæ·»åŠ æŒ‡å®šè·¯å¾„åˆ°ç¯å¢ƒå˜é‡ã€‚å¦‚ä¸Šä¾‹ï¼Œæ·»åŠ äº†è·¯å¾„<code>/home/royhuang/lib/pkgconfig</code>åˆ°ç¯å¢ƒå˜é‡ ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨<code>pkg-config</code>å‘½ä»¤ ã€‚</p></li><li><p><code>CXXFLAGS</code> ï¼šæŒ‡å®šæ–‡ä»¶ï¼ˆ.hæ–‡ä»¶æˆ–libæ–‡ä»¶ï¼‰çš„è·¯å¾„ï¼Œä½¿å¾—ç¼–è¯‘æ—¶å¯ä»¥æ‰¾åˆ°ç›¸åº”å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ã€‚</p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>pkg-config</code>å‘½ä»¤å¯æŸ¥çœ‹opencvçš„includeå¤´æ–‡ä»¶çš„è·¯å¾„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --libs å‚æ•°å¯æŸ¥çœ‹åº“æ–‡ä»¶</span></span><br><span class="line">shell pkg-config --cflgs  opencv</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¼•å…¥å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg-config opencv --cflgs --libs opencv</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>æœ‰äº†<code>makefile</code>æ–‡ä»¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥makeç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶<code>DisplayImage</code>äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹å«â€œMakefileâ€æˆ–â€œmakefileâ€çš„æ–‡ä»¶</span></span><br><span class="line">make </span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå›¾åƒ</span></span><br><span class="line">./DisplayImage ../01.jpg</span><br></pre></td></tr></table></figure><p>ä»ä¸Šä¹Ÿå¯æ€»ç»“å‡ºï¼š<strong>Makefile åŒ…å«äº†æ‰€æœ‰çš„è§„åˆ™å’Œç›®æ ‡ï¼Œè€Œ make åˆ™æ˜¯ä¸ºäº†å®Œæˆç›®æ ‡è€Œå»è§£é‡Š Makefile è§„åˆ™çš„å·¥å…·</strong>ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒMakefileçš„åŸºæœ¬å¥—è·¯å°±æ˜¯ä»¥ä¸Šï¼Œç†Ÿç»ƒä½¿ç”¨éœ€è¦å®é™…é¡¹ç›®å¤šç»ƒä¹ ä¸‹ã€‚</p><h4 id="è¿›é˜¶å­¦ä¹ ">è¿›é˜¶å­¦ä¹ </h4><p>è¿™é‡Œå‡†å¤‡ä¸¾ä¸€äº›è¾ƒå¤æ‚çš„é¡¹ç›®ï¼Œæ€ä¹ˆæ¥ç¼–å†™Makefileæ–‡ä»¶ã€‚</p><p>ä½†æ˜¯ä¸€èˆ¬è¾ƒå¤æ‚çš„é¡¹ç›®æˆ‘ç°åœ¨ä¸€èˆ¬ç”¨<strong>CMake</strong>ï¼Œä¹Ÿæ˜¯åæ–‡éœ€è¦ä»‹ç»çš„ã€‚å› æ­¤è¿™é‡Œå¤æ‚é¡¹ç›®Makefileç¼–å†™æ¡ˆä¾‹ï¼Œæš‚æ—¶ç•™ç™½ï¼Œåç»­è¡¥ä¸Šã€‚</p><p>å½“ç„¶ï¼Œä½ å¯ä»¥å…ˆçœ‹çœ‹ï¼š<a href="https://www.ruanyifeng.com/blog/2015/02/make.html">Make å‘½ä»¤æ•™ç¨‹ - é˜®ä¸€å³°</a> ã€‚</p><h3 id="CMake">CMake</h3><p>æ—©æœŸçš„makeéœ€è¦ç¨‹åºå‘˜å†™Makefileæ–‡ä»¶ï¼Œè¿›è¡Œç¼–è¯‘ã€‚è€Œç°åœ¨CMakeèƒ½å¤Ÿé€šè¿‡å¯¹<code>CmakeLists.txt</code>çš„ç¼–è¾‘ï¼Œè½»æ¾å®ç°å¯¹å¤æ‚å·¥ç¨‹çš„ç»„ç»‡ã€‚</p><h4 id="å¿«é€Ÿå…¥é—¨-3">å¿«é€Ÿå…¥é—¨</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨Linuxç³»ç»Ÿï¼ˆCentOSï¼‰ä¸‹å®‰è£…ä¸‹CMakeï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install cmake</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬ä½¿ç”¨CMakeç”ŸæˆMakefileå¹¶ç¼–è¯‘çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç¼–å†™<code>CMakeLists.txt</code>ï¼Œå‡å®šå…¶è·¯å¾„ä¸º<code>PATH</code>ï¼›</li><li>æ‰§è¡Œå‘½ä»¤<code>cmake PATH</code>ç”ŸæˆMakefileï¼›</li><li>æœ€åä½¿ç”¨<code>make</code>è¿›è¡Œç¼–è¯‘ã€‚</li></ol><h5 id="ä¸€èµ·è¯•è¯•-2">ä¸€èµ·è¯•è¯•</h5><p>æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ª<code>hello.cpp</code> æ–‡ä»¶ï¼Œå®ƒæ‰€åœ¨çš„ç›®å½•å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-- build  <span class="comment"># cmakeç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶éƒ½æ”¾è¿™</span></span><br><span class="line">|-- hello.cpp</span><br><span class="line">|-- CMakeLists.txt <span class="comment"># æ¯ä¸ªå­ç›®å½•ä¸‹éƒ½è¦æœ‰CMakeLists.txtæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹å¾ˆç®€å•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* hello.cpp */</span> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Hello Cpp!&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç¼–å†™çš„<code>CMakeLists.txt</code>ï¼Œæ¯ä¸€è¡Œä»£ç è§£é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼ï¼š&lt;å‘½ä»¤å&gt;(å‚æ•° å‚æ•°å€¼) ï¼Œä¸­é—´å‚æ•°ç©ºæ ¼éš”å¼€</span></span><br><span class="line"><span class="comment"># è®¾ç½®é¡¹ç›®å</span></span><br><span class="line"><span class="keyword">project</span>(helloDemo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™å®šCMAKEæœ€ä½ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">CMAKE_MINIMUM_REQUIRED</span>(VERSION <span class="number">2.6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢å½“å‰ç›®å½•æ‰€æœ‰æºä»£ç æ–‡ä»¶ï¼Œå¹¶èµ‹å€¼ç»™PROJECT_ROOT_SRCS</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. PROJECT_ROOT_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ C++11ç‰¹æ€§</span></span><br><span class="line"><span class="keyword">add_definitions</span>(-std=c++<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add_executable ä»ä¸€ç»„æºæ–‡ä»¶ç¼–è¯‘å‡ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ </span></span><br><span class="line"><span class="comment"># è¿™é‡Œå°†$&#123;PROJECT_ROOT_SRCS&#125;ä¸­æ–‡ä»¶ç¼–è¯‘ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶hello.out</span></span><br><span class="line"><span class="keyword">add_executable</span>(hello.out <span class="variable">$&#123;PROJECT_ROOT_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure><p>å¼€å§‹ç¼–è¯‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆmakefileç­‰ä¸­é—´æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ ã€å¦‚æœè¦å¯ä»¥è¢«è°ƒè¯•ã€‘ï¼Œè¿˜è¦å¸¦ä¸Šå‚æ•°ï¼šcmake -DCMAKE_BUILD_TYPE:STRING=Debug</span></span><br><span class="line"><span class="built_in">cd</span> ./build  &amp;&amp; cmake ..</span><br><span class="line"><span class="comment"># ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œåˆšåˆšç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hello.out</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211209221810181.png" alt="image-20211209221810181"></p><p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¯¹CMakeæœ‰äº†ä¸ªåŸºæœ¬çš„è®¤çŸ¥ã€‚åœ¨å‰é¢æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼ŒCMakeé€šå¸¸æ˜¯ç”¨æ¥ç¼–è¯‘å¤§å‹é¡¹ç›®çš„ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>å¤§å‹é¡¹ç›®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿåˆå¦‚ä½•è¿›è¡Œç¼–è¯‘å‘¢</strong>ï¼Ÿ</p><h4 id="å¤§å‹é¡¹ç›®ç»“æ„">å¤§å‹é¡¹ç›®ç»“æ„</h4><blockquote><p>ä¸»è¦å‚è€ƒï¼š<a href="https://github.com/hattonl/cpp-project-structure">cpp-project-structure</a>ã€‚</p></blockquote><p>è¿™é‡Œå‡å®šé¡¹ç›®åä¸º <code>my_poject</code> ï¼Œä¸€ä¸ªå®Œæ•´çš„å¤§é¡¹ç›®ç»“æ„é€šå¸¸å¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">my_poject  </span><br><span class="line">â”œâ”€â”€ deploy <span class="comment"># å­˜æ”¾éƒ¨ç½²ã€äº¤ä»˜çš„æ–‡ä»¶ </span></span><br><span class="line">â”‚   â””â”€â”€ bin      <span class="comment"># é¡¹ç›®ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">â”‚   â””â”€â”€ lib      <span class="comment"># é¡¹ç›®ç”Ÿæˆçš„åº“æ–‡ä»¶</span></span><br><span class="line">â”‚   â””â”€â”€ include  <span class="comment"># é¡¹ç›®å¯¹å¤–æä¾›çš„å¤´æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ build  <span class="comment"># å­˜æ”¾cmakeäº§ç”Ÿçš„ä¸­é—´æ–‡ä»¶</span></span><br><span class="line">â”‚   â””â”€â”€ release</span><br><span class="line">â”‚   â””â”€â”€ debug  </span><br><span class="line">â”œâ”€â”€ doc      <span class="comment"># å­˜æ”¾é¡¹ç›®æ–‡æ¡£</span></span><br><span class="line">â”œâ”€â”€ src      <span class="comment"># å­˜æ”¾èµ„æºæ–‡ä»¶</span></span><br><span class="line">â”‚   â””â”€â”€ pic            </span><br><span class="line">â”œâ”€â”€ 3rdparty <span class="comment"># å­˜æ”¾ç¬¬ä¸‰æ–¹åº“</span></span><br><span class="line">â”‚   â””â”€â”€ lib       <span class="comment"># åº“æ–‡ä»¶  </span></span><br><span class="line">â”‚   â””â”€â”€ include   <span class="comment"># å¤´æ–‡ä»¶</span></span><br><span class="line">â”œâ”€â”€ my_poject <span class="comment"># é¡¹ç›®ã€ä»£ç æºæ–‡ä»¶ã€‘</span></span><br><span class="line">|   â””â”€â”€ module_1</span><br><span class="line">â”‚        â”œâ”€â”€ 1.cpp</span><br><span class="line">â”‚        â”œâ”€â”€ 1.h</span><br><span class="line">â”‚        â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">|   â””â”€â”€ module_2</span><br><span class="line">â”‚        â”œâ”€â”€ 2.cpp</span><br><span class="line">â”‚        â”œâ”€â”€ 2.h</span><br><span class="line">â”‚        â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ tools     <span class="comment"># é¡¹ç›®æ„å»ºæ”¯æŒå·¥å…·ï¼Œå¦‚ç¼–è¯‘å™¨</span></span><br><span class="line">â”œâ”€â”€ scripts   <span class="comment"># è„šæœ¬æ–‡ä»¶ï¼Œå¦‚é¢„å¤„ç†è„šæœ¬</span></span><br><span class="line">â”œâ”€â”€ config    <span class="comment"># é…ç½®æ–‡ä»¶</span></span><br><span class="line">â”‚   â””â”€â”€ xxx.yml       </span><br><span class="line">â”‚   â””â”€â”€ yyy.yml   </span><br><span class="line">â”œâ”€â”€ <span class="built_in">test</span>      <span class="comment"># æµ‹è¯•ä»£ç </span></span><br><span class="line">â”œâ”€â”€ LICENSE   <span class="comment"># ç‰ˆæƒä¿¡æ¯</span></span><br><span class="line">â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ build.sh  <span class="comment"># æ„å»ºé¡¹ç›®çš„è„šæœ¬</span></span><br><span class="line">â”œâ”€â”€ .gitignore</span><br><span class="line">â”œâ”€â”€ README.md <span class="comment"># é¡¹ç›®è¯´æ˜æ–‡ä»¶</span></span><br><span class="line">â””â”€â”€ sample    <span class="comment"># ç¤ºä¾‹ä»£ç </span></span><br></pre></td></tr></table></figure><h4 id="ç¼–è¯‘å¤æ‚é¡¹ç›®">ç¼–è¯‘å¤æ‚é¡¹ç›®</h4><p>ç°åœ¨æˆ‘ä»¬ä¸¾ä¸€ä¸ªå¤æ‚ç‚¹çš„ï¼Œ<strong>å¤šå±‚çº§é¡¹ç›®</strong>å¦‚ä½•ç”¨CMakeè¿›è¡Œç¼–è¯‘ã€‚</p><p>æ•´ä¸ªç›®å½•ç»“æ„å¦‚ä¸‹ï¼ˆä¸ºæ–¹ä¾¿ï¼Œè¿›è¡Œäº†ç²¾ç®€ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">|-- 3rdparty </span><br><span class="line">|   |-- include</span><br><span class="line">|   `-- lib</span><br><span class="line">|-- deploy </span><br><span class="line">|   |-- bin</span><br><span class="line">|   `-- lib</span><br><span class="line">|-- build</span><br><span class="line">|-- hello  <span class="comment"># æ•´ä¸ªé¡¹ç›®æºç </span></span><br><span class="line">|   |-- module1</span><br><span class="line">|   |   |-- people.cpp</span><br><span class="line">|   |   |-- people.h</span><br><span class="line">|   |   `-- CMakeLists.txt</span><br><span class="line">|   |-- module2</span><br><span class="line">|   |   |-- bird.cpp</span><br><span class="line">|   |   |-- bird.h</span><br><span class="line">|   |   `-- CMakeLists.txt</span><br><span class="line">|   |-- hello.cpp</span><br><span class="line">|   |-- CMakeLists.txt</span><br><span class="line">|-- LICENSE</span><br><span class="line">|-- README.md</span><br><span class="line">|-- src</span><br><span class="line">|   `-- video</span><br><span class="line">|       `-- 1577414323962.mp4</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>hello</code>ç›®å½•ä¸‹å„æºæ–‡ä»¶å¦‚ä¸‹ï¼š</p><ul><li><p><code>moule1/people</code> ç›¸å…³æºç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*people.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;people.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">people_hello</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;people say : Hello Cpp!&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*people.h*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">people_hello</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li><li><p><code>moule2/bird</code> ç›¸å…³æºç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*bird.cpp*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bird.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bird_hello</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;bird say : Hello Cpp!&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*bird.h*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bird_hello</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li><li><p><code>hello/hello.cpp</code> æºç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;./module1/people.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;./module2/bird.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">people_hello</span>();</span><br><span class="line">    <span class="built_in">bird_hello</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æœ€åç»™å‡ºå„ä¸ªç›®å½•ä¸‹çš„CMakeLists.txtæ–‡ä»¶ã€‚</p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">module1</button></li><li class="tab"><button type="button" data-href="#tags-2">module2</button></li><li class="tab"><button type="button" data-href="#tags-3">hello</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><ul><li><p><strong>module1</strong></p><p>ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“<code>libmodule1.so</code> ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾å½“å‰ç›®å½•ï¼ˆmodule1ï¼‰ä¸‹çš„ç›¸å…³æ–‡ä»¶,å¹¶èµ‹å€¼ç»™MODULE1_SRC</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. MODULE1_SRC)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æŒ‡å®šçš„æºæ–‡ä»¶ï¼ˆMODULE1_SRCï¼‰ç”Ÿæˆåº“æ–‡ä»¶libmodule1.so</span></span><br><span class="line"><span class="comment"># ã€æ³¨1ã€‘ä¸éœ€è¦å†™å…¨libmodule1.soï¼Œåªéœ€å†™moduleå³å¯ï¼Œcmakeä¼šè‡ªåŠ¨è¡¥å…¨ã€‚</span></span><br><span class="line"><span class="comment"># ã€æ³¨2ã€‘SHAREDå‚æ•°æŒ‡å®šç”ŸæˆåŠ¨æ€åº“ï¼ˆ.soæ–‡ä»¶ï¼‰ï¼Œä¸åŠ å‚æ•°é»˜è®¤ç”Ÿæˆé™æ€åº“ï¼ˆ.aï¼‰æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(module1 SHARED <span class="variable">$&#123;MODULE1_SRC&#125;</span>)</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><ul><li><p><strong>module2</strong></p><p>ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“<code>libmodule2.so</code> ï¼ŒåŸºæœ¬åŒå‰ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾å½“å‰ç›®å½•ï¼ˆmodule2ï¼‰ä¸‹çš„ç›¸å…³æ–‡ä»¶,å¹¶èµ‹å€¼ç»™MODULE2_SRC</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. MODULE2_SRC)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æŒ‡å®šçš„æºæ–‡ä»¶ï¼ˆMODULE1_SRCï¼‰ç”Ÿæˆåº“æ–‡ä»¶libmodule1.so</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(module2 SHARED <span class="variable">$&#123;MODULE2_SRC&#125;</span>)</span><br></pre></td></tr></table></figure></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-3"><ul><li><p><strong>hello</strong></p><p>ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶<code>hello.out</code> ï¼Œç„¶åé“¾æ¥<code>libmodule1.so</code>å’Œ <code>libmodule2.so</code>ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼ï¼š&lt;å‘½ä»¤å&gt;(å‚æ•° å‚æ•°å€¼) ï¼Œä¸­é—´å‚æ•°ç©ºæ ¼éš”å¼€</span></span><br><span class="line"><span class="comment"># è®¾ç½®é¡¹ç›®å</span></span><br><span class="line"><span class="keyword">project</span>(helloDemo)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶ä¿å­˜è·¯å¾„</span></span><br><span class="line"><span class="keyword">set</span>(EXECUTABLE_OUTPUT_PATH <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/../deploy/bin)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™å®šCMAKEæœ€ä½ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">CMAKE_MINIMUM_REQUIRED</span>(VERSION <span class="number">2.6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†module1å’Œmodule2æ–‡ä»¶å¤¹åŠ å…¥å­ç›®å½•,è¿™æ ·cmakeå°±å¯ä»¥å»å…¶ä¸­æŸ¥æ‰¾ç¼–è¯‘</span></span><br><span class="line"><span class="comment"># ã€æ³¨1ã€‘æ²¡æœ‰è¿™ä¸ªä¼šæŠ¥é”™ï¼Œld:æ‰¾ä¸åˆ° -lmoudle1 å’Œ -lmoudle2</span></span><br><span class="line"><span class="comment"># ã€æ³¨2ã€‘è¿™é‡Œåªèƒ½ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¸æ˜¯helloé¡¹ç›®ä¸‹çš„è·¯å¾„ï¼Œæ˜¯æŒ‡</span></span><br><span class="line"><span class="comment">#       buildä¸‹çš„ç›¸å¯¹è·¯å¾„ã€‚</span></span><br><span class="line"><span class="comment">#       å› ä¸ºæœ€åmakeæ˜¯åœ¨buildè·¯å¾„ä¸‹ï¼Œlibmoudule1.soå’Œ</span></span><br><span class="line"><span class="comment">#       libmoudule2.soæ˜¯åˆ†åˆ«ä¿å­˜åœ¨build/moudle1 å’Œbuild/module2ä¸‹</span></span><br><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(./module1) </span><br><span class="line"><span class="keyword">ADD_SUBDIRECTORY</span>(./module2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢å½“å‰ç›®å½•æ‰€æœ‰æºä»£ç æ–‡ä»¶ï¼Œå¹¶èµ‹å€¼ç»™PROJECT_ROOT_SRCS</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. PROJECT_ROOT_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¢åŠ C++11ç‰¹æ€§</span></span><br><span class="line"><span class="keyword">add_definitions</span>(-std=c++<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ã€ç¼–è¯‘ã€‘</span></span><br><span class="line"><span class="comment"># add_executable ä»ä¸€ç»„æºæ–‡ä»¶ç¼–è¯‘å‡ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ </span></span><br><span class="line"><span class="comment"># è¿™é‡Œå°†$&#123;PROJECT_ROOT_SRCS&#125;ä¸­æ–‡ä»¶ç¼–è¯‘ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶hello.out</span></span><br><span class="line"><span class="keyword">add_executable</span>(hello.out <span class="variable">$&#123;PROJECT_ROOT_SRCS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ã€é“¾æ¥ã€‘</span></span><br><span class="line"><span class="comment"># å°†ç›®æ ‡æ–‡ä»¶ä¸åº“æ–‡ä»¶è¿›è¡Œé“¾æ¥ï¼Œä¸æ˜¾ç¤ºæŒ‡ç¤ºæ–‡ä»¶åç¼€ï¼ˆå¦‚ module1.soï¼‰ï¼Œä¼˜å…ˆé“¾æ¥åŠ¨æ€åº“</span></span><br><span class="line"><span class="keyword">TARGET_LINK_LIBRARIES</span>(</span><br><span class="line">    hello.out </span><br><span class="line">    module2 </span><br><span class="line">    module1</span><br><span class="line">) </span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ï¼Œå¦‚æœä½ è¿˜å¼•ç”¨äº†ç¬¬ä¸‰æ–¹åº“ï¼Œè¿˜åº”è¯¥åšå¦‚ä¸‹ä¿®æ”¹ã€‚</p><blockquote><p>å‡è®¾ä½ å¼•ç”¨çš„ç¬¬ä¸‰æ–¹åº“ä¸º<code>ffmpeg</code> ï¼Œç›¸å…³å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶éƒ½æ”¾åœ¨<code>3rdparty</code>ç›®å½•ä¸‹ã€‚</p></blockquote><ul><li><p>å¢åŠ ffmpegåº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶æœç´¢è·¯å¾„</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤´æ–‡ä»¶æœç´¢è·¯å¾„</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>../<span class="number">3</span>rdparty/inclue)</span><br><span class="line"><span class="comment"># åº“æ–‡ä»¶æœç´¢è·¯å¾„</span></span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>../<span class="number">3</span>rdparty/lib)</span><br></pre></td></tr></table></figure></li><li><p>é“¾æ¥ffmepegç›¸åº”åº“</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é“¾æ¥ffmpegåº“</span></span><br><span class="line"><span class="comment"># å°†ç›®æ ‡æ–‡ä»¶ä¸åº“æ–‡ä»¶è¿›è¡Œé“¾æ¥</span></span><br><span class="line"><span class="keyword">TARGET_LINK_LIBRARIES</span>(</span><br><span class="line">    hello.out </span><br><span class="line">    module2 </span><br><span class="line">    module1</span><br><span class="line">    libavcodec.so   <span class="comment"># æ˜¾ç¤ºæŒ‡å®šåŠ¨æ€åº“</span></span><br><span class="line">    libavdevice.so  </span><br><span class="line">    libavfilter.so</span><br><span class="line">    libavformat.so</span><br><span class="line">    libavutil.so</span><br><span class="line">    libpostproc.so</span><br><span class="line">    libswresample.so</span><br><span class="line">    libswscale.so</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>å‡†å¤‡å¥½æ‰€æœ‰çš„æ–‡ä»¶åï¼Œæˆ‘ä»¬å¼€å§‹è¿›è¡Œcmakeæ„å»ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ./build</span><br><span class="line">cmake ../hello &amp;&amp; make</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211210122630662.png" alt="image-20211210122630662"></p><p>åœ¨<code>bin</code> ä¸‹æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../deploy/bin/hello.out </span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211210122942175.png" alt="image-20211210122942175"></p><p>ğŸ‘¨â€ğŸ’» CMakeç›¸å…³ä»‹ç»åˆ°æ­¤å®Œç»“ã€‚</p><h3 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h3><p>è¿™ç¯‡åšå®¢ä¸»è¦ä»‹ç»äº†ç¼–è¯‘çš„åŸºæœ¬è¿‡ç¨‹å’ŒåŸç†ï¼Œä»¥åŠå¸¸ç”¨çš„ç¼–è¯‘å·¥å…·ï¼ˆg++/Makefile/CMakeï¼‰ä½¿ç”¨ã€‚</p><p>ä»æ„æ€å¤§çº²åˆ°æœ€ååˆæ­¥å®Œå·¥å¤§æ¦‚ç”¨äº†äº”å¤©ï¼Œæ¯”æœ€åˆé¢„ä¼°çš„è¿›åº¦å¤šèŠ±äº†ä¸€å€æ—¶é—´ã€‚æœ€ä¸»è¦çš„åŸå› å°±æ˜¯ä¸­é—´æˆ‘ä¸€ç›´åœ¨åˆ åˆ æ”¹æ”¹ï¼Œç‰¹åˆ«æ˜¯å†™<u>ç¼–è¯‘è¿‡ç¨‹åˆæ¢</u>è¿™ä¸€èŠ‚ï¼š<strong>æ¯å†™å®Œä¸€ä¸ªç‰ˆæœ¬ï¼Œæˆ‘å°±è‡ªå·±å…ˆçœ‹ä¸€éå†é—®è‡ªå·±ï¼šä½ çœŸçš„èƒ½çœ‹æ˜ç™½å—</strong>ï¼Ÿè¿˜æ˜¯æœ‰äº›ä¸ç†è§£çš„åœ°æ–¹ï¼Œå°±ç»§ç»­Googleäº›èµ„æ–™çœ‹ï¼Œç›´åˆ°æŠŠè‡ªå·±è¯´æœ----è‡³å°‘æ–‡ç« é€»è¾‘ä¸Šè‡ªæ°äº†ã€‚åŒæ—¶ä¹Ÿæ›´æ·±åˆ»åœ°ä½“ä¼šåˆ°äº†ï¼š<strong>è‡ªå·±è§‰å¾—æ‡‚äº†å¯èƒ½ä¸æ˜¯çœŸçš„æ‡‚äº†ï¼Œèƒ½æŠŠåˆ«äººè®²æ˜ç™½æ‰å¯èƒ½ç®—æ˜¯æ‡‚äº†</strong>ã€‚</p><p>C++ç¯å¢ƒç›¸å…³ä»‹ç»å°±å…ˆå‘Šä¸€æ®µè½äº†ï¼Œæ¥ä¸‹æ¥å‡†å¤‡æ•´ç†ä¸€ä¸‹<strong>C++åŸºç¡€ç›¸å…³çŸ¥è¯†</strong>ï¼ˆæœ‰äº‹æƒ…åšçš„æ„Ÿè§‰è¿˜ä¸é”™ğŸ˜€ ï¼‰ï¼Œå›å¤å®Œè®ºæ–‡è¯„å®¡æ„è§åå°½å¿«å¼€å§‹æ›´æ–°ã€‚</p><h3 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h3><div class="timeline"><div class="timenode"><div class="meta"><p><p>2022-01-24 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>å¢åŠ å¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œè¿‡ç¨‹åˆ†æ</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-12-20 ï¼šæ›´æ–°ç¬”è®°</p></p></div><div class="body"><ol><li>å¢åŠ g++ç›¸å…³ä»‹ç»</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-12-10 ï¼šä¸Šä¼ åˆç¨¿</p></p></div><div class="body"><ol><li>ç¬¬ä¸€æ¬¡æ›´æ–°ï¼Œå‘å¸ƒåˆç¨¿</li></ol></div></div></div><h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">g++ï¼ŒCMakeå’ŒMakefileäº†è§£ä¸€ä¸‹ ï¼š https://zhuanlan.zhihu.com/p/55027085<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Linuxä¸‹ä½¿ç”¨CMakeç¼–è¯‘C++ï¼šhttps://zhuanlan.zhihu.com/p/373256365<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">é˜®ä¸€å³°--ç¼–è¯‘å™¨çš„å·¥ä½œè¿‡ç¨‹ï¼šhttp://www.ruanyifeng.com/blog/2014/11/compiler.html<a href="#fnref:3" rev="footnote"> â†©</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ç¬¦å·è§£æï¼šhttps://www.jianshu.com/p/2786533a34c9<a href="#fnref:4" rev="footnote"> â†©</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">è®¡ç®—æœºåŸç†ç³»åˆ—ä¹‹ä¸ƒ-é“¾æ¥è¿‡ç¨‹åˆ†æï¼šhttps://luomuxiaoxiao.com/?p=572<a href="#fnref:5" rev="footnote"> â†©</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">é™æ€é“¾æ¥ä¸åŠ¨æ€é“¾æ¥åœ¨é“¾æ¥è¿‡ç¨‹å’Œæ–‡ä»¶ç»“æ„ä¸Šçš„åŒºåˆ«ï¼šhttps://www.polarxiong.com/<a href="#fnref:6" rev="footnote"> â†©</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">gccç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼šhttps://blog.csdn.net/albertsh/article/details/89309107<a href="#fnref:7" rev="footnote"> â†©</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C/C++ä¸­å…³äºé™æ€é“¾æ¥åº“(.a)ã€åŠ¨æ€é“¾æ¥åº“ï¼ˆ.soï¼‰çš„ç¼–è¯‘ä¸ä½¿ç”¨ï¼šhttps://blog.csdn.net/qq_27825451/article/details/105700361<a href="#fnref:8" rev="footnote"> â†©</a></span></li><li id="fn:9"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">9.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">cpp_new_featuresï¼šhttps://github.com/0voice/cpp_new_features/blob/main/<a href="#fnref:9" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
          <category> C++åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> C++åŸºç¡€ </tag>
            
            <tag> CMake </tag>
            
            <tag> Makefile </tag>
            
            <tag> g++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ä»é›¶å¼€å§‹ï¼ˆé›¶ï¼‰</title>
      <link href="/p/62712/"/>
      <url>/p/62712/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>ğŸ–‹ ã€ŠC++ä»é›¶å¼€å§‹ã€‹ç³»åˆ—ï¼ŒæŒç»­æ›´æ–°ä¸­â€¦</p></blockquote><h3 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h3><h4 id="ä¸ºä»€ä¹ˆå†™è¿™ä»½ç¬”è®°">ä¸ºä»€ä¹ˆå†™è¿™ä»½ç¬”è®°</h4><p>è¿™ä¸ªç³»åˆ—è™½ç„¶åä¸ºï¼šã€ŠC++ä»é›¶å¼€å§‹ã€‹ï¼Œä½†ç»†ç»†ç®—æ¥ï¼Œæˆ‘å·²ç»ä¸æ­¢ç³»ç»Ÿæ€§åœ°å­¦è¿‡C++ä¸€æ¬¡äº†ã€‚è¯´æ¥æƒ­æ„§ï¼Œæ¯æ¬¡ç›®çš„ä¹Ÿéƒ½æ˜¯ä¸ºäº†å¯¹ä»˜è€ƒè¯•ï¼Œå–ä¸ªä¸é”™çš„æˆç»©è€Œä¸‹ç‚¹è‹¦å·¥ç½¢äº†ã€‚</p><p>é˜´å·®é˜³é”™ï¼Œ<a href="https://hwh.zone/p/29708/">æˆ‘æ˜å¹´å³å°†å…¥èŒè…¾è®¯ï¼Œå¹¶ä»¥C++å¼€å§‹è‡ªå·±èŒä¸šç”Ÿæ¶¯çš„ç¬¬ä¸€ç«™</a>ï¼Œæ­£å¥½åœ¨æ ¡è¿˜æœ‰æ®µè¾ƒæ¸…é—²çš„æ—¶å…‰ï¼Œäºæ˜¯ä¸‹ç¬”å†™äº†è¿™ä¸ªC++ç³»åˆ—ç¬”è®°ã€‚<strong>ä¸€æ˜¯åˆ†äº«è®°å½•ã€ä»¥è®²ä»£å­¦</strong>ï¼Œå¸Œæœ›èƒ½å¯¹åŒæ ·å­¦ä¹ C++çš„è¯»è€…æœ‰ç‚¹å¸®åŠ©ï¼›<strong>äºŒæ˜¯å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´</strong>ï¼ŒåŒæ—¶å¸®åŠ©è‡ªå·±æ—¶æ—¶è®°å¿†å’Œæ¸©ä¹ ï¼›ä¸‰æ˜¯<strong>å¼€æºåˆ†äº«ã€è´¡çŒ®ä¸€ç‚¹åŠ›é‡</strong>ï¼Œä¸­æ–‡ï¼ˆæ–‡å­—ç‰ˆï¼‰å¼€æºæ•™ç¨‹/ç¬”è®°å¤ªå°‘ï¼Œå¸Œæœ›èƒ½è‡ªå·±æ•´ç†ä¸€ä»½ç²¾ç‚¼ä¹Ÿè¶³å¤Ÿæ¸…æ™°çš„C++æ€»ç»“è®°å½•ã€‚</p><p>åŠ¨ç¬”å‰ï¼Œæˆ‘ä»”ç»†æ„æ€äº†ä¸‹è¯¥ç³»åˆ—ç¬”è®°çš„æ•´ä½“ç»“æ„ï¼Œä¸‹èŠ‚ä¼šå¼€å§‹ä»‹ç»å…·ä½“ä»‹ç»ã€‚</p><ul><li>ç‰¹åˆ«çš„ï¼Œè¿™ä¸ªç³»åˆ—å¤„äºåˆå»ºçŠ¶æ€ï¼Œæ–‡ç« å¯èƒ½ä¼šç”±äºæ›´æ–°ç­‰åŸå› å’Œä¹‹å‰ç‰ˆæœ¬æœ‰æ‰€ä¸åŒï¼›</li><li>æ‰€æœ‰çš„æ–‡ç« æ›´æ–°è®°å½•å˜åŒ–ï¼Œå¯ä»¥åœ¨ç¬¬ä¸‰å¤§èŠ‚ï¼š<strong>æ›´æ–°è®°å½•</strong>ä¸­æŸ¥çœ‹ã€‚</li></ul><h4 id="è°é€‚åˆé˜…è¯»æœ¬æ–‡">è°é€‚åˆé˜…è¯»æœ¬æ–‡</h4><p>è¿™ä¸ªç³»åˆ—è™½ç„¶å«åšâ€œ<u>ä»é›¶</u>å¼€å§‹â€ï¼Œä½†å¦‚æœä½ çœŸçš„é›¶åŸºç¡€ï¼Œé˜…è¯»äº†å‰é¢ã€Šç¯å¢ƒæ­å»ºã€‹ä¸¤ç¯‡æ–‡ç« ä¾¿å¯èƒ½è¦å¼€å§‹æ€€ç–‘è‡ªå·±æ˜¯ä¸æ˜¯é€‚åˆåšç¨‹åºå‘˜äº†ã€‚</p><p>å½“ç„¶ä½œè€…å¹¶éæœ‰æ„è®©ä½ æ„Ÿåˆ°è¿™ç§æ²®ä¸§çš„æƒ…ç»ªï¼Œä¸€æ˜¯å¸Œæœ›<u>ä»¥è®²ä»£å­¦</u> çš„æ–¹å¼å¸®åŠ©è‡ªå·±å’Œè¯»è€…æé«˜C++æ°´å¹³ï¼ŒäºŒæ˜¯å› ä¸ºå¸Œæœ›è¿™ä¸ªç³»åˆ—çš„é˜…è¯»äººç¾¤ï¼š</p><ul><li>å…·æœ‰ä¸€å®šç¼–ç¨‹è¯­è¨€åŸºç¡€ï¼Œæ¯”å¦‚Cã€Pythonã€Javaï¼Œæœ‰C++æœ€å¥½ï¼›</li><li>å¸Œæœ›è¿›ä¸€æ­¥æé«˜ã€å·©å›ºC++åŸºç¡€ï¼Œçœ‹å®Œæœ¬ç³»åˆ—èƒ½è¾¾åˆ°æ ¡æ‹›å¤§å‚C++è‡³å°‘â€œåŠæ ¼çº¿â€æ°´å¹³ï¼ˆå› æ­¤æœ¬ç³»åˆ—ä¹Ÿæ’å…¥äº†å¾ˆå¤šâ€œå…«è‚¡æ–‡â€ç›¸äº’éªŒè¯ï¼‰ã€‚</li></ul><p>å¦‚æœä½ çœŸçš„éœ€è¦æ›´åŸºç¡€çš„æ•™ç¨‹ï¼Œä½†å› ä¸ºä½œè€…è¿˜æ²¡æœ‰åœ¨ä¸­æ–‡äº’è”ç½‘æ‰¾åˆ°æ¯”è¾ƒå¥½çš„<u>å¼€æºæ–‡å­—æ•™ç¨‹</u>ï¼Œè‹±æ–‡æ•™ç¨‹å€’æ˜¯æ‰¾åˆ°ä¸å°‘ï¼ˆä¸ç¦å†æ¬¡æ„Ÿæ…¨è‹±æ–‡çš„é‡è¦æ€§ï¼‰ï¼Œå› æ­¤å¯¹äºé›¶åŸºç¡€çš„åŒå­¦ï¼Œåˆ†åˆ«æ¨èè‹±ã€ä¸­ï¼ˆæ–‡å­—ï¼‰æ•™ç¨‹ä¸€ä»½ï¼š</p><ul><li>è‹±æ–‡ï¼š<a href="learncpp">å¼ºçƒˆæ¨èâ€”learncpp</a>ï¼Œè‹±æ–‡å¦‚æœé˜…è¯»åƒåŠ›å»ºè®®å®‰è£…è°·æ­Œç¿»è¯‘æ’ä»¶ï¼›</li><li>ä¸­æ–‡ï¼š<a href="https://cloud.tencent.com/edu/learning/course-1844-21311">è…¾è®¯äº‘C++æ•™ç¨‹</a>ï¼ŒååŸºç¡€ï¼Œé€‚åˆè‹±æ–‡é˜…è¯»è¿‡äºå›°éš¾åˆæ— åŸºç¡€çš„åŒå­¦ã€‚</li></ul><h3 id="æ€»ç›®å½•">æ€»ç›®å½•</h3><blockquote><p>â° æœ€åæ›´æ–°æ—¶é—´ï¼š<code>2022/01/22 17:00</code> ã€‚</p></blockquote><p>ç³»åˆ—æ€»ç»“æ„æš‚åˆ†ä¸ºï¼šC++åŸºç¡€<sup id="fnref:0"><a href="#fn:0" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="C++æ•™ç¨‹ä»0åˆ°1å…¥é—¨ç¼–ç¨‹ï¼šhttps://www.bilibili.com/video/BV1et411b73Z">[0]</span></a></sup><sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="è…¾è®¯äº‘C++æ•™ç¨‹ï¼šhttps://cloud.tencent.com/edu/learning/course-1844-21296">[5]</span></a></sup>ã€C++è¿›é˜¶<sup id="fnref:0"><a href="#fn:0" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="C++æ•™ç¨‹ä»0åˆ°1å…¥é—¨ç¼–ç¨‹ï¼šhttps://www.bilibili.com/video/BV1et411b73Z">[0]</span></a></sup><sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="è…¾è®¯äº‘C++æ•™ç¨‹ï¼šhttps://cloud.tencent.com/edu/learning/course-1844-21296">[5]</span></a></sup>ã€C++é¢ç»<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="é˜¿ç§€çš„æ±‚èŒç¬”è®°ï¼šhttps://interviewguide.cn/">[1]</span></a></sup>ã€C++å¼€æº<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="zavarå¼€æºåœ°å€: https://github.com/zyearn/zaver">[2]</span></a></sup><sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="ffmpeg-trancodeå¼€æºåœ°å€: https://github.com/leichn/exercises/tree/master/source/ffmpeg/ffmpeg_transcode">[3]</span></a></sup><sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="SRSå¼€æºåœ°å€ï¼šhttps://github.com/ossrs/srs">[4]</span></a></sup>ï¼Œå››å¤§æ¿å—ã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"><strong>æ–‡ç« </strong></th><th style="text-align:center"><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td style="text-align:center"><strong>C++åŸºç¡€</strong></td><td style="text-align:center"><a href="https://hwh.zone/p/18652/">C++ä»é›¶å¼€å§‹ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºï¼ˆä¸Šï¼‰VSCodeè¿œç¨‹å¼€å‘</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.hwh.zone/p/2834">C++ä»é›¶å¼€å§‹ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºï¼ˆä¸‹ï¼‰g++/Makefile/CMakeå¿«é€Ÿå…¥é—¨</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.hwh.zone/p/26224">C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŸºç¡€è¯­æ³•ï¼ˆä¸Šï¼‰å¿«é€Ÿå…¥é—¨</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.hwh.zone/p/24237">C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŸºç¡€è¯­æ³•ï¼ˆä¸­ï¼‰æŒ‡é’ˆå’Œå¼•ç”¨</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.hwh.zone/p/51595">C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŸºç¡€è¯­æ³•ï¼ˆä¸‹ï¼‰ä¹‹å‡½æ•°</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.hwh.zone/p/6587">C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŸºç¡€è¯­æ³•ï¼ˆä¸‹ï¼‰å¤åˆç±»å‹åŠè½¬æ¢</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"><strong>C++è¿›é˜¶</strong></td><td style="text-align:center"><a href="https://www.hwh.zone/p/17506">C++ä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸Šï¼‰å¿«é€Ÿå…¥é—¨</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.hwh.zone/p/43924">C++ä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸­ï¼‰è¿ç®—ç¬¦é‡è½½</a></td><td style="text-align:center">âœ”ï¸æ›´æ–°å®Œæˆ</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸‹ï¼‰ç»§æ‰¿ä¸è™šå‡½æ•°</a></td><td style="text-align:center">ğŸ”¨ æ›´æ–°ing</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸‹ï¼‰æ¨¡æ¿</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆå››ï¼‰ï¼šC++æ ‡å‡†åº“STL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>C++é¢ç»</strong></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆäº”ï¼‰ï¼šC++é¢ç»ä¹‹åŸºç¡€è¯­æ³•</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆå…­ï¼‰ï¼šC++é¢ç»ä¹‹å†…å­˜ç®¡ç†</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆä¸ƒï¼‰ï¼šC++é¢ç»ä¹‹C++11</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆå…«ï¼‰ï¼šC++é¢ç»ä¹‹STL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆä¹ï¼‰ï¼šC++é¢ç»ä¹‹å…¶å®ƒè¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>C++å¼€æº</strong></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆåï¼‰ï¼šC++å¼€æºä¹‹Zaveræºç åˆ†æ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆåä¸€ï¼‰ï¼šC++å¼€æºä¹‹å®ç°è‡ªå·±çš„ffmpegè½¬ç å™¨</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="">C++ä»é›¶å¼€å§‹ï¼ˆåäºŒï¼‰ï¼šC++å¼€æºä¹‹SRSæºç åˆ†æ</a></td><td style="text-align:center"></td></tr></tbody></table><h3 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h3><blockquote><p>â² æ›´æ–°æ—¶é—´ï¼š<code>2021/12/05 17:00</code> ã€‚</p></blockquote><p>ä»ç©åˆ°æ— èŠå¼€å§‹å­¦ä¹ åˆ°åäºŒæœˆåˆç»™è‡ªå·±æŒ–äº†ä¸ªå¤§å‘ï¼Œ<code>play hard study hard</code> å±…ç„¶ä¸çŸ¥ä¸è§‰æˆäº†æˆ‘çš„è¡Œä¸ºä¹ æƒ¯ã€‚å½“ç„¶ï¼Œç©åˆ°èƒ–äº†åå¤šæ–¤å¹¶ä¸æ˜¯æˆ‘æœ¬æ„â€¦</p><p>å€Ÿæ­¤æœºä¼šï¼Œæå‰è®¸ä¸‹å‡ ä¸ªæ–°å¹´æ„¿æœ›ï¼ˆæ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¹ˆçªç„¶ï¼‰ï¼š</p><ul><li>ä¸‰ä¸ªæœˆå†…é¡ºåˆ©æ›´æ–°å®Œè¿™ä¸ªç³»åˆ—å¤§éƒ¨åˆ†æ–‡æ¡£ï¼›</li><li>å¤šèŠ±ç‚¹æ—¶é—´å­¦ä¹ ï¼Œä¸èƒ½è¿‡åˆ†ç©ä¹ï¼›</li><li>å°‘ç†¬å¤œï¼Œå¤šå–èŒ¶ï¼›</li><li>å¦‚æ„è€ƒè¯•é¡ºåˆ©ã€‚</li></ul><p>æ•¬è¯·æœŸå¾…~ ğŸ˜‹ ï¼ˆé¡ºä¾¿åˆ†äº«ä¸€ä¸‹<s>æˆ‘çš„æ–°æ’ä»¶</s>ä¸€é¦–åº”æ™¯çš„å°è¯—ï¼‰</p><div class='poem'><div class='poem-title'>[é£é¸Ÿé›†]</div><div class='poem-author'>[æ³°æˆˆå°”]</div><p>é—²æš‡åœ¨åŠ¨ä½œæ—¶</p><p>ä¾¿æ˜¯å·¥ä½œã€‚<br>é™æ­¢çš„æµ·æ°´è¡åŠ¨æ—¶</p><p>ä¾¿æˆæ³¢æ¶›ã€‚</p></div><h3 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h3><div class="timeline"><div class="timenode"><div class="meta"><p><p>2022-01-31ï¼šæ–‡ç« æ›´æ–°</p></p></div><div class="body"><ol><li><a href="https://www.hwh.zone/p/43924">C++ä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸­ï¼‰è¿ç®—ç¬¦é‡è½½</a> æ›´æ–°å®Œæˆ</li><li>ğŸ™‚ æ–°å¹´å¿«ä¹ï¼</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2022-01-27 ï¼šæ–‡ç« æ›´æ–°</p></p></div><div class="body"><ol><li><a href="https://www.hwh.zone/p/17506">C++ä»é›¶å¼€å§‹ï¼ˆä¸‰ï¼‰ï¼šé¢å¯¹å¯¹è±¡ï¼ˆä¸Šï¼‰å¿«é€Ÿå…¥é—¨</a>æ›´æ–°å®Œæ¯•</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2022-01-22 ï¼šæ–‡ç« æ›´æ–°</p></p></div><div class="body"><ol><li><a href="https://www.hwh.zone/p/6587">C++ä»é›¶å¼€å§‹ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºï¼ˆä¸‹ï¼‰å¤åˆç±»å‹åŠè½¬æ¢</a>æ›´æ–°å®Œæ¯•</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2022-01-18 ï¼šæ–‡ç« æ›´æ–°</p></p></div><div class="body"><ol><li><a href="https://www.hwh.zone/p/26224">C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŠ¡å®åŸºç¡€ï¼ˆä¸Šï¼‰ä¹‹å¿«é€Ÿå…¥é—¨</a>æ›´æ–°å®Œæ¯•</li><li><a href="https://www.hwh.zone/p/24237">C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŠ¡å®åŸºç¡€ï¼ˆä¸­ï¼‰ä¹‹æŒ‡é’ˆå’Œå¼•ç”¨</a> æ›´æ–°å®Œæ¯•</li><li><a href="https://www.hwh.zone/p/51595">C++ä»é›¶å¼€å§‹ï¼ˆäºŒï¼‰ï¼šåŠ¡å®åŸºç¡€ï¼ˆä¸‹ï¼‰ä¹‹å‡½æ•°</a> æ›´æ–°å®Œæ¯•</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-12-10 ï¼šæ–‡ç« æ›´æ–°</p></p></div><div class="body"><ol><li><a href="https://www.hwh.zone/p/2834">C++ä»é›¶å¼€å§‹ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºï¼ˆä¸‹ï¼‰g++/Makefile/CMakeå¿«é€Ÿå…¥é—¨</a>æ›´æ–°å®Œæ¯•</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-12-06 ï¼šæ–‡ç« æ›´æ–°</p></p></div><div class="body"><ol><li><a href="https://hwh.zone/p/18652/">C++ä»é›¶å¼€å§‹ï¼ˆä¸€ï¼‰ï¼šç¯å¢ƒæ­å»ºï¼ˆä¸Šï¼‰ä¹‹VSCodeè¿œç¨‹å¼€å‘</a> æ›´æ–°å®Œæ¯•</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-12-05 ï¼šç¬¬ä¸€æ¬¡æ›´æ–°</p></p></div><div class="body"><ol><li>åˆæ­¥ç¡®å®šã€ŠC++ä»é›¶å¼€å§‹ç³»åˆ—ã€‹å¤§çº²</li><li>å³å°†æ›´æ–°ï¼š<code>C++åŸºç¡€ç³»åˆ—</code></li></ol></div></div></div><h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:0"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">0.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++æ•™ç¨‹ä»0åˆ°1å…¥é—¨ç¼–ç¨‹ï¼šhttps://www.bilibili.com/video/BV1et411b73Z<a href="#fnref:0" rev="footnote"> â†©</a></span></li><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">é˜¿ç§€çš„æ±‚èŒç¬”è®°ï¼šhttps://interviewguide.cn/<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">zavarå¼€æºåœ°å€: https://github.com/zyearn/zaver<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ffmpeg-trancodeå¼€æºåœ°å€: https://github.com/leichn/exercises/tree/master/source/ffmpeg/ffmpeg_transcode<a href="#fnref:3" rev="footnote"> â†©</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">SRSå¼€æºåœ°å€ï¼šhttps://github.com/ossrs/srs<a href="#fnref:4" rev="footnote"> â†©</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">è…¾è®¯äº‘C++æ•™ç¨‹ï¼šhttps://cloud.tencent.com/edu/learning/course-1844-21296<a href="#fnref:5" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
          <category> ä»é›¶å¼€å§‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo+Github Pageså¿«é€Ÿæ‰“é€ å±äºè‡ªå·±çš„ç½‘ç«™</title>
      <link href="/p/56326/"/>
      <url>/p/56326/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>âš ï¸ é˜…è¯»æœ¬æ–‡å‰ï¼Œé»˜è®¤ä½ å…·æœ‰ï¼š</p><ol><li>gitæ“ä½œåŸºæœ¬çŸ¥è¯†</li><li>Linuxæ“ä½œåŸºæœ¬çŸ¥è¯†</li><li>ç½‘ç»œç›¸å…³åŸºæœ¬çŸ¥è¯†</li></ol><p>å¦‚æœæ“ä½œé‡åˆ°å›°éš¾ï¼Œå¯åœ¨æ–‡ç« ä¸‹æ–¹è¿›è¡Œç•™è¨€ğŸ˜ƒã€‚</p></blockquote><h3 id="å‰è¨€">å‰è¨€</h3><blockquote><p>è¿«ä¸åŠå¾…ï¼Ÿå»ºç«™æ•ˆæœå®æ—¶é¢„è§ˆï¼š<a href="https://hwh.zone/">royhuangâ€˜s blog</a> ã€‚</p></blockquote><div class="tag link"><a class="link-card" title="royhuang's blog" href="https://www.hwh.zone"><div class="left"><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/cat-modified.png"/></div><div class="right"><p class="text">royhuang's blog</p><p class="url">https://www.hwh.zone</p></div></a></div><p>ç¬¬ä¸€æ¬¡å»ºç«™æ—¶è¿˜æ˜¯ä¸‰å¹´å‰ç”¨<strong>WordPress</strong>æ­å»ºï¼Œç½‘ç«™æ”¾åœ¨è…¾è®¯äº‘VPSä¸Šè¿è¡Œã€‚å› ä¸ºæœºå™¨é…ç½®è¾ƒä½æ¯”è¾ƒå¡ï¼Œæœ‰æ¬¡æš´èºdebugæŠŠæ•´ä¸ªæœåŠ¡å™¨remakeäº†ï¼Œä¸äº†äº†ä¹‹ã€‚å†åé¢åˆå› ä¸ºå¯¹<strong>Java Webå¼€å‘</strong>æ¯”è¾ƒæ„Ÿå…´è¶£ï¼ŒæŠ˜è…¾äº†SpringBoot Webå¼€å‘å’Œå‰åç«¯ç›¸å…³çŸ¥è¯†ï¼Œæ‰“ç®—è‡ªå·±<strong>å®Œå…¨å‰åç«¯è‡ªä¸»å¼€å‘</strong>ä¸€ä¸ªåšå®¢ã€‚å› ä¸ºä¸»å®¢è§‚å„ç§åŸå› ï¼Œåšäº†ä¸€ä¸ªæ®‹æ¬¡å“ï¼Œé˜´å·®é˜³é”™æœ€åè¦ä»¥C++å¼€å§‹è‡ªå·±èŒä¸šç”Ÿæ¶¯ç¬¬ä¸€ç«™ï¼Œä¹Ÿæ²¡æœ‰æœ€ç»ˆå®Œå–„ã€‚</p><p>è¶ç€è¿™æ®µæ—¶é—´ï¼Œä½¿ç”¨<strong>Hexo+Github Pages</strong> ä½œä¸ºæœ€ç»ˆå»ºç«™æ–¹æ¡ˆæŠ˜è…¾äº†å‡ å¤©ï¼Œæ€»ä½“æ¥è¯´æ•ˆæœè¿˜æ¯”è¾ƒæ»¡æ„ã€‚ä¸ºäº†åæ¥äººå°‘è¸©ç‚¹å‘ï¼ŒåŒæ—¶ä¸ºè‡ªå·±ç³Ÿç³•çš„è®°å¿†ç•™ç‚¹å›å¿†ï¼Œç‰¹æ­¤è®°å½•ã€‚</p><h3 id="ä¸»æµå»ºç«™æ–¹å¼æ¯”è¾ƒ">ä¸»æµå»ºç«™æ–¹å¼æ¯”è¾ƒ</h3><p>åœ¨æ­£å¼å¼€å§‹å‰ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆæ¥åˆ†æä¸‹ä¸»æµå»ºç«™æ–¹å¼ï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚è‡ªç„¶ï¼Œæ­¤èŠ‚ä¹Ÿå¯ä»¥ç•¥è¿‡ã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">å»ºç«™éš¾åº¦</th><th style="text-align:center">æ‰€éœ€çŸ¥è¯†</th><th style="text-align:center">å®šåˆ¶åŒ–ç¨‹åº¦</th><th style="text-align:center">é€‚åˆäººç¾¤</th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>WordPress</strong></td><td style="text-align:center">â­ï¸â­ï¸</td><td style="text-align:center">Linuxã€GitåŸºæœ¬çŸ¥è¯†</td><td style="text-align:center">ä¸€èˆ¬</td><td style="text-align:center">Webå¼€å‘å°ç™½äººç¾¤</td><td style="text-align:center">ä¹‹å‰å†™çš„æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/hwh1996/article/details/90666775">æ•™ç»ƒ,æˆ‘æƒ³å»ºç½‘ç«™ï¼</a></td></tr><tr><td style="text-align:center"><strong>Java Web</strong></td><td style="text-align:center">â­ï¸â­ï¸â­ï¸â­ï¸</td><td style="text-align:center">Webå‰åç«¯å¼€å‘çŸ¥è¯†ï¼Œå¤šä¸”æ‚</td><td style="text-align:center">éå¸¸é«˜ï¼Œå‰åç«¯ä»£ç å…¨æ ˆå¼€å‘</td><td style="text-align:center">Java Webå¼€å‘äººå‘˜</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>Hexo + Github Pages</strong></td><td style="text-align:center">â­ï¸â­ï¸</td><td style="text-align:center">Linuxã€GitåŸºæœ¬çŸ¥è¯†</td><td style="text-align:center">è¾ƒé«˜ï¼ŒåŸºäºé…ç½®æ–‡ä»¶ä¿®æ”¹è¾ƒæ–¹ä¾¿</td><td style="text-align:center">Webå¼€å‘å°ç™½äººç¾¤</td><td style="text-align:center"><strong>ä¸éœ€è¦å¤‡æ¡ˆåŸŸå</strong></td></tr><tr><td style="text-align:center"><strong>Hexo + è…¾è®¯äº‘</strong></td><td style="text-align:center">â­ï¸â­ï¸</td><td style="text-align:center">åŒä¸Š</td><td style="text-align:center">åŒä¸Š</td><td style="text-align:center">åŒä¸Š</td><td style="text-align:center"><strong>åŸŸåéœ€è¦å¤‡æ¡ˆ</strong>ï¼Œä½†ç½‘ç«™è®¿é—®é€Ÿåº¦ä¼šå˜å¿«å¾ˆå¤š</td></tr></tbody></table><p>æ ¹æ®ä»¥ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒæƒ…å†µè¿›è¡Œé€‰æ‹©ï¼š</p><ul><li><p><strong>Java Webå…¨æ ˆæ­å»º</strong>ï¼Ÿ</p><ul><li>é€‚åˆJava Webä¸ºæŠ€æœ¯æ ˆçš„<strong>ä¸“ä¸šäººå‘˜</strong>ï¼Œå¯ä»¥ä½œä¸ºä¸ªå°é¡¹ç›®ï¼›</li><li>ä½†å¦‚æœä½ <strong>å¹¶éä¸“ä¸š</strong>çš„Java Webå¼€å‘äººå‘˜ï¼Œä¸æƒ³å­¦ä¹ å¤æ‚çš„Java Webä½“ç³»ï¼Œä½†æ˜¯åˆå…·å¤‡å¼€å‘åŸºç¡€çŸ¥è¯†ï¼Œæƒ³æ­å»ºä¸€ä¸ªæ¼‚äº®çš„åšå®¢ï¼š<strong>WordPress å’Œ Hexoæ˜¯ä½ ä¸äºŒçš„é€‰æ‹©</strong>ã€‚</li></ul></li><li><p><strong>WordPressè¿˜æ˜¯Hexo</strong><sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="ä»wordpressåˆ°hexoï¼šhttps://www.wenjinyu.me/zh/from-wordpress-to-hexo-my-blog-should-have-been-like-this/">[3]</span></a></sup>  ï¼Ÿ</p><p>ä½œä¸ºéƒ½ä½“éªŒè¿‡çš„äººï¼Œæˆ‘è¯´è¯´ä¸€ä¸‹è‡ªå·±æ¯”è¾ƒä¸»è§‚çš„å¯¹æ¯”ï¼š</p><ul><li>WordPressä¼˜ç‚¹ï¼šå¾ˆç®€å•ï¼Œé€‚åˆç‰¹åˆ«å°ç™½çš„åŒå­¦ï¼›</li><li>WordPressç¼ºç‚¹ï¼šå ç”¨èµ„æºå¤šï¼Œ<strong>å“åº”æ…¢</strong>ï¼›<strong>ä¸æ”¯æŒåŸç”Ÿmarkdown</strong>ï¼ˆæ¯æ¬¡è¦å¯¼å‡º.htmlå¤ªç—›è‹¦äº†ï¼‰ï¼›ä¸»é¢˜ä¹Ÿä¸å¤Ÿåˆå¿ƒæ„ï¼ˆä¸ç¾è§‚ï¼‰ã€‚</li></ul><p>æ‰€ä»¥æˆ‘è‡ªå·±ï¼ˆæœ‰å¼€å‘åŸºç¡€ï¼‰è¿˜æ˜¯æ¨èä½¿ç”¨Hexoã€‚</p></li><li><p><strong>Hexo + Github Pages è¿˜æ˜¯ Hexo + è…¾è®¯äº‘</strong>?</p><ul><li><strong>Github Pages æ‰˜ç®¡ç½‘ç«™</strong>ï¼šå› ä¸ºæœåŠ¡å™¨åœ¨å›½å¤–ï¼ˆGithubï¼‰ï¼ŒåŸŸåæ— éœ€å¤‡æ¡ˆï¼Œä½†è®¿é—®é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼Œä¹Ÿæ— éœ€è´­ä¹°äº‘æœåŠ¡å™¨ï¼›</li><li><strong>è…¾è®¯äº‘æ‰˜ç®¡ç½‘ç«™</strong>ï¼šéœ€è¦è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆæˆ–COSï¼‰ï¼Œä¸”åŸŸåéœ€è¦å¤‡æ¡ˆï¼Œä½†è®¿é—®é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚</li></ul></li></ul><p>å› ä¸ºæœ¬æ–‡è€ƒè™‘<strong>æ›´ä½æˆæœ¬ï¼Œæˆ‘ä¹Ÿæ¯”è¾ƒæ‡’ä¸æƒ³å¤‡æ¡ˆï¼Œè®¿é—®é€Ÿåº¦è™½ç„¶æ…¢ç‚¹ä½†è¿˜èƒ½æ¥å—</strong>ï¼Œæ‰€ä»¥é‡‡ç”¨Hexo + Github Pagesä½œä¸ºæœ€ç»ˆçš„å»ºç«™æ–¹æ¡ˆã€‚</p><p>å¥½äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬å¼€å§‹æ¿€åŠ¨äººå¿ƒçš„ç¯èŠ‚å§ï¼ŒåŠ¨æ‰‹æ­å»ºè‡ªå·±çš„ç½‘ç»œå¿«ä¹å°çªã€‚</p><h3 id="Hexo-Github-Pages">Hexo + Github Pages</h3><p>Hexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ï¼Œ<strong>ä¾èµ–å°‘æ˜“äºå®‰è£…ä½¿ç”¨</strong>ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µ<strong>æ‰˜ç®¡åœ¨GitHub Pagesä¸Š</strong>ï¼ˆ<u>æ— éœ€äº‘æœåŠ¡å™¨</u>ï¼‰ï¼Œæ˜¯æ­å»ºåšå®¢çš„é¦–é€‰æ¡†æ¶<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Hexo çŸ¥ä¹æ•™ç¨‹ï¼šhttps://zhuanlan.zhihu.com/p/26625249">[2]</span></a></sup>ã€‚</p><p>ç”¨å¤§ç™½è¯æ¥è¯´å°±æ˜¯ï¼š</p><ul><li>Hexoï¼šç”¨æ¥å°†æˆ‘ä»¬å†™çš„æ–‡ç« ï¼Œæ¸²æŸ“<strong>ç”Ÿæˆæœ¬åœ°ç”Ÿæˆé™æ€ç½‘é¡µ</strong> ï¼Œä½†åªæœ‰ä½ è‡ªå·±èƒ½çœ‹åˆ°ï¼›</li><li>Github Pages : å°†Hexoç”Ÿæˆçš„é™æ€ç½‘é¡µï¼Œ<strong>éƒ¨ç½²æ‰˜ç®¡åˆ°äº‘æœåŠ¡å™¨ï¼ˆGithub Pagesï¼ŒVPSï¼ŒCOSå‡å¯ï¼‰ä¸Š</strong>ï¼Œè¿™æ ·åˆ«äººä¹Ÿå¯ä»¥è®¿é—®ã€‚</li></ul><h4 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h4><blockquote><p>ä»¥ä¸‹ä¸»è¦æ“ä½œå‡å·²åœ¨è™šæ‹Ÿæœºä¸­ç»è¿‡äºŒæ¬¡éªŒè¯ã€‚</p></blockquote><h5 id="å‡†å¤‡å·¥ä½œï¼šGithub-Git">å‡†å¤‡å·¥ä½œï¼šGithub &amp; Git</h5><ol><li><p>åˆ›å»ºGithubä¸ªäººä»“åº“</p><p>âš ï¸ æ³¨æ„å‘½ä»¤æ–¹å¼å¿…é¡»ä¸ºï¼š<code>ä½ çš„Githubç”¨æˆ·å.github.io</code> ï¼Œè¿™ç§å½¢å¼ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202204544684.png" alt="image-20211202204544684"></p><ul><li><p><strong>ç™»é™†ç”¨æˆ·åå’Œæ˜µç§°åˆ†ä¸æ¸…</strong>?ä½ çš„ä¸ªäººä¸»é¡µï¼Œä¸‹é¢çº¢æ¡†æ‰€ç¤ºæ‰æ˜¯ä½ çš„ç”¨æˆ·åã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211209194854716.png" alt="image-20211209194854716"></p></li><li><p>æˆ‘å·²åˆ›å»ºè¿‡è¯¥é¡¹ç›®ï¼Œæ•…æ˜¾ç¤ºé‡å¤</p></li></ul></li><li><p>å®‰è£…Git</p><p><a href="https://git-scm.com/downloads">Gitä¸‹è½½åœ°å€</a> , å®‰è£…å®Œæˆåï¼Œåœ¨å¼€å§‹èœå•é‡Œæ‰¾åˆ°â€œGitâ€-&gt;â€œGit Bashâ€ï¼Œåˆ™Gitå®‰è£…æˆåŠŸã€‚</p><p>åŒæ—¶è¿˜éœ€é…ç½®åŸºæœ¬Githubç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ç”¨æˆ·åå’Œé‚®ç®±ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;Wanghui-Huang&quot;</span>    </span><br><span class="line">$ git config --global user.email <span class="string">&quot;380141202@qq.com&quot;</span></span><br></pre></td></tr></table></figure><p>æœ¬æ–‡é»˜è®¤ä½ å…·å¤‡åŸºæœ¬Gitç›¸å…³çŸ¥è¯†ï¼Œæ•…ä¸å†èµ˜è¿°ï¼Œå¦‚æœä¸å…·å¤‡å¯ä»¥å­¦ä¹ ï¼š<a href="https://hwh.zone/p/43848/">GitåŸºç¡€ç¬”è®°</a> ã€‚</p></li><li><p>å®‰è£…Node.js</p><blockquote><p>HexoåŸºäºNode.jsï¼Œè‡ªç„¶éœ€è¦å®‰è£…ç›¸å…³ç»„ä»¶ã€‚</p></blockquote><p>ä¸‹è½½ <a href="https://nodejs.org/en/download/">Node.js </a>  , ä¸€ç›´é»˜è®¤å®‰è£…å³å¯ï¼ˆä¸è¦éšæ„å‹¾é€‰ï¼‰ã€‚</p><p>å®‰è£…æˆåŠŸåï¼Œåˆ†åˆ«è¾“å…¥ <code>node -v</code> &amp; <code>npm -v</code>ï¼Œå‡ºç°ä»¥ä¸‹ç‰ˆæœ¬ä¿¡æ¯åˆ™å®‰è£…æˆåŠŸï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202211811979.png" alt="image-20211202211811979"></p></li></ol><h5 id="æ­å»ºHexo">æ­å»ºHexo</h5><ol><li><p>æ–°å»ºæ–‡ä»¶å¤¹</p><p>æˆ‘ä»¬åœ¨åˆé€‚çš„è·¯å¾„æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå‘½åéšæ„ï¼Œæˆ‘å‘½åä¸ºï¼š<code>www.hwh.zone</code>ã€‚</p></li><li><p>å®‰è£…Hexo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli </span><br></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ–åšå®¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ./www.hwh.zone/</span><br><span class="line">hexo init blog</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°æµ‹è¯•éªŒè¯</p><blockquote><p>âš ï¸ æ³¨æ„ä»¥ä¸‹å‘½ä»¤å…¨éƒ¨éƒ½åœ¨ï¼š<code>./www.hwh.zone/blog</code> è·¯å¾„ä¸‹æ‰§è¡Œã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ./blog/</span><br><span class="line">hexo new test_my_site  <span class="comment"># ç”Ÿæˆä¸€ç¯‡æ–°æ–‡ç« </span></span><br><span class="line">hexo g  <span class="comment"># ç”Ÿæˆé™æ€æ–‡ä»¶ï¼ˆç½‘é¡µï¼‰</span></span><br><span class="line">hexo s  <span class="comment"># æœ¬åœ°ç”Ÿæˆé™æ€ç½‘ç«™é¢„è§ˆ</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•åï¼Œè¾“å…¥ï¼š<a href="http://localhost:4000">http://localhost:4000</a> ï¼Œå‡ºç°ä»¥ä¸‹é¡µé¢åˆ™ç”ŸæˆæˆåŠŸï¼š</p><blockquote><p>å¦‚æœ<code>hexo s</code> æ‰§è¡ŒæˆåŠŸï¼Œæµè§ˆå™¨å´æ‰“ä¸å¼€ï¼Œé€šå¸¸æ˜¯ç«¯å£ï¼ˆ4000ï¼‰è¢«å ç”¨ã€‚å¯ä»¥è®¾ç½®hexoä½¿ç”¨åˆ«çš„ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server -p 4001</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥ï¼š<a href="http://localhost:4001">http://localhost:4001</a> ï¼Œé‡æ–°æ‰“å¼€å³å¯ã€‚</p></blockquote><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/53_21AIX_V3NIT9L0O6_H$8.png" alt="img"></p><p>ç°åœ¨ä½ å·²ç»åˆæ­¥æ­å»ºå¥½äº†è‡ªå·±çš„ç½‘ç«™ï¼Œç°åœ¨è®©æˆ‘ä»¬å¼€å§‹<strong>å‘å¸ƒè‡ªå·±çš„ç½‘ç«™</strong>ï¼Œè®©æ›´å¤šäººçœ‹åˆ°~</p></li><li><p>é…ç½®è¿œç¨‹æ¨é€ä¿¡æ¯</p><p>åœ¨ <code>./www.hwh.zone/blog</code> è·¯å¾„ä¸‹ï¼Œæ‰¾åˆ°<strong>ä¸»é…ç½®æ–‡ä»¶ï¼š__config.yml</strong> ï¼š</p><ul><li>[æ³¨1]ï¼šå› ä¸ºè¿™ä¸ªæ–‡ä»¶<strong>å¾ˆé‡è¦</strong>ï¼Œç‰¹é™„å›¾ç¤ºä¾‹ ã€‚</li><li>[æ³¨2]ï¼šè¯¥é…ç½®æ–‡ä»¶å¯¹<strong>ç¼©è¿›</strong>ç­‰éƒ½ä¸¥æ ¼è¦æ±‚ï¼Œå»ºè®®ç”¨IDEæ‰“å¼€ç¼–è¾‘ï¼ˆæ¯”å¦‚VScodeï¼‰ï¼Œä¸æ˜“å‡ºé”™ã€‚</li></ul><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202214234731.png" alt="image-20211202214234731" style="zoom:80%;" /><p>åœ¨æ–‡ä»¶æœ€ä¸‹æ–¹é…ç½®ç›¸å…³ä¿¡æ¯ï¼š</p><ul><li>âš ï¸ æ³¨æ„ï¼š <code>:</code> åé¢éœ€è¦ç•™ä¸€ä¸ªç©ºæ ¼ ï¼Œrepoåœ°å€æœ€åéœ€è¦å¸¦ä¸Š <code>.git</code> !</li></ul><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202214436348.png" alt="image-20211202214436348" style="zoom:80%;" /></li><li><p>å®‰è£…Gitæ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></li><li><p>å†™ä¸€ç¯‡è‡ªå·±çš„æ–‡ç« </p><blockquote><p><code>_posts</code>  è·¯å¾„ä¸‹çš„ <code>md</code> æ–‡ä»¶ï¼Œä¼šè¢«Hexoè‡ªåŠ¨è§£æã€æ¸²æŸ“ç”Ÿæˆç½‘é¡µã€‚æˆ‘ä»¬æ‰€æœ‰çš„åšå®¢éƒ½æ˜¯æ”¾åœ¨è¿™ä¸ªç›®å½•çš„ã€‚</p></blockquote><p>æˆ‘ä»¬åœ¨ï¼š<code>www.hwh.zone\blog\source\_posts</code> è·¯å¾„ä¸‹ï¼Œå†™ä¸€ç¯‡å±äºè‡ªå·±çš„æ–‡ç« ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202220312686.png" alt="image-20211202220312686"></p></li><li><p>å¼€å§‹å‘å¸ƒç½‘ç«™</p><p>ä»¥ä¸Šå‘½ä»¤å¦‚æœä¸å‡ºé”™ï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¸…é™¤ç¼“å­˜ç½‘é¡µ</span></span><br><span class="line">hexo clean  </span><br><span class="line"><span class="comment"># ç”Ÿæˆé™æ€ç½‘é¡µ</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="comment"># æ¨é€å‘å¸ƒç½‘ç«™ï¼Œè¦è¾“å…¥Githubè´¦å·å’Œtokenï¼ˆæ³¨æ„ä¸æ˜¯å¯†ç ï¼Œgithubä»ä¸Šæœˆå¼€å§‹å·²ç»ä½¿ç”¨tokenéªŒè¯èº«ä»½ï¼Œç”Ÿæˆtokenå¯å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/38800965ï¼‰</span></span><br><span class="line">hexo d  </span><br></pre></td></tr></table></figure><p>ğŸ› è§£å†³BUGï¼š<strong>OpenSSL SSL_readï¼šConnection was resetï¼Œerron 10054</strong>ã€‚</p><ul><li><p>ç¬¬ä¸€ç§æƒ…å†µï¼šæœªè§£é™¤SSLéªŒè¯</p><ol><li><p>æ‰“å¼€<code>git</code>ï¼Œåˆ‡æ¢åˆ°<code>www.hwh.zone/blog</code> ç›®å½•ä¸‹</p></li><li><p>å–æ¶ˆSSLéªŒè¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.sslVerify &quot;false&quot;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>ç¬¬äºŒç§æƒ…å†µï¼šå¼€äº†å°é£æœºï¼Œè®©å°é£æœºé‡æ–°æ¢ä¸ªæœåŠ¡å™¨é‡æ–°è¿æ¥ã€‚</p></li></ul></li><li><p>æ¬£èµä½ è‡ªå·±çš„ç½‘ç«™~ï¼</p><p>ç°åœ¨æˆ‘ä»¬åœ¨æµè§ˆå™¨è¾“å…¥ï¼š<code>Wanghui-Huang.github.io</code> , å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç¬¬ä¸€ç¯‡åšå®¢å·²ç»æ­£å¼å‘å¸ƒäº†ï¼ğŸ¤™</p><p>æ„‰å¿«çš„å¤šæ¬£èµä¸€ä¸‹å§~</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202220438110.png" alt="image-20211202220438110"></p></li><li><p>TIPS</p><p>ğŸ’¡ ä¸€èˆ¬æˆ‘ä»¬å‘å¸ƒæ–‡ç« ï¼ˆæˆ–ä¿®æ”¹ä¸»é¢˜CSSæ ·å¼ç­‰ï¼‰, æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code> ï¼Œæ‰“å¼€ <code>localhost:4000</code>æœ¬åœ°é¢„è§ˆï¼›</li><li><strong>æœ¬åœ°</strong>è¿›è¡Œä¿®æ”¹ï¼Œe.g. æ–‡ç« å¢æ”¹ã€CSSæ ·å¼ä¿®æ”¹ï¼›</li><li><strong>F5åˆ·æ–°ä¸‹ç½‘é¡µ</strong>å³å¯çœ‹åˆ°ä¿®æ”¹åçš„æ–‡ç« æˆ–æ ·å¼ï¼Œä¸€èˆ¬<strong>ä¸éœ€è¦</strong>é‡æ–°æ‰§è¡Œ<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</code> ï¼›</li><li>ä½†æ˜¯å¦‚æœ<strong>å‡ºç°åˆ·æ–°æ— æ•ˆ</strong>ï¼Œæ­¤æ—¶æœ€å¥½é‡æ–°æ‰§è¡Œä¸‹ä»¥ä¸Šä¸‰ä¸ªå‘½ä»¤ï¼›</li><li>æœ€åå†æ‰§è¡Œ<code>hexo d</code> , å‘å¸ƒæ–‡ç« ã€‚</li></ul></li></ol><h4 id="ä¸»é¢˜-ç¾åŒ–ï¼šä»¥Butterflyä¸ºä¾‹">ä¸»é¢˜&amp;ç¾åŒ–ï¼šä»¥Butterflyä¸ºä¾‹</h4><p>hexoçš„ä¼—å¤šå¼€å‘è€…ï¼Œæ— ç§æä¾›äº†éå¸¸å¤šä¸»é¢˜ä¾›æˆ‘ä»¬è¿›è¡Œä¸»é¢˜ç¾åŒ–ã€‚å»<a href="https://hexo.io/themes/">Hexoå®˜ç½‘</a>æˆ–åœ¨<a href="https://github.com/search?q=hexo+theme">Github-hexo theme</a> ï¼Œæœç´¢ä¸€ä¸ªä½ å–œæ¬¢çš„ä¸»é¢˜ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202221852344.png" alt="image-20211202221852344"></p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨ä¸»é¢˜ <a href="https://github.com/jerryc127/hexo-theme-butterfly">Github-Butterfly</a> ï¼Œä½œä¸ºæœ€ç»ˆçš„é€‰æ‹©ã€‚</p><h5 id="å¿«é€Ÿå¼€å§‹-2">å¿«é€Ÿå¼€å§‹</h5><ol><li><p>ä¸‹è½½ä¸»é¢˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br></pre></td></tr></table></figure><p>âš ï¸ ä¸‹è½½å®Œæ¯•åï¼Œæ–‡ä»¶é‡å‘½åä¸º <code>butterfly</code> ï¼Œ æ”¾åœ¨ <code>www.hwh.zone\blog\themes</code> ç›®å½•ä¸‹ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202222937528.png" alt="image-20211202222937528"></p></li><li><p>åº”ç”¨ä¸»é¢˜</p><p>åœ¨Hexoæ ¹ç›®å½•ä¸‹ä¸»é…ç½®æ–‡ä»¶ <code>_config.yml</code> , è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">butterfly</span></span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…å¿…è¦æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•æŸ¥çœ‹</p><p>é‡æ–°ç”Ÿæˆé™æ€ç½‘é¡µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>æ‰“å¼€ ï¼š<a href="http://localhost:4000">http://localhost:4000</a>  , å¯çœ‹åˆ°ä¸»é¢˜å·²ç»è¢«æˆåŠŸæ›¿æ¢ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/UP$@K0WX1%602JNDTP%60~DLFZM.png" alt="img" style="zoom:80%;" /></li></ol><h5 id="åŸºæœ¬é…ç½®">åŸºæœ¬é…ç½®</h5><blockquote><p>å¦‚æœä½ æƒ³å‚è€ƒæˆ‘çš„é…ç½®ä¿¡æ¯ï¼Œå¯åœ¨è¿›è¡Œ<strong>é™„å½•</strong>ä¸­æŸ¥çœ‹ã€‚</p></blockquote><p>åœ¨è¿™ä¸€èŠ‚æˆ‘ä»¬å°†è¿›è¡Œä¸»é¢˜çš„åŸºæœ¬ä¿¡æ¯è®¾ç½®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>ç½‘ç«™åŸºæœ¬ä¿¡æ¯è®¾ç½®</li><li>èƒŒæ™¯å›¾ç‰‡è®¾ç½®</li><li>ç›®å½•ç›¸å…³è®¾ç½®</li><li>â€¦</li></ul><p>ä½†æ˜¯åœ¨æœ¬æ–‡<strong>å¹¶ä¸å‡†å¤‡å°†ä»¥ä¸Šè®¾ç½®è¿‡ç¨‹è¯¦ç»†åˆ—å‡º</strong>ï¼Œå› ä¸ºå®˜ç½‘å¯¹è¿™äº›çš„æè¿°å·²ç»éå¸¸æ¸…æ™°å’Œç®€æ´ã€‚å› æ­¤ï¼Œ<strong>å¼ºçƒˆå»ºè®®</strong>ä½ å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://butterfly.js.org/posts/21cfbf15/">butterflyä¸»é¢˜é…ç½®å®˜æ–¹æ–‡æ¡£</a> ï¼Œæ ¹æ®ä¸ªäººå–œæ¬¢è¿›è¡Œè¿™äº›åŸºæœ¬è®¾ç½®ã€‚</p><p>åœ¨è¿™é‡Œå°†ä¸»è¦è®°å½•ï¼š<strong>å®˜ç½‘æ–‡æ¡£æœªæåŠçš„ä¼˜åŒ–</strong>ï¼Œä»¥åŠæ ¹æ®<strong>å®˜ç½‘æ–‡æ¡£é…ç½®æ—¶é‡åˆ°çš„é—®é¢˜è§£å†³åŠæ³•</strong>ã€‚</p><h5 id="Markdowmæ¸²æŸ“ä¼˜åŒ–">Markdowmæ¸²æŸ“ä¼˜åŒ–</h5><p>æœ¬èŠ‚æ¶‰åŠï¼šæ•°å­¦å…¬å¼ã€è„šæ³¨ã€è¡¨æƒ…ã€æ ‡é¢˜å¤§å°ç­‰è®¾ç½®ã€‚</p><div class="tabs" id="markdown"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#markdown-1">æ•°å­¦å…¬å¼</button></li><li class="tab"><button type="button" data-href="#markdown-2">è¡¨æƒ…</button></li><li class="tab"><button type="button" data-href="#markdown-3">è„šæ³¨</button></li><li class="tab"><button type="button" data-href="#markdown-4">æ ‡é¢˜å¤§å°</button></li><li class="tab"><button type="button" data-href="#markdown-5">æ ‡ç­¾å¤–æŒ‚</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="markdown-1"><p>æŒ‰ç…§ <a href="https://butterfly.js.org/posts/ceeb73f/#Math-%E6%95%B8%E5%AD%B8">å®˜æ–¹æ–‡æ¡£</a> , è¿›è¡Œé…ç½®ï¼š</p><ol><li><p>ä¿®æ”¹<strong>ä¸»é¢˜é…ç½®æ–‡ä»¶</strong>ï¼ŒåŠ è½½katex.min.css</p><blockquote><p>âš ï¸ per_page å±æ€§ä¸èƒ½è®¾ç½®trueï¼Œå¦åˆ™ä¼šå‡ºç°bugï¼šå…¬å¼è¢«æ¸²æŸ“ä¸¤æ¬¡ã€‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">katex:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># true è¡¨ç¤ºæ¯ä¸€é éƒ½åŠ è¼‰katex.js</span></span><br><span class="line">  <span class="comment"># false éœ€è¦æ™‚åŠ è¼‰ï¼Œé ˆåœ¨ä½¿ç”¨çš„Markdown Front-matter åŠ ä¸Š katex: true</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">false</span>   <span class="comment"># ä¸è¦é€‰æ‹©ä¸ºtrueï¼ï¼</span></span><br><span class="line">  <span class="attr">hide_scrollbar:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨éœ€è¦æ‰“å¼€æ•°å­¦å…¬å¼æ¸²æŸ“çš„æ–‡ç« ï¼Œå¼€å¤´è®¾ç½®ï¼š<code>katex: true</code></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202231613955.png" alt="image-20211202231613955"></p></li><li><p>å®‰è£ hexo-renderer-markdown-it</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm un hexo-renderer-marked --save <span class="comment"># å¦‚æœæœ‰å®‰è£é€™å€‹çš„è©±ï¼Œå¸è¼‰</span></span><br><span class="line">npm un hexo-renderer-kramed --save <span class="comment"># å¦‚æœæœ‰å®‰è£é€™å€‹çš„è©±ï¼Œå¸è¼‰</span></span><br><span class="line"></span><br><span class="line">npm i hexo-renderer-markdown-it --save <span class="comment"># éœ€è¦å®‰è£é€™å€‹æ¸²æŸ“æ’ä»¶</span></span><br><span class="line">npm install @neilsustc/markdown-it-katex --save <span class="comment">#éœ€è¦å®‰è£é€™å€‹katexæ’ä»¶</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹Hexoæ ¹ç›®å½•é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">markdown:</span><br><span class="line">  plugins:</span><br><span class="line">    - plugin:</span><br><span class="line">      name: <span class="string">&#x27;@neilsustc/markdown-it-katex&#x27;</span></span><br><span class="line">      options:</span><br><span class="line">        strict: <span class="literal">false</span></span><br></pre></td></tr></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-2"><p>è¡¨æƒ…æ’ä»¶é…ç½®è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>å®‰è£…æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install markdown-it-emoji --save</span><br></pre></td></tr></table></figure></li><li><p>æ ¹ç›®å½•é…ç½®æ–‡ä»¶æ·»åŠ æ’ä»¶</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202233532272.png" alt="image-20211202233532272"></p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-3"><p>è„šæ³¨ç›´æ¥å®‰è£…æ’ä»¶å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-reference --save</span><br></pre></td></tr></table></figure><p>å¦‚æœå®‰è£…åï¼Œæœ¬åœ°ï¼ˆtyporaï¼‰å¯ä»¥æ­£ç¡®æ¸²æŸ“ï¼Œhexoæ— æ³•æ­£ç¡®æ¸²æŸ“ï¼šå¤šåŠæ˜¯è„šæ³¨ä½¿ç”¨å‡ºç°<strong>è¯­æ³•é”™è¯¯</strong>ã€‚</p><ul><li>åœ¨æ­£æ–‡ä¸­ï¼šä¸¥æ ¼æŒ‰ç…§[^1] å†™å…¥è„šæ³¨ï¼Œ<strong>ä¸è¦ç”¨ä»»ä½•ç©ºæ ¼</strong>ï¼</li><li>åœ¨é“¾æ¥ä¸­ï¼šä¸¥æ ¼æŒ‰ç…§[^1]: å†™å…¥å¼•ç”¨é“¾æ¥ï¼Œ<strong>ä¸è¦ç”¨ä»»ä½•ç©ºæ ¼</strong>ï¼</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-4"><p>butterflyä¸»é¢˜æ ‡é¢˜å¤§å°é»˜è®¤çš„è¿‡å°ï¼Œä¸æ˜“äºå’Œæ­£æ–‡è¿›è¡ŒåŒºåˆ†ã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ol><li>æ‰¾åˆ°<code>\www.hwh.zone\blog\themes\butterfly\source\css\_third-party</code> è·¯å¾„ä¸‹çš„<code>normalize.min.css</code> æ–‡ä»¶</li><li>æ‰‹åŠ¨è®¾ç½® h1~h5æ ‡é¢˜å¤§å°<br><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211202234443112.png" alt="image-20211202234443112"></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="markdown-5"><p>æ ‡ç­¾å¤–æŒ‚æ’ä»¶ <code>Tag Plugins Plus</code> ï¼Œæä¾›äº†ä¸°å¯Œçš„<strong>markdownæ–‡ä»¶ç¼–å†™ç¾åŒ–</strong>ï¼š</p><ul><li>æ—¶é—´è½´</li><li>å„ç§å¡ç‰‡</li><li>éŸ³é¢‘ã€è§†é¢‘æ’å…¥</li><li>â€¦</li></ul><p>å¯ä»¥è®©ä½ çš„æ–‡ç« çœ‹èµ·æ¥ç¾è§‚è®¸å¤šï¼Œå…·ä½“é…ç½®è¯·å‚è€ƒï¼š<a href="https://akilar.top/posts/615e2dec/">Tag Plugins Pluså®˜ç½‘</a> ã€‚</p><p>æ–‡æ¡£æ¸…æ™°ç®€æ´ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h5 id="æ”¯æŒè¯„è®ºåŠŸèƒ½">æ”¯æŒè¯„è®ºåŠŸèƒ½</h5><p>å®˜ç½‘æ–‡æ¡£è™½ç„¶ç»™äº†å¾ˆå¤šç§è®¾ç½®çš„è¯„è®ºæ–¹å¼ï¼Œä½†å°±æˆ‘è‡ªå·±å°è¯•è€Œè¨€ï¼Œ<strong>Utteranceså’ŒTwikoo</strong>å±äºæ¯”è¾ƒæ–¹ä¾¿çš„æ–¹å¼ã€‚</p><p>Utterancesä¸»è¦ä¼˜ç‚¹ï¼š</p><ul><li>å’ŒGitalkç±»ä¼¼ï¼Œä½†ä¸éœ€è¦è¿‡å¤šçš„æƒé™è®¾ç½®ï¼›</li><li>ç›¸æ¯”Facebook Comments ç­‰æ— éœ€ç¿»å¢™ï¼›</li><li>ç›¸æ¯”Disqusç­‰UIæ›´ç®€æ´ç¾è§‚ã€‚</li></ul><p>å”¯ä¸€ç¾ä¸­ä¸è¶³çš„ä¾¿æ˜¯<strong>ä¸èƒ½åŒ¿åè¯„è®º</strong>ï¼Œç•™è¨€å¿…é¡»è¦ç”¨Githubè´¦å·å…ˆç™»å½•ã€‚<strong>Twikoo</strong>åœ¨ä¸‹æ–‡è¿›è¡Œä»‹ç»ã€‚</p><div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">Utterancesï¼ˆå…è´¹ï¼‰</button></li><li class="tab"><button type="button" data-href="#tags-2">Twikooï¼ˆä»˜è´¹ï¼‰</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><p>ä»¥ä¸‹æ˜¯Utterancesè®¾ç½®è¿‡ç¨‹ï¼š</p><ol><li><p>åœ¨Githubåˆ›å»ºä¸€ä¸ªpublicçš„é¡¹ç›®</p><p>ä¸å†èµ˜è¿°è¿‡ç¨‹ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ï¼š<a href="https://github.com/Wanghui-Huang/gittalk">https://github.com/Wanghui-Huang/gittalk</a> ï¼Œè¿™ä¸ªé¡¹ç›®ã€‚</p></li><li><p>å®‰è£… utterances</p><p>ç‚¹å‡»ï¼š<a href="https://github.com/apps/utterances">https://github.com/apps/utterances</a> ï¼Œå®‰è£…appï¼ˆå³ä¸Šæ–¹å¤„<code>Install</code>æŒ‰é’®ï¼‰ã€‚</p><p>å®‰è£…æˆåŠŸåï¼Œä¼šå‡ºç°ä¸‹é¢<code>Configure</code>æŒ‰é’®ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203105709777.png" alt="image-20211203105709777"></p></li><li><p>è®¾ç½®ç›¸å…³ä¿¡æ¯</p><p>ç‚¹å‡»<code>Configure</code>æŒ‰é’®ï¼Œè¿›å…¥è®¾ç½®ç•Œé¢ï¼Œæ³¨æ„<strong>çº¢æ¡†å¤„</strong>ç›¸å…³ä¿¡æ¯è®¾ç½®ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203105915848.png" alt="image-20211203105915848"></p><p>è®¾ç½®å®Œæ¯•åä¿å­˜ã€‚</p></li><li><p>ä¸»é¢˜æ–‡ä»¶é…ç½®</p><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼šrepoä¿®æ”¹ä¸ºä½ åˆšåˆšåˆ›å»ºçš„repoï¼Œå½¢å¼ä¸º <code>ä½ çš„ç”¨æˆ·å.é¡¹ç›®å</code></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203110208806.png" alt="image-20211203110208806"></p><p>ç»§ç»­ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šè¯„ä»·æ’ä»¶åï¼š<br><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203110412952.png" alt="image-20211203110412952"></p></li><li><p>æµ‹è¯• &amp; bugè§£å†³</p><p>é€‰æ‹©ä»»æ„ä¸€ç¯‡æ–‡ç« ï¼Œå¯ä»¥çœ‹åˆ°è¯„è®ºæ¡†å·²ç»é¡ºåˆ©å‡ºç°ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203110741161.png" alt="image-20211203110741161"></p><p>ç»è¿‡å®é™…æµ‹è¯•ï¼Œä¾æ—§ä¼šå‡ºç°è¯„è®ºæ¡†æ— æ³•æ˜¾ç¤ºçš„é—®é¢˜ï¼š</p><ul><li>æˆ‘çš„é—®é¢˜æ˜¯å› ä¸ºä½¿ç”¨äº†è‡ªå·±çš„åŸŸåï¼Œ<code>https</code>ä¸å®‰å…¨ä¾¿ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼›</li><li>å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„åŸŸåï¼Œåç»­å°èŠ‚æœ‰è¯¦ç»†æ•™ç¨‹ &amp; è¸©å‘è®°å½•ã€‚</li></ul><p>å¯ä»¥åœ¨ Githubé¡¹ç›®ï¼š<code>Wanghui-Huang.github.io</code> â†’ <code>Setting</code>â†’<code>Pages</code>   ï¼Œå‹¾é€‰<code>Enforce HTTPS</code>  ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203111826078.png" alt="image-20211203111826078"></p><p>ä¸‰è¿é‡æ–°ç”Ÿæˆé™æ€ç½‘é¡µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>ä¾¿å¯ä»¥çœ‹åˆ°è¯„è®ºæ¡†å·²ç»æ­£ç¡®æ˜¾ç¤ºäº†ã€‚</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><p>è™½ç„¶Utteranceså·²ç»è¶³å¤Ÿç®€æ´ä¼˜ç§€ä¸”å…è´¹ï¼Œä½†æ˜¯TwikooåŸºäºè…¾è®¯äº‘å¼€å‘ï¼Œ<strong>åœ¨å›½å†…é€Ÿåº¦å¾ˆå¿«&amp;æ”¯æŒåŒ¿å</strong>ï¼Œä»·æ ¼ä¹Ÿè¶³å¤Ÿå®æƒ ï¼ˆåŒ…å¹´å¤§çº¦6å…ƒ/æœˆï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œæ”¯æŒä¸‹ä¸œå®¶ä¸šåŠ¡æœ€åé€‰æ‹©äº†è¿™ä¸ªæ–¹æ¡ˆã€‚</p><ol><li><p>è…¾è®¯äº‘å‡½æ•°é…ç½®</p><p>è¿™ä¸€éƒ¨åˆ†çœ‹<a href="https://twikoo.js.org/quick-start.html">å®˜ç½‘æ–‡æ¡£</a>å³å¯ï¼Œå¾ˆè¯¦ç»†ä¸å†èµ˜è¿°ã€‚</p></li><li><p>Butterflyä¸»é¢˜é…ç½®</p><p>ä¿®æ”¹ <code>ä¸»é¡Œé…ç½®æ–‡ä»¶</code> ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">twikoo:</span></span><br><span class="line">  <span class="attr">envId:</span> <span class="string">blog-comments-5g2cfs*******</span>  <span class="comment"># è…¾è®¯äº‘å‡½æ•°é…ç½®å®Œåçš„id</span></span><br><span class="line">  <span class="attr">region:</span> <span class="string">ap-shanghai</span>  <span class="comment"># é»˜è®¤ä¸Šæµ· </span></span><br><span class="line">  <span class="attr">visitor:</span> <span class="literal">true</span>        <span class="comment"># æ˜¾ç¤ºæ–‡ç« æµè§ˆæ•°</span></span><br><span class="line">  <span class="attr">option:</span></span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><p>é™æ€ç½‘é¡µç”Ÿæˆä¸‰è¿ï¼Œä¾¿å¯ä»¥çœ‹åˆ°å·²ç»ç”ŸæˆæˆåŠŸäº†ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203160342989.png" alt="image-20211203160342989"></p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h4 id="å…¶å®ƒè¡¥å……">å…¶å®ƒè¡¥å……</h4><blockquote><p>é“¾æ¥å¤ªé•¿ä¸å¥½åˆ†äº«ï¼Ÿ</p><p>æƒ³è¦ä¸€ä¸ªå±äºè‡ªå·±çš„æ¼‚æ¼‚åŸŸåï¼Ÿ</p><p>ç½‘ç«™å‘å¸ƒåæœ¬åœ°å›¾ç‰‡å…¨æŒ‚ï¼Ÿ</p><p>â€¦</p></blockquote><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä¾æ¬¡è¿›è¡Œè§£å†³å„ç§é—®é¢˜ï¼Œè®©ä½ çš„ç½‘ç»œå°çªçœ‹èµ·æ¥æ›´åŠ çš„ä¸“ä¸šã€‚</p><h5 id="ä½¿ç”¨çŸ­è¿æ¥">ä½¿ç”¨çŸ­è¿æ¥</h5><p>hexo é»˜è®¤ç”Ÿæˆæ–‡ç« <strong>é•¿é“¾æ¥å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹</strong>ï¼š</p><ol><li>å¦‚æœæ–‡ç« ååŒ…å«ä¸­æ–‡ï¼Œå°†ä¼šè¢«è½¬ç ï¼Œé“¾æ¥ä¸é›…è§‚ä¸”é•¿ï¼›</li><li>é•¿é“¾æ¥ä¸åˆ©äºæœç´¢å¼•æ“æ”¶å½•ï¼›</li><li>é•¿é“¾æ¥ä¸æ–¹ä¾¿åˆ†äº«ç»™ä»–äººã€‚</li></ol><p>å› æ­¤ï¼Œå‚è€ƒ<sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Hexo-abbrlinkæ’ä»¶ç”Ÿæˆå”¯ä¸€æ–‡ç« é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/112318081">[4]</span></a></sup>ï¼Œæˆ‘ä»¬åˆ©ç”¨Hexo-abbrlinkæ’ä»¶ï¼Œç”Ÿæˆå”¯ä¸€æ–‡ç« çŸ­é“¾æ¥ã€‚</p><ol><li><p>å®‰è£…æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æ ¹ç›®å½•é…ç½®æ–‡ä»¶</p><ul><li><code>url</code>ï¼šä½ çš„åŸŸå ï¼Œå¦‚æœæ˜¯Github Pageså‘½ä»¤æ–¹å¼ä¸º <code>https://ä½ çš„ç”¨æˆ·å.github.io</code></li><li><code>permalink</code>ï¼šæŒ‰ä¸‹å›¾ä¿®æ”¹</li><li><code>permalink_defaults</code>ï¼šæ³¨é‡Šæ‰</li></ul><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203120905856.png" alt="image-20211203120905856"></p></li><li><p>ä¸‰è¿é‡æ–°ç”Ÿæˆ</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><p>ç”Ÿæˆå®Œæ¯•åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¯ä¸€ç¯‡æ–‡ç« å¼€å¤´ï¼Œè‡ªåŠ¨å¤šå‡ºäº†ä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">abbrlink:</span> <span class="number">56326</span>  <span class="comment"># è¿™ä¸ªidæ¯ç¯‡æ–‡ç« éƒ½ä¸ä¸€æ ·</span></span><br></pre></td></tr></table></figure><p>æ–‡ç« é“¾æ¥ä¹Ÿå˜æˆäº†çŸ­é“¾æ¥çš„å½¢å¼ï¼š<br><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203121301172.png" alt="image-20211203121301172"></p></li></ol><h5 id="ä½¿ç”¨å›¾åºŠ">ä½¿ç”¨å›¾åºŠ</h5><p>ä½¿ç”¨markdownæœ€å¤´ç–¼çš„åœ°æ–¹ï¼Œä¼°è®¡å°±æ˜¯å›¾ç‰‡é—®é¢˜äº†ï¼šæ–‡ç« å›¾ç‰‡é€šå¸¸ä¿å­˜åœ¨<strong>æœ¬åœ°</strong>ï¼Œå‘å¸ƒç½‘ç«™è¿˜æ˜¯åˆ†äº«ç»™ä»–äººé€šå¸¸è¿˜éœ€è¦å•ç‹¬ä¿å­˜å›¾ç‰‡ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸€ç‚¹ä¹Ÿä¸coolã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>å›¾åºŠ</strong>ï¼Œå°†å›¾ç‰‡é€šé€šä¿å­˜åœ¨<strong>äº‘ç«¯</strong>ï¼Œæœ¬åœ°åªéœ€åƒå¦‚ä¸‹å¼•ç”¨ä¸ªé“¾æ¥å³å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![image-20211203121301172](https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203121301172.png)</span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«çš„ï¼Œé…åˆ<a href="https://typora.io/">Typora</a>ï¼Œæ‰€æœ‰æœ¬åœ°å›¾ç‰‡å¯ä»¥è‡ªåŠ¨ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œå¯ä»¥è¯´æ˜¯å¾ˆæ–¹ä¾¿äº†ã€‚</p><p>å› æ­¤ï¼Œæœ¬æ–‡å‚è€ƒ<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Typora+PicGo+è…¾è®¯äº‘COSå®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼šhttps://www.daimajiaoliu.com/daima/56a7c8410d4cc09">[5]</span></a></sup>ï¼Œä½¿ç”¨<strong>Typoraé…åˆè…¾è®¯äº‘COSå­˜å‚¨æ­å»ºå›¾åºŠ</strong>ã€‚</p><blockquote><p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©è¦ä»˜è´¹çš„è…¾è®¯äº‘COSï¼Ÿ</strong></p><p>åœ¨è¿™ä¹‹å‰æˆ‘ä¹Ÿé€‰æ‹©äº†å…¶å®ƒçš„å…è´¹å›¾åºŠï¼Œä½¿ç”¨ä½“éªŒä¸å¤ªä½³ï¼š</p><ul><li>é€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œä¸”é™åˆ¶ä¸€å¤©ä¸Šä¼ çš„æ•°é‡å’Œé¢‘ç‡ï¼Œæœ‰æ—¶å€™éœ€è¦é›†ä¸­ä¸Šä¼ æœ¬åœ°æ–‡ä»¶çš„å¤§é‡å›¾ç‰‡ä¾¿å¾ˆä¸å‹å¥½äº†ï¼›</li><li>è…¾è®¯äº‘COSè™½ç„¶ä»˜è´¹ï¼Œä½†æ˜¯ä»·æ ¼å¾ˆä¾¿å®œï¼Œ10å…ƒå¯ä»¥ç§Ÿ10G/å¹´ã€‚</li></ul><p>å› æ­¤ï¼Œæœ€ç»ˆæˆ‘è¿˜æ˜¯é€‰æ‹©äº†è…¾è®¯äº‘COSå­˜å‚¨ä½œä¸ºå›¾åºŠã€‚</p></blockquote><ol><li><p>ä¸‹è½½Typora</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://pc.qq.com/search.html#!keyword=typora">è…¾è®¯äº‘é«˜é€Ÿä¸‹è½½</a> ï¼Œé»˜è®¤å®‰è£…å³å¯ã€‚</p></li><li><p>ä¸‹è½½PicGo</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/Molunerfinn/PicGo/releases">å®˜ç½‘ä¸‹è½½</a> ï¼Œé»˜è®¤å®‰è£…å³å¯ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203123433623.png" alt="image-20211203123433623"></p></li><li><p>è…¾è®¯äº‘åˆ›å»ºCOSå­˜å‚¨</p><p>è¿›å…¥è…¾è®¯äº‘å¯¹è±¡å­˜å‚¨ï¼Œåœ¨å­˜å‚¨æ¡¶åˆ—è¡¨ä¸­ç‚¹å‡»åˆ›å»ºå­˜å‚¨æ¡¶ï¼š</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/736d7f4664f36fc1d2b286ac0859e814.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:80%;" /><p>è®¾ç½®å­˜å‚¨ä¿¡æ¯å¦‚ä¸‹ï¼š</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/56fdfdd3b03104661de1abc72ea521fe.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:80%;" /></li><li><p>å¯†é’¥ç®¡ç†</p><p>å¯†é’¥éœ€è¦ç­‰ä¼šå„¿åœ¨é…ç½®æ–‡ä»¶ä¸­ç”¨åˆ°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æå‰è®¾ç½®å¥½ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/604771ab575b32e30683e83e058c49a5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦‚æœæ²¡æœ‰å¯†é’¥ï¼Œåˆ™æ–°å»ºå¯†é’¥ï¼š</p><ul><li>è®°å½•ä»¥ä¸‹ï¼š<strong>SecretID å’Œ SecretKey</strong>ï¼Œç­‰ä¸‹è¦ç”¨åˆ°ã€‚</li></ul><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/a0c7902b4f48200a071bf216d574aba4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>é…ç½®PicGo</p><p>æ‰“å¼€PicGoåï¼Œå›¾ç‰‡ä¸Šä¼ é€‰æ‹©è…¾è®¯äº‘COSï¼Œç„¶åè¿›è¡Œä»¥ä¸‹è®¾ç½®ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1cf828eadf1b5b060fdd6f9337afa205.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>æµ‹è¯•PicGO</p><p>åœ¨å·¦ä¸Šã€ä¸Šä¼ åŒºã€‘ï¼Œä»»æ„æ‹–æ‹½ä¸€å¼ å›¾ç‰‡ï¼Œå¦‚æœä¸Šä¼ æˆåŠŸåˆ™è¯´æ˜é…ç½®æˆåŠŸã€‚</p></li><li><p>é…ç½®Typora</p><p>æ‰“å¼€Typoraï¼š<code>æ–‡ä»¶</code>â†’<code>åå¥½è®¾ç½®</code>â†’<code>å›¾åƒ</code>ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/5b009f6cfef200d2b3ef58655730777d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></li><li><p>æµ‹è¯•Typoraé…ç½®</p><ol><li>åœ¨å³ä¾§æ ä¸­å·¦ä¸‹è§’ï¼Œæ‰¾åˆ°ã€éªŒè¯å›¾ç‰‡ä¸Šä¼ é€‰é¡¹ã€‘ï¼Œæµ‹è¯•æ˜¯å¦æˆåŠŸï¼›</li><li>æ‰“å¼€typoraï¼Œä»»æ„åœ¨æ–‡ç« ä¸­ç²˜è´´ä¸€å¼ æœ¬åœ°å›¾ç‰‡ï¼Œçœ‹æ˜¯å¦ä¼š<strong>è‡ªåŠ¨ä¸Šä¼ </strong>ã€‚</li></ol><p>ä»¥ä¸ŠæˆåŠŸï¼Œä¾¿å¯ä»¥æ„‰å¿«çš„å¼€å§‹ç¼–å†™æ–‡ç« äº†ï¼Œå¼€å§‹ä½ çš„å¤§æ–‡è±ªç”Ÿæ´»äº†ã€‚</p></li></ol><h5 id="ä½¿ç”¨è‡ªå·±çš„åŸŸå">ä½¿ç”¨è‡ªå·±çš„åŸŸå</h5><blockquote><p><code>xxxxx.github.io</code> çœ‹èµ·æ¥ä¸‘ä¸‘çš„ï¼Œæ€ä¹ˆæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„æ¼‚æ¼‚åŸŸåå‘¢ï¼Ÿ</p></blockquote><ol><li><p>ä¹°ä¸€ä¸ªå±äºè‡ªå·±çš„åŸŸå</p><p>ç‚¹å‡»ï¼š<a href="https://dnspod.cloud.tencent.com/">è…¾è®¯äº‘åŸŸåæ³¨å†Œ</a> ï¼Œæ³¨å†Œä¸€ä¸ªè‡ªå·±çš„åŸŸåã€‚</p></li><li><p>å®åè®¤è¯</p><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://cloud.tencent.com/document/product/242/6707">åŸŸåå®åè®¤è¯</a> , ä¸è¿›è¡Œå®åè®¤è¯å¯èƒ½æ— æ³•è¿›è¡Œæ­£å¸¸åŸŸåè§£æã€‚</p></li><li><p>åŸŸåè§£æè®¾ç½®</p><p>è¿›å…¥è…¾è®¯äº‘è§£æè®¾ç½®ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203130549613.png" alt="image-20211203130549613"></p><p>åˆ†åˆ«æ·»åŠ ä»¥ä¸‹è§£æè®°å½•ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203130911464.png" alt="image-20211203130911464"></p><ul><li>é…ç½®CNAMEï¼šæˆ‘çš„åŸŸå <code>www.hwh.zone</code>  å¯ä»¥è§£æåˆ°åŸæœ¬åŸŸå<code>Wanghui-Huang.github.io</code>  ï¼Œè¿™ä¸ªæ—¶å€™ <code>www.hwh.zone</code>ç›¸å½“æ˜¯ä¸ªåˆ«åï¼Œä¹Ÿå°±æ˜¯<strong>æš´éœ²ç»™åˆ«äººçœ‹åˆ°çš„åå­—</strong>ã€‚</li><li>é…ç½®Aè®°å½•ï¼šå¯ä»¥æŠŠåŸŸå<code>www.hwh.zone</code> <strong>ç›´æ¥è§£æ</strong>åˆ° <code>Github IPåœ°å€</code> ï¼ˆäºŒæ¬¡ä¿éšœèƒ½è§£æåˆ°Github IPåœ°å€ï¼‰ã€‚</li></ul><p><strong>ä¸ç†è§£CNAMEä½œç”¨ï¼Ÿæœ‰äº†Aè®°å½•è§£æä¸ºä»€ä¹ˆè¿˜è¦CNAME</strong>ï¼Ÿå¯å‚è€ƒï¼š<a href="https://www.zhihu.com/question/22916306">cnameè®°å½•æ˜¯ä»€ä¹ˆï¼Ÿä»–å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</a></p></li><li><p>ç”³è¯·å…è´¹SSLè¯ä¹¦</p><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://cloud.tencent.com/document/product/400/6814">åŸŸåå‹ï¼ˆDVï¼‰å…è´¹ SSL è¯ä¹¦ç”³è¯·æµç¨‹</a></p></li><li><p>Github Pageè®¾ç½®</p><p>åœ¨ Githubé¡¹ç›®ï¼š<code>Wanghui-Huang.github.io</code> â†’ <code>Setting</code>â†’<code>Pages</code>   ï¼Œè®¾ç½®ä½ è‡ªå·±çš„åŸŸå  ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203132157159.png" alt="image-20211203132157159"></p></li><li><p>åˆ›å»ºCNAMEæ–‡ä»¶</p><p>è¿›å…¥æœ¬åœ°åšå®¢æ–‡ä»¶å¤¹ç›®å½•ï¼Œä¾‹å¦‚æˆ‘çš„ï¼š<code>www.hwh.zone\blog\source</code> ï¼š</p><ul><li><p><strong>æ–°å»ºæ–‡ä»¶CNAMEâ†’è¾“å…¥ä½ çš„åŸŸå</strong></p><p>âš ï¸ æ³¨æ„ï¼šåŸŸåä¸è¦å¸¦<code>www.</code></p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211203132639333.png" alt="image-20211203132639333"></p></li><li><p><strong>ä¿å­˜æ–‡ä»¶</strong></p><p>âš ï¸ ä¿å­˜æ–‡ä»¶<strong>ç±»å‹ä¸ºæ‰€æœ‰æ–‡ä»¶</strong>ï¼Œä¸æ˜¯TXTæ–‡ä»¶ï¼</p></li></ul></li><li><p>æµ‹è¯•</p><p>ç½‘ç«™ä¸‰è¿å‘å¸ƒåï¼Œæµè§ˆå™¨è¾“å…¥ï¼š<code>ä½ çš„åŸŸå</code> ï¼Œä¾¿å¯ä»¥æ­£å¸¸å¼€å§‹è§£æäº†ã€‚</p><p>å¦‚æœé‡åˆ°é”™è¯¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºç•™è¨€ã€‚</p></li></ol><h5 id="ç½‘ç«™å¤‡æ¡ˆ">ç½‘ç«™å¤‡æ¡ˆ</h5><p>ç½‘ç«™å¤‡æ¡ˆåé€šå¸¸æœ‰ä¸å°‘å¥½å¤„<sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="ç½‘ç«™åŸŸåå¤‡æ¡ˆçš„å¥½å¤„æœ‰å“ªäº›ï¼Ÿhttps://www.ggcx.com/news/2105/251639.html">[6]</span></a></sup>ï¼Œå¯¹äºä¸ªäººåšå®¢æ¥è¯´æœ€é‡è¦çš„ä¸‰ä¸ªä¾¿æ˜¯ï¼š</p><ol><li>åŠ å¿«ç½‘ç«™çš„è®¿é—®é€Ÿåº¦ï¼›</li><li>åˆ©äºæœç´¢å¼•æ“æ”¶å½•ï¼›</li><li>Github Pagesè®¿é—®è¾ƒæ…¢ï¼Œå¤‡æ¡ˆåå¯ä»¥<strong>å°†æœåŠ¡å™¨éƒ¨ç½²åˆ°ï¼ˆå›½å†…æœåŠ¡å™¨ï¼‰è…¾è®¯äº‘COSæˆ–è€…è…¾è®¯äº‘VPS</strong>ä¸Šï¼Œè®¿é—®é€Ÿåº¦æå¤§åŠ å¿«ã€‚</li></ol><p>ä½†è¿™<strong>ä¸å½±å“ç½‘ç«™åŸŸåçš„æ­£å¸¸è§£æï¼ˆé™¤äº†æ…¢ç‚¹</strong>ï¼‰ï¼Œå› ä¸ºæ¯•ç«Ÿç½‘ç«™éƒ¨ç½²åœ¨<strong>å›½å¤–æœåŠ¡å™¨</strong>ï¼ˆGithubï¼‰ä¸Šã€‚</p><p>å¦å¤–ï¼Œç½‘ç«™å¤‡æ¡ˆç»è¿‡æˆ‘çš„å°è¯•ç›¸æ¯”ä¹‹å‰ç®€ä¾¿å¾ˆå¤šï¼Œåªéœ€è¦åœ¨<a href="https://cloud.tencent.com/product/ba">è…¾è®¯äº‘å…¨ç¨‹çº¿ä¸Šå¤‡æ¡ˆ</a>ç™»è®°æ³¨å†Œå°±å¥½ã€‚ä½†å› ä¸ºæˆ‘èº«ä»½è¯å½’å±çœä»½ï¼ˆæ±Ÿè¥¿ï¼‰ï¼Œæ ¹æ®å½“åœ°æ”¿ç­–<strong>å¤‡æ¡ˆéœ€è¦å…³é—­ç½‘ç«™</strong>ï¼Œæ‰€ä»¥æ”¾å¼ƒæŠ˜è…¾äº†ã€‚åç»­æœ‰æ—¶é—´è¡¥ä¸Šã€‚</p><h3 id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</h3><p>æ–­æ–­ç»­ç»­å†™äº†å¤§æ¦‚ä¸€å¤©ï¼Œç»ˆäºè®°å½•å®Œäº†Hexoå»ºç«™çš„åŸºæœ¬æ‰€æœ‰çš„è¿‡ç¨‹ã€‚å› ä¸ºæ²¡æ€ä¹ˆè¿åŠ¨ï¼Œè‚©è†€ä¸€ç›´éšéšé…¸ç—›è¿˜æ˜¯åšæŒå†™å®Œäº†ï¼Œå¯ä»¥è¯´æ˜¯èº«æ®‹å¿—åšäº†ã€‚</p><p>åç»­çš„è¯å¯èƒ½ä¼šç»§ç»­æ›´æ–°è¿™ç¯‡æ–‡ç« ï¼Œæ›´å¥½çš„æ‰“é€ è‡ªå·±çš„å°çªï¼Œä½†ä¸»è¦è¿˜æ˜¯æ›´æ–°ä¸€äº›C++å’ŒéŸ³è§†é¢‘ç›¸å…³åšæ–‡ï¼š</p><ul><li>C++ä»é›¶å¼€å§‹ç³»åˆ—ï¼šC++åŸºç¡€ã€C++11ç‰¹æ€§å­¦ä¹ ã€C++å…«è‚¡æ€»ç»“ã€C++å¼€æºæºç åˆ†æï¼›</li><li>éŸ³è§†é¢‘ç³»åˆ—ï¼šå¾…å®šï¼›</li><li>å…¶å®ƒï¼š<strong>å¤‡æ¡ˆå®Œæˆå</strong>ï¼Œæ›´æ–°éƒ¨ç½²åˆ°è…¾è®¯äº‘COSä¸Šæ•™ç¨‹ã€‚</li></ul><p>æ¬¢è¿ç»§ç»­å…³æ³¨ï¼Œä¸€èµ·å­¦ä¹ ã€‚</p><img src="https://thumb.jfcdns.com/thumb/up/2017-8/201788194159800965660810_460_0.jpg" alt="æºœäº†è¡¨æƒ…åŒ…-æºœäº†æºœäº†è¡¨æƒ…åŒ…ä¸‹è½½å…¨å¥—æ— æ°´å°--pc6ä¸‹è½½" style="zoom: 50%;" /><h3 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h3><div class="timeline"><div class="timenode"><div class="meta"><p><p>2021-12-06 ï¼šæ›´æ–°æ–‡æ¡£</p></p></div><div class="body"><ol><li>ä¿®æ”¹å¤‡æ¡ˆç›¸å…³æè¿°ï¼›</li><li>æ–°å¢è…¾è®¯äº‘COSç›¸å…³æè¿°ã€‚</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-12-05 ï¼šæ›´æ–°æ–‡æ¡£</p></p></div><div class="body"><ol><li>æ”¯æŒæ ‡ç­¾å¤–æŒ‚ï¼Œå¹¶æ–°å¢å®‰è£…æ•™ç¨‹</li><li>ä¼˜åŒ–æ–‡ç« ç‰ˆå¼ï¼šåˆ†æ ä¹¦å†™</li><li>æ›´æ–°é…ç½®æ–‡ä»¶</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-12-01 ï¼šç¬¬ä¸€æ¬¡æ›´æ–°</p></p></div><div class="body"><ol><li>ä¸Šä¼ åˆç¨¿å¹¶å‘å¸ƒ</li></ol></div></div></div><h3 id="é™„å½•">é™„å½•</h3><blockquote><p>ä»¥ä¸‹é…ç½®æ–‡ä»¶æœ€ç»ˆæ›´æ–°æ—¶é—´ï¼š2021/12/05  00:00 ã€‚</p></blockquote><ul><li><p><strong>royhuangâ€™s ä¸»é…ç½®æ–‡ä»¶</strong></p><p>ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ï¼š<a href="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/hwh.zone/p/hexo-build-site/_config.yml">_config.yml</a></p></li><li><p><strong>royhuangâ€™s Butterflyé…ç½®æ–‡ä»¶</strong></p><p>ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹ï¼š<a href="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/hwh.zone/p/hexo-build-site/_config.butterfly.yml">_config.butterfly.yml</a></p></li></ul><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Butterfly å®˜æ–¹æ•™ç¨‹ï¼šhttps://butterfly.js.org/posts/21cfbf15/<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Hexo çŸ¥ä¹æ•™ç¨‹ï¼šhttps://zhuanlan.zhihu.com/p/26625249<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ä»wordpressåˆ°hexoï¼šhttps://www.wenjinyu.me/zh/from-wordpress-to-hexo-my-blog-should-have-been-like-this/<a href="#fnref:3" rev="footnote"> â†©</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Hexo-abbrlinkæ’ä»¶ç”Ÿæˆå”¯ä¸€æ–‡ç« é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/112318081<a href="#fnref:4" rev="footnote"> â†©</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Typora+PicGo+è…¾è®¯äº‘COSå®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼šhttps://www.daimajiaoliu.com/daima/56a7c8410d4cc09<a href="#fnref:5" rev="footnote"> â†©</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ç½‘ç«™åŸŸåå¤‡æ¡ˆçš„å¥½å¤„æœ‰å“ªäº›ï¼Ÿhttps://www.ggcx.com/news/2105/251639.html<a href="#fnref:6" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> å»ºç«™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç«™å»ºè®¾ </tag>
            
            <tag> hexo </tag>
            
            <tag> github pages </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰_è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</title>
      <link href="/p/31667/"/>
      <url>/p/31667/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>å…«ã€åœºæ™¯é¢˜&amp;æ™ºåŠ›é¢˜</h1><h2 id="8-1-åœºæ™¯é¢˜">8.1 åœºæ™¯é¢˜</h2><h4 id="1-è®¾è®¡ä¸€ä¸ªå¾®ä¿¡è¿åŠ¨æ’è¡Œæ¦œï¼Ÿï¼ˆRedisï¼‰">1. <strong>è®¾è®¡ä¸€ä¸ªå¾®ä¿¡è¿åŠ¨æ’è¡Œæ¦œï¼Ÿï¼ˆRedis</strong>ï¼‰</h4><ul><li><p><strong>è¢«CSIGä¼¤è¿‡çš„çš„å¿ƒè¿˜å¯ä»¥çˆ±è°ï¼ˆç¬¬ä¸€æ¬¡å›ç­”</strong>ï¼‰</p><blockquote><p>â€œå¯ä»¥ä½¿ç”¨mysql, å°†ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨å…³è”çš„è¿åŠ¨è®°å½•æŸ¥è¯¢å‡ºæ¥ï¼Œç„¶åé€šè¿‡order by æ¥è¿›è¡Œæ’åºï¼Œå°±å¯ä»¥å®ç°äº†ã€‚â€</p></blockquote><p>ä¸€æ—¦æ•°æ®é‡å¤§è¾¾åˆ°åƒä¸‡çº§åˆ«çš„æ—¶å€™ï¼Œä¸å¯é¿å…åœ°ä¼šå‡ºç°æ…¢æŸ¥è¯¢ï¼Œæ•ˆç‡å°±ä¼šé™ä½ã€‚æ‰€ä»¥<u>è¿™ä¸æ˜¯é¢è¯•å®˜æƒ³å¬åˆ°çš„å›ç­”ï¼</u></p></li><li><p><strong>Redisâ€“é«˜æ•ˆ</strong></p><p>ä½¿ç”¨Redisçš„æœ‰åºé›†åˆ zsetï¼ˆ<strong>æœ‰åºä¸”ä¸é‡å¤</strong>ï¼‰ ã€‚å› ä¸º zset æ’åºçš„ä¸‹æ ‡ä»0 å¼€å§‹ï¼Œè‡ªå¸¦ä¸€ä¸ªscore å€¼ï¼Œè¯¥å€¼å¯ä»¥å½“ä½œæ’è¡Œçš„æ ‡å‡† ã€‚</p><ul><li><strong>æ·»åŠ ç”¨æˆ·å’Œæ­¥æ•°</strong>ï¼š <code>zadd key score member</code></li><li><strong>æŸ¥è¯¢æŒ‡å®šæ’åèŒƒå›´å†…ç”¨æˆ·</strong>ï¼š ï¼ˆä»å°åˆ°å¤§ï¼‰<code>zrange key start stop withscores </code>or ï¼ˆä»å¤§åˆ°å°ï¼‰<code>zrevrange key start stop withscores</code></li></ul><p>æ ¹æ®ä¸Šé¢ï¼Œæ‰€ä»¥ç”¨æˆ·æŒ‰scoreä»å°åˆ°å¤§æ’åºå®Œæ¯•äº†ï¼Œå¦‚æœè¿˜è¦è·å–æ’åä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š</p><ul><li><strong>æŸ¥è¯¢æŒ‡å®šç”¨æˆ·æ’å</strong> ï¼š <code>zrank key member</code> or <code>zrevrank key member</code></li></ul><p>ä¸€ä¸ªç®€å•çš„æ’è¡Œæ¦œå°±è®¾è®¡å®Œæˆäº†ã€‚</p><blockquote><p>å¦‚æœé¢è¯•å®˜è¿›ä¸€æ­¥é—®ï¼šä¸€å‘¨æ’è¡Œæ¦œæ€ä¹ˆè®¾è®¡ï¼Ÿ</p></blockquote><p>ä¸€å‘¨çš„æ•°æ®å…¶å®å°±æ˜¯7å¤©æ•°æ®çš„ç´¯åŠ ï¼Œç´¯åŠ å®Œåå†æ’åºï¼Œä¸€ä¸ªæœˆçš„æ•°æ®åŸç†ä¹Ÿæ˜¯ä¸€æ ·ã€‚å¯ä»¥ä½¿ç”¨ ï¼š</p><ul><li><p><code>ZINTERSTORE</code> ï¼š è®¡ç®—ç»™å®šä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†çš„äº¤é›†å¹¶å°†ç»“æœæ”¾åˆ°ä¸€ä¸ªæ–°çš„æœ‰åºé›†åˆdestinationä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZINTERSTORE destination numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE SUM|MIN|MAX]</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä½¿ç”¨çš„å‡½æ•°æ˜¯æ±‚å’Œã€‚</p></li></ul><p>æ‰€ä»¥å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zunionstore last_seven_days 7 20210315  20210316 20210317 20210318 20210319 20210320 20210321</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-æµ·é‡æ•°æ®é—®é¢˜">2. <strong>æµ·é‡æ•°æ®é—®é¢˜</strong></h4><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/v_JULY_v/article/details/6279498">https://blog.csdn.net/v_JULY_v/article/details/6279498</a></p></blockquote><p>åœ¨æµ·é‡æ•°æ®ä¸­ï¼Œé’ˆå¯¹top Kç±»é—®é¢˜ï¼Œé€šå¸¸æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ˜¯ï¼š</p><ul><li><p><strong>Topæ•°é—®é¢˜ï¼šå°æ ¹å †</strong></p><blockquote><p><strong>æœ‰1äº¿ä¸ªæµ®ç‚¹æ•°ï¼Œå¦‚ä½•æ‰¾å‡ºå…¶æœ€å¤§çš„10000ä¸ª</strong>ï¼Ÿ</p></blockquote><p>ç›´æ¥è¿›è¡Œæ’åºï¼Œå¤§çº¦éœ€è¦10^8*4å­—èŠ‚ = 400M ï¼Œå¦‚æœå†…å­˜å¤Ÿå¯ä»¥ç›´æ¥è¿›è¡Œæ’åºï¼›å¦‚æœå†…å­˜ä¸å¤Ÿé‡‡ç”¨ï¼š</p><ol><li><strong>æœ€å°å †æ³•</strong> ï¼šï¼ˆ1ï¼‰å…ˆè¯»å…¥10000ä¸ªæ•°æ¥åˆ›å»ºå¤§å°ä¸º10000çš„<strong>æœ€å°å †</strong>ï¼ˆå‡è®¾è¿™10000ä¸ªæ•°æ˜¯æœ€å¤§çš„10000ä¸ªï¼Œç„¶åæ¯æ¬¡å’Œè¿™10000ä¸­æœ€å°çš„æ¯”è¾ƒï¼‰ï¼ˆ2ï¼‰éå†åç»­æ•°å­—ï¼Œå’Œå †é¡¶æœ€å°æ•°å­—æ¯”è¾ƒï¼šå¦‚æœå°äºå †é¡¶æ•°å­—ï¼Œç»§ç»­ï¼›å¦‚æœå¤§äºå †é¡¶æ•°å­—ï¼Œåˆ™æ›¿æ¢å †é¡¶å¹¶é‡æ–°è°ƒæ•´ä¸ºæœ€å°å †ï¼ˆ3ï¼‰æ•´ä¸ªè¿‡ç¨‹ç›´è‡³1äº¿ä¸ªæ•°å…¨éƒ¨éå†å®Œä¸ºæ­¢</li><li><strong>åˆ†æ²»æ³•</strong>ã€‚ ï¼ˆ1ï¼‰1äº¿åˆ†ä¸º100ä»½ï¼Œæ¯ä»½100ä¸‡ä¸ªæ•°æ®ï¼Œæ‰¾åˆ°æ¯ä»½çš„<strong>æœ€å¤§çš„1ä¸‡</strong>ä¸ª ï¼ˆ2ï¼‰åœ¨å‰©ä¸‹çš„100*1ä¸‡ä¸ªæ•°æ®æ‰¾åˆ°æœ€å¤§çš„1ä¸‡ä¸ª</li><li><strong>å“ˆå¸Œæ³•</strong>ã€‚ <u>å¦‚æœè¿™1äº¿ä¸ªä¹¦é‡Œé¢æœ‰å¾ˆå¤šé‡å¤çš„æ•°</u>ï¼Œå…ˆé€šè¿‡Hashæ³•ï¼ŒæŠŠè¿™1äº¿ä¸ªæ•°å­—å»é‡å¤ã€‚ ç„¶åå†é‡‡ç”¨æ–¹æ³• 1 æˆ– 2 ã€‚</li></ol></li><li><p><strong>æœ€å¤šé‡å¤ï¼ˆé¢‘ç‡æœ€é«˜ï¼‰ï¼šHashæ˜ å°„+HashMapé¢‘ç‡è®¡ç®—</strong></p><blockquote><p><strong>ã€æœ€å¤šé‡å¤ã€‘æµ·é‡æ—¥å¿—æ•°æ®ï¼Œæå–å‡ºæŸæ—¥è®¿é—®ç™¾åº¦æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªIPã€‚</strong></p></blockquote><ul><li><strong>åˆ†æ²»æ³•ï¼ˆåŸºäºHash</strong>ï¼‰ã€‚ ï¼ˆ1ï¼‰æŒ‰ç…§IPåœ°å€çš„<code>Hash(IP)%1024</code>å€¼ï¼ŒæŠŠæµ·é‡IPæ—¥å¿—åˆ†åˆ«å­˜å‚¨åˆ°1024ä¸ªå°æ–‡ä»¶ä¸­ ï¼ˆ2ï¼‰å¯¹äºæ¯ä¸€ä¸ªå°æ–‡ä»¶ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªIPä¸ºkeyï¼Œå‡ºç°æ¬¡æ•°ä¸ºvalueçš„<strong>Hash map</strong> ï¼ˆ3ï¼‰å¯ä»¥å¾—åˆ°1024ä¸ªå°æ–‡ä»¶ä¸­çš„å‡ºç°æ¬¡æ•°æœ€å¤šçš„IP ï¼Œå†æ ¹æ®å¸¸è§„æ’åºå¾—åˆ°ã€‚</li></ul><p><u>âš ï¸ ä½¿ç”¨Hashåˆ†æ•£ipå¯ä»¥ä¿è¯ç›¸åŒipéƒ½åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹</u>ï¼Œå¦‚æœåªæ˜¯ç®€å•å‡åˆ†æ˜¯ä¸è¡Œçš„ã€‚</p><blockquote><p><strong>ã€æœ€å¤šé‡å¤ã€‘æœ‰ä¸€ä¸ª1Gå¤§å°çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªè¯ï¼Œè¯çš„å¤§å°ä¸è¶…è¿‡16å­—èŠ‚ï¼Œå†…å­˜é™åˆ¶å¤§å°æ˜¯1Mã€‚è¿”å›é¢‘æ•°æœ€é«˜çš„100ä¸ªè¯</strong>ã€‚</p></blockquote><ul><li>åŒä¸Šï¼Œ<strong>åˆ†æ²»æ³•ï¼ˆåŸºäºHash</strong>ï¼‰ã€‚ é¦–å…ˆè®¡ç®—ä¸‹ï¼š1G / 1M = 1000ä¸ªå°æ–‡ä»¶ï¼Œä¸ºä¿é™©åˆ†ä¸º2000ä¸ªï¼ˆ1ï¼‰<code>Hash(è¯)%2000</code> æ˜ å°„åˆ°2000ä¸ªæ–‡ä»¶ä¸­ï¼ˆ2ï¼‰åˆ†åˆ«è®¡ç®—2000ä¸ªæ–‡ä»¶é¢‘ç‡æœ€é«˜çš„é‚£ä¸ªå•è¯ï¼Œç„¶åå¸¸è§„æ’åºå³å¯ï¼ˆ2000ä¸ªå•è¯å ï¼š2k*16B=32KB&lt;&lt;1Mï¼‰</li></ul><blockquote><p><strong>ã€æœ€å¤šé‡å¤ã€‘æœ‰10ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶1Gï¼Œæ¯ä¸ªæ–‡ä»¶çš„æ¯ä¸€è¡Œå­˜æ”¾çš„éƒ½æ˜¯ç”¨æˆ·çš„queryï¼Œæ¯ä¸ªæ–‡ä»¶çš„queryéƒ½å¯èƒ½é‡å¤ã€‚è¦æ±‚ä½ æŒ‰ç…§queryçš„é¢‘åº¦æ’åº</strong>ã€‚</p></blockquote><ul><li>åŒä¸Šï¼Œ<strong>åˆ†æ²»æ³•ï¼ˆåŸºäºHash</strong>ï¼‰ã€‚ é¡ºåºè¯»å–10ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†queryé‡æ–°æ˜ å°„åˆ°è‹¥å¹²ä¸ªæ–‡ä»¶ä¸­ï¼Œä¿è¯ç›¸åŒqueryéƒ½åœ¨åŒä¸€ä¸ªæ–‡ä»¶ã€‚å…¶ä½™åŒä¸Šã€‚</li></ul></li><li><p><strong>ä¸é‡å¤æ•°ï¼šä½å›¾</strong></p><blockquote><p>ã€<strong>ä¸é‡å¤</strong>ã€‘ <strong>åœ¨2.5äº¿ä¸ªæ•´æ•°ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•´æ•°ã€‚æ³¨ï¼Œå†…å­˜ä¸è¶³ä»¥å®¹çº³è¿™2.5äº¿ä¸ªæ•´æ•°</strong>ã€‚</p></blockquote><ul><li><p><strong>é‡‡ç”¨2ä½å›¾ï¼ˆ<a href="https://www.cnblogs.com/54chensongxia/p/11591979.html">BitMap</a></strong>ï¼‰ã€‚00è¡¨ç¤ºä¸å­˜åœ¨ï¼Œ01è¡¨ç¤ºå‡ºç°ä¸€æ¬¡ï¼Œ10è¡¨ç¤ºå¤šæ¬¡ï¼Œ11æ— æ„ä¹‰ï¼Œéœ€è¦<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2.5</mn><mo>âˆ—</mo><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup><mi>b</mi><mo>=</mo><mn>2.5</mn><mo>âˆ—</mo><mn>0.1</mn><mi>G</mi><mi>b</mi><mo>=</mo><mn>0.25</mn><mi>G</mi><mi>b</mi><mo>=</mo><mn>25</mn><mi>M</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">2.5*10^8b = 2.5*0.1Gb=0.25Gb=25MB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0.1</span><span class="mord mathnormal">G</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0.25</span><span class="mord mathnormal">G</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">25</span><span class="mord mathnormal" style="margin-right:0.05017em;">MB</span></span></span></span>ã€‚ä½†æ˜¯æˆ‘ä»¬<strong>éœ€è¦æŠŠæ‰€æœ‰çš„æ•´æ•°éƒ½è¡¨ç¤ºå‡ºæ¥</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>âˆ—</mo><msup><mn>2</mn><mn>32</mn></msup><mi>b</mi><mi>i</mi><mi>t</mi><mo>=</mo><mn>1</mn><mi>G</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">2*2^{32}bit=1GB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">bi</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span></span></span></span>ï¼ˆ1ï¼‰æ‰«æè¿™2.5äº¿ä¸ªæ•´æ•°ï¼ŒæŸ¥çœ‹Bitmapä¸­ç›¸å¯¹åº”ä½ï¼Œå¦‚æœæ˜¯00å˜01ï¼Œ01å˜10ï¼Œ10ä¿æŒä¸å˜ï¼ˆ2ï¼‰æŸ¥çœ‹bitmapï¼Œ<u>æŠŠå¯¹åº”ä½æ˜¯<strong>01</strong></u> çš„æ•´æ•°è¾“å‡ºå³å¯ã€‚</p><p>æ³¨ï¼Œintç±»å‹å 32ä¸ªå­—èŠ‚ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>32</mn></msup></mrow><annotation encoding="application/x-tex">2^{32}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå…¶èƒ½è¡¨ç¤ºçš„æ•´æ•°ä¸ªæ•°ã€‚</p></li></ul><blockquote><p>ã€<strong>ä¸é‡å¤Â·è…¾è®¯</strong>ã€‘<strong>ç»™40äº¿ä¸ªä¸é‡å¤çš„unsigned intçš„æ•´æ•°ï¼Œæ²¡æ’è¿‡åºçš„ï¼Œç„¶åå†ç»™ä¸€ä¸ªæ•°ï¼Œå¦‚ä½•å¿«é€Ÿåˆ¤æ–­è¿™ä¸ªæ•°æ˜¯å¦åœ¨é‚£40äº¿ä¸ªæ•°å½“ä¸­</strong>ï¼Ÿ</p></blockquote><ul><li><strong>é‡‡ç”¨2ä½å›¾ï¼ˆ<a href="https://www.cnblogs.com/54chensongxia/p/11591979.html">BitMap</a></strong>ï¼‰ã€‚ éœ€è¦40äº¿bitï¼Œå¤§çº¦500Mï¼Œä½†å®é™…æ˜¯è¦è¡¨ç¤ºæ‰€æœ‰æ•´æ•°ï¼Œæ•…è¿˜æ˜¯1GBã€‚å…¶ä½™åŒä¸Šã€‚</li></ul></li><li><p><strong>å…±åŒæ•°</strong></p><blockquote><p>ã€<strong>ç›¸åŒæ•°</strong>ã€‘ ç»™å®šaã€bä¸¤ä¸ªæ–‡ä»¶ï¼Œå„å­˜æ”¾50äº¿ä¸ªurlï¼Œæ¯ä¸ªurlå„å 64å­—èŠ‚ï¼Œå†…å­˜é™åˆ¶æ˜¯4Gï¼Œè®©ä½ æ‰¾å‡ºaã€bæ–‡ä»¶å…±åŒçš„urlï¼Ÿ</p></blockquote><ul><li><strong>åˆ†æ²»æ³•ï¼ˆåŸºäºHash</strong>ï¼‰ã€‚ ï¼ˆ1ï¼‰åˆ†åˆ«å°†aï¼Œbä¸¤ä¸ªå¤§æ–‡ä»¶å„è‡ªæ˜ å°„ä¸º10000ä¸ªå°æ–‡ä»¶ï¼Œè¿™æ ·ç›¸åŒurlä¼šæ˜ å°„åˆ°a,bç›¸åŒå“ˆå¸Œå€¼å°æ–‡ä»¶ä¸­ã€‚ï¼ˆ2ï¼‰åœ¨a,bæ¯ä¸€å¯¹å°æ–‡ä»¶æ‰¾åˆ°ç›¸åŒçš„urlã€‚</li></ul></li></ul><h4 id="3-åˆ†å¸ƒå¼ç›¸å…³">3. <strong>åˆ†å¸ƒå¼ç›¸å…³</strong></h4><blockquote><p><strong>è°ˆä¸€è°ˆï¼Œåˆ†å¸ƒå¼é›†ç¾¤ä¸­å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨</strong>ï¼Ÿ</p></blockquote><ul><li><p>å¯¹äºå•ä¸€æœåŠ¡æ¥è¯´ï¼Œåªè¦ä¿è¯ä¸€å°æœºå™¨ä¸Šçš„å¯¹äºå…±äº«èµ„æºçš„è®¿é—®æ˜¯åŒæ­¥è¿›è¡Œçš„å°±èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨äº†ï¼›ä½†æ˜¯å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿè€Œå·²ï¼Œä¿è¯ä¸€å°æœåŠ¡å™¨çš„åŒæ­¥ï¼Œå¹¶ä¸èƒ½ä¿è¯è®¿é—®å…±äº«èµ„æºæ˜¯åŒæ­¥çš„ï¼›</p></li><li><p>æ‰€ä»¥å¯ä»¥è€ƒè™‘ä½¿ç”¨<strong>åˆ†å¸ƒå¼é”</strong>çš„æ–¹å¼æ¥ä¿è¯åˆ†å¸ƒå¼ä¸­çš„çº¿ç¨‹çš„å®‰å…¨çº¿ï¼Œè¿™æ ·ä¸åŒçš„æœåŠ¡ä¸åŒçš„çº¿ç¨‹é€šè¿‡ç«äº‰åˆ†å¸ƒå¼é”æ¥è·å–å…±äº«èµ„æºçš„æ“ä½œæƒé™ï¼›</p></li><li><p>ä¾‹å¦‚<u><strong>redisçš„åˆ†å¸ƒå¼é”ã€zookeeperé”</strong></u>ï¼Œéƒ½å¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼çº¿ç¨‹å®‰å…¨çš„æ‰‹æ®µã€‚</p></li></ul><blockquote><p><strong>åœ¨æ·˜å®è´­ç‰©ï¼Œè¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä½ ä¼šæ€æ ·æ¥è®¾è®¡æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Ÿ</p></blockquote><ul><li><p><a href="https://juejin.cn/post/6844903817348136968">ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</a></p><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰å¯ä»¥ç®€å•ç†è§£ä¸ºï¼š<strong>æŠŠè¦ä¼ è¾“çš„æ•°æ®æ”¾åœ¨é˜Ÿåˆ—ä¸­</strong>ï¼Œä¸€ç§å…ˆè¿›å…ˆå‡ºçš„ç»“æ„ã€‚</p></li><li><p><strong>æ€ä¹ˆå»è®¾è®¡æ·˜å®æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Ÿ</p><p>å¾…è¡¥å……ã€‚</p></li></ul><h4 id="4-å¾®ä¿¡æŠ¢çº¢åŒ…">4. <strong>å¾®ä¿¡æŠ¢çº¢åŒ…</strong></h4><blockquote><p><a href="https://www.cnblogs.com/alimayun/p/12795698.html">ä¾‹å¦‚ä¸€ä¸ªäººåœ¨ç¾¤é‡Œå‘äº†100å—é’±çš„çº¢åŒ…ï¼Œç¾¤é‡Œæœ‰10ä¸ªäººä¸€èµ·æ¥æŠ¢çº¢åŒ…ï¼Œæ¯äººæŠ¢åˆ°çš„é‡‘é¢éšæœºåˆ†é…ã€‚</a></p><ol><li><p>æ‰€æœ‰äººæŠ¢åˆ°çš„é‡‘é¢ä¹‹å’Œè¦ç­‰äºçº¢åŒ…é‡‘é¢ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ã€‚</p></li><li><p>æ¯ä¸ªäººè‡³å°‘æŠ¢åˆ°1åˆ†é’±ã€‚</p></li><li><p>è¦ä¿è¯çº¢åŒ…æ‹†åˆ†çš„é‡‘é¢å°½å¯èƒ½åˆ†å¸ƒå‡è¡¡ï¼Œä¸è¦å‡ºç°ä¸¤æåˆ†åŒ–å¤ªä¸¥é‡çš„æƒ…å†µã€‚</p></li></ol></blockquote><p><strong>äºŒå€å‡å€¼æ³•</strong>ï¼šå‡è®¾å‰©ä½™çº¢åŒ…é‡‘é¢ä¸ºmå…ƒï¼Œå‰©ä½™äººæ•°ä¸ºnï¼Œé‚£ä¹ˆæœ‰å¦‚ä¸‹å…¬å¼ï¼š</p><ul><li><p><strong>æ¯æ¬¡æŠ¢åˆ°çš„é‡‘é¢ =  [0.01ï¼Œm /n Ã— 2 - 0.01]</strong></p></li><li><p>è¿™ä¸ªå…¬å¼ï¼Œä¿è¯äº†æ¯æ¬¡éšæœºé‡‘é¢çš„å¹³å‡å€¼æ˜¯ç›¸ç­‰çš„ï¼Œä¸ä¼šå› ä¸ºæŠ¢çº¢åŒ…çš„å…ˆåé¡ºåºè€Œé€ æˆä¸å…¬å¹³ã€‚</p></li></ul><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><ul><li>å‡è®¾æœ‰5ä¸ªäººï¼Œçº¢åŒ…æ€»é¢100å…ƒã€‚100Ã·5Ã—2 = 40ï¼Œæ‰€ä»¥ç¬¬1ä¸ªäººæŠ¢åˆ°çš„é‡‘é¢éšæœºèŒƒå›´æ˜¯[0.01ï¼Œ39.99]å…ƒï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¹³å‡å¯ä»¥æŠ¢åˆ°20å…ƒã€‚å‡è®¾ç¬¬1ä¸ªäººéšæœºæŠ¢åˆ°äº†20å…ƒï¼Œé‚£ä¹ˆå‰©ä½™é‡‘é¢æ˜¯80å…ƒã€‚80Ã·4Ã—2 = 40ï¼Œæ‰€ä»¥ç¬¬2ä¸ªäººæŠ¢åˆ°çš„é‡‘é¢çš„éšæœºèŒƒå›´åŒæ ·æ˜¯[0.01ï¼Œ39.99]å…ƒï¼Œåœ¨æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å¹³å‡å¯ä»¥æŠ¢åˆ°20å…ƒã€‚å‡è®¾ç¬¬2ä¸ªäººéšæœºæŠ¢åˆ°äº†20å…ƒï¼Œé‚£ä¹ˆå‰©ä½™é‡‘é¢æ˜¯60å…ƒã€‚60Ã·3Ã—2 = 40ï¼Œæ‰€ä»¥ç¬¬3ä¸ªäººæŠ¢åˆ°çš„é‡‘é¢çš„éšæœºèŒƒå›´åŒæ ·æ˜¯[0.01ï¼Œ39.99]å…ƒï¼Œå¹³å‡å¯ä»¥æŠ¢åˆ°20å…ƒã€‚ä»¥æ­¤ç±»æ¨ï¼Œæ¯ä¸€æ¬¡æŠ¢åˆ°é‡‘é¢éšæœºèŒƒå›´çš„å‡å€¼æ˜¯ç›¸ç­‰çš„ã€‚</li></ul><h2 id="8-2-æ™ºåŠ›é¢˜">8.2 æ™ºåŠ›é¢˜</h2><h4 id="1-å‰å®³äº†æˆ‘çš„æ¯">1. <strong>å‰å®³äº†æˆ‘çš„æ¯</strong></h4><blockquote><p>æœ‰ä¸€ç§ç»ç’ƒæ¯è´¨é‡ç¡®å®šä½†æœªçŸ¥ï¼Œéœ€è¦æ£€æµ‹ã€‚ æœ‰ä¸€æ ‹100å±‚çš„å¤§æ¥¼ï¼Œè¯¥ç§ç»ç’ƒæ¯ä»æŸä¸€å±‚æ¥¼æ‰”ä¸‹ï¼Œåˆšå¥½ä¼šç¢ã€‚ ç°ç»™ä½ ä¸¤ä¸ªæ¯å­ï¼Œé—®æ€æ ·æ£€æµ‹å‡ºè¿™ä¸ªæ¯å­çš„è´¨é‡ï¼Œå³æ‰¾åˆ°åœ¨å“ªä¸€å±‚æ¥¼åˆšå¥½ä¼šç¢ï¼Ÿ</p></blockquote><p>å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1497944">https://cloud.tencent.com/developer/article/1497944</a></p><h4 id="2-èµ›é©¬é—®é¢˜">2. <strong>èµ›é©¬é—®é¢˜</strong></h4><blockquote><p>64åŒ¹é©¬ï¼Œ8ä¸ªè·‘é“ï¼Œé—®æœ€å°‘æ¯”èµ›å¤šå°‘åœºï¼Œå¯ä»¥é€‰å‡ºè·‘å¾—æœ€å¿«çš„4åŒ¹é©¬ã€‚</p><ul><li>Assumptionsï¼šæ¯åœºæ¯”èµ›æ¯ä¸ªè·‘é“åªå…è®¸ä¸€åŒ¹é©¬ï¼Œä¸”ä¸å­˜åœ¨å¹¶åˆ—æƒ…å½¢ã€‚</li></ul></blockquote><h4 id="3-ä¸‰äººä¸‰é¬¼è¿‡æ¡¥">3. ä¸‰äººä¸‰é¬¼è¿‡æ¡¥</h4><blockquote><p>æœ‰ä¸‰ä¸ªäººè·Ÿä¸‰ä¸ªé¬¼è¦è¿‡æ²³,æ²³ä¸Šæ²¡æ¡¥åªæœ‰æ¡å°èˆ¹,ç„¶åèˆ¹ä¸€æ¬¡åªèƒ½æ¸¡ä¸€ä¸ªäººå’Œä¸€ä¸ªé¬¼,æˆ–è€…ä¸¤ä¸ªé¬¼æˆ–è€…ä¸¤ä¸ªäºº,æ— è®ºåœ¨å“ªè¾¹å²¸ä¸Š,åªæœ‰æ˜¯äººæ¯”é¬¼å°‘çš„æƒ…å†µä¸‹(å¦‚ä¸¤é¬¼ä¸€äºº,ä¸‰é¬¼ä¸¤äºº,ä¸‰é¬¼ä¸€äºº)äººä¼šè¢«é¬¼åƒ,ç„¶è€Œèˆ¹åˆä¸€å®šéœ€è¦äººæˆ–é¬¼æ“ä½œæ‰èƒ½èˆªè¡Œ(è¦æœ‰äººæˆ–é¬¼åˆ’èˆ¹),é—®,å¦‚ä½•å®‰å…¨çš„æŠŠä¸‰äººä¸‰é¬¼æ¸¡è¿‡æ²³å¯¹å²¸?</p></blockquote><p>å‚è€ƒå›ç­”</p><ul><li>å…ˆä¸¤é¬¼è¿‡å»ã€‚åœ¨ä¸€é¬¼å›æ¥ã€‚å¯¹é¢æœ‰ä¸€é¬¼ã€‚è¿™è¾¹æœ‰ä¸‰äººä¸¤é¬¼ã€‚</li><li>å†ä¸¤é¬¼è¿‡å»ã€‚åœ¨ä¸€é¬¼å›æ¥ã€‚å¯¹é¢æœ‰ä¸¤é¬¼ã€‚è¿™è¾¹æœ‰ä¸‰äººä¸€é¬¼ã€‚</li><li>å†ä¸¤äººè¿‡å»ã€‚ä¸€äººä¸€é¬¼å›æ¥ã€‚å¯¹é¢ä¸€äººä¸€é¬¼ã€‚è¿™è¾¹ä¸¤äººä¸¤é¬¼ã€‚</li><li>æœ€åä¸¤äººè¿‡å»ã€‚ä¸€é¬¼å›æ¥ã€‚å¯¹é¢ä¸‰äººã€‚è¿™è¾¹ä¸‰é¬¼ã€‚</li><li>å‰©ä¸‹çš„å°±ä¸‰ä¸ªé¬¼äºŒä¸ªè¿‡å»ä¸€ä¸ªå›æ¥åœ¨æ¥å¦å¤–ä¸ªå°±OKäº†ã€‚</li></ul><h4 id="3-ç»™å®šéšæœºå‡½æ•°ï¼Œç”Ÿæˆåˆ«çš„éšæœºæ•°">3. ç»™å®šéšæœºå‡½æ•°ï¼Œç”Ÿæˆåˆ«çš„éšæœºæ•°</h4><blockquote><p>ç»™å®šç”Ÿæˆ1åˆ°5çš„éšæœºæ•°Rand5()ï¼Œå¦‚ä½•å¾—åˆ°ç”Ÿæˆ1åˆ°7çš„éšæœºæ•°å‡½æ•°Rand7()ï¼Ÿ</p></blockquote><p>ç”±å¤§çš„ç”Ÿæˆå°çš„å®¹æ˜“ï¼Œæ¯”å¦‚ç”±Rand7()ç”ŸæˆRand5()ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªå¤§äº7çš„éšæœºæ•°ç”Ÿæˆå‡½æ•°ã€‚ è®°ä½ä¸‹é¢è¿™ä¸ªå¼å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆ1åˆ°N^2ä¹‹é—´çš„éšæœºæ•°,å¯ä»¥çœ‹ä½œæ˜¯åœ¨æ•°è½´ä¸Šæ’’è±†å­ã€‚Næ˜¯è·¨åº¦/æ­¥é•¿ï¼Œæ˜¯RandN()ç”Ÿæˆçš„æ•°çš„èŒƒå›´é•¿åº¦</span></span><br><span class="line"><span class="comment">// RandN()-1çš„ç›®çš„æ˜¯ç”Ÿæˆ0åˆ°N-1çš„æ•°ï¼Œæ˜¯è·³æ•°ã€‚åé¢+RandN()çš„ç›®çš„æ˜¯å¡«æ»¡ä¸­é—´çš„ç©ºéš™Copy to clipboardErrorCopied</span></span><br><span class="line"></span><br><span class="line">RandNN= N( RandN()<span class="number">-1</span> ) + RandN() ;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚<code>Rand25= 5( Rand5()-1 ) + Rand5()</code>å¯ä»¥ç”Ÿæˆ1åˆ°25ä¹‹é—´çš„éšæœºæ•°ã€‚æˆ‘ä»¬å¯ä»¥åªè¦1åˆ°21ï¼ˆ3*7ï¼‰ä¹‹é—´çš„æ•°å­—ï¼Œæ‰€ä»¥å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rand7</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x=INT_MAX;</span><br><span class="line">  <span class="keyword">while</span>(x&gt;<span class="number">21</span>)&#123;</span><br><span class="line">    x=<span class="number">5</span>*(<span class="built_in">rand5</span>()<span class="number">-1</span>)+<span class="built_in">rand5</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> x%<span class="number">7</span>+<span class="number">1</span>;</span><br><span class="line">&#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure><h4 id="4-ç ç ç§°è½»é‡ï¼Œæ‰¾å‡ºæœ€è½»çš„">4. ç ç ç§°è½»é‡ï¼Œæ‰¾å‡ºæœ€è½»çš„</h4><p>å…¶å®è¿™éƒ½æ˜¯ä¸€ç±»é¢˜ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªç»å…¸çš„ï¼š</p><blockquote><p>1ã€æœ‰ä¸€ä¸ªå¤©å¹³ï¼Œä¹ä¸ªç ç ï¼Œå…¶ä¸­ä¸€ä¸ªç ç æ¯”å¦å…«ä¸ªè¦è½»ä¸€äº›ï¼Œé—®è‡³å°‘è¦ç”¨å¤©å¹³ç§°å‡ æ¬¡æ‰èƒ½å°†è½»çš„é‚£ä¸ªæ‰¾å‡ºæ¥ï¼Ÿ</p></blockquote><p>å‚è€ƒå›ç­”ï¼šè‡³å°‘2æ¬¡ã€‚ç¬¬ä¸€æ¬¡ï¼Œä¸€è¾¹3ä¸ªï¼Œå“ªè¾¹è½»å°±åœ¨å“ªè¾¹ï¼Œä¸€æ ·é‡å°±æ˜¯å‰©ä½™çš„3ä¸ªï¼› ç¬¬äºŒæ¬¡ï¼Œä¸€è¾¹1ä¸ªï¼Œå“ªè¾¹è½»å°±æ˜¯å“ªä¸ªï¼Œä¸€æ ·é‡å°±æ˜¯å‰©ä½™çš„é‚£ä¸ªï¼›è‡³å°‘ç§°2æ¬¡ï¼</p><blockquote><p>2ã€åç»„ç ç æ¯ç»„åä¸ªï¼Œæ¯ä¸ªç ç éƒ½æ˜¯10gé‡ï¼Œä½†æ˜¯ç°åœ¨å…¶ä¸­æœ‰ä¸€ç»„ç ç æ¯ä¸ªéƒ½åªæœ‰9gé‡ï¼Œç°æœ‰ä¸€ä¸ªèƒ½æ˜¾ç¤ºå…‹æ•°çš„ç§¤ï¼Œæœ€å°‘ç§°å‡ æ¬¡èƒ½æ‰¾åˆ°è½»çš„é‚£ç»„ï¼Ÿ</p></blockquote><p>å‚è€ƒå›ç­”ï¼šè‡³å°‘1æ¬¡ã€‚</p><p>å°†ç ç åˆ†ç»„1~10ï¼Œç¬¬ä¸€ç»„æ‹¿ä¸€ä¸ªï¼Œç¬¬äºŒç»„æ‹¿ä¸¤ä¸ªä»¥æ­¤ç±»æ¨ã€‚ã€‚ç¬¬åç»„æ‹¿åä¸ªæ”¾åˆ°ç§¤ä¸Šç§°å‡ºå…‹æ•°xï¼Œåˆ™y = 550 - xï¼Œç¬¬yç»„å°±æ˜¯è½»çš„é‚£ç»„ã€‚</p><h4 id="5-åˆ©ç”¨ç©ºç“¶æ¢é¥®æ–™ï¼Œæœ€å¤šå–å‡ ç“¶">5. åˆ©ç”¨ç©ºç“¶æ¢é¥®æ–™ï¼Œæœ€å¤šå–å‡ ç“¶</h4><blockquote><p>1000ç“¶é¥®æ–™ï¼Œ3ä¸ªç©ºç“¶å­èƒ½å¤Ÿæ¢1ç“¶é¥®æ–™ï¼Œé—®æœ€å¤šèƒ½å–å‡ ç“¶ï¼Ÿ</p></blockquote><p><strong>ç¬¬ä¸€ç§æ€è·¯</strong></p><p>æ‹¿èµ°3ç“¶ï¼Œæ¢å›1ç“¶ï¼Œç›¸å½“äºå‡å°‘2ç“¶ã€‚</p><p>ä½†æ˜¯æœ€åå‰©ä¸‹4ç“¶çš„æ—¶å€™ä¾‹å¤–ï¼Œè¿™æ—¶åªèƒ½æ¢1ç“¶ã€‚æ‰€ä»¥æˆ‘ä»¬è®¡ç®—1000å‡2èƒ½å‡å¤šå°‘æ¬¡ï¼Œç›´åˆ°å‰©ä¸‹4.ï¼ˆ1000-4=996ï¼Œ996/2=498ï¼‰æ‰€ä»¥1000å‡2èƒ½å‡498æ¬¡ç›´åˆ°å‰©ä¸‹4ç“¶ï¼Œæœ€åå‰©ä¸‹çš„4ç“¶è¿˜å¯ä»¥æ¢ä¸€ç“¶ï¼Œæ‰€ä»¥æ€»å…±æ˜¯1000+498+1=1499ç“¶ã€‚</p><p><strong>ç¬¬äºŒç§æ€è·¯</strong></p><ul><li><p>1000ç“¶é¥®æ–™ï¼Œ3ä¸ªç©ºç“¶å­èƒ½æ¢1ç“¶é¥®æ–™ï¼Œæœ€å¤šå¯ä»¥å–å‡ ç“¶ï¼Ÿ</p></li><li><p>ç¬¬ä¸€ç§æ€ç»´ï¼šå¯ä»¥è€ƒè™‘æˆdpæ€è·¯</p><ul><li><p>åˆå§‹æƒ…å†µï¼Œ3ä¸ªç“¶å­æ—¶å°†å‘ç”Ÿä¸€æ¬¡äº¤æ¢ï¼Œå› æ­¤è§†ä¸ºç‰¹æ®Šæƒ…å†µ</p></li><li><p>ä¹‹åæ¯å¢åŠ ä¸¤ä¸ªç“¶å­åˆå¯ä»¥å†æ¢ä¸€ç“¶</p></li><li><p>å³dp[i] = dp[i - 2] + (i - (i - 2)) + 1</p></li><li><ul><li>ç”±dp[i - 2]å¯æ±‚å¾—dp[i]</li><li>(i - (i - 2))ï¼Œå³ä¸ºå½“å‰å¢åŠ çš„2ç“¶é¥®æ–™ï¼ˆå†™æˆè¿™æ ·ä¾¿äºç†è§£ï¼‰</li><li>1å³ä¸ºå¢åŠ äº†2ä¸ªç©ºç“¶ï¼Œä¹‹ååˆå¯ä»¥æ¢ä¸€ç“¶é¥®æ–™</li></ul></li><li><p>ç®€åŒ–ä¸ºdp[i] = dp[i - 2] + 2 + 1</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">method</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// nä¸º0/1/2çš„ç‰¹æ®Šæƒ…å†µçœç•¥äº†</span></span><br><span class="line">    <span class="comment">// å®šä¹‰dpæ•°ç»„</span></span><br><span class="line">    <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// åˆå§‹çŠ¶æ€</span></span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">      dp[i] = dp[i - <span class="number">2</span>] + <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n];</span><br><span class="line"> &#125;Copy to clipboardErrorCopied</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å›å½’æ­£é¢˜</p><ul><li>ç‰¹æ®Šæƒ…å†µï¼šä»ä¸Šé¢çš„åˆ†æä¸­ï¼Œç•™ä¸‹2ä¸ªç“¶å­</li><li>å‰©ä¸‹998ä¸ªç“¶å­ç›¸å½“äºæ¯æ¶ˆè€—2ä¸ªç“¶å­å³å¯è·å¾—ä¸€ç“¶ï¼Œå³ä¸º499ç“¶</li><li>æœ€åå‰©ä¸‹çš„2ä¸ªç“¶å­æ— æ³•å†è¿›è¡Œå…‘æ¢ï¼Œå› æ­¤æ€»å…±ä¸º1000 + 499 = 1499</li></ul></li><li><p>ç¬¬äºŒç§æ€ç»´</p><ul><li>å› ä¸ºå…‘æ¢ä¸€ç“¶é¥®æ–™éœ€è¦ä¸‰ä¸ªç©ºç“¶ï¼Œè¿™ç“¶é¥®æ–™å¦‚æœæ˜¯æ‰¾è€æ¿å€Ÿæ¥çš„ï¼Œé‚£ä¹ˆå–å®Œåè¿™ä¸ªç©ºç“¶å°†ä¼šè¿˜ç»™ä»–ï¼ŒåŒæ—¶éœ€è¦é™„èµ ç»™ä»–å¦å¤–ä¸¤ä¸ªç©ºç“¶ï¼Œå³æ¯æ¶ˆè€—æ‰‹é‡Œä¸¤ä¸ªç©ºç“¶å°±è·å¾—ä¸€ç“¶é¥®æ–™</li><li>ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢åªæ˜¯ä¸€ç§å‡è®¾ï¼Œå®é™…æƒ…å†µè€æ¿æ˜¯ä¸ä¼šå€Ÿç»™ä½ çš„ï¼Œå› æ­¤æˆ‘ä»¬è‡³å°‘éœ€è¦ä¿ç•™2ä¸ªç©ºç“¶ï¼Œè¿™æ ·å¯ä»¥åœ¨998ä¸ªç“¶å­å‰©ä¸‹ä¸€ä¸ªç“¶å­æ—¶ï¼Œå¯¹å…¶è¿›è¡Œè¡¥è¶³ä¸º3ä¸ªç©ºç“¶ï¼Œä»è€Œå…‘æ¢ä¸€ç“¶æ–°é¥®æ–™</li><li>æ­¤æ—¶ä½¿ç”¨998ä¸ªç“¶å­è¿›è¡Œä¸Šè¿°çš„å…‘æ¢ï¼Œå°†è·å¾—499ç“¶é¥®æ–™</li><li>ä¹‹å‰ç•™ä¸‹çš„ä¸¤ä¸ªç“¶å­æ­£å¥½æ— æ³•å…‘æ¢ï¼Œæœ€ç»ˆè·å¾—é¥®æ–™ä¸º1000 + 499 = 1499ç“¶</li></ul></li></ul><h4 id="6-æ¯’è¯æ¯’ç™½é¼ ï¼Œæ‰¾å‡ºå“ªä¸ªç“¶å­ä¸­æ˜¯æ¯’è¯">6. æ¯’è¯æ¯’ç™½é¼ ï¼Œæ‰¾å‡ºå“ªä¸ªç“¶å­ä¸­æ˜¯æ¯’è¯</h4><blockquote><p>æœ‰1000ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç“¶å­ï¼Œå…¶ä¸­æœ‰999ç“¶æ˜¯æ™®é€šçš„æ°´ï¼Œæœ‰1ç“¶æ˜¯æ¯’è¯ã€‚ä»»ä½•å–ä¸‹æ¯’è¯çš„ç”Ÿå‘½éƒ½ä¼šåœ¨ä¸€æ˜ŸæœŸä¹‹åæ­»äº¡ã€‚ç°åœ¨ä½ åªæœ‰10åªå°ç™½é¼ å’Œ1ä¸ªæ˜ŸæœŸçš„æ—¶é—´ï¼Œå¦‚ä½•æ£€éªŒå‡ºå“ªä¸ªç“¶å­æœ‰æ¯’è¯ï¼Ÿ</p></blockquote><p>å‚è€ƒå›ç­”</p><ol><li><p>å°†10åªè€é¼ å‰æˆé¦…å„¿ï¼Œåˆ†åˆ°1000ä¸ªç“¶ç›–ä¸­ï¼Œæ¯ä¸ªç“¶ç›–å€’å…¥é€‚é‡ç›¸åº”ç“¶å­çš„æ¶²ä½“ï¼Œç½®äºæˆ·å¤–ï¼Œå¹¶æ¯å¤©è¡¥å……é€‚é‡ç›¸åº”çš„æ¶²ä½“ï¼Œè§‚å¯Ÿä¸€å‘¨ï¼Œçœ‹å“ªä¸ªç“¶ç›–ä¸­çš„è‚‰é¦…æ²¡æœ‰è…çƒ‚æˆ–ç”Ÿè›†ã€‚ï¼ˆä½ è¦æ˜¯èƒ†å­å¤Ÿå¤§å°±å¯ä»¥è¿™ä¹ˆå›ç­”ï¼Œæ˜¯ä¸ªç‹¼äººï¼‰</p></li><li><p>é¦–å…ˆä¸€å…±æœ‰1000ç“¶ï¼Œ2çš„10æ¬¡æ–¹æ˜¯1024ï¼Œåˆšå¥½å¤§äº1000ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ1000ç“¶è¯å“å¯ä»¥ä½¿ç”¨10ä½äºŒè¿›åˆ¶æ•°å°±å¯ä»¥è¡¨ç¤ºã€‚ä»ç¬¬ä¸€ä¸ªå¼€å§‹ï¼š</p><p>ç¬¬ä¸€ç“¶ ï¼š 00 0000 0001</p><p>ç¬¬äºŒç“¶ï¼š 00 0000 0010</p><p>ç¬¬ä¸‰ç“¶ï¼š 00 0000 0011</p><p>â€¦â€¦</p><p>ç¬¬999ç“¶ï¼š 11 1111 0010</p><p>ç¬¬1000ç“¶ï¼š 11 1111 0011</p><p>éœ€è¦ååªè€é¼ ï¼Œå¦‚æœæŒ‰é¡ºåºç¼–å·ï¼ŒABCDEFGHIJåˆ†åˆ«ä»£è¡¨ä»ä½ä½åˆ°é«˜ä½æ¯ä¸€ä¸ªä½ã€‚ æ¯åªè€é¼ å¯¹åº”ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼Œå¦‚æœè¯¥ä½ä¸Šçš„æ•°å­—ä¸º1ï¼Œåˆ™ç»™è€é¼ å–ç“¶é‡Œçš„è¯ã€‚</p><p>è§‚å¯Ÿï¼Œè‹¥æ­»äº¡çš„è€é¼ ç¼–å·ä¸ºï¼šACFGJï¼Œä¸€å…±æ­»å»äº”åªè€é¼ ï¼Œåˆ™å¯¹åº”çš„ç¼–å·ä¸º 10 0110 0101ï¼Œåˆ™æœ‰æ¯’çš„è¯å“ä¸ºè¯¥ç¼–å·çš„è¯å“ï¼Œè½¬ä¸ºåè¿›åˆ¶æ•°ä¸ºï¼š613å·ã€‚ï¼ˆè¿™æ‰æ˜¯æ­£è§£ï¼Œå½“ç„¶å‰ææ˜¯è€é¼ è¿˜æ²¡è¢«æ’‘æ­»ï¼‰</p></li></ol><blockquote><p>ç±»ä¼¼é—®é¢˜ï¼š8ç“¶é…’ä¸€ç“¶æœ‰æ¯’ï¼Œç”¨å°è€é¼ æµ‹è¯•ã€‚æ¯æ¬¡æµ‹è¯•ç»“æœ8å°æ—¶åæ‰ä¼šå¾—å‡ºï¼Œè€Œä½ åªæœ‰8ä¸ªå°æ—¶çš„æ—¶é—´ã€‚æœ€å°‘éœ€è¦ï¼ˆ ï¼‰è€é¼ æµ‹è¯•ï¼Ÿ</p><ul><li>A ã€2  Bã€3  Cã€4  Dã€6</li></ul></blockquote><p>è§£æï¼šç”¨3ä½2è¿›åˆ¶ä»£è¡¨8ç“¶é…’ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤º</p><p>ç“¶åºå· äºŒè¿›åˆ¶ ä¸­æ¯’æƒ…å†µ</p><p>ç¬¬ä¸€ç“¶ 000 å…¨æ²¡ä¸­æ¯’</p><p>ç¬¬äºŒç“¶ 001 åªæœ‰ç¬¬ä¸€ä¸ªè€é¼ ä¸­æ¯’</p><p>ç¬¬ä¸‰ç“¶ 010 åªæœ‰ç¬¬äºŒä¸ªè€é¼ ä¸­æ¯’</p><p>ç¬¬å››ç“¶ 011 ç¬¬ä¸€ä¸ªè€é¼ ã€ç¬¬ä¸‰ä¸ªè€é¼ åŒæ—¶ä¸­æ¯’</p><p>ç¬¬äº”ç“¶ 100 åªæœ‰ç¬¬ä¸‰ä¸ªè€é¼ ä¸­æ¯’</p><p>ç¬¬å…­ç“¶ 101 ç¬¬ä¸€ä¸ªè€é¼ ã€ç¬¬ä¸‰ä¸ªè€é¼ åŒæ—¶ä¸­æ¯’</p><p>ç¬¬ä¸ƒç“¶ 110 ç¬¬äºŒä¸ªè€é¼ ã€ç¬¬ä¸‰ä¸ªè€é¼ åŒæ—¶ä¸­æ¯’</p><p>ç¬¬å…«ç“¶ 111 ä¸‰ä¸ªè€é¼ åŒæ—¶ä¸­æ¯’</p><p>å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªè€é¼ å–ä¸‹æœ€ä½ä½ä¸º1å¯¹åº”çš„é…’ï¼Œç¬¬äºŒä¸ªè€é¼ å–ä¸‹ä¸­é—´ä½ä¸º1å¯¹åº”çš„é…’ï¼Œç¬¬ä¸‰ä¸ªè€é¼ å–ä¸‹æœ€é«˜ä½ä¸º1å¯¹åº”çš„é…’ã€‚</p><p>æœ€åå°†æ‰€æœ‰ä¸­æ¯’çš„è€é¼ ï¼Œå¯¹åº”çš„ä½æ¬¡è¿›è¡Œä¸æ“ä½œå³å¯ä»¥çŸ¥é“é‚£ç“¶æ¯’è¯æœ‰æ¯’äº†ã€‚</p><h4 id="7-åˆ©ç”¨çƒ§ç»³å­è®¡ç®—æ—¶é—´">7. åˆ©ç”¨çƒ§ç»³å­è®¡ç®—æ—¶é—´</h4><blockquote><p>ç°æœ‰è‹¥å¹²ä¸å‡åŒ€çš„ç»³å­ï¼Œçƒ§å®Œè¿™æ ¹ç»³å­éœ€è¦ä¸€ä¸ªå°æ—¶ï¼Œé—®å¦‚ä½•å‡†ç¡®è®¡æ—¶15åˆ†é’Ÿï¼Œ30åˆ†é’Ÿï¼Œ45åˆ†é’Ÿï¼Œ75åˆ†é’Ÿã€‚ã€‚ã€‚</p></blockquote><ul><li><p>è®¡ç®—15åˆ†é’Ÿï¼šå¯¹æŠ˜ä¹‹åä¸¤å¤´çƒ§(è¦æ±‚å¯¹æŠ˜ä¹‹åç»‘çš„å¤Ÿç´§ï¼Œå¦åˆ™çœ‹45åˆ†é’Ÿè§£æ³•)</p></li><li><p>è®¡ç®—30åˆ†é’Ÿï¼šä¸¤å¤´çƒ§</p></li><li><p>è®¡ç®—45åˆ†é’Ÿï¼šä¸¤æ ¹ï¼Œä¸€æ ¹ä¸¤å¤´çƒ§ä¸€æ ¹ä¸€å¤´çƒ§ï¼Œä¸¤å¤´çƒ§å®Œè¿‡äº†30åˆ†é’Ÿï¼Œç«‹å³å°†ç¬¬äºŒæ ¹å¦ä¸€å¤´ç‚¹ç‡ƒï¼Œåˆ°çƒ§å®Œåˆè¿‡15åˆ†é’Ÿï¼ŒåŠ èµ·æ¥45åˆ†é’Ÿ</p></li><li><p>è®¡ç®—75åˆ†é’Ÿï¼šå°†30å’Œ45åˆ†é’Ÿçš„æ–¹å¼åŠ èµ·æ¥å°±å¯ä»¥äº†</p></li></ul><p>å…¶ä½™ç±»ä¼¼</p><h4 id="8-åœ¨24å°æ—¶é‡Œé¢æ—¶é’ˆåˆ†é’ˆç§’é’ˆå¯ä»¥é‡åˆå‡ æ¬¡">8. åœ¨24å°æ—¶é‡Œé¢æ—¶é’ˆåˆ†é’ˆç§’é’ˆå¯ä»¥é‡åˆå‡ æ¬¡</h4><p>24å°æ—¶ä¸­æ—¶é’ˆèµ°2åœˆï¼Œè€Œåˆ†é’ˆèµ°24åœˆï¼Œæ—¶é’ˆå’Œåˆ†é’ˆé‡åˆ24-2=22æ¬¡ï¼Œè€Œåªè¦æ—¶é’ˆå’Œåˆ†é’ˆé‡åˆï¼Œç§’é’ˆä¸€å®šæœ‰æœºä¼šé‡åˆï¼Œæ‰€ä»¥æ€»å…±é‡åˆ22æ¬¡ã€‚</p><h4 id="9-100ä¸ªå¥´éš¶çŒœå¸½å­é¢œè‰²">9. 100ä¸ªå¥´éš¶çŒœå¸½å­é¢œè‰²</h4><blockquote><p>ä¸€ç™¾ä¸ªå¥´éš¶ç«™æˆä¸€çºµåˆ—ï¼Œæ¯äººå¤´ä¸Šéšæœºå¸¦ä¸Šé»‘è‰²æˆ–ç™½è‰²çš„å¸½å­ï¼Œå„äººä¸çŸ¥é“è‡ªå·±å¸½å­çš„é¢œè‰²ï¼Œä½†æ˜¯èƒ½çœ‹è§è‡ªå·±å‰é¢æ‰€æœ‰äººå¸½å­çš„é¢œè‰²ï¼ ç„¶åä»æœ€åä¸€ä¸ªå¥´éš¶å¼€å§‹ï¼Œæ¯äººåªèƒ½ç”¨åŒä¸€ç§å£°è°ƒå’ŒéŸ³é‡è¯´ä¸€ä¸ªå­—ï¼šâ€é»‘â€æˆ–â€ç™½â€ï¼Œ å¦‚æœè¯´ä¸­äº†è‡ªå·±å¸½å­çš„é¢œè‰²ï¼Œå°±å­˜æ´»ï¼Œè¯´é”™äº†å°±æ‹‰å‡ºå»æ–©äº†ï¼Œè¯´çš„å‚è€ƒå›ç­”æ‰€æœ‰å¥´éš¶éƒ½èƒ½å¬è§ã€‚ æ˜¯å¦è¯´å¯¹ï¼Œå…¶ä»–å¥´éš¶ä¸çŸ¥é“ã€‚</p><p>åœ¨è¿™ä¹‹å‰ï¼Œæ‰€æœ‰å¥´éš¶å¯ä»¥èšåœ¨ä¸€èµ·å•†é‡ç­–ç•¥ï¼Œé—®å¦‚æœå¥´éš¶éƒ½è¶³å¤Ÿèªæ˜è€Œä¸”ååº”è¶³å¤Ÿå¿«ï¼Œ100ä¸ªäººæœ€å¤§å­˜æ´»ç‡æ˜¯å¤šå°‘ï¼Ÿ</p></blockquote><p>å‚è€ƒå›ç­”ï¼šè¿™æ˜¯ä¸€é“ç»å…¸æ¨ç†é¢˜</p><ol><li><p>æœ€åä¸€ä¸ªäººå¦‚æœçœ‹åˆ°å¥‡æ•°é¡¶é»‘å¸½å­æŠ¥â€œé»‘â€å¦åˆ™æŠ¥â€œç™½â€ï¼Œä»–å¯èƒ½æ­»</p></li><li><p>å…¶ä»–äººè®°ä½è¿™ä¸ªå€¼ï¼ˆå®é™…æ˜¯é»‘å¸½å¥‡å¶æ•°ï¼‰ï¼Œåœ¨æ­¤ä¹‹åå½“å†å¬åˆ°é»‘æ—¶ï¼Œé»‘å¸½æ•°é‡å‡ä¸€</p></li><li><p>ä»å€’æ•°ç¬¬äºŒäººå¼€å§‹ï¼Œå°±æœ‰ä¸¤ä¸ªä¿¡æ¯ï¼šè®°ä½çš„å€¼ä¸çœ‹åˆ°çš„å€¼ï¼Œç›¸åŒæŠ¥â€œç™½â€ï¼Œä¸åŒæŠ¥â€œé»‘â€</p></li></ol><p>99äººèƒ½100%å­˜æ´»ï¼Œ1äºº50%èƒ½æ´»</p><blockquote><p>å˜ç§ï¼šæ¯ä¸ªå¥´éš¶åªèƒ½çœ‹è§å‰é¢ä¸€ä¸ªäººå¸½å­é¢œè‰²åˆèƒ½æœ€å¤šå­˜æ´»å¤šå°‘äººï¼Ÿ</p></blockquote><p>å¢åŠ é™åˆ¶æ¡ä»¶åï¼Œä¸Šé¢çš„æ–¹æ³•å°±å¤±æ•ˆäº†ï¼Œæ­¤æ—¶åªèƒ½çº¦å®šå¶æ•°ä½å¥´éš¶è¯´ä»–å‰ä¸€ä¸ªäººçš„å¸½å­é¢œè‰²ï¼Œå¥‡æ•°å¥´éš¶è·å–ä¿¡æ¯100%å­˜æ´»ï¼Œå¶æ•°å¥´éš¶50å‡ ç‡å­˜æ´»ã€‚</p><h4 id="10-å°çŒ´å­æ¬é¦™è•‰">10. å°çŒ´å­æ¬é¦™è•‰</h4><blockquote><p>ä¸€ä¸ªå°çŒ´å­è¾¹ä¸Šæœ‰100æ ¹é¦™è•‰ï¼Œå®ƒè¦èµ°è¿‡50ç±³æ‰èƒ½åˆ°å®¶ï¼Œæ¯æ¬¡å®ƒæœ€å¤šæ¬50æ ¹é¦™è•‰ï¼Œï¼ˆå¤šäº†å°±è¢«å‹æ­»äº†ï¼‰ï¼Œå®ƒæ¯èµ° 1ç±³å°±è¦åƒæ‰ä¸€æ ¹ï¼Œè¯·é—®å®ƒæœ€å¤šèƒ½æŠŠå¤šå°‘æ ¹é¦™è•‰æ¬åˆ°å®¶é‡Œï¼Ÿ</p><p>ï¼ˆæç¤ºï¼šä»–å¯ä»¥æŠŠé¦™è•‰æ”¾ä¸‹å¾€è¿”çš„èµ°ï¼Œä½†æ˜¯å¿…é¡»ä¿è¯å®ƒæ¯èµ°ä¸€ç±³éƒ½èƒ½æœ‰é¦™è•‰åƒã€‚ä¹Ÿå¯ä»¥èµ°åˆ°nç±³æ—¶ï¼Œæ”¾ä¸‹ä¸€äº›é¦™è•‰ï¼Œæ‹¿ç€næ ¹é¦™è•‰èµ°å›å»é‡æ–°æ¬50æ ¹ã€‚ï¼‰</p></blockquote><p>è¿™ç§è¯•é¢˜é€šå¸¸æœ‰ä¸€ä¸ªè¿·æƒ‘ç‚¹ï¼Œè®©äººçœ‹ä¸æ‡‚é¢˜ç›®çš„æ„å›¾ã€‚æ­¤é¢˜è¿·æƒ‘ç‚¹åœ¨äºï¼šèµ°ä¸€ç±³åƒä¸€æ ¹é¦™è•‰ï¼Œä¸€å…±èµ°50ç±³ï¼Œé‚£ä¸æ˜¯æŠŠ50æ ¹é¦™è•‰åƒå®Œäº†å—ï¼Ÿå¦‚æœè¦å›å»æ¬å¦å¤–50æ ¹é¦™è•‰ï¼Œåˆ™å¾€å›èµ°çš„æ—¶å€™ä¹Ÿè¦åƒé¦™è•‰ï¼Œè¿™æ ·æ¯èµ°ä¸€ç±³éœ€è¦åƒæ‰ä¸‰æ ¹é¦™è•‰ï¼Œèµ°50ç±³å²‚ä¸æ˜¯éœ€è¦150æ ¹é¦™è•‰ï¼Ÿ</p><p>å…¶å®ä¸ç„¶ï¼Œæœ¬é¢˜å…³é”®ç‚¹åœ¨äºï¼šçŒ´å­æ¬ç®±å­çš„è¿‡ç¨‹å…¶å®åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µï¼šæ¥å›æ¬ï¼Œå½“é¦™è•‰æ•°ç›®å¤§äº50æ ¹æ—¶ï¼ŒçŒ´å­æ¯æ¬ä¸€ç±³éœ€è¦åƒæ‰ä¸‰æ ¹é¦™è•‰ã€‚ç¬¬äºŒé˜¶æ®µï¼šé¦™è•‰æ•°&lt;=50ï¼Œç›´æ¥æ¬å›å»ã€‚æ¯èµ°ä¸€ç±³åƒæ‰1æ ¹ã€‚</p><ol><li><p>ç¬¬ä¸€é˜¶æ®µï¼šå‡å¦‚æŠŠ100æ ¹é¦™è•‰åˆ†ä¸ºä¸¤ç®±ï¼Œä¸€ç®±50æ ¹</p><p>ç¬¬ä¸€æ­¥ï¼ŒæŠŠAç®±æ¬ä¸€ç±³ï¼Œåƒä¸€æ ¹ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œå¾€å›èµ°ä¸€ç±³ï¼Œåƒä¸€æ ¹ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼ŒæŠŠBç®±æ¬ä¸€ç±³ï¼Œåƒä¸€æ ¹ã€‚</p><p>è¿™æ ·ï¼ŒæŠŠæ‰€æœ‰é¦™è•‰æ¬èµ°ä¸€ç±³éœ€è¦åƒæ‰ä¸‰æ ¹é¦™è•‰ã€‚è¿™æ ·èµ°åˆ°ç¬¬å‡ ç±³çš„æ—¶å€™ï¼Œé¦™è•‰æ•°åˆšå¥½å°äº50å‘¢ï¼Ÿ</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>100</mn><mo>âˆ’</mo><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ—</mo><mn>3</mn><mo stretchy="false">)</mo><mo>&lt;</mo><mn>50</mn><mi mathvariant="normal">&amp;</mi><mi mathvariant="normal">&amp;</mi><mn>100</mn><mo>âˆ’</mo><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo>âˆ—</mo><mn>3</mn><mo stretchy="false">)</mo><mo>&gt;</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">100-(n*3)&lt;50 \&amp;\&amp; 100-(n-1*3)&gt;50</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">50&amp;&amp;100</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">50</span></span></span></span></span></p><p>èµ°åˆ°16ç±³çš„æ—¶å€™ï¼Œåƒæ‰48æ ¹é¦™è•‰ï¼Œå‰©52æ ¹é¦™è•‰ã€‚è¿™æ­¥å¾ˆæœ‰æ„æ€ï¼Œå®ƒå¯ä»¥ç›´æ¥æ¬50å¾€å‰èµ°ï¼Œä¹Ÿå¯ä»¥å†æ¥å›æ¬ä¸€æ¬¡ï¼Œä½†ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>åˆ°17ç±³çš„æ—¶å€™ï¼ŒçŒ´å­è¿˜æœ‰49æ ¹é¦™è•‰ã€‚è¿™æ—¶çŒ´å­å°±è½»æ¾å•¦ï¼Œç›´æ¥èƒŒç€èµ°å°±è¡Œã€‚</p></li><li><p>ç¬¬äºŒé˜¶æ®µï¼šèµ°ä¸€ç±³åƒä¸€æ ¹</p><p>æŠŠå‰©ä¸‹çš„50-17=33ç±³èµ°å®Œã€‚è¿˜å‰©49-33=16æ ¹é¦™è•‰ã€‚</p></li></ol><h4 id="11-Nåªèš‚èšèµ°æ ‘æï¼Œé—®æ€»è·ç¦»æˆ–è€…æ€»æ—¶é—´">11. Nåªèš‚èšèµ°æ ‘æï¼Œé—®æ€»è·ç¦»æˆ–è€…æ€»æ—¶é—´</h4><blockquote><p>é—®é¢˜ï¼šæ”¾Nåªèš‚èšåœ¨ä¸€æ¡é•¿åº¦ä¸ºMæ ‘æä¸Šï¼Œèš‚èšä¸èš‚èšä¹‹é—´ç¢°åˆ°å°±å„è‡ªå¾€åæ–¹å‘èµ°ï¼Œé—®æ€»è·ç¦»æˆ–è€…æ—¶é—´ä¸ºå¤šå°‘ï¼Ÿ</p></blockquote><p>è¿™ä¸ªå…¶å®å°±ä¸€ä¸ªè¯€çªï¼šèš‚èšç›¸ç¢°å°±å¾€åæ–¹å‘èµ°ï¼Œå¯ä»¥ç›´æ¥çœ‹åšæ²¡æœ‰å‘ç”Ÿä»»ä½•äº‹ï¼šå¤§å®¶éƒ½ç›¸å½“äºç‹¬ç«‹çš„</p><p>Aèš‚èšä¸Bèš‚èšç›¸ç¢°åä½ å¯ä»¥çœ‹åšæ²¡æœ‰å‘ç”Ÿè¿™æ¬¡ç¢°æ’ï¼Œè¿™æ ·æ— è®ºæ˜¯æ±‚æ—¶é—´è¿˜æ˜¯è·ç¦»éƒ½å¾ˆç®€å•äº†ã€‚</p><h4 id="12-Nä¸ªå¼ºç›—åˆ†é…Mä¸ªé‡‘å¸ï¼Œæ±‚æ–¹æ¡ˆä½¿å¾—è‡ªå·±åˆ†é…æœ€å¤š">12. Nä¸ªå¼ºç›—åˆ†é…Mä¸ªé‡‘å¸ï¼Œæ±‚æ–¹æ¡ˆä½¿å¾—è‡ªå·±åˆ†é…æœ€å¤š</h4><blockquote><p>5ä¸ªæµ·ç›—æŠ¢åˆ°äº†100æšé‡‘å¸ï¼Œæ¯ä¸€é¢—éƒ½ä¸€æ ·çš„å¤§å°å’Œä»·å€¼ã€‚ ä»–ä»¬å†³å®šè¿™ä¹ˆåˆ†ï¼š</p><ol><li><p>æŠ½ç­¾å†³å®šè‡ªå·±çš„å·ç ï¼ˆ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼‰</p></li><li><p>é¦–å…ˆï¼Œç”±1å·æå‡ºåˆ†é…æ–¹æ¡ˆï¼Œç„¶åå¤§å®¶5äººè¿›è¡Œè¡¨å†³ï¼Œå½“ åŠæ•°ä»¥ä¸Šçš„äººåŒæ„æ—¶ï¼ˆ ä¸åŒ…æ‹¬åŠæ•°ï¼Œè¿™æ˜¯é‡ç‚¹ï¼‰ï¼ŒæŒ‰ç…§ä»–çš„ææ¡ˆè¿›è¡Œåˆ†é…ï¼Œå¦åˆ™å°†è¢«æ‰”å…¥å¤§æµ·å–‚é²¨é±¼ã€‚</p></li><li><p>å¦‚æœ1å·æ­»åï¼Œå†ç”±2å·æå‡ºåˆ†é…æ–¹æ¡ˆï¼Œç„¶åå¤§å®¶4äººè¿›è¡Œè¡¨å†³ï¼Œå½“ä¸”ä»…å½“åŠè¶…è¿‡åŠæ•°çš„äººåŒæ„æ—¶ï¼ŒæŒ‰ç…§ä»–çš„ææ¡ˆè¿›è¡Œåˆ†é…ï¼Œå¦åˆ™å°†è¢«æ‰”å…¥å¤§æµ·å–‚é²¨é±¼ã€‚</p></li><li><p>ä¾æ¬¡ç±»æ¨â€¦</p></li></ol><p>å‡è®¾æ¯ä¸€ä½æµ·ç›—éƒ½è¶³å¤Ÿèªæ˜ï¼Œå¹¶ä¸”åˆ©ç›Šè‡³ä¸Šï¼Œèƒ½å¤šåˆ†ä¸€æšé‡‘å¸ç»ä¸å°‘åˆ†ï¼Œé‚£ä¹ˆ1å·æµ·ç›—è¯¥æ€ä¹ˆåˆ†é‡‘å¸æ‰èƒ½ä½¿è‡ªå·±åˆ†åˆ°æœ€å¤šçš„é‡‘å¸å‘¢ï¼Ÿ</p></blockquote><p>ä»åå‘å‰æ¨ï¼Œå¦‚æœ1è‡³3å·å¼ºç›—éƒ½å–‚äº†é²¨é±¼ï¼Œåªå‰©4å·å’Œ5å·çš„è¯ï¼Œ5å·ä¸€å®šæŠ•åå¯¹ç¥¨è®©4å·å–‚é²¨é±¼ï¼Œä»¥ç‹¬åå…¨éƒ¨é‡‘å¸ã€‚æ‰€ä»¥ï¼Œ4å·æƒŸæœ‰æ”¯æŒ3å·æ‰èƒ½ä¿å‘½ã€‚</p><ul><li><p>3å·çŸ¥é“è¿™ä¸€ç‚¹ï¼Œå°±ä¼šæå‡ºâ€œ100ï¼Œ0ï¼Œ0â€çš„åˆ†é…æ–¹æ¡ˆï¼Œå¯¹4å·ã€5å·ä¸€æ¯›ä¸æ‹”è€Œå°†å…¨éƒ¨é‡‘å¸å½’ä¸ºå·²æœ‰ï¼Œå› ä¸ºä»–çŸ¥é“4å·ä¸€æ— æ‰€è·ä½†è¿˜æ˜¯ä¼šæŠ•èµæˆç¥¨ï¼Œå†åŠ ä¸Šè‡ªå·±ä¸€ç¥¨ï¼Œä»–çš„æ–¹æ¡ˆå³å¯é€šè¿‡ã€‚</p></li><li><p>ä¸è¿‡ï¼Œ2å·æ¨çŸ¥3å·çš„æ–¹æ¡ˆï¼Œå°±ä¼šæå‡ºâ€œ98ï¼Œ0ï¼Œ1ï¼Œ1â€çš„æ–¹æ¡ˆï¼Œå³æ”¾å¼ƒ3å·ï¼Œè€Œç»™äºˆ4å·å’Œ5å·å„ä¸€æšé‡‘å¸ã€‚ç”±äºè¯¥æ–¹æ¡ˆå¯¹äº4å·å’Œ5å·æ¥è¯´æ¯”åœ¨3å·åˆ†é…æ—¶æ›´ä¸ºæœ‰åˆ©ï¼Œä»–ä»¬å°†æ”¯æŒä»–è€Œä¸å¸Œæœ›ä»–å‡ºå±€è€Œç”±3å·æ¥åˆ†é…ã€‚è¿™æ ·ï¼Œ2å·å°†æ‹¿èµ°98æšé‡‘å¸ã€‚</p></li><li><p>åŒæ ·ï¼Œ2å·çš„æ–¹æ¡ˆä¹Ÿä¼šè¢«1å·æ‰€æ´æ‚‰ï¼Œ1å·å¹¶å°†æå‡ºï¼ˆ97ï¼Œ0ï¼Œ1ï¼Œ2ï¼Œ0ï¼‰æˆ–ï¼ˆ97ï¼Œ0ï¼Œ1ï¼Œ0ï¼Œ2ï¼‰çš„æ–¹æ¡ˆï¼Œå³æ”¾å¼ƒ2å·ï¼Œè€Œç»™3å·ä¸€æšé‡‘å¸ï¼ŒåŒæ—¶ç»™4å·ï¼ˆæˆ–5å·ï¼‰2æšé‡‘å¸ã€‚ç”±äº1å·çš„è¿™ä¸€æ–¹æ¡ˆå¯¹äº3å·å’Œ4å·ï¼ˆæˆ–5å·ï¼‰æ¥è¯´ï¼Œç›¸æ¯”2å·åˆ†é…æ—¶æ›´ä¼˜ï¼Œä»–ä»¬å°†æŠ•1å·çš„èµæˆç¥¨ï¼Œå†åŠ ä¸Š1å·è‡ªå·±çš„ç¥¨ï¼Œ1å·çš„æ–¹æ¡ˆå¯è·é€šè¿‡ï¼Œ97æšé‡‘å¸å¯è½»æ¾è½å…¥å›Šä¸­ã€‚è¿™æ— ç–‘æ˜¯1å·èƒ½å¤Ÿè·å–æœ€å¤§æ”¶ç›Šçš„æ–¹æ¡ˆäº†ï¼</p></li></ul><p>1å·å¼ºç›—åˆ†ç»™3å·1æšé‡‘å¸ï¼Œåˆ†ç»™4å·æˆ–5å·å¼ºç›—2æšï¼Œè‡ªå·±ç‹¬å¾—97æšã€‚åˆ†é…æ–¹æ¡ˆå¯å†™æˆï¼ˆ97ï¼Œ0ï¼Œ1ï¼Œ2ï¼Œ0ï¼‰æˆ–ï¼ˆ97ï¼Œ0ï¼Œ1ï¼Œ0ï¼Œ2ï¼‰ã€‚</p><blockquote><p>å˜ç§ï¼šå°±æ˜¯åªéœ€è¦ä¸€åŠäººåŒæ„å³å¯ï¼Œä¸éœ€è¦ä¸€åŠäººä»¥ä¸ŠåŒæ„æ–¹æ¡ˆå°±å¯ä»¥é€šè¿‡ï¼Œåœ¨å…¶ä»–æ¡ä»¶ä¸å˜çš„æƒ…å†µä¸‹ï¼Œ1å·è¯¥æ€ä¹ˆåˆ†é…æ‰èƒ½è·å¾—æœ€å¤šçš„é‡‘å¸ï¼Ÿ</p></blockquote><ul><li><p>4å·ï¼š4å·æå‡ºçš„æ–¹æ¡ˆçš„æ—¶å€™è‚¯å®šæ˜¯æœ€ç»ˆæ–¹æ¡ˆï¼Œå› ä¸ºä¸ç®¡5å·åŒæ„ä¸åŒæ„éƒ½èƒ½é€šè¿‡ï¼Œæ‰€ä»¥4å·5å·ä¸å¿…æ‹…å¿ƒè‡ªå·±è¢«æŠ•å…¥å¤§æµ·ã€‚é‚£æ­¤æ—¶5å·è·å¾—çš„é‡‘å¸ä¸º0ï¼Œ4å·è·å¾—çš„é‡‘å¸ä¸º100ã€‚</p></li><li><p>5å·ï¼šå› ä¸º4å·ææ–¹æ¡ˆçš„æ—¶å€™ ï¼Œè‡ªå·±è·å–çš„é‡‘å¸ä¸º0 ã€‚æ‰€ä»¥åªè¦4å·ä¹‹å‰çš„äººåˆ†é…ç»™è‡ªå·±çš„é‡‘å¸å¤§äº0å°±åŒæ„è¯¥æ–¹æ¡ˆã€‚</p></li><li><p>4å·ï¼šå¦‚æœ3å·æçš„æ–¹æ¡ˆä¸€å®šèƒ½è·å¾—é€šè¿‡ï¼ˆåŸå› ï¼š3å·ç»™5å·çš„é‡‘å¸å¤§äº0ï¼Œ 5å·å°±åŒæ„ å› æ­¤å°±èƒ½é€šè¿‡ï¼‰ï¼Œé‚£è‡ªå·±è·å¾—çš„é‡‘å¸å°±ä¸º0ï¼Œæ‰€ä»¥åªè¦2å·è®©è‡ªå·±è·å¾—çš„é‡‘å¸å¤§äº0å°±ä¼šåŒæ„ã€‚</p></li><li><p>3å·ï¼šå› ä¸ºåˆ°äº†è‡ªå·±ææ–¹æ¡ˆçš„æ—¶å€™å¯ä»¥ç»™5å·ä¸€é‡‘å¸ï¼Œè‡ªå·±çš„æ–¹æ¡ˆå°±èƒ½é€šè¿‡ï¼Œä½†è€ƒè™‘åˆ°2å·ææ–¹æ¡ˆçš„æ—¶å€™ç»™4å·ä¸€ä¸ªé‡‘å¸ï¼Œ2å·çš„æ–¹æ¡ˆå°±ä¼šé€šè¿‡ï¼Œé‚£è‡ªå·±è·å¾—çš„é‡‘å¸å°±ä¸º0ã€‚æ‰€ä»¥åªè¦1å·è®©è‡ªå·±è·å¾—çš„é‡‘å¸å¤§äº0å°±ä¼šåŒæ„ã€‚</p></li><li><p>2å·ï¼šå› ä¸ºåˆ°äº†è‡ªå·±ææ–¹æ¡ˆçš„æ—¶å€™åªè¦ç»™4å·ä¸€é‡‘å¸ï¼Œå°±èƒ½è·å¾—é€šè¿‡ï¼Œæ ¹æœ¬å°±ä¸ç”¨é¡¾åŠ3 å· 5å·åŒæ„ä¸åŒæ„ï¼Œæ‰€ä»¥ä¸ç®¡1å·æ€ä¹ˆæéƒ½ä¸ä¼šåŒæ„ã€‚</p></li><li><p>1å·ï¼š2å·è‚¯å®šä¸ä¼šåŒæ„ã€‚ä½†åªè¦ç»™3å·ä¸€å—é‡‘å¸ï¼Œ5å·ä¸€å—é‡‘å¸ï¼ˆå› ä¸º5å·å¦‚æœä¸åŒæ„ï¼Œé‚£ä¹ˆ4å·åˆ†é…çš„æ—¶å€™ï¼Œä»–ä»€ä¹ˆéƒ½æ‹¿ä¸åˆ°ï¼‰å°±èƒ½è·å¾—é€šè¿‡ã€‚</p></li></ul><p>æ‰€ä»¥å‚è€ƒå›ç­”æ˜¯ï¼š 98ï¼Œ0ï¼Œ1ï¼Œ0ï¼Œ1ã€‚</p><h4 id="14-ç«æªæ‰‹å†³æ–—ï¼Œè°æ´»ä¸‹æ¥çš„æ¦‚ç‡å¤§ï¼Ÿ">14. ç«æªæ‰‹å†³æ–—ï¼Œè°æ´»ä¸‹æ¥çš„æ¦‚ç‡å¤§ï¼Ÿ</h4><blockquote><p>é—®é¢˜ï¼šå½¼æ­¤ç—›æ¨çš„ç”²ã€ä¹™ã€ä¸™ä¸‰ä¸ªæªæ‰‹å‡†å¤‡å†³æ–—ã€‚ç”²æªæ³•æœ€å¥½ï¼Œåå‘å…«ä¸­ï¼›ä¹™æªæ³•æ¬¡ä¹‹ï¼Œåå‘å…­ä¸­ï¼›ä¸™æªæ³•æœ€å·®ï¼Œåå‘å››ä¸­ã€‚å¦‚æœä¸‰äººåŒæ—¶å¼€æªï¼Œå¹¶ä¸”æ¯äººæ¯è½®åªå‘ä¸€æªï¼›é‚£ä¹ˆæªæˆ˜åï¼Œè°æ´»ä¸‹æ¥çš„æœºä¼šå¤§ä¸€äº›ï¼Ÿ</p></blockquote><p>ä¸€èˆ¬äººè®¤ä¸ºç”²çš„æªæ³•å¥½ï¼Œæ´»ä¸‹æ¥çš„å¯èƒ½æ€§å¤§ä¸€äº›ã€‚ä½†åˆä¹æ¨ç†çš„ç»“è®ºæ˜¯ï¼Œæªæ³•æœ€ç³Ÿç³•çš„ä¸™æ´»ä¸‹æ¥çš„å‡ ç‡æœ€å¤§ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹å„ä¸ªæªæ‰‹çš„ç­–ç•¥ã€‚</p><p>å¦‚åŒç”°å¿Œèµ›é©¬ä¸€èˆ¬ï¼Œæªæ‰‹ç”²ä¸€å®šè¦å¯¹æªæ‰‹ä¹™å…ˆã€‚å› ä¸ºä¹™å¯¹ç”²çš„å¨èƒè¦æ¯”ä¸™å¯¹ç”²çš„å¨èƒæ›´å¤§ï¼Œç”²åº”è¯¥é¦–å…ˆå¹²æ‰ä¹™ï¼Œè¿™æ˜¯ç”²çš„æœ€ä½³ç­–ç•¥ã€‚</p><p>åŒæ ·çš„é“ç†ï¼Œæªæ‰‹ä¹™çš„æœ€ä½³ç­–ç•¥æ˜¯ç¬¬ä¸€æªç„å‡†ç”²ã€‚ä¹™ä¸€æ—¦å°†ç”²å¹²æ‰ï¼Œä¹™å’Œä¸™è¿›è¡Œå¯¹å†³ï¼Œä¹™èƒœç®—çš„æ¦‚ç‡è‡ªç„¶å¤§å¾ˆå¤šã€‚</p><p>æªæ‰‹ä¸™çš„æœ€ä½³ç­–ç•¥ä¹Ÿæ˜¯å…ˆå¯¹ç”²ã€‚ä¹™çš„æªæ³•æ¯•ç«Ÿæ¯”ç”²å·®ä¸€äº›ï¼Œä¸™å…ˆæŠŠç”²å¹²æ‰å†ä¸ä¹™è¿›è¡Œå¯¹å†³ï¼Œä¸™çš„å­˜æ´»æ¦‚ç‡è¿˜æ˜¯è¦é«˜ä¸€äº›ã€‚</p><p>æˆ‘ä»¬æ ¹æ®åˆ†ææ¥è®¡ç®—ä¸€ä¸‹ä¸‰ä¸ªæªæ‰‹åœ¨ä¸Šè¿°æƒ…å†µä¸‹çš„å­˜æ´»å‡ ç‡ï¼š ç¬¬ä¸€è½®ï¼šç”²å°„ä¹™ï¼Œä¹™å°„ç”²ï¼Œä¸™å°„ç”²ã€‚</p><ul><li><p>ç”²çš„æ´»ç‡ä¸º24%ï¼ˆ40% X 60%ï¼‰</p></li><li><p>ä¹™çš„æ´»ç‡ä¸º20%(100% - 80%)</p></li><li><p>ä¸™çš„æ´»ç‡ä¸º100%ï¼ˆæ— äººå°„ä¸™ï¼‰</p></li></ul><p>ç”±äºä¸™100ï¼…å­˜æ´»ç‡ï¼Œå› æ­¤æ ¹æ®ä¸Šè½®ç”²ä¹™å­˜æ´»çš„æƒ…å†µæ¥è®¡ç®—ä¸‰äººç¬¬äºŒè½®çš„å­˜æ´»å‡ ç‡ï¼š</p><ul><li>æƒ…å†µ1ï¼šç”²æ´»ä¹™æ­»ï¼ˆ24% X 80% = 19.2%ï¼‰ ç”²å°„ä¸™ï¼Œä¸™å°„ç”²ï¼šç”²çš„æ´»ç‡ä¸º60%ï¼Œä¸™çš„æ´»ç‡ä¸º20%ã€‚</li><li>æƒ…å†µ2ï¼šä¹™æ´»ç”²æ­»ï¼ˆ20% X 76% = 15.2%ï¼‰ ä¹™å°„ä¸™ï¼Œä¸™å°„ä¹™ï¼šä¹™çš„æ´»ç‡ä¸º60%ï¼Œä¸™çš„æ´»ç‡ä¸º40%ã€‚</li><li>æƒ…å†µ3ï¼šç”²ä¹™åŒæ´»ï¼ˆ24% X 20% = 4.8%ï¼‰ é‡å¤ç¬¬ä¸€è½®ã€‚ æƒ…å†µ4ï¼šç”²ä¹™åŒæ­»ï¼ˆ76% X 80% = 60.8%ï¼‰ æªæˆ˜ç»“æŸã€‚</li></ul><p>æ®æ­¤æ¥è®¡ç®—ä¸‰äººæ´»ç‡ï¼š</p><ul><li>ç”²çš„æ´»ç‡ä¸º(19.2% X 60%) + (4.8% X 24%) = 12.672%</li><li>ä¹™çš„æ´»ç‡ä¸º(15.2% X 60%) + (4.8% X 20%) = 10.08%</li><li>ä¸™çš„æ´»ç‡ä¸º(19.2% X 20%) + (15.2% X 40%) + (4.8% X 100%) + (60.8% X 100%) = 75.52%</li></ul><p>é€šè¿‡å¯¹ä¸¤è½®æªæˆ˜çš„è¯¦ç»†æ¦‚ç‡è®¡ç®—ï¼Œæˆ‘ä»¬å‘ç°æªæ³•æœ€å·®çš„ä¸™å­˜æ´»çš„å‡ ç‡æœ€å¤§ï¼Œæªæ³•è¾ƒå¥½çš„ç”²å’Œä¹™çš„å­˜æ´»å‡ ç‡å´è¿œä½äºä¸™çš„å­˜æ´»å‡ ç‡ã€‚</p><h4 id="15-å…ˆæ‰‹å¿…èƒœçš„é—®é¢˜">15. å…ˆæ‰‹å¿…èƒœçš„é—®é¢˜</h4><blockquote><p>100æœ¬ä¹¦ï¼Œæ¯æ¬¡èƒ½å¤Ÿæ‹¿1-5æœ¬ï¼Œæ€ä¹ˆæ‹¿èƒ½ä¿è¯æœ€åä¸€æ¬¡æ˜¯ä½ æ‹¿ï¼Ÿ</p></blockquote><p>å¯»æ‰¾æ¯ä¸ªå›åˆå›ºå®šçš„æ‹¿å–æ¨¡å¼ï¼Œæœ€åä¸€æ¬¡æ˜¯æˆ‘æ‹¿ï¼Œé‚£ä¹ˆä¸Šä¸ªå›åˆæœ€å°‘å‰©ä¸‹6æœ¬ã€‚é‚£ä¹ˆåªè¦ä¿æŒæ¯ä¸ªå›åˆç»“æŸåéƒ½å‰©ä¸‹6çš„å€æ•°ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªå›åˆä¸­æˆ‘æ‹¿çš„å’Œå¯¹æ–¹æ‹¿çš„åŠ èµ·æ¥ä¸º6ï¼ˆè¿™æ ·è¿™ä¸ªå›åˆç»“æŸåå‰©ä¸‹çš„è¿˜æ˜¯6çš„å€æ•°ï¼‰ï¼Œå°±å¿…èƒœã€‚</p><p>å…³é”®æ˜¯ç¬¬ä¸€æ¬¡æˆ‘å¿…é¡»å…ˆæ‰‹æ‹¿ï¼ˆ100%6=4ï¼‰æœ¬ï¼ˆè¿™ä¸ç®—åœ¨ç¬¬ä¸€å›åˆé‡Œé¢ï¼‰ã€‚</p><h4 id="16-æ°å·§å…‹åŠ›é—®é¢˜æˆ–è€…å‚åŠ è¾©è®ºèµ›">16. æ°å·§å…‹åŠ›é—®é¢˜æˆ–è€…å‚åŠ è¾©è®ºèµ›</h4><blockquote><p>1ã€æ°å·§å…‹åŠ›é—®é¢˜ N<em>Må—å·§å…‹åŠ›ï¼Œæ¯æ¬¡æ°ä¸€å—çš„ä¸€è¡Œæˆ–ä¸€åˆ—ï¼Œæ°æˆ1</em>1çš„å·§å…‹åŠ›éœ€è¦å¤šå°‘æ¬¡ï¼Ÿ</p><p>2ã€1000ä¸ªäººå‚åŠ è¾©è®ºèµ›ï¼Œ1V1ï¼Œè¾“äº†å°±é€€å‡ºï¼Œéœ€è¦å®‰æ’å¤šå°‘åœºæ¯”èµ›ï¼Ÿ</p></blockquote><p>æ¯æ¬¡æ‹¿èµ·ä¸€å—å·§å…‹åŠ›ï¼Œæ°ä¸€ä¸‹ï¼ˆæ— è®ºæ¨ªç€è¿˜æ˜¯ç«–ç€ï¼‰éƒ½ä¼šå˜æˆä¸¤å—ï¼Œå› ä¸ºæ‰€æœ‰çš„å·§å…‹åŠ›å…±æœ‰N<em>Må—ï¼Œæ‰€ä»¥è¦æ°N</em>M-1æ¬¡ï¼Œ-1æ˜¯å› ä¸ºæœ€å¼€å§‹çš„ä¸€å—æ˜¯ä¸ç”¨ç®—è¿›å»çš„ã€‚</p><p>æ¯ä¸€åœºè¾©è®ºèµ›å‚åŠ ä¸¤ä¸ªäººï¼Œæ¶ˆå¤±ä¸€ä¸ªäººï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä½œæ˜¯æ¯ä¸€åœºè¾©è®ºèµ›å‡å°‘ä¸€ä¸ªäººï¼Œç›´åˆ°æœ€åå‰©ä¸‹1ä¸ªäººï¼Œæ‰€ä»¥æ˜¯1000-1=999åœºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> åœºæ™¯é¢˜ </tag>
            
            <tag> æ™ºåŠ›é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰_è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</title>
      <link href="/p/61434/"/>
      <url>/p/61434/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>ä¸ƒã€æ•°æ®ç»“æ„å’Œç®—æ³•</h1><h4 id="1-å¦‚ä½•å¯¹å¿«æ’è¿›è¡Œä¼˜åŒ–ï¼Ÿ">1. å¦‚ä½•å¯¹å¿«æ’è¿›è¡Œä¼˜åŒ–ï¼Ÿ</h4><ul><li><p><strong>ä¸‰æ•°å–ä¸­æ³•å’Œéšæœºäº¤æ¢æ³•</strong></p><blockquote><p>å¿«æ’å°†é€‰å–çš„åŸºå‡†ç‚¹ç»è¿‡è°ƒæ•´æ”¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œä¹‹åå°†è¿™ä¸ªåŸºå‡†ç‚¹å·¦å³ä¸¤è¾¹çš„åŒºé—´åˆ†åˆ«é€’å½’çš„è¿›è¡Œå¿«æ’ã€‚</p><p>å¦‚æœåŸºå‡†ç‚¹çš„æ•°æ®æ¯”è¾ƒå°ï¼Œå°†ä¼šå¯¼è‡´è°ƒæ•´ååŸºå‡†ç‚¹å¤„äºé è¿‘ä¸¤ä¾§çš„ä½ç½®ï¼Œé‚£ä¹ˆä¸¤è¾¹çš„åŒºé—´é•¿åº¦å°†ä¼šä¸¥é‡å¤±å»å¹³è¡¡.</p></blockquote><p><strong>ä¸‰æ•°å–ä¸­æ³•ï¼šæŒ‡çš„æ˜¯é€‰å–åŸºå‡†ç‚¹ä¹‹å‰</strong>æˆ‘ä»¬å¯ä»¥æ‹¿å‡ºæ•°åˆ—ä¸­é—´ä½ç½®å…ƒç´ çš„å€¼ï¼Œå°†å®ƒå’Œé¦–å°¾çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œä¹‹åå°†è¿™ä¸‰ä¸ªæ•°ä¸­çš„<strong>ä¸­é—´æ•°</strong>äº¤æ¢åˆ°<strong>æ•°åˆ—é¦–ä½</strong>çš„ä½ç½®ï¼Œä¹‹åå°†è¿™ä¸ªæ•°ä½œä¸ºåŸºå‡†ç‚¹ï¼Œ<u>å°½é‡å‡å°ä¹‹åçš„åˆ†åŒºåå·¦å³ä¸¤è¾¹çš„åŒºé—´é•¿åº¦ä¹‹å·®</u>ã€‚</p></li><li><p><strong>ä¸‰è·¯åˆ†å‰²æ³•</strong></p><p><strong>ä¸‰è·¯æ³•åŒæ ·æ˜¯é’ˆå¯¹å«æœ‰å¤§é‡ã€é‡å¤æ•°åˆ—ã€‘çš„ä¼˜åŒ–</strong>ã€‚</p><p>3è·¯æ³•çš„æ€æƒ³æ˜¯å°†æ•°åˆ—åˆ†æˆ3ä¸ªåŒºé—´ï¼Œåˆ†åˆ«æ˜¯<strong>å°äºã€ç­‰äºå’Œå¤§äºåŸºå‡†ç‚¹çš„åŒºé—´</strong>ã€‚é‚£ä¹ˆåˆ†åŒºä¹‹åï¼Œå¯¹äºç­‰äºåŸºå‡†ç‚¹çš„åŒºé—´å†…çš„å…ƒç´ ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å¯¹å…¶åšä»»ä½•å¤„ç†äº†ï¼Œåªéœ€è¦é€’å½’çš„å¤„ç†å°äºå’Œå¤§äºåŸºå‡†ç‚¹çš„å…ƒç´ å³å¯ã€‚</p></li><li><p><strong>ç»“åˆæ’å…¥æ’åº</strong></p><p>å½“å¾…æ’åºåºåˆ—çš„é•¿åº¦åˆ†å‰²åˆ°ä¸€å®šå¤§å°åï¼Œä½¿ç”¨<strong>æ’å…¥æ’åº</strong>ã€‚</p><ul><li><strong>å¯¹äºå¾ˆå°å’Œéƒ¨åˆ†æœ‰åºçš„æ•°ç»„ï¼Œå¿«æ’ä¸å¦‚æ’æ’å¥½</strong>ã€‚å½“å¾…æ’åºåºåˆ—çš„é•¿åº¦åˆ†å‰²åˆ°ä¸€å®šå¤§å°åï¼Œç»§ç»­åˆ†å‰²çš„æ•ˆç‡æ¯”æ’å…¥æ’åºè¦å·®ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨æ’æ’è€Œä¸æ˜¯å¿«æ’ã€‚</li></ul></li></ul><h4 id="2-å¿«æ’å’Œå †æ’çš„åŒºåˆ«ï¼Ÿä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¿«æ’å’Œå †æ’ï¼Ÿ">2.<strong>å¿«æ’å’Œå †æ’çš„åŒºåˆ«</strong>ï¼Ÿ<strong>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¿«æ’å’Œå †æ’</strong>ï¼Ÿ</h4><ul><li><p><strong>å¿«æ’å’Œå †æ’åŒºåˆ«</strong>ï¼Ÿ</p><ul><li><p><strong>ç»¼åˆæ€§èƒ½</strong>ï¼šå®é™…åº”ç”¨ä¸­ï¼Œè™½ç„¶<u>å †æ’åºçš„æ—¶é—´å¤æ‚åº¦è¦æ¯”å¿«é€Ÿæ’åºç¨³å®š</u>ï¼ˆå¿«æ’æœ€å·®é€€åŒ–æˆO(N^2)ï¼‰ ï¼Œä½†æ˜¯ç»Ÿè®¡æ„ä¹‰ä¸Šè¿™ç§æƒ…å†µè¾ƒå°‘ï¼Œæ‰€ä»¥ç»¼åˆæ€§èƒ½è¿˜æ˜¯å¿«æ’æ›´ä¼˜ï¼›</p></li><li><p><strong>äº¤æ¢æ¬¡æ•°</strong>ï¼š å¯¹äºåŒæ ·çš„æ•°æ®ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå †æ’åºç®—æ³•çš„æ•°æ®äº¤æ¢æ¬¡æ•°è¦å¤šäºå¿«é€Ÿæ’åºï¼›</p></li><li><p><strong>è®¿é—®å‹å¥½</strong>ï¼š å †æ’åºæ•°æ®è®¿é—®çš„æ–¹å¼æ²¡æœ‰å¿«é€Ÿæ’åºå‹å¥½ã€‚</p><blockquote><p><strong>å¯¹äºå¿«é€Ÿæ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯é¡ºåºè®¿é—®çš„ï¼›è€Œå †æ’åºæ¥è¯´ï¼Œæ•°æ®æ˜¯è·³ç€è®¿é—®çš„</strong>ã€‚æ¯”å¦‚ï¼Œå †æ’åºä¸­ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªæ“ä½œå°±æ˜¯æ•°æ®çš„å †åŒ–ã€‚å¯¹å †é¡¶èŠ‚ç‚¹è¿›è¡Œå †åŒ–ï¼Œä¼šä¸€æ¬¡è®¿é—®<strong>æ•°ç»„ä¸‹æ ‡1ï¼Œ2ï¼Œ4ï¼Œ8</strong>çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯åƒå¿«æ’é‚£æ ·ï¼Œå±€éƒ¨é¡ºåºè®¿é—®ï¼Œ<u>æ‰€ä»¥å¯¹<strong>CPUç¼“å­˜</strong>æ˜¯ä¸å‹å¥½çš„</u>ã€‚</p></blockquote></li></ul></li><li><p><strong>å¿«æ’å’Œå †æ’ä½¿ç”¨åœºæ™¯</strong>ï¼Ÿ</p><ul><li><p><strong>å¿«æ’</strong>ï¼š ç»å¤§å¤šæ•°åœºåˆã€‚</p></li><li><p><strong>å †æ’</strong>ï¼š topKé—®é¢˜ã€ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆéœ€è¦åœ¨ä¸€ç»„ä¸åœæ›´æ–°çš„æ•°æ®ä¸­ä¸åœåœ°æ‰¾æœ€å¤§/å°å…ƒç´ ï¼‰</p><blockquote><p>åœ¨Nä¸ªå…ƒç´ ä¸­æ‰¾åˆ°top Kï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N log K)ï¼Œç©ºé—´å¤æ‚çš„æ˜¯O(K)ï¼Œè€Œå¿«é€Ÿæ’åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯O(N)ã€‚</p></blockquote></li></ul></li></ul><h4 id="3-ã€é¢è¯•é‡ç‚¹ã€‘æœ‰å“ªäº›æ’åºç®—æ³•ï¼Œå„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦-å“ªäº›æ˜¯ç¨³å®šçš„ï¼Ÿä¸ºä»€ä¹ˆæ˜¯ç¨³å®šçš„ï¼Ÿ">3. ã€é¢è¯•é‡ç‚¹ã€‘æœ‰å“ªäº›æ’åºç®—æ³•ï¼Œå„ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ ? å“ªäº›æ˜¯ç¨³å®šçš„ï¼Ÿä¸ºä»€ä¹ˆæ˜¯ç¨³å®šçš„ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/05/01/K3s7DFEvyhHkwI9.png" alt="image-20210501224258097"></p><h5 id="3-1-å¦‚æœæ•°æ®å¤§è‡´æœ‰åºçš„ï¼Œç”¨ä»€ä¹ˆæ’åºæ¯”è¾ƒå¥½ï¼Ÿ">3.1 å¦‚æœæ•°æ®å¤§è‡´æœ‰åºçš„ï¼Œç”¨ä»€ä¹ˆæ’åºæ¯”è¾ƒå¥½ï¼Ÿ</h5><p>å¦‚æœæ˜¯<strong>å¤§è‡´æœ‰åº</strong>ï¼Œç”¨ <u>æ’å…¥æ’åº</u> æ¯”è¾ƒå¥½ï¼š</p><ul><li><u>ç›´æ¥æ’å…¥æ’åº</u>æ˜¯å°†ç¬¬iä¸ªå…ƒç´ æ’å…¥åˆ°å·²ç»æ’åºå¥½çš„å‰i-1ä¸ªå…ƒç´ ä¸­ ï¼Œå½“å…ƒç´ åŸºæœ¬æœ‰åºæ—¶ã€‚å’Œå‰i-1ä¸ªå…ƒç´ <strong>æœ«å°¾æ¯”è¾ƒä¸€æ¬¡</strong>å°±å¯ä»¥ç›´æ¥æ’å…¥ã€‚</li></ul><p>åœ¨ç›¸æ¯”ä½¿ç”¨å…¶å®ƒæ’åºï¼š</p><ul><li><p><u>å½’å¹¶æ’åºï¼š</u> å½’å¹¶æ’åºå’Œæ•°ç»„æ˜¯å¦æœ‰åºæ— å…³ï¼Œéƒ½æ˜¯O(nlgn)ã€‚</p><blockquote><p>å½’å¹¶æ’åºæ˜¯æŠŠä¸€ä¸ªæœ‰nä¸ªè®°å½•çš„æ— åºæ–‡ä»¶çœ‹æˆç”±<strong>nä¸ªé•¿åº¦ä¸º1</strong>çš„æœ‰åºå­æ–‡ä»¶ç»„æˆçš„æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œä¸¤ä¸¤å½’å¹¶ï¼Œå¾—åˆ°[n/2]ä¸ªé•¿åº¦ä¸º2æˆ–1çš„æœ‰åºæ–‡ä»¶ï¼Œå†ä¸¤ä¸¤å½’å¹¶ ã€‚</p></blockquote></li><li><p><u>å¿«é€Ÿæ’åºï¼š</u> æ•°ç»„åŸºæœ¬æœ‰åºæ—¶ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨åŸºç‚¹æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåˆ’åˆ†çš„ä¸¤ä¸ªå­æ•°ç»„æä¸ºä¸å¹³è¡¡ï¼Œæ¯æ¬¡åˆ’åˆ†æ¯”è¾ƒæ¬¡æ•°éƒ½å¾ˆå¤šã€‚æ‰€ä»¥ä¸æ¨èã€‚</p></li></ul><h4 id="4-äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œçº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«ï¼Ÿï¼ˆæœ‰äº†äºŒå‰æŸ¥æ‰¾æ ‘ã€å¹³è¡¡æ ‘ï¼ˆAVLï¼‰ä¸ºå•¥è¿˜éœ€è¦çº¢é»‘æ ‘ï¼Ÿï¼‰">4. äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œçº¢é»‘æ ‘å’Œå¹³è¡¡äºŒå‰æ ‘çš„åŒºåˆ«ï¼Ÿï¼ˆæœ‰äº†äºŒå‰æŸ¥æ‰¾æ ‘ã€å¹³è¡¡æ ‘ï¼ˆAVLï¼‰ä¸ºå•¥è¿˜éœ€è¦çº¢é»‘æ ‘ï¼Ÿï¼‰</h4><blockquote><p>æ€»ç»“æ¥è¯´ï¼šå¹³è¡¡æ ‘æ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘é€€åŒ–ä¸ºé“¾è¡¨çš„æƒ…å†µï¼›è€Œçº¢é»‘æ ‘æ˜¯ä¸ºäº†è§£å†³å¹³è¡¡æ ‘åœ¨æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œéœ€è¦é¢‘ç¹è°ƒæ•´çš„æƒ…å†µã€‚</p></blockquote><ul><li><p><strong>äºŒå‰æŸ¥æ‰¾æ ‘é€€åŒ–æˆå•é“¾è¡¨</strong></p><p>æ­£å¸¸ä½¿ç”¨äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯ç±»ä¼¼äº<u>äºŒåˆ†æŸ¥æ‰¾ Oï¼ˆlognï¼‰</u>ï¼Œä½†æ˜¯æç«¯æƒ…å†µï¼š</p><ul><li><p>æ„å»ºçš„äºŒå‰æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½åªæœ‰å³å­æ ‘æˆ–å·¦å­æ ‘ï¼Œæ­¤æ—¶æ—¶é—´å¤æ‚åº¦é€€åŒ–æˆO(N)</p><p><img src="https://i.loli.net/2021/05/01/38TASb1DB7sYN5k.jpg" alt="preview"></p></li></ul></li><li><p><strong>å¹³è¡¡äºŒå‰æ ‘é¢‘ç¹å·¦å³æ—‹</strong></p><p>å¹³è¡¡äºŒå‰æ ‘å°±æ˜¯ä¸ºäº†è§£å†³äºŒå‰æŸ¥æ‰¾æ ‘é€€åŒ–æˆä¸€é¢—é“¾è¡¨è€Œè¯ç”Ÿäº†ï¼Œå¹³è¡¡æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><p>å…·æœ‰äºŒå‰æŸ¥æ‰¾æ ‘çš„å…¨éƒ¨ç‰¹æ€§ï¼›</p></li><li><p><strong>æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®è‡³å¤šç­‰äº1</strong>ã€‚</p></li></ol><p>é¿å…äº†äºŒå‰æŸ¥æ‰¾æ ‘æç«¯æƒ…å†µäº§ç”Ÿï¼Œä½†æ˜¯ï¼š</p><ul><li>æ¯æ¬¡è¿›è¡Œæ’å…¥/åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå‡ ä¹éƒ½ä¼šç ´åå¹³è¡¡æ ‘çš„ç¬¬äºŒä¸ªè§„åˆ™ï¼Œè¿›è€Œæˆ‘ä»¬éƒ½éœ€è¦é€šè¿‡<strong>å·¦æ—‹</strong>å’Œ<strong>å³æ—‹</strong>æ¥è¿›è¡Œè°ƒæ•´ï¼Œä½¿ä¹‹å†æ¬¡æˆä¸ºä¸€é¢—ç¬¦åˆè¦æ±‚çš„å¹³è¡¡æ ‘ã€‚</li></ul><p>å¹³è¡¡æ ‘æ€§èƒ½å¤§æ‰“æŠ˜æ‰£ã€‚</p></li><li><p><strong>çº¢é»‘æ ‘è§„ä¸éœ€è¦é¢‘ç¹ç€è°ƒæ•´</strong></p><p>çº¢é»‘æ ‘å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><blockquote><p>æœ€åæƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½åœ¨ O(logn) çš„æ—¶é—´å¤æ‚åº¦æŸ¥æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ã€‚</p><ul><li>ä¸å¹³è¡¡æ ‘ä¸åŒçš„æ˜¯ï¼Œçº¢é»‘æ ‘åœ¨æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œï¼Œï¼ˆğŸš©*1ï¼‰<strong>ä¸ä¼šåƒå¹³è¡¡æ ‘é‚£æ ·ï¼Œé¢‘ç¹ç€ç ´åçº¢é»‘æ ‘çš„è§„åˆ™ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢‘ç¹ç€è°ƒæ•´</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨çº¢é»‘æ ‘çš„åŸå› ï¼›</li><li>ä½†æ˜¯ï¼Œå•å•åœ¨æŸ¥æ‰¾æ–¹é¢çš„æ•ˆç‡çš„è¯ï¼Œå¹³è¡¡æ ‘æ¯”çº¢é»‘æ ‘å¿«ã€‚</li></ul></blockquote><p><img src="https://i.loli.net/2021/05/01/sFSaG9POEi73hdo.jpg" alt="img"></p><ol><li>å…·æœ‰äºŒå‰æŸ¥æ‰¾æ ‘çš„ç‰¹ç‚¹ï¼›</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼›</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNILï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¶å­èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼›</li><li><strong>ä»»ä½•ç›¸é‚»çš„èŠ‚ç‚¹éƒ½ä¸èƒ½åŒæ—¶ä¸ºçº¢è‰²</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¢è‰²èŠ‚ç‚¹æ˜¯è¢«é»‘è‰²èŠ‚ç‚¹éš”å¼€çš„ï¼›</li><li>æ¯ä¸ªèŠ‚ç‚¹ï¼Œ<strong>ä»è¯¥èŠ‚ç‚¹åˆ°è¾¾å…¶å¯è¾¾çš„å¶å­èŠ‚ç‚¹æ˜¯æ‰€æœ‰è·¯å¾„ï¼Œéƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹</strong>ã€‚</li></ol></li></ul><h5 id="4-1-ä¸ºä»€ä¹ˆçº¢é»‘æ ‘ä¸éœ€è¦é¢‘ç¹è°ƒæ•´ï¼Ÿ">4.1 ä¸ºä»€ä¹ˆçº¢é»‘æ ‘ä¸éœ€è¦é¢‘ç¹è°ƒæ•´ï¼Ÿ</h5><blockquote><p>è¯¦ç»†ç†è§£çº¢é»‘æ ‘ä¸€ç¯‡ä¸é”™çš„æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/97523789">ç™¾å›¾è¯¦è§£çº¢é»‘æ ‘ï¼Œæƒ³ä¸ç†è§£éƒ½éš¾</a></p></blockquote><p>å¹³è¡¡äºŒå‰æ ‘è¿™ç§é«˜åº¦å·®ä¸º 1 çš„è¦æ±‚å¤ªä¸¥æ ¼äº†ï¼Œå°¤å…¶æ˜¯å¯¹äºé¢‘ç¹åˆ é™¤ã€æ’å…¥çš„åœºæ™¯éå¸¸æµªè´¹æ—¶é—´ã€‚</p><p>ä½†æ˜¯ç”±äºçº¢é»‘æ ‘ï¼š</p><ul><li>å…·æœ‰äºŒå‰æ ‘æ‰€æœ‰ç‰¹ç‚¹ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹åªèƒ½æ˜¯çº¢è‰²æˆ–è€…æ˜¯é»‘è‰²ã€‚</li><li><strong>æ ¹èŠ‚ç‚¹åªèƒ½æ˜¯é»‘è‰²</strong>ï¼Œä¸”é»‘è‰²æ ¹èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ã€‚</li><li><strong>ä»»ä½•ç›¸é‚»çš„èŠ‚ç‚¹éƒ½ä¸èƒ½åŒæ—¶ä¸ºçº¢è‰²</strong>ã€‚</li><li>çº¢è‰²çš„èŠ‚ç‚¹ï¼Œå®ƒçš„å­èŠ‚ç‚¹åªèƒ½æ˜¯é»‘è‰²ã€‚</li><li>ä»ä»»ä¸€èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«<strong>ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹</strong>ã€‚</li></ul><p><strong>ä¸è¿½æ±‚æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œç»å¯¹å¹³è¡¡</strong>ï¼Œåªéœ€æ»¡è¶³ä¸Šè¿°æ¡ä»¶å³å¯ã€‚å®ƒçš„æ—‹è½¬æ¬¡æ•°å°‘ï¼Œ<strong>æ’å…¥æœ€å¤šä¸¤æ¬¡æ—‹è½¬</strong>ï¼Œ<strong>åˆ é™¤æœ€å¤šä¸‰æ¬¡æ—‹è½¬</strong>ã€‚</p><p>æ‰€ä»¥åœ¨æœç´¢ã€æ’å…¥ã€åˆ é™¤æ“ä½œè¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œçº¢é»‘æ ‘çš„æ•ˆç‡æ˜¯ä¼˜äºå¹³è¡¡äºŒå‰æ ‘çš„ã€‚</p><h4 id="5-å¿«é€Ÿæ’åºçš„è¿‡ç¨‹-ï¼Ÿ">5.å¿«é€Ÿæ’åºçš„è¿‡ç¨‹ ï¼Ÿ</h4><ul><li><p>æ‰‹æ’•ä¸€ä¸ª<a href="">äºŒåˆ†æŸ¥æ‰¾</a> å’Œå¿«æ’ï¼Ÿ</p><ul><li><p><strong>äºŒåˆ†æŸ¥æ‰¾</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// binary search</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>,right = arr.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> mid ;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;=right) <span class="comment">//*&lt;= è€Œä¸æ˜¯&lt; </span></span><br><span class="line">        &#123;</span><br><span class="line">            mid = (left+right)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(value == arr[mid])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> mid; <span class="comment">// å¦‚æœæ•°ç»„å­˜åœ¨å¾…æŸ¥æ‰¾å…ƒç´ ï¼ŒæŒ‰ç…§é€»è¾‘ä¸€å®šä¼šæ˜¯mid</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>  <span class="keyword">if</span>(value &lt; arr[mid])</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                right = mid-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>  <span class="comment">// value &gt; arr[mid]</span></span><br><span class="line">            &#123;</span><br><span class="line">                left = mid+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å¿«é€Ÿæ’åº</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] quick_sort(<span class="keyword">int</span>[] arr,<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(right&lt;=left)&#123;<span class="keyword">return</span> <span class="keyword">null</span>;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€‰æ‹©åŸºå‡†ï¼šæ•°ç»„æœ€å³æ•°å­—</span></span><br><span class="line">        <span class="comment">// *å¦‚æœé€‰æ‹©æœ€å·¦ï¼Œæ€è€ƒäº¤æ¢è¿‡ç¨‹</span></span><br><span class="line">        <span class="comment">// *partition å·¦ä¾§å§‹ç»ˆæ˜¯æ¯”pivotå°çš„æ•°</span></span><br><span class="line">        <span class="keyword">int</span> pivot = arr[right];</span><br><span class="line">        <span class="keyword">int</span> partition = left;</span><br><span class="line">        <span class="comment">// éå†åˆ†åŒºå…ƒç´ </span></span><br><span class="line">        <span class="comment">// å°äºåŸºå‡†çš„æ”¾åŸºå‡†å·¦è¾¹ï¼Œå¤§äºçš„æ”¾åŸºå‡†å³è¾¹</span></span><br><span class="line">        <span class="comment">// * ç»ˆæ­¢æ¡ä»¶ï¼ši &lt; right è€Œé right-1ï¼</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=left; i&lt; right;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]&lt;pivot) <span class="comment">// å®é™…åªäº¤æ¢å°äºåˆ°å·¦è¾¹å³å¯</span></span><br><span class="line">            &#123;</span><br><span class="line">                swap(arr,i,partition);</span><br><span class="line">                partition++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// *åŸºå‡†æ’å…¥ä½ç½®partitionä½ç½®</span></span><br><span class="line">        swap(arr,partition,right);</span><br><span class="line">        <span class="comment">//é€’å½’çš„æ’åº</span></span><br><span class="line">        quick_sort(arr,left,partition-<span class="number">1</span>);</span><br><span class="line">        quick_sort(arr,partition+<span class="number">1</span>,right);</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="6-å¸ƒéš†è¿‡æ»¤å™¨åŸç†ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Ÿå…¶å®ƒç›¸å…³åº”ç”¨ï¼Ÿ">6. å¸ƒéš†è¿‡æ»¤å™¨åŸç†ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Ÿå…¶å®ƒç›¸å…³åº”ç”¨ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/43263751">è¯¦è§£å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ï¼Œä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹</a></p></blockquote><blockquote><p>â€œå¸ƒéš†è¯´ï¼š<strong>ä¸å­˜åœ¨</strong>çš„é‚£ä¹ˆ<strong>ä¸€å®šä¸å­˜åœ¨</strong>â€</p><p>â€œå¸ƒéš†è¯´ï¼š<strong>å­˜åœ¨</strong>çš„é‚£ä¹ˆ<strong>åªæ˜¯å¯èƒ½å­˜åœ¨</strong>â€</p></blockquote><h5 id="7-1-ä»HashMapè¯´èµ·â€”å½“ä½ åˆ¤æ–­æŸä¸ªå…ƒç´ æ—¶å€™ä½ åœ¨æƒ³ä»€ä¹ˆï¼Ÿ">7.1 ä»HashMapè¯´èµ·â€”å½“ä½ åˆ¤æ–­æŸä¸ªå…ƒç´ æ—¶å€™ä½ åœ¨æƒ³ä»€ä¹ˆï¼Ÿ</h5><blockquote><p>é€šå¸¸æˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªæ•°ç»„ï¼Œæ˜¯å¦å­˜åœ¨æŸä¸ªå…ƒç´ å‘¢ï¼Ÿ</p></blockquote><p>èªæ˜çš„ä½ ä¸€å®šæƒ³åˆ°HashMapï¼šï¼ˆ1ï¼‰HashMapå°†æ•°ç»„æ‰€æœ‰å…ƒç´ ä½¿ç”¨å“ˆå¸Œå‡½æ•°ï¼Œæ˜ å°„åˆ°HashMapä¸Šï¼ˆHashMapæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰ï¼ˆ2ï¼‰ç„¶åå°±å¯ä»¥åœ¨O(1)çº§åˆ«åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚</p><p>ä½†æ˜¯è¿™ç§åšæ³•é€šå¸¸ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><strong>ä¸€æ—¦æ•°ç»„å¾ˆå¤§</strong>ï¼Œæ¯”å¦‚ä¸Šäº¿ï¼ŒHashMapå°†ä¼šå æ®éå¸¸å¤§çš„å†…å­˜ï¼›</li><li>æ•°ç»„å¾ˆå¤§ï¼Œä¸å¤§å¯èƒ½ä¸€æ¬¡æ€§èƒ½åœ¨å†…å­˜æ„å»ºHashMapï¼›</li><li>è€Œä¸”HashMapï¼Œé€šå¸¸å­˜åœ¨è´Ÿè½½å› å­ï¼Œæ˜¯ä¸èƒ½å……åˆ†åˆ©ç”¨å†…å­˜çš„ã€‚</li></ol><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹æ–¹å‘ä¼˜åŒ–ï¼š</p><ul><li><p><strong>åªå­˜å‚¨keyã€‚<strong>ä½†æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬</strong>åªè¦åˆ¤æ–­æŸä¸ªå…ƒç´ ï¼ˆkeyï¼‰æ˜¯å¦å­˜åœ¨</strong>ï¼Œ ä¸éœ€è¦å–å‡ºå¯¹åº”keyçš„valueâ€”ä¹Ÿå°±æ˜¯<strong>ä¸éœ€è¦å­˜å‚¨value</strong>ã€‚</p></li><li><p><strong>keyæ˜ å°„ä¸ºbitæ•°ç»„ç´¢å¼•ã€‚<strong>keyæ˜ å°„ä¸º<code>bit</code>æ•°ç»„ç´¢å¼•ï¼Œå³</strong>ä½å›¾å¯¹åº”ç´¢å¼•</strong>ï¼Œ  ç´¢å¼•å¯¹åº”æ•°å€¼ç”¨ <code>0/1</code> å°±å¯ä»¥æ ‡è¯†ä¸ºæ˜¯å¦å­˜åœ¨è¯¥keyã€‚</p></li></ul><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ã€ç¬¬ä¸€é˜¶æ®µä¼˜åŒ–ã€‘å¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2021/05/28/acoknPGdU3DVMEw.png" alt="img"></p><p>çœ‹æ ·å­ä¼¼ä¹æ˜¯æ»¡è¶³æˆ‘ä»¬è¦æ±‚äº†ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>åªä½¿ç”¨ä¸€ä¸ª<code>hash</code>å‡½æ•°ï¼Œ<strong>ç©ºé—´åˆ©ç”¨ç‡ä½</strong>ã€‚</li></ol><p>ä¸€ä¸ª<code>hash</code>å‡½æ•°åªèƒ½<strong>å°†keyæ•£åˆ—åˆ°ä¸€ä¸ªä½ç½®</strong> ï¼Œè™½ç„¶hashå°½é‡ä¼˜è‰¯æ˜ å°„å‡åŒ€ï¼Œä½†æ˜¯ç©ºé—´åˆ©ç”¨ç‡ä¾ç„¶ä¸ç®—é«˜ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¤šä¸ªå‡½æ•°ï¼Œå°†<strong>keyåŒæ—¶æ˜ å°„åˆ°å¤šä¸ªä½ç½®</strong>ï¼Œå³ä½¿å‘ç”Ÿå“ˆå¸Œå†²çªï¼ŒæŸä¸ªä½ç½®è¢«è¦†ç›–ï¼Œå…¶å®ƒä¾æ—§å­˜åœ¨ï¼Œ<strong>å˜ç›¸çš„é™ä½äº†å“ˆå¸Œå†²çª</strong>ã€‚</p><h5 id="7-2-æ•°æ®ç»“æ„åŠåŸç†">7.2 æ•°æ®ç»“æ„åŠåŸç†</h5><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼Œæœ€ç»ˆç»“æ„å¦‚ä¸‹ï¼šä¸€ä¸ª<code>bit</code>æ•°ç»„ï¼Œé‡‡ç”¨<strong>å¤šä¸ªhashå‡½æ•°</strong>è¿›è¡Œæ˜ å°„ã€‚</p><p><img src="https://i.loli.net/2021/05/28/zIxX9WcwUoT2lGK.png" alt="img"></p><h5 id="7-3-å¸ƒéš†å‡½æ•°ä¼˜ç¼ºç‚¹">7.3 å¸ƒéš†å‡½æ•°ä¼˜ç¼ºç‚¹</h5><ul><li><strong>ä¼˜ç‚¹</strong><ol><li><code>å­˜å‚¨/æ’å…¥/æŸ¥è¯¢</code>æ—¶é—´å¤æ‚åº¦ï¼Œéƒ½æ˜¯å¸¸æ•°çº§åˆ«<code>O(1)</code></li><li><strong>ä¿å¯†æ€§å¥½</strong>ï¼Œå› ä¸ºä¸éœ€è¦å­˜å‚¨æ•°æ®æœ¬èº«</li><li><strong>å­˜å‚¨æ•°æ®å¤§</strong>ï¼Œå¯ä»¥å­˜å‚¨éå¸¸å¤§çš„æ•°æ®æœ¬èº«</li></ol></li><li><strong>ç¼ºç‚¹</strong><ol><li>éšç€å…ƒç´ æ•°é‡å¢åŠ ï¼Œ<strong>è¯¯ç®—ç‡</strong>ä¼šå¢åŠ </li><li><strong>ä¸èƒ½åˆ é™¤</strong>å…ƒç´ ï¼Œå› ä¸ºåˆ é™¤æŸä¸ªå…ƒç´ ï¼Œè¦æŠŠå…¶å¯¹åº”æ‰€æœ‰hashå‡½æ•°æ•£åˆ—çš„ä½ç½®å¦‚A,Bï¼Œç½®ä¸º<code>0</code> ã€‚å…¶å®ƒå…ƒç´ çš„å¯èƒ½æ•£åˆ—åˆ°ä½ç½®Aï¼Œå†å»åˆ¤æ–­è¿™ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨å°±ä¼šå‡ºç°<strong>è¯¯åˆ¤</strong>ã€‚</li></ol></li></ul><h5 id="7-4-åº”ç”¨åœºæ™¯">7.4 åº”ç”¨åœºæ™¯</h5><ol><li><p><strong>è§£å†³ç¼“å­˜ç©¿é€</strong>ï¼Œé˜²æ­¢<strong>ä¸å­˜åœ¨</strong>çš„å…ƒç´ å»æŸ¥è¯¢æ•°æ®åº“</p></li><li><p><strong>é˜²æ­¢é‡å¤è¢«æ”»å‡»</strong>ï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œå°†è¯·æ±‚å‚æ•°æ”¾å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå½“ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œå…ˆåˆ¤æ–­è¯·æ±‚å‚æ•°æ˜¯å¦è¢«å¸ƒéš†è¿‡æ»¤å™¨å‘½ä¸­ã€‚å¯ä»¥æé«˜ç¼“å­˜å‘½ä¸­ç‡</p></li><li><p><strong>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦é˜…è¯»è¿‡æŸè§†é¢‘æˆ–æ–‡ç« </strong>ï¼Œ æ¯”å¦‚æŠ–éŸ³æˆ–å¤´æ¡ï¼Œå½“ç„¶ä¼šå¯¼è‡´ä¸€å®šçš„è¯¯åˆ¤ï¼Œä½†ä¸ä¼šè®©ç”¨æˆ·çœ‹åˆ°é‡å¤çš„å†…å®¹ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰_è®¡ç®—æœºåŸºç¡€_Redis</title>
      <link href="/p/31215/"/>
      <url>/p/31215/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>å…­ã€Redis</h1><h2 id="6-1-RedisåŸºæœ¬">6.1 RedisåŸºæœ¬</h2><h4 id="1-ä»€ä¹ˆæ˜¯-Redisï¼Ÿ">1.<strong>ä»€ä¹ˆæ˜¯</strong> <strong>Redisï¼Ÿ</strong></h4><p>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSD è®¸å¯ï¼‰ã€åŸºäº<u>å†…å­˜ï¼ˆè¯»å†™å¿«ï¼‰</u>ã€æ”¯æŒå¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ä½œä¸º<u>æ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶</u>ã€‚</p><ul><li>æ”¯æŒçš„æ•°æ®ç»“æ„æœ‰<strong>5</strong>ç§ï¼šå­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€å“ˆå¸Œï¼ˆhashï¼‰ã€åˆ—è¡¨ï¼ˆlistï¼‰ã€é›†åˆï¼ˆsetï¼‰ã€æœ‰åºé›†åˆï¼ˆsorted setï¼‰ã€‚</li></ul><h5 id="1-1-æœ‰MySQLä¸å°±å¤Ÿç”¨äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨Redisè¿™ç§æ–°çš„æ•°æ®åº“ï¼Ÿ">1.1 æœ‰MySQLä¸å°±å¤Ÿç”¨äº†å—ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨Redisè¿™ç§æ–°çš„æ•°æ®åº“ï¼Ÿ</h5><p>ä¸»è¦æ˜¯å› ä¸º Redis <strong>å…·å¤‡é«˜æ€§èƒ½å’Œé«˜å¹¶å‘</strong>ä¸¤ç§ç‰¹æ€§ã€‚</p><ul><li><strong>é«˜æ€§èƒ½</strong>ï¼šé™¤äº†ç¬¬ä¸€æ¬¡è¯»å–ç¡¬ç›˜æ¯”è¾ƒæ…¢ï¼Œåé¢åŠ è½½åˆ°ç¼“å­˜ï¼Œè¯»å–é€Ÿåº¦éƒ½ç›¸å…³å¿«ï¼Œæ€§èƒ½é«˜ï¼›</li><li><strong>é«˜å¹¶å‘</strong>ï¼šç›´æ¥<strong>æ“ä½œç¼“å­˜èƒ½å¤Ÿæ‰¿å—çš„å¹¶å‘è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—®æ•°æ®åº“</strong>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„<strong>éƒ¨åˆ†çƒ­ç‚¹æ•°æ®</strong>è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚</li></ul><h5 id="1-2-C-JAVA-ä¸­çš„Mapä¹Ÿæ˜¯ä¸€ç§ç¼“å­˜å‹æ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆä¸ç”¨Mapï¼Œè€Œé€‰æ‹©Redisåšç¼“å­˜ï¼Ÿ">1.2 C++ / JAVA ä¸­çš„Mapä¹Ÿæ˜¯ä¸€ç§ç¼“å­˜å‹æ•°æ®ç»“æ„ï¼Œä¸ºä»€ä¹ˆä¸ç”¨Mapï¼Œè€Œé€‰æ‹©Redisåšç¼“å­˜ï¼Ÿ</h5><p>ç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ ã€‚</p><ul><li><strong>æœ¬åœ°ç¼“å­˜ä¸å…·ä¸€è‡´æ€§</strong>ã€‚ä»¥Javaä¸ºä¾‹ ï¼Œä½¿ç”¨è‡ªå¸¦çš„mapæˆ–è€…guavaå®ç°çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯<strong>è½»é‡ä»¥åŠå¿«é€Ÿ</strong>ï¼Œç”Ÿå‘½å‘¨æœŸ<strong>éšç€jvmçš„é”€æ¯è€Œç»“æŸ</strong>ï¼Œå¹¶ä¸”åœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œ<strong>æ¯ä¸ªå®ä¾‹éƒ½éœ€è¦å„è‡ªä¿å­˜ä¸€ä»½ç¼“å­˜</strong>ï¼Œç¼“å­˜ä¸å…·æœ‰ä¸€è‡´æ€§ï¼›</li><li><strong>Redisåˆ†å¸ƒå¼ç¼“å­˜å…·æœ‰ä¸€è‡´æ€§</strong>ã€‚ ä½¿ç”¨redisæˆ–memcachedä¹‹ç±»çš„ç§°ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå„å®ä¾‹å…±ç”¨ä¸€ä»½ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å…·æœ‰ä¸€è‡´æ€§ï¼›</li><li><strong>Rediså¯ä»¥ä½¿ç”¨æ›´å¤§å†…å­˜ä½œä¸ºç¼“å­˜</strong>ã€‚ Rediså¯ä»¥ä½¿ç”¨å‡ åGå†…å­˜ä½œä¸ºç¼“å­˜ï¼ŒMapä¸è¡Œï¼Œæ¯”å¦‚JVMæœ€å¤šä½¿ç”¨å‡ ä¸ªG ï¼›</li><li><strong>Rediså¯ä»¥æŒä¹…åŒ–</strong>ã€‚ Rediså¯ä»¥å®ç°æŒä¹…åŒ–ï¼Œè€ŒMapæ˜¯å†…å­˜å¯¹è±¡ï¼Œç¨‹åºé‡å¯å°±æ²¡äº†ï¼›</li><li><strong>Rediså¯ä»¥å¤„ç†ç™¾ä¸‡çº§åˆ«å¹¶å‘ï¼›</strong></li><li><strong>Redisæœ‰ä¸°å¯Œçš„API &amp; ç¼“å­˜è¿‡æœŸç­‰æœºåˆ¶</strong>ã€‚</li></ul><h4 id="2-ã€é‡ç‚¹ã€‘redisçš„æ•°æ®ç±»å‹ï¼Œä»¥åŠæ¯ç§æ•°æ®ç±»å‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ">2. ã€é‡ç‚¹ã€‘redisçš„æ•°æ®ç±»å‹ï¼Œä»¥åŠæ¯ç§æ•°æ®ç±»å‹çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</h4><table><thead><tr><th style="text-align:center">æ•°æ®ç±»å‹</th><th style="text-align:center">ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:center">String</td><td style="text-align:center">å­˜å‚¨key-valueé”®å€¼å¯¹ï¼Œæ³¨æ„redisä¸­Stringå¯ä¿®æ”¹ã€‚ç»Ÿè®¡åœ¨çº¿äººæ•°ï¼›ä¹Ÿå¯ä»¥å­˜å‚¨<strong>è§†é¢‘ã€å›¾ç‰‡</strong>ç­‰</td></tr><tr><td style="text-align:center">hash</td><td style="text-align:center">è´­ç‰©è½¦ï¼š<code>hset [key] [field] [value]</code> å‘½ä»¤ï¼Œ å­˜æ”¾é”®å€¼å¯¹ï¼Œä¸€èˆ¬å¯ä»¥ç”¨æ¥å­˜æŸä¸ªå¯¹è±¡çš„åŸºæœ¬å±æ€§ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ç­‰</td></tr><tr><td style="text-align:center">set</td><td style="text-align:center">å…¨å±€å»é‡ï¼ŒJVMè‡ªå¸¦çš„setä¸é€‚åˆåˆ†å¸ƒå¼é›†ç¾¤æƒ…å†µ</td></tr><tr><td style="text-align:center">zset</td><td style="text-align:center">æ’è¡Œæ¦œï¼Œæ¯”å¦‚å¾®ä¿¡è¿åŠ¨æ’è¡Œæ¦œ</td></tr><tr><td style="text-align:center">list</td><td style="text-align:center">åˆ†é¡µåŠŸèƒ½ï¼ŒlrangeåšåŸºäºredisçš„åˆ†é¡µåŠŸèƒ½ï¼Œæ€§èƒ½å¾ˆå¥½ï¼›æ¨¡ä»¿ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</td></tr></tbody></table><h4 id="3-è¯´ä¸€ä¸‹-Redisæœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹-ï¼Ÿ">3.<strong>è¯´ä¸€ä¸‹</strong> <strong>Redis</strong>æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ ï¼Ÿ</h4><table><thead><tr><th style="text-align:center">ä¼˜ç‚¹</th><th style="text-align:center">ç¼ºç‚¹</th></tr></thead><tbody><tr><td style="text-align:center"><strong>é€Ÿåº¦å¿«</strong>ï¼šå› ä¸ºåœ¨å†…å­˜ä¸­</td><td style="text-align:center"><strong>å­˜å‚¨æœ‰é™</strong>ï¼šå› ä¸ºRedisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¤§å°å’Œæœºå™¨æœ¬èº«å†…å­˜æœ‰å…³</td></tr><tr><td style="text-align:center"><strong>æ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼š</strong> Stringï¼ŒListï¼ŒSetï¼ŒHashï¼ŒSorted Setç­‰</td><td style="text-align:center">å®Œæˆé‡åŒæ­¥è€—è´¹CPUèµ„æºå’Œå¸¦å®½</td></tr><tr><td style="text-align:center"><strong>æŒä¹…åŒ–å­˜å‚¨</strong>ï¼šRDBå’ŒAOF</td><td style="text-align:center"><strong>å½“Redisé‡å¯å</strong>é€šè¿‡æŠŠç¡¬ç›˜æ–‡ä»¶é‡æ–°åŠ è½½åˆ°å†…å­˜ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™ä¸ªæ—¶å€™redisåšä¸äº†å…¶å®ƒäº‹ã€‚</td></tr><tr><td style="text-align:center"><strong>é«˜å¯ç”¨</strong>ï¼šå†…ç½® <u>Redis Sentinel</u> ï¼ˆå“¨å…µï¼‰ï¼Œå®ç°ä¸»ä»æ•…éšœè‡ªåŠ¨è½¬ç§»ã€‚ å†…ç½® <u>Redis Cluster</u> ï¼Œæä¾›é›†ç¾¤æ–¹æ¡ˆã€‚</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>ä¸°å¯Œç‰¹æ€§</strong>ï¼šKeyè¿‡æœŸã€è®¡æ•°ã€åˆ†å¸ƒå¼é”</td><td style="text-align:center"></td></tr></tbody></table><h4 id="4-Redisçš„æ•°æ®ç»“æ„ï¼Ÿkeyæ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ">4. Redisçš„æ•°æ®ç»“æ„ï¼Ÿkeyæ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6862291064624152583">ã€å¤§è¯¾å ‚ã€‘Redisåº•å±‚æ•°æ®å­˜å‚¨åŸç†</a></p></blockquote><ul><li><p><strong>æ¦‚è¿°</strong></p><p>Redisåº•å±‚é‡‡ç”¨<strong>æ•°ç»„</strong>ï¼Œ keyå°±æ˜¯å¯¹åº”æ•°ç»„çš„<strong>ç´¢å¼•</strong> ï¼Œé‡‡ç”¨Hash(key)æ˜ å°„åˆ°æ•°ç»„ä¸Šã€‚è§£å†³å†²çªé‡‡ç”¨<strong>é“¾åœ°å€æ³•</strong>ã€‚</p><p>å…·ä½“å¯çœ‹å‚è€ƒä¸‹æ–‡ã€‚</p></li><li><p><strong>åº•å±‚å­˜å‚¨åŸç†</strong></p><p>redis ä¸­ä»¥<code>redisDb</code>ä½œä¸ºæ•´ä¸ªç¼“å­˜å­˜å‚¨çš„æ ¸å¿ƒï¼Œä¿å­˜ç€æˆ‘ä»¬<strong>å®¢æˆ·ç«¯éœ€è¦çš„ç¼“å­˜</strong>æ•°æ®ã€‚</p><p>å…¶ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2021/05/26/tbGEW3eV986aRkj.png" alt="RedisDBä¸»ä½“æ•°æ®ç»“æ„"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span>Â <span class="class"><span class="keyword">struct</span>Â <span class="title">redisDb</span>Â &#123;</span>Â Â Â Â </span><br><span class="line">       dictÂ *dict;Â Â Â Â        <span class="comment">// æœ€é‡è¦--å­—å…¸ç±»å‹ï¼Œä¿å­˜æ•°æ®åº“çš„é”®å€¼å¯¹</span></span><br><span class="line">       dictÂ *expires;Â Â       <span class="comment">//Â é‡è¦--å­—å…¸ç±»å‹ï¼Œä¿å­˜è¿‡æœŸçš„æ—¶é—´Â Â Â Â Â Â Â Â Â Â </span></span><br><span class="line">       dictÂ *blocking_keys;Â Â <span class="comment">// å’Œready_key å®ç°BLPOPç­‰é˜»å¡å‘½ä»¤Â Â Â Â Â Â Â Â Â </span></span><br><span class="line">       dictÂ *ready_keys;Â Â Â Â Â <span class="comment">// åŒä¸ŠÂ Â Â Â Â Â </span></span><br><span class="line">       dictÂ *watched_keys;Â Â Â <span class="comment">// å®ç°watchå‘½ä»¤ï¼Œè®°å½•æ­£åœ¨è¢«watchçš„keyÂ Â Â Â Â Â Â Â Â </span></span><br><span class="line">       <span class="keyword">int</span>Â id;Â    <span class="comment">// æ•°æ®åº“idï¼Œé»˜è®¤16ä¸ªï¼Œæ”¯æŒå•ä¸ªÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span></span><br><span class="line">       <span class="keyword">long</span>Â <span class="keyword">long</span>Â avg_ttl;Â Â   <span class="comment">/* Average TTL, just for stats */</span>Â Â Â Â Â Â </span><br><span class="line">&#125;Â redisDb;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ¥æŸ¥çœ‹ï¼Œ<strong>dict</strong> çš„ç»“æ„ã€‚</p><ul><li><p><strong>dictçš„ç»“æ„</strong></p><p><img src="https://i.loli.net/2021/05/26/kV1JhcrUwFHLznG.png" alt="image-20210526111544663"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Â Â å­—å…¸Â :Â æ¯ä¸ªå­—å…¸ä½¿ç”¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œç”¨äºå®ç°æ¸è¿›å¼Â rehashÂ */</span></span><br><span class="line"><span class="keyword">typedef</span>Â <span class="class"><span class="keyword">struct</span>Â <span class="title">dict</span>Â &#123;</span>Â Â Â Â </span><br><span class="line">      Â <span class="comment">// typeå­˜å‚¨äº†hashå‡½æ•°ï¼Œkeyå’Œvalueçš„å¤åˆ¶å‡½æ•°ç­‰ï¼Œæ¯”è¾ƒä»¥åŠé”€æ¯å‡½æ•°</span></span><br><span class="line">   Â Â Â dictTypeÂ *type;Â Â Â </span><br><span class="line">      <span class="comment">// privdataä¿å­˜ä¸€äº›ç§æœ‰æ•°æ®ï¼Œå†³å®šäº†*typeä¿å­˜çš„å‡½æ•°ï¼Œå®ç°äº†ã€å¤šæ€ã€‘</span></span><br><span class="line">    Â Â <span class="keyword">void</span>Â *privdata;Â Â Â Â Â </span><br><span class="line">      dicthtÂ ht[<span class="number">2</span>];Â Â Â Â  Â <span class="comment">//Â å“ˆå¸Œè¡¨ï¼ˆ2Â ä¸ªï¼‰,Â Â æ­£å¸¸ä½¿ç”¨ht[0],rehashå°±ä¼šæ‰©å®¹ä½¿ç”¨ht[1]</span></span><br><span class="line"> Â Â Â  Â <span class="keyword">int</span>Â rehashidx;Â Â Â Â  <span class="comment">//Â è®°å½•Â rehashÂ è¿›åº¦çš„æ ‡å¿—ï¼Œå€¼ä¸ºÂ -1Â è¡¨ç¤ºÂ rehashÂ æœªè¿›</span></span><br><span class="line">      <span class="keyword">int</span>Â iterators;    <span class="comment">//Â å½“å‰æ­£åœ¨è¿ä½œçš„å®‰å…¨è¿­ä»£å™¨æ•°é‡</span></span><br><span class="line">&#125;Â dict;  </span><br></pre></td></tr></table></figure><p>ä¸Šè¿°<code>dictht</code>å°±æ˜¯ä¸ªhashè¡¨ï¼ŒåŒ…å«ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span>Â <span class="class"><span class="keyword">struct</span>Â <span class="title">dictht</span>Â &#123;</span>Â Â Â Â </span><br><span class="line">   <span class="comment">//Â å“ˆå¸Œè¡¨èŠ‚ç‚¹æŒ‡é’ˆæ•°ç»„ï¼ˆä¿—ç§°æ¡¶ï¼Œbucketï¼‰Â Â Â Â </span></span><br><span class="line">   dictEntryÂ **table;Â Â Â Â </span><br><span class="line">   <span class="comment">//Â æŒ‡é’ˆæ•°ç»„çš„å¤§å°Â Â Â </span></span><br><span class="line">   <span class="keyword">unsigned</span>Â <span class="keyword">long</span>Â size;Â Â Â Â </span><br><span class="line">   <span class="comment">//Â æŒ‡é’ˆæ•°ç»„çš„é•¿åº¦æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼ï¼Œå…¶å®æ°¸è¿œéƒ½æ˜¯size-1Â Â Â Â </span></span><br><span class="line">   <span class="keyword">unsigned</span>Â <span class="keyword">long</span>Â sizemask;Â Â Â </span><br><span class="line">   <span class="comment">//Â å“ˆå¸Œè¡¨ç°æœ‰çš„èŠ‚ç‚¹æ•°é‡Â Â Â </span></span><br><span class="line">   <span class="keyword">unsigned</span>Â <span class="keyword">long</span>Â used;</span><br><span class="line">&#125;Â dictht;</span><br></pre></td></tr></table></figure><ul><li><p><strong>dictEntry æŒ‡é’ˆæ•°ç»„ï¼ˆtable</strong>ï¼‰ã€‚key çš„å“ˆå¸Œå€¼æœ€ç»ˆæ˜ å°„åˆ°è¿™ä¸ªæ•°ç»„çš„æŸä¸ªä½ç½®ä¸Šï¼ˆå¯¹åº”ä¸€ä¸ª bucketï¼‰ã€‚å¦‚æœå¤šä¸ª key æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®ï¼Œå°±å‘ç”Ÿäº†å†²çªï¼Œé‚£ä¹ˆå°±æ‹‰å‡ºä¸€ä¸ª dictEntry é“¾è¡¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å“ˆå¸Œè¡¨èŠ‚ç‚¹dictEntry</span></span><br><span class="line"><span class="keyword">typedef</span>Â <span class="class"><span class="keyword">struct</span>Â <span class="title">dictEntry</span>Â &#123;</span>Â Â Â Â Â </span><br><span class="line">    <span class="keyword">void</span>Â *key;Â Â Â Â <span class="comment">// redisçš„é”®</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span>Â &#123;</span>Â Â Â Â Â Â Â Â </span><br><span class="line">    <span class="keyword">void</span>Â *val;Â Â Â  <span class="comment">// å­˜å‚¨äº†å¯¹åº”string/set/list/hash/zsetçš„æ•°æ® Â Â Â Â </span></span><br><span class="line">    <span class="keyword">uint64_t</span>Â u64;Â Â Â Â Â Â Â Â </span><br><span class="line">    <span class="keyword">int64_t</span>Â s64;Â </span><br><span class="line">    &#125;Â v;Â Â Â Â </span><br><span class="line">    <span class="class"><span class="keyword">struct</span>Â <span class="title">dictEntry</span>Â *<span class="title">next</span>;</span>  <span class="comment">//é“¾è¡¨åç»­èŠ‚ç‚¹</span></span><br><span class="line">&#125;dictEntry;</span><br></pre></td></tr></table></figure></li><li><p><em><strong>size</strong></em>ï¼šæ ‡è¯† dictEntry æŒ‡é’ˆæ•°ç»„çš„é•¿åº¦ã€‚å®ƒæ€»æ˜¯ 2 çš„æŒ‡æ•°æ¬¡å¹‚ã€‚</p></li></ul><p>ä¸Šé¢<code>dictEntry</code> çš„<strong>value</strong> æœ€ç»ˆæŒ‡å‘äº†<code>redisObject</code>å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿä¸‹å…¶ç»“æ„ã€‚</p></li><li><p><strong>Redis Object</strong></p><p><img src="https://i.loli.net/2021/05/26/kvhZQdtOuJjE6gY.png" alt="image-20210526112251563"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span>Â <span class="class"><span class="keyword">struct</span>Â <span class="title">redisObject</span>Â &#123;</span>Â Â Â Â </span><br><span class="line">     <span class="keyword">unsigned</span>Â type:<span class="number">4</span>;Â Â Â   <span class="comment">//Â ç±»å‹Â ï¼Œæ¯”å¦‚stringï¼Œsetç­‰ï¼Œæ‰èƒ½ç¡®å®šæ˜¯å“ªç§æ•°æ®ç»“æ„ä½¿ç”¨ä»€ä¹ˆAPIæ“ä½œÂ Â Â </span></span><br><span class="line">     <span class="keyword">unsigned</span>Â encoding:<span class="number">4</span>;Â <span class="comment">// encoding è¡¨ç¤º ptr æŒ‡å‘çš„å…·ä½“æ•°æ®ç»“æ„,è¿™ä¸ªå¯¹è±¡ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å®ç°Â Â Â </span></span><br><span class="line"> Â Â Â Â <span class="keyword">unsigned</span>Â lru:REDIS_LRU_BITS;Â  <span class="comment">//Â å¯¹è±¡æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶</span></span><br><span class="line">     <span class="keyword">int</span>Â refcount;Â Â Â Â <span class="comment">//Â å¼•ç”¨è®¡æ•°Â Â Â    Â Â Â </span></span><br><span class="line">     <span class="keyword">void</span>Â *ptr;  <span class="comment">//Â æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„çš„æŒ‡é’ˆÂ </span></span><br><span class="line">Â robj;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="4-1-Stringã€listã€hashã€setã€zsetçš„åº•å±‚ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ">4.1 Stringã€listã€hashã€setã€zsetçš„åº•å±‚ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://i6448038.github.io/2019/12/01/redis-data-struct/">å›¾è§£redisäº”ç§æ•°æ®ç»“æ„åº•å±‚å®ç°(åŠ¨å›¾å“¦)</a></p><p>ç‰ˆæœ¬ï¼šredis 3.0.6ä¸­ç‰ˆæœ¬å„ç§æ•°æ®ç»“æ„çš„å®ç°</p></blockquote><ol><li><p><strong>String</strong></p><ul><li>embstrå’Œrawéƒ½æ˜¯ç”±SDSåŠ¨æ€å­—ç¬¦ä¸²æ„æˆçš„ ï¼Œåº•å±‚ç»“æ„åº”è¯¥éƒ½æ˜¯<strong>charæ•°ç»„</strong>å§ ï¼›</li><li>int ï¼Œå°±æ˜¯æŒ‡<strong>intç±»å‹</strong>ã€‚</li></ul><p><img src="https://i.loli.net/2021/05/26/h4mzJvU9I5BEj1o.png" alt="img"></p></li><li><p><strong>list</strong></p><p><img src="https://i.loli.net/2021/05/26/QSgDl39yIA5uXN2.png" alt="img"></p></li><li><p><strong>hash</strong></p><p><img src="https://i.loli.net/2021/05/26/9X8gPmG6MeDb4V3.png" alt="img"></p></li><li><p><strong>set</strong></p><p>intsetæ˜¯é›†åˆé”®çš„åº•å±‚å®ç°æ–¹å¼ä¹‹ä¸€ï¼Œæ˜¯intç±»å‹æ•°ç»„ã€‚</p><p><img src="https://i.loli.net/2021/05/26/KXD9yHLewkIFGha.png" alt="img"></p><img src="https://i.loli.net/2021/05/26/rn3BfhLOT8dsRCH.png" alt="img" style="zoom:67%;" /></li><li><p><strong>zest</strong></p><p><img src="https://i6448038.github.io/img/redis-data-struct/object_zset.png" alt="img"></p></li></ol><h5 id="4-2-è®²è®²redisçš„hashè¡¨æ‰©å®¹æ–¹å¼ï¼Ÿ">4.2 è®²è®²redisçš„hashè¡¨æ‰©å®¹æ–¹å¼ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://luoming1224.github.io/2018/11/12/%5Bredis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5Dredis%E6%B8%90%E8%BF%9B%E5%BC%8Frehash%E6%9C%BA%E5%88%B6/">[rediså­¦ä¹ ç¬”è®°]redisæ¸è¿›å¼rehashæœºåˆ¶</a></p></blockquote><ul><li><p><strong>æ‰©å®¹æ¡ä»¶</strong></p><ul><li>æœåŠ¡å™¨ç›®å‰æ²¡æœ‰åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œ å¹¶ä¸”å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¤§äºç­‰äº 1 ï¼ˆ<strong>ä¿å­˜çš„keyè¶…è¿‡å“ˆå¸Œè¡¨å¤§å°</strong>ï¼‰ï¼›</li><li>æœåŠ¡å™¨ç›®å‰æ­£åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œ å¹¶ä¸”å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¤§äºç­‰äº 5 ï¼›</li></ul></li><li><p><strong>æ¸è¿›å¼rehash</strong></p><ol><li><p>æ–°å»ºä¸€ä¸ªå“ˆå¸Œè¡¨å¤§å°ï¼Œä¸º<code>2^N</code> æ¬¡æ–¹ï¼Œå¹¶åˆ†é…å†…å­˜ï¼Œæ­¤æ—¶å­—å…¸<strong>åŒæ—¶æŒæœ‰ï¼šht[0] å’Œ ht[1] ä¸¤ä¸ªå“ˆå¸Œè¡¨</strong></p><blockquote><p>åŒhashmapï¼šå“ˆå¸Œè¡¨æ©ç sizemaskä¸ºsize-1ï¼Œå½“sizeæ»¡è¶³2çš„næ¬¡æ–¹æ—¶ï¼Œè®¡ç®—æ¯ä¸ªkeyçš„ç´¢å¼•å€¼æ—¶åªéœ€è¦ç”¨keyçš„hashå€¼ä¸æ©ç sizemaskè¿›è¡Œä½ä¸æ“ä½œï¼Œæ›¿ä»£æ±‚ä½™æ“ä½œï¼Œè®¡ç®—æ›´å¿«ã€‚</p></blockquote></li><li><p>å“ˆå¸Œè¡¨èµ‹å€¼ç»™å­—å…¸çš„ht[1]ï¼Œç„¶åå°†rehashidxèµ‹å€¼ä¸º0ï¼Œè¡¨ç¤ºrehashå·¥ä½œå¼€å§‹</p><blockquote><p>rehashidxä¹Ÿæ ‡è¯†äº†ï¼Œå½“å‰rehash<strong>è¿›è¡Œåˆ°äº†å“ªä¸ªæ§½</strong></p></blockquote></li><li><p>åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œï¼šæ¯æ¬¡å¯¹å­—å…¸æ‰§è¡Œ<strong>æ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œ</strong>æ—¶ï¼Œ ç¨‹åºé™¤äº†æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œä»¥å¤–ï¼Œ è¿˜ä¼šé¡ºå¸¦å°† <strong>ht[0] å“ˆå¸Œè¡¨åœ¨ rehashidx ç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ rehash åˆ° ht[1]</strong> ã€‚</p><p>å½“ rehash å·¥ä½œå®Œæˆä¹‹åï¼Œ ç¨‹åºå°† rehashidx å±æ€§çš„å€¼**+1**</p></li><li><p>éšç€å­—å…¸æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œ æœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œ ht[0] çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ä¼šè¢« rehash è‡³ ht[1] ã€‚æ­¤æ—¶<code>rehashidx=-1</code>ï¼Œè¡¨ç¤ºrehashå®Œæˆã€‚</p></li></ol><p>é‡‡å–åˆ†è€Œæ²»ä¹‹çš„æ–¹å¼ï¼Œ å°† rehash é”®å€¼å¯¹æ‰€éœ€çš„è®¡ç®—å·¥ä½œ<strong>å‡æ‘Š</strong>åˆ°å¯¹å­—å…¸çš„æ¯ä¸ªæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾å’Œæ›´æ–°æ“ä½œä¸Šï¼Œ ä»è€Œ<strong>é¿å…äº†é›†ä¸­å¼ rehash è€Œå¸¦æ¥çš„åºå¤§è®¡ç®—é‡</strong>ã€‚</p></li><li><p><strong>æ¸è¿›å¼rehasä¼˜ç¼ºç‚¹</strong></p><ul><li>ä¼˜ç‚¹ï¼šé¿å…redisé˜»å¡</li><li>ç¼ºç‚¹ï¼šrehashéœ€è¦åˆ†é…ä¸€ä¸ªæ–°çš„hashè¡¨ï¼Œä¼šä½¿å¾—<strong>å†…å­˜çˆ†å¢ï¼Œä½¿å¾—å¤§é‡keyè¢«é©±é€</strong></li></ul></li></ul><h5 id="4-3-rehashè¿‡ç¨‹ä¸­å¢åˆ æŸ¥æ”¹æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ">4.3 rehashè¿‡ç¨‹ä¸­å¢åˆ æŸ¥æ”¹æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ</h5><ul><li><p><strong>å¢åŠ </strong>ï¼š æ–°æ·»åŠ åˆ°å­—å…¸çš„é”®å€¼å¯¹ä¸€å¾‹ä¼šè¢«ä¿å­˜åˆ° ht[1] é‡Œé¢ï¼Œ è€Œ ht[0] åˆ™ä¸å†è¿›è¡Œä»»ä½•æ·»åŠ æ“ä½œ</p></li><li><p><strong>åˆ é™¤ï¼ˆdeleteï¼‰ã€æŸ¥æ‰¾ï¼ˆfindï¼‰ã€æ›´æ–°ï¼ˆupdateï¼‰ç­‰</strong>ï¼š åŒæ—¶åœ¨ht[0] &amp; ht[1]ä¸¤ä¸ªè¡¨è¿›è¡Œã€‚</p><blockquote><p>æ¯”å¦‚ï¼šè¦åœ¨å­—å…¸é‡Œé¢æŸ¥æ‰¾ä¸€ä¸ªé”®çš„è¯ï¼Œ ç¨‹åºä¼šå…ˆåœ¨ ht[0] é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œ å¦‚æœæ²¡æ‰¾åˆ°çš„è¯ï¼Œ å°±ä¼šç»§ç»­åˆ° ht[1] é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ã€‚</p></blockquote></li></ul><h4 id="5-è¯´è¯´Redisæœ‰åºé›†åˆzsetçš„åº•å±‚ç»“æ„ï¼Ÿ">5. è¯´è¯´Redisæœ‰åºé›†åˆzsetçš„åº•å±‚ç»“æ„ï¼Ÿ</h4><p>zsetåº•å±‚çš„å­˜å‚¨ç»“æ„åŒ…æ‹¬<u>ziplist</u>æˆ–<u> skiplist &amp; dic</u> ï¼Œ<strong>å½“æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ä½¿ç”¨ziplist</strong>ï¼š</p><ul><li>æœ‰åºé›†åˆä¿å­˜çš„å…ƒç´ æ•°é‡å°äº128ä¸ª</li><li>æœ‰åºé›†åˆä¿å­˜çš„æ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚</li></ul><p>å…¶ä½™æƒ…å†µç”¨skiplistã€‚</p><ul><li><p><strong><a href="https://www.cnblogs.com/exceptioneye/p/7040815.html">ä»€ä¹ˆæ˜¯ziplistï¼Ÿ</a></strong></p><p>ziplistæ˜¯ä¸€ä¸ªç»è¿‡ç‰¹æ®Šç¼–ç çš„<u>åŒå‘é“¾è¡¨</u>ï¼Œä»¥O(1)çš„æ—¶é—´å¤æ‚åº¦åœ¨è¡¨çš„ä¸¤ç«¯æä¾›pushå’Œpopæ“ä½œã€‚</p><p>ziplistå°†è¡¨ä¸­æ¯ä¸€é¡¹å­˜æ”¾åœ¨å‰åè¿ç»­çš„åœ°å€ç©ºé—´å†…ï¼Œä¸€ä¸ªziplistæ•´ä½“å ç”¨ä¸€å¤§å—å†…å­˜ã€‚</p><ul><li><p><strong>ä½¿ç”¨åŸå› </strong>ï¼šä¸€ä¸ªæ™®é€šçš„<u>åŒå‘é“¾è¡¨</u>ï¼Œé“¾è¡¨ä¸­æ¯ä¸€é¡¹éƒ½<u>å ç”¨ç‹¬ç«‹çš„ä¸€å—å†…å­˜</u>ï¼Œå„é¡¹ä¹‹é—´ç”¨åœ°å€æŒ‡é’ˆï¼ˆæˆ–å¼•ç”¨ï¼‰è¿æ¥èµ·æ¥ï¼›è¿™ç§æ–¹å¼ä¼šå¸¦æ¥å¤§é‡çš„<strong>å†…å­˜ç¢ç‰‡</strong>ï¼Œè€Œä¸”<strong>åœ°å€æŒ‡é’ˆä¹Ÿä¼šå ç”¨é¢å¤–çš„å†…å­˜</strong>ã€‚</p></li><li><p><strong>å…·ä½“ç»“æ„</strong></p><p><img src="https://i.loli.net/2021/05/04/zYwG2PtCZq84hgV.jpg" alt="img"></p><ul><li>entryï¼šè¡¨ç¤ºçœŸæ­£å­˜æ”¾æ•°æ®çš„æ•°æ®é¡¹ï¼Œé•¿åº¦ä¸å®šã€‚ä¸€ä¸ªæ•°æ®é¡¹ï¼ˆentryï¼‰ä¹Ÿæœ‰å®ƒè‡ªå·±çš„å†…éƒ¨ç»“æ„ã€‚</li></ul></li></ul></li><li><p><a href="https://segmentfault.com/a/1190000037473381"><strong>ä»€ä¹ˆæ˜¯skiplist ?</strong></a></p><p>è·³è¡¨æ˜¯åœ¨å•é“¾è¡¨ä¸Šå®ç°å¤šçº§ç´¢å¼•ï¼Œ<strong>å¯ä»¥å®ç° <u>äºŒåˆ†æŸ¥æ‰¾</u> çš„æœ‰åºé“¾è¡¨</strong>ã€‚</p><blockquote><p>è·³è¡¨æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦è·Ÿçº¢é»‘æ ‘éƒ½æ˜¯ä¸€æ ·é‡çº§çš„ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(logn)ã€‚</p></blockquote><ul><li><p>ä¸»è¦å½¢å¼</p><p>åœ¨å•é“¾è¡¨ä¸Šè¿›è¡Œå¤šçº§ç´¢å¼•ã€‚</p><p><img src="https://i.loli.net/2021/05/28/Rc6tAuOmELHz5nN.png" alt="image-20210528143426041"></p></li><li><p>æ„å»ºè¿‡ç¨‹</p><blockquote><p>ä¸Šé¢é“¾è¡¨æ˜¯å¦‚ä½•æ„å»ºçš„å‘¢ï¼Œè¯·è§ä¸‹å›¾ã€‚</p></blockquote><p>âš ï¸ skiplistä¸ºäº†é¿å…ä¸Šä¸‹ä¸¤å±‚å‡ºç°<strong>ä¸¥æ ¼1:2</strong>æ•°é‡å¯¹åº”å…³ç³»åï¼Œæ–°æ’å…¥èŠ‚ç‚¹ä¼šæ‰“ä¹±è¿™ç§å…³ç³»ï¼Œè€Œéœ€è¦<strong>æŠŠæ–°æ’å…¥èŠ‚ç‚¹åæ‰€ä»¥èŠ‚ç‚¹éƒ½è¿›è¡Œè°ƒæ•´</strong>ã€‚</p><p><strong>å®ƒä¸è¦æ±‚ä¸Šä¸‹ç›¸é‚»ä¸¤å±‚é“¾è¡¨ä¹‹é—´çš„èŠ‚ç‚¹ä¸ªæ•°æœ‰ä¸¥æ ¼çš„å¯¹åº”å…³ç³»ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªèŠ‚ç‚¹éšæœºå‡ºä¸€ä¸ªå±‚æ•°(level)</strong>ã€‚</p><img src="https://i.loli.net/2021/05/28/sEy7B6gUHuIfbd3.png" alt="preview" style="zoom: 67%;" /></li><li><p>æŸ¥æ‰¾è¿‡ç¨‹</p><blockquote><p>zset : <code>&lt;key&gt; &lt;score&gt; &lt;member&gt;</code></p></blockquote><p>åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰åŒºåˆ†memberå’Œscoreï¼Œä½†æ˜¯å®é™…ä¸Šé“¾è¡¨æ˜¯<strong>æŒ‰scoreè¿›è¡Œæ’åºï¼ŒæŸ¥æ‰¾ä¹Ÿæ˜¯åœ¨æ¯”è¾ƒscore</strong>ã€‚</p><blockquote><p>ä»¥æŸ¥æ‰¾ å’Œ æ’å…¥23ä¸ºä¾‹ã€‚</p></blockquote><ol><li>ä»æœ€é«˜å±‚ï¼ˆç¬¬4ï¼‰å±‚å¼€å§‹æŸ¥æ‰¾ï¼Œå› ä¸º<code>7&lt;23</code> ,æœ¬åº”è¯¥ç»§ç»­å¾€åæŸ¥æ‰¾ï¼Œä½†æ˜¯åç»§èŠ‚ç‚¹ä¸ºnullï¼Œæ‰€ä»¥å¾€ä¸‹ä¸€å±‚è¿›è¡ŒæŸ¥æ‰¾</li><li>æ­¤æ—¶ç¬¬3å±‚ï¼Œæ»¡è¶³<code>7&lt;23&lt;37</code> ï¼Œç»§ç»­å¾€ä¸‹ä¸€å±‚ç»§ç»­æŸ¥æ‰¾</li><li>æ­¤æ—¶ç¬¬2å±‚ï¼Œ<code>7&lt;23 &amp; 19&lt;23</code> ï¼Œå¾€ä¸‹ç¬¬äºŒå±‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆ19ï¼‰æŸ¥æ‰¾ï¼›æ­¤æ—¶æ»¡è¶³<code>19&lt;23&lt;37</code> ï¼Œç»§ç»­å¾€ä¸‹ä¸€å±‚</li><li>æ­¤æ—¶ç¬¬1å±‚ï¼Œä¸€ç›´å¾€åéå†åˆ°22ï¼Œå‘ç°<code>22&lt;23&lt;26</code> ï¼š<ul><li>å¦‚æœæ­¤æ—¶æ˜¯<strong>æŸ¥è¯¢23</strong>ï¼šè¿”å›nullï¼Œä¸å­˜åœ¨</li><li>æ­¤æ—¶æ˜¯<strong>æ’å…¥23</strong>ï¼šç”Ÿæˆæ–°èŠ‚ç‚¹ &amp; éšæœºç”Ÿæˆå±‚æ•°ï¼Œï¼ˆ1ï¼‰å°†æ–°èŠ‚ç‚¹å„å±‚æŒ‡é’ˆæŒ‡å‘å¯¹åº”å±‚çš„<strong>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</strong>ï¼ˆä¸å­˜åœ¨åˆ™æŒ‡å‘nullï¼‰ï¼ˆ2ï¼‰å°†æ–°èŠ‚ç‚¹èŠ‚ç‚¹å„å±‚<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹</strong>å¯¹åº”å±‚æ•°çš„æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹</li></ul></li></ol></li></ul></li></ul><h5 id="5-1-Redisä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘">5.1 Redisä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘</h5><blockquote><p>å‚è€ƒ ï¼š <a href="https://www.zhihu.com/question/20202931">çŸ¥ä¹å›ç­”</a></p></blockquote><p>è™½ç„¶è·³è¡¨æ“ä½œ<strong>æ—¶é—´å¤æ‚åº¦å’Œçº¢é»‘æ ‘ç›¸åŒ</strong> ï¼Œä½†æ˜¯ï¼š</p><ol><li><p><strong>å®ç°ç®€å•</strong>ï¼šè·³è¡¨ä»£ç å®ç°æ›´æ˜“è¯»</p></li><li><p><strong>åŒºé—´æŸ¥æ‰¾</strong>ï¼šè·³è¡¨åŒºé—´æŸ¥æ‰¾æ•ˆç‡æ›´é«˜</p></li></ol><h4 id="6-RedisæŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿä»¥åŠæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">6. <strong>RedisæŒä¹…åŒ–æ–¹å¼æœ‰å“ªäº›ï¼Ÿä»¥åŠæœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</h4><p><code>Redis</code> æä¾›ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ <code>RDB</code> å’Œ <code>AOF</code> æœºåˆ¶ã€‚</p><ul><li><p><strong>å„è‡ªä¼˜ç‚¹</strong></p><table><thead><tr><th style="text-align:center">RDB</th><th style="text-align:center">AOF</th></tr></thead><tbody><tr><td style="text-align:center">ã€<strong>æ–¹ä¾¿</strong>ã€‘åªæœ‰ä¸€ä¸ªæ–‡ä»¶ <code>dump.rdb</code> ï¼Œæ–¹ä¾¿æŒä¹…åŒ–</td><td style="text-align:center">ã€<strong>æ•°æ®å®‰å…¨</strong>ã€‘ AOF æŒä¹…åŒ–æœ‰ <code>always</code>ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å‘½ä»¤æ“ä½œå°±è®°å½•åˆ° AOF æ–‡ä»¶ä¸­ä¸€æ¬¡ã€‚</td></tr><tr><td style="text-align:center">ã€<strong>å®¹ç¾æ€§å¥½</strong>ã€‘ä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">ã€<strong>æ€§èƒ½</strong>ã€‘æœ€å¤§åŒ–ï¼Œfork å­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥æ˜¯ IO æœ€å¤§åŒ–</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">ã€<strong>å¯åŠ¨æ•ˆç‡é«˜</strong>ã€‘ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯” AOF çš„<strong>å¯åŠ¨æ•ˆç‡</strong>æ›´é«˜</td><td style="text-align:center"></td></tr></tbody></table></li><li><p><strong>å„è‡ªç¼ºç‚¹</strong></p><table><thead><tr><th style="text-align:center">RDB</th><th style="text-align:center">AOF</th></tr></thead><tbody><tr><td style="text-align:center">ã€<strong>å®‰å…¨æ€§ä½</strong>ã€‘ <code>RDB</code> æ˜¯é—´éš”ä¸€æ®µæ—¶é—´è¿›è¡ŒæŒä¹…åŒ–</td><td style="text-align:center">ã€<strong>å¯åŠ¨æ•ˆç‡ä½</strong>ã€‘æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯” RDB å¯åŠ¨æ•ˆç‡ä½ã€‚</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">ã€<strong>æ¢å¤æ…¢</strong>ã€‘<code>AOF</code> æ–‡ä»¶æ¯” <code>RDB</code> æ–‡ä»¶å¤§ï¼Œä¸”æ¢å¤é€Ÿåº¦æ…¢ã€‚</td></tr></tbody></table></li></ul><h5 id="6-1-AOF-é‡å†™äº†è§£å—ï¼Ÿ">6.1 AOF é‡å†™äº†è§£å—ï¼Ÿ</h5><p>AOFé‡å†™å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ï¼Œè¿™ä¸ªæ–°çš„AOFæ–‡ä»¶å’ŒåŸæœ‰çš„AOFæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€æ ·ï¼Œ<strong>ä½†ä½“ç§¯æ›´å°</strong>ã€‚</p><blockquote><p>AOFé‡å†™æ˜¯ä¸€ä¸ªæœ‰æ­§ä¹‰çš„åå­—ï¼Œè¯¥åŠŸèƒ½æ˜¯é€šè¿‡è¯»å–æ•°æ®åº“ä¸­çš„<strong>é”®å€¼</strong>å¯¹æ¥å®ç°çš„ï¼Œç¨‹åº<strong>æ— é¡»å¯¹ç°æœ‰AOFæ–‡ä»¶è¿›è¡Œ</strong>ä»»ä¼ºè¯»å…¥ã€åˆ†ææˆ–è€…å†™å…¥æ“ä½œã€‚</p></blockquote><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åœ¨æ‰§è¡Œ <code>BGREWRITEAOF</code> å‘½ä»¤ï¼Œå¼€å§‹é‡å†™ï¼›</li><li>Redis æœåŠ¡å™¨ä¼šç»´æŠ¤ä¸€ä¸ª AOF <strong>é‡å†™ç¼“å†²åŒº</strong>ï¼Œè¯¥ç¼“å†²åŒºä¼šåœ¨å­è¿›ç¨‹åˆ›å»ºæ–°AOFæ–‡ä»¶æœŸé—´ï¼Œè®°å½•æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼›</li><li>å½“å­è¿›ç¨‹å®Œæˆåˆ›å»ºæ–°AOFæ–‡ä»¶çš„å·¥ä½œä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå°†é‡å†™<strong>ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–°AOFæ–‡ä»¶çš„æœ«å°¾</strong> ï¼›</li><li>æœ€åï¼ŒæœåŠ¡å™¨ç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ—§çš„ AOFæ–‡ä»¶ï¼Œä»¥æ­¤æ¥å®ŒæˆAOFæ–‡ä»¶é‡å†™æ“ä½œã€‚</li></ol><h4 id="7-RedisæŒä¹…åŒ–æœ‰ä¸¤ç§ï¼Œé‚£åº”è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ">7. RedisæŒä¹…åŒ–æœ‰ä¸¤ç§ï¼Œé‚£åº”è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/39412293">https://zhuanlan.zhihu.com/p/39412293</a></p></blockquote><ol><li><strong>å¦‚æœRedisä¸­çš„æ•°æ®å®Œå…¨ä¸¢å¼ƒä¹Ÿæ²¡æœ‰å…³ç³»</strong>ï¼ˆå¦‚Rediså®Œå…¨ç”¨ä½œDBå±‚æ•°æ®çš„cacheï¼‰ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯å•æœºï¼Œè¿˜æ˜¯ä¸»ä»æ¶æ„ï¼Œéƒ½å¯ä»¥ä¸è¿›è¡Œä»»ä½•æŒä¹…åŒ–ï¼›</li><li><strong>å•æœºç¯å¢ƒ</strong>ï¼š å¦‚æœå¯ä»¥æ¥å—åå‡ åˆ†é’Ÿæˆ–æ›´å¤šçš„æ•°æ®ä¸¢å¤±ï¼Œé€‰æ‹©RDBå¯¹Redisçš„æ€§èƒ½æ›´åŠ æœ‰åˆ©ï¼›å¦‚æœåªèƒ½æ¥å—ç§’çº§åˆ«çš„æ•°æ®ä¸¢å¤±ï¼Œåº”è¯¥é€‰æ‹©AOFï¼›</li><li><strong>ä¸»ä»æ¶æ„</strong>ï¼š<ul><li><strong>master</strong>ï¼šå®Œå…¨å…³é—­æŒä¹…åŒ–ï¼ˆåŒ…æ‹¬RDBå’ŒAOFï¼‰ï¼Œè¿™æ ·å¯ä»¥è®©masterçš„æ€§èƒ½è¾¾åˆ°æœ€å¥½ï¼›</li><li><strong>slaveï¼šå…³é—­RDBï¼Œå¼€å¯AOF</strong>ï¼ˆå¦‚æœå¯¹æ•°æ®å®‰å…¨è¦æ±‚ä¸é«˜ï¼Œå¼€å¯RDBå…³é—­AOFä¹Ÿå¯ä»¥ï¼‰ï¼Œå¹¶å®šæ—¶å¯¹æŒä¹…åŒ–æ–‡ä»¶è¿›è¡Œå¤‡ä»½ï¼ˆå¦‚å¤‡ä»½åˆ°å…¶ä»–æ–‡ä»¶å¤¹ï¼Œå¹¶æ ‡è®°å¥½å¤‡ä»½çš„æ—¶é—´ï¼‰ï¼›ç„¶åå…³é—­AOFçš„è‡ªåŠ¨é‡å†™ï¼Œç„¶åæ·»åŠ å®šæ—¶ä»»åŠ¡ï¼Œåœ¨æ¯å¤©Redisé—²æ—¶ï¼ˆå¦‚å‡Œæ™¨12ç‚¹ï¼‰è°ƒbgrewriteaofã€‚</li></ul></li></ol><h4 id="8-ï¼ˆ-u-ä¸å¤ªç†è§£-u-ï¼‰pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨-pipelineï¼Ÿ">8. ï¼ˆ<u>ä¸å¤ªç†è§£</u>ï¼‰pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ pipelineï¼Ÿ</h4><ul><li><p>ä½¿ç”¨ pipelineï¼ˆç®¡é“ï¼‰çš„å¥½å¤„åœ¨äºå¯ä»¥å°†å¤šæ¬¡ I/O å¾€è¿”çš„æ—¶é—´ç¼©çŸ­ä¸ºä¸€æ¬¡ï¼Œä½†æ˜¯è¦æ±‚ç®¡é“ä¸­æ‰§è¡Œçš„æŒ‡ä»¤é—´æ²¡æœ‰å› æœå…³ç³»ï¼›</p></li><li><p>ç”¨ pipeline çš„åŸå› åœ¨äºå¯ä»¥å®ç°è¯·æ±‚/å“åº”æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œå½“å®¢æˆ·ç«¯å°šæœªè¯»å–æ—§å“åº”æ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥å¤„ç†æ–°çš„è¯·æ±‚ã€‚å¦‚æœå®¢æˆ·ç«¯å­˜åœ¨å¤šä¸ªå‘½ä»¤å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯æ— éœ€ç­‰å¾…æœåŠ¡ç«¯çš„æ¯æ¬¡å“åº”æ‰èƒ½æ‰§è¡Œä¸‹ä¸ªå‘½ä»¤ï¼Œåªéœ€æœ€åä¸€æ­¥ä»æœåŠ¡ç«¯è¯»å–å›å¤å³å¯ã€‚</p></li></ul><h4 id="9-æ€ä¹ˆä½¿ç”¨-Rediså®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ-å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿ">9.<strong>æ€ä¹ˆä½¿ç”¨</strong> Rediså®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿ</h4><ul><li><p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šä¸€èˆ¬ä½¿ç”¨ <code>list</code> ç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œ <code>rpush</code> ç”Ÿäº§æ¶ˆæ¯ï¼Œ <code>lpop</code> æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“ <code>lpop</code> æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“<code>sleep</code> ä¸€ä¼šå†é‡è¯•ï¼›</p></li><li><p><strong>å»¶æ—¶é˜Ÿåˆ—</strong>ï¼š ï¼šä½¿ç”¨<code>sortedset</code> ï¼Œæ‹¿<u>æ—¶é—´æˆ³</u>ä½œä¸º <code>score</code> ï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸º <code>key</code> è°ƒç”¨ <code>zadd</code> æ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨<code>zrangebyscore</code> æŒ‡ä»¤è·å–ç¬¦åˆæ¡ä»¶çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯å»¶æ—¶é˜Ÿåˆ—ï¼Ÿ</p><p>å½“ç”¨æˆ·å‘é€ä¸€ä¸ªæ¶ˆæ¯è¯·æ±‚ç»™æœåŠ¡å™¨åå°çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šæ£€æµ‹è¿™æ¡æ¶ˆæ¯æ˜¯å¦éœ€è¦è¿›è¡Œå»¶æ—¶å¤„ç†ï¼š</p><ul><li>å¦‚æœéœ€è¦å°±æ”¾å…¥åˆ°å»¶æ—¶é˜Ÿåˆ—ä¸­ï¼Œç”±å»¶æ—¶ä»»åŠ¡æ£€æµ‹å™¨è¿›è¡Œæ£€æµ‹å’Œå¤„ç†ï¼›</li><li>å¦‚æœä¸éœ€è¦è¿›è¡Œå»¶æ—¶å¤„ç†çš„ä»»åŠ¡ï¼ŒæœåŠ¡å™¨ä¼šç«‹é©¬å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¹¶æŠŠå¤„ç†åçš„ç»“æœè¿”ä¼šç»™ç”¨æˆ·ã€‚</li></ul><p>ã€ä¸¾ä¸ªä¾‹å­ã€‘</p><ul><li>ç‚¹å¤–å–æ—¶ï¼Œä¸‹å•åä¸ä¼šç«‹å³å®‰æ’é…é€ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€æ®µæ—¶é—´è®©å•†æˆ·æ¥å•æ‰æ­£å¼å®‰æ’é…é€ï¼Œå¦åˆ™è¶…æ—¶å–æ¶ˆ</li></ul></blockquote></li></ul><h2 id="6-2-Rediså•çº¿ç¨‹æ¨¡å‹">6.2 Rediså•çº¿ç¨‹æ¨¡å‹</h2><h4 id="1-ä¸ºä»€ä¹ˆ-Redis-ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Ÿå•çº¿ç¨‹æ¨¡å‹æ•ˆç‡ä¹Ÿèƒ½é‚£ä¹ˆé«˜ï¼Ÿ">1.<strong>ä¸ºä»€ä¹ˆ</strong> <strong>Redis ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Ÿå•çº¿ç¨‹æ¨¡å‹æ•ˆç‡ä¹Ÿèƒ½é‚£ä¹ˆé«˜</strong>ï¼Ÿ</h4><ol><li><p>é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼›</p></li><li><p><strong>å…¶æ¬¡ CPU ä¸æ˜¯ Redis çš„ç“¶é¢ˆ</strong>ï¼ŒRedis çš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚</p></li></ol><p>ã€<strong>æ•ˆç‡é«˜çš„åŸå› </strong>ã€‘</p><p>. 1. <strong>Cè¯­è¨€</strong>å®ç°ï¼Œæ•ˆç‡é«˜</p><ol start="2"><li><p>çº¯<strong>å†…å­˜</strong>æ“ä½œ</p></li><li><p><strong>åŸºäºéé˜»å¡çš„IOå¤ç”¨æ¨¡å‹æœºåˆ¶</strong>ï¼ˆå¯èƒ½ä¼šè·Ÿè‡ªå·±æŒ–å‘ï¼‰</p></li><li><p>å•çº¿ç¨‹çš„è¯å°±èƒ½é¿å…å¤šçº¿ç¨‹çš„é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ï¼ˆä¸ºä»€ä¹ˆå•çº¿ç¨‹æ•ˆç‡é«˜ï¼‰</p></li><li><p>ä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼ˆ<u>å…¨ç¨‹é‡‡ç”¨hashç»“æ„ï¼Œè¯»å–é€Ÿåº¦éå¸¸å¿«</u>ï¼Œå¯¹æ•°æ®å­˜å‚¨è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œ<u>æ¯”å¦‚zsetå‹ç¼©è¡¨ï¼Œè·³è¡¨ç­‰</u>ï¼‰</p></li></ol><h4 id="2-ï¼ˆæ–°ï¼Œæ˜“å¿˜ï¼‰è¯´è¯´-Redis-çš„å•çº¿ç¨‹æ¨¡å‹-ï¼Ÿ">2.<strong>ï¼ˆæ–°ï¼Œæ˜“å¿˜ï¼‰è¯´è¯´ Redis çš„å•çº¿ç¨‹æ¨¡å‹</strong> ï¼Ÿ</h4><blockquote><p>è¿™é—®é¢˜æ˜¯å› ä¸ºå‰é¢å›ç­”é—®é¢˜çš„æ—¶å€™æåˆ°äº† Redis æ˜¯åŸºäºéé˜»å¡çš„IOå¤ç”¨æ¨¡å‹ã€‚å¦‚æœè¿™ä¸ªé—®é¢˜å›ç­”ä¸ä¸Šæ¥ï¼Œå°±ç›¸å½“äºå‰é¢çš„å›ç­”æ˜¯ç»™è‡ªå·±æŒ–å‘äº†ã€‚</p></blockquote><p>redis å†…éƒ¨ä½¿â½¤â½‚ä»¶äº‹ä»¶å¤„ç†å™¨ file event handler ï¼Œè¿™ä¸ªâ½‚ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥redis æ‰å«åšå•çº¿ç¨‹çš„æ¨¡å‹ã€‚å®ƒé‡‡â½¤ IO å¤šè·¯å¤â½¤æœºåˆ¶ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç›‘å¬å¤šä¸ª socketï¼Œæ ¹æ® socket ä¸Šçš„äº‹ä»¶æ¥é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›â¾å¤„ç†ã€‚<br>â½‚ä»¶äº‹ä»¶å¤„ç†å™¨çš„ç»“æ„åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>å¤šä¸ª socket</li><li>IO å¤šè·¯å¤â½¤ç¨‹åº</li><li>â½‚ä»¶äº‹ä»¶åˆ†æ´¾å™¨</li><li>äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰</li></ol><p>ï¼ˆ1ï¼‰ IO å¤šè·¯å¤â½¤ç¨‹åºä¼šç›‘å¬å¤šä¸ª socketï¼Œï¼ˆ2ï¼‰ä¼šå°† socket äº§â½£çš„äº‹ä»¶<strong>æ”¾â¼Šé˜Ÿåˆ—ä¸­æ’</strong>é˜Ÿï¼Œï¼ˆ3ï¼‰äº‹ä»¶åˆ†æ´¾å™¨æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºâ¼€ä¸ªäº‹ä»¶ï¼Œï¼ˆ4ï¼‰æŠŠè¯¥äº‹ä»¶äº¤ç»™å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›â¾å¤„ç†ã€‚</p><h4 id="3-ä½ è¯´Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œé‚£å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿæ¯”å¦‚1000ä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶å‘ç”Ÿï¼Ÿ">3. ä½ è¯´Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œé‚£å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿæ¯”å¦‚1000ä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶å‘ç”Ÿï¼Ÿ</h4><ul><li><p>Redisé‡‡ç”¨äº†<strong>IOå¤šè·¯å¤ç”¨æœºåˆ¶</strong>ï¼Œä½¿å…¶åœ¨ç½‘ç»œIOæ“ä½œä¸­èƒ½å¹¶å‘å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><blockquote><p>è¯¦è§ä¸Šä¸€ä¸ªé—®é¢˜ã€‚</p></blockquote></li><li><p>Rediså¯ä»¥é‡‡ç”¨<strong>ä¸»ä»æ¶æ„</strong>ï¼Œmasterè´Ÿè´£å†™ï¼Œslaveè´Ÿè´£è¯»ã€‚</p></li></ul><h4 id="4-è¯´è¯´ä½ å¯¹Redisäº‹åŠ¡çš„ç†è§£-ï¼Ÿ">4.<strong>è¯´è¯´ä½ å¯¹Redisäº‹åŠ¡çš„ç†è§£</strong> ï¼Ÿ</h4><p>Redis ä¸­çš„äº‹åŠ¡æ˜¯<strong>ä¸€ç»„å‘½ä»¤çš„é›†åˆ</strong>ï¼Œæ˜¯ Redis çš„æœ€å°æ‰§è¡Œå•ä½ã€‚</p><blockquote><p>Redisäº‹åŠ¡åŠŸèƒ½æ˜¯é€šè¿‡MULTIã€EXECã€DISCARDå’ŒWATCH å››ä¸ªåŸè¯­å®ç°çš„ Redisä¼šå°†ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤åºåˆ—åŒ–ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œã€‚</p></blockquote><ul><li><p><strong>éœ€è¦æ³¨æ„çš„åœ°æ–¹</strong></p><ol><li><p><strong>Redis äº‹åŠ¡ä¸æ”¯æŒå›æ»š</strong>ï¼šä¸åƒ MySQL çš„äº‹åŠ¡ä¸€æ ·ï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼›</p><blockquote><p>å› ä¸ºå›æ»šéœ€è¦å¢åŠ å¾ˆå¤šå·¥ä½œï¼Œè€Œä¸æ”¯æŒå›æ»šåˆ™å¯ä»¥ä¿æŒç®€å•ã€å¿«é€Ÿçš„ç‰¹æ€§ã€‚</p></blockquote></li><li><p>Redis æœåŠ¡ç«¯åœ¨æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œ<u><strong>ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰“æ–­</strong></u>ï¼Œç›´åˆ°äº‹åŠ¡å‘½ä»¤å…¨éƒ¨æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œå…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤ã€‚</p></li></ol></li></ul><h4 id="5-ä¸ºä»€ä¹ˆRedisçš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œæ€ä¹ˆä¿è¯åŸå­æ€§çš„ï¼Ÿ">5.<strong>ä¸ºä»€ä¹ˆRedisçš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œæ€ä¹ˆä¿è¯åŸå­æ€§çš„</strong>ï¼Ÿ</h4><ul><li><strong>åŸå­æ€§</strong>ã€‚ å› ä¸ºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œ Redisæœ¬èº«æä¾›çš„æ‰€æœ‰APIéƒ½æ˜¯åŸå­æ“ä½œï¼ŒRedisä¸­çš„äº‹åŠ¡å…¶å®æ˜¯è¦ä¿è¯æ‰¹é‡æ“ä½œçš„åŸå­æ€§ã€‚</li><li><strong>äº‹åŠ¡æ€§</strong>ã€‚ Redisä¸­çš„äº‹åŠ¡å…¶å®æ˜¯è¦ä¿è¯<u>æ‰¹é‡æ“ä½œ</u>çš„åŸå­æ€§ã€‚</li></ul><h2 id="6-3-Redisç¼“å­˜">6.3 Redisç¼“å­˜</h2><h4 id="1-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜-ï¼Ÿæ€ä¹ˆæé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Ÿ">1.<strong>ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜</strong> <strong>ï¼Ÿæ€ä¹ˆæé«˜ç¼“å­˜å‘½ä¸­ç‡</strong>ï¼Ÿ</h4><ul><li><p><strong>ä¸ºä»€ä¹ˆç”¨ç¼“å­˜</strong>ï¼Ÿ</p><p>æŠŠçƒ­ç‚¹æ•°æ®å­˜å…¥å†…å­˜ä¸­ï¼Œæé«˜è¯»å†™æ€§èƒ½ã€‚</p></li><li><p><strong>æé«˜å‘½ä¸­ç‡</strong>ï¼Ÿ</p><ol><li>å¢åŠ ç¼“å­˜ç©ºé—´</li><li>æå‡ç¼“å­˜æ›´æ–°é¢‘ç‡</li><li>æå‰åŠ è½½æ•°æ®åˆ°ç¼“å­˜ä¸­</li></ol></li></ul><h4 id="2-ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»é€ã€ç¼“å­˜é¢„çƒ­ã€ç¼“å­˜æ›´æ–°ã€ç¼“å­˜é™çº§ç­‰ï¼Ÿ">2.<strong>ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»é€ã€ç¼“å­˜é¢„çƒ­ã€ç¼“å­˜æ›´æ–°ã€ç¼“å­˜é™çº§ç­‰</strong>ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844904173725548557">https://juejin.cn/post/6844904173725548557</a></p></blockquote><ul><li><p><strong>ç¼“å­˜é›ªå´©</strong></p><blockquote><p>ç®€è€Œè¨€ä¹‹ï¼š<strong>Redis æŒ‚æ‰äº†</strong>ï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ ã€‚</p></blockquote><ul><li><p><strong>ä¾‹å¦‚</strong>ï¼š å¯¹ç¼“å­˜æ•°æ®è®¾ç½®ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´æŸæ®µæ—¶é—´å†…ç¼“å­˜å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ï¼›</p><ul><li><strong>keyè¿‡æœŸè§£å†³</strong>ï¼š åœ¨ç¼“å­˜çš„æ—¶å€™ç»™è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ªéšæœºå€¼ï¼Œè¿™æ ·å°±ä¼šå¤§å¹…åº¦çš„å‡å°‘ç¼“å­˜åœ¨åŒä¸€æ—¶é—´è¿‡æœŸã€‚</li></ul><p>æ›´é€šç”¨æƒ…å†µçš„åšæ³•ï¼š</p><ul><li><strong>äº‹å‘å‰</strong>ï¼šå®ç° Redis çš„<strong>é«˜å¯ç”¨ (ä¸»ä»æ¶æ„ + Redis Cluster)</strong>ï¼Œå°½é‡é¿å… Redis æŒ‚æ‰è¿™ç§æƒ…å†µå‘ç”Ÿï¼›</li><li><strong>äº‹å‘ä¸­</strong>ï¼šä¸‡ä¸€ Redis çœŸçš„æŒ‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®<strong>æœ¬åœ°ç¼“å­˜ (ehcache)+ é™æµ (hystrix)</strong>ï¼Œå°½é‡é¿å…æˆ‘ä»¬çš„æ•°æ®åº“è¢«å¹²æ‰ï¼›</li><li><strong>äº‹å‘åï¼š<strong>redis <strong>æŒä¹…åŒ–</strong>ï¼Œé‡å¯å</strong>è‡ªåŠ¨</strong>ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œ<strong>å¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®</strong>ã€‚</li></ul></li></ul></li><li><p><strong>ç¼“å­˜ç©¿é€</strong></p><blockquote><p>æŸ¥è¯¢ä¸€ä¸ªä¸€å®š<strong>ä¸å­˜åœ¨çš„æ•°æ®</strong> ï¼Œå¯¼è‡´<strong>æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢</strong>ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ ã€‚</p></blockquote><ul><li><strong>è§£å†³1ï¼š</strong> ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ (BloomFilter) <strong>æå‰æ‹¦æˆª</strong>ï¼Œä¸åˆæ³•å°±ä¸è®©è¿™ä¸ªè¯·æ±‚åˆ°æ•°æ®åº“å±‚ï¼›</li><li><strong>è§£å†³2ï¼š<strong>å½“æˆ‘ä»¬ä»æ•°æ®åº“æ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå°†è¿™ä¸ª</strong>ç©ºå¯¹è±¡è®¾ç½®åˆ°ç¼“å­˜é‡Œè¾¹å»</strong>ï¼Œä¸‹æ¬¡å†è¯·æ±‚çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»ç¼“å­˜é‡Œè¾¹è·å–äº†ã€‚</li></ul></li><li><p><strong>ç¼“å­˜å‡»ç©¿</strong></p><p>åœ¨å¹³å¸¸é«˜å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œå¤§é‡çš„è¯·æ±‚åŒæ—¶æŸ¥è¯¢ä¸€ä¸ªkeyæ—¶ï¼Œæ­¤æ—¶è¿™ä¸ª<strong>é«˜çƒ­key</strong>æ­£å¥½å¤±æ•ˆäº†ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚éƒ½æ‰“åˆ°æ•°æ®åº“ä¸Šé¢å»ã€‚è¿™ç§ç°è±¡æˆ‘ä»¬ç§°ä¸ºç¼“å­˜å‡»ç©¿ã€‚</p><ul><li><p><strong>è§£å†³1ï¼šä½¿ç”¨äº’æ–¥é”(mutex key</strong>)ã€‚ æ˜¯åªè®©ä¸€ä¸ªçº¿ç¨‹æ„å»ºç¼“å­˜ï¼Œ<strong>å…¶ä»–çº¿ç¨‹ç­‰å¾…æ„å»ºç¼“å­˜</strong>çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œé‡æ–°ä»ç¼“å­˜è·å–æ•°æ®å°±è¡Œã€‚</p><blockquote><p>å¦‚æœæ˜¯å•æœºï¼Œå¯ä»¥ç”¨synchronizedæˆ–è€…lockæ¥å¤„ç†ï¼Œå¦‚æœæ˜¯ã€<strong>æ·˜ç‰¹ã€‘åˆ†å¸ƒå¼ç¯å¢ƒå¯ä»¥ç”¨åˆ†å¸ƒå¼é”</strong>å°±å¯ä»¥äº†ã€‚</p><p><img src="https://i.loli.net/2021/05/06/4oRvz638eOiEFTf.png" alt="image-20210506115517283"></p></blockquote></li><li><p><strong>è§£å†³2ï¼š</strong> <strong>keyæ°¸ä¸è¿‡æœŸ</strong>ã€‚ æŠŠè¿‡æœŸæ—¶é—´å­˜åœ¨keyå¯¹åº”çš„valueé‡Œï¼Œå¦‚æœå‘ç°è¦è¿‡æœŸäº†ï¼Œé€šè¿‡ä¸€ä¸ªåå°çš„å¼‚æ­¥çº¿ç¨‹è¿›è¡Œç¼“å­˜çš„æ„å»ºã€‚</p><p><img src="https://i.loli.net/2021/05/06/jZ9v47kthTmADqg.png" alt="image-20210506115748032"></p></li></ul></li><li><p><strong>ç¼“å­˜é¢„çƒ­</strong></p><blockquote><p>ç³»ç»Ÿä¸Šçº¿åï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚</p></blockquote><p>è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ã€‚</p></li><li><p><strong>ç¼“å­˜æ›´æ–°</strong></p><ul><li><code>LRU</code>(è®¿é—®æ—¶é—´æœ€æ—§æ·˜æ±°)/<code>LFU</code>(æŠŠé¢‘æ¬¡ä½çš„æ·˜æ±°æ‰)</li><li>è¶…æ—¶å‰”é™¤ï¼šè®¾ç½®keyè¿‡æœŸæ—¶é—´</li><li>ä¸»åŠ¨æ›´æ–°ï¼šå¼€å‘è®¾ç½®ç”Ÿå‘½å‘¨æœŸ</li></ul></li><li><p><strong>ç¼“å­˜é™çº§</strong></p><p>é™çº§çš„æƒ…å†µï¼Œ<u>å°±æ˜¯<strong>ç¼“å­˜å¤±æ•ˆæˆ–è€…ç¼“å­˜æœåŠ¡æŒ‚æ‰</strong>çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¸å»è®¿é—®æ•°æ®åº“</u>ã€‚æˆ‘ä»¬<strong>ç›´æ¥è®¿é—®å†…å­˜éƒ¨åˆ†æ•°æ®ç¼“å­˜</strong>æˆ–è€…ç›´æ¥è¿”å›é»˜è®¤æ•°æ®ã€‚</p><blockquote><p>å¯¹äºåº”ç”¨çš„é¦–é¡µï¼Œä¸€èˆ¬æ˜¯è®¿é—®é‡éå¸¸å¤§çš„åœ°æ–¹ï¼Œé¦–é¡µé‡Œé¢å¾€å¾€åŒ…å«äº†éƒ¨åˆ†æ¨èå•†å“çš„å±•ç¤ºä¿¡æ¯ã€‚è¿™äº›æ¨èå•†å“éƒ½ä¼šæ”¾åˆ°ç¼“å­˜ä¸­è¿›è¡Œå­˜å‚¨ï¼ŒåŒæ—¶æˆ‘ä»¬ä¸ºäº†é¿å…ç¼“å­˜çš„å¼‚å¸¸æƒ…å†µï¼Œå¯¹<strong>çƒ­ç‚¹å•†å“æ•°æ®</strong>ä¹Ÿå­˜å‚¨åˆ°äº†<strong>å†…å­˜</strong>ä¸­ã€‚åŒæ—¶å†…å­˜ä¸­è¿˜ä¿ç•™äº†ä¸€äº›é»˜è®¤çš„å•†å“ä¿¡æ¯ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p></blockquote><p><img src="https://i.loli.net/2021/05/06/a1XZHWCterV3uR2.png" alt="image-20210506115200276"></p></li></ul><h4 id="3-Redis-è®¾ç½®keyè¿‡æœŸåå¦‚ä½•å¤„ç†ï¼ŸRedisç¼“å­˜åˆ·æ–°ç­–ç•¥ï¼ˆå†…å­˜æ·˜æ±°æœºåˆ¶ï¼‰æœ‰å“ªäº›ï¼Ÿ">3. Redis è®¾ç½®keyè¿‡æœŸåå¦‚ä½•å¤„ç†ï¼Ÿ<strong>Redisç¼“å­˜åˆ·æ–°ç­–ç•¥ï¼ˆå†…å­˜æ·˜æ±°æœºåˆ¶ï¼‰æœ‰å“ªäº›</strong>ï¼Ÿ</h4><ul><li><p><strong>Redis è®¾ç½®è¿‡æœŸæ—¶é—´</strong></p><p>Redisä¸­æœ‰ä¸ªè®¾ç½®æ—¶é—´è¿‡æœŸçš„åŠŸèƒ½ï¼Œå³å¯¹å­˜å‚¨åœ¨ redis æ•°æ®åº“ä¸­çš„å€¼å¯ä»¥è®¾ç½®â¼€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</p><ul><li>å¦‚æˆ‘ä»¬â¼€èˆ¬é¡¹â½¬ä¸­çš„ <strong>token</strong> æˆ–è€…â¼€äº›ç™»å½•ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯çŸ­ä¿¡éªŒè¯ç éƒ½æ˜¯æœ‰æ—¶é—´é™åˆ¶çš„ï¼Œè¿‡æœŸååŸºæœ¬ä¸ä¼šä½¿ç”¨</li></ul></li><li><p><strong>è¿‡æœŸåé‡‡ç”¨ä»€ä¹ˆç­–ç•¥è¿›è¡Œåˆ é™¤</strong>ï¼Ÿ</p><ul><li><strong>å®šæœŸåˆ é™¤</strong>ï¼šredisé»˜è®¤æ˜¯<strong>æ¯éš” 100ms</strong> å°±<strong>éšæœºæŠ½å–</strong>â¼€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤ã€‚æ³¨æ„è¿™â¾¥æ˜¯éšæœºæŠ½å–çš„ã€‚<strong>ä¸ºä»€ä¹ˆè¦éšæœºå‘¢</strong>ï¼Ÿä½ æƒ³â¼€æƒ³å‡å¦‚ redis å­˜äº†â¼â¼—ä¸‡ä¸ª key ï¼Œæ¯éš”100mså°±éå†æ‰€æœ‰çš„è®¾ç½®è¿‡æœŸæ—¶é—´çš„ key çš„è¯ï¼Œå°±ä¼šç»™ CPU å¸¦æ¥å¾ˆå¤§çš„è´Ÿè½½ï¼</li></ul></li><li><p><strong>æƒ°æ€§åˆ é™¤</strong>ï¼š<u><strong>å®šæœŸåˆ é™¤å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šè¿‡æœŸ key åˆ°äº†æ—¶é—´å¹¶æ²¡æœ‰è¢«åˆ é™¤æ‰</strong></u>ï¼Œæ‰€ä»¥å°±æœ‰äº†æƒ°æ€§åˆ é™¤ã€‚å‡å¦‚ä½ çš„è¿‡æœŸ keyï¼Œé å®šæœŸåˆ é™¤æ²¡æœ‰è¢«åˆ é™¤æ‰ï¼Œè¿˜åœç•™åœ¨å†…å­˜â¾¥ï¼Œé™¤â¾®ä½ çš„ç³»ç»Ÿå»æŸ¥â¼€ä¸‹é‚£ä¸ª keyï¼Œæ‰ä¼šè¢«redisç»™åˆ é™¤æ‰ã€‚</p><ul><li><strong>å†…å­˜æ·˜æ±°ç­–ç•¥</strong> ï¼šå¦‚æœå®šæœŸåˆ é™¤æ¼æ‰äº†å¾ˆå¤šè¿‡æœŸ keyï¼Œç„¶åä½ ä¹Ÿæ²¡åŠæ—¶å»æŸ¥ï¼Œä¹Ÿå°±æ²¡â¾›æƒ°æ€§åˆ é™¤ï¼Œæ­¤æ—¶ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚æœå¤§é‡è¿‡æœŸkeyå †ç§¯åœ¨å†…å­˜â¾¥ï¼Œå¯¼è‡´rediså†…å­˜å—è€—å°½äº†ã€‚æ‰€ä»¥æœ‰å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚</li><li><strong>volatile-lru</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿â½¤çš„æ•°æ®æ·˜æ±°<ul><li><p><strong>volatile-ttl</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ä¸­æŒ‘é€‰<strong>å°†è¦è¿‡æœŸçš„æ•°æ®</strong>æ·˜æ±°</p></li><li><p><strong>volatile-random</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</p></li><li><p><strong>allkeys-lru</strong>ï¼šå½“å†…å­˜ä¸â¾œä»¥å®¹çº³æ–°å†™â¼Šæ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿â½¤çš„keyï¼ˆè¿™ä¸ªæ˜¯æœ€å¸¸â½¤çš„ï¼‰</p></li><li><p><strong>allkeys-random</strong>ï¼šä»æ•°æ®é›†ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</p></li><li><p><strong>no-eviction</strong>ï¼šç¦â½Œé©±é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†…å­˜ä¸â¾œä»¥å®¹çº³æ–°å†™â¼Šæ•°æ®æ—¶ï¼Œæ–°å†™â¼Šæ“ä½œä¼šæŠ¥é”™ã€‚è¿™ä¸ªåº”è¯¥æ²¡â¼ˆä½¿â½¤å§ï¼</p></li></ul></li></ul></li></ul><h4 id="4-RedisæŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†ï¼Ÿ">4. RedisæŠ¥å†…å­˜ä¸è¶³æ€ä¹ˆå¤„ç†ï¼Ÿ</h4><ul><li>å¢åŠ  Redis å¯ç”¨å†…å­˜ï¼š<ol><li>ä¿®æ”¹ä»¶ <code>redis.conf</code> çš„ <code>maxmemory</code> å‚æ•°ï¼›</li><li>ä½¿ç”¨åˆ†å¸ƒå¼é›†ç¾¤ï¼Œæé«˜å­˜å‚¨é‡ï¼›</li></ol></li><li><strong>è®¾ç½®ç¼“å­˜æ·˜æ±°ç­–ç•¥</strong>ï¼šæé«˜å†…å­˜çš„ä½¿ç”¨æ•ˆç‡ï¼›</li></ul><h4 id="5-ã€é‡ç‚¹ã€‘ç¼“å­˜å’Œæ•°æ®åº“è°å…ˆæ›´æ–°å‘¢ï¼Ÿ-ï¼ˆä¿æŒç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§ï¼‰">5. ã€<strong>é‡ç‚¹</strong>ã€‘<strong>ç¼“å­˜å’Œæ•°æ®åº“è°å…ˆæ›´æ–°å‘¢</strong>ï¼Ÿ <strong>ï¼ˆä¿æŒç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§</strong>ï¼‰</h4><blockquote><p>å‚è€ƒï¼š<a href="https://learnku.com/articles/22363">https://learnku.com/articles/22363</a></p></blockquote><ul><li><p><strong>å¯¹äºè¯»ï¼ˆæŸ¥è¯¢ï¼‰æ“ä½œ</strong></p><p>ä¸€èˆ¬æˆ‘ä»¬å¯¹<strong>è¯»æ“ä½œ</strong>çš„æ—¶å€™æœ‰è¿™ä¹ˆä¸€ä¸ªå›ºå®šçš„å¥—è·¯ï¼š</p><ol><li>å¦‚æœæˆ‘ä»¬çš„æ•°æ®åœ¨ç¼“å­˜é‡Œè¾¹æœ‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥å–ç¼“å­˜çš„ï¼›</li><li>å¦‚æœç¼“å­˜é‡Œæ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¼šå…ˆå»æŸ¥è¯¢æ•°æ®åº“ï¼Œ<u>ç„¶åå°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®å†™åˆ°ç¼“å­˜ä¸­</u>ï¼›</li><li>æœ€åå°†æ•°æ®è¿”å›ç»™è¯·æ±‚ã€‚</li></ol><p><strong>ä¸ç”¨æ›´æ–°ï¼ˆå†™ï¼‰æ•°æ®åº“ï¼Œåªç”¨æ›´æ–°ï¼ˆå†™ï¼‰ç¼“å­˜</strong>ã€‚</p></li><li><p><strong>å¯¹äºå†™æ“ä½œå¯¼è‡´åŒå†™é—®é¢˜</strong></p><blockquote><p><a href="https://developer.aliyun.com/article/712285">å¦‚ä½•ä¿è¯ç¼“å­˜(redis)ä¸æ•°æ®åº“(MySQL)çš„ä¸€è‡´æ€§</a></p></blockquote><p>å†™æ“ä½œä¼šæ›´æ–°æ•°æ®åº“ï¼Œé‚£ä¹ˆç¼“å­˜ä¹Ÿè¦è¿›è¡Œæ›´æ–°ï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿæ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><blockquote><p><strong>é”®çš„è¿‡æœŸæ—¶é—´</strong>ï¼šèƒ½ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®æœ€ç»ˆæ˜¯ä¸€è‡´çš„ã€‚</p><p><u>å› ä¸ºåªè¦ç¼“å­˜æ•°æ®è¿‡æœŸäº†ï¼Œå°±ä¼šè¢«åˆ é™¤</u>ã€‚éšåè¯»çš„æ—¶å€™ï¼Œå› ä¸ºç¼“å­˜é‡Œæ²¡æœ‰ï¼Œå°±å¯ä»¥æŸ¥æ•°æ®åº“çš„æ•°æ®ï¼Œç„¶åå°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®<strong>é‡æ–°å†™å…¥åˆ°ç¼“å­˜</strong>ä¸­ã€‚<br>é™¤äº†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšæ›´å¤šçš„æªæ–½æ¥å°½é‡é¿å…æ•°æ®åº“ä¸ç¼“å­˜å¤„äºä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿã€‚</p></blockquote><p>ç›´æ¥çœ‹ç»“è®ºï¼š</p><blockquote><p>ä¸è€ƒè™‘æ›´æ–°ç¼“å­˜è€Œæ˜¯<strong>ç›´æ¥åˆ é™¤ç¼“å­˜</strong>ï¼Œå› ä¸ºæ›´æ–°é€»è¾‘è¾ƒä¸ºå¤æ‚æ¶‰åŠåˆ°å…¶å®ƒæ•°æ®ï¼Œæ›´æ–°cacheæ¶ˆè€—ä¼šæ¯”è¾ƒå¤§ã€‚</p></blockquote><ul><li><strong>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</strong><ul><li>åœ¨é«˜å¹¶å‘ä¸‹å¯èƒ½<strong>ä¼šå¯¼è‡´æ•°æ®é•¿æ—¶é—´ä¸ä¸€è‡´</strong></li><li>é‡‡ç”¨<u>å¼‚æ­¥æ›´æ–°ç¼“å­˜</u>çš„ç­–ç•¥ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œä½†åœ¨æ•°æ®åº“æ›´æ–°å®Œæˆä¹‹å‰ï¼Œéƒ½éœ€è¦åˆ°æ•°æ®åº“å±‚é¢å»è¯»å–æ•°æ®ï¼Œè¯»çš„æ•ˆç‡ä¸å¤ªå¥½â€”â€”<strong>ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„ä¸šåŠ¡</strong></li></ul></li><li><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong> (<strong>Cache Aside Pattern è®¾è®¡æ¨¡å¼</strong>)<ul><li>åœ¨é«˜å¹¶å‘ä¸‹ä¸ä¼šå¯¼è‡´æ•°æ®é•¿æ—¶é—´ä¸ä¸€è‡´</li><li>åœ¨<strong>æ›´æ–°æ•°æ®åº“æœŸé—´ï¼Œcacheä¸­çš„æ—§æ•°æ®ä¼šè¢«è¯»å–</strong>ï¼Œå¯èƒ½ä¼šæœ‰ä¸€æ®µæ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä½†è¯»çš„æ•ˆç‡å¾ˆå¥½ã€‚â€”â€”<strong>ä¿è¯äº†æ•°æ®è¯»å–çš„æ•ˆç‡ï¼Œå¦‚æœä¸šåŠ¡å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œè¿™ç§æ–¹æ¡ˆæœ€åˆé€‚</strong></li></ul></li></ul></li><li><p><strong>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</strong></p><blockquote><p>âš ï¸ <strong>åªæœ‰è¯»æ‰ä¼šæ›´æ–°ç¼“å­˜ï¼ï¼</strong></p></blockquote><ul><li><p><u>æ­£å¸¸æƒ…å†µ</u></p><ol><li>Açº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œå…ˆæ·˜æ±°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</li><li>Bçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰æƒ³è¦çš„æ•°æ®ï¼Œä»æ•°æ®åº“ä¸­è¯»å–æ›´æ–°åçš„æ–°æ•°æ® ï¼Œå¹¶æ›´æ–°ç¼“å­˜</li></ol></li><li><p><u>é«˜å¹¶å‘å¼‚å¸¸</u></p><ol><li>Açº¿ç¨‹è¿›è¡Œ<strong>å†™</strong>æ“ä½œï¼Œå…ˆæ·˜æ±°ç¼“å­˜ï¼Œä½†ç”±äº<u>ç½‘ç»œåŸå› ç­‰æœªåŠæ—¶æ›´æ–°æ•°æ®åº“</u></li><li>Bçº¿ç¨‹<strong>è¯»</strong>å–ç¼“å­˜å¤±è´¥ï¼Œå»<u>è¯»å–æ•°æ®åº“çš„æ˜¯æ—§å€¼</u> ï¼Œå¹¶å°†<u>æ—§æ•°æ®æ”¾å…¥ç¼“å­˜</u></li><li>Açº¿ç¨‹å†æ›´æ–°æ•°æ®åº“æˆåŠŸï¼ˆ<strong>åŒæ­¥æƒ…å†µä¸‹å†™æ“ä½œä¸æ›´æ–°redisè€Œè¯»æ“ä½œæ›´æ–°redis</strong>ï¼‰ï¼Œ<u>æ­¤æ—¶ç¼“å­˜ï¼ˆæ—§ï¼‰å’Œæ•°æ®åº“ï¼ˆæ–°ï¼‰ä¸ä¸€è‡´</u></li></ol><p>è€Œä¸”æ²¡æœ‰è®¾ç½®é”®è¿‡æœŸï¼Œä¼šä¿æŒå¾ˆé•¿æ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p></li><li><p><u>è§£å†³æ–¹æ¡ˆ</u></p><ul><li><strong>å¼‚æ­¥æ›´æ–°ç¼“å­˜</strong> ï¼šBçº¿ç¨‹è¯»æ“ä½œä¸æ›´æ–°ç¼“å­˜ï¼Œè€Œæ˜¯ç”±<u>Açº¿ç¨‹å†™æ“ä½œæ›´æ–°æ•°æ®åº“æˆåŠŸåï¼Œé€šè¿‡binlogå¼‚æ­¥æ›´æ–°ç¼“å­˜</u></li><li><strong>å»¶æ—¶åŒåˆ </strong>ï¼š Açº¿ç¨‹<u>ä¼‘çœ Mç§’ï¼ˆç¡®ä¿äº‹åŠ¡éƒ½å·²æäº¤ï¼‰</u>ï¼Œå†æ›´æ–°æ•°æ®åº“æˆåŠŸåï¼Œ<strong>å†æ¬¡åˆ é™¤ç¼“å­˜</strong>ã€‚å…¶å®ƒçº¿ç¨‹è¿›è¡Œ<strong>è¯»</strong>æ“ä½œæ—¶ï¼Œç¼“å­˜ä¸­æ— æ•°æ®ï¼Œä»æ•°æ®åº“ä¸­è¯»å–çš„æ˜¯æ›´æ–°åçš„æ–°æ•°æ®ï¼Œ<u>åˆå†æ¬¡ä¸€è‡´äº†</u>ã€‚</li></ul></li></ul></li><li><p><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</strong></p><ul><li><p><u>æ­£å¸¸æƒ…å†µ</u></p><ol><li>Açº¿ç¨‹è¿›è¡Œ<strong>å†™</strong>æ“ä½œï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</li><li>Bçº¿ç¨‹è¿›è¡Œ<strong>è¯»</strong>æ“ä½œï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰æƒ³è¦çš„æ•°æ®ï¼Œä»æ•°æ®åº“ä¸­è¯»å–æ›´æ–°åçš„æ–°æ•°æ® ï¼Œå¹¶æ›´æ–°ç¼“å­˜</li></ol></li><li><p><u>é«˜å¹¶å‘å¼‚å¸¸</u></p><ol><li><p>Açº¿ç¨‹è¿›è¡Œ<strong>å†™</strong>æ“ä½œï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œ<u>ä½†æœªæ¥å¾—åŠåˆ é™¤ç¼“å­˜</u></p></li><li><p>Bçº¿ç¨‹è¿›è¡Œ<strong>è¯»</strong>æ“ä½œï¼Œ<u><strong>è¯»å–ç¼“å­˜çš„æ—§æ•°æ®</strong>ï¼ˆèƒŒé”™ä¸€æ¬¡ï¼‰ï¼Œæ­¤æ—¶æ•°æ®ä¸ä¸€è‡´</u></p></li><li><p>Açº¿ç¨‹å†åˆ ç¼“å­˜</p></li></ol><p>ä½†å…¶å®ƒçº¿ç¨‹è¿›è¡Œè¯»æ•°æ®çš„æ—¶å€™æ›´æ–°ç¼“å­˜ï¼Œæ›´æ–°ç¼“å­˜åˆä¸€è‡´äº†ï¼Œ<u>ä¸ä¸€è‡´çš„æ—¶é—´å¾ˆçŸ­ã€‚</u></p><p>ä½†æ˜¯è¿˜å¯èƒ½ä¼šè€ƒè™‘ï¼š3. <strong>Açº¿ç¨‹åˆ é™¤ç¼“å­˜å¤±è´¥</strong> ï¼Œæ­¤åè¯»å–çš„ä¸€ç›´éƒ½æ˜¯æ—§æ•°æ®äº†ã€‚</p></li><li><p><u>è§£å†³æ–¹æ¡ˆ</u></p><ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œåˆ é™¤è¡¥å¿</strong>ã€‚å¦‚æœRedisåˆ é™¤å‘ç°æŠ¥é”™ï¼Œå°†Redisçš„keyä½œä¸ºæ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç³»ç»Ÿæ”¶åˆ°æ¶ˆæ¯é˜Ÿåˆ—å†æ¬¡å¯¹Redisè¿›è¡Œåˆ é™¤æ“ä½œã€‚</li></ul></li></ul></li></ul><h2 id="6-4-é›†ç¾¤ç›¸å…³">6.4 é›†ç¾¤ç›¸å…³</h2><h4 id="1-Redisçš„åŒæ­¥æœºåˆ¶äº†è§£æ˜¯ä»€ä¹ˆï¼Ÿ">1. Redisçš„åŒæ­¥æœºåˆ¶äº†è§£æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Redisä¸»ä»å¤åˆ¶å¯ä»¥æ ¹æ®æ˜¯å¦æ˜¯å…¨é‡åˆ†ä¸ºï¼š<u>å…¨é‡åŒæ­¥</u>å’Œ<u>å¢é‡åŒæ­¥</u>ã€‚</p><blockquote><p>ä¸»ä»åˆšåˆšè¿æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ï¼›å…¨åŒæ­¥ç»“æŸåï¼Œè¿›è¡Œå¢é‡åŒæ­¥ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œslave åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥ã€‚</p></blockquote><ul><li><p><strong>å…¨é‡åŒæ­¥</strong></p><p>Rediså…¨é‡å¤åˆ¶ä¸€èˆ¬å‘ç”Ÿåœ¨Slaveåˆå§‹åŒ–é˜¶æ®µï¼Œè¿™æ—¶<strong>Slaveéœ€è¦å°†Masterä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½å¤åˆ¶ä¸€ä»½</strong>ï¼š</p><p>â€‹       1ï¼‰ä»æœåŠ¡å™¨è¿æ¥ä¸»æœåŠ¡å™¨ï¼Œå‘é€<code>SYNC</code>å‘½ä»¤ï¼›<br>ã€€ã€€2ï¼‰ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°SYNCå‘½ååï¼Œå¼€å§‹æ‰§è¡Œ<code>BGSAVE</code>å‘½ä»¤ï¼ˆ1ï¼‰ç”Ÿæˆ<u>RDBæ–‡ä»¶</u>  ï¼ˆ2ï¼‰å¹¶ä½¿ç”¨<u>ç¼“å†²åŒºè®°å½•</u>æ­¤åæ‰§è¡Œçš„æ‰€æœ‰<strong>å†™</strong>å‘½ä»¤ï¼›<br>ã€€ã€€3ï¼‰ä¸»æœåŠ¡å™¨<code>BGSAVE</code>æ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ä»æœåŠ¡å™¨å‘é€RDBå¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ï¼›<br>ã€€ã€€4ï¼‰ä»æœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼›<br>ã€€ã€€5ï¼‰ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›ä»æœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼›</p></li><li><p><strong>å¢é‡åŒæ­¥</strong></p><p>Slaveåˆå§‹åŒ–åå¼€å§‹æ­£å¸¸å·¥ä½œæ—¶ï¼š<strong>ä¸»æœåŠ¡å™¨å‘ç”Ÿçš„å†™æ“ä½œåŒæ­¥åˆ°ä»æœåŠ¡å™¨çš„è¿‡ç¨‹</strong>ã€‚</p><ol><li>ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€ä¸ª<strong>å†™å‘½ä»¤</strong>å°±ä¼šå‘ä»æœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼›</li><li>ä»æœåŠ¡å™¨æ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ã€‚</li></ol></li></ul><h4 id="2-ã€æ–°è¡¥å……ã€‘-Redisé›†ç¾¤æ¶æ„æ¨¡å¼æœ‰å“ªå‡ ç§ï¼Ÿé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ">2.ã€æ–°è¡¥å……ã€‘ <strong>Redis</strong>é›†ç¾¤æ¶æ„æ¨¡å¼æœ‰å“ªå‡ ç§ï¼Ÿé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><blockquote><p>å¾…è¡¥å……ï¼š<a href="https://blog.csdn.net/zzhongcy/article/details/108446687">Redis æ¶æ„æ¨¡å¼è¯¦è§£ï¼ˆå•æœºã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ¨¡å¼ï¼‰</a></p></blockquote><ul><li><p><strong>1. å•æœºæ¨¡å¼</strong></p><blockquote><p>QPSï¼ˆæ¯ç§’æŸ¥è¯¢é€Ÿåº¦ï¼‰å¤§çº¦åœ¨å‡ ä¸‡å·¦å³ã€‚</p></blockquote><p>å®‰è£…ä¸€ä¸ª Redisï¼Œå¯åŠ¨èµ·æ¥ï¼Œä¸šåŠ¡è°ƒç”¨å³å¯ã€‚</p><p><img src="https://i.loli.net/2021/05/25/m5euvrDF1UOtYbn.png" alt="image-20210525232444113"></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š éƒ¨ç½²ç®€å•ï¼›æˆæœ¬ä½ï¼›é«˜æ€§èƒ½</li><li><strong>ç¼ºç‚¹</strong>ï¼š å•èŠ‚ç‚¹å®•æœºé£é™© ;  å•æœºé«˜æ€§èƒ½å—é™äº CPU çš„å¤„ç†èƒ½åŠ›</li></ul></li><li><p><strong>2. ä¸»ä»å¤åˆ¶</strong></p><p><img src="https://i.loli.net/2021/05/25/tGy6WCzmKpS4Mfr.png" alt="image-20210525232806643"></p><p>Redis çš„å¤åˆ¶ï¼ˆReplicationï¼‰åŠŸèƒ½å…è®¸ç”¨æˆ·æ ¹æ®ä¸€ä¸ª Redis æœåŠ¡å™¨æ¥åˆ›å»ºä»»æ„å¤šä¸ªè¯¥æœåŠ¡å™¨çš„å¤åˆ¶å“ã€‚</p><ul><li>è¢«å¤åˆ¶çš„æœåŠ¡å™¨ä¸ºä¸»æœåŠ¡å™¨ï¼ˆMasterï¼‰ï¼Œè€Œé€šè¿‡å¤åˆ¶åˆ›å»ºå‡ºæ¥çš„å¤åˆ¶å“åˆ™ä¸ºä»æœåŠ¡å™¨ï¼ˆSlaveï¼‰ã€‚</li></ul><p>ä¸»è¦ä¼˜ç¼ºç‚¹ï¼š</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š Master/Slave è§’è‰²æ–¹ä¾¿æ°´å¹³æ‰©å±•ï¼Œé™ä½ Master <strong>è¯»</strong>å‹åŠ›ï¼Œè½¬äº¤ç»™ Slave èŠ‚ç‚¹ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼š å¯é æ€§ä¿è¯ä¸æ˜¯å¾ˆå¥½ï¼Œä¸»èŠ‚ç‚¹æ•…éšœä¾¿æ— æ³•æä¾›å†™å…¥æœåŠ¡ï¼›æ²¡æœ‰è§£å†³ä¸»èŠ‚ç‚¹<strong>å†™çš„å‹åŠ›</strong> ï¼›ä¸»èŠ‚ç‚¹å®•æœºï¼Œéœ€è¦äººä¸ºå¹²é¢„ã€‚</li></ul></li><li><p><strong>3. å“¨å…µæ¨¡å¼</strong></p><blockquote><p>Redis 2.8ç‰ˆæœ¬åå¼•å…¥äº†å“¨å…µçš„æ¦‚å¿µã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/01/81lKSUu7skhM2Yr.png" alt="img"></p><p>ä¸»ä»æ¨¡å¼ä¸­ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºä¹‹åï¼Œ<strong>ä»èŠ‚ç‚¹æ˜¯å¯ä»¥ä½œä¸ºä¸»èŠ‚ç‚¹é¡¶ä¸Šæ¥ç»§ç»­æä¾›æœåŠ¡</strong>ï¼Œ<u>ä½†æ˜¯éœ€è¦ä¿®æ”¹åº”ç”¨æ–¹çš„ä¸»èŠ‚ç‚¹åœ°å€</u>ï¼Œè¿˜éœ€è¦å‘½ä»¤æ‰€æœ‰ä»èŠ‚ç‚¹å»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹æ•°æ®ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦<strong>äººå·¥å¹²é¢„</strong>ã€‚</p><p>ä¸ºæ­¤ï¼Œå¼•å…¥äº†å“¨å…µï¼ˆSentinelï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œåœ¨<strong>ä¸»ä»å¤åˆ¶çš„åŸºç¡€</strong>ä¸Šï¼Œå“¨å…µå®ç°äº†<strong>è‡ªåŠ¨åŒ–æ•…éšœæ¢å¤</strong>ã€‚å“¨å…µæ¨¡å¼ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå“¨å…µèŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹ï¼š</p><ul><li><p><strong>å“¨å…µèŠ‚ç‚¹</strong>ï¼šå“¨å…µèŠ‚ç‚¹æ˜¯ç‰¹æ®Šçš„ Redis èŠ‚ç‚¹ï¼Œä¸å­˜å‚¨æ•°æ®ï¼›</p></li><li><p><strong>æ•°æ®èŠ‚ç‚¹</strong>ï¼šä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹éƒ½æ˜¯æ•°æ®èŠ‚ç‚¹ã€‚</p></li></ul><p><strong>å“¨å…µå·¥ä½œåŸç†</strong>ï¼š</p><ol><li>æ¯ä¸ª Sentinel ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒæ‰€çŸ¥çš„ <strong>Masterï¼ŒSlave ä»¥åŠå…¶ä»– Sentinel</strong> èŠ‚ç‚¹å‘é€ä¸€ä¸ª <code>PING</code> å‘½ä»¤ï¼›</li><li>å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´<strong>è¶…è¿‡é…ç½®æ–‡ä»¶ <code>own-after-milliseconds</code> é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼</strong>ï¼Œåˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinel æ ‡è®°ä¸º<strong>ä¸»è§‚ä¸‹çº¿</strong>ï¼›</li><li>å¦‚æœä¸€ä¸ª Master è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œé‚£ä¹ˆæ­£åœ¨ç›‘è§†è¿™ä¸ª Master çš„æ‰€æœ‰ Sentinel è¦ä»¥<strong>æ¯ç§’ä¸€æ¬¡</strong>çš„é¢‘ç‡ç¡®è®¤ Master æ˜¯å¦çœŸçš„è¿›å…¥ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼›</li><li>å½“æœ‰<strong>è¶³å¤Ÿæ•°é‡çš„ Sentinel</strong>ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨<strong>æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤</strong> Master çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼Œåˆ™ Master ä¼šè¢«æ ‡è®°ä¸º<strong>å®¢è§‚ä¸‹çº¿</strong>ï¼›</li><li>å¦‚æœ Master å¤„äº <strong>ODOWN çŠ¶æ€</strong>ï¼Œåˆ™æŠ•ç¥¨è‡ªåŠ¨é€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹;å°†å‰©ä½™çš„ä»èŠ‚ç‚¹æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹ç»§ç»­è¿›è¡Œæ•°æ®å¤åˆ¶ï¼›</li><li>è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinel åŒæ„ Master å·²ç»ä¸‹çº¿ï¼ŒMaster çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚<u>è‹¥ Master é‡æ–°å‘ Sentinel çš„ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤</u>ï¼ŒMaster çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚</li></ol><p><u><strong>å“¨å…µæ¨¡å¼ä¼˜ç¼ºç‚¹</strong></u>ï¼š</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šï¼ˆ1ï¼‰ä¸»ä»è‡ªåŠ¨åˆ‡æ¢ï¼Œæ›´åŠ å¥å£®</li><li><strong>ç¼ºç‚¹</strong>ï¼š ï¼ˆ1ï¼‰ä¸»ä»åˆ‡æ¢éœ€è¦æ—¶é—´è¿˜æ˜¯ä¼šä¸¢å¤±æ•°æ®ï¼›ï¼ˆ2ï¼‰æ²¡æœ‰è§£å†³ä¸»èŠ‚ç‚¹<strong>å†™</strong>å‹åŠ› ï¼ˆ3ï¼‰åŠ¨æ€æ‰©å®¹å¤æ‚</li></ul></li><li><p><strong>4. é›†ç¾¤æ¨¡å¼</strong></p><blockquote><p>Redis 3.0 ç‰ˆæœ¬å¼•å…¥äº†Redis Clusteré›†ç¾¤æ¨¡å¼ã€‚</p></blockquote><img src="https://i.loli.net/2021/05/25/yfskJDK3vrzUoWp.png" alt="img" style="zoom:80%;" /><ul><li>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šè¯¥é›†ç¾¤ä¸­åŒ…å« 6 ä¸ª Redis èŠ‚ç‚¹ï¼Œ3 ä¸» 3 ä»ï¼Œåˆ†åˆ«ä¸º M1ï¼ŒM2ï¼ŒM3ï¼ŒS1ï¼ŒS2ï¼ŒS3ã€‚é™¤äº†ä¸»ä» Redis èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®å¤åˆ¶å¤–ï¼Œæ‰€æœ‰ Redis èŠ‚ç‚¹ä¹‹é—´é‡‡ç”¨ <strong>Gossip</strong> åè®®è¿›è¡Œé€šä¿¡ï¼Œäº¤æ¢ç»´æŠ¤èŠ‚ç‚¹å…ƒæ•°æ®ä¿¡æ¯</li></ul><p>Redis Cluster é‡‡ç”¨<strong>æ— ä¸­å¿ƒ</strong>ç»“æ„ï¼Œ<strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä¿å­˜æ•°æ®</strong>å’Œæ•´ä¸ªé›†ç¾¤çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹<strong>éƒ½</strong>å’Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹<strong>è¿æ¥</strong>ã€‚</p><ul><li>Cluster ä¸€èˆ¬ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼ŒèŠ‚ç‚¹æ•°é‡è‡³å°‘ä¸º 6 ä¸ªæ‰èƒ½ä¿è¯ç»„æˆå®Œæ•´é«˜å¯ç”¨çš„é›†ç¾¤ï¼Œå…¶ä¸­3ä¸ªä¸º<strong>ä¸»</strong>èŠ‚ç‚¹ï¼Œ3ä¸ªä¸º<strong>ä»</strong>èŠ‚ç‚¹ï¼›</li></ul><p><strong>4.1 Redis é›†ç¾¤åˆ†ç‰‡æ¦‚å¿µ</strong></p><blockquote><p>å•æœºã€ä¸»ä»ã€å“¨å…µçš„æ¨¡å¼æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨<strong>ä¸€ä¸ªmasterèŠ‚ç‚¹</strong>ä¸Šï¼Œ<strong>å…¶ä»–èŠ‚ç‚¹è¿›è¡Œæ•°æ®çš„å¤åˆ¶</strong>ã€‚</p><p>é›†ç¾¤æ¨¡å¼å°±æ˜¯æŠŠæ•°æ®è¿›è¡Œ<strong>åˆ†ç‰‡</strong>å­˜å‚¨ï¼Œå½“ä¸€ä¸ªåˆ†ç‰‡æ•°æ®è¾¾åˆ°ä¸Šé™çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥åˆ†æˆå¤šä¸ªåˆ†ç‰‡ã€‚</p></blockquote><p>Redis Cluster é‡‡ç”¨<strong>è™šæ‹Ÿå“ˆå¸Œæ§½åˆ†åŒº</strong>ï¼Œæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ° 0 ~ 16383 æ•´æ•°æ§½å†…ï¼Œè®¡ç®—å…¬å¼ï¼š</p><ul><li><code>HASH_SLOT = CRC16(key) % 16384</code></li></ul><p><strong>æ¯ä¸€ä¸ªä¸»</strong>èŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†<strong>æ§½</strong>ä»¥<strong>åŠ</strong>æ§½æ‰€<strong>æ˜ å°„çš„é”®å€¼æ•°æ®</strong>ã€‚</p><ul><li><p><strong>ä¸¾ä¾‹è¯´æ˜</strong>ï¼š</p><blockquote><p>æœ‰ 3 ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ç¯å¢ƒå¦‚ä¸‹</p><ul><li>èŠ‚ç‚¹ A å“ˆå¸Œæ§½èŒƒå›´ä¸º 0 ~ 5500ï¼›</li><li>èŠ‚ç‚¹ B å“ˆå¸Œæ§½èŒƒå›´ä¸º 5501 ~ 11000ï¼›</li><li>èŠ‚ç‚¹ C å“ˆå¸Œæ§½èŒƒå›´ä¸º 11001 ~ 16383ã€‚</li></ul></blockquote><p><strong>å¢åŠ æ•°æ®</strong>ï¼š ï¼ˆ1ï¼‰æ ¹æ®ä¸Šè¿°å…¬å¼è®¡ç®—<strong>æ–°å¢çš„keyå­˜å‚¨</strong> ï¼Œæ˜ å°„åˆ°ç›¸åº”èŠ‚ç‚¹ï¼ˆå‡è®¾ä¸ºBï¼‰</p><p><strong>å¢åŠ èŠ‚ç‚¹</strong>ï¼š ï¼ˆ1ï¼‰ä»å„ä¸ªèŠ‚ç‚¹æ‹¿å‡ºä¸€éƒ¨åˆ†å“ˆå¸Œæ§½åˆ†é…åˆ°æ–°å¢çš„DèŠ‚ç‚¹ä¸Šå³å¯</p><p><strong>åˆ é™¤èŠ‚ç‚¹</strong>ï¼š ï¼ˆ1ï¼‰åˆ é™¤AèŠ‚ç‚¹ï¼Œåªéœ€å°†AèŠ‚ç‚¹çš„å“ˆå¸Œæ§½ç§»åŠ¨åˆ°å…¶å®ƒèŠ‚ç‚¹æ¥å£</p></li></ul><p><strong>4.2 Reidsé›†ç¾¤çš„ä¸»ä»æ¨¡å¼</strong></p><p>Redis Cluster ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼ŒåŠ å…¥äº†ä¸»ä»æ¨¡å¼ï¼Œ<strong>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹</strong>ï¼Œä¸»èŠ‚ç‚¹æä¾›æ•°æ®å­˜å–ï¼Œä»èŠ‚ç‚¹å¤åˆ¶ä¸»èŠ‚ç‚¹æ•°æ®å¤‡ä»½ï¼Œå½“è¿™ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œå°±ä¼šé€šè¿‡è¿™ä¸ªä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹é€‰å–ä¸€ä¸ªæ¥å……å½“ä¸»èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨ã€‚</p><p><strong>4.3 ä¼˜ç¼ºç‚¹æ€»ç»“</strong></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š ï¼ˆ1ï¼‰æ— ä¸­å¿ƒç»“æ„ ï¼Œ<strong>å¤š</strong>èŠ‚ç‚¹<strong>å­˜å‚¨</strong>æ•°æ®ï¼›ï¼ˆ2ï¼‰èŠ‚ç‚¹åŠ¨æ€<strong>åˆ é™¤ã€ç§»åŠ¨</strong>æ•°æ®åˆ†å¸ƒæ–¹ä¾¿ï¼›ï¼ˆ3ï¼‰<strong>éƒ¨åˆ†èŠ‚ç‚¹ä¸å¯ç”¨</strong>ï¼Œé›†ç¾¤ä¾æ—§å¯ç”¨ï¼ˆå“ˆå¸Œæ§½ + ä»èŠ‚ç‚¹å¤‡ä»½å¹¶æ•…éšœæ™‹å‡ä¸»èŠ‚ç‚¹ï¼‰ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼š ï¼ˆ1ï¼‰<strong>å¼‚æ­¥</strong>å¤åˆ¶ï¼Œ<strong>æ— æ³•ä¿è¯æ•°æ®ä¸€è‡´æ€§</strong>ï¼ˆ2ï¼‰é›†ç¾¤æ­å»º<strong>å¤æ‚</strong>ï¼ˆ3ï¼‰<strong><code>mget</code>,<code>pipeline</code><strong>ç­‰å‘½ä»¤ã€‚å®ƒä»¬éœ€è¦æŠŠè¯·æ±‚</strong>åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œ</strong>ã€å†èšåˆã€‚èŠ‚ç‚¹è¶Šå¤šï¼Œæ€§èƒ½è¶Šä½</li></ul></li></ul><h4 id="3-è¯´è¯´-Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ï¼Ÿ">3.<strong>è¯´è¯´</strong> <strong>Rediså“ˆå¸Œæ§½çš„æ¦‚å¿µ</strong>ï¼Ÿ<strong>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨</strong>ï¼Ÿ</h4><blockquote><p>Redis æ²¡æœ‰ä½¿ç”¨å“ˆå¸Œä¸€è‡´æ€§ç®—æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨å“ˆå¸Œæ§½ã€‚Redis ä¸­çš„å“ˆå¸Œæ§½ä¸€å…±æœ‰ 16384 ä¸ªï¼Œè®¡ç®—ç»™å®šå¯†é’¥çš„å“ˆå¸Œæ§½ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å¯†é’¥çš„ CRC16 å–æ‘¸ 16384ã€‚</p></blockquote><p>å‡è®¾é›†ç¾¤ä¸­æœ‰ Aã€Bã€C ä¸‰ä¸ªé›†ç¾¤èŠ‚ç‚¹ï¼Œ<strong>ä¸å­˜åœ¨å¤åˆ¶æ¨¡å¼</strong>ä¸‹ï¼Œæ¯ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹åŒ…å«çš„å“ˆå¸Œæ§½å¦‚ä¸‹ï¼š</p><ul><li><p>èŠ‚ç‚¹ A åŒ…å«ä» 0 åˆ° 5500 çš„å“ˆå¸Œæ§½ï¼›</p></li><li><p>èŠ‚ç‚¹ B åŒ…å«ä» 5501 åˆ° 11000 çš„å“ˆå¸Œæ§½ï¼›</p></li><li><p>èŠ‚ç‚¹ C åŒ…å«ä» 11001 åˆ° 16383 çš„å“ˆå¸Œæ§½ï¼›</p></li></ul><p>è¿™æ—¶ï¼Œå¦‚æœ<strong>èŠ‚ç‚¹ B å‡ºç°æ•…éšœ</strong>ï¼Œ<u>æ•´ä¸ªé›†ç¾¤å°±ä¼šå‡ºç°ç¼ºå°‘ 5501 åˆ° 11000</u> çš„å“ˆå¸Œæ§½èŒƒå›´è€Œä¸å¯ç”¨ã€‚</p><h4 id="4-Redis-å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ">4. <strong>Redis å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆæœ‰å“ªäº›</strong>ï¼Ÿ</h4><p>Redis å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li><strong>Masterä¸åšæŒä¹…åŒ–ï¼Œ   Slave åš AOF</strong>ï¼šMaster æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚ RDB å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ï¼›å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ª Slave å¼€å¯ AOF å¤‡ä»½æ•°æ®ï¼Œç­–ç•¥è®¾ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼›</li><li><strong>åŒå±€åŸŸç½‘</strong>ï¼šä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒMaster å’Œ Slave æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼›</li><li>å°½é‡é¿å…åœ¨å‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“ï¼›</li><li><strong>ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„</strong>ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œå³ï¼šMaster &lt;- Slave1 &lt;- Slave2 &lt;-Slave3â€¦.ï¼›è¿™æ ·çš„ç»“æ„æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç° Slave å¯¹ Master çš„æ›¿æ¢ã€‚å¦‚æœ Master æŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨ Slave1 åš Masterï¼Œå…¶ä»–ä¸å˜</li></ul><h2 id="6-5-Redis-Keyç›¸å…³">6.5 Redis Keyç›¸å…³</h2><h4 id="1-å‡å¦‚-Redis-é‡Œé¢æœ‰-1-äº¿ä¸ª-keyï¼Œå…¶ä¸­æœ‰-10w-ä¸ª-key-æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ">1.<strong>å‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸ</strong>ä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ keys å‘½ä»¤å’Œ scan å‘½ä»¤ï¼Œä½†æ˜¯ä¼šå‘ç°ä½¿ç”¨ scan æ›´å¥½ã€‚</p><ul><li><p><strong>keyså‘½ä»¤</strong></p><p>è™½ç„¶å¯ä»¥æŸ¥è¯¢ä½†ä¸å¤ªæ¨èï¼š</p><ul><li><strong>æ—¶é—´é•¿ä¸”ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡</strong>ï¼š æ—¶é—´é•¿æ˜¯å› ä¸ºO(N)éå† ï¼› é˜»å¡æ˜¯å› ä¸ºRediså•çº¿ç¨‹ï¼Œè¦ç­‰éå†å®Œï¼Œè¿™ä½¿å¾—Redisè¦ç­‰keysæ‰§è¡Œå®Œæ¯•æ‰èƒ½æ¢å¤ç”Ÿäº§ï¼ˆåœ¨ç”Ÿæˆç¯å¢ƒä¸­è¿™æ˜¯ä¸è¢«å…è®¸çš„ï¼‰ã€‚</li><li><strong>æ²¡æœ‰åˆ†é¡µåŠŸèƒ½</strong>ï¼š ä¸€æ¬¡æŸ¥æ‰¾æ‰€æœ‰çš„ç»“æœ</li></ul></li><li><p><strong>scanå‘½ä»¤</strong></p><p>æ¨èï¼š</p><ul><li><p>ä¸ä¼šé˜»å¡ï¼Œä½†æŸ¥æ‰¾å‡ºçš„å…ƒç´ å¯èƒ½é‡å¤ï¼Œéœ€è¦å®¢æˆ·ç«¯å»é‡ä¸‹</p><blockquote><p><strong>ä¸ºä»€ä¹ˆä¸ä¼šé˜»å¡</strong>ï¼Ÿ</p><p>å› ä¸º scan æ˜¯é€šè¿‡æ¸¸æ ‡æ–¹å¼æŸ¥è¯¢çš„ ï¼ŒæŸ¥è¯¢è¿‡ç¨‹ä¸­ä¼šæŠŠæ¸¸æ ‡è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå•æ¬¡è¿”å›ç©ºå€¼ä¸”æ¸¸æ ‡ä¸ä¸º 0ï¼Œåˆ™è¯´æ˜éå†è¿˜æ²¡ç»“æŸï¼Œå®¢æˆ·ç«¯ç»§ç»­éå†æŸ¥è¯¢ã€‚</p></blockquote></li></ul></li></ul><h4 id="2-å¦‚æœæœ‰å¤§é‡çš„-key-éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ">2.<strong>å¦‚æœæœ‰å¤§é‡çš„ key éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€</strong>ä¹ˆï¼Ÿ</h4><p>å¦‚æœæœ‰å¤§é‡çš„ key åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œé‚£ä¹ˆå¯èƒ½åŒä¸€ç§’éƒ½ä»æ•°æ®åº“è·å–æ•°æ®ï¼Œç»™æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å‹åŠ›ï¼Œå¯¼è‡´<strong>ç¼“å­˜é›ªå´©</strong>ã€‚</p><ul><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š æœ€å¥½ç»™æ•°æ®çš„è¿‡æœŸæ—¶é—´åŠ ä¸€ä¸ª<strong>éšæœºå€¼</strong>ï¼Œè®©è¿‡æœŸæ—¶é—´æ›´åŠ åˆ†æ•£</li></ul><h4 id="3-ä»€ä¹ˆæ˜¯-bigkeyï¼Ÿä¼šå­˜åœ¨ä»€ä¹ˆå½±å“ï¼Ÿ">3.<strong>ä»€ä¹ˆæ˜¯</strong> <strong>bigkeyï¼Ÿä¼šå­˜åœ¨ä»€ä¹ˆå½±å“</strong>ï¼Ÿ</h4><p>bigkey æ˜¯æŒ‡é”®å€¼å ç”¨å†…å­˜ç©ºé—´éå¸¸å¤§çš„ keyã€‚ä¾‹å¦‚ä¸€ä¸ªå­—ç¬¦ä¸² a å­˜å‚¨äº† 200M çš„æ•°æ®ã€‚</p><p><strong>bigkey çš„ä¸»è¦å½±å“æœ‰</strong>ï¼š</p><ul><li><p><strong>ç½‘ç»œé˜»å¡</strong>ï¼šè·å– bigkey æ—¶ï¼Œä¼ è¾“çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œä¼šå¢åŠ å¸¦å®½çš„å‹åŠ›ï¼›</p></li><li><p>è¶…æ—¶é˜»å¡ï¼šå› ä¸º bigkey å ç”¨çš„ç©ºé—´æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥<u>æ“ä½œèµ·æ¥æ•ˆç‡ä¼šæ¯”è¾ƒä½</u>ï¼Œå¯¼è‡´å‡ºç°é˜»å¡çš„å¯èƒ½æ€§å¢åŠ ã€‚</p></li></ul><h4 id="4-Rediså¦‚ä½•è§£å†³-keyå†²çªï¼Ÿ">4. <strong>Rediså¦‚ä½•è§£å†³ keyå†²çª</strong>ï¼Ÿ</h4><blockquote><p>Redis å¦‚æœ key ç›¸åŒï¼Œåä¸€ä¸ª key ä¼šè¦†ç›–å‰ä¸€ä¸ª keyã€‚</p></blockquote><p>å¦‚æœè¦è§£å†³ key å†²çªï¼Œæœ€å¥½ç»™ <strong>key å–å¥½å</strong>åŒºåˆ†å¼€ï¼Œå¯ä»¥æŒ‰ä¸šåŠ¡åå’Œå‚æ•°åŒºåˆ†å¼€å–åï¼Œé¿å…é‡å¤ key å¯¼è‡´çš„å†²çªã€‚</p><h4 id="5-å¦‚ä½•è§£å†³Redisçš„å¹¶å‘ç«äº‰Keyé—®é¢˜-ï¼Ÿ">5. å¦‚ä½•è§£å†³Redisçš„å¹¶å‘ç«äº‰Keyé—®é¢˜ ï¼Ÿ</h4><blockquote><p>å¤šä¸ªç³»ç»ŸåŒæ—¶å¯¹ä¸€ä¸ª key è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯æœ€åæ‰§è¡Œçš„é¡ºåºå’Œæˆ‘ä»¬æœŸæœ›çš„é¡ºåºä¸åŒï¼Œè¿™æ ·ä¹Ÿå°±å¯¼è‡´äº†ç»“æœçš„ä¸åŒã€‚</p></blockquote><ul><li><p>è§£å†³æ–¹æ¡ˆï¼š<strong>åˆ†å¸ƒå¼é”</strong>ï¼ˆzookeeper å’Œ Redis éƒ½å¯ä»¥å®ç°åˆ†å¸ƒå¼é”ï¼‰ã€‚</p><ul><li><p><strong>zookeeperåˆ†å¸ƒå¼é”</strong>ï¼šï¼ˆ1ï¼‰æ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨zookeeperä¸Šçš„ ä¸è¯¥æ–¹æ³•å¯¹åº”çš„æŒ‡å®šèŠ‚ç‚¹çš„ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç¬æ—¶æœ‰åºèŠ‚ç‚¹ï¼›ï¼ˆ2ï¼‰åˆ¤æ–­æ˜¯å¦è·å–é”çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­æœ‰ åºèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ä¸€ä¸ªï¼›ï¼ˆ3ï¼‰å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªç¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚</p><blockquote><p>åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚</p></blockquote></li></ul></li></ul><h4 id="6-Redisåˆ é™¤keyçš„åº•å±‚åŸç†å®ç°ï¼Ÿ">6. Redisåˆ é™¤keyçš„åº•å±‚åŸç†å®ç°ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.hoohack.me/2019/06/24/redis-expire-strategy">https://www.hoohack.me/2019/06/24/redis-expire-strategy</a></p></blockquote><p>Redisåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæ³¨å†Œä¸¤ç§äº‹ä»¶ï¼š</p><ol><li><strong>æ—¶é—´äº‹ä»¶</strong>ï¼š Rediså¤„ç†åå°æ“ä½œçš„ä¸€ç±»äº‹ä»¶ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯è¶…æ—¶ã€åˆ é™¤è¿‡æœŸkey</li><li><strong>æ–‡ä»¶äº‹ä»¶</strong>ï¼š redisæ³¨å†Œçš„å›è°ƒå‡½æ•°æ˜¯serverCronï¼Œåœ¨<strong>å®šæ—¶ä»»åŠ¡ï¼ˆæƒ°æ€§åˆ é™¤</strong>ï¼‰å›è°ƒå‡½æ•°ä¸­ï¼Œé€šè¿‡è°ƒç”¨databasesCronæ¸…ç†éƒ¨åˆ†è¿‡æœŸkey</li></ol><p><strong>å®šæ—¶åˆ é™¤</strong></p><p>å¯¹äºæ¯ä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyéƒ½ä¼šåˆ›å»ºä¸€ä¸ª<strong>å®šæ—¶å™¨</strong>ï¼Œä¸€æ—¦åˆ°è¾¾è¿‡æœŸæ—¶é—´å°±ç«‹å³åˆ é™¤ï¼š</p><ul><li>ç¼ºç‚¹ï¼šå ç”¨äº†å¤§é‡çš„CPUèµ„æºå»å¤„ç†è¿‡æœŸçš„æ•°æ®ï¼Œä¼šå½±å“Redisçš„ååé‡å’Œå“åº”æ—¶é—´ã€‚</li></ul><p><strong>æƒ°æ€§åˆ é™¤</strong></p><p><strong>æ¯æ¬¡è®¿é—®keyçš„æ—¶å€™</strong>ï¼Œéƒ½ä¼šè°ƒç”¨<code>expireIfNeeded</code>å‡½æ•°åˆ¤æ–­keyæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ˜¯ï¼Œæ¸…ç†keyï¼š</p><ul><li>ç¼ºç‚¹ï¼šå¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰è¢«å†æ¬¡è®¿é—®ï¼Œå› æ­¤ä¸ä¼šè¢«æ¸…é™¤ï¼Œå¯¼è‡´å ç”¨äº†å¤§é‡çš„å†…å­˜ã€‚</li></ul><p><strong>å®šæœŸåˆ é™¤</strong></p><p>æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œæ‰«æRedisä¸­è¿‡æœŸkeyå­—å…¸ï¼Œå¹¶æ¸…é™¤éƒ¨åˆ†è¿‡æœŸçš„keyï¼š</p><ul><li>ç¼ºç‚¹ï¼šæŠ˜ä¸­æ–¹æ¡ˆ</li></ul><p><strong>Rediså•çº¿ç¨‹æ¸…ç†keyçš„æ—¶æœº</strong></p><p>Redisæ˜¯ä»¥<strong>å•çº¿ç¨‹è¿è¡Œçš„ï¼Œåœ¨æ¸…ç†keyæ˜¯ä¸èƒ½å ç”¨è¿‡å¤šçš„æ—¶é—´å’ŒCPU</strong>ï¼Œéœ€è¦åœ¨å°½é‡ä¸å½±å“æ­£å¸¸çš„æœåŠ¡æƒ…å†µä¸‹ï¼Œè¿›è¡Œè¿‡æœŸkeyçš„æ¸…ç†ã€‚</p><ul><li><p><strong>ä»¥éšæœºåˆ é™¤ä¸ºä¾‹</strong></p><ol><li><p>server.hzé…ç½®äº†serverCronä»»åŠ¡çš„æ‰§è¡Œå‘¨æœŸï¼Œé»˜è®¤æ˜¯10ï¼Œ<strong>å³CPUç©ºé—²æ—¶æ¯ç§’æ‰§è¡Œåæ¬¡</strong>ï¼›</p></li><li><p><strong>æ¯æ¬¡æ¸…ç†è¿‡æœŸkeyçš„æ—¶é—´ä¸èƒ½è¶…è¿‡CPUæ—¶é—´çš„25%</strong> ï¼›</p></li><li><p>å¦‚æœæ˜¯å¿«é€Ÿæ¸…ç†æ¨¡å¼ï¼ˆåœ¨beforeSleepå‡½æ•°è°ƒç”¨ï¼‰ï¼Œåˆ™ä¸€æ¬¡æ¸…ç†çš„æœ€å¤§æ—¶é—´æ˜¯1msï¼›</p></li><li><p>ä¾æ¬¡éå†æ‰€æœ‰çš„DBï¼›</p></li><li><p>ä»dbçš„è¿‡æœŸåˆ—è¡¨ä¸­éšæœºå–20ä¸ªkeyï¼Œåˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œåˆ™æ¸…ç†ï¼›</p></li><li><p>å¦‚æœæœ‰5ä¸ªä»¥ä¸Šçš„keyè¿‡æœŸï¼Œåˆ™é‡å¤æ­¥éª¤5ï¼Œå¦åˆ™ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªdb ï¼›</p></li><li><p>åœ¨æ¸…ç†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¾¾åˆ°CPUçš„25%æ—¶é—´ï¼Œé€€å‡ºæ¸…ç†è¿‡ç¨‹ã€‚</p></li></ol></li><li><p><strong>Redis4.0ä½¿ç”¨BIOå¤„ç†</strong></p><p>Redis4.0ä»¥å‰ï¼Œåˆ é™¤æŒ‡ä»¤æ˜¯delï¼Œdelä¼šç›´æ¥é‡Šæ”¾å¯¹è±¡çš„å†…å­˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœåˆ é™¤çš„keyæ˜¯ä¸€ä¸ª<strong>éå¸¸å¤§çš„å¯¹è±¡</strong>ï¼Œé‚£ä¹ˆåˆ é™¤æ“ä½œå°±ä¼šå¯¼è‡´å•çº¿ç¨‹å¡é¡¿ï¼ŒRedisçš„å“åº”å°±æ…¢äº†ã€‚</p><ul><li>åœ¨Redis4.0ç‰ˆæœ¬å¼•å…¥äº†unlinkæŒ‡ä»¤ï¼Œèƒ½å¯¹åˆ é™¤æ“ä½œè¿›è¡Œâ€œæ‡’â€å¤„ç†ï¼Œ<strong>å°†åˆ é™¤æ“ä½œä¸¢ç»™åå°çº¿ç¨‹ï¼Œç”±åå°çº¿ç¨‹BIOæ¥å¼‚æ­¥å›æ”¶å†…å­˜</strong>ã€‚</li></ul></li></ul><p><strong>å†…å­˜æ·˜æ±°ç­–ç•¥</strong></p><p>Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œæ˜¯æŒ‡å†…å­˜è¾¾åˆ°maxmemoryæé™æ—¶ï¼Œä½¿ç”¨æŸç§ç®—æ³•æ¥å†³å®šæ¸…ç†æ‰å“ªäº›æ•°æ®ï¼Œä»¥ä¿è¯æ–°æ•°æ®çš„å­˜å…¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰_è®¡ç®—æœºåŸºç¡€_MySQL</title>
      <link href="/p/56848/"/>
      <url>/p/56848/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>äº”ã€MySQL</h1><h2 id="5-1-MySQLåŸºæœ¬">5.1 MySQLåŸºæœ¬</h2><h4 id="0-å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“çš„åŒºåˆ«ï¼Ÿ">0. å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“çš„åŒºåˆ«ï¼Ÿ</h4><ul><li><strong>å…³ç³»å‹æ•°æ®åº“çš„ä¼˜ç‚¹</strong><ul><li>å®¹æ˜“ç†è§£ï¼Œå› ä¸ºå®ƒé‡‡ç”¨äº†å…³ç³»æ¨¡å‹æ¥ç»„ç»‡æ•°æ®ï¼›</li><li>å¯ä»¥<strong>ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§</strong>ï¼›</li><li>æ•°æ®<strong>æ›´æ–°çš„å¼€é”€æ¯”è¾ƒå°</strong>ï¼›</li><li><strong>æ”¯æŒå¤æ‚æŸ¥è¯¢</strong>ï¼ˆå¸¦whereå­å¥çš„æŸ¥è¯¢ï¼‰ã€‚</li></ul></li><li><strong>éå…³ç³»å‹æ•°æ®åº“çš„ä¼˜ç‚¹</strong><ul><li>ä¸éœ€è¦ç»è¿‡SQLå±‚çš„è§£æï¼Œ<strong>è¯»å†™æ•ˆç‡é«˜</strong>ï¼›</li><li><strong>åŸºäºé”®å€¼å¯¹</strong>ï¼Œæ•°æ®çš„æ‰©å±•æ€§å¾ˆå¥½ï¼›</li><li><strong>æ”¯æŒå¤šç§ç±»å‹æ•°æ®çš„å­˜å‚¨</strong>ï¼Œå¦‚å›¾ç‰‡ï¼Œæ–‡æ¡£ç­‰ç­‰ã€‚</li></ul></li></ul><h4 id="1-ä»‹ç»ä¸€ä¸‹æ•°æ®åº“ä¸‰èŒƒå¼ï¼Ÿ">1.<strong>ä»‹ç»ä¸€ä¸‹æ•°æ®åº“ä¸‰èŒƒå¼</strong>ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/linjiqin/archive/2012/04/01/2428695.html">https://www.cnblogs.com/linjiqin/archive/2012/04/01/2428695.html</a></p></blockquote><ul><li><p><strong>ç¬¬ä¸€èŒƒå¼</strong>ï¼š æ•°æ®åº“è¡¨ä¸­çš„<u>æ‰€æœ‰å­—æ®µå€¼éƒ½æ˜¯ä¸å¯åˆ†è§£çš„åŸå­å€¼</u> ã€‚</p><blockquote><p>æ•°æ®åº“ç³»ç»Ÿä¸­éœ€è¦ç”¨åˆ°â€œåœ°å€â€è¿™ä¸ªå±æ€§ï¼Œæœ¬æ¥ç›´æ¥å°†â€œåœ°å€â€å±æ€§è®¾è®¡æˆä¸€ä¸ªæ•°æ®åº“è¡¨çš„å­—æ®µå°±è¡Œã€‚ä½†æ˜¯å¦‚æœç³»ç»Ÿç»å¸¸ä¼šè®¿é—®â€œåœ°å€â€å±æ€§ä¸­çš„â€œåŸå¸‚â€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå°±éè¦<u>å°†â€œåœ°å€â€è¿™ä¸ªå±æ€§é‡æ–°æ‹†åˆ†ä¸ºçœä»½ã€åŸå¸‚ã€è¯¦ç»†åœ°å€</u>ç­‰å¤šä¸ªéƒ¨åˆ†è¿›è¡Œå­˜å‚¨ã€‚</p><p><img src="https://i.loli.net/2021/05/03/NiPm9KajxLXpRQf.png" alt="img"></p></blockquote></li><li><p><strong>ç¬¬äºŒèŒƒå¼</strong>ï¼š ç¬¬äºŒèŒƒå¼åŸºäºç¬¬ä¸€èŒƒå¼ï¼Œä¸”è¦æ±‚ï¼š<u>æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å’Œä¸»é”®ç›¸å…³ï¼Œä¸”ä¸èƒ½åªä¸ä¸»é”®çš„æŸä¸€éƒ¨åˆ†ç›¸å…³</u>ï¼ˆä¸»è¦é’ˆå¯¹è”åˆä¸»é”®è€Œè¨€ï¼‰, å³<strong>ä¸å­˜åœ¨éƒ¨åˆ†ä¾èµ–</strong>ï¼›</p><blockquote><p>ä¸‹è¡¨æ˜¯ä»¥ï¼š<u>è®¢å•ç¼–å·&amp;å•†å“ç¼–å·</u>ä½œä¸ºè”åˆä¸»é”®ã€‚è¿™æ ·åœ¨è¯¥<strong>è¡¨ä¸­å•†å“åç§°ã€å•ä½ã€å•†å“ä»·æ ¼ç­‰ä¿¡æ¯ä¸ä¸è¯¥è¡¨çš„è®¢å•ç¼–å·ç›¸å…³</strong>ï¼Œè€Œä»…ä»…æ˜¯ä¸å•†å“ç¼–å·ç›¸å…³ã€‚</p><p><img src="https://i.loli.net/2021/05/03/RoCLmOBcgJKhvyx.png" alt="img"></p><p>æ‰€ä»¥æ ¹æ®ç¬¬äºŒèŒƒå¼ï¼Œå°†å®ƒè¿›è¡Œæ‹†åˆ†ä¸‰ä¸ªè¡¨ï¼š</p><p><img src="https://i.loli.net/2021/05/03/TnN8t5k3lrWxIgp.png" alt="img"></p></blockquote></li><li><p><strong>ç¬¬ä¸‰èŒƒå¼</strong>ï¼š åŸºäºç¬¬äºŒèŒƒå¼ï¼Œæ•°æ®è¡¨ä¸­çš„æ¯ä¸€åˆ—æ•°æ®éƒ½å’Œä¸»é”®<strong>ç›´æ¥ç›¸å…³</strong>ï¼Œå³<strong>ä¸å­˜åœ¨ä¼ é€’ä¾èµ–</strong>ï¼›</p><blockquote><p>æ¯”å¦‚åœ¨è®¾è®¡ä¸€ä¸ªè®¢å•æ•°æ®è¡¨çš„æ—¶å€™ï¼Œå¯ä»¥å°†å®¢æˆ·ç¼–å·ä½œä¸ºä¸€ä¸ªå¤–é”®å’Œè®¢å•è¡¨å»ºç«‹ç›¸åº”çš„å…³ç³»ã€‚è€Œä¸å¯ä»¥åœ¨è®¢å•è¡¨ä¸­æ·»åŠ å…³äºå®¢æˆ·å…¶å®ƒä¿¡æ¯ï¼ˆæ¯”å¦‚å§“åã€æ‰€å±å…¬å¸ç­‰ï¼‰çš„å­—æ®µã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/2012040114105477.png" alt="img"></p></blockquote></li></ul><h4 id="2-MySQLæ•°æ®åº“å¼•æ“æœ‰å“ªäº›ï¼Ÿ">2. <strong>MySQLæ•°æ®åº“å¼•æ“æœ‰å“ªäº›</strong>ï¼Ÿ</h4><blockquote><p>MySQLæŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®å¼•æ“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show engines;</span><br></pre></td></tr></table></figure></blockquote><p>MySQLå¸¸ç”¨å¼•æ“åŒ…æ‹¬ï¼š<code>MYISAM</code>ã€<code>Innodb</code>ã€<code>Memory</code>ã€<code>MERGE</code>ï¼Œ</p><ul><li><p><strong><code>MYISAM</code></strong> ï¼ˆè¯»ï¼šmy+i+sonï¼‰</p><p>ä»¥selectã€insertä¸ºä¸»çš„åº”ç”¨åŸºæœ¬ä¸Šå¯ä»¥ä½¿ç”¨è¿™å¼•æ“ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<strong>å…¨è¡¨é”</strong>ï¼Œæ‹¥æœ‰è¾ƒé«˜çš„æ‰§è¡Œé€Ÿåº¦ï¼Œå ç”¨ç©ºé—´å°ï¼›</li><li><strong>ç¼ºç‚¹</strong> ï¼šä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®ï¼Œå¹¶å‘æ€§èƒ½å·®ã€‚</li></ul></li><li><p><strong><code>Innodb</code></strong></p><p>Innodbå¼•æ“æä¾›äº†å¯¹æ•°æ®åº“ACID<strong>äº‹åŠ¡</strong>çš„æ”¯æŒï¼Œå¹¶ä¸”å®ç°äº†SQLæ ‡å‡†çš„å››ç§éš”ç¦»çº§åˆ«ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯<u>å¤„ç†å¤§å®¹é‡æ•°æ®åº“ç³»ç»Ÿ</u>ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<strong>è¡Œçº§é”</strong>ï¼Œ<strong>æ”¯æŒäº‹åŠ¡</strong>ï¼Œæ”¯æŒ<u><strong>è‡ªåŠ¨å¢é•¿åˆ—</strong></u>ï¼Œæ”¯æŒå¤–é”®çº¦æŸï¼Œ<strong>å¹¶å‘èƒ½åŠ›å¼º</strong></li><li><strong>ç¼ºç‚¹</strong>ï¼š å ç”¨ç©ºé—´æ˜¯MYISAMçš„2å€ï¼Œå¤„ç†æ•ˆç‡ç›¸å¯¹ä¹Ÿæ›´ä½</li></ul></li><li><p><strong><code>Memory</code></strong></p><p>ä¸»è¦ç”¨äº<strong>å†…å®¹å˜åŒ–ä¸é¢‘ç¹çš„</strong>ä»£ç è¡¨ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<strong>å…¨è¡¨é”</strong>ï¼Œ<u>å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé»˜è®¤ä½¿ç”¨Hashï¼Œæ£€ç´¢æ•ˆç‡éå¸¸é«˜</u></li><li><strong>ç¼ºç‚¹</strong>ï¼š ä¼šå ç”¨å’Œæ•°æ®é‡æˆæ­£æ¯”çš„å†…å­˜ç©ºé—´ä¸”ï¼Œmysqlé‡å¯æ—¶ä¼šä¸¢å¤±ï¼Œä¸é€‚åˆç²¾ç¡®æŸ¥æ‰¾</li></ul></li><li><p><strong><code>MERGE</code></strong></p><p>æ˜¯ä¸€ç»„MYISAMè¡¨çš„ç»„åˆã€‚</p></li></ul><h5 id="2-1-InnoDBã€MyISAMã€Memory-ã€ç´¢å¼•ã€‘ï¼ˆæŒ‰æ•°æ®ç»“æ„åˆ†ï¼‰">2.1 InnoDBã€MyISAMã€Memory ã€ç´¢å¼•ã€‘ï¼ˆæŒ‰æ•°æ®ç»“æ„åˆ†ï¼‰</h5><blockquote><p>å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000037683781">https://segmentfault.com/a/1190000037683781</a></p></blockquote><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210820194526488.png" alt="image-20210820194526488"></p><h5 id="2-2-ä¸ºä»€ä¹ˆInnodbä½¿ç”¨è‡ªå¢idä½œä¸ºä¸»é”®ï¼Ÿ">2.2 ä¸ºä»€ä¹ˆInnodbä½¿ç”¨è‡ªå¢idä½œä¸ºä¸»é”®ï¼Ÿ</h5><ul><li><strong>å¦‚æœä¸ä½¿ç”¨è‡ªå¢ä¸»é”®</strong>ï¼Œ å¦‚èº«ä»½è¯å·ã€å­¦å·ï¼Œæ¯æ¬¡æ’å…¥ä¸»é”®çš„å€¼è¿‘ä¼¼äºéšæœºï¼Œå› æ­¤æ¯æ¬¡æ–°çºªå½•éƒ½è¦è¢«æ’åˆ°ç°æœ‰ç´¢å¼•é¡µå¾—ä¸­é—´æŸä¸ªä½ç½®ï¼ˆ<strong>æ¶‰åŠåˆ°B+æ ‘åˆ†è£‚ç­‰</strong>ï¼‰ï¼Œ é¢‘ç¹çš„ç§»åŠ¨ã€åˆ†é¡µæ“ä½œé€ æˆäº†å¤§é‡çš„ç¢ç‰‡ï¼›</li><li><strong>å¦‚æœä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œ</strong> é‚£ä¹ˆæ¯æ¬¡æ’å…¥æ–°çš„è®°å½•ï¼Œè®°å½•å°±ä¼šé¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„åç»­ä½ç½®ï¼Œå½“ä¸€é¡µå†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µã€‚</li></ul><h4 id="3-è¯´è¯´InnoDBä¸MyISAMçš„åŒºåˆ«ï¼Ÿ">3.<strong>è¯´è¯´InnoDBä¸MyISAMçš„åŒºåˆ«</strong>ï¼Ÿ</h4><p>è§å‰ã€‚</p><h5 id="3-1-è¯´è¯´InnoDBä¸MyISAMåœ¨B-æ•°ç´¢å¼•æ–¹å¼åŒºåˆ«ï¼Ÿ">3.1 è¯´è¯´InnoDBä¸MyISAMåœ¨B+æ•°ç´¢å¼•æ–¹å¼åŒºåˆ«ï¼Ÿ</h5><ul><li><p><strong>MyISAm</strong> , B+Treeå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®<strong>è®°å½•çš„åœ°å€</strong>ï¼Œåœ¨ç´¢å¼•æ£€ç´¢çš„æ—¶å€™ï¼Œå¦‚æœæŒ‡å®šçš„keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€è¯»å–ç›¸åº”çš„æ•°æ®è®°å½•ï¼Œè¿™è¢«ç§°ä¸ºâ€œéèšç°‡ç´¢å¼•â€ ï¼›</p></li><li><p><strong>InnoDBï¼Œ</strong> æ ‘çš„èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ï¼Œè¿™ä¸ªç´¢å¼•çš„<strong>keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼ˆè‡ªå¢idï¼‰</strong> ï¼›è€Œ<strong>å…¶å®ƒç´¢å¼•éƒ½å«åšè¾…åŠ©ç´¢å¼•</strong>ï¼Œ åŠ©ç´¢å¼•çš„dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•<strong>ä¸»é”®çš„å€¼</strong>è€Œä¸æ˜¯è®°å½•åœ°å€ã€‚</p><blockquote><ul><li>åœ¨æ ¹æ®ä¸»ç´¢å¼•æœç´¢æ—¶ï¼Œç›´æ¥æ‰¾åˆ°keyæ‰€åœ¨çš„èŠ‚ç‚¹å³å¯å–å‡ºæ•°æ®ï¼›</li><li>åœ¨æ ¹æ®è¾…åŠ©ç´¢å¼•æŸ¥æ‰¾æ—¶ï¼Œåˆ™éœ€è¦å…ˆå–å‡ºä¸»é”®çš„å€¼ï¼Œå†èµ°ä¸€éä¸»ç´¢å¼•ã€‚</li></ul></blockquote></li></ul><h5 id="3-2-ã€ç™¾åº¦ã€‘è¯´è¯´InnoDBä¸MyISAMåœ¨é€‚ç”¨åœºæ™¯ä¸Šçš„åŒºåˆ«ï¼Ÿ">3.2 ã€ç™¾åº¦ã€‘è¯´è¯´InnoDBä¸MyISAMåœ¨é€‚ç”¨åœºæ™¯ä¸Šçš„åŒºåˆ«ï¼Ÿ</h5><ul><li><strong>MyISAM</strong> ï¼Œæ²¡æœ‰äº‹åŠ¡ï¼Œ é€‚åˆ<strong>æ’å…¥ä¸é¢‘ç¹ï¼ŒæŸ¥è¯¢éå¸¸é¢‘ç¹</strong>ï¼›</li><li><strong>Innodbï¼š</strong> æœ‰äº‹åŠ¡ï¼Œé€‚åˆ<strong>å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜</strong>ï¼Œæˆ–è€…<strong>æ›´æ–°å’ŒæŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹</strong>ã€‚</li></ul><h4 id="4-ä¸ºä»€ä¹ˆ-SELECT-COUNT-FROM-table-åœ¨-InnoDB-æ¯”MyISAM-æ…¢ï¼Ÿ">4. ä¸ºä»€ä¹ˆ SELECT COUNT(*) FROM table åœ¨ InnoDB æ¯”MyISAM æ…¢ï¼Ÿ</h4><p>å¯¹äº SELECT COUNT(*) FROM table è¯­å¥ï¼Œåœ¨æ²¡æœ‰ WHERE æ¡ä»¶çš„æƒ…å†µä¸‹ï¼ŒInnoDB æ¯” MyISAM å¯èƒ½ä¼šæ…¢å¾ˆå¤šï¼Œå°¤å…¶åœ¨å¤§è¡¨çš„æƒ…å†µä¸‹ã€‚</p><ul><li>InnoDB æ˜¯å»å®æ—¶ç»Ÿè®¡ç»“æœï¼Œä¼š<strong>å…¨è¡¨æ‰«æ</strong>ï¼›</li><li>è€Œ MyISAMå†…éƒ¨ç»´æŒäº†ä¸€ä¸ª<u><strong>è®¡æ•°å™¨</strong></u>ï¼Œ<strong>é¢„å­˜äº†ç»“æœ</strong>ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›å³å¯ã€‚</li></ul><h4 id="5-ç®€å•è¯´ä¸€è¯´dropã€deleteä¸truncateçš„åŒºåˆ«ï¼Ÿ">5.<strong>ç®€å•è¯´ä¸€è¯´dropã€deleteä¸truncateçš„åŒºåˆ«</strong>ï¼Ÿ</h4><p>SQLä¸­çš„dropã€deleteã€truncateéƒ½è¡¨ç¤ºåˆ é™¤ï¼Œä½†æ˜¯ä¸‰è€…æœ‰ä¸€äº›å·®åˆ«ï¼š</p><ul><li><strong>åˆ é™¤ç±»å‹</strong>ï¼š dropåˆ é™¤è¡¨ç»“æ„ï¼›deleteã€truncateåˆ é™¤è¡¨å†…å®¹ã€‚</li><li><strong>åˆ é™¤é€Ÿåº¦</strong>ï¼š  <strong>drop</strong>&gt; truncate &gt;delete</li><li><strong>ç”Ÿæ•ˆé€Ÿåº¦</strong>ï¼š dropå’Œtruncate ï¼Œæ“ä½œç«‹å³ç”Ÿæ•ˆï¼Œä¸èƒ½å›æ»šä¹Ÿä¸è§¦å‘è§¦å‘å™¨ï¼›<strong>deleteäº‹åŠ¡æäº¤åæ‰ç”Ÿæ•ˆï¼Œä¼šè§¦å‘ç›¸åº”è§¦å‘å™¨</strong>ã€‚</li></ul><h4 id="6-ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ-æ¸¸æ ‡ï¼Ÿ">6.<strong>ä»€ä¹ˆæ˜¯è§†å›¾</strong>ï¼Ÿ æ¸¸æ ‡ï¼Ÿ</h4><p>è§†å›¾æ˜¯ä¸€ç§è™šæ‹Ÿçš„è¡¨ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªè¡¨æˆ–è€…å¤šä¸ªè¡¨çš„è¡Œæˆ–åˆ—çš„å­é›†ï¼Œå…·æœ‰å’Œç‰©ç†è¡¨ç›¸åŒçš„åŠŸèƒ½ã€‚</p><ul><li>å¯ä»¥å¯¹è§†å›¾è¿›è¡Œå¢ï¼Œæ”¹ï¼ŒæŸ¥ï¼Œæ“ä½œï¼Œä½†<strong>å¯¹è§†å›¾çš„ä¿®æ”¹ä¸å½±å“åŸºæœ¬è¡¨</strong>ï¼›</li><li>ç›¸æ¯”å¤šè¡¨æŸ¥è¯¢ï¼Œè·å–æ•°æ®é€Ÿåº¦æ›´å®¹æ˜“ã€‚</li></ul><p>æ¸¸æ ‡ï¼Œæ˜¯å¯¹<strong>æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†</strong>ä½œä¸ºä¸€ä¸ªå•å…ƒæ¥æœ‰æ•ˆçš„å¤„ç†ã€‚</p><ul><li>ä¸€èˆ¬ä¸ä½¿ç”¨æ¸¸æ ‡ï¼Œä½†æ˜¯éœ€è¦é€æ¡å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œæ¸¸æ ‡æ˜¾å¾—ååˆ†é‡è¦ã€‚</li></ul><h4 id="7-ä»€ä¹ˆæ˜¯å†…è”æ¥ã€å·¦å¤–è”æ¥ã€å³å¤–è”æ¥ï¼Ÿ">7.<strong>ä»€ä¹ˆæ˜¯å†…è”æ¥ã€å·¦å¤–è”æ¥ã€å³å¤–è”æ¥</strong>ï¼Ÿ</h4><ul><li><p><strong>å†…è”æ¥ï¼ˆInner Joinï¼‰</strong>ï¼šä¸¤ä¸ªè¡¨ï¼ˆæˆ–è¿æ¥ï¼‰ä¸­æŸä¸€æ•°æ®é¡¹ç›¸ç­‰çš„è¿æ¥ç§°ä¸ºå†…è¿æ¥ã€‚ è¿æ¥çš„ç»“æœæ˜¯å½¢æˆä¸€ä¸ªæ–°çš„æ•°æ®è¡¨ã€‚ å†…è¿æ¥ä¸­å‚ä¸è¿æ¥çš„è¡¨ï¼ˆæˆ–è¿æ¥ï¼‰çš„åœ°ä½æ˜¯ç›¸ç­‰çš„ï¼›</p></li><li><p><strong>å·¦å¤–è”æ¥ï¼ˆLeft Outer Join</strong>ï¼‰ï¼šé™¤äº†åŒ¹é…2å¼ è¡¨ä¸­ç›¸å…³è”çš„è®°å½•å¤–ï¼Œ<u>è¿˜ä¼šåŒ¹é…å·¦è¡¨ä¸­å‰©ä½™çš„è®°å½•</u>ï¼Œ<u>å³è¡¨ä¸­æœªåŒ¹é…åˆ°çš„å­—æ®µç”¨NULLè¡¨ç¤º</u>ï¼›</p></li><li><p><strong>å³å¤–è”æ¥ï¼ˆRight Outer Joinï¼‰</strong>ï¼šé™¤äº†åŒ¹é…2å¼ è¡¨ä¸­ç›¸å…³è”çš„è®°å½•å¤–ï¼Œè¿˜ä¼š<u>åŒ¹é…å³è¡¨ä¸­å‰©ä½™çš„è®°å½•ï¼Œå·¦è¡¨ä¸­æœªåŒ¹é…åˆ°çš„å­—æ®µç”¨NULLè¡¨ç¤º</u>ã€‚</p></li></ul><h4 id="8-è¯´è¯´åœ¨-MySQL-ä¸­ä¸€æ¡æŸ¥è¯¢-SQL-æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ">8.<strong>è¯´è¯´åœ¨ MySQL ä¸­ä¸€æ¡æŸ¥è¯¢ SQL æ˜¯å¦‚ä½•æ‰§è¡Œçš„</strong>ï¼Ÿ</h4><p>ä¾‹å¦‚ï¼š<code>select name from t_user where id=1</code></p><ol><li><p><strong>å–å¾—é“¾æ¥</strong>ï¼Œä½¿ç”¨ä½¿ç”¨åˆ° MySQL ä¸­çš„<strong>è¿æ¥å™¨</strong>ï¼›</p></li><li><p><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼Œkey ä¸º SQL è¯­å¥ï¼Œvalue ä¸ºæŸ¥è¯¢ç»“æœï¼Œå¦‚æœæŸ¥åˆ°å°±ç›´æ¥è¿”å›ï¼›</p><blockquote><p>åœ¨ MySQL 8.0 ç‰ˆæœ¬å·²ç»å°†æŸ¥è¯¢ç¼“å­˜åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´ MySQL 8.0 ç‰ˆæœ¬åä¸å­˜åœ¨æ­¤åŠŸèƒ½ã€‚</p></blockquote></li><li><p><strong>åˆ†æå™¨</strong>ï¼Œåˆ†ä¸ºè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æã€‚æ­¤é˜¶æ®µåªæ˜¯åšä¸€äº› SQL è§£æï¼Œè¯­æ³•æ ¡éªŒã€‚æ‰€ä»¥ä¸€èˆ¬è¯­æ³•é”™è¯¯åœ¨æ­¤é˜¶æ®µï¼›</p></li><li><p><strong>ä¼˜åŒ–å™¨</strong>ï¼Œæ˜¯åœ¨è¡¨é‡Œ<strong>æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•</strong>ï¼›æˆ–è€…ä¸€ä¸ªè¯­å¥ä¸­å­˜åœ¨å¤šè¡¨å…³è”çš„æ—¶å€™ï¼ˆjoinï¼‰ï¼Œå†³å®š<strong>å„ä¸ªè¡¨çš„è¿æ¥é¡ºåº</strong>ï¼›</p></li><li><p><strong>æ‰§è¡Œå™¨</strong>ï¼Œå¼€å§‹æ‰§è¡Œè¯­å¥ã€‚æ‰§è¡Œè¯­å¥çš„æ—¶å€™è¿˜è¦åˆ¤æ–­æ˜¯å¦å…·å¤‡æ­¤æƒé™ï¼Œå¦‚æœæœ‰æƒé™ï¼šï¼ˆ1ï¼‰æ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œä½¿ç”¨å¼•æ“æä¾›çš„æ¥å£ï¼Œè·å–è¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­idæ˜¯å¦ç­‰äº1 ï¼›ï¼ˆ2ï¼‰å¦‚æœä¸æ˜¯åˆ™ç»§ç»­è°ƒç”¨å¼•æ“æ¥å£å»è·å–ä¸‹ä¸€è¡Œï¼Œç»§ç»­åˆ¤æ–­ï¼›ï¼ˆ3ï¼‰ç›´è‡³å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œ</p></li></ol><h4 id="9-MySQL-ä¸­-varchar-ä¸-char-çš„åŒºåˆ«ï¼Ÿ-int-3-å‘¢ï¼Ÿ">9. <strong>MySQL ä¸­ varchar ä¸ char çš„åŒºåˆ«</strong>ï¼Ÿ int(3) å‘¢ï¼Ÿ</h4><ul><li><p>char æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ç±»å‹ï¼Œvarchar åˆ™æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„ç±»å‹ã€‚</p><p><img src="https://i.loli.net/2021/05/03/SoHv6lyhp94TwWP.png" alt="image-20210503214113219"></p></li><li><p><strong>float(3,2) å’Œ int(3)</strong></p><ul><li><code>float(3,2)</code> : &quot;æµ®ç‚¹å‹&quot;çš„é•¿åº¦æ˜¯ç”¨æ¥<strong>é™åˆ¶æ•°å­—å­˜å‚¨èŒƒå›´</strong>çš„ã€‚æ¯”å¦‚ float(3,2) åªèƒ½å¤Ÿå†™å…¥ <code>0.00~999.99</code>ã€‚</li><li><code>int(3)</code> ï¼š&quot;æ•´å‹&quot;çš„é•¿åº¦å¹¶<strong>ä¸ä¼šé™åˆ¶å­˜å‚¨çš„æ•°å­—èŒƒå›´</strong>ï¼Œéƒ½æ˜¯<code>-2147483648 ~ 2147483647</code> ã€‚åª<strong>é™åˆ¶æ˜¾ç¤ºé•¿åº¦</strong>ã€‚</li></ul></li></ul><h4 id="10-è¶…é”®ã€ä¸»é”®ã€å€™é€‰é”®å’Œå¤–é”®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">10.<strong>è¶…é”®ã€ä¸»é”®ã€å€™é€‰é”®å’Œå¤–é”®æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><strong>è¶…é”®(super key)</strong>ï¼šåœ¨å…³ç³»ä¸­èƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†ç§°ä¸ºå…³ç³»æ¨¡å¼çš„è¶…é”®ï¼›</li><li><strong>å€™é€‰é”®(candidate key)</strong>ï¼šä¸å«æœ‰å¤šä½™å±æ€§çš„è¶…é”®ç§°ä¸ºå€™é€‰é”®ï¼Œ<u>æ˜¯è¶…é”®çš„å­é›†</u>ï¼›</li><li><strong>ä¸»é”®(primary key)</strong>ï¼šç”¨æˆ·é€‰ä½œå…ƒç»„æ ‡è¯†çš„ä¸€ä¸ªå€™é€‰é”®ç¨‹åºä¸»é”®ï¼Œ<u>æ˜¯å€™é€‰é”®çš„å­é›†</u> ï¼›</li><li><strong>å¤–é”®</strong>ï¼šå¦‚æœå…³ç³»æ¨¡å¼<strong>Rä¸­å±æ€§Kæ˜¯å…¶å®ƒæ¨¡å¼çš„ä¸»é”®</strong>ï¼Œé‚£ä¹ˆ<strong>kåœ¨æ¨¡å¼Rä¸­ç§°ä¸ºå¤–é”®</strong>ã€‚</li></ul><p>ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ï¼ˆ<strong>å‡è®¾å§“åä¸é‡å¤å”¯ä¸€</strong>ï¼‰ï¼š</p><table><thead><tr><th style="text-align:center">èº«ä»½è¯</th><th style="text-align:center">å§“å</th><th style="text-align:center">æ€§åˆ«</th><th style="text-align:center">å¹´é¾„</th></tr></thead><tbody><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><ul><li><u>è¶…é”®ï¼š</u> èº«ä»½è¯ã€å§“åã€ï¼ˆå§“åã€æ€§åˆ«ï¼‰ã€ï¼ˆå§“åã€æ€§åˆ«ã€å¹´é¾„ï¼‰éƒ½å¯ä»¥ä½œä¸ºè¶…é”®ï¼›</li><li><u>å€™é€‰é”®</u> ï¼šèº«ä»½è¯ã€å§“å éƒ½å”¯ä¸€ï¼Œéƒ½å¯ä»¥ä½œä¸ºå€™é€‰é”®ï¼›</li><li><u>ä¸»é”®ï¼š</u> åœ¨å€™é€‰é”®é€‰ä¸€ä¸ªä½œä¸ºä¸»é”®ï¼Œä¾‹å¦‚ï¼šèº«ä»½è¯ã€‚</li></ul><h4 id="11-è§£é‡Šâ¼€ä¸‹ä»€ä¹ˆæ˜¯æ± åŒ–è®¾è®¡æ€æƒ³ã€‚ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± -ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿æ¥æ± ">11.  è§£é‡Šâ¼€ä¸‹ä»€ä¹ˆæ˜¯æ± åŒ–è®¾è®¡æ€æƒ³ã€‚ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± ?ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“è¿æ¥æ± ?</h4><ul><li><p><strong>æ± åŒ–è®¾è®¡æ€æƒ³</strong></p><p>æˆ‘ä»¬å¸¸â»…çš„å¦‚javaçº¿ç¨‹æ± ã€jdbcè¿æ¥æ± ã€redisè¿æ¥æ± ç­‰å°±æ˜¯è¿™ç±»è®¾è®¡çš„ä»£è¡¨å®ç°ã€‚è¿™ç§è®¾è®¡ä¼š<u>åˆå§‹é¢„è®¾èµ„æº</u>ï¼Œ<strong>è§£å†³çš„é—®é¢˜å°±æ˜¯æŠµæ¶ˆæ¯æ¬¡è·å–èµ„æºçš„æ¶ˆè€—ï¼Œå¦‚åˆ›å»ºçº¿ç¨‹çš„å¼€é”€ï¼Œè·å–è¿œç¨‹è¿æ¥çš„å¼€é”€</strong>ç­‰ã€‚</p></li><li><p><strong>æ•°æ®åº“è¿æ¥æ± </strong></p><p>æ•°æ®åº“è¿æ¥æœ¬è´¨å°±æ˜¯â¼€ä¸ª <strong>socket</strong> çš„è¿æ¥ã€‚æ•°æ®åº“æœåŠ¡ç«¯è¿˜è¦ç»´æŠ¤â¼€äº›ç¼“å­˜å’Œâ½¤æˆ·æƒé™ä¿¡æ¯ä¹‹ç±»çš„æ‰€ä»¥<strong>å â½¤äº†â¼€äº›å†…å­˜</strong>ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®åº“è¿æ¥æ± æ˜¯çœ‹åšæ˜¯ç»´æŠ¤çš„æ•°æ®åº“è¿æ¥çš„ç¼“å­˜ï¼Œä»¥ä¾¿å°†æ¥éœ€è¦å¯¹æ•°æ®åº“çš„è¯·æ±‚æ—¶å¯ä»¥<strong>é‡â½¤è¿™äº›è¿æ¥</strong>ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨æ•°æ®åº“è¿æ¥æ± </strong>ï¼Ÿ</p><p>ä¸ºæ¯ä¸ªâ½¤æˆ·æ‰“å¼€å’Œç»´æŠ¤æ•°æ®åº“è¿æ¥ï¼Œå°¤å…¶æ˜¯å¯¹åŠ¨æ€æ•°æ®åº“é©±åŠ¨çš„ç½‘ç«™åº”â½¤ç¨‹åºçš„è¯·æ±‚ï¼Œæ—¢æ˜‚è´µâ¼œæµªè´¹èµ„æºã€‚åœ¨è¿æ¥æ± ä¸­ï¼Œåˆ›å»ºè¿æ¥åï¼Œå°†å…¶æ”¾ç½®åœ¨æ± ä¸­ï¼Œå¹¶å†æ¬¡ä½¿â½¤å®ƒï¼Œå› æ­¤ä¸å¿…å»ºâ½´æ–°çš„è¿æ¥ã€‚å¦‚æœä½¿â½¤äº†æ‰€æœ‰è¿æ¥ï¼Œåˆ™ä¼šå»ºâ½´â¼€ä¸ªæ–°è¿æ¥å¹¶å°†å…¶æ·»åŠ åˆ°æ± ä¸­ã€‚</p></li></ul><h4 id="12-å¦‚æœæ•°æ®ä¸å­˜å‚¨åœ¨ç£ç›˜è€Œæ˜¯åœ¨å†…å­˜ï¼Œç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Ÿä¸ºä»€ä¹ˆMysqlä¸ä½¿ç”¨hashï¼Ÿ">12. å¦‚æœæ•°æ®ä¸å­˜å‚¨åœ¨ç£ç›˜è€Œæ˜¯åœ¨å†…å­˜ï¼Œç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Ÿä¸ºä»€ä¹ˆMysqlä¸ä½¿ç”¨hashï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/wangtao_20/p/3643994.html">ä¸ºä»€ä¹ˆhashä½œä¸ºå†…å­˜ä½¿ç”¨çš„ç»å…¸æ•°æ®ç»“æ„?</a></p></blockquote><p>æ•°æ®æ”¾åœ¨ç£ç›˜ï¼Œä½¿ç”¨<strong>B+æ ‘</strong>ï¼Œ<strong>æ ¸å¿ƒæ˜¯ä¸ºäº†å‡å°‘ç£ç›˜IO</strong>ï¼Œå› ä¸ºç£ç›˜IOçš„ä»£ä»·å¾ˆå¤§ï¼ˆæ˜¯å†…å­˜çš„åä¸‡å€ï¼‰ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨<strong>hash</strong>å¯»æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œ<strong>æ•°æ®éšæœºåˆ†æ•£åˆ°å„ä¸ªç‰©ç†ä½ç½®</strong>ï¼Œä¸æ˜¯æœ‰åºçš„æ•°æ®ã€‚è€Œ<strong>å†…å­˜è®¾å¤‡ä¹Ÿæ˜¯éšæœºè®¿é—®è®¾å¤‡</strong>ï¼Œå†…å­˜å¾ˆé€‚åˆç”¨hashæ–¹å¼æ¥è¯»å–æ•°æ®ã€‚</p><ul><li><p><strong>éšæœºè®¿é—®</strong>ï¼šå­˜å‚¨å™¨å•å…ƒçš„å†…å®¹å¯ä»¥æ ¹æ®éœ€è¦è‡ªç”±å–å‡ºæˆ–å­˜å‚¨ï¼Œè€Œä¸”<strong>è®¿é—®çš„é€Ÿåº¦ä¸å­˜å‚¨å™¨å•å…ƒçš„ä½ç½®</strong>æ— å…³ ã€‚(é€šè¿‡è¡Œï¼Œåˆ—åœ°å€æ€»çº¿å°±å¯ä»¥å¿«é€Ÿå®šä½å­˜å‚¨çš„æ•°æ®)</p><blockquote><p>ä½†æ˜¯ç£ç›˜ï¼Œæ¯æ¬¡è®¿é—®æ•°æ®ï¼Œæ˜¯éœ€è¦å…ˆå®šä½ï¼Œç„¶å<strong>é¡ºåº</strong>ç§»åŠ¨ï¼›å¦‚æœä¸‹ä¸ªæ•°æ®ä¸åœ¨ç£å¤´é™„è¿‘ï¼Œåˆè¦é‡æ–°å®šä½ã€‚</p><p>å¦‚æœHashç´¢å¼•ç£ç›˜æ•°æ®ï¼Œï¼ˆ1ï¼‰æ¯æ¬¡è®¿é—®éƒ½è¦IO<strong>ä¸èƒ½èŒƒå›´</strong>ï¼ˆ2ï¼‰æ•°æ®å¤ªå¤šï¼ŒHashç´¢å¼•ä¿å­˜ä¸äº†é”®å€¼ï¼Œè€Œ<strong>é«˜åº¦ä¸º3çš„B+æ•°å°±èƒ½ä¿å­˜åƒä¸‡çº§åˆ«çš„æ•°æ®</strong>ï¼ˆ3ï¼‰å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œ<strong>hashå†²çª</strong>çš„æ¦‚ç‡ä¹Ÿä¼šéå¸¸å¤§ï¼ˆ4ï¼‰ç»„åˆç´¢å¼•å¯ä»¥æ”¯æŒéƒ¨åˆ†ç´¢å¼•æŸ¥è¯¢ï¼Œå¦‚(a,b,c)çš„ç»„åˆç´¢å¼•ï¼ŒæŸ¥è¯¢ä¸­åªç”¨åˆ°äº†é˜¿å’Œbä¹Ÿå¯ä»¥æŸ¥è¯¢çš„ï¼Œå¦‚æœä½¿ç”¨hashè¡¨ï¼Œç»„åˆç´¢å¼•ä¼šå°†å‡ ä¸ªå­—æ®µåˆå¹¶hashï¼Œ<strong>æ²¡åŠæ³•æ”¯æŒéƒ¨åˆ†ç´¢å¼•</strong> ï¼ˆ5ï¼‰å½“éœ€è¦æŒ‰ç…§ç´¢å¼•è¿›è¡Œorder byæ—¶ï¼Œhashå€¼<strong>æ²¡åŠæ³•æ”¯æŒæ’åº</strong> ã€‚</p></blockquote></li></ul><h4 id="13-ã€å­—èŠ‚ã€‘Mysql-Joinçš„åŸç†ï¼Ÿ">13.ã€å­—èŠ‚ã€‘Mysql Joinçš„åŸç†ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/54275505">https://zhuanlan.zhihu.com/p/54275505</a></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user tb1 left join level tb2 on tb1.id=tb2.user_id</span><br></pre></td></tr></table></figure><ol><li><p><strong>ç®€å•åµŒå¥—å¾ªç¯</strong></p><p><strong>åŒå±‚for å¾ªç¯</strong> ï¼Œé€šè¿‡å¾ªç¯å¤–å±‚è¡¨çš„è¡Œæ•°æ®ï¼Œé€ä¸ªä¸å†…å±‚è¡¨çš„æ‰€æœ‰è¡Œæ•°æ®è¿›è¡Œæ¯”è¾ƒæ¥è·å–ç»“æœã€‚</p><img src="https://i.loli.net/2021/09/04/u3LJnMgZsIV6Atd.png" alt="image-20210904063419237" style="zoom:50%;" /></li><li><p><strong>ç´¢å¼•åµŒå¥—å¾ªç¯è¿æ¥</strong></p><p>é€šè¿‡å¤–å±‚è¡¨åŒ¹é…æ¡ä»¶<strong>ç›´æ¥ä¸å†…å±‚è¡¨ç´¢å¼•è¿›è¡ŒåŒ¹é…</strong>ï¼Œé¿å…å’Œå†…å±‚è¡¨çš„æ¯æ¡è®°å½•å»è¿›è¡Œæ¯”è¾ƒï¼Œ è¿™æ ·æå¤§çš„å‡å°‘äº†å¯¹å†…å±‚è¡¨çš„åŒ¹é…æ¬¡æ•°ã€‚</p><ul><li>ä»åŸæ¥çš„åŒ¹é…æ¬¡æ•°=å¤–å±‚è¡¨è¡Œæ•° * å†…å±‚è¡¨è¡Œæ•°,å˜æˆäº† å¤–å±‚è¡¨çš„è¡Œæ•° * å†…å±‚è¡¨ç´¢å¼•çš„é«˜åº¦ï¼Œæå¤§çš„æå‡äº† joinçš„æ€§èƒ½ï¼›</li><li>æ³¨æ„ï¼Œ<strong>è¦ä¸ºè¡¨user_level å»å»ºç«‹ç´¢å¼•</strong></li></ul><img src="https://i.loli.net/2021/09/04/1gkP9upMosUtYS4.png" alt="image-20210904063546011" style="zoom:80%;" /></li><li><p><strong>ç¼“å­˜å—åµŒå¥—å¾ªç¯è¿æ¥</strong></p><p>å…¶ä¼˜åŒ–æ€è·¯æ˜¯<strong>å‡å°‘å†…å±‚è¡¨çš„æ‰«è¡¨æ¬¡æ•°</strong>ã€‚</p><ul><li>é€šè¿‡ç®€å•çš„åµŒå¥—å¾ªç¯æŸ¥è¯¢çš„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå·¦è¡¨çš„æ¯ä¸€æ¡è®°å½•éƒ½ä¼šå¯¹å³è¡¨è¿›è¡Œä¸€æ¬¡æ‰«è¡¨ï¼Œæ‰«è¡¨çš„è¿‡ç¨‹å…¶å®ä¹Ÿå°±æ˜¯<strong>ä»å†…å­˜è¯»å–æ•°æ®</strong>çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½çš„ã€‚</li></ul><p><img src="https://i.loli.net/2021/09/04/s1nE7IzYZ6TGlkK.jpg" alt="img"></p><p>æ‰€ä»¥ç¼“å­˜å—åµŒå¥—å¾ªç¯è¿æ¥ç®—æ³•æ„åœ¨é€šè¿‡<strong>ä¸€æ¬¡æ€§ç¼“å­˜å¤–å±‚è¡¨çš„å¤šæ¡æ•°æ®</strong>ï¼Œä»¥æ­¤æ¥å‡å°‘å†…å±‚è¡¨çš„æ‰«è¡¨æ¬¡æ•°ï¼Œä»è€Œè¾¾åˆ°æå‡æ€§èƒ½çš„ç›®çš„ã€‚å¦‚æœæ— æ³•ä½¿ç”¨<strong>Index Nested-Loop Join</strong>çš„æ—¶å€™ï¼Œæ•°æ®åº“æ˜¯é»˜è®¤ä½¿ç”¨çš„æ˜¯<strong>Block Nested-Loop Joinç®—æ³•çš„</strong>ã€‚</p><ul><li><strong>å½“level è¡¨çš„ user_id ä¸ä¸ºç´¢å¼•</strong>çš„æ—¶å€™ï¼Œé»˜è®¤ä¼šä½¿ç”¨Block Nested-Loop Joinç®—æ³•ã€‚</li></ul><p><img src="https://i.loli.net/2021/09/04/iP9o6OpU8ZxcIwF.jpg" alt="img"></p></li></ol><h5 id="13-1-joinå’Œleft-joinåŒºåˆ«">13.1 joinå’Œleft joinåŒºåˆ«?</h5><p><strong>joinç›¸å½“äºæˆ‘ä»¬å¹³æ—¶ç”¨çš„where</strong>ï¼Œå°±æ˜¯æŠŠä¸¤å¼ è¡¨ä¸­åŒæ—¶æ»¡è¶³a.id=b.idçš„æ•°æ®æ‰¾å‡ºæ¥ï¼›</p><p>left joinæ˜¯ä»¥å·¦è¡¨ï¼ˆaï¼‰ä¸ºå‚è€ƒå¯¹è±¡ï¼Œç›¸å½“äºåšä¸€ä¸ªforå¾ªç¯ï¼ŒæŠŠaè¡¨çš„æ•°æ®ä¸€æ¡ä¸€æ¡çš„è¯»å–å‡ºæ¥ï¼Œç„¶åæ ¹æ®a.id=b.idçš„æ¡ä»¶åˆ°bè¡¨ä¸­æŸ¥æ‰¾æ•°æ®ã€‚</p><h5 id="13-2-unioå’Œunio-allçš„åŒºåˆ«">13.2 unioå’Œunio allçš„åŒºåˆ«?</h5><p>å¦‚æœæˆ‘ä»¬éœ€è¦å°†<strong>ä¸¤ä¸ªselectè¯­å¥çš„ç»“æœä½œä¸ºä¸€ä¸ªæ•´ä½“æ˜¾ç¤ºå‡ºæ¥</strong>ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°unionæˆ–è€…union allå…³é”®å­—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select employee_id,job_id from employees union select employee_id,job_id from job_history</span><br></pre></td></tr></table></figure><p><strong>unionä¼šè‡ªåŠ¨å‹ç¼©å¤šä¸ªç»“æœé›†åˆä¸­çš„é‡å¤ç»“æœï¼Œè€Œunion allåˆ™å°†æ‰€æœ‰çš„ç»“æœå…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥</strong>ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯é‡å¤ã€‚</p><h5 id="13-3-unio-å’Œ-joinçš„åŒºåˆ«">13.3 unio å’Œ joinçš„åŒºåˆ«?</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.jb51.net/article/30975.htm">https://www.jb51.net/article/30975.htm</a></p></blockquote><p>joinæ˜¯å¯¹ä¸¤ä¸ªè¡¨è¿›è¡Œè”åˆï¼Œç›¸å½“äºwhereï¼Œæ»¡è¶³æ¡ä»¶çš„è¡Œä¼šè¢«é€‰å‡ºï¼Œ<strong>å…¶ä¸­åˆ—ä¼šè¢«æ‰©å……ï¼</strong>  ä½†unioæ˜¯è¿æ¥ç»“æœé›†ï¼Œéœ€è¦æ»¡è¶³åˆ—ä¸ªæ•°ç›¸åŒï¼Œ<strong>åªä¼šä¿å­˜ç¬¬ä¸€ä¸ªè¡¨åˆ—ä¸ªæ•°ï¼Œåˆ—ä¸ªæ•°ä¸ä¼šè¢«æ‰©å……ï¼</strong></p><h2 id="5-2-åˆ†å¸ƒå¼æ•°æ®åº“">5.2 åˆ†å¸ƒå¼æ•°æ®åº“</h2><h4 id="0-ã€å­—èŠ‚ã€‘åˆ†å¸ƒå¼æ•°æ®åº“é”å¦‚ä½•å®ç°ï¼Ÿ">0. ã€å­—èŠ‚ã€‘åˆ†å¸ƒå¼æ•°æ®åº“é”å¦‚ä½•å®ç°ï¼Ÿ</h4><ul><li><strong>ä»€ä¹ˆæ—¶å€™ç”¨åˆ°åˆ†å¸ƒå¼æ•°æ®åº“</strong>ï¼Ÿ<ol><li><strong>æ°´å¹³æ‹†åˆ†</strong> <strong>ï¼šæ•°æ®é‡å¤§åˆ°å•æœºæ•°æ®åº“å·²å­˜å‚¨ä¸ä¸‹</strong>æ—¶ï¼Œ å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ‹†åˆ†ï¼ŒåŒ–æ•´ä¸ºé›¶ï¼Œå°†æ•°æ®å‡åŒ€åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“èŠ‚ç‚¹ä¸­ã€‚</li><li><strong>è¯»å†™åˆ†ç¦»</strong>ï¼šä¸»è¦ç”¨åœ¨<strong>æ•°æ®é‡å¹¶ä¸å¤§</strong>ï¼Œå•æœºæ•°æ®åº“èƒ½å¤Ÿholdå¾—ä½ï¼Œ<strong>ä½†è¯»è¯·æ±‚å¾ˆé«˜</strong>çš„æƒ…å†µä¸‹ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é…ç½®å¤šä¸ªåªè¯»æ•°æ®åº“èŠ‚ç‚¹ï¼Œæ¥åˆ†æ‹…ä¸»èŠ‚ç‚¹çš„è¯»è¯·æ±‚ã€‚é€šè¿‡æ•°æ®å¤åˆ¶æœºåˆ¶ï¼Œ<strong>åœ¨ä¸»èŠ‚ç‚¹å’Œåªè¯»èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®çš„å®æ—¶åŒæ­¥</strong>ï¼Œä¿è¯ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol></li><li><strong>åˆ†å¸ƒå¼æ•°æ®åº“é”</strong>ï¼Ÿ<ol><li><strong>ç›´æ¥é”è¡¨</strong>ï¼Œä»£ä»·æ¯”è¾ƒå¤§</li><li><strong>åŠ å…¥æ’å®ƒé”</strong>ï¼ŒæŸ¥è¯¢è¯­å¥åé¢å¢åŠ <strong>for update</strong>ï¼ˆè¿™é‡Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è¡Œçº§é”ï¼Œå°±è¦ç»™method_nameæ·»åŠ ç´¢å¼•ï¼‰</li><li><strong>Zookeeperå®ç°åˆ†å¸ƒå¼é”</strong></li></ol></li></ul><h4 id="1-è¯·è¯´è¯´MySQLæ•°æ®åº“çš„é”ï¼Ÿ">1.è¯·è¯´è¯´MySQLæ•°æ®åº“çš„é”ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/05/24/S7HoKh8EcpXT1Mz.png" alt="img"></p><p>MySQL ä¸­å¸¸è§é”å¦‚ä¸‹ï¼š</p><p>ã€<u>æŒ‰ä½¿ç”¨æ–¹å¼åˆ’åˆ†</u>ã€‘</p><ul><li><p><strong>å…±äº«é”</strong>ï¼šä¸å µå¡ï¼Œå¤šä¸ªç”¨æˆ·å¯ä»¥åŒä¸€æ—¶åˆ»<strong>è¯»å–</strong>åŒä¸€ä¸ªèµ„æºï¼Œç›¸äº’ä¹‹é—´æ²¡æœ‰å½±å“ï¼›</p></li><li><p><strong>æ’å®ƒé”ï¼ˆå†™é”</strong>ï¼‰ï¼š<u>ä¸€ä¸ªå†™æ“ä½œé˜»å¡å…¶ä»–çš„è¯»é”å’Œå†™é”</u>ï¼Œ<strong>åªå…è®¸ä¸€ä¸ªç”¨æˆ·è¿›è¡Œå†™å…¥</strong>ï¼Œ<strong>é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„èµ„æº</strong>ã€‚</p></li></ul><p>ã€<u>æŒ‰é”ç²’åº¦åˆ’åˆ†</u>ã€‘</p><ul><li><p><strong>è¡¨é”</strong>ï¼šç³»ç»Ÿå¼€é”€æœ€å°ï¼Œä¼šé”å®šæ•´å¼ è¡¨ï¼Œ<u>ä¸ä¼šå‡ºç°æ­»é”</u>ï¼›ä½†æ˜¯ç”±äºç²’åº¦å¤ªå¤§ï¼Œå› æ­¤é€ æˆé”çš„å†²çªå‡ ç‡å¤§ï¼Œå¹¶å‘æ€§èƒ½ä½ã€‚<strong>MyISAM ä½¿ç”¨è¡¨é”ã€‚</strong></p></li><li><p><strong>è¡Œé”</strong>ï¼š<u>å®¹æ˜“å‡ºç°æ­»é”</u>ï¼Œå‘ç”Ÿå†²çªæ¦‚ç‡ä½ï¼Œå¹¶å‘æ€§èƒ½é«˜ã€‚<strong>InnoDB æ”¯æŒè¡Œé”</strong>ã€‚</p><blockquote><p><strong>å¿…é¡»æœ‰ç´¢å¼•æ‰èƒ½å®ç°</strong>ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨é”å…¨è¡¨ï¼Œé‚£ä¹ˆå°±ä¸æ˜¯è¡Œé”ã€‚</p></blockquote></li></ul><p>ã€<u>æŒ‰æ€æƒ³åˆ’åˆ†</u>ã€‘</p><ul><li><strong>ä¹è§‚é”</strong></li><li><strong>æ‚²è§‚é”</strong></li></ul><h4 id="2-è¯´è¯´ä»€ä¹ˆæ˜¯é”å‡çº§ï¼Ÿä»€ä¹ˆæƒ…å†µå‘ç”Ÿé”å‡çº§ï¼Ÿ">2.<strong>è¯´è¯´ä»€ä¹ˆæ˜¯é”å‡çº§ï¼Ÿä»€ä¹ˆæƒ…å†µå‘ç”Ÿé”å‡çº§</strong>ï¼Ÿ</h4><blockquote><p>åŒºåˆ†ä¸€ä¸‹sycronizedé”å‡çº§ã€‚</p></blockquote><p>é”å‡çº§æ˜¯æŒ‡å°†å½“å‰é”çš„ç²’åº¦é™ä½ï¼š<code>è¡Œé”â†’é¡µé”â†’è¡¨é”</code>ã€‚</p><p>å‘ç”Ÿé”å‡çº§çš„æƒ…å†µï¼š</p><ol><li>å½“ä¸€æ¡SQLè¯­å¥å¯¹<u>åŒä¸€ä¸ªå¯¹è±¡</u>ä¸ŠæŒæœ‰çš„é”æ•°é‡è¶…é”äº†é˜ˆå€¼ï¼Œé»˜è®¤è¿™ä¸ªé˜ˆå€¼ä¸º5000ï¼Œ<strong>ä½†æ˜¯å¯¹äºä¸åŒå¯¹è±¡ä¸ä¼šå‘ç”Ÿé”å‡çº§</strong></li><li>é”èµ„æºå ç”¨çš„å†…å­˜è¶…è¿‡<u>æ¿€æ´»å†…å­˜</u>çš„ç™¾åˆ†ä¹‹40 å°±ä¼šå‘ç”Ÿé”å‡çº§</li></ol><h5 id="2-1-ä¸ºä»€ä¹ˆè¯´innoDB-å¼•æ“ä¸å­˜åœ¨é”å‡çº§çš„é—®é¢˜-ï¼Ÿ">2.1 ä¸ºä»€ä¹ˆè¯´innoDB å¼•æ“ä¸å­˜åœ¨é”å‡çº§çš„é—®é¢˜ ï¼Ÿ</h5><p>å¾…è¡¥å……ã€‚</p><h5 id="2-2-ä»€ä¹ˆæ—¶å€™è§¦å‘è¡Œé”å’Œè¡¨çº§é”ï¼Ÿ">2.2 ä»€ä¹ˆæ—¶å€™è§¦å‘è¡Œé”å’Œè¡¨çº§é”ï¼Ÿ</h5><p>mysqlé»˜è®¤å­˜å‚¨å¼•æ“éƒ½æ˜¯<strong>innodb</strong>ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨<strong>è¡Œé”</strong> ã€‚</p><ul><li><p>è§¦å‘è¡Œçº§é” ï¼Œ<strong>è¡Œçº§é”é”çš„æ˜¯ç´¢å¼•è®°å½•</strong> ï¼Œä½¿ç”¨äº†ç´¢å¼•æ‰€ä»¥å°±ä¼šè§¦å‘è¡Œçº§é”ã€‚</p></li><li><p>è§¦å‘è¡¨çº§é”ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µ</p><blockquote><p>å…¶å®ä¸ç®¡æ˜¯è¯»æ“ä½œ(select)è¿˜æ˜¯å†™æ“ä½œ(update,delete,insert),åªè¦æ¶‰åŠåˆ°å¸¦æœ‰ç­›é€‰æ¡ä»¶çš„è¯­å¥ï¼Œ<strong>å¦‚æœç­›é€‰æ¡ä»¶ä¸­æ²¡æœ‰ç”¨åˆ°ç´¢å¼•</strong>ï¼Œå°±ä¼šè§¦å‘å…¨è¡¨æ‰«æã€‚</p></blockquote><ol><li><strong>å…¨è¡¨æ›´æ–°</strong>ï¼šäº‹åŠ¡<strong>éœ€è¦æ›´æ–°å¤§éƒ¨åˆ†æ•°æ®æˆ–å…¨éƒ¨æ•°</strong>æ®ï¼Œå¦‚æœä½¿ç”¨è¡Œçº§é”ï¼Œä¼šå¯¼è‡´äº‹åŠ¡æ‰§è¡Œæ•ˆç‡ä½ï¼Œä»è€Œå¯¼è‡´å…¶ä»–äº‹åŠ¡é•¿æ—¶é—´ç­‰å¾…é”å’Œæ›´å¤šçš„é”å†²çª</li><li><strong>å¤šè¡¨çº§è”ï¼šäº‹åŠ¡æ¶‰åŠå¤šå¼ è¡¨</strong>ï¼Œæ¯”è¾ƒå¤æ‚çš„å…³è”æŸ¥è¯¢ï¼Œå¾ˆå¯èƒ½é€ æˆæ­»é”ï¼Œè¿™ç§æƒ…å†µè‹¥èƒ½ä¸€æ¬¡æ€§é”ä½äº‹åŠ¡æ¶‰åŠçš„è¡¨ï¼Œä»è€Œé¿å…æ­»é”ï¼Œå‡å°‘æ•°æ®åº“äº‹åŠ¡å›æ»šæ‰€å¸¦æ¥çš„å¼€é”€</li><li><strong>ç­›é€‰æ¡ä»¶ä¸­æœªç”¨åˆ°ç´¢å¼•</strong>ï¼š å…¨è¡¨æ‰«æ</li><li><strong>ç”¨åˆ°ç´¢å¼•ï¼Œä½†åŒºåˆ†åº¦ç¨‹åº¦ä¸é«˜</strong> ï¼šinnodbè®¤ä¸ºå…¨è¡¨æ‰«ææ¯”èµ°ç´¢å¼•æ•ˆç‡æ›´é«˜å¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œè¿™ä¸ªæ—¶å€™å°±è¦é€šè¿‡explainå»æŸ¥çœ‹ä¸‹æŸ¥è¯¢è®¡åˆ’ï¼Œçœ‹ä¸‹æŸ¥è¯¢è¯­å¥æ˜¯å¦çœŸçš„ç”¨åˆ°äº†ç´¢å¼•</li></ol></li></ul><h5 id="2-3-è¡Œé”é€‚åˆçš„åœºæ™¯ï¼Ÿ">2.3 è¡Œé”é€‚åˆçš„åœºæ™¯ï¼Ÿ</h5><p>Aç”¨æˆ·æ¶ˆè´¹ï¼Œserviceå±‚å…ˆæŸ¥è¯¢è¯¥ç”¨æˆ·çš„è´¦æˆ·ä½™é¢ï¼Œè‹¥ä½™é¢è¶³å¤Ÿï¼Œåˆ™è¿›è¡Œåç»­çš„æ‰£æ¬¾æ“ä½œï¼›è¿™ç§æƒ…å†µæŸ¥è¯¢çš„æ—¶å€™åº”è¯¥å¯¹è¯¥è®°å½•è¿›è¡ŒåŠ é”ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for update # æ“ä½œè¯¥è®°å½•æ—¶åŠ ä¸Š</span><br></pre></td></tr></table></figure><p>å¦åˆ™ï¼ŒBç”¨æˆ·åœ¨Aç”¨æˆ·æŸ¥è¯¢åæ¶ˆè´¹å‰å…ˆä¸€æ­¥å°†Aç”¨æˆ·è´¦å·ä¸Šçš„é’±è½¬èµ°ï¼Œè€Œæ­¤æ—¶Aç”¨æˆ·å·²ç»è¿›è¡Œäº†ç”¨æˆ·ä½™é¢æ˜¯å¦è¶³å¤Ÿçš„åˆ¤æ–­ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä½™é¢å·²ç»ä¸è¶³ä½†å´æ‰£æ¬¾æˆåŠŸçš„æƒ…å†µã€‚</p><h4 id="3-æ€æ ·å°½é‡é¿å…æ­»é”çš„å‡ºç°ï¼Ÿ">3.<strong>æ€æ ·å°½é‡é¿å…æ­»é”çš„å‡ºç°</strong>ï¼Ÿ</h4><ol><li><p><strong>è®¾ç½®è·å–é”çš„è¶…æ—¶æ—¶é—´</strong>ï¼Œè‡³å°‘èƒ½ä¿è¯æœ€å·®æƒ…å†µä¸‹ï¼Œå¯ä»¥é€€å‡ºç¨‹åºï¼Œä¸è‡³äºä¸€ç›´ç­‰å¾…å¯¼è‡´æ­»é”ï¼›</p></li><li><p><strong>è®¾ç½®æŒ‰ç…§åŒä¸€é¡ºåºè®¿é—®èµ„æº</strong>ï¼Œç±»ä¼¼äºä¸²è¡Œæ‰§è¡Œï¼›</p></li><li><p><strong>é¿å…äº‹åŠ¡ä¸­çš„ç”¨æˆ·äº¤å‰</strong>ï¼›</p></li><li><p>ä¿æŒäº‹åŠ¡ç®€çŸ­å¹¶åœ¨ä¸€ä¸ªæ‰¹å¤„ç†ä¸­ï¼›</p></li><li><p>ä½¿ç”¨<strong>ä½éš”ç¦»çº§åˆ«</strong>ã€‚</p></li></ol><h4 id="4-è§£é‡Šä¸€ä¸‹æ‚²è§‚é”å’Œä¹è§‚é”ï¼Ÿ">4.<strong>è§£é‡Šä¸€ä¸‹æ‚²è§‚é”å’Œä¹è§‚é”</strong>ï¼Ÿ</h4><ul><li><p><strong>æ‚²è§‚é”</strong>ï¼š æ‚²è§‚é”æ˜¯åŸºäºä¸€ç§æ‚²è§‚çš„æ€åº¦ç±»æ¥é˜²æ­¢ä¸€åˆ‡æ•°æ®å†²çªã€‚å®ƒæ˜¯ä»¥ä¸€ç§é¢„é˜²çš„å§¿æ€ <u>åœ¨ä¿®æ”¹æ•°æ®ä¹‹å‰æŠŠæ•°æ®é”ä½</u>ï¼Œç„¶åå†å¯¹æ•°æ®è¿›è¡Œè¯»å†™ï¼Œåœ¨å®ƒé‡Šæ”¾é”ä¹‹å‰ä»»ä½•äººéƒ½ä¸èƒ½å¯¹å…¶æ•°æ®è¿›è¡Œæ“ä½œã€‚ä¸€èˆ¬æ•°æ®åº“æœ¬èº«é”çš„æœºåˆ¶éƒ½æ˜¯åŸºäºæ‚²è§‚é”çš„æœºåˆ¶å®ç°çš„ã€‚</p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼š å®Œå…¨ä¿è¯æ•°æ®çš„ç‹¬å æ€§å’Œæ­£ç¡®æ€§ï¼Œå› ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå…ˆå¯¹æ•°æ®è¿›è¡ŒåŠ é”ï¼›ä½†æ˜¯é€ æˆæ€§èƒ½æ¶ˆè€—</p></li><li><p><strong>å®ç°</strong> ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># åŠ è¯»é”</span><br><span class="line">LOCK tables test_db READ </span><br><span class="line"># é‡Šæ”¾é”</span><br><span class="line">UNLOCK TABLES</span><br><span class="line"># åŠ å†™é”</span><br><span class="line">LOCK tables test_db WRITE </span><br><span class="line"># é‡Šæ”¾é”</span><br><span class="line">UNLOCK TABLES</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¹è§‚é”</strong>ï¼š å¯¹äºæ•°æ®å†²çªä¿æŒä¸€ç§ä¹è§‚æ€åº¦ï¼Œæ“ä½œæ•°æ®æ—¶ä¸ä¼šå¯¹æ“ä½œçš„æ•°æ®è¿›è¡ŒåŠ é”ï¼Œä½¿å¾—<u>å¤šä¸ªä»»åŠ¡å¯å¹¶è¡Œå¯¹æ•°æ®æ“ä½œ</u>ã€‚ä½†æ˜¯<u>ä½¿ç”¨ä¸€ç§éªŒè¯æœºåˆ¶æ¥é¿å…æ•°æ®å†²çª</u> ï¼ˆä¸€èˆ¬é€šè¿‡åŠ ç‰ˆæœ¬åå¯¹æ¯”æ¥å®ç°ï¼‰ã€‚</p><ul><li><p><strong>ç‰¹ç‚¹</strong>ï¼š å¹¶å‘ç±»å‹çš„é”ï¼Œ<u>æœ¬èº«ä¸åŠ é”ä½†é€šè¿‡ä¸šåŠ¡å®ç°é”çš„åŠŸèƒ½</u> ï¼Œæ²¡æœ‰é”æ“ä½œå› æ­¤æ€§èƒ½æ›´é«˜ã€‚</p></li><li><p><strong>å®ç°å½¢å¼</strong>ï¼š</p><p>ï¼ˆ1ï¼‰ä¸¤ä¸ªè¯·æ±‚åŒæ—¶æ“ä½œæ“ä½œæ ‡Nameå­—æ®µï¼ŒäºŒè€…æŸ¥è¯¢éœ€æ£€ç´¢çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼š</p><p><img src="https://i.loli.net/2021/04/20/H6wyLdqZN8BJipx.png" alt="img"></p><p>ï¼ˆ2ï¼‰è¯·æ±‚1ä¿®æ”¹å­—æ®µæ•°æ®<code>â€œzhangsanâ€â†’â€œlisiâ€</code> ï¼Œå¹¶å°†ç‰ˆæœ¬å·å¢åŠ +1 ï¼ŒéªŒè¯ç‰ˆæœ¬å·ä¸€ç›´åæäº¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update A set Name=lisi,version=version+1 where ID=#&#123;id&#125; and version=#&#123;version&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰è¯·æ±‚2ä¹Ÿæƒ³ä¿®æ”¹<code>â€œzhangsanâ€â†’â€œlimingâ€</code>  ï¼Œä½†æ˜¯æäº¤æ—¶ç”±äº <u>ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œæ— æ³•æäº¤æˆåŠŸ</u></p></li></ul></li></ul><h5 id="4-1-æ•°æ®åº“ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œå¦‚ä½•å®ç°ï¼Ÿ">4.1 æ•°æ®åº“ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</h5><ul><li><p><strong>å®ç°ä¹è§‚é”</strong></p><ol><li><p>åˆ©ç”¨ç‰ˆæœ¬å·ï¼Œå¦‚MVCCï¼›</p></li><li><p><strong>æ—¶é—´æˆ³</strong>ï¼šåŒæ ·æ˜¯åœ¨éœ€è¦ä¹è§‚é”æ§åˆ¶çš„tableä¸­å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œåç§°æ— æ‰€è°“ï¼Œå­—æ®µç±»å‹ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆtimestampï¼‰, å’Œä¸Šé¢çš„versionç±»ä¼¼ã€‚</p><p>ä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™ï¼Œå°†å½“å‰æ•°æ®åº“ä¸­æ•°æ®çš„æ—¶é—´æˆ³å’Œè‡ªå·±æ›´æ–°å‰å–åˆ°çš„æ—¶é—´æˆ³è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´åˆ™OKï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚</p></li></ol></li><li><p><strong>å®ç°æ‚²è§‚é”</strong></p><p>ç›´æ¥åŠ ä¸Šè¯»é”æˆ–è€…å†™é”ï¼ŒSELECT â€¦ FOR UPDATE ã€‚</p></li></ul><h4 id="5-ä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼æ•°æ®åº“å…¨å±€IDå”¯ä¸€ä¸”è‡ªå¢ï¼Œå¦‚ä½•ç”Ÿæˆï¼Ÿ-ï¼ˆæˆ–è€…é—®åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œid-ä¸»é”®å¦‚ä½•å¤„ç†ï¼Ÿï¼‰">5.<strong>ä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼æ•°æ®åº“å…¨å±€IDå”¯ä¸€ä¸”è‡ªå¢ï¼Œå¦‚ä½•ç”Ÿæˆ</strong>ï¼Ÿ ï¼ˆ<strong>æˆ–è€…é—®åˆ†åº“åˆ†è¡¨ä¹‹åï¼Œid ä¸»é”®å¦‚ä½•å¤„ç†</strong>ï¼Ÿï¼‰</h4><p>å› ä¸ºè¦æ˜¯åˆ†æˆå¤šä¸ªè¡¨ä¹‹åï¼Œæ¯ä¸ªè¡¨éƒ½æ˜¯ä» 1 å¼€å§‹ç´¯åŠ ï¼Œè¿™æ ·æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬éœ€è¦â¼€ä¸ªå…¨å±€å”¯â¼€çš„ idæ¥æ”¯æŒã€‚</p><ol><li><p><strong>UUID</strong>ï¼šä¸é€‚åˆä½œä¸ºä¸»é”®ï¼Œå› ä¸ºå¤ªé•¿äº†ï¼Œå¹¶ä¸”æ— åºä¸å¯è¯»ï¼ŒæŸ¥è¯¢æ•ˆç‡ä½ã€‚æ¯”è¾ƒé€‚åˆç”¨äºç”Ÿæˆå”¯ä¸€çš„åå­—çš„æ ‡ç¤ºæ¯”å¦‚æ–‡ä»¶çš„åå­—ã€‚</p></li><li><p>IDè‡ªå¢é‡ä¸º<u>åˆ†å¸ƒå¼æ•°æ®åº“ä¸ªæ•°</u>ï¼Œç¼ºç‚¹æ˜¯æ‰©å±•æ€§ä¸å¥½ï¼›</p></li><li><p><a href="https://www.cnblogs.com/jiangxinlingdu/p/8440413.html">snow flakeç®—æ³•</a>ï¼šsnowflakeæ˜¯Twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongå‹çš„IDã€‚</p><p><img src="https://pic3.zhimg.com/80/v2-b3a91b9e3f6468be39f3dc3345e9f4f2_720w.jpg" alt="img"></p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š ä½¿ç”¨41bitä½œä¸ºæ¯«ç§’æ•°ï¼Œ10bitä½œä¸ºæœºå™¨çš„IDï¼ˆ<strong>5ä¸ªbitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5ä¸ªbitçš„æœºå™¨ID</strong>ï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼ˆæ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯æ¯«ç§’å¯ä»¥äº§ç”Ÿ 4096 ä¸ª <u>ä¸åŒID</u>ï¼‰ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ªç¬¦å·ä½ï¼Œæ°¸è¿œæ˜¯0ã€‚</li></ul></li><li><p><a href="https://blog.csdn.net/minkeyto/article/details/104943883">Leafç®—æ³•</a>ï¼šåˆ†å·æ®µ</p></li></ol><h4 id="8-ä»‹ç»ä¸€ä¸‹å“ˆå¸Œç®—æ³•ï¼Ÿå’Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Ÿ">8.<strong>ä»‹ç»ä¸€ä¸‹å“ˆå¸Œç®—æ³•ï¼Ÿå’Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</strong>ï¼Ÿ</h4><ul><li><p><strong>å“ˆå¸Œç®—æ³•</strong></p><ul><li><strong>ä»‹ç»</strong>ï¼š å“ˆå¸Œç®—æ³•<u>å°†ä»»æ„é•¿åº¦çš„äºŒè¿›åˆ¶å€¼æ˜ å°„ä¸ºè¾ƒçŸ­çš„å›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶å€¼</u>ï¼Œè¿™ä¸ªå°çš„äºŒè¿›åˆ¶å€¼ç§°ä¸º<strong>å“ˆå¸Œå€¼</strong>ã€‚å“ˆå¸Œå€¼æ˜¯ä¸€æ®µæ•°æ®å”¯ä¸€ä¸”<strong>æå…¶ç´§å‡‘çš„æ•°å€¼è¡¨ç¤ºå½¢å¼</strong>ã€‚</li><li><strong>åˆ†å¸ƒå¼åº”ç”¨ä¸­ç¼ºç‚¹</strong>ï¼š åœ¨åˆ†å¸ƒå¼çš„å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œ<u>è¦å°†æ•°æ®å­˜å‚¨åˆ°å…·ä½“çš„èŠ‚ç‚¹ä¸Š</u>ã€‚å¦‚æœé‡‡ç”¨å“ˆå¸Œç®—æ³•ï¼š<code>key%N</code>ï¼ˆkeyæ˜¯æ•°æ®çš„keyï¼ŒNæ˜¯æœºå™¨èŠ‚ç‚¹æ•°ï¼‰ ã€‚å‡ºç°æœºå™¨åŠ å…¥æˆ–é€€å‡ºé›†ç¾¤ï¼ˆ<strong>Nå˜äº†ï¼Œæ˜ å°„å€¼ä¸ä¸€æ ·äº†</strong>ï¼‰ï¼Œæ‰€æœ‰çš„æ•°æ®æ˜ å°„éƒ½æ— æ•ˆäº†ã€‚</li></ul></li><li><p><strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</strong></p><ul><li><p><strong>ä»‹ç»</strong>ï¼šè§£å†³æ™®é€šå“ˆå¸Œç®—æ³•é€ æˆè´Ÿè½½å‡è¡¡æ—¶ï¼Œåœ¨<strong>æœåŠ¡èŠ‚ç‚¹æ•°é‡å˜åŠ¨</strong>æ—¶å‡ºç°<strong>å“ˆå¸Œå¤±æ•ˆ</strong> é—®é¢˜</p></li><li><p><strong>å®ç°</strong>ï¼š</p><ol><li><p><strong>æ„å»ºç¯</strong>ï¼šæŒ‰ç…§å¸¸ç”¨çš„hashç®—æ³•æ¥å°†å¯¹åº”çš„keyå“ˆå¸Œåˆ°ä¸€ä¸ªå…·æœ‰<strong>2^32</strong>æ¬¡æ–¹ä¸ªèŠ‚ç‚¹çš„ç©ºé—´ä¸­ï¼ˆå³0 ~ (2^32)-1ï¼‰ã€‚</p><blockquote><p>Note: èŠ‚ç‚¹çš„ä¸ªæ•°å¯ä»¥è‡ªå®šä¹‰, hashç¯æˆ‘ä»¬å¯ä»¥ç”¨TreeMapæ¥å®ç°, å› ä¸ºtreeMapæ˜¯æ’åºçš„ï¼Œæˆ‘ä»¬åˆšå¥½å¯ä»¥åˆ©ç”¨ä¸Šã€‚</p></blockquote><img src="https://i.loli.net/2021/04/20/Al6k3ZmHJO2qbe9.jpg" alt="img" style="zoom:50%;" /></li><li><p><strong>æ˜ å°„æœåŠ¡å™¨èŠ‚ç‚¹</strong>ï¼š å°†å„ä¸ªæœåŠ¡å™¨ä½¿ç”¨Hashè¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œç¡®å®šæ¯å°æœºå™¨å…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚</p><blockquote><p>ä¸€èˆ¬ç”¨æœåŠ¡å™¨ipæˆ–å”¯ä¸€ä¸»æœºåè¿›è¡Œå“ˆå¸Œã€‚</p></blockquote><img src="https://i.loli.net/2021/04/20/1ZKalnT9CStVc8s.jpg" alt="img" style="zoom:50%;" /></li><li><p><strong>æ˜ å°„æ•°æ®ã€‚</strong> å¯¹äºè¦å­˜å‚¨çš„æ•°æ®ï¼š<code>ojectAã€objectBã€objectCã€objectD</code> ï¼Œé¦–å…ˆé€šè¿‡ç‰¹å®šå“ˆå¸Œå‡½æ•°è®¡ç®—å‡º<code>hash</code>å€¼ ï¼Œæ•£åˆ—åˆ°ç¯ä¸Šã€‚ç„¶åä»æ•°æ®æ‰€åœ¨ä½ç½®<u>æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€</u>ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ã€‚</p><img src="https://i.loli.net/2021/04/20/SwUijYkyJPp34v1.jpg" alt="img" style="zoom:50%;" /></li><li><p><strong>å‡ºç°æœåŠ¡å™¨å˜åŠ¨ã€‚</strong> å¦‚æœæ­¤æ—¶NodeCå®•æœºäº†ï¼Œæ­¤æ—¶Object Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Object Cä¼šé‡æ–°åˆ†é…åˆ°Node Dã€‚<u>é¿å…äº†å¤§é‡æ•°æ®è¿ç§»ï¼Œå‡å°äº†æœåŠ¡å™¨çš„çš„å‹åŠ›</u> ã€‚</p></li></ol></li></ul></li></ul><h4 id="9-ï¼ˆå†ç†è§£ï¼‰ä»‹ç»ä¸€ä¸‹MVVCï¼Ÿ">9. ï¼ˆå†ç†è§£ï¼‰ä»‹ç»ä¸€ä¸‹MVVCï¼Ÿ</h4><p>MVCCï¼ˆMulti-Version Concurrency Controlï¼‰å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œæ˜¯</p><p>æ•°æ®åº“æ§åˆ¶å¹¶å‘è®¿é—®çš„ä¸€ç§æ‰‹æ®µã€‚</p><blockquote><ul><li>ç‰¹åˆ«è¦æ³¨æ„<strong>MVCC</strong>åªåœ¨<strong>è¯»å·²æäº¤(RC)</strong> å’Œ<strong>å¯é‡å¤è¯»ï¼ˆRRï¼‰</strong> è¿™ä¸¤ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰æ•ˆ</li><li>æ˜¯<strong>æ•°æ®åº“å¼•æ“ï¼ˆInnoDBï¼‰</strong> å±‚é¢å®ç°çš„ï¼Œç”¨æ¥å¤„ç†è¯»å†™å†²çªçš„æ‰‹æ®µï¼ˆä¸ç”¨åŠ é”ï¼‰ï¼Œæé«˜è®¿é—®æ€§èƒ½</li></ul></blockquote><ul><li><p>MVCCåè®®ä¸­ï¼Œäº‹åŠ¡æäº¤ä¸ä¼šè¦†ç›–åŸæ•°æ®ï¼Œè€Œæ˜¯äº§ç”Ÿæ–°ç‰ˆæœ¬æ•°æ®ï¼Œ<strong>æ¯ä¸ªæ•°æ®æœ‰å¤šä¸ªå†å²ç‰ˆæœ¬</strong>ï¼Œä½†åŒä¸€æ—¶åˆ»åªæœ‰æœ€æ–°çš„ç‰ˆæœ¬æœ‰æ•ˆï¼›</p></li><li><p>MVCCæ˜¯åœ¨å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œé€šè¿‡å¯¹æ•°æ®åšå¤šç‰ˆæœ¬ç®¡ç†ï¼Œé¿å…<u>ã€<strong>å› ä¸ºå†™é”çš„é˜»å¡è€Œé€ æˆè¯»æ•°æ®çš„å¹¶å‘é˜»å¡</strong>ã€‘</u>é—®é¢˜ã€‚å¯ä»¥è®©<strong>è¯»å–æ•°æ®åŒæ—¶ä¿®æ”¹ï¼Œã€ä¿®æ”¹æ•°æ®æ—¶åŒæ—¶å¯è¯»å–ã€‘</strong>ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯<strong>ä¸å¯¹æ•°æ®åº“åŠ ä¸Šè¯»å†™é”ï¼</strong></p></li></ul><h5 id="9-1-MVCC-å¦‚ä½•å®ç°-ï¼Ÿ">9.1 MVCC å¦‚ä½•å®ç° ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/52977862">Innodb MVCCå®ç°åŸç†</a></p></blockquote><ul><li><p><strong>æ€»ç»“æ€§å›ç­”</strong></p><p>MVCCæ˜¯ä»¥ä¸€ä¸ªå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ç³»ç»Ÿï¼Œå®ƒä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†å®ç°ï¼š</p><ul><li>æ¯è¡Œè®°å½•ï¼šè®°å½•æœ€è¿‘æ“ä½œè¯¥è¡Œè®°å½•çš„äº‹åŠ¡IDï¼Œå’Œä¸Šä¸€ç‰ˆæœ¬æ•°æ®çš„æŒ‡é’ˆï¼ˆæŒ‡å‘undo logï¼‰</li><li>readviewï¼šæ¯æ¬¡<strong>è¯»ï¼ˆå†™ä¸å¯ä»¥</strong>ï¼‰ å¯ä»¥è·å–ä¸€ä¸ªreadviewï¼Œè®°å½•å½“å‰æ´»è·ƒçš„äº‹åŠ¡ID ï¼Œå¯ä»¥åœ¨<strong>å†™çš„è¿‡ç¨‹è¿›è¡Œè¯»</strong></li></ul><p>å†™çš„æ—¶å€™å¹¶å‘è¯»ï¼Œé€šè¿‡æ¯”è¾ƒå½“å‰è¡Œè®°å½•çš„äº‹åŠ¡IDå’Œreadviewæ´»è·ƒçš„äº‹åŠ¡IDï¼Œæ¥å†³å®šæ˜¯å¦è¯»å–è¯¥è¡Œè®°å½•è¿˜æ˜¯ä¸Šä¸€ç‰ˆæœ¬çš„æ•°æ®ã€‚</p></li></ul><p>MVCCå®ç°çš„æ ¸å¿ƒéƒ¨åˆ†ä¸ºï¼š</p><ol><li><p><strong>äº‹åŠ¡ç‰ˆæœ¬å·</strong>ï¼šæ¯æ¬¡<strong>äº‹åŠ¡å¼€å¯å‰</strong>éƒ½ä¼šä»æ•°æ®åº“è·å¾—ä¸€ä¸ªè‡ªå¢é•¿çš„<strong>äº‹åŠ¡ID</strong>ï¼Œå¯ä»¥ä»äº‹åŠ¡IDåˆ¤æ–­äº‹åŠ¡çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚</p></li><li><p><strong>è¡¨çš„éšè—åˆ—</strong> <strong>ï¼šæ¯ä¸€è¡Œ</strong> æœ‰å¦‚ä¸‹ä¸‰ä¸ªé‡è¦å­—æ®µå±æ€§ï¼š</p><table><thead><tr><th style="text-align:center">éšè—åˆ—</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>DB_TRX_ID</strong></td><td style="text-align:center">è®°å½•æ“ä½œè¯¥è¡Œäº‹åŠ¡çš„ID</td></tr><tr><td style="text-align:center"><strong>DB_ROLL_PTR</strong></td><td style="text-align:center">æŒ‡å‘ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼ˆåœ¨undo logï¼‰çš„æŒ‡é’ˆ</td></tr><tr><td style="text-align:center"><strong>DB_ROW_ID</strong></td><td style="text-align:center">éšè—IDï¼Œå½“è¡¨æ²¡æœ‰åˆé€‚çš„ç´¢å¼•ä½œä¸ºèšç°‡ç´¢å¼•æ—¶ï¼Œä¼šç”¨è¯¥IDåˆ›å»ºèšç°‡ç´¢å¼•</td></tr></tbody></table></li><li><p><strong>undo log</strong> ï¼šæ¯ä¸€è¡Œè®°å½•è¢«ä¿®æ”¹ä¹‹å‰çš„æ—¥å¿—ã€‚</p><blockquote><p>å½“äº‹åŠ¡è¢«å›æ»šæ—¶ï¼Œå¯ä»¥ç”¨é€šè¿‡undo logæ—¥å¿—å¯¹æ•°æ®è¿›è¡Œè¿˜åŸã€‚</p></blockquote><p>ä¸€ä¸ªå°ä¾‹å­ï¼šä¿®æ”¹æŸè¡Œè®°å½•nameä» <code>â€œå¼ ä¸‰â†’æå››â€</code></p><p><img src="https://pic1.zhimg.com/v2-1daaeab59495ff3378dae24ea21dc158_r.jpg" alt="preview"></p></li><li><p><strong>read view</strong>ã€‚åœ¨innodb ä¸­<strong>æ¯ä¸ªSQLè¯­å¥æ‰§è¡Œå‰</strong>éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªread_viewï¼Œä¿å­˜äº†å½“å‰æ•°æ®åº“ç³»ç»Ÿä¸­æ­£<strong>å¤„äºæ´»è·ƒï¼ˆæ²¡æœ‰æäº¤</strong>ï¼‰çš„äº‹åŠ¡çš„IDå·ã€‚</p><blockquote><p>æ ¹æ®äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œè¿™äº›äº‹åŠ¡IDåˆ—è¡¨ä¸ä¼šè¢«å…¶å®ƒäº‹åŠ¡çœ‹åˆ°ã€‚</p></blockquote><p>å…¶ç›¸å…³é‡è¦å±æ€§å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:center">å±æ€§</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>trx_ids</strong></td><td style="text-align:center">å½“å‰ç³»ç»Ÿï¼šæ´»è·ƒ<code>ï¼ˆæœªæäº¤ï¼‰äº‹åŠ¡ç‰ˆæœ¬å·é›†åˆ</code></td></tr><tr><td style="text-align:center"><strong>low_limit_id</strong></td><td style="text-align:center">å½“å‰ç³»ç»Ÿï¼š<code>æœ€å¤§ç‰ˆæœ¬äº‹åŠ¡å·+1</code></td></tr><tr><td style="text-align:center"><strong>up_limit_id</strong></td><td style="text-align:center">å½“å‰ç³»ç»Ÿï¼š<code>æ´»è·ƒçš„æœ€å°äº‹åŠ¡ç‰ˆæœ¬å·</code></td></tr><tr><td style="text-align:center"><strong>creator_trx_id</strong></td><td style="text-align:center">å½“å‰read viewï¼š<code>äº‹åŠ¡ç‰ˆæœ¬å·</code></td></tr></tbody></table></li></ol><p>å…·ä½“åŸç†å¯ä»¥æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªuser_infoè¡¨ï¼Œåˆå§‹æ•°æ®å¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2021/05/30/ATDHgI7sKeziOxE.png" alt="image-20210529211818428"></p><p>ç°åœ¨æœ‰äº‹åŠ¡Aï¼ŒB<strong>åŒæ—¶å¯¹<code>id=1</code> è¿™è¡Œæ•°æ®è¿›è¡Œæ“ä½œ</strong>ï¼Œå…ˆå¼€å¯äº‹åŠ¡Aï¼ˆæœªæäº¤ï¼‰ï¼Œæ­¤æ—¶æ‰§è¡Œäº‹åŠ¡Bï¼Œæœ€åè¿”å›ä»€ä¹ˆç»“æœå‘¢ï¼Ÿ</p></blockquote><ol><li><p>äº‹åŠ¡Aï¼ˆå†™ï¼‰ï¼Œæ‰§è¡Œ <code>update user_info set name =â€æå››â€</code></p><ul><li><p>è·å¾—äº‹åŠ¡ç¼–å·ï¼š102</p></li><li><p>å½“å‰äº‹åŠ¡Açš„è§†å›¾ä¸ºï¼šï¼ˆ<strong>å†™ï¼‰ä¸ä¼šè·å¾—read view</strong>ï¼</p></li></ul></li><li><p>äº‹åŠ¡Bï¼ˆè¯»ï¼‰ï¼Œæ‰§è¡Œ <code>select * fom user_info where id=1</code></p><ul><li><p>è·å¾—äº‹åŠ¡Bç¼–å·ï¼š103</p></li><li><p>å½“å‰äº‹åŠ¡Bçš„è§†å›¾ä¸ºï¼š</p><table><thead><tr><th style="text-align:center"><strong>trx_ids</strong></th><th style="text-align:center">å½“å‰æ´»è·ƒçš„äº‹åŠ¡ï¼š102,103</th></tr></thead><tbody><tr><td style="text-align:center"><strong>low_limit_id</strong></td><td style="text-align:center">å½“å‰æœ€å¤§äº‹åŠ¡id+1:<strong>104</strong></td></tr><tr><td style="text-align:center"><strong>up_limit_id</strong></td><td style="text-align:center">å½“å‰æœ€å°äº‹åŠ¡idï¼š<strong>102</strong></td></tr><tr><td style="text-align:center"><strong>creator_trx_id</strong></td><td style="text-align:center">å½“å‰äº‹åŠ¡idï¼š<strong>103</strong></td></tr></tbody></table></li></ul><blockquote><p><strong>ä¸åŒéš”ç¦»çº§åˆ«ä¸‹ï¼Œread viewçš„å·¥ä½œæ–¹å¼</strong>ï¼š</p><ol><li><p><strong>è¯»æœªæäº¤</strong>ï¼šä¸ä¼šè·å¾—read viewçš„å‰¯æœ¬ï¼ˆç­‰äºæ²¡æœ‰å¹¶å‘æ§åˆ¶æ‰€ä»¥ä¼šå‡ºç°è„è¯»ï¼‰</p></li><li><p><strong>è¯»æäº¤</strong>ï¼šæ¯ä¸€æ¬¡selectéƒ½ä¼šè·å¾—ä¸€ä¸ªread viewçš„å‰¯æœ¬ï¼Œæ‰€ä»¥ä¼šé€ æˆã€ä¸å¯é‡å¤è¯»ã€‘</p><p><img src="https://i.loli.net/2021/05/30/EQSJBYZMeUljA3g.png" alt="image-20210529222746175"></p></li><li><p><strong>å¯é‡å¤è¯»</strong>ï¼šåŒä¸€ä¸ªäº‹åŠ¡selectåªä¼šè·å¾—ä¸€æ¬¡read viewå‰¯æœ¬ï¼ˆselectçš„æ—¶å€™ä¸å…è®¸ä¿®æ”¹ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¸å¯é‡å¤è¯»ã€‚</p><p><img src="https://i.loli.net/2021/05/30/ITXb5OukhL1EJ4N.png" alt="image-20210529222905837"></p></li></ol></blockquote></li><li><p>äº‹åŠ¡Aï¼ˆå†™ï¼‰ï¼Œå¼€å§‹æ‰§è¡Œupdateè¯­å¥ï¼šï¼ˆ1ï¼‰æŠŠåŸæ•°æ®æ‹·è´åˆ°undo logï¼Œï¼ˆ2ï¼‰ç„¶åè¿›è¡Œä¿®æ”¹nameå­—æ®µï¼š<code>â€œå¼ ä¸‰â†’æå››â€</code>ï¼Œï¼ˆ3ï¼‰å¹¶è®¾ç½®DB_TRX_ID éšè—å­—æ®µï¼š<code>99â†’102</code> ï¼ˆ4ï¼‰è®¾ç½®DB_ROLL_PTRéšè—å­—æ®µï¼š<code>æ‰§è¡Œä¸Šä¸ªäº‹åŠ¡ç‰ˆæœ¬åœ°å€</code></p><p><img src="https://i.loli.net/2021/05/30/zjCi4AeRQsbHaPO.png" alt="image-20210529213739125"></p><p>æ­¤æ—¶ï¼Œ<strong>äº‹åŠ¡Aè¿˜å¹¶æœªæäº¤</strong>ï¼Œä¾æ—§æ˜¯å¤„äºæ´»è·ƒçŠ¶æ€ã€‚</p></li><li><p>äº‹åŠ¡Bï¼ˆè¯»ï¼‰ï¼Œå¼€å§‹æ‰§è¡Œselectè¯­å¥ï¼Œ<strong>æŸ¥è¯¢åˆ°æ˜¯äº‹åŠ¡Aä¿®æ”¹åçš„è¯­å¥</strong></p><p><img src="https://i.loli.net/2021/05/30/xspAhSDXbOGroqC.png" alt="image-20210529214159799"></p><p>æŠŠ<strong>æ•°æ®å’Œread view ï¼ˆè§†å›¾ï¼‰åŒ¹é…</strong>ï¼š <u>ä¿è¯</u>ï¼ˆ1ï¼‰<strong>æ•°æ®å·²æäº¤ï¼Œæ²¡æœ‰å…¶ä»–äº‹ç‰©ä¿®æ”¹ï¼Œå¦åˆ™å»æ‰¾ä¸Šä¸€ç‰ˆæœ¬çš„æ•°æ®</strong>ã€‚</p><blockquote><ol><li><code>å½“å‰æ•°æ®è®°å½•çš„äº‹åŠ¡id &lt; äº‹åŠ¡Bè§†å›¾ä¸­æœ€å°æ´»è·ƒäº‹åŠ¡id</code> : è¯´æ˜<strong>æ•°æ®</strong>ï¼Œæ˜¯åœ¨<strong>äº‹åŠ¡Bçš„read view åˆ›å»ºå‰</strong>å°±å­˜åœ¨ï¼Œæ‰€ä»¥å¯ä»¥æ˜¾ç¤ºã€‚</li><li><code>å½“å‰æ•°æ®è®°å½•çš„äº‹åŠ¡id &gt; äº‹åŠ¡Bè§†å›¾ä¸­æœ€å¤§æ´»è·ƒäº‹åŠ¡id</code> ï¼šè¯´æ˜<strong>æ•°æ®</strong>ï¼Œæ˜¯åœ¨<strong>äº‹åŠ¡Bçš„read view åˆ›å»ºå</strong>æ‰å­˜åœ¨ï¼Œæ­¤æ—¶ä¸åº”è¯¥æ˜¾ç¤ºã€‚</li><li><code>äº‹åŠ¡Bè§†å›¾ä¸­æœ€å°æ´»è·ƒäº‹åŠ¡id&lt;= å½“å‰æ•°æ®è®°å½•çš„äº‹åŠ¡id &lt;= äº‹åŠ¡Bè§†å›¾ä¸­æœ€å¤§æ´»è·ƒäº‹åŠ¡id</code> ï¼š è¯´æ˜æœ‰<strong>å…¶å®ƒäº‹åŠ¡åœ¨ä¿®æ”¹è¿™è¡Œè®°å½•æ•°æ®</strong>ï¼Œä½†å¯èƒ½è¿˜æ²¡æœ‰æäº¤ã€‚æŠŠidå’Œäº‹åŠ¡Bçš„read viewçš„æ´»è·ƒäº‹åŠ¡é›†åˆtrx_idsè¿›è¡ŒåŒ¹é…ï¼š<ul><li>å¦‚æœæ•°æ®è®°å½•çš„IDä¸å­˜åœ¨trx_idsï¼Œè¯´æ˜å·²ç»æäº¤äº†äº‹åŠ¡ï¼Œå¯ä»¥æ˜¾ç¤º</li><li>å¦‚æœå­˜åœ¨trx_idsï¼Œè¯´æ˜<strong>æ•°æ®è¿˜æ²¡æäº¤ï¼Œæ­¤æ—¶äº‹åŠ¡BæŸ¥è¯¢åˆ°æ•°æ®ä¸èƒ½æ˜¾ç¤º</strong>ï¼ˆé™¤éæ­¤æ—¶æ•°æ®è®°å½•çš„äº‹åŠ¡id == äº‹åŠ¡Bçš„idï¼Œç”±äºæ˜¯è‡ªå·±çš„å½“ç„¶å¯ä»¥æ˜¾ç¤ºï¼‰</li></ul></li></ol></blockquote></li><li><p>äº‹åŠ¡Bï¼ˆè¯»ï¼‰ï¼Œæ ¹æ®ä¸Šè¿°åŒ¹é…è§„åˆ™ï¼Œ<strong>æ­¤æ—¶ä¸èƒ½è¯»</strong>ï¼Œåº”è¯¥å»undo logä¸­æ‰¾åˆ°ä¸Šä¸€ç‰ˆæœ¬æ•°æ®ã€‚</p><blockquote><p>æ­¤æ—¶<code>äº‹åŠ¡Bçš„id=103ï¼Œæ•°æ®è®°å½•çš„äº‹åŠ¡id=102</code> ï¼šæ»¡è¶³æ¡ä»¶3ï¼Œä¸”æ­¤æ—¶trx_idså­˜åœ¨äº‹åŠ¡id=102ï¼Œè¯´æ˜äº‹åŠ¡Aï¼ˆid=102ï¼‰è¿˜æ²¡æäº¤ï¼Œå› æ­¤<strong>ä¸èƒ½æ˜¾ç¤ºã€‚</strong></p></blockquote><p>æ•…ï¼Œæœ€ç»ˆæŸ¥æ‰¾çš„æ•°æ®ä¸ºï¼š</p><img src="https://i.loli.net/2021/05/30/ATDHgI7sKeziOxE.png" alt="image-20210529211818428" style="zoom:80%;" /></li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªè¿‡ç¨‹MVCC<strong>äº‹åŠ¡Aã€å†™ã€‘æ²¡æœ‰åŠ é”</strong>ï¼Œåªæ˜¯è¿›è¡Œç‰ˆæœ¬å·æ§åˆ¶ &amp; undo logï¼Œå¯ä»¥è¿›è¡Œ<strong>å¹¶å‘ã€è¯»ã€‘</strong>ã€‚</p><h5 id="9-2-MVCC-ç‰ˆæœ¬å·å¦‚ä½•å˜åŒ–çš„ï¼Ÿæ›´æ–°çš„æ•°æ®å¦‚ä½•ç¡®å®šç‰ˆæœ¬çš„ï¼Ÿã€å¹»è¯»ã€‘åˆæ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ">9.2 MVCC ç‰ˆæœ¬å·å¦‚ä½•å˜åŒ–çš„ï¼Ÿæ›´æ–°çš„æ•°æ®å¦‚ä½•ç¡®å®šç‰ˆæœ¬çš„ï¼Ÿã€å¹»è¯»ã€‘åˆæ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ</h5><ul><li><p><strong>ç‰ˆæœ¬å·å˜åŒ–</strong></p><p>æ¯æ¡è®°å½•æœ‰ä¸‰ä¸ªéšè—åˆ—ï¼šï¼ˆ1ï¼‰<strong>DB_TRX_ID</strong> ï¼ˆ2ï¼‰<strong>DB_ROLL_PTR</strong> ï¼ˆ3ï¼‰<strong>DB_ROW_ID</strong></p><p>æ¯ä¸€æ¬¡æ–°äº‹åŠ¡ï¼Œ<strong>updateæ›´æ–°è¯­å¥</strong>ï¼Œéƒ½ä¼šå°†ï¼ˆ1ï¼‰æ‹·è´æ•°æ®åˆ°undo logï¼ˆ2ï¼‰DB_ROLL_PTRæŒ‡å‘ä¸Šä¸ªæ•°æ®çš„ç‰ˆæœ¬undo logï¼ˆ3ï¼‰DB_TRX_IDä¿®æ”¹ä¸ºæ–°äº‹åŠ¡çš„id ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆMVCCå¯è§£å†³å¹»è¯»</strong></p><p><strong>åœ¨RRï¼ˆå¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼‰ä¸ä¼šå‡ºç°å¹»è¯»</strong>ã€‚ä¾‹å¦‚ï¼š</p><ol><li>å¼€å¯äº‹åŠ¡1ï¼Œè·å¾—äº‹åŠ¡IDä¸º1ï¼›</li><li>äº‹åŠ¡1æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¾—åˆ°readviewï¼›</li><li>å¼€å§‹äº‹åŠ¡2ï¼›</li><li>æ‰§è¡Œinsertï¼›</li><li>æäº¤äº‹åŠ¡2ï¼›</li><li>æ‰§è¡Œäº‹åŠ¡1çš„ç¬¬äºŒæ¬¡æŸ¥è¯¢ (å› ä¸ºè¿™é‡Œæ˜¯RRçº§åˆ«ï¼Œæ‰€ä»¥<strong>ä¸ä¼šå†å»è·å¾—readviewï¼Œ<strong>è¿˜æ˜¯ä½¿ç”¨ç¬¬ä¸€æ¬¡è·å¾—çš„readviewï¼Œæ‰€ä»¥</strong>å½“å‰read view äº‹åŠ¡çš„IDä¸ä¼šæ›´æ–°</strong>ï¼Œå³ä¸ä¼šåŠ å…¥æ’å…¥äº‹åŠ¡2)ï¼›</li><li>æœ€åå¾—åˆ°çš„ç»“æœæ˜¯ï¼Œæ’å…¥çš„æ•°æ®ä¸ä¼šæ˜¾ç¤ºï¼Œå› ä¸º<strong>æ’å…¥çš„æ•°æ®äº‹åŠ¡ID &gt; readviewé‡Œçš„æœ€å¤§æ´»è·ƒäº‹åŠ¡ID</strong>ã€‚</li></ol></li></ul><h5 id="9-3-mvvc-å’Œ-for-updateçš„åŒºåˆ«">9.3 mvvc å’Œ for updateçš„åŒºåˆ«</h5><ol><li><strong>æ˜¯å¦åŠ é”</strong>ï¼š  mvvcä¸åŠ é”ï¼Œåªé€šè¿‡å¤šç‰ˆæœ¬æ¥è¿›è¡Œå¹¶å‘æ§åˆ¶ï¼›for updateä¼šåŠ é”ï¼ˆ<strong>å³X/å†™é”</strong>ï¼‰ã€‚</li></ol><h5 id="9-4-ï¼ˆå¿«æ‰‹ï¼‰MVCCä½œç”¨ï¼Œå¦‚ä½•å®ç°RCï¼ŒRR">9.4 <strong>ï¼ˆå¿«æ‰‹ï¼‰MVCCä½œç”¨ï¼Œå¦‚ä½•å®ç°RCï¼ŒRR?</strong></h5><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/73078137">https://zhuanlan.zhihu.com/p/73078137</a></p></blockquote><p><strong>ä½œç”¨å¦‚ä¸‹</strong>ï¼š</p><ol><li>æœ€ç®€å•çš„æè¿°ï¼Œ<strong>è¯»å†™ä¸é˜»å¡ï¼Œè¯»çš„æ—¶å€™å¯ä»¥å†™</strong></li><li>æé«˜æ€§èƒ½</li></ol><p><strong>å®ç°RCï¼ŒRRä¸¤ä¸ªéš”ç¦»çº§åˆ«</strong>ï¼š</p><blockquote><p>MVCC <strong>è¯»</strong>æŸä¸€ä¸ªæ•°æ®æ—¶ï¼Œ<strong>æ ¹æ®éš”ç¦»çº§åˆ«</strong>ï¼Œäº‹åŠ¡é€‰æ‹©è¦è¯»å–å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œè¿‡ç¨‹ä¸­å®Œå…¨ä¸éœ€è¦åŠ é”ã€‚</p></blockquote><ol><li><p><strong>Read Committed</strong> ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–æ•°æ®æ—¶æ€»æ˜¯è¯»è¿™ä¸ªæ•°æ®<strong>æœ€è¿‘ä¸€æ¬¡è¢«commit</strong>çš„ç‰ˆæœ¬ ï¼Œ<strong>æ‰€ä»¥å¯ä»¥é¿å…è„è¯»ï¼ˆå¿«æ‰‹</strong>ï¼‰ï¼›</p></li><li><p><strong>Repeatable Read</strong> ï¼š ä¸€ä¸ªäº‹åŠ¡è¯»å–æ•°æ®æ—¶æ€»æ˜¯è¯»å–å½“å‰ã€<strong>äº‹åŠ¡å¼€å§‹ä¹‹å‰ã€‘æœ€åä¸€æ¬¡è¢«commit</strong>çš„ç‰ˆæœ¬ï¼ˆæ‰€ä»¥åº•å±‚å®ç°æ—¶éœ€è¦æ¯”è¾ƒå½“å‰äº‹åŠ¡å’Œæ•°æ®è¢«commitçš„ç‰ˆæœ¬å·ï¼‰ï¼Œ<strong>æ‰€ä»¥é¿å…äº†å¹»è¯»ï¼ˆå¿«æ‰‹</strong>ï¼‰ã€‚</p></li></ol><p><strong>ä¸¾ä¸ªç®€å•çš„ä¾‹å­</strong>ï¼š</p><ol><li><strong>ä¸€ä¸ªäº‹åŠ¡Aï¼ˆtxnId=100ï¼‰ä¿®æ”¹äº†æ•°æ®Xï¼Œä½¿å¾—X=1ï¼Œå¹¶ä¸”commitäº†</strong></li><li><strong>å¦å¤–ä¸€ä¸ªäº‹åŠ¡Bï¼ˆtxnId=101ï¼‰å¼€å§‹å°è¯•è¯»å–Xï¼Œä½†æ˜¯è¿˜X=1ã€‚ä½†Bæ²¡æœ‰æäº¤ã€‚</strong></li><li><strong>ç¬¬ä¸‰ä¸ªäº‹åŠ¡Cï¼ˆtxnId=102ï¼‰ä¿®æ”¹äº†æ•°æ®Xï¼Œä½¿å¾—X=2ã€‚å¹¶ä¸”æäº¤äº†</strong></li><li><strong>äº‹åŠ¡Båˆä¸€æ¬¡è¯»å–äº†Xã€‚è¿™æ—¶</strong><ul><li><strong>å¦‚æœäº‹åŠ¡Bæ˜¯Read Committedã€‚é‚£ä¹ˆå°±è¯»å–Xçš„æœ€æ–°commitçš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯X=2</strong></li><li><strong>å¦‚æœäº‹åŠ¡Bæ˜¯Repeatable Readã€‚é‚£ä¹ˆè¯»å–çš„å°±æ˜¯å½“å‰äº‹åŠ¡ï¼ˆtxnId=101ï¼‰ä¹‹å‰Xçš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯Xè¢«txnId=100æäº¤çš„ç‰ˆæœ¬ï¼Œå³X=1ã€‚</strong></li></ul></li></ol><p>æ³¨æ„ï¼Œè¿™é‡ŒBä¸è®ºæ˜¯Read Committedï¼Œè¿˜æ˜¯Repeatable Readï¼Œ<strong>éƒ½ä¸ä¼šè¢«é”</strong>ï¼Œéƒ½èƒ½ç«‹åˆ»æ‹¿åˆ°ç»“æœã€‚è¿™ä¹Ÿå°±æ˜¯MVCCå­˜åœ¨çš„æ„ä¹‰ã€‚</p><h2 id="5-3-ç´¢å¼•ç›¸å…³">5.3 ç´¢å¼•ç›¸å…³</h2><blockquote><p>ğŸ›° å¼ºçƒˆå»ºè®®å¯¹ç´¢å¼•æ›´æ·±åˆ»ç†è§£ï¼Œå…ˆçœ‹å®Œç¾å›¢è¿™ç¯‡æŠ€æœ¯æ–‡ç« ï¼š<a href="https://tech.meituan.com/2014/06/30/mysql-index.html">MySQLç´¢å¼•åŸç†åŠæ…¢æŸ¥è¯¢ä¼˜åŒ–</a></p></blockquote><h4 id="0-MySQLç´¢å¼•åŸç†åŠæ…¢æŸ¥è¯¢ä¼˜åŒ–">0. <a href="https://tech.meituan.com/2014/06/30/mysql-index.html">MySQLç´¢å¼•åŸç†åŠæ…¢æŸ¥è¯¢ä¼˜åŒ–</a></h4><h5 id="0-1-ä¸ºä»€ä¹ˆè¦éœ€è¦ç´¢å¼•">0.1 ä¸ºä»€ä¹ˆè¦éœ€è¦ç´¢å¼•</h5><blockquote><p>ç­”åˆ°ï¼šéå†ç£ç›˜å¼€é”€å¤ªå¤§è¿™ä¸ªå…³é”®ã€‚</p></blockquote><p>æ•°æ®åº“å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæ•°æ®ä¿å­˜åœ¨<strong>ç£ç›˜</strong>ä¸Šï¼Œè€Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ¯æ¬¡åˆå¯ä»¥æŠŠ<strong>éƒ¨åˆ†è¯»å…¥å†…å­˜</strong>æ¥è®¡ç®— ã€‚</p><p>ç£ç›˜çš„æˆæœ¬å¤§æ¦‚æ˜¯è®¿é—®å†…å­˜çš„<strong>åä¸‡å€</strong>å·¦å³ ï¼Œ æ¯æ¬¡å»éå†ç£ç›˜æ‰¾åˆ°æ•°æ®å†è¯»å…¥å†…å­˜ï¼Œæ˜¯éš¾ä»¥æ¥å—çš„ã€‚å› æ­¤éœ€è¦ä¸€ç§å¿«é€Ÿæ‰¾åˆ°ç£ç›˜æ•°æ®çš„æ–¹å¼ï¼Œå°±åƒå­—å…¸é€šè¿‡<strong>å­—æ¯ç´¢å¼•â†’å¿«é€Ÿå®šä½å•è¯</strong>ã€‚å› æ­¤ç´¢å¼•ç”±æ­¤è€Œå‡ºç°ã€‚</p><h5 id="0-2-å±€éƒ¨æ€§åŸç†ï¼ˆç£ç›˜IOä¸€æ¬¡è¯»å–å¤§å°ï¼‰">0.2 å±€éƒ¨æ€§åŸç†ï¼ˆç£ç›˜IOä¸€æ¬¡è¯»å–å¤§å°ï¼‰</h5><blockquote><p>åœ¨ç»§ç»­å¾€ä¸‹è®²ä¹‹å‰ï¼Œå…ˆæ¥è®²è®²ç£ç›˜è¯»å–å±€éƒ¨æ€§åŸç†ã€‚</p></blockquote><p>å±€éƒ¨é¢„è¯»æ€§åŸç†å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“è®¡ç®—æœºè®¿é—®ä¸€ä¸ªåœ°å€çš„æ•°æ®çš„æ—¶å€™ï¼Œä¸<strong>å…¶ç›¸é‚»çš„æ•°æ®ä¹Ÿä¼šå¾ˆå¿«è¢«è®¿é—®åˆ°</strong>ã€‚</p><ul><li>å› æ­¤ï¼Œå½“<strong>ä¸€æ¬¡</strong>IOæ—¶ï¼Œä¸å…‰æŠŠå½“å‰ç£ç›˜åœ°å€çš„æ•°æ®ï¼Œè€Œæ˜¯æŠŠç›¸é‚»çš„æ•°æ®ä¹Ÿéƒ½è¯»å–åˆ°å†…å­˜ç¼“å†²åŒºå†…ã€‚</li></ul><p>æ¯æ¬¡IOè¯»å–çš„æ•°æ®ï¼Œåˆ†ä¸ºä¸‹é¢æƒ…å†µï¼š</p><ul><li>Linuxï¼šä¸Šä»¥<strong>é¡µ</strong>ä¸ºå•ä½ï¼Œä¸€æ¬¡ä¸€é¡µï¼ˆ<strong>4K</strong>ï¼‰</li><li>æ•°æ®åº“ï¼šmysqlï¼ˆInnoDBå¼•æ“ï¼‰ä¸€é¡µï¼ˆ<strong>16K</strong>ï¼‰; SQL Server/ Oracleï¼Œé»˜è®¤<strong>å—</strong>ï¼Œå¤§å°éƒ½æ˜¯<strong>8KB</strong></li></ul><h5 id="0-3-ç´¢å¼•â†’B-æ ‘">0.3 ç´¢å¼•â†’B+æ ‘</h5><p>ç›¸æ¯”äºŒå‰æ ‘ï¼Œå¹³è¡¡æ ‘ç­‰ï¼Œ<strong>B+æ ‘</strong> ä½œä¸º<strong>é«˜åº¦å¯æ§çš„å¤šè·¯æœç´¢æ ‘</strong> ï¼Œå¯ä»¥å¾ˆå¥½çš„æ»¡è¶³è¦æ±‚ã€‚ï¼ˆè¯¦ç»†é€‰æ‹©åŸå› ï¼Œå¯ä»¥å‚è€ƒï¼š<u>5.3 ç´¢å¼•ç›¸å…³â€“é—®ç­”6</u>ï¼‰</p><ul><li><p><strong>B+æ ‘åŸºæœ¬ç»“æ„</strong></p><p><img src="https://i.loli.net/2021/05/23/xXQFuqgEfpreHdG.jpg" alt="b+æ ‘"></p><p>æµ…è“è‰²æ˜¯ä¸€ä¸ªç£ç›˜å—ï¼Œæ•°æ®é¡¹å°±æ˜¯è¢«ç»„ç»‡ç´¢å¼•é‚£<strong>åˆ—</strong>çš„å­—æ®µå€¼ã€‚</p><blockquote><p>å¦‚æœæ˜¯Innodbå¼•æ“ï¼Œä½¿ç”¨èšç°‡ç´¢å¼•å°±æ˜¯æŒ‰ç…§æ¯å¼ è¡¨çš„<strong>ä¸»é”®</strong> æ„é€ ç´¢å¼•ï¼Œé‚£ä¹ˆæ­¤æ—¶<strong>æ•°æ®é¡¹å°±æ˜¯ä¸»é”®å€¼</strong>ã€‚</p></blockquote><ul><li><p>è“è‰²éƒ¨åˆ†ï¼ˆå¦‚17,35ï¼‰æ˜¯æ•°æ®é¡¹ï¼›é»„è‰²éƒ¨åˆ†ï¼ˆå¦‚P1,P2,P3ï¼‰æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘<strong>ä¸‹ä¸ªç£ç›˜å—ï¼ˆé¡µåœ°å€</strong>ï¼‰ã€‚</p></li><li><p><strong>1. ä¸ºä»€ä¹ˆB+æ ‘éå¶å­èŠ‚ç‚¹ä¸å­˜æ”¾æ•°æ®</strong>ï¼Ÿ</p><p>IOæ¬¡æ•°å–å†³äºb+æ•°çš„é«˜åº¦hï¼Œæ¯ä¸ªç£ç›˜å—å¤§å°ä¹Ÿæ˜¯ä¸€å®šï¼ˆä¸€é¡µï¼‰çš„ã€‚<strong>å¦‚æœæ•°æ®é¡¹å çš„ç©ºé—´è¶Šå°ï¼Œä¸€ä¸ªç£ç›˜å—æ•°æ®é¡¹çš„æ•°é‡è¶Šå¤šï¼Œæ ‘çš„é«˜åº¦è¶Šä½ï¼ŒB+å¯ä»¥æ›´é«˜é˜¶ï¼ˆæŒ‡é’ˆå ç”¨å…ˆå¿½ç•¥</strong>ï¼‰ã€‚</p><p>æ‰€ä»¥ç£ç›˜<strong>éå¶å­</strong>èŠ‚ç‚¹ä¸ä¿å­˜æ•°æ®ï¼Œæ˜¯ä¸ºäº†ä¿å­˜æ›´å¤šçš„æ•°æ®é¡¹å’ŒæŒ‡é’ˆï¼Œè¿™æ ·ä¸€é¢—B+æ ‘<strong>å¶å­</strong>èŠ‚ç‚¹å°±èƒ½å­˜å‚¨æ›´å¤šçš„æ•°æ®ã€‚</p></li><li><p><strong>2. æ•°æ®æŸ¥æ‰¾è¿‡ç¨‹</strong>ï¼Ÿ</p><p>ä»¥æŸ¥æ‰¾<code>æ•°æ®é¡¹=28</code> ï¼Œè¿‡ç¨‹ä¸ºä¾‹ï¼š<br>ï¼ˆ1ï¼‰ å…ˆ <u>åŠ è½½ï¼ˆä¸€èˆ¬å¸¸é©»å†…å­˜ï¼‰</u> æ ¹é¡µé¢1ï¼ˆç£ç›˜å—1ï¼‰ï¼Œå› ä¸º<code>17&lt;28&lt;35</code> æ‰€ä»¥ä½¿ç”¨<code>P2</code>æŒ‡é’ˆ ï¼Œ æ‰¾åˆ°ç£ç›˜å—3ï¼ˆé¡µé¢3ï¼‰<strong>åœ°å€</strong></p><p>ï¼ˆ2ï¼‰åœ¨ <u>IOåŠ è½½</u> ç£ç›˜å—3ï¼Œå› ä¸º <code>26&lt;28&lt;30</code>  ï¼Œå› æ­¤æ ¹æ®æ­¤æ—¶çš„<code>P2</code> æŒ‡é’ˆï¼Œæ‰¾åˆ°ç£ç›˜å—8æ‰€åœ¨çš„åœ°å€</p><p>ï¼ˆ3ï¼‰ <u>IOåŠ è½½</u> ç£ç›˜å—8ï¼Œå› ä¸ºæ­¤æ—¶æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥å¾—åˆ°<code>æ•°æ®é¡¹=28</code>å¯¹åº”çš„<strong>é‚£è¡Œè®°å½•</strong> ã€‚</p><p>ä»…ä»…æœ€å¤š<strong>3</strong>æ¬¡ç£ç›˜IOå°±æ‰¾åˆ°äº†æ•°æ®ï¼Œè¿™æå‡æ˜¯å·¨å¤§çš„ã€‚</p></li><li><p><strong>3. é«˜åº¦ä¸º3çš„B+æ•°å¯ä»¥å­˜å‚¨å¤šå°‘æ•°æ®</strong>ï¼Ÿ</p><ul><li><p><strong>å¶å­èŠ‚ç‚¹ä¸€é¡µå­˜å‚¨çš„è®°å½•æ•°</strong></p><p>mysqlä¸€é¡µ16Kï¼Œæ‰€ä»¥ä¸€é¡µå­˜å‚¨<code>16K/1K = 16æ¡</code> è®°å½•ã€‚ï¼ˆå®é™…çœŸå®ä¸šåŠ¡åœºæ™¯ä¸€æ¡è®°å½•ä¸€èˆ¬å°±æ˜¯1Kï¼‰</p></li><li><p><strong>éå¶å­èŠ‚ç‚¹ä¸€é¡µå­˜å‚¨çš„æŒ‡é’ˆæ•°</strong></p><p>ç”±äºæ•°æ®é¡¹ä¹Ÿè¦å ç”¨ç©ºé—´ï¼Œå…¶å’ŒæŒ‡é’ˆåªç›¸å·®1ï¼ŒæŒ‰<strong>æˆå¯¹</strong>ç®—ã€‚</p><p>å‡è®¾ä¸»é”®IDï¼ˆæ•°æ®é¡¹ï¼‰ä¸ºbigintç±»å‹ï¼Œé•¿åº¦ä¸º<code>8</code>å­—èŠ‚ï¼Œè€Œ<code>æŒ‡é’ˆå¤§å°</code>åœ¨InnoDBæºç ä¸­è®¾ç½®ä¸º<code>6å­—èŠ‚</code> ã€‚é‚£ä¹ˆä¸€å…±<code>14</code>å­—èŠ‚ã€‚</p><p>æ‰€ä»¥ä¸€é¡µå¯ä»¥å­˜å‚¨ï¼š<code>16K / 14B â‰ˆ 1K</code> ä¸ªæŒ‡å‘é¡µé¢çš„æŒ‡é’ˆã€‚</p></li><li><p><strong>è®¡ç®—å¯ä»¥å­˜å‚¨å¤šå°‘é¡µ</strong></p><p>é«˜åº¦ä¸º3çš„B+æ ‘ï¼Œç¬¬3å±‚å¶å­èŠ‚ç‚¹å­˜å‚¨çœŸå®<strong>æ•°æ®é¡µ</strong>ï¼Œå‰2å±‚æ˜¯å­˜å‚¨<strong>æ•°æ®é¡¹+æŒ‡é’ˆ</strong>ã€‚<strong>ç¬¬äºŒå±‚æŒ‡é’ˆ</strong>==å¶å­èŠ‚ç‚¹å­˜å‚¨çš„é¡µé¢æ•°ã€‚</p><ol><li>ç¬¬ä¸€å±‚ï¼šæ ¹é¡µé¢å¯ä»¥å­˜å‚¨1Kä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°çš„é¡µé¢</li><li>ç¬¬äºŒå±‚ï¼šå­˜å‚¨ <code>1K*1K = 1M</code> ï¼Œçº¦ä¸€ç™¾ä¸‡ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ç™¾ä¸‡ä¸ªå¶å­æ•°æ®é¡µé¢</li></ol><p>æ‰€ä»¥ä¸€å…±å­˜å‚¨ï¼š<code>1M*16â‰ˆ16M</code> ï¼Œå³åƒä¸‡çº§åˆ«çš„æ•°æ®ã€‚</p></li></ul></li></ul></li></ul><h5 id="0-4-æ…¢æŸ¥è¯¢ä¼˜åŒ–">0.4 æ…¢æŸ¥è¯¢ä¼˜åŒ–</h5><p>ï¼ˆæš‚ç•¥ï¼‰</p><h4 id="1-MySQç´¢å¼•çš„åŸç†å’Œæ•°æ®ç»“æ„èƒ½ä»‹ç»ä¸€ä¸‹å—ï¼Ÿç´¢å¼•çš„ç¼ºç‚¹ï¼Ÿ">1. <strong>MySQç´¢å¼•çš„åŸç†å’Œæ•°æ®ç»“æ„èƒ½ä»‹ç»ä¸€ä¸‹å—</strong>ï¼Ÿ<strong>ç´¢å¼•çš„ç¼ºç‚¹</strong>ï¼Ÿ</h4><ul><li><p><strong>ç´¢å¼•åŸç†</strong>ï¼š æœ¬è´¨æ˜¯ç”¨æ¥ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦ã€‚<u>ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„ç»„ç»‡æŸä¸€åˆ—çš„æ•°æ®</u>ï¼Œç„¶åå¦‚æœä½ è¦æ ¹æ®é‚£ä¸€åˆ—çš„æ•°æ®æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±å¯ä»¥<u>ä¸ç”¨å…¨è¡¨æ‰«æ</u>ï¼Œåªè¦æ ¹æ®é‚£ä¸ªç‰¹å®šçš„æ•°æ®ç»“æ„å¿«é€Ÿå»æ‰¾åˆ°é‚£ä¸€åˆ—çš„å€¼ã€‚</p></li><li><p><strong>æ•°æ®ç»“æ„</strong>ï¼š MySQLç´¢å¼•é€šè¿‡B+æ ‘æ¥å®ç°ï¼ˆæŒ‰æ•°æ®ç»“æ„åˆ†ä¹Ÿæœ‰hashç´¢å¼•ã€fulltextç´¢å¼•ï¼‰ã€‚</p></li><li><p><strong>ç´¢å¼•ç¼ºç‚¹</strong>ï¼š ï¼ˆ1ï¼‰å ç”¨ç£ç›˜å­˜å‚¨ç©ºé—´ ï¼ˆ2ï¼‰é™ä½è¡¨æ›´æ–°é€Ÿåº¦ï¼Œè¡¨å‘ç”Ÿå˜åŒ–ï¼Œç´¢å¼•ä¹Ÿè¦å‘ç”Ÿå˜åŒ–</p></li></ul><h4 id="2-MySQL-ç´¢å¼•ç±»å‹æœ‰å“ªäº›ï¼Ÿ">2. <strong>MySQL ç´¢å¼•ç±»å‹æœ‰å“ªäº›</strong>ï¼Ÿ</h4><p>æŒ‰æ•°æ®ç»“æ„åˆ†ç±»å¯åˆ†ä¸ºï¼š<strong>B+treeç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•</strong>ã€‚<br>æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»å¯åˆ†ä¸ºï¼š<strong>èšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•</strong>ï¼‰ã€‚<br>æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»å¯åˆ†ä¸ºï¼š<strong>ä¸»é”®ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•</strong>ã€‚<br>æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»å¯åˆ†ä¸ºï¼š<strong>å•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ã€ç»„åˆç´¢å¼•</strong>ï¼‰ã€‚</p><ul><li><p><strong>ä¸»é”®ç´¢å¼•</strong>ï¼šç´¢å¼•åˆ—ä¸­çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ï¼›</p></li><li><p><strong>å”¯ä¸€ç´¢å¼•</strong>ï¼šç´¢å¼•åˆ—ä¸­çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯å…è®¸ä¸ºç©ºå€¼ï¼›</p></li><li><p><strong>æ™®é€šç´¢å¼•</strong>ï¼šMySQLä¸­<u>åŸºæœ¬ç´¢å¼•ç±»å‹</u>ï¼Œæ²¡æœ‰ä»€ä¹ˆé™åˆ¶ï¼Œå…è®¸åœ¨å®šä¹‰ç´¢å¼•çš„åˆ—ä¸­æ’å…¥é‡å¤å€¼å’Œç©ºå€¼ï¼›</p></li><li><p><strong>å…¨æ–‡ç´¢å¼•</strong>ï¼šåªèƒ½åœ¨<strong>æ–‡æœ¬ç±»å‹CHAR,VARCHAR,TEXT</strong>ç±»å‹å­—æ®µä¸Šåˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼›</p><blockquote><p>å­—æ®µé•¿åº¦æ¯”è¾ƒå¤§æ—¶ï¼Œå¦‚æœåˆ›å»ºæ™®é€šç´¢å¼•ï¼Œåœ¨è¿›è¡Œlikeæ¨¡ç³ŠæŸ¥è¯¢æ—¶æ•ˆç‡æ¯”è¾ƒä½ï¼Œè¿™æ—¶å¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼›</p><p>MyISAMå’ŒInnoDBä¸­éƒ½å¯ä»¥ä½¿ç”¨å…¨æ–‡ç´¢å¼•ã€‚</p></blockquote></li><li><p><strong>å‰ç¼€ç´¢å¼•</strong>ï¼šåœ¨æ–‡æœ¬ç±»å‹å¦‚CHAR,VARCHAR,TEXTç±»åˆ—ä¸Šåˆ›å»ºç´¢å¼•æ—¶ï¼Œå¯ä»¥æŒ‡å®šç´¢å¼•åˆ—çš„é•¿åº¦ï¼Œä½†æ˜¯æ•°å€¼ç±»å‹ä¸èƒ½æŒ‡å®šï¼›</p></li><li><p><strong>ç©ºé—´ç´¢å¼•</strong>ï¼š MySQLåœ¨5.7ä¹‹åçš„ç‰ˆæœ¬æ”¯æŒäº†ç©ºé—´ç´¢å¼•ï¼Œè€Œä¸”æ”¯æŒOpenGISå‡ ä½•æ•°æ®æ¨¡å‹ã€‚</p><blockquote><p>MySQLåœ¨ç©ºé—´ç´¢å¼•è¿™æ–¹é¢éµå¾ªOpenGISå‡ ä½•æ•°æ®æ¨¡å‹è§„åˆ™ã€‚</p></blockquote></li></ul><h5 id="2-1-ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ">2.1 ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ</h5><p>æˆ‘ä»¬åœ¨<u>éèšç°‡ç´¢</u>å¼•ä¸€èˆ¬åªè·å¾—äº†ï¼Œè®°å½•çš„keyå€¼ï¼ˆInnodbå¼•æ“ï¼‰ï¼Œè¿˜éœ€è¦å›åˆ°èšç°‡ç´¢å¼•ä¸­<strong>å†æ¬¡æŸ¥è¯¢</strong>ã€‚</p><ul><li><strong>è¦†ç›–ç´¢å¼•</strong>ï¼š ä»<strong>éä¸»é”®ç´¢å¼•ä¸­å°±èƒ½æŸ¥åˆ°çš„è®°å½•</strong>ï¼Œè€Œä¸éœ€è¦æŸ¥è¯¢ä¸»é”®ç´¢å¼•ä¸­çš„è®°å½•ï¼Œé¿å…äº†å›è¡¨çš„äº§ç”Ÿå‡å°‘äº†æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€‚</li></ul><blockquote><p>ä¸€ä¸ªå°ä¾‹å­ã€‚</p></blockquote><p>ä»¥nameå’Œageä¸¤ä¸ªå­—æ®µå»ºç«‹<strong>è”åˆç´¢å¼•</strong>ï¼Œsqlå‘½ä»¤ä¸å»ºç«‹åçš„ç´¢å¼•æ ‘ç»“æ„å¦‚ä¸‹ï¼š</p><img src="https://i.loli.net/2021/05/28/V2ApYvt9zWGFhcf.png" alt="image-20210526230732546" style="zoom:80%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE student DROP INDEX I_name;</span><br><span class="line">ALTER TABLE student ADD INDEX I_name_age(name, age);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰§è¡Œå¦‚ä¸‹sqlï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT age FROM student WHERE name = &#x27;å°æ&#x27;ï¼›</span><br></pre></td></tr></table></figure><p>åœ¨<strong>éèšç°‡ç´¢å¼•ä¸­åŒ…å«äº†ageä¿¡æ¯</strong>ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›12ï¼Œä¸éœ€è¦å†åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥è¯¢ã€‚</p><h4 id="ã€é‡ç‚¹ã€‘3-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç´¢å¼•æ¯”è¾ƒå¥½ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸è¦ä½¿ç”¨ç´¢å¼•ï¼Ÿ">ã€é‡ç‚¹ã€‘3.<strong>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç´¢å¼•æ¯”è¾ƒå¥½</strong>ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸è¦ä½¿ç”¨ç´¢å¼•ï¼Ÿ</h4><h5 id="3-1-ä»€ä¹ˆæ—¶å€™ç”¨ç´¢å¼•">3.1 ä»€ä¹ˆæ—¶å€™ç”¨ç´¢å¼•</h5><blockquote><p>ç‰¹åˆ«çš„ï¼Œä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•ã€‚</p></blockquote><ol><li><p><strong>é¢‘ç¹</strong>ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼• ï¼›</p></li><li><p><strong>æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µ</strong>ï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•ï¼›</p></li><li><p><strong>æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µ</strong>ï¼Œæ’åºå­—æ®µè‹¥é€šè¿‡ç´¢å¼•å»è®¿é—®å°†å¤§å¤§æé«˜æ’åºé€Ÿåº¦ï¼ˆ<strong>ç´¢å¼•å°±æ˜¯æ’åºåŠ å¿«é€ŸæŸ¥æ‰¾</strong>ï¼‰ï¼›</p></li><li><p><strong>æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–è€…åˆ†ç»„å­—æ®µ</strong>ã€‚</p></li></ol><h5 id="3-2-ä»€ä¹ˆæ—¶å€™ä¸ç”¨ç´¢å¼•">3.2 ä»€ä¹ˆæ—¶å€™ä¸ç”¨ç´¢å¼•</h5><ol><li><p><strong>ç»å¸¸å¢åˆ æ”¹</strong>çš„åˆ—ä¸è¦å»ºç«‹ç´¢å¼•ï¼ˆå› ä¸ºæ¯æ¬¡æ›´æ–°ä¸å•å•æ˜¯æ›´æ–°è®°å½•ï¼Œè¿˜ä¼šæ›´æ–°ç´¢å¼•ï¼Œä¿å­˜ç´¢å¼•æ–‡ä»¶ï¼‰ï¼›</p></li><li><p><strong>è¡¨è®°å½•å¤ªå°‘</strong>ä¸è¦å»ºç«‹ç´¢å¼•ï¼›</p></li><li><p>ï¼ˆ<strong>è¢«CSIGé—®è¿‡</strong>ï¼‰åŒºåˆ†åº¦ä½ï¼Œæ•°æ®é‡å¤ä¸”åˆ†å¸ƒå¹³å‡çš„å­—æ®µä¸é€‚åˆåšç´¢å¼•ï¼›</p><blockquote><p>ä¾‹å¦‚æ€§åˆ«å­—æ®µï¼Œåªæœ‰ç”·å¥³ï¼Œä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚</p><ul><li>å› ä¸ºä»ç´¢å¼•ä¸­æ‹¿åˆ°çš„åªæ˜¯åœ°å€ï¼Œè¦æƒ³çœŸæ­£è®¿é—®åˆ°æ•°æ®è¿˜æ˜¯è¦å¯¹è¡¨è¿›è¡Œä¸€æ¬¡IOï¼›</li><li>å‡å¦‚ä½ è¦ä»è¡¨çš„100ä¸‡è¡Œæ•°æ®ä¸­å–å‡ ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆåˆ©ç”¨ç´¢å¼•è¿…é€Ÿå®šä½ï¼Œè®¿é—®ç´¢å¼•çš„è¿™IOå¼€é”€å°±éå¸¸å€¼äº†ï¼›</li><li>ä½†å¦‚æœä½ æ˜¯ä»100ä¸‡è¡Œæ•°æ®ä¸­å–50ä¸‡è¡Œæ•°æ®ï¼Œå°±æ¯”å¦‚æ€§åˆ«å­—æ®µï¼Œé‚£ä½ ç›¸å¯¹éœ€è¦ <u>è®¿é—®50ä¸‡æ¬¡ç´¢å¼•ï¼Œå†è®¿é—®50ä¸‡æ¬¡è¡¨</u>ï¼ŒåŠ èµ·æ¥çš„å¼€é”€å¹¶ä¸ä¼šæ¯”ç›´æ¥å¯¹è¡¨è¿›è¡Œä¸€æ¬¡å®Œæ•´æ‰«æå°ã€‚</li></ul></blockquote></li><li><p><strong>textï¼Œimage</strong>ç­‰ç±»å‹ä¸åº”è¯¥å»ºç«‹ç´¢å¼•ï¼Œ<strong>è¿™äº›åˆ—çš„æ•°æ®é‡å¤§</strong>ï¼›</p></li><li><p><strong>å¤šä¸ªå•åˆ—ç´¢å¼•å¹¶ä¸æ˜¯æœ€ä½³é€‰æ‹©</strong> MySQL åªèƒ½ä½¿ç”¨ä¸€ä¸ªç´¢å¼•ï¼Œä¼šä»å¤šä¸ªç´¢å¼•ä¸­é€‰æ‹©ä¸€ä¸ªé™åˆ¶æœ€ä¸ºä¸¥æ ¼çš„ç´¢å¼• ï¼›</p></li><li><p><strong>å‚åŠ è¿ç®— æˆ– ä½œä¸ºå‡½æ•°å‚å€¼ç­‰å­—æ®µ</strong>ï¼Œä¸è¦å»ºç«‹ç´¢å¼•ï¼Œè¿™ä¼šä½¿å¾—ç´¢å¼•å¤±æ•ˆè€Œå…¨è¡¨æ‰«æ ã€‚</p></li></ol><h4 id="4-ä¸»é”®ä¸å”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">4.<strong>ä¸»é”®ä¸å”¯ä¸€ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><p>ä¸»é”®ä¸€<strong>å®šä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯æœ‰å”¯ä¸€ç´¢å¼•çš„åˆ—ä¸ä¸€å®šæ˜¯ä¸»é”®ï¼›</strong></p></li><li><p>ä¸»é”®ä¸å…è®¸ä¸ºç©ºå€¼ï¼Œå”¯ä¸€ç´¢å¼•åˆ—å…è®¸ç©ºå€¼ï¼›</p></li><li><p>ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼›</p></li><li><p>ä¸»é”®å¯ä»¥è¢«<strong>å…¶ä»–è¡¨å¼•ç”¨ä¸ºå¤–é”®ï¼Œå”¯ä¸€ç´¢å¼•åˆ—ä¸å¯ä»¥ï¼›</strong></p></li><li><p>ä¸»é”®æ˜¯ä¸€ç§çº¦æŸï¼Œè€Œå”¯ä¸€ç´¢å¼•æ˜¯ä¸€ç§ç´¢å¼•ï¼Œæ˜¯è¡¨çš„å†—ä½™æ•°æ®ç»“æ„ï¼Œä¸¤è€…æœ‰æœ¬è´¨å·®åˆ«ã€‚</p></li></ul><h4 id="5-b-æ ‘å’Œbæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">5. <strong>b+æ ‘å’Œbæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</h4><p>Bæ ‘ï¼š</p><p><img src="https://i.loli.net/2021/04/21/YsAxSctJ1wKUm3g.png" alt="clip_image002"></p><ul><li>ç´¢å¼•ä¸æ•°æ®å­˜å‚¨åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼ˆå¢åŠ äº†IOæ¬¡æ•°ï¼‰ï¼›</li><li>æœç´¢è¿‡ç¨‹æœ‰å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹ç»“æŸï¼ˆæœ€å¥½æƒ…å†µä¸‹<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼‰ã€‚</li></ul><p>B+æ ‘ï¼š</p><p><img src="https://i.loli.net/2021/04/21/ihT3SbqwodNUvPe.png" alt="clip_image039"></p><ul><li>æ‰€æœ‰æ•°æ®<strong>æŒ‰é¡ºåº</strong>å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼›</li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹è¢«<strong>åŒå‘é“¾è¿æ¥</strong>ï¼›</li><li>æœç´¢è¿‡ç¨‹å›ºå®šæ—¶é—´å¤æ‚åº¦ï¼ˆ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>â¡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>ï¼‰ï¼›</li><li>ï¼ˆä¼˜ç‚¹æ˜“å¿˜ï¼‰<u>é€‚åˆèŒƒå›´æŸ¥æ‰¾ï¼Œé™ä½ç£ç›˜IOæ¬¡æ•°</u>ã€‚</li></ul><h4 id="6-ä¸ºä»€ä¹ˆMySQLä½¿ç”¨B-æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿè€Œä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€çº¢é»‘æ ‘ã€Bæ ‘ã€æˆ–è€…Hashï¼Ÿ">6.<strong>ä¸ºä»€ä¹ˆMySQLä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•ï¼Ÿè€Œä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€çº¢é»‘æ ‘ã€Bæ ‘ã€æˆ–è€…Hashï¼Ÿ</strong></h4><ul><li><p><strong>ä¸ç”¨å¹³è¡¡äºŒå‰æ ‘æˆ–è€…çº¢é»‘æ ‘</strong>ï¼š æ ‘çš„æŸ¥è¯¢æ—¶é—´å’Œæ ‘çš„ç»“æ„æœ‰å…³ï¼ŒB+æ ‘æ˜¯ä¸€é¢—å¤šè·¯æœç´¢æ•°ï¼Œå¯ä»¥é™ä½æ ‘çš„é«˜åº¦æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</p></li><li><p><strong>ä¸ç”¨Bæ ‘</strong>ï¼š ï¼ˆ1ï¼‰æ— æ³•èŒƒå›´æŸ¥è¯¢ï¼Œè€Œ<strong>B+æ ‘æ‰€æœ‰å¶å­èŠ‚ç‚¹å½¢æˆæœ‰åºé“¾è¡¨ä¾¿äºèŒƒå›´æŸ¥è¯¢</strong>ï¼›ï¼ˆ2ï¼‰Né˜¶B+æ•°ï¼ŒBæ ‘ï¼ŒB+æ•°å¯ä»¥å­˜å‚¨nä¸ªå…³é”®å­—ï¼Œè€ŒBæ ‘æ˜¯nä¸ªã€‚</p></li><li><p><strong>ä¸ç”¨Hashï¼š</strong> ï¼ˆ1ï¼‰B+æ ‘å…è®¸åˆ†é…åŠ è½½èŠ‚ç‚¹ï¼Œå¦‚æœå†…å­˜æ•°æ®å¤ªå¤§B+æ ‘æ›´å¥½ï¼ˆ2ï¼‰B+æ ‘æ›´é€‚åˆèŒƒå›´æŸ¥è¯¢</p><blockquote><p>ç”¨Hashéœ€è¦æŠŠæ•°æ®å…¨éƒ¨<strong>åŠ è½½åˆ°å†…å­˜ä¸­</strong>ï¼Œå¦‚æœæ•°æ®é‡å¤§ï¼Œæ˜¯ä¸€ä»¶å¾ˆ<strong>æ¶ˆè€—å†…å­˜</strong>çš„äº‹ï¼Œè€Œé‡‡ç”¨B+æ ‘ï¼Œæ˜¯åŸºäº<strong>æŒ‰ç…§èŠ‚ç‚¹åˆ†æ®µåŠ è½½ï¼Œç”±æ­¤å‡å°‘å†…å­˜æ¶ˆè€—</strong>ã€‚</p></blockquote></li></ul><h5 id="6-1-æ— é™å¢åŠ æ ‘çš„è·¯æ•°æ˜¯ä¸æ˜¯å¯ä»¥æœ‰æœ€ä¼˜çš„æŸ¥æ‰¾æ•ˆç‡ï¼Ÿ">6.1 <strong>æ— é™å¢åŠ æ ‘çš„è·¯æ•°æ˜¯ä¸æ˜¯å¯ä»¥æœ‰æœ€ä¼˜çš„æŸ¥æ‰¾æ•ˆç‡</strong>ï¼Ÿ</h5><ul><li><p>è¿™æ ·ä¼šå½¢æˆä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œæ–‡ä»¶ç³»ç»Ÿå’Œæ•°æ®åº“çš„ç´¢å¼•éƒ½æ˜¯å­˜åœ¨ç¡¬ç›˜ä¸Šçš„ï¼Œå¹¶ä¸”å¦‚æœæ•°æ®é‡å¤§çš„è¯ï¼Œ<u>ä¸ä¸€å®šèƒ½ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­</u>ã€‚</p></li><li><p><strong>æœ‰åºæ•°ç»„æ²¡æ³•ä¸€æ¬¡æ€§åŠ è½½è¿›å†…å­˜</strong>ï¼Œè¿™æ—¶å€™B+æ ‘çš„å¤šè·¯å­˜å‚¨å¨åŠ›å°±å‡ºæ¥äº†ï¼Œ<strong>å¯ä»¥æ¯æ¬¡åŠ è½½B+æ ‘çš„ä¸€ä¸ªç»“ç‚¹ï¼Œç„¶åä¸€æ­¥æ­¥å¾€ä¸‹æ‰¾</strong>ã€‚</p></li></ul><h4 id="7-B-æ ‘æ€ä¹ˆè¿›è¡Œåˆ†è£‚ã€åˆå¹¶çš„ï¼ŸçŸ¥é“å…·ä½“æ­¥éª¤å—ï¼Ÿ">7. <strong>B+æ ‘æ€ä¹ˆè¿›è¡Œåˆ†è£‚ã€åˆå¹¶çš„ï¼ŸçŸ¥é“å…·ä½“æ­¥éª¤å—</strong>ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/nullzx/p/8729425.htm">https://www.cnblogs.com/nullzx/p/8729425.htm</a></p></blockquote><p><img src="https://i.loli.net/2021/04/21/aejwRD2WxNb7slY.png" alt="image-20210421124006795"></p><h4 id="8-MySQLèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ">8. <strong>MySQLèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</h4><ul><li><p><strong>ä¸»è¦åŒºåˆ«</strong></p><ul><li><p><strong>èšç°‡ç´¢å¼•</strong> ï¼š æ‰¾åˆ°ç´¢å¼•å°±æ‰¾åˆ°äº†éœ€è¦çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªç´¢å¼•å°±æ˜¯èšç°‡ç´¢å¼•;</p><blockquote><p>æ‰€ä»¥Innodbä¸»é”®å°±æ˜¯<strong>èšç°‡ç´¢å¼•</strong>ï¼Œä¿®æ”¹èšç°‡ç´¢å¼•å…¶å®å°±æ˜¯ä¿®æ”¹ä¸»é”®ï¼›ä½†åœ¨<u>Myisamä¸‹ä¸»é”®ç´¢å¼•æ˜¯éèšé›†ç´¢å¼•</u>ã€‚</p><p>InnoDB ä¼š<strong>éšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®</strong>æ¥ä½œä¸ºèšç°‡ç´¢å¼•ï¼ˆä½†æ˜¯è¿™ä¸ªä¸»é”®å¦‚æœæ›´æ”¹ä»£ä»·è¾ƒé«˜ï¼Œ<u>æ•…å»ºè¡¨æ—¶è¦è€ƒè™‘è‡ªå¢IDä¸èƒ½é¢‘ç¹update</u>è¿™ç‚¹ï¼‰ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/03/mzwGgCjxuIpaeA7.png" alt="img"></p></li><li><p><strong>éèšç°‡ç´¢å¼•</strong>ï¼šç´¢å¼•çš„å­˜å‚¨å’Œæ•°æ®çš„å­˜å‚¨æ˜¯åˆ†ç¦»çš„ , æ‰¾åˆ°äº†ç´¢å¼•ä½†æ²¡æ‰¾åˆ°æ•°æ®ï¼Œéœ€è¦æ ¹<u>æ®<strong>ç´¢å¼•ä¸Šçš„å€¼(ä¸»é”®/åœ°å€)å†æ¬¡å›è¡¨æŸ¥è¯¢</strong></u>ï¼Œ<strong>ä¹Ÿå«åšè¾…åŠ©ç´¢å¼•</strong>ã€‚</p><blockquote><p>MyISMä½¿ç”¨çš„æ˜¯éèšç°‡ç´¢å¼• ï¼Œä¸‹å›¾å¶èŠ‚ç‚¹çš„<strong>dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€</strong> ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/03/A1X5aOY6qkuEol9.png" alt="img"></p></li></ul></li><li><p><strong>èšç°‡ç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹</strong></p><blockquote><p>é¦–å…ˆæ¾„æ¸…ä¸€ä¸ªæ¦‚å¿µï¼Œèšç°‡ç´¢å¼•å’Œå’Œè¾…åŠ©ç´¢å¼•ã€‚</p><p>Innodbå­˜å‚¨å¼•æ“çš„B+æ ‘åˆ†ä¸ºï¼Œèšç°‡ç´¢å¼•ä¿å­˜çš„æ˜¯æ”¾ç€ä¸€æ•´è¡Œçš„æ•°æ®ï¼›è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨<u>ä¸»é”®ä½œä¸ºdataåŸŸ</u>ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹å›¾ä»¥Col3å»ºç«‹ä¸€ä¸ª<strong>Innodbè¾…åŠ©ç´¢å¼•</strong> ï¼š</p><p><img src="https://i.loli.net/2021/05/03/l1IHbpgGAYr73sT.png" alt="img"></p><p>å¯¹äºMyISAMï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚<strong>åªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹å›¾ä»¥Col2å»ºç«‹ä¸€ä¸ª<strong>MyISAMçš„è¾…åŠ©ç´¢å¼•</strong>ï¼š</p><p><img src="https://i.loli.net/2021/05/03/9jpKvRbIWFwucLT.png" alt="img"></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Select * Where name=â€˜Aliceâ€™</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ ¹æ®<u>è¾…åŠ©ç´¢å¼•</u> ï¼Œåœ¨å¶å­èŠ‚ç‚¹æ‰¾åˆ°<strong>0X56å¯¹åº”ä¸»é”®å€¼</strong><code>18</code> ï¼›ç„¶ååœ¨<u>èšç°‡ç´¢å¼•</u>ï¼Œæ ¹æ®<code>18</code> æ‰¾åˆ°å¯¹åº”è¡Œæ•°æ®ã€‚</p></li></ul><h5 id="8-1-çœ‹ä¸Šå»èšç°‡ç´¢å¼•çš„æ•ˆç‡æ˜æ˜¾è¦ä½äºéèšç°‡ç´¢å¼•ï¼Œå› ä¸ºæ¯æ¬¡ä½¿ç”¨è¾…åŠ©ç´¢å¼•æ£€ç´¢éƒ½è¦ç»è¿‡ä¸¤æ¬¡B-æ ‘æŸ¥æ‰¾ï¼Œè¿™ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—ï¼Ÿèšç°‡ç´¢å¼•çš„ä¼˜åŠ¿åœ¨å“ªï¼Ÿ">8.1 <strong>çœ‹ä¸Šå»èšç°‡ç´¢å¼•çš„æ•ˆç‡æ˜æ˜¾è¦ä½äºéèšç°‡ç´¢å¼•ï¼Œå› ä¸ºæ¯æ¬¡ä½¿ç”¨è¾…åŠ©ç´¢å¼•æ£€ç´¢éƒ½è¦ç»è¿‡ä¸¤æ¬¡B+æ ‘æŸ¥æ‰¾ï¼Œè¿™ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—ï¼Ÿèšç°‡ç´¢å¼•çš„ä¼˜åŠ¿åœ¨å“ª</strong>ï¼Ÿ</h5><ul><li><p><strong>é‡å¤è®¿é—®åŒä¸€é¡µæ›´å¿«</strong>ï¼šç”±äºè¡Œæ•°æ®å’Œå¶å­èŠ‚ç‚¹å­˜å‚¨åœ¨ä¸€èµ·ï¼ŒåŒä¸€é¡µä¸­ä¼šæœ‰å¤šæ¡è¡Œæ•°æ®ï¼Œè®¿é—®åŒä¸€æ•°æ®é¡µä¸åŒè¡Œè®°å½•æ—¶ï¼Œ<strong>å·²ç»æŠŠé¡µåŠ è½½åˆ°äº†Bufferä¸­</strong>ï¼Œ<strong>å†æ¬¡è®¿é—®çš„æ—¶å€™ï¼Œä¼šåœ¨å†…å­˜ä¸­å®Œæˆè®¿é—®</strong>ï¼Œä¸å¿…è®¿é—®ç£ç›˜ï¼›</p><blockquote><p>B+æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹çš„æ•°é‡éƒ½æ˜¯ä¸€ä¸ªmysqlåˆ†åŒºé¡µçš„å¤§å°(é˜¿é‡Œé¢è¯•) ã€‚</p></blockquote></li><li><p><strong>è¾…åŠ©ç´¢å¼•ä½¿ç”¨ä¸»é”®å€¼ä½œä¸ºæŒ‡é’ˆ</strong>ï¼š è¾…åŠ©ç´¢å¼•ä½¿ç”¨ä¸»é”®ä½œä¸º&quot;æŒ‡é’ˆ&quot;è€Œä¸æ˜¯ä½¿ç”¨åœ°å€å€¼ä½œä¸ºæŒ‡é’ˆï¼ˆMyISAMï¼‰ ï¼Œ<strong>å‡å°‘äº†å½“å‡ºç°ã€è¡Œç§»åŠ¨ã€‘æˆ–è€…æ•°æ®é¡µåˆ†è£‚æ—¶ï¼ˆ<u>åœ°å€å€¼å˜åŒ–</u>ï¼‰è¾…åŠ©ç´¢å¼•çš„ç»´æŠ¤å·¥ä½œ</strong> ã€‚</p></li></ul><h5 id="8-2-ä¸ºä»€ä¹ˆname-ageè¿™äº›å­—æ®µä¸é€‚åˆåšç´¢å¼•ï¼Ÿ">8.2 ä¸ºä»€ä¹ˆname,ageè¿™äº›å­—æ®µä¸é€‚åˆåšç´¢å¼•ï¼Ÿ</h5><p>åœ¨InnoDBä¸­æ¯ä¸€ä¸ªè¡¨éƒ½ä¼šæœ‰èšé›†ç´¢å¼•ï¼Œå¦‚æœè¡¨å®šä¹‰äº†ä¸»é”®ï¼Œåˆ™ï¼ˆé»˜è®¤ï¼‰ä¸»é”®å°±æ˜¯èšç°‡ç´¢å¼•ã€‚</p><p>ä¸€ä¸ªè¡¨åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼Œå…¶ä½™ä¸ºæ™®é€šç´¢å¼•ã€‚æ‰€ä»¥nameï¼Œageå°±æ˜¯æ™®é€šç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯ä½œä¸ºè¾…åŠ©ç´¢å¼•ã€‚</p><p>åœ¨ä½¿ç”¨æ™®é€šç´¢å¼•nameæŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆåŠ è½½æ™®é€šç´¢å¼•ï¼š</p><p>ï¼ˆ1ï¼‰é€šè¿‡æ™®é€šç´¢å¼•æŸ¥è¯¢åˆ°å®é™…è¡Œçš„ä¸»é”®</p><p>ï¼ˆ2ï¼‰å†ä½¿ç”¨ä¸»é”®é€šè¿‡èšé›†ç´¢å¼•æŸ¥è¯¢ç›¸åº”çš„è¡Œ</p><p>ï¼ˆ3ï¼‰ä»¥æ­¤<strong>å¾ªç¯æŸ¥è¯¢æ‰€æœ‰çš„è¡Œ</strong><br>è‹¥ç›´æ¥å…¨é‡æœç´¢èšé›†ç´¢å¼•ï¼Œåˆ™ä¸éœ€è¦åœ¨æ™®é€šç´¢å¼•å’Œèšé›†ç´¢å¼•ä¸­æ¥å›åˆ‡æ¢ã€‚ç›¸æ¯”ä¸¤ç§æ“ä½œçš„æ€»å¼€é”€å¯èƒ½æ‰«æå…¨è¡¨æ•ˆç‡æ›´é«˜ã€‚</p><h4 id="9-MySQLè”åˆç´¢å¼•å¦‚ä½•ä½¿ç”¨ï¼Ÿä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ">9. <strong>MySQLè”åˆç´¢å¼•å¦‚ä½•ä½¿ç”¨</strong>ï¼Ÿ<strong>ä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™</strong>ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Abysscarry/article/details/80792876">https://blog.csdn.net/Abysscarry/article/details/80792876</a></p></blockquote><p>å¯¹å¤šä¸ªå­—æ®µåŒæ—¶å»ºç«‹çš„ç´¢å¼•(æœ‰é¡ºåºï¼ŒABCï¼ŒACBæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ç§è”åˆç´¢å¼•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `test` (</span><br><span class="line">  `id` int(4) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `a` varchar(10) NOT NULL,</span><br><span class="line">  `b` varchar(10) NOT NULL,</span><br><span class="line">  `c` varchar(10) NOT NULL,</span><br><span class="line">  `d` varchar(10) NOT NULL,</span><br><span class="line">  `e` varchar(10) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  # è”åˆç´¢å¼•(a,b,c)</span><br><span class="line">  UNIQUE KEY `idx_a_b_c` (`a`,`b`,`c`) USING BTREE </span><br><span class="line">) ENGINE=I</span><br></pre></td></tr></table></figure><p>ä»¥è”åˆç´¢å¼•(a,b,c)ä¸ºä¾‹ï¼š</p><ul><li><p><strong>å»ºç«‹è¿™æ ·çš„ç´¢å¼•ç›¸å½“äºå»ºç«‹äº†ç´¢å¼•aã€abã€abcä¸‰ä¸ªç´¢å¼•</strong>ã€‚ä¸€ä¸ªç´¢å¼•é¡¶ä¸‰ä¸ªç´¢å¼•å½“ç„¶æ˜¯å¥½äº‹ï¼Œæ¯•ç«Ÿæ¯å¤šä¸€ä¸ªç´¢å¼•ï¼Œéƒ½ä¼šå¢åŠ å†™æ“ä½œçš„å¼€é”€å’Œç£ç›˜ç©ºé—´çš„å¼€é”€ã€‚</p><blockquote><p><strong>a,c</strong>ç»„åˆä¹Ÿå¯ä»¥ä½†ä¸æ˜¯ä¸ºä»–å»ºç«‹äº†ç´¢å¼•ï¼Œä½†å®é™…ä¸Šåªç”¨åˆ°äº†açš„ç´¢å¼•ï¼Œcå¹¶æ²¡æœ‰ç”¨åˆ°ï¼</p></blockquote></li><li><p><strong>æœ€å·¦åŒ¹é…åŸåˆ™</strong></p><p>æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ï¼Œ<strong>å³æ˜¯whereæ¡ä»¶å¿…é¡»æœ‰è”åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µã€‚</strong></p><ul><li><p>ä¸åŒ…å«ç¬¬ä¸€ä¸ªå­—æ®µ</p><p>ä¸ä¼šèµ°ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select  * from test where  b = &#x27;333&#x27; and c = &#x27;333&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>whereå’Œç´¢å¼•é¡ºåºä¸ä¸€æ ·</p><p>ä¼šèµ°ç´¢å¼•ï¼Œ<u>å’Œé¡ºåºæ— å…³</u>ã€‚</p><blockquote><p>where åé¢åˆ—çš„é¡ºåºæ˜¯è¢«<strong>ä¼˜åŒ–å™¨</strong>ä¼˜åŒ–äº†çš„ï¼Œæ‰€ä»¥æ‰ä¼šè§‰å¾—æ— å½±å“ï¼Œä½ å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ä¼˜åŒ–å™¨ä¼˜åŒ–åçš„è¯­å¥ï¼Œä¼šå¸®ä½ è°ƒæ•´ä¸ºæ»¡è¶³æœ€å·¦å‰ç¼€çš„é¡ºåºã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select  * from test where c = &#x27;333&#x27; and b = &#x27;333&#x27; and a = &#x27;333&#x27;;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="9-1-è”åˆç´¢å¼•çš„å¥½å¤„ï¼Ÿ">9.1 è”åˆç´¢å¼•çš„å¥½å¤„ï¼Ÿ</h5><h4 id="10-ï¼ˆè¿˜è¦è¡¥å……ï¼‰ä»‹ç»ä¸€ä¸‹ç´¢å¼•å¤±æ•ˆçš„åŸå› ï¼Ÿ">10. ï¼ˆè¿˜è¦è¡¥å……ï¼‰ä»‹ç»ä¸€ä¸‹ç´¢å¼•å¤±æ•ˆçš„åŸå› ï¼Ÿ</h4><blockquote><p>å¾ˆä¸é”™çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://cloud.tencent.com/developer/article/1704743">ç´¢å¼•å¤±æ•ˆåŸç†ï¼Œç»ˆäºæœ‰äººè®²æ˜ç™½äº†</a></p><p>ç»“åˆè¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/6844904073955639304">https://juejin.cn/post/6844904073955639304</a></p></blockquote><p>å‡è®¾mysql å­˜åœ¨è”åˆç´¢å¼•ï¼ˆa,bï¼‰ï¼Œæ˜¾ç„¶ä¹Ÿæ˜¯ä¸€é¢—B+æ ‘:</p><p><img src="https://i.loli.net/2021/05/24/GlDckpZzWTnodIf.png" alt="image-20210524114029113"></p><ul><li><p><strong>ä¸ç¬¦åˆæœ€å·¦åŒ¹é…å¤±æ•ˆ</strong></p><ol><li><p>æƒ…å†µ1 ï¼š<code>select * from testTable where b=2</code></p><p>è”åˆç´¢å¼•æ˜¯é€šè¿‡ç¬¬ä¸€ä¸ªç´¢å¼•<code>a</code> æ¥æ„å»ºB+æ ‘ï¼Œè¿›è¡Œå®šä½äºŒåˆ†æŸ¥æ‰¾çš„ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡<code>b</code> æ¥è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚</p></li><li><p>æƒ…å†µ2ï¼š<code>like</code>æŸ¥è¯¢å¤±æ•ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">where name like &quot;a%&quot;  # ä¼šæœ‰æ•ˆï¼Œå› ä¸ºå¯ä»¥åŒ¹é…åˆ°é¦–å­—æ¯</span><br><span class="line"></span><br><span class="line">where name like &quot;%a%&quot; # é¦–å­—æ¯æ˜¯ä»»æ„åŒ¹é…çš„ï¼Œæ‰€ä»¥ç´¢å¼•ç”¨ä¸ä¸Š</span><br><span class="line"></span><br><span class="line">where name like &quot;%a&quot; # åŒä¸Šï¼Œä¸èƒ½æ ¹æ®å°¾å­—æ¯æ¥ç´¢å¼•</span><br></pre></td></tr></table></figure></li></ol></li><li><p><strong>èŒƒå›´æŸ¥è¯¢å¤±æ•ˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from testTable where a&gt;1 and b=2</span><br></pre></td></tr></table></figure><p>é¦–å…ˆ<strong>aå­—æ®µåœ¨B+æ ‘ä¸Šæ˜¯æœ‰åº</strong>çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•å®šä½åˆ°1ï¼Œç„¶åå°†æ‰€æœ‰å¤§äº1çš„æ•°æ®å–å‡ºæ¥ï¼Œaå¯ä»¥ç”¨åˆ°ç´¢å¼•ã€‚</p><p><strong>bæœ‰åºçš„å‰ææ˜¯aæ˜¯ç¡®å®šçš„å€¼</strong>ï¼Œé‚£ä¹ˆç°åœ¨açš„å€¼æ˜¯å–å¤§äº1çš„ï¼Œå¯èƒ½æœ‰10ä¸ªå¤§äº1çš„aï¼Œä¹Ÿå¯èƒ½æœ‰ä¸€ç™¾ä¸ªaã€‚</p><p>å¤§äº1çš„aé‚£éƒ¨åˆ†çš„B+æ ‘é‡Œï¼Œbå­—æ®µæ˜¯æ— åºçš„ï¼ˆå¼€å±€ä¸€å¼ å›¾ï¼‰ï¼Œæ‰€ä»¥bä¸èƒ½åœ¨æ— åºçš„B+æ ‘é‡Œç”¨äºŒåˆ†æŸ¥æ‰¾æ¥æŸ¥è¯¢ï¼Œbç”¨ä¸åˆ°ç´¢å¼•ã€‚</p></li><li><p><strong>å¤šä¸ªå•åˆ—ç´¢å¼•</strong></p><p>æˆ‘ä»¬é¦–å…ˆå»ºç«‹äº†ä¸‰ä¸ªå•åˆ—ç´¢å¼•ï¼šuseridï¼Œmobileï¼ŒbillMonthã€‚ç„¶åä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM `t_mobilesms_11` WHERE  userid=&#x27;2222&#x27; AND mobile=&#x27;13281899972&#x27; AND billMonth=&#x27;2018-04&#x27;</span><br></pre></td></tr></table></figure><ul><li><p><code>explain</code> ç»“æœåˆ†æï¼Œæœ€ç»ˆåªæœ‰<code>userid</code> è¿™<strong>ä¸€ä¸ªç´¢å¼•æœ‰æ•ˆ</strong>ã€‚</p><blockquote><p>æ­¤å¤„<code>userid ã€mobile ã€billMonth</code>è¿™ä¸‰ä¸ªç´¢å¼•åˆ—éƒ½èƒ½ç”¨ï¼Œåªä¸è¿‡<strong>ä¼˜åŒ–å™¨åˆ¤æ–­ä½¿ç”¨<code>userid</code>è¿™ä¸€ä¸ªç´¢å¼•èƒ½æœ€é«˜æ•ˆå®Œæˆæœ¬æ¬¡æŸ¥è¯¢</strong>ï¼Œæ•…æœ€ç»ˆexplainå±•ç¤ºçš„keyä¸ºuseridã€‚</p></blockquote></li></ul><p>ç‰¹åˆ«çš„ï¼Œå¦‚æœæ”¹ä¸º <code>or</code> è¿›è¡Œåˆ¤æ–­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM `t_mobilesms_11` WHERE  userid=&#x27;2222&#x27; OR mobile=&#x27;13281899972&#x27; </span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/24/UDQxsm7YIrglvu8.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><ul><li><p><strong>æ­¤æ—¶ä¸¤ä¸ªç´¢å¼• userid &amp; mobileéƒ½ç”¨ä¸Šäº†</strong>ã€‚</p><blockquote><p>mysql <u>5.0 ç‰ˆæœ¬ä¹‹å‰</u> ä½¿ç”¨or<strong>åªä¼šç”¨åˆ°ä¸€ä¸ªç´¢å¼•</strong>, è‡ªä»<u>5.0ç‰ˆæœ¬å¼€å§‹</u> ï¼Œå¼•å…¥äº†index_mergeç´¢å¼•åˆå¹¶ä¼˜åŒ–ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ©ç”¨ä¸Šå¤šä¸ªç´¢å¼•å»ä¼˜åŒ–oræŸ¥è¯¢äº†ã€‚</p></blockquote></li></ul></li><li><p><strong>æˆ–è€…ç´¢å¼•åŠ ä¸Šäº†è¿ç®—</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t where c - 1 = 1000;</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸ä¼šæœ‰æ•ˆï¼Œåº”è¯¥æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t where c = 1000 + 1;</span><br></pre></td></tr></table></figure><p>åˆæ¯”å¦‚ç”¨äº†å‡½æ•°æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t where pow(c,2) = 1000;</span><br></pre></td></tr></table></figure></li></ul><h4 id="11-ã€âš ï¸-æ–°å¢ã€‘ç´¢å¼•å®æˆ˜ç¯‡">11. ã€âš ï¸ æ–°å¢ã€‘ç´¢å¼•å®æˆ˜ç¯‡</h4><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/115778804">https://zhuanlan.zhihu.com/p/115778804</a></p></blockquote><ol><li><p><code>where a=xxx and b=xxx order by c</code>  ï¼Œå¦‚ä½•å»ºç«‹ç´¢å¼•ï¼Ÿ</p><p>å»ºç«‹è”åˆç´¢å¼•<code>ï¼ˆa,b,cï¼‰</code> ï¼Œå› ä¸ºè¿™æ ·çš„è¯<strong>æ— éœ€åšä¸€æ¬¡é¢å¤–çš„æ’åºæ“ä½œ</strong>ã€‚</p><p>å› ä¸ºå»ºç«‹è”åˆç´¢å¼•æ—¶ï¼Œæ ¹æ®æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œå…ˆæŒ‰<code>a</code>æ’åºï¼Œå†æŒ‰<code>b</code>æ’åºï¼Œæœ€åæŒ‰<code>c</code> æ’åºã€‚æ ¹æ®è”åˆç´¢å¼•æ£€ç´¢åˆ°ï¼Œ<code>a=xxx and b=xxx</code>æ¡ä»¶æ—¶ï¼Œå†å»æ£€ç´¢<code>c</code>æœ¬èº«å·²æ’åºçš„ã€‚é‚£ä¹ˆä¸ç”¨ <code>order by c</code> ï¼Œä¸ç”¨è¿›è¡Œæ–‡ä»¶æ’åºã€‚</p><ul><li>æ³¨æ„ï¼Œå»ºç«‹è”åˆç´¢å¼• <code>ï¼ˆa,bï¼‰</code> , åˆ™æ˜¯èµ°ä¸åˆ° sortçš„ï¼</li></ul></li><li><p><code>where a=xxx  order by b,c</code>  ï¼Œå¦‚ä½•å»ºç«‹ç´¢å¼•ï¼Ÿ</p><p>é“ç†åŒä¸Šï¼Œå»ºç«‹<code>ï¼ˆa,b,cï¼‰</code> ã€‚</p></li><li><p><code>where a &gt; 1 ORDER BY b</code>ï¼Œæ€ä¹ˆå»ºç«‹ç´¢å¼•ï¼Ÿ</p><p>å»ºç«‹ç´¢å¼•ï¼ˆaï¼‰å³å¯ï¼Œå› ä¸ºaæ˜¯èŒƒå›´æŸ¥è¯¢ï¼š</p><ul><li>å»ºç«‹ï¼ˆa,bï¼‰çš„ è¯bä¹Ÿç”¨ä¸ä¸Šï¼Œå› ä¸ºæ˜¯aæ˜¯èŒƒå›´æŸ¥è¯¢ï¼›</li><li>å»ºç«‹ï¼ˆb,aï¼‰, <strong>bæŒ‰ç´¢å¼•æ’å¥½åºï¼Œa&gt;1å¯ä»¥ç”¨ä¸Šï¼Ÿé”™è¯¯ï¼Œå› ä¸ºå…ˆwhereç­›é€‰æ‰ä¼šorder byï¼</strong></li></ul></li><li><p><code>where a=1 and b=2 and c&gt;3 and d=4</code> ï¼Œå¦‚ä½•å»ºç«‹ç´¢å¼•ï¼Ÿ</p><p>å»ºç«‹è”åˆç´¢å¼•ï¼Œ<code>(a,b,d,c)</code>  å³å¯ã€‚</p><ul><li>ä½†æ˜¯å¯¹äºå»ºç«‹<code>(a,b,c,d)</code> ï¼Œ<strong>a,b,cä¸‰ä¸ªå­—æ®µèƒ½ç”¨åˆ°ç´¢å¼•ï¼Œè€Œdå°±åŒ¹é…ä¸åˆ°</strong>ï¼Œå› ä¸ºé‡åˆ°äº†<strong>èŒƒå›´æŸ¥è¯¢ï¼Œåœ¨c&gt;3è¿™ä¸ªèŒƒå›´å†…ï¼Œdä¸æ˜¯æœ‰åºçš„ï¼›ä½†æ˜¯c=3ï¼Œè¿™ä¸ªèŒƒå›´å†…ï¼Œdæ˜¯æœ‰åºçš„</strong>ï¼</li></ul></li><li><p><code>where a &gt; 1 and b = 2 and c &gt; 3</code>ï¼Œå¦‚ä½•å»ºç«‹ç´¢å¼•ï¼Ÿ</p><p>å»ºç«‹ï¼ˆb,cï¼‰æˆ–è€…ï¼ˆb,aï¼‰å³å¯ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªç´¢å¼•è¦å¤±æ•ˆï¼ˆé‡ä¸ŠèŒƒå›´æŸ¥è¯¢ï¼‰ã€‚</p></li><li><p><code>WHERE a IN (1,2,3) and b &gt; 1</code>ï¼Œæ€ä¹ˆå»ºç«‹ç´¢å¼•ï¼Ÿ</p><p>è¿˜æ˜¯å¯¹(aï¼Œb)å»ºç«‹ç´¢å¼•ï¼Œå› ä¸ºINåœ¨è¿™é‡Œå¯ä»¥è§†ä¸ºç­‰å€¼å¼•ç”¨ï¼Œä¸ä¼šä¸­æ­¢ç´¢å¼•åŒ¹é…ï¼Œæ‰€ä»¥è¿˜æ˜¯(a,b)ï¼</p></li></ol><h5 id="11-1-æœ‰ä¸ªå­—æ®µå€¼å¯èƒ½æ­£ï¼Œå¯èƒ½è´Ÿï¼ŒæŸ¥è¯¢è¯¥å­—æ®µè¦ç»å¯¹å€¼ï¼Œä½†è®¡ç®—ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæ€ä¹ˆä¼˜åŒ–ï¼Ÿ">11.1 <strong>æœ‰ä¸ªå­—æ®µå€¼å¯èƒ½æ­£ï¼Œå¯èƒ½è´Ÿï¼ŒæŸ¥è¯¢è¯¥å­—æ®µè¦ç»å¯¹å€¼ï¼Œä½†è®¡ç®—ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæ€ä¹ˆä¼˜åŒ–</strong>ï¼Ÿ</h5><ol><li>æ‹†æˆä¸¤åˆ—1åˆ—åªå­˜ç»å¯¹å€¼ï¼Œå¦èµ·ä¸€åˆ—tinyintæ¥è¡¨ç¤ºæ­£è´Ÿæˆ–è€…æ–¹å‘ï¼›</li><li>å…ˆæŸ¥è¯¢åˆ°ç»“æœï¼Œç„¶åå†æŸ¥è¯¢çš„ç»“æœä¸Šè¿›è¡Œæ“ä½œï¼ˆå–ç»å¯¹å€¼ï¼‰ï¼Ÿ</li></ol><h4 id="12-order-by-æ€ä¹ˆè¿›è¡Œæ’åºçš„ï¼Ÿæ€ä¹ˆä¼˜åŒ–ï¼Ÿ">12. order by æ€ä¹ˆè¿›è¡Œæ’åºçš„ï¼Ÿæ€ä¹ˆä¼˜åŒ–ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000040357292">https://segmentfault.com/a/1190000040357292</a></p></blockquote><p>å‡è®¾å­˜åœ¨ä»¥ä¸‹æ•°æ®ï¼š</p><p><img src="https://i.loli.net/2021/09/04/cudfwqEHGmn3Ppt.png" alt="image-20210904013336980"></p><p>æ­¤æ—¶è¿›è¡Œå¦‚ä¸‹æŸ¥è¯¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select city, order_num, user_code from `order` where city=&#x27;å¹¿å·&#x27; order by order_num limit 1000;</span><br></pre></td></tr></table></figure><ol><li><p><strong>å»ºç«‹ç´¢å¼•(city)ï¼šorder byè¿‡ç¨‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `order` ADD INDEX city_index ( `city` );</span><br></pre></td></tr></table></figure><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210904013506155.png" alt="image-20210904013506155" style="zoom:80%;" /><ul><li><p><strong>ç”¨ explain çœ‹çœ‹æ‰§è¡Œæƒ…å†µ</strong></p><p><img src="https://i.loli.net/2021/09/04/lv3uyaxWkKPtqjd.png" alt="img"></p><p>æ³¨æ„åˆ°æœ€åä¸€ä¸ª extra å­—æ®µçš„ç»“æœæ˜¯ï¼š<strong>Using filesort</strong>ï¼Œè¡¨ç¤ºéœ€è¦æ’åºã€‚<strong>å…¶å® MySQL ä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºæ’åºï¼Œç§°ä¸º sort_buffer</strong>ã€‚</p></li><li><p><strong>å®Œæ•´æ‰§è¡Œè¿‡ç¨‹</strong></p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/Pm7eJ1vQFg8l2xA.png" alt="image-20210904013732363" style="zoom:80%;" /><ol><li><p>åˆå§‹åŒ– <strong>sort_buffer</strong>ï¼Œæ”¾å…¥ <code>cityã€order_numã€user_code</code> è¿™ä¸‰ä¸ªå­—æ®µï¼›</p></li><li><p>ä»ç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=â€™ å¹¿å·â€™æ¡ä»¶çš„ä¸»é”® idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_3ï¼›</p></li><li><p><strong>åˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œ</strong>ï¼Œå– cityã€order_numã€user_code ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå­˜å…¥ sort_buffer ä¸­ï¼›</p></li><li><p>ä»ç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® idï¼›</p></li><li><p>é‡å¤æ­¥éª¤ 3ã€4 ç›´åˆ° city çš„å€¼ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ä¸ºæ­¢ï¼Œå¯¹åº”çš„ä¸»é”® id ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Xï¼›</p></li><li><p>å¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ <strong>order_num åšå¿«é€Ÿæ’åº</strong>ï¼›</p><blockquote><p>å…¶ä¸­ï¼Œ<strong>æŒ‰ order_num æ’åº</strong>è¿™ä¸ªæ­¥éª¤ï¼Œå¯èƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œè¿™å–å†³äºæ’åºæ‰€éœ€çš„å†…å­˜å’Œå‚æ•° <strong>sort_buffer_size</strong>ã€‚</p></blockquote></li><li><p>æŒ‰ç…§æ’åºç»“æœå–å‰ 1000 è¡Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></li></ol></li></ul></li><li><p><strong>ä¼˜åŒ–1ï¼šä½¿ç”¨rowid</strong></p><p>ä¸Šé¢çš„å…¨å­—æ®µæ’åºå…¶å®ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œä½ å¯èƒ½å‘ç°äº†ã€‚<strong>æˆ‘ä»¬éœ€è¦æŸ¥è¯¢çš„å­—æ®µéƒ½è¦æ”¾åˆ° sort_buffer ä¸­ï¼Œå¦‚æœæŸ¥è¯¢çš„å­—æ®µå¤šäº†èµ·æ¥ï¼Œå†…å­˜å ç”¨å‡é«˜ï¼Œå°±ä¼šå¾ˆå®¹æ˜“æ‰“æ»¡ sort_buffer</strong> ã€‚</p><ul><li><p><strong>sort_buffer åªå­˜ order_num å’Œ id å­—æ®µ</strong>ã€‚</p><img src="https://i.loli.net/2021/09/04/PRwrO4ae3BJLciH.png" alt="img" style="zoom:80%;" /><ol><li>åˆå§‹åŒ– sort_bufferï¼Œç¡®å®šæ”¾å…¥ä¸¤ä¸ªå­—æ®µï¼Œå³ order_num å’Œ idï¼›</li><li>ä»ç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=â€™ å¹¿å·â€™æ¡ä»¶çš„ä¸»é”® idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_3ï¼›</li><li><strong>å›è¡¨</strong>ï¼Œå– order_numã€id è¿™ä¸¤ä¸ªå­—æ®µï¼Œå­˜å…¥ sort_buffer ä¸­ï¼›</li><li>ä»ç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® idï¼›</li><li>é‡å¤æ­¥éª¤ 3ã€4 ç›´åˆ°ä¸æ»¡è¶³ city=â€™ å¹¿å·â€™æ¡ä»¶ä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ ID_Xï¼›</li><li>å¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ order_num è¿›è¡Œæ’åºï¼›</li><li>éå†æ’åºç»“æœï¼Œå–å‰ 1000 è¡Œï¼Œå†æ¬¡å›è¡¨å–å‡º cityã€order_num å’Œ user_code ä¸‰ä¸ªå­—æ®µè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol></li></ul></li><li><p><strong>ä¼˜åŒ–2ï¼šå»ºç«‹è”åˆç´¢å¼•</strong></p><p>å‚è§ç´¢å¼•éƒ¨åˆ†è§£é‡Šï¼Œä¸å†èµ˜è¿°ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1460000040357304" alt="img" style="zoom:80%;" /><ol><li><p>ä»ç´¢å¼• (city,order_num) æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=â€™ å¹¿å·â€™æ¡ä»¶çš„ä¸»é”® idï¼›</p></li><li><p>å›è¡¨ï¼Œå– cityã€order_numã€user_code ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</p></li><li><p>ä»ç´¢å¼• (city,order_num) å–ä¸‹ä¸€ä¸ªè®°å½•ä¸»é”® idï¼›</p></li><li><p>é‡å¤æ­¥éª¤ 2ã€3ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬ 1000 æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯ä¸æ»¡è¶³ city=â€™ å¹¿å·â€™æ¡ä»¶æ—¶å¾ªç¯ç»“æŸã€‚</p></li></ol></li></ol><h2 id="5-3-äº‹åŠ¡ç›¸å…³">5.3 äº‹åŠ¡ç›¸å…³</h2><h4 id="1-è¯·ä»‹ç»ä¸€ä¸‹æ•°æ®åº“äº‹åŠ¡ï¼Ÿå’Œ-u-äº‹åŠ¡ç‰¹æ€§-u-ï¼ˆACIDï¼‰ï¼Ÿ">1.<strong>è¯·ä»‹ç»ä¸€ä¸‹æ•°æ®åº“äº‹åŠ¡ï¼Ÿå’Œ<u>äº‹åŠ¡ç‰¹æ€§</u>ï¼ˆACIDï¼‰</strong>ï¼Ÿ</h4><ul><li><p><strong>æ•°æ®åº“äº‹åŠ¡</strong>ï¼š æ•°æ®åº“äº‹åŠ¡æŒ‡çš„æ˜¯ä¸€ç»„æ•°æ®æ“ä½œï¼Œäº‹åŠ¡å†…çš„æ“ä½œè¦ä¹ˆå°±æ˜¯å…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå°±æ˜¯å…¨éƒ¨å¤±è´¥ã€‚</p><blockquote><p><em>e.g.</em>  å‡è®¾ä¸€ä¸ªç½‘è´­ä»˜æ¬¾çš„æ“ä½œï¼Œç”¨æˆ·ä»˜æ¬¾åè¦æ¶‰åŠåˆ°è®¢å•çŠ¶æ€æ›´æ–°ã€æ‰£åº“å­˜ä»¥åŠå…¶ä»–ä¸€ç³»åˆ—åŠ¨ä½œï¼Œè¿™å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸é‚£å°±ç›¸å®‰æ— äº‹ï¼Œä¸€æ—¦ä¸­é—´æœ‰æŸä¸ªç¯èŠ‚å¼‚å¸¸ï¼Œé‚£æ•´ä¸ªäº‹åŠ¡å°±è¦å›æ»šï¼Œæ€»ä¸èƒ½æ›´æ–°äº†è®¢å•çŠ¶æ€ä½†æ˜¯ä¸æ‰£åº“å­˜å§ã€‚</p></blockquote></li><li><p><strong>äº‹åŠ¡ç‰¹æ€§</strong>ï¼šï¼ˆ1ï¼‰ åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡å¿…é¡»è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æœ€å°å·¥ä½œå•å…ƒï¼Œè¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥ï¼ˆ2ï¼‰ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šæ•°æ®åº“æ€»èƒ½ä»ä¸€ä¸ª<strong>ä¸€è‡´æ€§çš„çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€</strong>ï¼ˆ3ï¼‰éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰ï¼Œå¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ï¼ˆ4ï¼‰æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œåˆ™å…¶æ‰€åšçš„ä¿®æ”¹å°±ä¼šæ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­</p></li></ul><h5 id="1-1-å››å¤§ç‰¹æ€§å¾—ä¸åˆ°ä¿éšœä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ">1.1 å››å¤§ç‰¹æ€§å¾—ä¸åˆ°ä¿éšœä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ</h5><blockquote><p>ä»¬ä»¥ä»Aè´¦æˆ·è½¬è´¦50å…ƒåˆ°Bè´¦æˆ·ä¸ºä¾‹è¿›è¡Œè¯´æ˜ä¸€ä¸‹ACIDè¿™å››å¤§ç‰¹æ€§ã€‚</p></blockquote><ul><li><p><strong>åŸå­æ€§</strong> : åŸå­æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œ<strong>å…¶ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åš</strong>ã€‚å³è¦ä¹ˆè½¬è´¦æˆåŠŸï¼Œè¦ä¹ˆè½¬è´¦å¤±è´¥ï¼Œæ˜¯ä¸å­˜åœ¨ä¸­é—´çš„çŠ¶æ€ã€‚</p><blockquote><p><strong>å¦‚æœæ— æ³•ä¿è¯åŸå­æ€§ä¼šæ€ä¹ˆæ ·</strong>ï¼Ÿ</p></blockquote><p>ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å½¢ï¼ŒAè´¦æˆ·å‡å»50å…ƒï¼Œè€ŒBè´¦æˆ·å¢åŠ 50å…ƒæ“ä½œå¤±è´¥ã€‚ç³»ç»Ÿå°†æ— æ•…ä¸¢å¤±50å…ƒ~</p></li><li><p><strong>ä¸€è‡´æ€§</strong> ï¼šä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®å¤„äºä¸€ç§åˆæ³•çš„çŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€æ˜¯è¯­ä¹‰ä¸Šçš„è€Œä¸æ˜¯è¯­æ³•ä¸Šçš„ã€‚ é‚£ä»€ä¹ˆæ˜¯åˆæ³•çš„æ•°æ®çŠ¶æ€å‘¢ï¼Ÿè¿™ä¸ªçŠ¶æ€æ˜¯æ»¡è¶³é¢„å®šçš„çº¦æŸå°±å«åšåˆæ³•çš„çŠ¶æ€ï¼Œå†é€šä¿—ä¸€ç‚¹ï¼Œè¿™çŠ¶æ€æ˜¯ç”±ä½ è‡ªå·±æ¥å®šä¹‰çš„ã€‚<strong>æ»¡è¶³è¿™ä¸ªçŠ¶æ€ï¼Œæ•°æ®å°±æ˜¯ä¸€è‡´çš„ï¼Œä¸æ»¡è¶³è¿™ä¸ªçŠ¶æ€ï¼Œæ•°æ®å°±æ˜¯ä¸ä¸€è‡´çš„ã€‚</strong></p><blockquote><p><strong>å¦‚æœæ— æ³•ä¿è¯ä¸€è‡´æ€§ä¼šæ€ä¹ˆæ ·</strong>ï¼Ÿ</p></blockquote><ul><li><p>ä¾‹ä¸€: Aè´¦æˆ·æœ‰200å…ƒï¼Œè½¬è´¦300å…ƒå‡ºå»ï¼Œæ­¤æ—¶Aè´¦æˆ·ä½™é¢ä¸º-100å…ƒã€‚</p><p>ä½ è‡ªç„¶å°±å‘ç°äº†æ­¤æ—¶æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä½ å®šä¹‰äº†ä¸€ä¸ªçŠ¶æ€ï¼Œ<strong>ä½™é¢è¿™åˆ—å¿…é¡»å¤§äº0</strong>ã€‚</p></li><li><p>ä¾‹äºŒï¼šAè´¦æˆ·200å…ƒï¼Œè½¬è´¦50å…ƒç»™Bè´¦æˆ·ï¼ŒAè´¦æˆ·çš„é’±æ‰£äº†ï¼Œä½†æ˜¯Bè´¦æˆ·å› ä¸ºå„ç§æ„å¤–ï¼Œä½™é¢å¹¶æ²¡æœ‰å¢åŠ ã€‚</p><p>ä½ ä¹ŸçŸ¥é“æ­¤æ—¶æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä½ å®šä¹‰äº†ä¸€ä¸ªçŠ¶æ€ï¼Œ<strong>è¦æ±‚A+Bçš„ä½™é¢å¿…é¡»ä¸å˜</strong>ã€‚</p></li></ul></li><li><p><strong>éš”ç¦»æ€§</strong> ï¼šéš”ç¦»æ€§æ˜¯æŒ‡<strong>å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œäº‹åŠ¡å†…éƒ¨çš„æ“ä½œä¸å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„</strong>ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸å¹²æ‰°ã€‚</p><blockquote><p><strong>å¦‚æœæ— æ³•ä¿è¯éš”ç¦»æ€§ä¼šæ€ä¹ˆæ ·</strong>ï¼Ÿ</p></blockquote><p>å‡è®¾Aè´¦æˆ·æœ‰200å…ƒï¼ŒBè´¦æˆ·0å…ƒã€‚Aè´¦æˆ·å¾€Bè´¦æˆ·è½¬è´¦ä¸¤æ¬¡ï¼Œé‡‘é¢ä¸º50å…ƒï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œã€‚</p><p>å¦‚æœæ— æ³•ä¿è¯éš”ç¦»æ€§ï¼ŒAå¯èƒ½å°±ä¼šå‡ºç°æ‰£æ¬¾ä¸¤æ¬¡çš„æƒ…å½¢ï¼Œè€ŒBåªåŠ æ¬¾ä¸€æ¬¡ï¼Œå‡­ç©ºæ¶ˆå¤±äº†50å…ƒï¼Œä¾ç„¶å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„æƒ…å½¢ï¼</p></li><li><p><strong>æŒä¹…æ€§</strong> : æ ¹æ®å®šä¹‰ï¼Œ<strong>æŒä¹…æ€§æ˜¯æŒ‡äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„</strong>ã€‚æ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p><blockquote><p><strong>å¦‚æœæ— æ³•ä¿è¯æŒä¹…æ€§ä¼šæ€ä¹ˆæ ·</strong>ï¼Ÿ</p></blockquote><p>åœ¨MySQLä¸­ï¼Œä¸ºäº†è§£å†³CPUå’Œç£ç›˜é€Ÿåº¦ä¸ä¸€è‡´é—®é¢˜ï¼ŒMySQLæ˜¯å°†ç£ç›˜ä¸Šçš„æ•°æ®åŠ è½½åˆ°å†…å­˜ï¼Œå¯¹å†…å­˜è¿›è¡Œæ“ä½œï¼Œç„¶åå†å›å†™ç£ç›˜ã€‚å¥½ï¼Œå‡è®¾æ­¤æ—¶å®•æœºäº†ï¼Œåœ¨å†…å­˜ä¸­ä¿®æ”¹çš„æ•°æ®å…¨éƒ¨ä¸¢å¤±äº†ï¼ŒæŒä¹…æ€§å°±æ— æ³•ä¿è¯ã€‚</p><p>è®¾æƒ³ä¸€ä¸‹ï¼Œç³»ç»Ÿæç¤ºä½ è½¬è´¦æˆåŠŸã€‚ä½†æ˜¯ä½ å‘ç°é‡‘é¢æ²¡æœ‰å‘ç”Ÿä»»ä½•æ”¹å˜ï¼Œæ­¤æ—¶æ•°æ®å‡ºç°äº†ä¸åˆæ³•çš„æ•°æ®çŠ¶æ€ï¼Œæˆ‘ä»¬å°†è¿™ç§çŠ¶æ€è®¤ä¸ºæ˜¯<strong>æ•°æ®ä¸ä¸€è‡´</strong>çš„æƒ…å½¢ã€‚</p></li></ul><h5 id="1-2-æ•°æ®åº“å¦‚ä½•ä¿è¯å››å¤§ç‰¹æ€§ï¼ˆå¦‚ä½•å®ç°äº‹åŠ¡ï¼‰ï¼Ÿ">1.2 æ•°æ®åº“å¦‚ä½•ä¿è¯å››å¤§ç‰¹æ€§ï¼ˆå¦‚ä½•å®ç°äº‹åŠ¡ï¼‰ï¼Ÿ</h5><p>æ•°æ®åº“äº‹åŠ¡çš„ ACID å››å¤§ç‰¹æ€§æ˜¯äº‹åŠ¡çš„åŸºç¡€ï¼Œäº†è§£äº† ACID æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæˆ‘ä»¬ä¹Ÿå°±æ¸…æ¥šäº†äº‹åŠ¡çš„å®ç°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¾æ¬¡ä»‹ç»æ•°æ®åº“æ˜¯å¦‚ä½•å®ç°è¿™å››ä¸ªç‰¹æ€§çš„ã€‚</p><ul><li><p><strong>ä¿è¯åŸå­æ€§</strong></p><p>ä¸»è¦æ˜¯åˆ©ç”¨Innodbçš„<strong>undo log</strong>ã€‚</p><p>undo logåä¸ºå›æ»šæ—¥å¿—ï¼Œæ˜¯å®ç°åŸå­æ€§çš„å…³é”®ï¼Œå½“<strong>äº‹åŠ¡å›æ»šæ—¶èƒ½å¤Ÿæ’¤é”€æ‰€æœ‰å·²ç»æˆåŠŸæ‰§è¡Œçš„sqlè¯­å¥</strong>ï¼Œä»–éœ€è¦è®°å½•ä½ è¦å›æ»šçš„ç›¸åº”æ—¥å¿—ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚</p><ul><li>(1)å½“ä½ deleteä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦è®°å½•è¿™æ¡æ•°æ®çš„ä¿¡æ¯ï¼Œå›æ»šçš„æ—¶å€™ï¼Œinsertè¿™æ¡æ—§æ•°æ®</li><li>(2)å½“ä½ updateä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦è®°å½•ä¹‹å‰çš„æ—§å€¼ï¼Œå›æ»šçš„æ—¶å€™ï¼Œæ ¹æ®æ—§å€¼æ‰§è¡Œupdateæ“ä½œ</li><li>(3)å½“å¹´insertä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦è¿™æ¡è®°å½•çš„ä¸»é”®ï¼Œå›æ»šçš„æ—¶å€™ï¼Œæ ¹æ®ä¸»é”®æ‰§è¡Œdeleteæ“</li></ul><p>undo logè®°å½•äº†è¿™äº›å›æ»šéœ€è¦çš„ä¿¡æ¯ï¼Œå½“äº‹åŠ¡æ‰§è¡Œå¤±è´¥æˆ–è°ƒç”¨äº†rollbackï¼Œå¯¼è‡´äº‹åŠ¡éœ€è¦å›æ»šï¼Œä¾¿å¯ä»¥åˆ©ç”¨undo logä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­ã€‚</p></li><li><p><strong>ä¿è¯ä¸€è‡´æ€§</strong></p><p>æ•°æ®åº“å¯¹äº ACID ä¸­çš„ä¸€è‡´æ€§çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š<strong>å¦‚æœä¸€ä¸ªäº‹åŠ¡åŸå­åœ°åœ¨ä¸€ä¸ªä¸€è‡´åœ°æ•°æ®åº“ä¸­ç‹¬ç«‹è¿è¡Œï¼Œé‚£ä¹ˆåœ¨å®ƒæ‰§è¡Œä¹‹åï¼Œæ•°æ®åº“çš„çŠ¶æ€ä¸€å®šæ˜¯ä¸€è‡´çš„</strong>ã€‚</p><ul><li>å®ƒçš„ç¬¬ä¸€å±‚æ„æ€å°±æ˜¯å¯¹<strong>äºæ•°æ®å®Œæ•´æ€§çš„çº¦æŸ</strong>ï¼ŒåŒ…æ‹¬ä¸»é”®çº¦æŸã€å¼•ç”¨çº¦æŸä»¥åŠä¸€äº›çº¦æŸæ£€æŸ¥ç­‰ç­‰ï¼Œåœ¨äº‹åŠ¡çš„æ‰§è¡Œçš„å‰åä»¥åŠè¿‡ç¨‹ä¸­ä¸ä¼šè¿èƒŒå¯¹æ•°æ®å®Œæ•´æ€§çš„çº¦æŸï¼Œæ‰€æœ‰å¯¹æ•°æ®åº“å†™å…¥çš„æ“ä½œéƒ½åº”è¯¥æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸èƒ½äº§ç”Ÿä¸åˆæ³•çš„æ•°æ®çŠ¶æ€ã€‚</li><li>ç¬¬äºŒå±‚æ„æ€å…¶å®æ˜¯æŒ‡é€»è¾‘ä¸Šçš„å¯¹<strong>äºå¼€å‘è€…çš„è¦æ±‚</strong>ï¼Œæˆ‘ä»¬è¦åœ¨ä»£ç ä¸­å†™å‡ºæ­£ç¡®çš„äº‹åŠ¡é€»è¾‘ï¼Œæ¯”å¦‚é“¶è¡Œè½¬è´¦ï¼Œäº‹åŠ¡ä¸­çš„é€»è¾‘ä¸å¯èƒ½åªæ‰£é’±æˆ–è€…åªåŠ é’±ï¼Œè¿™æ˜¯åº”ç”¨å±‚é¢ä¸Šå¯¹äºæ•°æ®åº“ä¸€è‡´æ€§çš„è¦æ±‚ã€‚</li></ul></li><li><p><strong>ä¿è¯éš”ç¦»æ€§</strong></p><p>åœ¨ SQL æ ‡å‡†ä¸­å®šä¹‰äº†å››ç§æ•°æ®åº“çš„äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼š<code>READ UNCOMMITED</code>ã€<code>READ COMMITED</code>ã€<code>REPEATABLE READ</code> å’Œ <code>SERIALIZABLE</code>ï¼›</p><p>æ•°æ®åº“å¯¹äºéš”ç¦»çº§åˆ«çš„å®ç°å°±æ˜¯ä½¿ç”¨<strong>å¹¶å‘æ§åˆ¶æœºåˆ¶</strong>å¯¹åœ¨åŒä¸€æ—¶é—´æ‰§è¡Œçš„äº‹åŠ¡è¿›è¡Œæ§åˆ¶ï¼š</p><ol><li><p><strong>é”</strong>ï¼š MySQL å’Œå¸¸è§æ•°æ®åº“ä¸­çš„é”éƒ½åˆ†ä¸ºä¸¤ç§ï¼Œå…±äº«é”ï¼ˆSharedï¼‰å’Œäº’æ–¥é”ï¼ˆExclusiveï¼‰ï¼Œå‰è€…ä¹Ÿå«è¯»é”ï¼Œåè€…å«å†™é”ã€‚</p></li><li><p><strong>mvccå®ç°</strong>ï¼šå®ç°RCå’ŒRRã€‚</p></li></ol></li><li><p><strong>ä¿è¯æŒä¹…æ€§</strong></p><p>åˆ©ç”¨Innodbçš„<strong>redo log</strong>ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨redo logï¼Œè¯·çœ‹ä¸‹é¢ï¼š</p><ul><li>æ­£å¦‚ä¹‹å‰è¯´çš„ï¼ŒMysqlæ˜¯æŠŠç£ç›˜ä¸Šçš„æ•°æ®<strong>å…ˆåŠ è½½åˆ°å†…å­˜</strong>ä¸­ï¼Œåœ¨å†…å­˜ä¸­å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå†åˆ·å›ç£ç›˜ä¸Šã€‚<strong>å¦‚æœæ­¤æ—¶çªç„¶å®•æœºï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ï¼›</strong></li><li><strong>å¦‚æœäº‹åŠ¡æäº¤å‰ç›´æ¥æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œåªä¿®æ”¹ä¸€ä¸ªé¡µé¢é‡Œçš„ä¸€ä¸ªå­—èŠ‚ï¼Œå°±è¦å°†æ•´ä¸ªé¡µé¢åˆ·å…¥ç£ç›˜ï¼Œå¤ªæµªè´¹èµ„æºäº†</strong>ã€‚</li></ul><p><strong>redo logè§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>å½“åšæ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œ<strong>ä¸ä»…åœ¨å†…å­˜ä¸­æ“ä½œï¼Œè¿˜ä¼šåœ¨redo logä¸­è®°å½•è¿™æ¬¡æ“ä½œ</strong>ï¼›</li><li>å½“äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œ<strong>ä¼šå°†redo logæ—¥å¿—è¿›è¡Œåˆ·ç›˜</strong>(redo logä¸€éƒ¨åˆ†åœ¨å†…å­˜ä¸­ï¼Œä¸€éƒ¨åˆ†åœ¨ç£ç›˜ä¸Š)ï¼›</li><li><strong>å½“æ•°æ®åº“å®•æœºé‡å¯</strong>çš„æ—¶å€™ï¼Œä¼šå°†redo logä¸­çš„å†…å®¹æ¢å¤åˆ°æ•°æ®åº“ä¸­ï¼Œ<strong>å†æ ¹æ®undo logå’Œbinlogå†…å®¹å†³å®šå›æ»šæ•°æ®</strong>è¿˜æ˜¯æäº¤æ•°æ®ã€‚</li></ul></li></ul><h5 id="1-3-binlogæ—¥å¿—æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ">1.3 binlogæ—¥å¿—æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/kevingrace/p/5907254.html">https://www.cnblogs.com/kevingrace/p/5907254.html</a></p></blockquote><p>MySQLçš„äºŒè¿›åˆ¶æ—¥å¿—binlogå¯ä»¥è¯´æ˜¯MySQLæœ€é‡è¦çš„æ—¥å¿—ï¼Œ<strong>å®ƒè®°å½•äº†æ‰€æœ‰çš„DDLå’ŒDMLè¯­å¥ï¼ˆé™¤äº†æ•°æ®æŸ¥è¯¢è¯­å¥selectï¼‰</strong>ï¼Œä»¥äº‹ä»¶å½¢å¼è®°å½•ï¼Œè¿˜åŒ…å«è¯­å¥æ‰€æ‰§è¡Œçš„æ¶ˆè€—çš„æ—¶é—´ï¼ŒMySQLçš„äºŒè¿›åˆ¶æ—¥å¿—æ˜¯äº‹åŠ¡å®‰å…¨å‹çš„ã€‚</p><blockquote><p>DDL ï¼Œå³ Data Definition Language æ•°æ®åº“å®šä¹‰è¯­è¨€ã€‚</p><ul><li>ä¸»è¦çš„å‘½ä»¤æœ‰CREATEã€ALTERã€DROPç­‰ï¼ŒDDLä¸»è¦æ˜¯ç”¨åœ¨å®šä¹‰æˆ–æ”¹å˜è¡¨ï¼ˆTABLEï¼‰çš„ç»“æ„ï¼Œæ•°æ®ç±»å‹ï¼Œè¡¨ä¹‹é—´çš„é“¾æ¥å’Œçº¦æŸç­‰åˆå§‹åŒ–å·¥ä½œä¸Šï¼Œä»–ä»¬å¤§å¤šåœ¨å»ºç«‹è¡¨æ—¶ä½¿ç”¨ã€‚</li></ul><p>DMLï¼Œå³Data Manipulation Language æ•°æ®æ“çºµè¯­è¨€ã€‚</p><ul><li>ä¸»è¦çš„å‘½ä»¤æ˜¯SELECTã€UPDATEã€INSERTã€DELETEï¼Œå°±è±¡å®ƒçš„åå­—ä¸€æ ·ï¼Œè¿™4æ¡å‘½ä»¤æ˜¯ç”¨æ¥å¯¹æ•°æ®åº“é‡Œçš„æ•°æ®è¿›è¡Œæ“ä½œçš„è¯­è¨€ã€‚</li></ul></blockquote><p>binlogæ—¥å¿—æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li><strong>MySQLä¸»ä»å¤åˆ¶</strong>ï¼šMySQL Replicationåœ¨Masterç«¯å¼€å¯binlogï¼ŒMasteræŠŠå®ƒçš„äºŒè¿›åˆ¶æ—¥å¿—ä¼ é€’ç»™slavesæ¥è¾¾åˆ°<br>master-slaveæ•°æ®ä¸€è‡´çš„ç›®çš„ã€‚</li><li><strong>è‡ªç„¶å°±æ˜¯æ•°æ®æ¢å¤äº†</strong>ï¼Œé€šè¿‡ä½¿ç”¨mysqlbinlogå·¥å…·æ¥ä½¿æ¢å¤æ•°æ®ã€‚</li></ol><h4 id="2-ä»‹ç»ä¸€ä¸‹ï¼ˆå¹¶å‘ï¼‰äº‹åŠ¡ä¸åŒéš”ç¦»çº§åˆ«ï¼Ÿå¯¹åº”å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Ÿ">2.<strong>ä»‹ç»ä¸€ä¸‹ï¼ˆå¹¶å‘ï¼‰äº‹åŠ¡ä¸åŒéš”ç¦»çº§åˆ«</strong>ï¼Ÿ<strong>å¯¹åº”å¯èƒ½å‡ºç°çš„é—®é¢˜</strong>ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/shan-kylin/p/9543294.html">https://www.cnblogs.com/shan-kylin/p/9543294.html</a></p></blockquote><p>ä¸‹é¢<strong>æ’å®ƒé”å’Œå…±äº«é”</strong>éƒ½æ˜¯<strong>è¡Œé”</strong>ï¼Œé”ä½ä¸€è¡Œã€‚</p><ul><li><p><strong>Read uncommittedï¼š</strong> é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ã€‚ä½†è¿™ç§æƒ…å†µä¼šå‡ºç°<strong>è„è¯»</strong>ï¼š å› ä¸º<strong>å†™</strong>æ•°æ®çš„æ—¶å€™æ·»åŠ ä¸€ä¸ª<strong>Xé”ï¼ˆæ’ä»–é”ï¼Œæ‹¿åˆ°é”çš„äº‹åŠ¡å¯ä»¥å†™ï¼Œå…¶å®ƒäº‹åŠ¡åªèƒ½ç­‰å¾…é˜»å¡</strong>ï¼‰ï¼›ä½†<strong>è¯»</strong>ä¸å—é™åˆ¶ï¼Œè¯»ä¸åŠ é”ã€‚</p><blockquote><p>ç”±äºè¯»ä¸åŠ é”ï¼Œè¯»çš„æ˜¯å¯èƒ½æ˜¯ä¿®æ”¹å‰ï¼ˆæœªæäº¤ï¼‰çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯<strong>è„è¯»</strong>ã€‚</p></blockquote></li><li><p><strong>Read Committed ï¼šå†™</strong>æ•°æ®çš„æ—¶å€™åŠ ä¸Š<strong>Xé”ï¼ˆæ’ä»–é”</strong>ï¼‰ï¼Œ<strong>è¯»</strong>æ•°æ®çš„æ—¶å€™æ·»åŠ <strong>Sé”ï¼ˆå…±äº«é”ï¼Œæ‹¿åˆ°é”çš„äº‹åŠ¡å¯ä»¥æŸ¥çœ‹ä½†æ— æ³•ä¿®æ”¹å’Œåˆ é™¤ï¼Œå…¶å®ƒäº‹åŠ¡ã€åªèƒ½åŠ Sé”ã€‘ã€ä¸èƒ½åŠ å…¶å®ƒé”ã€‘å¦‚Xé”</strong>ï¼‰ã€‚è§£å†³è„è¯»ï¼Œä½†ä¼šå¯¼è‡´å‡ºç°<strong>ä¸å¯é‡å¤è¯»</strong>çš„é—®é¢˜ã€‚</p><blockquote><ol><li>åˆå§‹x=100,ï¼›</li><li>äº‹åŠ¡A<strong>è¯»</strong>xï¼ŒåŠ ä¸Š<strong>Sé”</strong>ï¼Œè¯»åˆ°x=<strong>100</strong>ï¼Œ<strong>ç«‹å³é‡Šæ”¾Sé”ä¸”æœªæäº¤</strong>ï¼›</li><li>äº‹åŠ¡B<strong>ä¿®æ”¹</strong>xï¼ŒåŠ ä¸Š<strong>Xé”</strong>ï¼Œä¿®æ”¹x=50ï¼Œæäº¤ ï¼›</li><li>äº‹åŠ¡Aå†æ¬¡<strong>è¯»å–x</strong>ï¼ŒåŠ ä¸Š<strong>Sé”</strong>ï¼Œè¯»å–x=<strong>50</strong>ï¼Œå‘ç°å’Œç¬¬ä¸€æ¬¡è¯»å–ä¸ä¸€è‡´ï¼Œæäº¤äº‹åŠ¡ã€‚</li></ol><p>ä¸Šè¿°è¿‡ç¨‹ï¼Œäº‹åŠ¡Aåœ¨æäº¤å‰è¯»å–ä¸¤æ¬¡ä¸ä¸€æ ·çš„xå€¼ï¼Œä¸º<strong>ä¸å¯é‡å¤è¯»</strong>ã€‚</p></blockquote></li><li><p><strong>Repeatable read</strong> ï¼š<strong>MySQL é»˜è®¤éš”ç¦»ç•Œåˆ«</strong> , å¼€å§‹<strong>è¯»å–</strong>æ•°æ®ï¼ˆäº‹åŠ¡å¼€å¯ï¼‰æ—¶ï¼Œ<strong>ã€Sã€‘é”ä¸å†ç«‹å³é‡Šæ”¾ï¼Œå…¶å®ƒäº‹åŠ¡å°±ä¸èƒ½åŠ ä¸Šã€Xã€‘é”ä¿®æ”¹æ•°æ®</strong>ã€‚è§£å†³äº†è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°<strong>å¹»è¯»</strong>ï¼š-</p><ul><li>Mysqlå®˜æ–¹ç»™å‡ºçš„å¹»è¯»è§£é‡Šæ˜¯ï¼š<strong>åªè¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç¬¬äºŒæ¬¡selectï¼ˆè¯»ï¼‰å¤šå‡ºäº†rowå°±ç®—å¹»è¯»</strong>ã€‚</li></ul><blockquote><p>ç°åœ¨åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p><ul><li>å†™ï¼šXé”ä¿æŒä¸å˜</li><li>è¯»ï¼šSé”ï¼Œ<strong>è¯»å®Œä¸å†ç«‹å³é‡Šæ”¾</strong>ï¼Œè€Œæ˜¯<strong>åœ¨æäº¤çš„æ—¶å€™å†é‡Šæ”¾</strong>ã€‚</li></ul><p>è¿™æ ·çš„è¯ï¼Œä¿è¯äº‹åŠ¡Aåœ¨<u>æäº¤å‰</u>ï¼Œè¯»å–çš„xæ˜¯ä¸€è‡´çš„ã€‚è§£å†³äº†<strong>ä¸å¯é‡å¤è¯»</strong>ï¼Œä½†ä¾æ—§å¯èƒ½å‡ºç°<strong>å¹»è¯»</strong>ã€‚ä¾‹å¦‚ï¼Œ<strong>Xé”ä¸èƒ½é˜»æ­¢ï¼ˆè¡¨ä¸­å…¶å®ƒè®°å½•ï¼‰æ’å…¥æ“ä½œï¼Œå› ä¸ºåªé”ä½äº†å½“å‰è®°å½•ï¼Œæ˜¯è¡Œçº§é”</strong>ã€‚</p><ol><li>äº‹åŠ¡AåŠ ä¸ŠXé”ï¼Œæ›´æ–°äº†<strong>æ‰€æœ‰ç”¨æˆ·</strong>å¹´é¾„ä»<code>20â†’18</code>ï¼›</li><li>è¿‡ä¸€ä¼šå„¿å†è¯»å‘ç°<strong>è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·æ²¡ä¿®æ”¹</strong>ï¼Œè¿˜æ˜¯20å²ï¼Ÿå‡ºç°å¹»è§‰äº†å—ï¼Ÿ</li></ol><p>è¿™æ˜¯å› ä¸ºï¼Œå…¶å®ƒäº‹åŠ¡BåŒæ—¶æ’å…¥äº†ä¸€è¡Œæ–°æ•°æ®ï¼Œå¹´é¾„å°±æ˜¯20å²ã€‚æ‰€ä»¥å†è¯»å‘ç°æ²¡ä¿®æ”¹ã€‚</p></blockquote></li><li><p><strong>Serializable</strong>ï¼š åºåˆ—åŒ–ï¼Œäº‹åŠ¡ä¸²è¡ŒåŒ–é¡ºåºæ‰§è¡Œï¼Œå¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ä¸å¹»è¯»ã€‚è€—è´¹æ€§èƒ½ï¼Œä¸€èˆ¬ä¸ç”¨ã€‚</p></li></ul><h5 id="2-1ã€çŒ¿è¾…å¯¼ã€‘-æ€ä¹ˆè§£å†³å¹»è¯»ï¼Ÿ">2.1ã€çŒ¿è¾…å¯¼ã€‘ æ€ä¹ˆè§£å†³å¹»è¯»ï¼Ÿ</h5><p>è§£å†³å¹»è¯»ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p><strong>é—´éš™é”</strong></p><ul><li><p><strong>é—´éš™é”ï¼ˆGap Lock</strong>ï¼‰ï¼šå½“æˆ‘ä»¬ç”¨ã€èŒƒå›´æ¡ä»¶ã€‘è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™<strong>ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”</strong>ï¼›å¯¹äºé”®å€¼åœ¨<strong>æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšâ€œé—´éš™ï¼ˆGAP)â€</strong>ï¼ŒInnoDBä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ï¼›</p></li><li><p><strong>ä¸¾ä¾‹</strong>ï¼š å‡å¦‚userè¡¨ä¸­åªæœ‰101æ¡è®°å½•ï¼Œå…¶empidçš„å€¼åˆ†åˆ«æ˜¯ 1,2,â€¦,100,101ï¼Œä¸‹é¢çš„SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  <span class="keyword">user</span> <span class="keyword">where</span> user_id <span class="operator">&gt;</span> <span class="number">99</span> <span class="keyword">for</span> update;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªèŒƒå›´æ¡ä»¶çš„æ£€ç´¢ï¼ŒInnoDBä¸ä»…ä¼šå¯¹ï¼ˆ1ï¼‰<strong>ç¬¦åˆæ¡ä»¶çš„user_idå€¼ï¼ˆ100ã€101ï¼‰çš„è®°å½•åŠ é”</strong>ï¼Œä¹Ÿä¼šå¯¹ï¼ˆ2ï¼‰user_idå¤§äº101ï¼ˆè¿™äº›<strong>è®°å½•å¹¶ä¸å­˜åœ¨ï¼‰çš„â€œé—´éš™â€åŠ é”</strong>ã€‚</p></li><li><p><strong>å¦‚ä½•è§£å†³å¹»è¯»</strong>ï¼Ÿ äº§ç”Ÿå¹»è¯»çš„åŸå› æ˜¯ï¼Œè¡Œé”åªèƒ½é”ä½è¡Œï¼Œä½†æ˜¯æ–°æ’å…¥è®°å½•è¿™ä¸ªåŠ¨ä½œï¼Œè¦æ›´æ–°çš„æ˜¯è®°å½•ä¹‹é—´çš„â€œé—´éš™â€ï¼Œå¯¼è‡´ä¸‹æ¬¡è¯»å–äº§ç”Ÿå¹»è¯»ã€‚å¦‚æœé”ä½äº†é—´éš™ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡é”çš„é—®é¢˜äº†ã€‚</p></li></ul></li><li><p><strong>mvvc</strong></p><p>åœ¨RRï¼ˆå¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼‰ä¸ä¼šå‡ºç°å¹»è¯»ã€‚ä¾‹å¦‚ï¼š</p><ol><li><p>å¼€å¯äº‹åŠ¡1ï¼Œè·å¾—äº‹åŠ¡IDä¸º1ã€‚</p></li><li><p>äº‹åŠ¡1æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¾—åˆ°readviewã€‚</p></li><li><p>å¼€å§‹äº‹åŠ¡2ã€‚</p></li><li><p>æ‰§è¡Œinsertã€‚</p></li><li><p>æäº¤äº‹åŠ¡2ã€‚</p></li><li><p>æ‰§è¡Œäº‹åŠ¡1çš„ç¬¬äºŒæ¬¡æŸ¥è¯¢ (å› ä¸ºè¿™é‡Œæ˜¯RRçº§åˆ«ï¼Œæ‰€ä»¥<strong>ä¸ä¼šå†å»è·å¾—readviewï¼Œ<strong>è¿˜æ˜¯ä½¿ç”¨ç¬¬ä¸€æ¬¡è·å¾—çš„readviewï¼Œæ‰€ä»¥</strong>å½“å‰read view äº‹åŠ¡çš„IDä¸ä¼šæ›´æ–°</strong>ï¼Œå³ä¸ä¼šåŠ å…¥æ’å…¥äº‹åŠ¡2)</p></li><li><p>æœ€åå¾—åˆ°çš„ç»“æœæ˜¯ï¼Œæ’å…¥çš„æ•°æ®ä¸ä¼šè¢«è¯»å–æ˜¾ç¤ºï¼Œå› ä¸º<strong>æ’å…¥çš„æ•°æ®äº‹åŠ¡ID &gt; readviewé‡Œçš„æœ€å¤§æ´»è·ƒäº‹åŠ¡ID</strong>ã€‚</p></li></ol></li></ol><h2 id="5-4-MySQä¼˜åŒ–">5.4 MySQä¼˜åŒ–</h2><h4 id="0-åˆ†é¡µæŸ¥è¯¢æ…¢çš„åŸå› ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ">0. åˆ†é¡µæŸ¥è¯¢æ…¢çš„åŸå› ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844904141878214664">https://juejin.cn/post/6844904141878214664</a></p></blockquote><p>åœ¨åç§»é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ç¿»é¡µåˆ°å¾ˆé åçš„é¡µé¢æ—¶ï¼ŒæŸ¥è¯¢é€Ÿåº¦ä¼šå˜å¾—è¶Šæ¥è¶Šæ…¢ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_order order by id limit 1000000000, 10;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºï¼Œéœ€è¦æŸ¥è¯¢ 100000000010 (100000000000 + 10) æ¡è®°å½•ï¼Œç„¶ååªè¿”å›æœ€å 10 æ¡ï¼Œå¹¶å°†å‰é¢çš„ 100000000000 æ¡è®°å½•æŠ›å¼ƒï¼Œè¿™æ ·å½“ç¿»é¡µè¶Šé åæ—¶ï¼Œä»£ä»·å°±å˜å¾—è¶Šæ¥è¶Šé«˜ã€‚</p><p><strong>ä¼˜åŒ–æ–¹æ³•</strong>ï¼š</p><ol><li><p><strong>æœ€å¤§idæ³•</strong></p><ul><li><p>ä¸¾ä¾‹ï¼šæŸ¥è¯¢ç¬¬ä¸€é¡µçš„æ—¶å€™æ˜¯limit 400000,10 æŸ¥è¯¢åˆ°çš„æœ€åä¸€æ¡idæ˜¯4000000ï¼Œé‚£ä¹ˆä¸‹ä¸€é¡µçš„æŸ¥è¯¢åªéœ€è¦æŸ¥è¯¢idå¤§äº400000çš„10æ¡æ•°æ®å³å¯ã€‚</p></li><li><p>è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from user where id &gt; 4000000  limit 10;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>BETWEEN â€¦ AND</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where id BETWEEN 4000000 and 4000010</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ†è¡¨æŸ¥è¯¢</strong></p><p>mysqlæ¨èä¸€å¼ è¡¨çš„å­˜å‚¨ä¸è¦è¶…è¿‡500wæ•°æ®ï¼ŒæŸ¥è¯¢400wä¸åˆ°1ç§’å¯¹äºä¸€èˆ¬çš„æŸ¥è¯¢æ¥è¯´å·²ç»å¯ä»¥äº†ï¼Œå¦‚æœè¿˜è¦æ›´å¿«çš„è¯ï¼Œæˆ‘å»ºè®®ä½¿ç”¨åˆ†è¡¨å­˜å‚¨ï¼Œåˆ†è¡¨åˆåˆ†ä¸¤ç§æƒ…å†µï¼Œæ°´å¹³åˆ†è¡¨äºå‚ç›´åˆ†è¡¨ã€‚</p></li><li><p><strong>å»¶è¿Ÿå…³è”ï¼ˆä¸ªäººæ¨è</strong>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from table a,(select id from table limit 100000,20) b on a.id=b.id</span><br></pre></td></tr></table></figure></li></ol><h4 id="1-SQLä¼˜åŒ–æ‰‹æ®µæœ‰å“ªäº›ï¼Ÿ">1. <strong>SQLä¼˜åŒ–æ‰‹æ®µæœ‰å“ªäº›</strong>ï¼Ÿ</h4><ol><li><p>æŸ¥è¯¢è¯­å¥ä¸­ä¸è¦ä½¿ç”¨select</p></li><li><p><strong>å°½é‡å‡å°‘å­æŸ¥è¯¢ï¼Œä½¿ç”¨å…³è”æŸ¥è¯¢</strong>ï¼ˆleft join,right join,inner joinï¼‰æ›¿ä»£</p></li><li><p><strong>å‡å°‘ä½¿ç”¨INæˆ–è€…NOT IN ,ä½¿ç”¨existsï¼Œnot exists</strong>æˆ–è€…å…³è”æŸ¥è¯¢è¯­å¥æ›¿ä»£(åœ¨ç¡®è®¤æ²¡æœ‰é‡å¤æ•°æ®æˆ–è€…ä¸ç”¨å‰”é™¤é‡å¤æ•°æ®æ—¶ï¼Œunion allä¼šæ›´å¥½)</p></li><li><p><strong>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–&lt;&gt;æ“ä½œç¬¦</strong>ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</p></li><li><p><strong>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ</strong>ï¼Œå¦‚ï¼š select id from t where num is null å¯ä»¥åœ¨numä¸Šè®¾ç½®é»˜è®¤å€¼0ï¼Œç¡®ä¿è¡¨ä¸­numåˆ—æ²¡æœ‰nullå€¼ï¼Œç„¶åè¿™æ ·æŸ¥è¯¢ï¼š select id from t where num=0</p></li></ol><h4 id="2-è¯·é—®å¦‚ä½•é˜²æ­¢SQLè¢«æ³¨å…¥ï¼Ÿ">2.<strong>è¯·é—®å¦‚ä½•é˜²æ­¢SQLè¢«æ³¨å…¥</strong>ï¼Ÿ</h4><ul><li><p><strong>ä»€ä¹ˆæ˜¯SQLæ³¨å…¥</strong>ï¼Ÿ</p><p>æ”»å‡»è€…åœ¨HTTPè¯·æ±‚ä¸­æ³¨å…¥æ¶æ„çš„SQLä»£ç ï¼ŒæœåŠ¡å™¨ä½¿ç”¨å‚æ•°æ„å»ºæ•°æ®åº“SQLå‘½ä»¤æ—¶ï¼Œæ¶æ„SQLè¢«ä¸€èµ·æ„é€ ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œã€‚</p><ul><li><p>ä¾‹å¦‚ï¼šç”¨æˆ·ç™»å½•ï¼Œæ”»å‡»è€…è¾“å…¥ï¼š<code>ç”¨æˆ·å = liangzone</code>ï¼Œ<code>å¯†ç  = â€˜ or â€˜1â€™=â€™1</code>  ï¼Œé‚£ä¹ˆæ‹¼æ¥åçš„è¯­å¥æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name = â€˜lianggzoneâ€™ and password = â€˜â€™ or â€˜1â€™=â€˜1â€™ </span><br></pre></td></tr></table></figure><p>æ”»å‡»è€…å°±å¯ä»¥<strong>æŸ¥è¯¢å‡ºæ‰€æœ‰çš„ç”¨æˆ·è¡¨ä¿¡æ¯</strong>ï¼</p></li></ul></li><li><p><strong>å¦‚ä½•é˜²èŒƒSQLæ³¨å…¥</strong>ï¼Ÿ</p><ul><li>Webç«¯ï¼š1ï¼‰æœ‰æ•ˆæ€§æ£€éªŒï¼› 2ï¼‰é™åˆ¶å­—ç¬¦ä¸²è¾“å…¥çš„é•¿åº¦</li><li>æœåŠ¡å™¨ç«¯ï¼š1ï¼‰ä¸ç”¨æ‹¼æ¥SQLå­—ç¬¦ä¸²ï¼Œ 2ï¼‰ä½¿ç”¨é¢„ç¼–è¯‘çš„PrepareStatementï¼Œ 3ï¼‰æœ‰æ•ˆæ€§æ£€éªŒï¼Œ4ï¼‰<strong>è¿‡æ»¤SQLéœ€è¦çš„å‚æ•°ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚å•å¼•å·ã€åŒå¼•å·</strong>ã€‚</li></ul></li></ul><h4 id="3-MySQL-å¦‚ä½•åšåˆ°é«˜å¹¶å‘è§£å†³æ–¹æ¡ˆï¼Ÿ">3. <strong>MySQL å¦‚ä½•åšåˆ°é«˜å¹¶å‘è§£å†³æ–¹æ¡ˆ</strong>ï¼Ÿ</h4><ol><li><strong>åœ¨webæœåŠ¡æ¡†æ¶ä¸­åŠ å…¥ç¼“å­˜</strong>ã€‚åœ¨æœåŠ¡å™¨ä¸æ•°æ®åº“å±‚ä¹‹é—´åŠ å…¥ç¼“å­˜å±‚ï¼Œå°†é«˜é¢‘è®¿é—®çš„æ•°æ®å­˜å…¥ç¼“å­˜ä¸­ï¼Œå‡å°‘æ•°æ®åº“çš„è¯»å–è´Ÿæ‹…ã€‚</li><li><strong>å¢åŠ æ•°æ®åº“ç´¢å¼•ï¼Œè¿›è€Œæé«˜æŸ¥è¯¢é€Ÿåº¦</strong>ã€‚ï¼ˆä¸è¿‡ç´¢å¼•å¤ªå¤šä¼šå¯¼è‡´é€Ÿåº¦å˜æ…¢ï¼Œå¹¶ä¸”æ•°æ®åº“çš„å†™å…¥ä¼šå¯¼è‡´ç´¢å¼•çš„æ›´æ–°ï¼Œä¹Ÿä¼šå¯¼è‡´é€Ÿåº¦å˜æ…¢ï¼‰</li><li><strong>ä¸»ä»è¯»å†™åˆ†ç¦»åˆ†åº“</strong>ï¼Œè®©ä¸»æœåŠ¡å™¨è´Ÿè´£å†™ï¼Œä»æœåŠ¡å™¨è´Ÿè´£è¯»ã€‚</li><li><strong>å°†æ•°æ®åº“è¡¨è¿›è¡Œæ‹†åˆ†è¡¨</strong>ï¼Œä½¿å¾—æ•°æ®åº“çš„è¡¨å°½å¯èƒ½å°ï¼Œæé«˜æŸ¥è¯¢çš„é€Ÿåº¦ã€‚</li><li><strong>ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„</strong>ï¼Œåˆ†æ•£è®¡ç®—å‹åŠ›ã€‚</li></ol><h4 id="4-å¤§è¡¨å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Ÿ">4. å¤§è¡¨å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Ÿ</h4><p>å½“MySQLå•è¡¨è®°å½•æ•°è¿‡å¤§æ—¶ï¼Œæ•°æ®åº“çš„CRUDæ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ï¼Œâ¼€äº›å¸¸â»…çš„ä¼˜åŒ–æªæ–½å¦‚ä¸‹ã€‚</p><ul><li><p><strong>é™å®šæ•°æ®çš„èŒƒå›´</strong>ï¼šåŠ¡å¿…ç¦â½Œä¸å¸¦ä»»ä½•é™åˆ¶æ•°æ®èŒƒå›´æ¡ä»¶çš„æŸ¥è¯¢è¯­å¥ã€‚â½å¦‚ï¼šæˆ‘ä»¬å½“â½¤æˆ·åœ¨æŸ¥è¯¢è®¢å•å†å²çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶åœ¨â¼€ä¸ªâ½‰çš„èŒƒå›´å†…ï¼›</p></li><li><p><strong>è¯»/å†™åˆ†ç¦»</strong>ï¼šç»å…¸çš„æ•°æ®åº“æ‹†åˆ†â½…æ¡ˆï¼Œä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ï¼›</p></li><li><p><strong>å‚ç›´åˆ†åŒº</strong>ï¼šæ ¹æ®æ•°æ®åº“â¾¥â¾¯æ•°æ®è¡¨çš„ç›¸å…³æ€§è¿›è¡Œæ‹†åˆ†ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œâ½¤æˆ·è¡¨ä¸­æ—¢æœ‰â½¤æˆ·çš„ç™»å½•ä¿¡æ¯â¼œæœ‰â½¤æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¯ä»¥å°†â½¤æˆ·è¡¨æ‹†åˆ†æˆä¸¤ä¸ªå•ç‹¬çš„è¡¨ï¼Œç”šâ¾„æ”¾åˆ°å•ç‹¬çš„åº“åšåˆ†åº“ã€‚</p><ul><li><p>ç®€å•æ¥è¯´å‚ç›´æ‹†åˆ†æ˜¯æŒ‡æ•°æ®è¡¨åˆ—çš„æ‹†åˆ†ï¼ŒæŠŠâ¼€å¼ åˆ—â½è¾ƒå¤šçš„è¡¨æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ã€‚</p><p><img src="https://i.loli.net/2021/05/16/25HtBIuXygCUVrq.png" alt="image-20210516234359675"></p></li></ul></blockquote></li><li><p><strong>æ°´å¹³åˆ†åŒº :</strong> ä¿æŒæ•°æ®è¡¨ç»“æ„ä¸å˜ï¼Œé€šè¿‡æŸç§ç­–ç•¥å­˜å‚¨æ•°æ®åˆ†â½šã€‚è¿™æ ·æ¯â¼€â½šæ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„è¡¨æˆ–è€…åº“ä¸­ï¼Œ<strong>è¾¾åˆ°äº†åˆ†å¸ƒå¼çš„â½¬çš„</strong>ã€‚ â½”å¹³æ‹†åˆ†å¯ä»¥æ”¯æ’‘â¾®å¸¸å¤§çš„æ•°æ®é‡ã€‚</p></li></ul><p>å…¶å®ƒæ•°æ®åº“ç»“æ„æ–¹é¢ä¼˜åŒ–ï¼š</p><ul><li><strong>èŒƒå¼ä¼˜åŒ–</strong>ï¼š æ¯”å¦‚æ¶ˆé™¤å†—ä½™ï¼ˆèŠ‚çœç©ºé—´ã€‚ã€‚ï¼‰</li><li><strong>åèŒƒå¼ä¼˜åŒ–</strong>ï¼šæ¯”å¦‚é€‚å½“åŠ å†—ä½™ç­‰ï¼ˆå‡å°‘joinï¼‰</li></ul><h4 id="5-æ•°æ®åº“å¦‚ä½•å»é‡ï¼Ÿ">5. æ•°æ®åº“å¦‚ä½•å»é‡ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000002508404">MySQLæ•°æ®åº“è¡Œå»é‡å¤å’Œåˆ—å»é‡å¤</a></p></blockquote><h5 id="5-1-è¡Œå»é‡">5.1 è¡Œå»é‡</h5><blockquote><p>å­˜åœ¨è¡Œé‡å¤ï¼Œåˆ™æ— æ³•å»ºç«‹ <u>å”¯ä¸€ç´¢å¼•</u> ç­‰ã€‚</p></blockquote><blockquote><p>ç”¨<code>distinct</code> å¾—åˆ°æˆ‘ä»¬è¦ä¿ç•™çš„æ•°æ®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p></blockquote><p>ä¸‹é¢å‡è®¾çš„æ˜¯emailå­—æ®µé‡å¤ã€‚</p><ol><li><p>æŸ¥çœ‹æˆ‘ä»¬çš„åˆ†ç»„å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,count(id) from demo_table group by email having count(id)&gt;1 order by id;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+------+--------------+-----------+</span><br><span class="line">| id | name | email        | count(id) |</span><br><span class="line">+----+------+--------------+-----------+</span><br><span class="line">|  1 | u1   | u1@email.com |         4 |</span><br><span class="line">|  2 | u2   | u2@email.com |         4 |</span><br><span class="line">|  3 | u3   | u3@email.com |         3 |</span><br><span class="line">|  4 | u4   | u4@email.com |         2 |</span><br><span class="line">|  5 | u5   | u5@email.com |         2 |</span><br><span class="line">+----+------+--------------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li><li><p>ä¿ç•™æ¯ä¸ªåˆ†ç»„<strong>æœ€å°çš„id</strong>ï¼Œè¡¨ä¸­å…¶ä½™éƒ½åˆ é™¤</p><p>åœ¨è¡¨ä¸­åˆ é™¤ä¸ç¬¦åˆè¦æ±‚çš„æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from demo_table where id not in (select min(id) from demo_table group by email);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¼¼ä¹æœ‰ä¿æŠ¤æœºåˆ¶ï¼Œæ— æ³•ç›´æ¥åˆ é™¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1093 (HY000): You can&#x27;t specify target table &#x27;demo_table&#x27; for update in FROM clause</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸´æ—¶è¡¨å†åˆ é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºä¸´æ—¶è¡¨ä¿å­˜æ¯ä¸ªåˆ†ç»„ä¸­æœ€å°çš„é‚£ä¸ªid</span><br><span class="line">create table tmp_table as select min(id) from demo_table group by email;</span><br><span class="line"></span><br><span class="line"># åˆ é™¤è¡¨ä¸­æ•°æ®</span><br><span class="line">delete from demo_table where id not in (select * from tmp_table);</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ä¸´æ—¶è¡¨</span><br><span class="line">drop table tmp_table;</span><br></pre></td></tr></table></figure></li></ol><h5 id="5-2-åˆ—é‡å¤">5.2 åˆ—é‡å¤</h5><ol><li><p>å…ˆæ‰¾åˆ°é‡å¤å­—æ®µçš„<strong>è¡Œ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from demo_table as a, demo_table as b where a.id=b.id and a.name=b.email;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+--------------+--------------+----+--------------+--------------+</span><br><span class="line">| id | name         | email        | id | name         | email        |</span><br><span class="line">+----+--------------+--------------+----+--------------+--------------+</span><br><span class="line">| 31 | 31@email.com | 31@email.com | 31 | 31@email.com | 31@email.com |</span><br><span class="line">| 32 | 32@email.com | 32@email.com | 32 | 32@email.com | 32@email.com |</span><br><span class="line">| 33 | 33@email.com | 33@email.com | 33 | 33@email.com | 33@email.com |</span><br><span class="line">| 34 | 34@email.com | 34@email.com | 34 | 34@email.com | 34@email.com |</span><br><span class="line">| 35 | 35@email.com | 35@email.com | 35 | 35@email.com | 35@email.com |</span><br><span class="line">+----+--------------+--------------+----+--------------+--------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>é‡å¤è®°å½•çš„idéƒ½å·²ç»æ‰¾å‡ºæ¥äº†ï¼Œåˆ é™¤å°±å‚è€ƒä¸Šè¿°æ–¹å¼å¤„ç†äº†ã€‚</p></li></ol><h4 id="6-selectæ…¢çš„åŸå› ï¼Ÿæ…¢æŸ¥è¯¢çš„ä¼˜åŒ–ç­–ç•¥ï¼Ÿ">6. selectæ…¢çš„åŸå› ï¼Ÿæ…¢æŸ¥è¯¢çš„ä¼˜åŒ–ç­–ç•¥ï¼Ÿ</h4><h5 id="6-1-select-å¾ˆæ…¢çš„åŸå› ">6.1 select å¾ˆæ…¢çš„åŸå› </h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/kubidemanong/p/10734045.html">è…¾è®¯é¢è¯•ï¼šä¸€æ¡SQLè¯­å¥æ‰§è¡Œå¾—å¾ˆæ…¢çš„åŸå› æœ‰å“ªäº›?</a></p></blockquote><ul><li><p><strong>å¦‚æœæ˜¯å¶å°”å¾ˆæ…¢</strong></p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œè¿™æ¡SQLè¯­å¥çš„ä¹¦å†™æœ¬èº«æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚å¯èƒ½æ˜¯å…¶å®ƒåŸå› å¯¼è‡´ï¼š</p><ol><li><strong>è¢«åŠ é”ã€‚</strong> è¦æ‰§è¡Œçš„è¿™æ¡è¯­å¥ï¼Œåˆšå¥½è¿™æ¡è¯­å¥æ¶‰åŠåˆ°çš„<strong>è¡¨</strong>ï¼Œåˆ«äººåœ¨ç”¨ï¼Œå¹¶ä¸”åŠ é”äº†ï¼Œæˆ‘ä»¬æ‹¿ä¸åˆ°é”ï¼Œåªèƒ½æ…¢æ…¢ç­‰å¾…åˆ«äººé‡Šæ”¾é”äº†ï¼›æˆ–è€…ï¼Œè¡¨æ²¡æœ‰åŠ é”ï¼Œä½†è¦ä½¿ç”¨åˆ°çš„æŸä¸ªä¸€<strong>è¡Œ</strong>è¢«åŠ é”äº† ã€‚</li><li>æ•°æ®åº“åœ¨åˆ·æ–°è„é¡µ ï¼Ÿ çœ‹é“¾æ¥ï¼Œä¸å¤ªæ˜ç™½æµç¨‹ã€‚</li></ol></li><li><p><strong>å¦‚æœæ˜¯ç»å¸¸å¾ˆæ…¢</strong></p><ol><li><p><strong>æ²¡ç”¨åˆ°ç´¢å¼•</strong></p></li><li><p><strong>ç´¢å¼•å¤±æ•ˆäº†</strong> ï¼š</p><p>ï¼ˆ1ï¼‰è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦åŒ¹é…ï¼ˆä¸åŒ…å«ç¬¬ä¸€ä¸ªç´¢å¼•ï¼‰ï¼›</p><p>ï¼ˆ2ï¼‰likeè¯­å¥ä¸æ»¡è¶³æœ€å·¦åŒ¹é…ï¼ˆä¸åŒ…å«ç¬¬ä¸€ä¸ªç´¢å¼•ï¼‰</p><p>ï¼ˆ3ï¼‰æˆ–è€…ç´¢å¼•åŠ ä¸Šäº†è¿ç®—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t where c - 1 = 1000;</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸ä¼šæœ‰æ•ˆï¼Œåº”è¯¥æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t where c = 1000 + 1;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æˆ–è€…å‡½æ•°æ“ä½œç”¨ä¸Šç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t where pow(c,2) = 1000;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ•°æ®åº“ä½¿ç”¨éèšç°‡ç´¢å¼•</strong></p><p>æˆ‘ä»¬åœ¨è¿›è¡ŒæŸ¥è¯¢æ“ä½œçš„æ—¶å€™ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t where 100 &lt; c and c &lt; 100000;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä½¿ç”¨çš„éèšç°‡ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰ï¼Œåªæ˜¯å­˜å‚¨äº†<strong>ä¸»é”®çš„key</strong> ï¼Œè¿˜æ˜¯è¦å†æ¬¡é€šè¿‡èšç°‡ç´¢å¼•å»æŸ¥æ‰¾ã€‚æ•ˆç‡å¯èƒ½ä¸å¿…å…¨è¡¨æ‰«æé«˜ã€‚</p></li></ol></li></ul><h4 id="7-selectâ€¦for-updateç”¨æ³•ï¼Ÿ">7. selectâ€¦for updateç”¨æ³•ï¼Ÿ</h4><blockquote><p><a href="https://segmentfault.com/a/1190000023045909">æ•°æ®åº“-MySQLä¸­for updateçš„ä½œç”¨å’Œç”¨æ³•</a></p></blockquote><p><code>for update</code>æ˜¯ä¸€ç§<code>è¡Œçº§é”</code>ï¼Œåˆå«<code>æ’å®ƒé”</code>ã€‚</p><p>ä¸€æ—¦ç”¨æˆ·å¯¹æŸä¸ªè¡Œæ–½åŠ äº†è¡Œçº§åŠ é”ï¼Œåˆ™<strong>è¯¥ç”¨æˆ·å¯ä»¥æŸ¥è¯¢ä¹Ÿå¯ä»¥æ›´æ–°</strong>è¢«åŠ é”çš„æ•°æ®è¡Œï¼Œ<strong>å…¶å®ƒç”¨æˆ·åªèƒ½æŸ¥è¯¢</strong>ä½†ä¸èƒ½æ›´æ–°è¢«åŠ é”çš„æ•°æ®è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- å¼€å¯äº‹åŠ¡</span><br><span class="line">begin;</span><br><span class="line">SELECT * FROM user WHERE id=3 FOR UPDATE;</span><br><span class="line">SELECT * FROM user WHERE id=3 and name=&#x27;Tom&#x27; FOR UPDATE;</span><br><span class="line">-- æäº¤äº‹åŠ¡</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure><h4 id="8-åœºæ™¯é¢˜ï¼šå‡å¦‚é€‰æ‹©MySQLæ•°æ®åº“ï¼Œä¸€å¤©äº”ä¸‡æ¡å¢é‡ï¼Œè¿ç»´ä¸‰å¹´ï¼Œæœ‰å“ªäº›ä¼˜åŒ–æ‰‹æ®µï¼Ÿ">8. åœºæ™¯é¢˜ï¼šå‡å¦‚é€‰æ‹©MySQLæ•°æ®åº“ï¼Œä¸€å¤©äº”ä¸‡æ¡å¢é‡ï¼Œè¿ç»´ä¸‰å¹´ï¼Œæœ‰å“ªäº›ä¼˜åŒ–æ‰‹æ®µï¼Ÿ</h4><ol><li><strong>è®¾è®¡è‰¯å¥½çš„æ•°æ®åº“ç»“æ„</strong>ï¼Œå…è®¸éƒ¨åˆ†æ•°æ®å†—ä½™ï¼Œå°½é‡é¿å…joinæŸ¥è¯¢ï¼Œæé«˜æ•ˆç‡ï¼›</li><li>é€‰æ‹©åˆé€‚çš„è¡¨å­—æ®µæ•°æ®ç±»å‹å’Œå­˜å‚¨å¼•æ“ï¼Œé€‚å½“çš„<strong>æ·»åŠ ç´¢å¼•</strong>ï¼›</li><li>MySQLåº“ä¸»ä»<strong>åˆ†åº“è¯»å†™åˆ†ç¦»</strong>ï¼›</li><li>æ‰¾è§„å¾‹<strong>åˆ†è¡¨</strong>ï¼Œå‡å°‘å•è¡¨ä¸­çš„æ•°æ®é‡æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼›</li><li><strong>æ·»åŠ ç¼“å­˜æœºåˆ¶</strong>ï¼Œæ¯”å¦‚Memcachedï¼ŒApcç­‰ï¼›</li><li><strong>ä¹¦å†™é«˜æ•ˆç‡çš„SQL</strong>ã€‚æ¯”å¦‚ SELECT * FROM TABEL æ”¹ä¸º SELECT field_1, field_2, field_3 FROM TABLEã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰_è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</title>
      <link href="/p/15646/"/>
      <url>/p/15646/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>å››ã€æ“åœºç³»ç»Ÿ</h1><h2 id="4-1-æ“ä½œç³»ç»ŸåŸºç¡€">4.1 æ“ä½œç³»ç»ŸåŸºç¡€</h2><h4 id="0-ï¼ˆç™¾åº¦å®‰å…¨ä¸€é¢ï¼‰-å†¯è¯ºä¾æ›¼ç»“æ„æœ‰å“ªå‡ ä¸ªæ¨¡å—ï¼Ÿåˆ†åˆ«å¯¹åº”ç°ä»£è®¡ç®—æœºçš„å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿ">0. ï¼ˆç™¾åº¦å®‰å…¨ä¸€é¢ï¼‰ å†¯è¯ºä¾æ›¼ç»“æ„æœ‰å“ªå‡ ä¸ªæ¨¡å—ï¼Ÿåˆ†åˆ«å¯¹åº”ç°ä»£è®¡ç®—æœºçš„å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿ</h4><ul><li>å­˜å‚¨å™¨ï¼šå†…å­˜</li><li><strong>æ§åˆ¶å™¨ï¼šå—æ¡¥åŒ—æ¡¥</strong></li><li>è¿ç®—å™¨ï¼šCPU</li><li>è¾“å…¥è®¾å¤‡ï¼šé”®ç›˜</li><li>è¾“å‡ºè®¾å¤‡ï¼šæ˜¾ç¤ºå™¨ã€ç½‘å¡</li></ul><h4 id="1-ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ">1. ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</h4><ol><li>æ“ä½œç³»ç»Ÿï¼ˆOperating Systemï¼Œç®€ç§° OSï¼‰æ˜¯ç®¡ç†è®¡ç®—æœºç¡¬ä»¶ä¸è½¯ä»¶èµ„æºçš„ç¨‹åºï¼Œæ˜¯è®¡ç®—æœºç³»ç»Ÿçš„å†…æ ¸ä¸åŸºâ½¯ï¼›</li><li>æ“ä½œç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯è¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„è½¯ä»¶ç¨‹åº ï¼›</li><li>æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·æä¾›â¼€ä¸ªä¸ç³»ç»Ÿäº¤äº’çš„æ“ä½œç•Œé¢ ï¼›</li><li>æ“ä½œç³»ç»Ÿåˆ†å†…æ ¸ä¸å¤–å£³ï¼ˆæˆ‘ä»¬å¯ä»¥æŠŠå¤–å£³ç†è§£æˆå›´ç»•ç€å†…æ ¸çš„åº”ç”¨ç¨‹åºï¼Œè€Œå†…æ ¸å°±æ˜¯èƒ½æ“ä½œç¡¬ä»¶çš„ç¨‹åºï¼‰ã€‚</li></ol><h4 id="2-ä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨å‘¢ï¼Ÿ-èƒ½ä¸èƒ½è¯¦ç»†ä»‹ç»â¼€ä¸‹ï¼Ÿ">2. ä»€ä¹ˆæ˜¯ç³»ç»Ÿè°ƒç”¨å‘¢ï¼Ÿ èƒ½ä¸èƒ½è¯¦ç»†ä»‹ç»â¼€ä¸‹ï¼Ÿ</h4><p>æ ¹æ®è¿›ç¨‹è®¿é—®èµ„æºçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿›ç¨‹åœ¨ç³»ç»Ÿä¸Šçš„è¿è¡Œåˆ†ä¸ºä¸¤ä¸ªçº§åˆ«ï¼š</p><ol><li><strong>ç”¨æˆ·æ€(user mode) :</strong> ç”¨æˆ·æ€è¿è¡Œçš„è¿›ç¨‹æˆ–å¯ä»¥ç›´æ¥è¯»å–ç”¨æˆ·ç¨‹åºçš„æ•°æ®ã€‚</li><li><strong>ç³»ç»Ÿæ€(kernel mode)</strong>ï¼šå¯ä»¥ç®€å•çš„ç†è§£ç³»ç»Ÿæ€è¿è¡Œçš„è¿›ç¨‹æˆ–ç¨‹åºâ¼ä¹å¯ä»¥è®¿é—®è®¡ç®—æœºçš„ä»»ä½•èµ„æºï¼Œä¸å—é™åˆ¶ã€‚</li></ol><p>æˆ‘ä»¬è¿è¡Œçš„ç¨‹åºåŸºæœ¬éƒ½æ˜¯è¿è¡Œåœ¨<strong>ç”¨æˆ·æ€</strong>ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿæ€çº§åˆ«çš„å­åŠŸèƒ½å’‹åŠå‘¢ï¼Ÿé‚£å°±éœ€è¦ç³»ç»Ÿè°ƒç”¨äº†ï¼</p><p>è¿™äº›ç³»ç»Ÿè°ƒç”¨æŒ‰åŠŸèƒ½å¤§è‡´å¯åˆ†ä¸ºå¦‚ä¸‹â¼ç±»ï¼š</p><ul><li><strong>è®¾å¤‡ç®¡ç†</strong>ã€‚å®Œæˆè®¾å¤‡çš„è¯·æ±‚æˆ–é‡Šæ”¾ï¼Œä»¥åŠè®¾å¤‡å¯åŠ¨ç­‰åŠŸèƒ½ã€‚</li><li><strong>â½‚ä»¶ç®¡ç†</strong>ã€‚å®Œæˆâ½‚ä»¶çš„è¯»ã€å†™ã€åˆ›å»ºåŠåˆ é™¤ç­‰åŠŸèƒ½ã€‚</li><li><strong>è¿›ç¨‹æ§åˆ¶</strong>ã€‚å®Œæˆè¿›ç¨‹çš„åˆ›å»ºã€æ’¤é”€ã€é˜»å¡åŠå”¤é†’ç­‰åŠŸèƒ½ã€‚</li><li><strong>è¿›ç¨‹é€šä¿¡</strong>ã€‚å®Œæˆè¿›ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’æˆ–ä¿¡å·ä¼ é€’ç­‰åŠŸèƒ½ã€‚</li><li><strong>å†…å­˜ç®¡ç†</strong>ã€‚å®Œæˆå†…å­˜çš„åˆ†é…ã€å›æ”¶ä»¥åŠè·å–ä½œä¸šå ç”¨å†…å­˜åŒºå¤§å°åŠåœ°å€ç­‰åŠŸèƒ½ã€‚</li></ul><h4 id="3-CentOS-å’Œ-Linuxçš„å…³ç³»ï¼Ÿ">3. <strong>CentOS å’Œ Linuxçš„å…³ç³»ï¼Ÿ</strong></h4><p>Linuxæ„æ€è¾ƒå¹¿å¹¿ä¹‰çš„èŒƒå›´ï¼Œå¤šæŒ‡æ˜¯Linuxå†…æ ¸ã€‚CentOSæ˜¯RedHatçš„ä¸€ä¸ªåˆ†æ”¯ï¼ŒRedHatæ˜¯Linuxçš„ä¸€ä¸ªå‘è¡Œç‰ˆæœ¬ï¼ŒRedHatä¸CentOSçš„åŒºåˆ«åœ¨äºï¼ŒRedHatæ”¶è´¹ï¼ŒCentOSå…è´¹ã€‚</p><h4 id="4-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ï¼Œä¼˜ç¼ºç‚¹ï¼Ÿé›†ç¾¤ï¼Ÿ">4. ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ï¼Œä¼˜ç¼ºç‚¹ï¼Ÿé›†ç¾¤ï¼Ÿ</h4><ul><li><p><strong>åˆ†å¸ƒå¼</strong></p><p>æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œæ‹†<strong>åˆ†æˆNä¸ªå­ç³»ç»Ÿ</strong>ï¼Œå¤šä¸ªå­ç³»ç»Ÿç›¸äº’åä½œæ‰èƒ½å®Œæˆä¸šåŠ¡æµç¨‹<strong>å­ç³»ç»Ÿä¹‹é—´é€šè®¯</strong>ä½¿ç”¨<strong>RPC</strong>è¿œç¨‹é€šè®¯æŠ€æœ¯ã€‚</p></li><li><p><strong>é›†ç¾¤</strong></p><p>åŒä¸€ä¸ªå·¥ç¨‹éƒ¨ç½²åœ¨å¤šä¸ªä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼ä¼˜ç‚¹</strong></p><p>1.æŠŠæ¨¡å—æ‹†åˆ†ï¼Œä½¿ç”¨æ¥å£é€šä¿¡ï¼Œé™ä½æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ã€‚</p><p>2.æŠŠé¡¹ç›®æ‹†åˆ†æˆè‹¥å¹²ä¸ªå­é¡¹ç›®ï¼Œä¸åŒçš„å›¢é˜Ÿè´Ÿè´£ä¸åŒçš„å­é¡¹ç›®ã€‚</p><p>3.å¢åŠ åŠŸèƒ½æ—¶åªéœ€è¦å†å¢åŠ ä¸€ä¸ªå­é¡¹ç›®ï¼Œè°ƒç”¨å…¶å®ƒç³»ç»Ÿçš„æ¥å£å°±å¯ä»¥ã€‚</p><p>4.å¯ä»¥çµæ´»çš„è¿›è¡Œåˆ†å¸ƒå¼éƒ¨ç½²ã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼ç¼ºç‚¹</strong></p><p>1.ç³»ç»Ÿä¹‹é—´äº¤äº’éœ€è¦ä½¿ç”¨è¿œç¨‹é€šä¿¡ï¼Œæ¥å£å¼€å‘å¢åŠ å·¥ä½œé‡ã€‚</p><p>2.å„ä¸ªæ¨¡å—æœ‰ä¸€äº›é€šç”¨çš„ä¸šåŠ¡é€»è¾‘æ— æ³•å…±ç”¨ã€‚</p></li></ul><h4 id="5-åœ¨Linux-windowsæ ˆç©ºé—´çš„å¤§å°ï¼Ÿ">5. åœ¨Linux/windowsæ ˆç©ºé—´çš„å¤§å°ï¼Ÿ</h4><ul><li><p><strong>Linuxç¯å¢ƒä¸‹ç”±æ“ä½œç³»ç»Ÿå†³å®š</strong>ï¼Œä¸€èˆ¬æ˜¯<code>8KB</code> ï¼Œ é€šè¿‡ulimitå‘½ä»¤æŸ¥çœ‹ä»¥åŠä¿®æ”¹</p><blockquote><p>åœ¨Linuxä¸‹é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯æŸ¥çœ‹å’Œè®¾ç½®æ ˆçš„å¤§å°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">ulimit</span> -a            <span class="comment"># æ˜¾ç¤ºå½“å‰æ ˆçš„å¤§å° ï¼ˆulimitä¸ºç³»ç»Ÿå‘½ä»¤ï¼Œéç¼–è¯‘å™¨å‘½ä»¤ï¼‰</span></span>       </span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">ulimit</span> -s 32768      <span class="comment"># è®¾ç½®å½“å‰æ ˆçš„å¤§å°ä¸º32MCopy to clipboardErrorCopied</span></span></span><br></pre></td></tr></table></figure></blockquote></li><li><p><strong>Windowsç¯å¢ƒä¸‹ç”±ç¼–è¯‘å™¨å†³å®š</strong>ï¼ŒVC++6.0ä¸€èˆ¬æ˜¯<code>1M</code> \</p><blockquote><p>Windowså¹³å°ä¸‹æ ˆçš„å¤§å°æ˜¯è¢«è®°å½•åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ï¼ˆç”±ç¼–è¯‘å™¨æ¥è®¾ç½®)ï¼Œå³ï¼šwindowsä¸‹å¯ä»¥ç”±ç¼–è¯‘å™¨å†³å®šæ ˆå¤§å°ï¼Œè€Œåœ¨Linuxä¸‹æ˜¯ç”±ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥æ§åˆ¶æ ˆçš„å¤§å°çš„ã€‚</p></blockquote></li></ul><h4 id="6-ASCIIã€Unicodeå’ŒUTF-8ç¼–ç çš„åŒºåˆ«ï¼Ÿ">6. ASCIIã€Unicodeå’ŒUTF-8ç¼–ç çš„åŒºåˆ«ï¼Ÿ</h4><ul><li><p><strong>ASCII :</strong>  ASCII åªæœ‰127ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºè‹±æ–‡å­—æ¯çš„å¤§å°å†™ã€æ•°å­—å’Œä¸€äº›ç¬¦å· ï¼›</p><blockquote><p>å¸¸ç”¨ä¸­æ–‡éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸”ä¸èƒ½å’ŒASCIIå†²çªï¼Œä¸­å›½å®šåˆ¶äº†<code>GB2312</code>ç¼–ç æ ¼å¼ã€‚</p></blockquote></li><li><p><strong>Unicodeï¼š</strong> Unicodeå°±æ˜¯å°†<strong>ä¸åŒè¯­è¨€ç»Ÿä¸€åˆ°ä¸€å¥—ç¼–ç æ ¼å¼ä¸­</strong>ï¼Œé€šå¸¸<strong>ä¸¤ä¸ª</strong>å­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè€Œ<strong>ASCIIæ˜¯ä¸€ä¸ª</strong>å­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ ï¼›</p><blockquote><p>å¦‚æœä½ ç¼–è¯‘çš„æ–‡æœ¬æ˜¯å…¨è‹±æ–‡çš„ï¼Œç”¨Unicodeç¼–ç æ¯”ASCIIç¼–ç éœ€è¦å¤šä¸€å€çš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨å­˜å‚¨å’Œä¼ è¾“ä¸Šå°±ååˆ†ä¸åˆ’ç®—ã€‚</p></blockquote></li><li><p><strong>UTF-8 :</strong>  æŠŠUnicodeç¼–ç è½¬åŒ–ä¸º â€œ<strong>å¯å˜é•¿ç¼–ç </strong>â€ UTF-8ç¼–ç ï¼ŒUTF-8ç¼–ç å°†Unicodeå­—ç¬¦æŒ‰æ•°å­—å¤§å°ç¼–ç ä¸º<strong>1-6</strong>ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—æ¯è¢«ç¼–ç æˆ<strong>1</strong>ä¸ªå­—èŠ‚ï¼Œå¸¸ç”¨æ±‰å­—è¢«ç¼–ç æˆ<strong>2</strong>ä¸ªå­—èŠ‚ã€‚</p></li></ul><h5 id="6-1-ä¸‰è€…åŒºåˆ«å’Œè”ç³»">6.1 ä¸‰è€…åŒºåˆ«å’Œè”ç³»</h5><ul><li><p>åœ¨<strong>è®¡ç®—æœºå†…å­˜</strong>ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨<strong>Unicode</strong>ç¼–ç  ï¼›</p></li><li><p>å½“éœ€è¦<strong>ä¿å­˜åˆ°ç¡¬ç›˜æˆ–è€…éœ€è¦ä¼ è¾“</strong>çš„æ—¶å€™ï¼Œå°±è½¬æ¢ä¸º<strong>UTF-8</strong>ç¼–ç </p></li></ul><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><blockquote><p>ä¾‹1 ï¼šè®°äº‹æœ¬ç¼–è¾‘ï¼ˆå†…å­˜ï¼‰â†’ä¿å­˜ï¼ˆç£ç›˜ï¼‰ã€‚</p></blockquote><p>ç”¨è®°äº‹æœ¬ç¼–è¾‘çš„æ—¶å€™ï¼Œä»æ–‡ä»¶è¯»å–çš„UTF-8å­—ç¬¦è¢«è½¬æ¢ä¸ºUnicodeå­—ç¬¦åˆ°å†…å­˜é‡Œï¼Œç¼–è¾‘å®Œæˆåï¼Œä¿å­˜çš„æ—¶å€™å†æŠŠUnicodeè½¬æ¢ä¸ºUTF-8ä¿å­˜åˆ°æ–‡ä»¶ã€‚</p><p><img src="https://i.loli.net/2021/06/11/9IjWniLHqrwRd2s.png" alt="image-20210611131935690"></p><blockquote><p>ä¾‹2ï¼šç½‘ç»œä¼ è¾“æœåŠ¡å™¨â†’æµè§ˆå™¨ã€‚</p></blockquote><p>æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šæŠŠåŠ¨æ€ç”Ÿæˆçš„Unicodeå†…å®¹è½¬æ¢ä¸ºUTF-8å†ä¼ è¾“åˆ°æµè§ˆå™¨ã€‚</p><p><img src="https://i.loli.net/2021/06/11/hZFaKbezvQEsxko.png" alt="image-20210611132058826"></p><h4 id="7-ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œï¼ŸåŒæ­¥å’Œå¼‚æ­¥ï¼Ÿ">7. ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œï¼ŸåŒæ­¥å’Œå¼‚æ­¥ï¼Ÿ</h4><ul><li><strong>å¹¶å‘å’Œå¹¶è¡Œ</strong><ul><li><strong>å¹¶å‘</strong>ï¼š æ˜¯æŒ‡å®è§‚ä¸Šåœ¨<strong>ä¸€æ®µæ—¶é—´</strong>å†…èƒ½åŒæ—¶è¿è¡Œå¤šä¸ª<strong>ç¨‹åº</strong>ï¼›</li><li><strong>å¹¶è¡Œ</strong> ï¼šåˆ™æŒ‡<strong>åŒä¸€æ—¶åˆ»</strong>èƒ½è¿è¡Œå¤šä¸ª<strong>æŒ‡ä»¤</strong>ã€‚</li></ul></li><li><strong>åŒæ­¥å’Œå¼‚æ­¥</strong><ul><li><p><strong>åŒæ­¥</strong>ï¼šå¯ä»¥ç†è§£ä¸ºåœ¨æ‰§è¡Œå®Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ä¹‹åï¼Œ<strong>ä¸€ç›´ç­‰å¾…ç³»ç»Ÿè¿”å›å€¼æˆ–æ¶ˆæ¯ï¼Œè¿™æ—¶ç¨‹åºæ˜¯å‡ºäºé˜»å¡çš„</strong>ï¼Œåªæœ‰æ¥æ”¶åˆ°è¿”å›çš„å€¼æˆ–æ¶ˆæ¯åæ‰å¾€ä¸‹æ‰§è¡Œå…¶ä»–çš„å‘½ä»¤ã€‚</p></li><li><p><strong>å¼‚æ­¥</strong>ï¼šæ‰§è¡Œå®Œå‡½æ•°æˆ–æ–¹æ³•åï¼Œ<strong>ä¸å¿…é˜»å¡æ€§åœ°ç­‰å¾…è¿”å›å€¼æˆ–æ¶ˆæ¯ï¼Œåªéœ€è¦å‘ç³»ç»Ÿå§”æ‰˜ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹</strong>ï¼Œé‚£ä¹ˆå½“ç³»ç»Ÿæ¥æ”¶åˆ°è¿”å›å€¼æˆ–æ¶ˆæ¯æ—¶ï¼Œç³»ç»Ÿä¼š<strong>è‡ªåŠ¨è§¦å‘å§”æ‰˜çš„å¼‚æ­¥è¿‡ç¨‹</strong>ï¼Œä»è€Œå®Œæˆä¸€ä¸ªå®Œæ•´çš„æµç¨‹ã€‚</p></li></ul></li></ul><h4 id="8-ä»€ä¹ˆæ˜¯å…±äº«ï¼Ÿ">8. ä»€ä¹ˆæ˜¯å…±äº«ï¼Ÿ</h4><ul><li><p><strong>å…±äº«å®šä¹‰</strong>ï¼š ç³»ç»Ÿä¸­çš„èµ„æºå¯ä»¥è¢«å¤šä¸ªå¹¶å‘è¿›ç¨‹å…±åŒä½¿ç”¨ ï¼›</p></li><li><p><strong>å…±äº«æ–¹å¼</strong>ï¼š<u>äº’æ–¥</u>å…±äº«å’Œ<u>åŒæ—¶</u>å…±äº«ï¼š</p><ul><li><strong>äº’æ–¥å…±äº«</strong>ï¼š åœ¨<strong>åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®</strong>ï¼Œéœ€è¦ç”¨åŒæ­¥æœºåˆ¶æ¥å®ç°äº’æ–¥è®¿é—® ï¼Œå¦‚ï¼šæ‰“å°æœºã€‚</li></ul></li></ul><h2 id="4-2-è¿›ç¨‹å’Œçº¿ç¨‹">4.2 è¿›ç¨‹å’Œçº¿ç¨‹</h2><h4 id="1-è¯·é—®64ä½å’Œ32ä½çš„åŒºåˆ«ï¼Ÿ">1.<strong>è¯·é—®64ä½å’Œ32ä½çš„åŒºåˆ«</strong>ï¼Ÿ</h4><ol><li><strong>è¿è¡Œèƒ½åŠ›ä¸åŒ</strong>ï¼š64ä½å¯ä»¥ä¸€æ¬¡æ€§å¯ä»¥å¤„ç†8ä¸ªå­—èŠ‚çš„æ•°æ®é‡ï¼Œè€Œ32ä½ä¸€æ¬¡æ€§åªå¯ä»¥å¤„ç†4ä¸ªå­—èŠ‚çš„æ•°æ®é‡ï¼Œå› æ­¤64ä½æ¯”32ä½çš„è¿è¡Œèƒ½åŠ›æé«˜äº†ä¸€å€ã€‚</li><li><strong>å†…å­˜å¯»å€ä¸åŒ</strong>ï¼š64ä½æœ€å¤§å¯»å€ç©ºé—´ä¸º2çš„64æ¬¡æ–¹ï¼Œç†è®ºå€¼ç›´æ¥è¾¾åˆ°äº†16TBï¼Œè€Œ32ä½çš„æœ€å¤§å¯»å€ç©ºé—´ä¸º2çš„32æ¬¡æ–¹ï¼Œä¸º4GBï¼Œæ¢è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯´32ä½ç³»ç»Ÿçš„å¤„ç†å™¨æœ€å¤§åªæ”¯æŒåˆ°4Gå†…å­˜ï¼Œè€Œ64ä½ç³»ç»Ÿæœ€å¤§æ”¯æŒçš„å†…å­˜é«˜è¾¾äº¿ä½æ•°ã€‚</li><li><strong>è¿è¡Œè½¯ä»¶ä¸åŒ</strong>ï¼šç”±äº32ä½å’Œ64ä½<u>CPUçš„æŒ‡ä»¤é›†æ˜¯ä¸åŒ</u>çš„ã€‚æ‰€ä»¥éœ€è¦åŒºåˆ†32ä½å’Œ64ä½ç‰ˆæœ¬çš„è½¯ä»¶ã€‚<br>ä¸ºäº†ä¿è¯å…¼å®¹æ€§ï¼Œ64ä½CPUä¸Šä¹Ÿèƒ½è¿è¡Œè€çš„32ä½æŒ‡ä»¤ï¼Œä½†åè¿‡æ¥32ä½ç³»ç»Ÿä¸å¯ä»¥è¿è¡Œ64ä½çš„è½¯ä»¶ã€‚</li></ol><h4 id="2-ä»‹ç»ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ">2.<strong>ä»‹ç»ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</strong></h4><ol><li><p><strong>æ ¹æœ¬åŒºåˆ«</strong>ï¼šè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿ<strong>èµ„æºåˆ†é…</strong>çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯å¤„ç†å™¨<strong>ä»»åŠ¡è°ƒåº¦</strong>å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½</p></li><li><p><strong>èµ„æºå¼€é”€ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ä»£ç å’Œæ•°æ®ç©ºé—´ï¼ˆç¨‹åºä¸Šä¸‹æ–‡ï¼‰</strong>ï¼Œç¨‹åºä¹‹é—´çš„åˆ‡æ¢ä¼šæœ‰è¾ƒå¤§çš„å¼€é”€ï¼›çº¿ç¨‹å¯ä»¥çœ‹åšè½»é‡çº§çš„è¿›ç¨‹ï¼ŒåŒä¸€ç±»çº¿ç¨‹å…±äº«ä»£ç å’Œæ•°æ®ç©ºé—´ï¼Œ<strong>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨</strong>ï¼ˆPCï¼‰ï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢çš„å¼€é”€å°</p></li><li><p><strong>åŒ…å«å…³ç³»</strong>ï¼šå¦‚æœä¸€ä¸ªè¿›ç¨‹å†…æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œåˆ™æ‰§è¡Œè¿‡ç¨‹ä¸æ˜¯ä¸€æ¡çº¿çš„ï¼Œè€Œæ˜¯å¤šæ¡çº¿ï¼ˆçº¿ç¨‹ï¼‰å…±åŒå®Œæˆçš„ï¼›çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥çº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»æƒè¿›ç¨‹æˆ–è€…è½»é‡çº§è¿›ç¨‹</p></li><li><p><strong>å†…å­˜åˆ†é…</strong>ï¼šåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹<strong>å…±äº«æœ¬è¿›ç¨‹çš„ã€åœ°å€ç©ºé—´å’Œèµ„æºã€‘</strong>ï¼Œè€Œè¿›ç¨‹ä¹‹é—´çš„åœ°å€ç©ºé—´å’Œèµ„æºæ˜¯ç›¸äº’ç‹¬ç«‹çš„</p></li><li><p><strong>å½±å“å…³ç³»</strong>ï¼šä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œ<strong>ä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹éƒ½æ­»æ‰</strong>ï¼Œ<strong>æ‰€ä»¥å¤šè¿›ç¨‹è¦æ¯”å¤šçº¿ç¨‹å¥å£®</strong>ã€‚</p><blockquote><p>çº¿ç¨‹æ²¡æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå¦‚æœå´©æºƒï¼Œä¼šå‘ä¿¡å·ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯å¤„ç†çš„handlerï¼ŒOSä¸€èˆ¬ç›´æ¥æ€æ­»è¿›ç¨‹ã€‚</p></blockquote></li><li><p><strong>èƒ½å¦ç‹¬ç«‹</strong>ï¼šæ¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æœ‰ç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºå‡ºå£ã€‚ä½†æ˜¯çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ï¼Œä¸¤è€…å‡å¯å¹¶å‘æ‰§è¡Œ</p></li></ol><h5 id="2-1-çº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ">2.1 çº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</h5><blockquote><p><strong>è¿›ç¨‹æ˜¯èµ„æºè°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ï¼Œ<strong>è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºä¼šåˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹</strong>ï¼Œè¿›ç¨‹å°±æ˜¯è¿è¡Œèµ·æ¥çš„å¯æ‰§è¡Œç¨‹åº ;</p><p><strong>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„åŸºæœ¬å•ä½</strong>ï¼Œæ˜¯è½»é‡çº§çš„è¿›ç¨‹ã€‚<strong>æ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æœ‰å”¯ä¸€çš„ä¸»çº¿ç¨‹ï¼Œå’Œå¤šä¸ªçº¿ç¨‹</strong>ï¼Œä¸”åªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸»çº¿ç¨‹å’Œè¿›ç¨‹æ˜¯ç›¸äº’ä¾å­˜çš„å…³ç³»ï¼Œä¸»çº¿ç¨‹ç»“æŸè¿›ç¨‹ä¹Ÿä¼šç»“æŸï¼›</p><p><strong>åç¨‹</strong>æ˜¯ç”¨æˆ·æ€çš„<strong>è½»é‡çº§çº¿ç¨‹</strong>ï¼Œ<strong>ä¹Ÿæ˜¯çº¿ç¨‹å†…éƒ¨è°ƒåº¦çš„åŸºæœ¬å•ä½</strong> ã€‚</p></blockquote><p>åç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«å¦‚ä¸‹ï¼ˆè¡¥å……äº†å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Œæ–¹ä¾¿å¯¹æ¯”ï¼‰ã€‚</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:left">è¿›ç¨‹</th><th style="text-align:left">çº¿ç¨‹</th><th>åç¨‹</th></tr></thead><tbody><tr><td style="text-align:left">å®šä¹‰</td><td style="text-align:left">èµ„æºåˆ†é…å’Œæ‹¥æœ‰çš„åŸºæœ¬å•ä½</td><td style="text-align:left">ç¨‹åºæ‰§è¡Œçš„åŸºæœ¬å•ä½</td><td>ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ï¼Œçº¿ç¨‹å†…éƒ¨è°ƒåº¦çš„åŸºæœ¬å•ä½</td></tr><tr><td style="text-align:left">åˆ‡æ¢æƒ…å†µ</td><td style="text-align:left">è¿›ç¨‹CPUç¯å¢ƒ(æ ˆã€å¯„å­˜å™¨ã€é¡µè¡¨å’Œæ–‡ä»¶å¥æŸ„ç­‰)çš„ä¿å­˜ä»¥åŠæ–°è°ƒåº¦çš„è¿›ç¨‹CPUç¯å¢ƒçš„è®¾ç½®</td><td style="text-align:left">ä¿å­˜å’Œè®¾ç½®ç¨‹åºè®¡æ•°å™¨ã€å°‘é‡å¯„å­˜å™¨å’Œæ ˆçš„å†…å®¹</td><td>å…ˆå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜ï¼Œç­‰åˆ‡æ¢å›æ¥çš„æ—¶å€™å†è¿›è¡Œæ¢å¤</td></tr><tr><td style="text-align:left">åˆ‡æ¢è€…</td><td style="text-align:left">æ“ä½œç³»ç»Ÿ</td><td style="text-align:left">æ“ä½œç³»ç»Ÿ</td><td>ç”¨æˆ·</td></tr><tr><td style="text-align:left">åˆ‡æ¢è¿‡ç¨‹</td><td style="text-align:left">ç”¨æˆ·æ€-&gt;å†…æ ¸æ€-&gt;ç”¨æˆ·æ€</td><td style="text-align:left">ç”¨æˆ·æ€-&gt;å†…æ ¸æ€-&gt;ç”¨æˆ·æ€</td><td>ç”¨æˆ·æ€(æ²¡æœ‰é™·å…¥å†…æ ¸)</td></tr><tr><td style="text-align:left">è°ƒç”¨æ ˆ</td><td style="text-align:left">å†…æ ¸æ ˆ</td><td style="text-align:left">å†…æ ¸æ ˆ</td><td>ç”¨æˆ·æ ˆ</td></tr><tr><td style="text-align:left">æ‹¥æœ‰èµ„æº</td><td style="text-align:left"><strong>CPUèµ„æºã€å†…å­˜èµ„æºã€æ–‡ä»¶èµ„æºå’Œå¥æŸ„ç­‰</strong></td><td style="text-align:left"><strong>ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ã€æ ˆå’ŒçŠ¶æ€å­—</strong></td><td><strong>æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆ</strong></td></tr><tr><td style="text-align:left">å¹¶å‘æ€§</td><td style="text-align:left">ä¸åŒè¿›ç¨‹ä¹‹é—´åˆ‡æ¢å®ç°å¹¶å‘ï¼Œå„è‡ªå æœ‰CPUå®ç°å¹¶è¡Œ</td><td style="text-align:left">ä¸€ä¸ªè¿›ç¨‹å†…éƒ¨çš„å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ</td><td>åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªåç¨‹ï¼Œè€Œå…¶ä»–åç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œé€‚åˆå¯¹ä»»åŠ¡è¿›è¡Œåˆ†æ—¶å¤„ç†</td></tr><tr><td style="text-align:left">ç³»ç»Ÿå¼€é”€</td><td style="text-align:left">åˆ‡æ¢è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œåˆ‡æ¢å†…æ ¸æ ˆå’Œç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼ŒCPUé«˜é€Ÿç¼“å­˜å¤±æ•ˆã€é¡µè¡¨åˆ‡æ¢ï¼Œå¼€é”€å¾ˆå¤§</td><td style="text-align:left">åˆ‡æ¢æ—¶åªéœ€ä¿å­˜å’Œè®¾ç½®å°‘é‡å¯„å­˜å™¨å†…å®¹ï¼Œå› æ­¤å¼€é”€å¾ˆå°</td><td>ç›´æ¥æ“ä½œæ ˆåˆ™åŸºæœ¬æ²¡æœ‰å†…æ ¸åˆ‡æ¢çš„å¼€é”€ï¼Œå¯ä»¥ä¸åŠ é”çš„è®¿é—®å…¨å±€å˜é‡ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡çš„åˆ‡æ¢éå¸¸å¿«</td></tr><tr><td style="text-align:left">é€šä¿¡æ–¹é¢</td><td style="text-align:left">è¿›ç¨‹é—´é€šä¿¡éœ€è¦å€ŸåŠ©æ“ä½œç³»ç»Ÿ</td><td style="text-align:left">çº¿ç¨‹é—´å¯ä»¥ç›´æ¥è¯»å†™è¿›ç¨‹æ•°æ®æ®µ(å¦‚å…¨å±€å˜é‡)æ¥è¿›è¡Œé€šä¿¡</td><td>å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—</td></tr></tbody></table><h5 id="2-2-ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œå’Œä»€ä¹ˆæœ‰å…³ï¼Ÿ">2.2 ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œå’Œä»€ä¹ˆæœ‰å…³ï¼Ÿ</h5><p>ä¸€ä¸ªè¿›ç¨‹å¯ç”¨è™šæ‹Ÿç©ºé—´æ˜¯ï¼ˆC++ï¼‰2Gï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œï¼ˆå‡è®¾ï¼‰<strong>çº¿ç¨‹çš„æ ˆçš„å¤§å°æ˜¯1MB</strong>ï¼ˆLinuxæ˜¯8kbï¼‰ï¼Œåˆ™ç†è®ºä¸Šæœ€å¤šåªèƒ½åˆ›å»º2048ä¸ªçº¿ç¨‹ã€‚å¦‚æœè¦åˆ›å»ºå¤šäº2048çš„è¯ï¼Œå¿…é¡»ä¿®æ”¹ç¼–è¯‘å™¨çš„è®¾ç½®ã€‚</p><h5 id="2-3-è¿›ç¨‹ä¹‹é—´çš„åŒæ­¥æ–¹å¼ï¼Ÿï¼ˆåŒºåˆ†é€šä¿¡æ–¹å¼ï¼‰">2.3 è¿›ç¨‹ä¹‹é—´çš„åŒæ­¥æ–¹å¼ï¼Ÿï¼ˆåŒºåˆ†é€šä¿¡æ–¹å¼ï¼‰</h5><ol><li><p><strong>ä¸´ç•ŒåŒº</strong>ã€‚ å¯¹ä¸´ç•Œèµ„æºè¿›è¡Œè®¿é—®çš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºã€‚</p><p>ä¸ºäº†äº’æ–¥è®¿é—®ä¸´ç•Œèµ„æºï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œéœ€è¦å…ˆè¿›è¡Œæ£€æŸ¥ã€‚</p></li><li><p><strong>åŒæ­¥å’Œäº’æ–¥</strong>ã€‚</p><ul><li>åŒæ­¥ï¼šå¤šä¸ªè¿›ç¨‹å› ä¸ºåˆä½œäº§ç”Ÿçš„ç›´æ¥åˆ¶çº¦å…³ç³»ï¼Œä½¿å¾—è¿›ç¨‹æœ‰ä¸€å®šçš„å…ˆåæ‰§è¡Œå…³ç³»ã€‚</li><li>äº’æ–¥ï¼šå¤šä¸ªè¿›ç¨‹åœ¨åŒä¸€æ—¶åˆ»<strong>åªæœ‰ä¸€ä¸ªè¿›ç¨‹</strong>èƒ½è¿›å…¥ä¸´ç•ŒåŒºã€‚</li></ul></li><li><p><strong>ä¿¡å·é‡</strong>ã€‚ å¸¸è§çš„ P å’Œ V æ“ä½œã€‚</p><ul><li>ç‰¹åˆ«çš„ï¼Œ<u>å¦‚æœä¿¡å·é‡çš„å–å€¼åªèƒ½ä¸º 0 æˆ–è€… 1</u>ï¼Œé‚£ä¹ˆå°±æˆä¸ºäº†<strong>äº’æ–¥é‡ï¼ˆMutexï¼‰</strong> ï¼Œ0 è¡¨ç¤ºä¸´ç•ŒåŒºå·²ç»åŠ é”ï¼Œ1 è¡¨ç¤ºä¸´ç•ŒåŒºè§£é”ã€‚</li></ul></li><li><p><strong>æ¡ä»¶å˜é‡</strong>ã€‚</p><blockquote><p>ä½¿ç”¨ä¿¡å·é‡æœºåˆ¶å®ç°çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜éœ€è¦å®¢æˆ·ç«¯ä»£ç åšå¾ˆå¤šæ§åˆ¶ï¼Œè€Œç®¡ç¨‹æŠŠæ§åˆ¶çš„ä»£ç ç‹¬ç«‹å‡ºæ¥ï¼Œä¸ä»…ä¸å®¹æ˜“å‡ºé”™ï¼Œä¹Ÿä½¿å¾—å®¢æˆ·ç«¯ä»£ç è°ƒç”¨æ›´å®¹æ˜“ã€‚</p></blockquote><p>ç®¡ç¨‹å¼•å…¥äº†<strong>æ¡ä»¶å˜é‡</strong> ä»¥åŠç›¸å…³çš„æ“ä½œï¼š<strong>wait()</strong> å’Œ <strong>signal()</strong> æ¥å®ç°åŒæ­¥æ“ä½œã€‚å¯¹æ¡ä»¶å˜é‡æ‰§è¡Œ wait() æ“ä½œä¼šå¯¼è‡´è°ƒç”¨è¿›ç¨‹é˜»å¡ï¼ŒæŠŠç®¡ç¨‹è®©å‡ºæ¥ç»™å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰ã€‚signal() æ“ä½œç”¨äºå”¤é†’è¢«é˜»å¡çš„è¿›ç¨‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®¡ç¨‹ï¼šè§£å†³ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…é—®é¢˜</span></span><br><span class="line">monitor ProducerConsumer</span><br><span class="line">    condition full, empty;</span><br><span class="line">    integer count := <span class="number">0</span>;</span><br><span class="line">    condition c;</span><br><span class="line"></span><br><span class="line">    <span class="function">procedure <span class="title">insert</span><span class="params">(item: integer)</span></span>;</span><br><span class="line">    begin</span><br><span class="line">        <span class="keyword">if</span> count = N then wait(full);</span><br><span class="line">        insert_item(item);</span><br><span class="line">        count := count + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> count = <span class="number">1</span> then signal(empty);</span><br><span class="line">    end;</span><br><span class="line"></span><br><span class="line">    function remove: integer;</span><br><span class="line">    begin</span><br><span class="line">        <span class="keyword">if</span> count = <span class="number">0</span> then wait(empty);</span><br><span class="line">        remove = remove_item;</span><br><span class="line">        count := count - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> count = N <span class="number">-1</span> then signal(full);</span><br><span class="line">    end;</span><br><span class="line">end monitor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…å®¢æˆ·ç«¯</span></span><br><span class="line">procedure producer</span><br><span class="line">begin</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    begin</span><br><span class="line">        item = produce_item;</span><br><span class="line">        ProducerConsumer.insert(item);</span><br><span class="line">    end</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…å®¢æˆ·ç«¯</span></span><br><span class="line">procedure consumer</span><br><span class="line">begin</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    begin</span><br><span class="line">        item = ProducerConsumer.remove;</span><br><span class="line">        consume_item(item);</span><br><span class="line">    end</span><br><span class="line">end;</span><br></pre></td></tr></table></figure></li></ol><h4 id="3-è¯·é—®ã€è¿›ç¨‹ã€‘ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿ">3.<strong>è¯·é—®ã€è¿›ç¨‹ã€‘ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡</strong>ï¼Ÿ</h4><p>å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p><ol><li>æœ¬åœ°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼</li><li>è¿œç¨‹è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼</li></ol><p><strong>1. æœ¬åœ°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼ï¼ˆæ²¡æœ‰åŒæ­¥äº’æ–¥ï¼ï¼</strong>ï¼‰</p><ul><li><p><strong>æ— åç®¡é“</strong> ï¼šåŠåŒå·¥é€šä¿¡æ–¹å¼ï¼Œ<strong>æ•°æ®(æ¶ˆæ¯)å•å‘æµåŠ¨</strong>ï¼Œåªèƒ½æ˜¯å­—èŠ‚æµæ ¼å¼çš„æ¶ˆæ¯ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•æ–¹ä¾¿</li><li><strong>ç¼ºç‚¹</strong>ï¼šå•å‘é€šä¿¡ã€åªèƒ½ç”¨äº<strong>å…·æœ‰äº²ç¼˜å…³ç³»ï¼ˆä¸€èˆ¬æŒ‡çˆ¶å­</strong>ï¼‰çš„è¿›ç¨‹ä¹‹é—´ã€<strong>ç¼“å†²åŒºæœ‰é™</strong></li></ul></li><li><p><strong>æœ‰åç®¡é“ï¼šåŠåŒå·¥é€šä¿¡</strong>æ–¹å¼ï¼Œæ•°æ®ä¹Ÿç§°ä¸ºå‘½åç®¡é“ï¼šæ˜¯ä¸€ç§æ–‡ä»¶ç±»å‹ï¼Œä»¥ä¸€ç§ç‰¹æ®Šè®¾å¤‡æ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥å®ç°<strong>ä»»æ„å…³ç³»çš„è¿›ç¨‹</strong>é—´çš„é€šä¿¡ï¼ˆæ— æ³•åŒæ­¥ï¼‰</li><li><strong>ç¼ºç‚¹</strong>ï¼š é•¿æœŸå­˜äºç³»ç»Ÿä¸­ï¼Œä½¿ç”¨ä¸å½“å®¹æ˜“å‡ºé”™ã€<strong>ç¼“å†²åŒºæœ‰é™</strong></li></ul></li><li><p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„<strong>é“¾è¡¨</strong>,å­˜æ”¾åœ¨å†…æ ¸ä¸­å¹¶ç”±æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦æ ‡è¯†ã€‚æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·ä¼ é€’ä¿¡æ¯å°‘,ç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç‰¹ç‚¹ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<u>å¯ä»¥å®ç°ä»»æ„è¿›ç¨‹é—´çš„é€šä¿¡</u>ï¼Œå¹¶é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‡½æ•°æ¥å®ç°æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ä¹‹é—´çš„åŒæ­¥<u>ï¼Œæ— éœ€è€ƒè™‘åŒæ­¥</u>é—®é¢˜</li><li><strong>ç¼ºç‚¹</strong>ï¼šä¿¡æ¯çš„å¤åˆ¶éœ€è¦<u>é¢å¤–æ¶ˆè€—CPUçš„æ—¶é—´</u>ï¼Œä¸é€‚å®œäºä¿¡æ¯é‡å¤§æˆ–æ“ä½œé¢‘ç¹çš„åœºåˆ</li></ul></li><li><p><strong>å…±äº«å†…å­˜</strong></p><p>ç›´æ¥å¯¹å†…å­˜å­˜å–ï¼Œ<u>é€šä¿¡å¿«</u>ï¼Œä½†æ˜¯å¤šä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶æ“ä½œï¼Œ<u>éœ€è¦ç”¨ä¿¡å·é‡è¿›è¡ŒåŒæ­¥</u>ã€‚</p></li><li><p><strong>ä¿¡å·é‡</strong></p><p>ä¿¡å·æ˜¯ä¸€ç§æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºé€šçŸ¥æ¥æ”¶è¿›ç¨‹æŸä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿã€‚</p><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥åŒæ­¥è¿›ç¨‹ï¼›</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šä¿¡å·é‡æœ‰é™</p><blockquote><p>æ³¨è§£ï¼šPæ“ä½œå°±æ˜¯å¯¹Så‡ä¸€ï¼ŒVæ“ä½œå°±æ˜¯å¯¹SåŠ ä¸€</p></blockquote><ul><li><strong>åŒæ­¥</strong>ï¼šS = 0ï¼Œè¿›ç¨‹Aæ‰§è¡Œå®Œè¿›è¡ŒVæ“ä½œï¼Œè¿›ç¨‹Bæ‰§è¡Œå‰æ‰§è¡ŒPæ“ä½œï¼Œè¿™æ ·Bå°±å¯ä»¥ç­‰Aæ‰§è¡Œå®Œå†æ‰§è¡Œï¼›</li><li><strong>äº’æ–¥</strong>ï¼šS = 1ï¼Œè¿›ç¨‹æ‰§è¡Œå‰è¿›è¡ŒPæ“ä½œï¼Œæ‰§è¡Œåè¿›è¡ŒVæ“ä½œã€‚</li></ul></li></ul></li></ul><p><strong>2.è¿œç¨‹è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼</strong></p><p>é¦–è¦è§£å†³çš„é—®é¢˜æ˜¯å¦‚ä½•å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ï¼Ÿæœ¬åœ°ä¸Šé‡‡ç”¨PIDå³å¯ï¼Œä½†æ˜¯ç½‘ç»œä¸­ <u>TCP/IPäº”å±‚ç½‘ç»œæ¨¡å‹ä¸­ä¼ è¾“å±‚çš„ â€œ<strong>å¥—æ¥å­—ï¼šIP+ç«¯å£</strong>â€</u></p><ul><li><p><strong>å¥—æ¥å­—äº¤äº’</strong></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š1ï¼‰ä¼ è¾“æ•°æ®ä¸ºå­—èŠ‚çº§ï¼Œä¼ è¾“æ•°æ®å¯è‡ªå®šä¹‰ï¼Œæ•°æ®é‡å°æ•ˆç‡é«˜ï¼›2ï¼‰ä¼ è¾“æ•°æ®æ—¶é—´çŸ­ï¼Œæ€§èƒ½é«˜ï¼›3) é€‚åˆäºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´ä¿¡æ¯å®æ—¶äº¤äº’ï¼›4) å¯ä»¥åŠ å¯†,æ•°æ®å®‰å…¨æ€§å¼º</li><li><strong>ç¼ºç‚¹</strong>ï¼š1) éœ€å¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡Œè§£æï¼Œè½¬åŒ–æˆåº”ç”¨çº§çš„æ•°æ®ã€‚</li></ul></li><li><p><strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰</strong></p></li></ul><h4 id="4-è¯·é—®ã€çº¿ç¨‹ã€‘é—´åŒæ­¥æ–¹å¼ï¼ˆé€šä¿¡æ–¹å¼ï¼‰ï¼Ÿ">4. è¯·é—®ã€çº¿ç¨‹ã€‘é—´åŒæ­¥æ–¹å¼ï¼ˆé€šä¿¡æ–¹å¼ï¼‰ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/06/11/38AqLbJEZnhSPC9.png" alt="image-20210611000107784"></p><p>ã€<strong>1. Linuxä¸‹çº¿ç¨‹é€šçŸ¥æ–¹å¼</strong>ã€‘</p><ol><li><strong>äº’æ–¥é‡(Mutex)</strong>ï¼šé‡‡ç”¨äº’æ–¥å¯¹è±¡æœºåˆ¶ï¼Œåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®å…¬å…±èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰â¼€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å…¬å…±èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚<ul><li>â½å¦‚ Java ä¸­çš„<strong>synchronized å…³é”®è¯å’Œå„ç§ Locké”</strong> éƒ½æ˜¯è¿™ç§æœºåˆ¶ã€‚</li></ul></li><li><strong>ä¿¡å·é‡(Semphares)</strong> ï¼šå®ƒå…è®¸åŒâ¼€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è®¿é—®åŒâ¼€èµ„æºï¼Œä½†æ˜¯éœ€è¦æ§åˆ¶åŒâ¼€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡</li><li><strong>æ¡ä»¶å˜é‡</strong> : é€šè¿‡é€šçŸ¥æ“ä½œçš„æ–¹å¼æ¥ä¿æŒå¤šçº¿ç¨‹åŒæ­¥ï¼Œè¿˜å¯ä»¥æ–¹ä¾¿çš„å®ç°å¤šçº¿ç¨‹ä¼˜å…ˆçº§<ul><li>æ¯”å¦‚Wait/Notify</li></ul></li></ol><p>ã€<strong>2. Windowsä¸‹çº¿ç¨‹é€šçŸ¥æ–¹å¼</strong>ã€‘</p><ol><li><strong>å…¨å±€å˜é‡</strong>ï¼šéœ€è¦æœ‰å¤šä¸ªçº¿ç¨‹æ¥è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡æ—¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåœ¨è¿™ä¸ªå…¨å±€å˜é‡å‰åŠ ä¸Švolatileå£°æ˜ï¼Œä»¥é˜²ç¼–è¯‘å™¨å¯¹æ­¤å˜é‡è¿›è¡Œä¼˜åŒ– ï¼›</li><li><strong>CEventå¯¹è±¡</strong>ï¼šCEventä¸ºMFCä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¯¹CEventçš„è§¦å‘çŠ¶æ€è¿›è¡Œæ”¹å˜ï¼Œä»è€Œå®ç°çº¿ç¨‹é—´çš„é€šä¿¡å’ŒåŒæ­¥ï¼Œè¿™ä¸ªä¸»è¦æ˜¯å®ç°çº¿ç¨‹ç›´æ¥åŒæ­¥çš„ä¸€ç§æ–¹æ³•ï¼›</li><li><strong>Messageæ¶ˆæ¯æœºåˆ¶</strong>ï¼šå¸¸ç”¨çš„Messageé€šä¿¡çš„æ¥å£ä¸»è¦æœ‰ä¸¤ä¸ªï¼šPostMessageå’ŒPostThreadMessageï¼ŒPostMessageä¸ºçº¿ç¨‹å‘ä¸»çª—å£å‘é€æ¶ˆæ¯ã€‚è€ŒPostThreadMessageæ˜¯ä»»æ„ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ¥å£ã€‚</li></ol><h4 id="5-ä»€ä¹ˆæ—¶å€™ç”¨å¤šçº¿ç¨‹-å¤šè¿›ç¨‹ï¼Ÿ">5.<strong>ä»€ä¹ˆæ—¶å€™ç”¨å¤šçº¿ç¨‹ / å¤šè¿›ç¨‹</strong>ï¼Ÿ</h4><ul><li><strong>éœ€è¦<u>é¢‘ç¹åˆ›å»ºé”€æ¯</u>çš„ä¼˜å…ˆç”¨çº¿ç¨‹</strong> ï¼šåˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜¯å¾ˆéš¾æ‰¿å—çš„ ï¼›</li><li><strong>éœ€è¦è¿›è¡Œ<u>å¤§é‡è®¡ç®—</u>çš„ä¼˜å…ˆä½¿ç”¨çº¿ç¨‹</strong> ï¼šæ­¤æ—¶<strong>è€—è´¹å¾ˆå¤šCPUï¼Œåˆ‡æ¢é¢‘ç¹</strong>ï¼Œç”¨çº¿ç¨‹æ›´è½»é‡ï¼›</li><li><strong>ä»»åŠ¡é—´ç›¸å…³æ€§æ¯”è¾ƒå¼ºçš„ç”¨å¤šçº¿ç¨‹</strong>ï¼Œç›¸å…³æ€§æ¯”è¾ƒå¼±çš„ç”¨å¤šè¿›ç¨‹ã€‚å› ä¸ºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®å…±äº«å’ŒåŒæ­¥æ¯”è¾ƒç®€å•ï¼›</li></ul><p>è€ƒè™‘å¤šè¿›ç¨‹ï¼š</p><ul><li>æ‰©å±•åˆ°<strong>å¤šæœºåˆ†å¸ƒ</strong>çš„ç”¨<strong>å¤šè¿›ç¨‹</strong>ï¼Œå¤šæ ¸åˆ†å¸ƒçš„ç”¨<strong>å¤šçº¿ç¨‹</strong> ï¼›</li><li>å…¶å®ƒä¸€èˆ¬ç”¨å¤šçº¿ç¨‹æ¯”è¾ƒå¥½</li></ul><h4 id="6-ã€çº¿ç¨‹ã€‘è°ƒåº¦ç®—æ³•ï¼Ÿ">6.<strong>ã€çº¿ç¨‹ã€‘è°ƒåº¦ç®—æ³•ï¼Ÿ</strong></h4><p>åœ¨èµ„æºä¸€å®šçš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦ç®—æ³•éœ€è¦åœ¨<strong>ååé‡ï¼ˆThroughputï¼‰ã€å¹³å‡å“åº”æ—¶é—´ï¼ˆå»¶è¿Ÿï¼ŒAverage Response Timeï¼‰ã€å…¬å¹³æ€§ã€è°ƒåº¦å¼•èµ·çš„é¢å¤–å¼€é”€ï¼ˆoverhead</strong>ï¼‰ç­‰å‡ ä¸ªæ–¹é¢åšæƒè¡¡ã€‚</p><ol><li><p><strong>å…ˆè¿›å…ˆå‡ºç®—æ³•ï¼ˆFIFOï¼ŒFirst-In-First-Outï¼‰</strong></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li><strong>æœ€å°‘çš„ä»»åŠ¡åˆ‡æ¢å¼€é”€</strong>ï¼ˆå› ä¸ºæ²¡æœ‰åœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿåˆ‡æ¢ï¼Œæ•…ä»»åŠ¡åˆ‡æ¢å¼€é”€ä¸º0ï¼‰</li><li><strong>æœ€å¤§çš„ååé‡</strong>ï¼ˆå› æ²¡æœ‰ä»»åŠ¡åˆ‡æ¢å¼€é”€ï¼Œåœ¨å…¶ä»–ä¸€å®šçš„æƒ…å†µä¸‹ï¼Œååé‡è‚¯å®šæ˜¯æœ€å¤§çš„ï¼‰</li><li><strong>æœ€æœ´å®çš„å…¬å¹³æ€§</strong>ï¼ˆå…ˆæ¥å…ˆåšï¼‰</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>å¹³å‡å“åº”æ—¶é—´é«˜</strong>ï¼šè€—æ—¶åªéœ€10æ¯«ç§’çš„ä»»åŠ¡è‹¥æ°å·§åœ¨è€—æ—¶1000æ¯«ç§’çš„ä»»åŠ¡ååˆ°æ¥ï¼Œä»–åˆ™éœ€è¦1010æ¯«ç§’æ‰èƒ½æ‰§è¡Œå®Œæˆï¼Œç»å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨ç­‰å¾…è¢«è°ƒåº¦ã€‚</li></ul></li></ul></li><li><p><strong>æœ€çŸ­è€—æ—¶ä»»åŠ¡ä¼˜å…ˆç®—æ³•</strong></p><p>ä¼˜å…ˆè°ƒåº¦è€—æ—¶çŸ­çš„ä»»åŠ¡ï¼Œéœ€è¦é¢„å…ˆçŸ¥é“æ¯ä¸ªä»»åŠ¡çš„è€—æ—¶æƒ…å†µï¼Œè¿™åœ¨å®é™…æƒ…å†µä¸­æ˜¯ä¸å¤§ç°å®çš„ã€‚</p><ul><li>ï¼ˆ<strong>ä¼˜ç‚¹</strong>ï¼‰<strong>å¹³å‡å“åº”æ—¶é—´è¾ƒä½</strong>ï¼šè¿™é‡Œæœ‰ä¸€ç‚¹ï¼Œå› ä¸ºå°†æ—¶é—´é•¿çš„ä»»åŠ¡æ— é™å¾€åæ¨ç§»ï¼Œå®é™…è®¡ç®—çš„å¹³å‡å“åº”æ—¶é—´çš„ä»»åŠ¡éƒ½æ˜¯æ‰§è¡Œè¾ƒå¿«çš„ä»»åŠ¡ï¼Œç»Ÿè®¡å‡ºæ¥çš„å¹³å‡å“åº”æ—¶é—´å¿…ç„¶è¾ƒä½çš„ã€‚</li><li><strong>ï¼ˆç¼ºç‚¹</strong>ï¼‰<strong>è€—æ—¶é•¿ä»»åŠ¡é¥¥é¥¿</strong>ï¼šè€—æ—¶é•¿çš„ä»»åŠ¡è¿Ÿè¿Ÿå¾—ä¸åˆ°è°ƒåº¦ï¼Œä¸å…¬å¹³ï¼Œå®¹æ˜“å½¢æˆé¥¥é¥¿ ã€‚</li><li><strong>ï¼ˆç¼ºç‚¹</strong>ï¼‰<strong>å¼€é”€å¤§</strong>ï¼š<u>é¢‘ç¹çš„ä»»åŠ¡åˆ‡æ¢</u>ï¼Œè°ƒåº¦çš„é¢å¤–å¼€é”€å¤§ã€‚</li></ul></li><li><p><strong>æ—¶é—´ç‰‡è½®è½¬ç®—æ³•</strong></p><p>ç»™é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªä»»åŠ¡ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œç¬¬ä¸€ä¸ªä»»åŠ¡å…ˆæ‰§è¡Œï¼Œæ—¶é—´ç‰‡åˆ°äº†ä¹‹åï¼Œå°†æ­¤ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œ<u>è§£å†³æœ€çŸ­è€—æ—¶ä»»åŠ¡ä¼˜å…ˆç®—æ³•ä¸­è€—æ—¶é•¿ä»»åŠ¡é¥¥é¥¿çš„é—®é¢˜</u> ã€‚</p><ul><li><strong>ï¼ˆç‰¹ç‚¹ï¼‰æ—¶é—´ç‰‡è®¾ç½®é—®é¢˜</strong>ï¼š ç®—æ³•ä»‹äºFIFOå’ŒSJFä¹‹é—´ï¼Œè‹¥æ—¶é—´ç‰‡è¶³å¤Ÿ<strong>å¤§</strong>ï¼Œåˆ™é€€åŒ–åˆ°FIFO ï¼›è‹¥åˆ†ç‰‡è¶³å¤Ÿå°ï¼ˆå‡è®¾ä¸è€ƒè™‘ä»»åŠ¡åˆ‡æ¢çš„å¼€é”€ï¼‰ï¼Œåˆ™ä»»åŠ¡çš„å®Œæˆæ—¶é—´é¡ºåºæ˜¯ä»¥è€—æ—¶ä»å°åˆ°å¤§æ’åˆ—ã€‚</li><li>ï¼ˆ<strong>ä¼˜ç‚¹ï¼‰å…¬å¹³è°ƒåº¦</strong>ï¼šæ¯ä¸ªä»»åŠ¡éƒ½èƒ½å¤Ÿå¾—åˆ°å…¬å¹³çš„è°ƒåº¦<ul><li>ï¼ˆ<strong>ä¼˜ç‚¹ï¼‰ä¸ä¼šé¥¥é¥¿</strong>ï¼šè€—æ—¶çŸ­çš„ä»»åŠ¡å³ä½¿è½åœ¨è€—æ—¶é•¿çš„ä»»åŠ¡åé¢ï¼Œä¹Ÿèƒ½å¤Ÿè¾ƒå¿«çš„å¾—åˆ°è°ƒåº¦æ‰§è¡Œ</li></ul></li><li><strong>ï¼ˆç¼ºç‚¹ï¼‰å¼€é”€å¤§</strong>ï¼š<u>ä»»åŠ¡åˆ‡æ¢å¼•èµ·çš„è°ƒåº¦å¼€é”€è¾ƒå¤§</u>ï¼Œéœ€è¦å¤šæ¬¡åˆ‡æ¢ä»»åŠ¡ä¸Šä¸‹æ–‡<ul><li><strong>ï¼ˆç¼ºç‚¹</strong>ï¼‰æ—¶é—´ç‰‡ä¸å¤ªå¥½è®¾ç½®</li></ul></li></ul></li><li><p><strong>æœ€å¤§æœ€å°å…¬å¹³ç®—æ³•</strong></p></li></ol><h4 id="7-ã€è¿›ç¨‹ã€‘è°ƒåº¦ç®—æ³•ï¼Ÿ">7.<strong>ã€è¿›ç¨‹ã€‘è°ƒåº¦ç®—æ³•ï¼Ÿ</strong></h4><ul><li>å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•</li><li>çŸ­ä½œä¸š(è¿›ç¨‹)ä¼˜å…ˆè°ƒåº¦ç®—æ³•</li><li>æ—¶é—´ç‰‡è½®è½¬æ³•</li><li><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong></li><li>ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•</li></ul><h4 id="8-CPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿæœ‰ä»€ä¹ˆç±»å‹ï¼Ÿçº¿ç¨‹å‘ç”Ÿåœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ">8. <strong>CPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿæœ‰ä»€ä¹ˆç±»å‹ï¼Ÿçº¿ç¨‹å‘ç”Ÿåœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ</strong></h4><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/52845869">https://zhuanlan.zhihu.com/p/52845869</a></p></blockquote><ul><li><p><strong>ä»€ä¹ˆæ˜¯ CPU ä¸Šä¸‹æ–‡</strong> ï¼Ÿ</p><p><u>CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨</u> å°±æ˜¯ CPU ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ CPU åœ¨è¿è¡Œä»»ä½•ä»»åŠ¡å‰ï¼Œ<strong>å¿…é¡»çš„ä¾èµ–ç¯å¢ƒ</strong>ã€‚</p><blockquote><ul><li><u>CPU å¯„å­˜å™¨</u> æ˜¯ CPU å†…ç½®çš„å®¹é‡å°ã€ä½†é€Ÿåº¦æå¿«çš„å†…å­˜ã€‚</li></ul></blockquote></li><li><p><strong>ä»€ä¹ˆæ˜¯ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢?</strong></p><p>é€šå¸¸æŒ‡ä»¥ä¸‹è¿‡ç¨‹ï¼š</p><ol><li>å‰ä¸€ä¸ªä»»åŠ¡çš„ CPU ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯ <strong>CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨</strong>ï¼‰ä¿å­˜èµ·æ¥;</li><li>ç„¶ååŠ è½½æ–°ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ°è¿™äº›å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨;</li><li>æœ€åå†è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®ï¼Œè¿è¡Œæ–°ä»»åŠ¡ã€‚</li></ol></li><li><p><strong>CPU ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç±»å‹</strong>ï¼Ÿ</p><p>æ ¹æ®ä»»åŠ¡çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»å‹ : <strong>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ - çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ - ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢</strong> ã€‚</p><ol><li><p><strong>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></p><p>è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ—¶ï¼Œè¢«ç§°ä¸ºè¿›ç¨‹çš„ç”¨æˆ·æ€ï¼Œè€Œé™·å…¥å†…æ ¸ç©ºé—´çš„æ—¶å€™ï¼Œè¢«ç§°ä¸ºè¿›ç¨‹çš„å†…æ ¸æ€ã€‚</p><blockquote><ul><li><p>å†…æ ¸ç©ºé—´ï¼ˆRing 0ï¼‰å…·æœ‰æœ€é«˜æƒé™ï¼Œå¯ä»¥ç›´æ¥è®¿é—®æ‰€æœ‰èµ„æºï¼›</p></li><li><p>ç”¨æˆ·ç©ºé—´ï¼ˆRing 3ï¼‰åªèƒ½è®¿é—®å—é™èµ„æºï¼Œä¸èƒ½ç›´æ¥è®¿é—®å†…å­˜ç­‰ç¡¬ä»¶è®¾å¤‡ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨é™·å…¥åˆ°å†…æ ¸ä¸­ï¼Œæ‰èƒ½è®¿é—®è¿™äº›ç‰¹æƒèµ„æºã€‚</p></li></ul></blockquote><p>ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬å˜ï¼Œéœ€è¦é€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>æ¥å®Œæˆï¼Œåœ¨<u>è¿™ä¸ªè¿‡ç¨‹ä¸­å°±å‘ç”Ÿäº† <strong>CPU</strong> ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆ<strong>ä¸¤</strong>æ¬¡ï¼Œç”¨æˆ·æ€-å†…æ ¸æ€-ç”¨æˆ·æ€ï¼‰ï¼‰</u>ã€‚</p><blockquote><p><strong>ç³»ç»Ÿè°ƒç”¨</strong> : æŸ¥çœ‹æ–‡ä»¶æ—¶read()ã€wirte() æ“ä½œå°±å‘ç”Ÿäº†ç³»ç»Ÿè°ƒç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œ<strong>å¹¶ä¸ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿå†…å­˜ç­‰è¿›ç¨‹ç”¨æˆ·æ€çš„èµ„æºï¼Œä¹Ÿä¸ä¼šåˆ‡æ¢è¿›ç¨‹</strong>ã€‚</p></blockquote><p><img src="https://pic3.zhimg.com/80/v2-440bb1699b2fa0f0340b38eabcbd7452_720w.jpg" alt="img"></p><p>è€Œ<u><strong>è¿›ç¨‹</strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</u> ï¼Œæ¯”ç³»ç»Ÿè°ƒç”¨æ—¶å¤šäº†ä¸€æ­¥ï¼šåœ¨<strong>ä¿å­˜å†…æ ¸æ€èµ„æº</strong>ï¼ˆå½“å‰è¿›ç¨‹çš„<u>å†…æ ¸çŠ¶æ€å’Œ CPU å¯„å­˜å™¨</u>ï¼‰ä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠè¯¥è¿›ç¨‹çš„<strong>ç”¨æˆ·æ€èµ„æº</strong>ï¼ˆ<u>è™šæ‹Ÿå†…å­˜ã€æ ˆç­‰</u>ï¼‰ä¿å­˜ä¸‹æ¥ã€‚</p></li><li><p><strong>çº¿ç¨‹ä¸Šä¸‹æ–‡è°ƒç”¨</strong></p><p>çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½ã€‚</p><p>ã€é¢è¯•é«˜é¢‘ã€‘å‘ç”Ÿçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åœºæ™¯</p><ul><li><strong>å‰åä¸¤ä¸ªçº¿ç¨‹å±äºä¸åŒè¿›ç¨‹</strong>ã€‚æ­¤æ—¶ï¼Œå› ä¸ºèµ„æºä¸å…±äº«ï¼Œæ‰€ä»¥åˆ‡æ¢è¿‡ç¨‹å°±è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¸€æ ·ã€‚</li><li><strong>å‰åä¸¤ä¸ªçº¿ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹</strong>ã€‚æ­¤æ—¶ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨åˆ‡æ¢æ—¶ï¼Œ<u>è™šæ‹Ÿå†…å­˜</u>è¿™äº›èµ„æºå°±ä¿æŒä¸åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢<strong>çº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼ˆæ ˆã€å¯„å­˜å™¨ç­‰</strong>)ä¸å…±äº«çš„æ•°æ®</li></ul></li><li><p><strong>ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></p></li></ol></li></ul><h4 id="9-å¦‚ä½•æ€æ­»ä¸€ä¸ªè¿›ç¨‹ï¼Ÿè¿›ç¨‹ç»ˆæ­¢çš„æ–¹å¼ï¼Ÿ">9.<strong>å¦‚ä½•æ€æ­»ä¸€ä¸ªè¿›ç¨‹</strong>ï¼Ÿè¿›ç¨‹ç»ˆæ­¢çš„æ–¹å¼ï¼Ÿ</h4><ol><li>linuxå‘½ä»¤ï¼š<code>kill -9 &lt;pid&gt;</code></li><li>æ¥å—èƒ½å¯¼è‡´è¿›ç¨‹ç»ˆæ­¢çš„ä¿¡å·ï¼šctrl+c (^C)ã€SIGINT(SIGINTä¸­æ–­è¿›ç¨‹)</li><li>mainå‡½æ•°çš„è‡ªç„¶è¿”å›ï¼Œ<code>return</code></li><li>è°ƒç”¨<code>exit</code>å‡½æ•°ï¼Œå±äºcçš„å‡½æ•°åº“ 3ã€è°ƒç”¨<code>_exit</code>å‡½æ•°ï¼Œå±äºç³»ç»Ÿè°ƒç”¨</li><li>è°ƒç”¨<code>abort</code>å‡½æ•°ï¼Œå¼‚å¸¸ç¨‹åºç»ˆæ­¢ï¼ŒåŒæ—¶å‘é€SIGABRTä¿¡å·ç»™è°ƒç”¨è¿›ç¨‹</li></ol><h5 id="9-1-ç»ˆç«¯é€€å‡ºï¼Œç»ˆç«¯è¿è¡Œçš„è¿›ç¨‹ä¼šæ€ä¹ˆæ ·ï¼Ÿ">9.1 ç»ˆç«¯é€€å‡ºï¼Œç»ˆç«¯è¿è¡Œçš„è¿›ç¨‹ä¼šæ€ä¹ˆæ ·ï¼Ÿ</h5><ol><li><p>ç»ˆç«¯åœ¨é€€å‡ºæ—¶ä¼šå‘é€<code>SIGHUP</code>ç»™å¯¹åº”çš„bashè¿›ç¨‹ï¼Œ</p></li><li><p>bashè¿›ç¨‹æ”¶åˆ°è¿™ä¸ªä¿¡å·åé¦–å…ˆå°†å®ƒå‘ç»™sessionä¸‹é¢çš„è¿›ç¨‹</p><blockquote><p>ä¸€ä¸ªsessionå°±æ˜¯ä¸€ä¸ªshellç»ˆç«¯ä¼šè¯çª—å£ã€‚</p></blockquote></li><li><p>å¦‚æœç¨‹åºæ²¡æœ‰å¯¹SIGHUPä¿¡å·åšç‰¹æ®Šå¤„ç†ï¼Œé‚£ä¹ˆè¿›ç¨‹å°±ä¼šéšç€ç»ˆç«¯å…³é—­è€Œé€€å‡º</p></li></ol><h5 id="9-2-æ€ä¹ˆè®©è¿›ç¨‹åå°è¿è¡Œï¼Ÿ">9.2 æ€ä¹ˆè®©è¿›ç¨‹åå°è¿è¡Œï¼Ÿ</h5><ol><li><code>å‘½ä»¤ + &amp;</code> å³å¯ï¼Œå®é™…ä¸Šï¼Œè¿™æ ·æ˜¯å°†å‘½ä»¤æ”¾å…¥åˆ°ä¸€ä¸ªä½œä¸šé˜Ÿåˆ—ä¸­äº†</li><li><code>ctrl + z</code> æŒ‚èµ·è¿›ç¨‹ï¼Œä½¿ç”¨jobsæŸ¥çœ‹åºå·ï¼Œåœ¨ä½¿ç”¨bg %åºå·åå°è¿è¡Œè¿›ç¨‹</li><li><code>nohup + &amp;</code>ï¼Œå°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ç¼ºçœä¼šè¢«é‡å®šå‘åˆ° nohup.out æ–‡ä»¶ä¸­ï¼Œå¿½ç•¥æ‰€æœ‰æŒ‚æ–­ï¼ˆSIGHUPï¼‰ä¿¡å·</li><li><code>setsid + å‘½ä»¤</code>ï¼Œä½¿å…¶çˆ¶è¿›ç¨‹ç¼–ç¨‹initè¿›ç¨‹ï¼Œä¸å—HUPä¿¡å·çš„å½±å“</li><li>å°†<code>å‘½ä»¤+ &amp;</code>æ”¾åœ¨()æ‹¬å·ä¸­ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿›ç¨‹ä¸å—HUPä¿¡å·çš„å½±å“</li></ol><h4 id="10-å¤–ä¸­æ–­å’Œå¼‚å¸¸çš„åŒºåˆ«ï¼Ÿ">10. å¤–ä¸­æ–­å’Œå¼‚å¸¸çš„åŒºåˆ«ï¼Ÿ</h4><ul><li><p><strong>å¤–ä¸­æ–­æ˜¯æŒ‡ç”± CPU æ‰§è¡ŒæŒ‡ä»¤ä»¥å¤–çš„äº‹ä»¶å¼•èµ·</strong>ï¼Œå¦‚ I/O å®Œæˆä¸­æ–­ï¼Œè¡¨ç¤ºè®¾å¤‡è¾“å…¥/è¾“å‡ºå¤„ç†å·²ç»å®Œæˆï¼Œå¤„ç†å™¨èƒ½å¤Ÿå‘é€ä¸‹ä¸€ä¸ªè¾“å…¥/è¾“å‡ºè¯·æ±‚ã€‚æ­¤å¤–è¿˜æœ‰æ—¶é’Ÿä¸­æ–­ã€æ§åˆ¶å°ä¸­æ–­ç­‰ã€‚</p></li><li><p><strong>å¼‚å¸¸æ—¶ç”± CPU æ‰§è¡ŒæŒ‡ä»¤çš„å†…éƒ¨äº‹ä»¶å¼•èµ·</strong>ï¼Œå¦‚éæ³•æ“ä½œç ã€åœ°å€è¶Šç•Œã€ç®—æœ¯æº¢å‡ºç­‰ã€‚</p></li></ul><h4 id="11-ä»€ä¹ˆæ˜¯çˆ¶è¿›ç¨‹ã€å­è¿›ç¨‹ã€è¿›ç¨‹ç»„ã€ä½œä¸šå’Œä¼šè¯ï¼Ÿ">11. ä»€ä¹ˆæ˜¯çˆ¶è¿›ç¨‹ã€å­è¿›ç¨‹ã€è¿›ç¨‹ç»„ã€ä½œä¸šå’Œä¼šè¯ï¼Ÿ</h4><ul><li><p><strong>çˆ¶è¿›ç¨‹</strong>ï¼š å·²åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹çš„è¿›ç¨‹ ï¼›</p></li><li><p><strong>å­è¿›ç¨‹</strong>ï¼š ç”±<strong>fork</strong>åˆ›å»ºçš„æ–°è¿›ç¨‹è¢«ç§°ä¸ºå­è¿›ç¨‹ï¼ˆchild processï¼‰ï¼Œå‡½æ•°è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä½†è¿”å›ä¸¤æ¬¡ï¼›</p><p>forkä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼š<strong>å¤åˆ¶ä¸€ä¸ªä¸çˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹</strong>ï¼Œè™½è¯´æ˜¯çˆ¶å­å…³ç³»ï¼Œä½†æ˜¯åœ¨æ“ä½œç³»ç»Ÿçœ‹æ¥ï¼Œä»–ä»¬æ›´åƒå…„å¼Ÿå…³ç³»ï¼š</p><ul><li>ï¼ˆ1ï¼‰å®ƒä»¬å…±<strong>äº«ä»£ç ç©ºé—´</strong>ï¼Œï¼ˆ2ï¼‰<strong>æ•°æ®ç©ºé—´æ˜¯äº’ç›¸ç‹¬ç«‹</strong>çš„ï¼Œä½†<strong>å­è¿›ç¨‹æ•°æ®ç©ºé—´ä¸­çš„å†…å®¹æ˜¯çˆ¶è¿›ç¨‹çš„å®Œæ•´æ‹·è´</strong>ï¼Œï¼ˆ3ï¼‰<strong>æŒ‡ä»¤æŒ‡é’ˆä¹Ÿå®Œå…¨ç›¸åŒ</strong>ï¼Œï¼ˆ4ï¼‰å­è¿›ç¨‹æ‹¥æœ‰çˆ¶è¿›ç¨‹å½“å‰è¿è¡Œåˆ°çš„ä½ç½®ï¼ˆä¸¤è¿›ç¨‹çš„ç¨‹åºè®¡æ•°å™¨pcå€¼ç›¸åŒï¼‰ã€‚</li></ul><p>é™¤äº†ï¼šforkæˆåŠŸï¼Œ<strong>å­è¿›ç¨‹ä¸­forkçš„è¿”å›å€¼æ˜¯0ï¼Œçˆ¶è¿›ç¨‹ä¸­forkçš„è¿”å›å€¼æ˜¯å­è¿›ç¨‹çš„è¿›ç¨‹å·pid</strong> ã€‚</p></li><li><p><strong>è¿›ç¨‹ç»„</strong>ï¼š è¿›ç¨‹ç»„å°±æ˜¯å¤šä¸ªè¿›ç¨‹çš„é›†åˆï¼Œå…¶ä¸­è‚¯å®šæœ‰ä¸€ä¸ªç»„é•¿ï¼Œå…¶è¿›ç¨‹PIDç­‰äºè¿›ç¨‹ç»„çš„PGID ï¼›</p></li><li><p><strong>ä½œä¸š</strong>ï¼š shell<strong>åˆ†å‰åå°</strong>æ¥æ§åˆ¶çš„ä¸æ˜¯è¿›ç¨‹è€Œæ˜¯ä½œä¸šï¼ˆjobï¼‰æˆ–è€…è¿›ç¨‹ç»„ï¼ˆProcess Groupï¼‰ã€‚</p><blockquote><p>ä¸€ä¸ªå‰å°ä½œä¸šå¯ä»¥ç”±å¤šä¸ªè¿›ç¨‹ç»„æˆï¼Œä¸€ä¸ªåå°ä¹Ÿå¯ä»¥ç”±å¤šä¸ªè¿›ç¨‹ç»„æˆï¼Œshellå¯ä»¥è¿è¡Œä¸€ä¸ªå‰å°ä½œä¸šå’Œä»»æ„å¤šä¸ªåå°ä½œä¸šï¼Œè¿™ç§°ä¸ºä½œä¸šæ§åˆ¶ã€‚ã€</p></blockquote></li><li><p><strong>ä¼šè¯</strong>ã€‚ ä¸€ä¸ªæˆ–å¤šä¸ª<strong>è¿›ç¨‹ç»„çš„é›†åˆ</strong>ï¼Œ<strong>ä¸€ä¸ªä¼šè¯å¯ä»¥æœ‰ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯</strong>ã€‚åœ¨xshellæˆ–è€…WinSCPä¸­æ‰“å¼€ä¸€ä¸ªçª—å£å°±æ˜¯æ–°å»ºä¸€ä¸ªä¼šè¯ã€‚</p></li></ul><h4 id="12-ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹ã€åƒµå°¸è¿›ç¨‹ã€å­¤å„¿è¿›ç¨‹ï¼Ÿ">12. ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹ã€åƒµå°¸è¿›ç¨‹ã€å­¤å„¿è¿›ç¨‹ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://liubigbin.github.io/2016/03/11/Linux-%E4%B9%8B%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E3%80%81%E5%83%B5%E6%AD%BB%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B/">Linux ä¹‹å®ˆæŠ¤è¿›ç¨‹ã€åƒµæ­»è¿›ç¨‹ä¸å­¤å„¿è¿›ç¨‹</a></p></blockquote><ul><li><p><strong>å®ˆæŠ¤è¿›ç¨‹</strong></p><p><strong>åœ¨åå°è¿è¡Œçš„ï¼Œæ²¡æœ‰æ§åˆ¶ç»ˆç«¯ä¸ä¹‹ç›¸è¿</strong>çš„è¿›ç¨‹ã€‚å®ƒ<strong>ç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯</strong>ï¼Œå‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸç§ä»»åŠ¡ã€‚å®ƒä¸éœ€è¦ç”¨æˆ·è¾“å…¥å°±èƒ½è¿è¡Œè€Œä¸”æä¾›æŸç§æœåŠ¡ï¼Œä¸æ˜¯<strong>å¯¹æ•´ä¸ªç³»ç»Ÿå°±æ˜¯å¯¹æŸä¸ªç”¨æˆ·ç¨‹åº</strong>æä¾›æœåŠ¡ã€‚</p><ul><li>ä¸¾ä¾‹ï¼šå¸¸è§çš„å®ˆæŠ¤è¿›ç¨‹åŒ…æ‹¬ç³»ç»Ÿæ—¥å¿—è¿›ç¨‹syslogdã€ webæœåŠ¡å™¨httpdã€é‚®ä»¶æœåŠ¡å™¨sendmailå’Œæ•°æ®åº“æœåŠ¡å™¨mysqldç­‰ã€‚</li></ul><p>ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯initè¿›ç¨‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª<u>å­¤å„¿è¿›ç¨‹</u> ï¼Œä¸€èˆ¬åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¼€å§‹è¿è¡Œï¼Œé™¤éå¼ºè¡Œç»ˆæ­¢ï¼Œå¦åˆ™ç›´åˆ°ç³»ç»Ÿå…³æœºéƒ½ä¿æŒè¿è¡Œã€‚</p></li><li><p><strong>å­¤å„¿è¿›ç¨‹</strong></p><p>ä¸€ä¸ª<strong>çˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œ</strong>ï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p></li><li><p><strong>åƒµå°¸è¿›ç¨‹</strong></p><p>ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœ<strong>å­è¿›ç¨‹é€€å‡º</strong>ï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼ˆå­è¿›ç¨‹å¿…é¡»<strong>ç­‰åˆ°çˆ¶è¿›ç¨‹æ•è·åˆ°äº†å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€æ‰çœŸæ­£ç»“æŸ</strong>ï¼‰ï¼Œé‚£ä¹ˆ<strong>å­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­</strong>ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµæ­»è¿›ç¨‹ã€‚</p></li></ul><h5 id="11-1-å¦‚ä½•é¿å…åƒµå°¸è¿›ç¨‹ï¼Ÿ">11.1 å¦‚ä½•é¿å…åƒµå°¸è¿›ç¨‹ï¼Ÿ</h5><ul><li><p>é€šè¿‡<strong>signal(SIGCHLD, SIG_IGN</strong>)é€šçŸ¥å†…æ ¸å¯¹å­è¿›ç¨‹çš„ç»“æŸä¸å…³å¿ƒï¼Œç”±å†…æ ¸å›æ”¶ï¼›</p><blockquote><p>å¦‚æœä¸æƒ³è®©çˆ¶è¿›ç¨‹æŒ‚èµ·ï¼Œå¯ä»¥åœ¨çˆ¶è¿›ç¨‹ä¸­åŠ å…¥ä¸€æ¡è¯­å¥ï¼šsignal(SIGCHLD,SIG_IGN); è¡¨ç¤ºçˆ¶è¿›ç¨‹å¿½ç•¥SIGCHLDä¿¡å·ï¼Œè¯¥ä¿¡å·æ˜¯å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™å‘çˆ¶è¿›ç¨‹å‘é€çš„ã€‚</p></blockquote></li><li><p>çˆ¶è¿›ç¨‹è°ƒç”¨wait/waitpidç­‰å‡½æ•°ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œå¦‚æœå°šæ— å­è¿›ç¨‹é€€å‡ºwaitä¼šå¯¼è‡´çˆ¶è¿›ç¨‹é˜»å¡ï¼›</p><blockquote><p>waitpidå¯ä»¥é€šè¿‡ä¼ é€’WNOHANGä½¿çˆ¶è¿›ç¨‹ä¸é˜»å¡ç«‹å³è¿”å›ã€‚</p></blockquote></li><li><p>å¦‚æœçˆ¶è¿›ç¨‹å¾ˆå¿™å¯ä»¥ç”¨signalæ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œåœ¨ä¿¡å·å¤„ç†å‡½æ•°è°ƒç”¨wait/waitpidç­‰å¾…å­è¿›ç¨‹é€€å‡º;</p></li><li><p>é€šè¿‡ä¸¤æ¬¡è°ƒç”¨forkã€‚çˆ¶è¿›ç¨‹é¦–å…ˆè°ƒç”¨forkåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ç„¶åwaitpidç­‰å¾…å­è¿›ç¨‹é€€å‡ºï¼Œå­è¿›ç¨‹å†forkä¸€ä¸ªå­™è¿›ç¨‹åé€€å‡ºã€‚è¿™æ ·å­è¿›ç¨‹é€€å‡ºåä¼šè¢«çˆ¶è¿›ç¨‹ç­‰å¾…å›æ”¶ï¼Œè€Œå¯¹äºå­™å­è¿›ç¨‹å…¶çˆ¶è¿›ç¨‹å·²ç»é€€å‡ºæ‰€ä»¥å­™è¿›ç¨‹æˆä¸ºä¸€ä¸ªå­¤å„¿è¿›ç¨‹ï¼Œå­¤å„¿è¿›ç¨‹ç”±initè¿›ç¨‹æ¥ç®¡ï¼Œå­™è¿›ç¨‹ç»“æŸåï¼Œinitä¼šç­‰å¾…å›æ”¶ã€‚</p></li></ul><h2 id="4-3-socketç¼–ç¨‹">4.3 socketç¼–ç¨‹</h2><p>æš‚ç•¥</p><h2 id="4-4-å†…å­˜ç®¡ç†">4.4 å†…å­˜ç®¡ç†</h2><h4 id="1-ä»‹ç»ä¸€ä¸‹æ“ä½œç³»ç»Ÿçš„å †å’Œæ ˆï¼Ÿ">1.<strong>ä»‹ç»ä¸€ä¸‹æ“ä½œç³»ç»Ÿçš„å †å’Œæ ˆï¼Ÿ</strong></h4><ul><li><p><strong>æ ˆå†…å­˜</strong>ï¼šæ ˆå†…å­˜é¦–å…ˆæ˜¯ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼Œå­˜å‚¨çš„éƒ½æ˜¯<u>å±€éƒ¨å˜é‡</u>ï¼Œæ ˆå†…å­˜çš„<u>æ›´æ–°é€Ÿåº¦å¾ˆå¿«</u>ï¼Œå› ä¸ºå±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸéƒ½å¾ˆçŸ­ã€‚</p><blockquote><p>å±€éƒ¨å˜é‡ï¼šæ–¹æ³•å†…çš„å˜é‡ï¼Œforå¾ªç¯å†…éƒ¨å®šä¹‰çš„ä¹Ÿæ˜¯å±€éƒ¨å˜é‡ç­‰ã€‚</p></blockquote></li><li><p><strong>å †å†…å­˜</strong>ï¼šå­˜å‚¨çš„æ˜¯<u><strong>æ•°ç»„</strong></u>å’Œ<strong>å¯¹è±¡</strong>ï¼ˆå…¶å®æ•°ç»„å°±æ˜¯å¯¹è±¡ï¼‰ï¼Œå‡¡æ˜¯newå»ºç«‹çš„éƒ½æ˜¯åœ¨å †ä¸­ï¼Œå †ä¸­å­˜æ”¾çš„éƒ½æ˜¯å®ä½“ï¼ˆå¯¹è±¡ï¼‰ã€‚å †é‡Œçš„å®ä½“è™½ç„¶ä¸ä¼šè¢«é‡Šæ”¾ï¼Œä½†æ˜¯ä¼šè¢«å½“æˆåƒåœ¾ï¼ŒJavaæœ‰åƒåœ¾å›æ”¶æœºåˆ¶ä¸å®šæ—¶çš„æ”¶å–ã€‚</p></li></ul><h5 id="1-1-ä»€ä¹ˆæ—¶å€™ä¼šæ ˆæº¢å‡ºï¼Ÿ">1.1 ä»€ä¹ˆæ—¶å€™ä¼šæ ˆæº¢å‡ºï¼Ÿ</h5><p>æ ˆèƒ½ä½¿ç”¨çš„å†…å­˜æ˜¯æœ‰é™çš„ï¼Œä¸€èˆ¬æ˜¯ 1M~8Mï¼Œè¿™åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å†³å®šäº†ï¼Œç¨‹åºè¿è¡ŒæœŸé—´ä¸èƒ½å†æ”¹å˜ã€‚</p><ul><li>å¦‚æœç¨‹åºä½¿ç”¨çš„æ ˆå†…å­˜è¶…å‡ºæœ€å¤§å€¼ï¼Œå°±ä¼šå‘ç”Ÿæ ˆæº¢å‡ºï¼ˆStack Overflowï¼‰é”™è¯¯ï¼Œç¨‹åºå°±å´©æºƒäº†ï¼›</li><li>ä¸€èˆ¬å¸¸è§çš„æƒ…å†µï¼Œå¦‚<strong>é€’å½’è¿‡æ·±</strong></li></ul><h4 id="2-ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆå†…å­˜ç®¡ç†ï¼Ÿå¸¸ç”¨çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Ÿ">2. ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆå†…å­˜ç®¡ç†ï¼Ÿå¸¸ç”¨çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Ÿ</h4><ul><li><p><strong>å†…å­˜ç®¡ç†</strong></p><p>æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†ä¸»è¦è´Ÿè´£å†…å­˜çš„ï¼ˆ1ï¼‰<strong>åˆ†é…ä¸å›æ”¶ï¼ˆ<strong>malloc å‡½æ•°ï¼šç”³è¯·å†…å­˜ï¼Œfree å‡½æ•°ï¼šé‡Šæ”¾å†…å­˜ï¼‰ï¼Œï¼ˆ2ï¼‰å¦å¤–åœ°å€è½¬æ¢ä¹Ÿå°±æ˜¯å°†</strong>é€»è¾‘åœ°å€è½¬æ¢æˆç›¸åº”çš„ç‰©ç†åœ°å€</strong>ç­‰åŠŸèƒ½ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†åšçš„äº‹æƒ…ã€‚</p></li><li><p><strong>å¸¸ç”¨å†…å­˜ç®¡ç†æœºåˆ¶</strong></p><p>ç®€å•åˆ†ä¸º<strong>è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</strong>å’Œ<strong>éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼</strong>è¿™ä¸¤ç§ã€‚è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼æ˜¯æŒ‡ä¸ºâ¼€ä¸ªç”¨æˆ·ç¨‹åºåˆ†é…â¼€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¸¸è§çš„å¦‚<strong>å—å¼ç®¡ç†</strong> ã€‚åŒæ ·åœ°ï¼Œéè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼å…è®¸â¼€ä¸ªç¨‹åºä½¿ç”¨çš„å†…å­˜åˆ†åœ¨ç¦»æ•£æˆ–è€…è¯´ä¸ç›¸é‚»çš„å†…å­˜ä¸­ï¼Œå¸¸è§çš„å¦‚<strong>é¡µå¼ç®¡ç† å’Œ æ®µå¼ç®¡ç†</strong>ã€‚</p><ol><li><p><strong>å—å¼ç®¡ç†</strong> ï¼š è¿œå¤æ—¶ä»£çš„è®¡ç®—æœºæ“ç³»ç»Ÿçš„å†…å­˜ç®¡ç†æ–¹å¼ã€‚<strong>å°†å†…å­˜åˆ†ä¸ºâ¼ä¸ªå›ºå®šå¤§å°çš„å—</strong>ï¼Œæ¯ä¸ªå—ä¸­åªåŒ…å«â¼€ä¸ªè¿›ç¨‹ã€‚å¦‚æœç¨‹åºè¿è¡Œéœ€è¦å†…å­˜çš„è¯ï¼Œæ“ä½œç³»ç»Ÿå°±åˆ†é…ç»™å®ƒâ¼€å—ï¼Œå¦‚æœç¨‹åºè¿è¡Œåªéœ€<br>è¦å¾ˆå°çš„ç©ºé—´çš„è¯ï¼Œåˆ†é…çš„è¿™å—å†…å­˜å¾ˆå¤§â¼€éƒ¨åˆ†â¼ä¹è¢«æµªè´¹äº†ã€‚è¿™äº›åœ¨æ¯ä¸ªå—ä¸­æœªè¢«åˆ©ç”¨çš„ç©ºé—´ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç¢ç‰‡ã€‚</p></li><li><p><strong>é¡µå¼ç®¡ç†</strong> ï¼šæŠŠä¸»å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰ä¸”å›ºå®šçš„â¼€é¡µâ¼€é¡µçš„å½¢å¼ï¼Œ<strong>é¡µè¾ƒå°ï¼Œç›¸å¯¹ç›¸â½äºå—å¼ç®¡ç†çš„åˆ’åˆ†â¼’åº¦æ›´å¤§</strong>ï¼Œæé«˜äº†å†…å­˜åˆ©ç”¨ç‡ï¼Œå‡å°‘äº†ç¢ç‰‡ã€‚é¡µå¼ç®¡ç†é€šè¿‡<u>é¡µè¡¨å¯¹åº”é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€</u>ã€‚</p></li><li><p><strong>æ®µå¼ç®¡ç†</strong> ï¼š é¡µå¼ç®¡ç†è™½ç„¶æé«˜äº†å†…å­˜åˆ©ç”¨ç‡ï¼Œä½†æ˜¯é¡µå¼ç®¡ç†å…¶ä¸­çš„é¡µå®é™…å¹¶æ— ä»»ä½•å®é™…æ„ä¹‰ã€‚æ®µå¼ç®¡ç†æŠŠä¸»å­˜åˆ†ä¸ºâ¼€æ®µæ®µçš„ï¼Œ<strong>æ¯â¼€æ®µçš„ç©ºé—´â¼œè¦â½â¼€é¡µçš„ç©ºé—´å°å¾ˆå¤š</strong> ã€‚</p></li></ol><blockquote><p>ä½†æ˜¯ï¼Œæœ€é‡è¦çš„æ˜¯æ®µæ˜¯æœ‰å®é™…æ„ä¹‰çš„ï¼Œæ¯ä¸ªæ®µå®šä¹‰äº†â¼€ç»„é€»è¾‘ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œæœ‰ä¸»ç¨‹æ®µ MAINã€å­ç¨‹åºæ®µ Xã€æ•°æ®æ®µ DåŠæ ˆæ®µ S ç­‰ã€‚ æ®µå¼ç®¡ç†é€šè¿‡æ®µè¡¨å¯¹åº”é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€ã€‚</p></blockquote><ol start="4"><li><strong>æ®µé¡µå¼ç®¡ç†æœºåˆ¶</strong> ã€‚æ®µé¡µå¼ç®¡ç†æœºåˆ¶ç»“åˆäº†æ®µå¼ç®¡ç†å’Œé¡µå¼ç®¡ç†çš„ä¼˜ç‚¹ã€‚ç®€å•æ¥è¯´æ®µé¡µå¼ç®¡ç†æœºåˆ¶å°±æ˜¯æŠŠä¸»å­˜å…ˆåˆ†æˆè‹¥â¼²æ®µï¼Œæ¯ä¸ªæ®µâ¼œåˆ†æˆè‹¥â¼²é¡µï¼Œä¹Ÿå°±æ˜¯è¯´ æ®µé¡µå¼ç®¡ç†æœºåˆ¶ä¸­æ®µä¸æ®µä¹‹é—´ä»¥åŠæ®µçš„å†…éƒ¨çš„éƒ½æ˜¯ç¦»æ•£çš„ã€‚</li></ol></li></ul><h5 id="2-1-ä»‹ç»ä¸€ä¸‹é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€ï¼Ÿ">2.1 ä»‹ç»ä¸€ä¸‹é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€ï¼Ÿ</h5><ul><li>æˆ‘ä»¬ç¼–ç¨‹â¼€èˆ¬åªæœ‰å¯èƒ½å’Œé€»è¾‘åœ°å€æ‰“äº¤é“ï¼Œâ½å¦‚åœ¨ C è¯­â¾”ä¸­ï¼ŒæŒ‡é’ˆâ¾¥é¢å­˜å‚¨çš„æ•°å€¼å°±å¯ä»¥ç†è§£æˆä¸º<strong>å†…å­˜â¾¥çš„â¼€ä¸ªåœ°å€</strong>ï¼Œè¿™ä¸ªåœ°å€ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„é€»è¾‘åœ°å€ï¼Œé€»è¾‘åœ°å€ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚</li><li>ç‰©ç†åœ°å€æŒ‡çš„æ˜¯<strong>çœŸå®ç‰©ç†å†…å­˜ä¸­åœ°å€</strong>ï¼Œæ›´å…·ä½“â¼€ç‚¹æ¥è¯´å°±æ˜¯å†…å­˜åœ°å€å¯„å­˜å™¨ä¸­çš„åœ°å€ã€‚</li></ul><h5 id="2-2-æ“ä½œç³»ç»Ÿåœ¨å†…å­˜ç®¡ç†éœ€è¦åšä»€ä¹ˆï¼Ÿ">2.2 æ“ä½œç³»ç»Ÿåœ¨å†…å­˜ç®¡ç†éœ€è¦åšä»€ä¹ˆï¼Ÿ</h5><ul><li>å†…å­˜ç©ºé—´çš„åˆ†é…ä¸å›æ”¶ï¼›</li><li>ä»é€»è¾‘ä¸Šå¯¹å†…å­˜ç©ºé—´è¿›è¡Œæ‰©å……ï¼›</li><li>é€»è¾‘åœ°å€ä¸ç‰©ç†åœ°å€çš„è½¬æ¢ï¼›</li><li>æ“ä½œç³»ç»Ÿéœ€è¦æä¾›å†…å­˜ä¿æŠ¤åŠŸèƒ½ã€‚ä¿è¯å„è¿›ç¨‹åœ¨å„è‡ªå­˜å‚¨ç©ºé—´å†…è¿è¡Œï¼Œäº’ä¸å¹²æ‰°ã€‚</li></ul><h4 id="3-ä»‹ç»ä¸€ä¸‹å¿«è¡¨å’Œå¤šçº§é¡µè¡¨ï¼Ÿ">3. ä»‹ç»ä¸€ä¸‹å¿«è¡¨å’Œå¤šçº§é¡µè¡¨ï¼Ÿ</h4><p>åœ¨åˆ†é¡µå†…å­˜ç®¡ç†ä¸­ï¼Œå¾ˆé‡è¦çš„ä¸¤ç‚¹æ˜¯ï¼š</p><ol><li>è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¦å¿«ã€‚</li><li>è§£å†³è™šæ‹Ÿåœ°å€ç©ºé—´å¤§ï¼Œ<strong>é¡µè¡¨ä¹Ÿä¼šå¾ˆå¤§</strong>çš„é—®é¢˜ã€‚</li></ol><h5 id="å¿«è¡¨ä»‹ç»">å¿«è¡¨ä»‹ç»</h5><p>å¿«è¡¨ç†è§£ä¸ºâ¼€ç§<strong>ç‰¹æ®Šçš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨</strong>ï¼ˆCacheï¼‰ï¼Œå…¶ä¸­çš„<strong>å†…å®¹æ˜¯é¡µè¡¨çš„â¼€éƒ¨åˆ†æˆ–è€…å…¨éƒ¨å†…å®¹</strong>ã€‚ä½œä¸ºé¡µè¡¨çš„ Cacheï¼Œå®ƒçš„ä½œç”¨ä¸é¡µè¡¨ç›¸ä¼¼ï¼Œä½†æ˜¯æé«˜äº†è®¿é—®é€Ÿç‡ã€‚</p><blockquote><p>ä½†æœ‰æ—¶å¿«è¡¨ä¸å‘½ä¸­è¦è®¿é—®ä¸¤æ¬¡ç¼“å­˜ï¼Œä¸è¿‡æ€»ä½“è¿˜æ˜¯æé«˜äº†æ€§èƒ½ã€‚</p></blockquote><h5 id="å¤šçº§é¡µè¡¨ä»‹ç»">å¤šçº§é¡µè¡¨ä»‹ç»</h5><p>å¼•â¼Šå¤šçº§é¡µè¡¨çš„ä¸»è¦â½¬çš„æ˜¯ä¸ºäº† <u><strong>é¿å…æŠŠå…¨éƒ¨é¡µè¡¨â¼€ç›´æ”¾åœ¨å†…å­˜ä¸­å ç”¨è¿‡å¤šç©ºé—´</strong></u>ï¼Œç‰¹åˆ«æ˜¯é‚£äº›æ ¹æœ¬å°±ä¸éœ€è¦çš„é¡µè¡¨å°±ä¸éœ€è¦ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚å¤šçº§é¡µè¡¨<strong>å±äºæ—¶é—´æ¢ç©ºé—´</strong>çš„å…¸å‹åœºæ™¯ã€‚</p><h4 id="4-åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶çš„å…±åŒç‚¹å’ŒåŒºåˆ«-ï¼Ÿ">4. åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶çš„å…±åŒç‚¹å’ŒåŒºåˆ« ï¼Ÿ</h4><ol><li>å…±åŒç‚¹ ï¼š<ul><li>åˆ†é¡µæœºåˆ¶å’Œåˆ†æ®µæœºåˆ¶éƒ½æ˜¯ä¸ºäº†<strong>æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œè¾ƒå°‘å†…å­˜ç¢ç‰‡</strong>ã€‚</li><li>é¡µå’Œæ®µéƒ½æ˜¯<strong>ç¦»æ•£å­˜å‚¨</strong>çš„ï¼Œæ‰€ä»¥ä¸¤è€…éƒ½æ˜¯ç¦»æ•£åˆ†é…å†…å­˜çš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªé¡µå’Œæ®µä¸­çš„å†…å­˜æ˜¯è¿ç»­çš„ã€‚</li></ul></li><li>åŒºåˆ« ï¼š<ul><li><strong>é¡µçš„å¤§å°æ˜¯å›ºå®šçš„</strong>ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šï¼›<strong>è€Œæ®µçš„å¤§å°ä¸å›ºå®š</strong>ï¼Œå–å†³äºæˆ‘ä»¬å½“å‰è¿è¡Œçš„ç¨‹åºã€‚</li><li>åˆ†é¡µä»…ä»…æ˜¯ä¸ºäº†<strong>æ»¡â¾œæ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†</strong>çš„éœ€æ±‚ï¼Œè€Œ<strong>æ®µæ˜¯é€»è¾‘ä¿¡æ¯çš„å•ä½ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥ä½“ç°ä¸ºä»£ç æ®µï¼Œæ•°æ®æ®µ</strong>ï¼Œèƒ½å¤Ÿæ›´å¥½æ»¡â¾œç”¨æˆ·çš„éœ€è¦ã€‚</li></ul></li></ol><h4 id="5-ã€å¾…æ‰©å……ã€‘CPU-å¯»å€äº†è§£å—-ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€ç©ºé—´">5. ã€å¾…æ‰©å……ã€‘CPU å¯»å€äº†è§£å—?ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿåœ°å€ç©ºé—´?</h4><ul><li><p>ç°ä»£å¤„ç†å™¨ä½¿ç”¨çš„æ˜¯â¼€ç§ç§°ä¸º è™šæ‹Ÿå¯»å€(Virtual Addressing) çš„å¯»å€â½…å¼ã€‚ä½¿ç”¨è™šæ‹Ÿå¯»å€ï¼Œ<strong>CPU éœ€è¦è™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€</strong>ï¼Œè¿™æ ·æ‰èƒ½è®¿é—®åˆ°çœŸå®çš„ç‰©ç†å†…å­˜ã€‚</p><blockquote><p>å®é™…ä¸Šå®Œæˆè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€è½¬æ¢çš„ç¡¬ä»¶æ˜¯ CPU ä¸­å«æœ‰â¼€ä¸ªè¢«ç§°ä¸º å†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Management Unit, MMUï¼‰ çš„ç¡¬ä»¶ã€‚</p></blockquote></li><li><p><strong>å¦‚æœç›´æ¥æŠŠç‰©ç†åœ°å€æš´éœ²å‡ºæ¥çš„è¯ä¼šå¸¦æ¥ä¸¥é‡é—®é¢˜</strong>ï¼Œâ½å¦‚å¯èƒ½å¯¹æ“ä½œç³»ç»Ÿé€ æˆä¼¤å®³ä»¥åŠç»™åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºé€ æˆå›°éš¾ã€‚</p></li></ul><h4 id="6-å¦‚æœç³»ç»Ÿä¸­å…·æœ‰å¿«è¡¨åï¼Œé‚£ä¹ˆåœ°å€çš„è½¬æ¢è¿‡ç¨‹å˜æˆä»€ä¹ˆæ ·äº†ï¼Ÿ">6. å¦‚æœç³»ç»Ÿä¸­å…·æœ‰å¿«è¡¨åï¼Œé‚£ä¹ˆåœ°å€çš„è½¬æ¢è¿‡ç¨‹å˜æˆä»€ä¹ˆæ ·äº†ï¼Ÿ</h4><blockquote><p>ç®€å•æ¥è¯´ï¼šcupè®¡ç®—é¡µå· â†’ å¿«è¡¨æŸ¥è¯¢æ˜¯å¦æœ‰è¯¥é¡µå· â†’ å¦åˆ™é¡µè¡¨æŸ¥è¯¢</p></blockquote><ol><li><strong>è®¡ç®—é¡µå·å’Œé¡µåç§»é‡</strong>ã€‚ CPUç»™å‡ºé€»è¾‘åœ°å€ï¼Œç”±æŸä¸ªç¡¬ä»¶ç®—å¾—é¡µå·ã€é¡µå†…åç§»é‡ï¼›</li><li><strong>å¿«è¡¨ä¸­æŸ¥æ‰¾å†…å­˜å—å·</strong>ã€‚ å°†é¡µå·ä¸å¿«è¡¨ä¸­çš„æ‰€æœ‰é¡µå·è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ‰¾åˆ°åŒ¹é…çš„é¡µå·ï¼Œåˆ™ç›´æ¥ä»ä¸­å–å‡ºè¯¥é¡µå¯¹åº”çš„å†…å­˜å—å·ï¼Œå†<strong>å°†å†…å­˜å—å·ä¸é¡µå†…åç§»é‡æ‹¼æ¥å½¢æˆç‰©ç†åœ°å€</strong>ï¼›</li><li><strong>é¡µè¡¨ä¸­æŸ¥æ‰¾å†…å­˜å—å·</strong>ã€‚ å¦‚æœå¿«è¡¨ä¸­æŸ¥æ‰¾ä¸å­˜åœ¨ï¼Œè®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œæ‰¾åˆ°å¯¹åº”é¡µè¡¨é¡¹ï¼Œå¾—åˆ°é¡µé¢å­˜æ”¾çš„å†…å­˜å—å·ï¼Œå†å°†å†…å­˜å—å·ä¸é¡µå†…åç§»é‡æ‹¼æ¥å½¢æˆç‰©ç†åœ°å€ï¼Œæœ€åï¼Œè®¿é—®è¯¥ç‰©ç†åœ°å€å¯¹åº”çš„å†…å­˜å•å…ƒã€‚</li></ol><h4 id="7-è¿›ç¨‹å†…å­˜åˆ†é…åŠ¨æ€åˆ†åŒºç®—æ³•ï¼Ÿ">7. è¿›ç¨‹å†…å­˜åˆ†é…åŠ¨æ€åˆ†åŒºç®—æ³•ï¼Ÿ</h4><ol><li><p><strong>é¦–æ¬¡é€‚åº”æ³•</strong>ã€‚</p><ul><li><p><strong>ç®—æ³•æ€æƒ³</strong>ï¼šæ¯æ¬¡éƒ½ä»ä½åœ°å€å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³å¤§å°çš„ç©ºé—²åˆ†åŒºï¼›</p></li><li><p><strong>å®ç°æ–¹å¼</strong>ï¼šç©ºé—²åˆ†åŒºä»¥<strong>åœ°å€é€’å¢</strong>çš„æ¬¡åºæ’åˆ—ã€‚æ¯æ¬¡åˆ†é…å†…å­˜æ—¶é¡ºåºæŸ¥æ‰¾ç©ºé—²åˆ†åŒºé“¾( æˆ–ç©ºé—²åˆ†[è¡¨)ï¼Œæ‰¾åˆ°å¤§å°èƒ½æ»¡è¶³è¦æ±‚çš„ç¬¬-ä¸€ä¸ªç©ºé—²åˆ†åŒºã€‚</p></li><li><p><strong>ä¼˜ç‚¹</strong>ï¼š ç»¼åˆæ€§èƒ½æœ€å¥½ï¼Œå¼€é”€å°ã€‚</p><p><img src="https://i.loli.net/2021/06/10/PEpjmDW52eqGl4f.png" alt="image-20210610231604639"></p></li></ul></li><li><p><strong>æœ€ä½³é€‚åº”æ³•</strong>ã€‚</p><ul><li><strong>ç®—æ³•æ€æƒ³</strong>ï¼šä¸ºäº†ä¿è¯å½“â€œå¤§è¿›ç¨‹â€åˆ°æ¥æ—¶èƒ½æœ‰è¿ç»­çš„å¤§ç‰‡ç©ºé—´ï¼Œå¯ä»¥å°½å¯èƒ½å¤šåœ°ç•™ä¸‹å¤§ç‰‡çš„ç©ºé—²åŒº,å³ï¼Œä¼˜å…ˆä½¿ç”¨æ›´å°çš„ç©ºé—²åŒºï¼›</li><li><strong>å®ç°æ–¹å¼</strong>ï¼š ç©ºé—²åˆ†åŒºæŒ‰<strong>å®¹é‡é€’å¢</strong>æ¬¡åºé“¾æ¥ã€‚æ¯æ¬¡åˆ†é…å†…å­˜æ—¶é¡ºåºæŸ¥æ‰¾ç©ºé—²åˆ†åŒºé“¾(æˆ–ç©ºé—²åˆ†åŒºè¡¨)ï¼Œæ‰¾åˆ°å¤§å°èƒ½æ»¡è¶³è¦æ±‚çš„ç¬¬ä¸€ä¸ªç©ºé—²åˆ†åŒºã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š ä¼šæœ‰æ›´å¤šçš„å¤§åˆ†åŒºè¢«ä¿ç•™ä¸‹æ¥ï¼Œ<u>æ›´èƒ½æ»¡è¶³å¤§è¿›ç¨‹éœ€æ±‚</u></li><li><strong>ç¼ºç‚¹</strong>ï¼š äº§ç”Ÿå¾ˆå¤šå¤ªå°çš„ã€éš¾ä»¥åˆ©ç”¨çš„ç¢ç‰‡ï¼Œç®—æ³•å¼€é”€å¤§</li></ul></li><li><p><strong>æœ€åé€‚åº”æ³•</strong>ã€‚</p><ul><li><strong>ç®—æ³•æ€æƒ³</strong>ï¼š ä¸ºäº†è§£å†³æœ€ä½³é€‚åº”ç®—æ³•çš„é—®é¢˜â€”å³ç•™ä¸‹å¤ªå¤šéš¾ä»¥åˆ©ç”¨çš„å°ç¢ç‰‡ï¼Œå¯ä»¥åœ¨æ¯æ¬¡åˆ†é…æ—¶ä¼˜å…ˆä½¿ç”¨æœ€å¤§çš„è¿ç»­ç©ºé—²åŒºï¼Œè¿™æ ·åˆ†é…åå‰©ä½™çš„ç©ºé—²åŒºå°±ä¸ä¼šå¤ªå°ï¼Œæ›´æ–¹ä¾¿ä½¿ç”¨ã€‚</li><li><strong>å®ç°æ–¹å¼</strong>ï¼šç©ºé—²åˆ†åŒºæŒ‰<strong>å®¹é‡é€’å‡</strong>æ¬¡åºé“¾æ¥ã€‚æ¯æ¬¡åˆ†é…å†…å­˜æ—¶é¡ºåºæŸ¥æ‰¾ç©ºé—²åˆ†åŒºé“¾(æˆ–ç©ºé—²åˆ†åŒºè¡¨)ï¼Œæ‰¾åˆ°å¤§å°èƒ½æ»¡è¶³è¦æ±‚çš„ç¬¬ä¸€ä¸ªç©ºé—²åˆ†åŒºã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š å¯ä»¥å‡å°‘éš¾ä»¥åˆ©ç”¨çš„å°ç¢ç‰‡</li><li><strong>ç¼ºç‚¹</strong>ï¼š å¤§åˆ†åŒºå®¹æ˜“è¢«ç”¨å®Œï¼Œä¸åˆ©äºå¤§è¿›ç¨‹ï¼Œç®—æ³•å¼€é”€å¤§</li></ul></li><li><p><strong>é¢†è¿‘é€‚åº”æ³•</strong>ã€‚</p><ul><li><strong>ç®—æ³•æ€æƒ³</strong>ï¼š é¦–æ¬¡é€‚åº”ç®—æ³•æ¯æ¬¡éƒ½ä»é“¾å¤´å¼€å§‹æŸ¥æ‰¾çš„ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä½åœ°å€éƒ¨åˆ†å‡ºç°å¾ˆå¤šå°çš„ç©ºé—²åˆ†åŒºï¼Œè€Œæ¯æ¬¡åˆ†é…æŸ¥æ‰¾æ—¶ï¼Œéƒ½è¦ç»è¿‡è¿™äº›åˆ†åŒºï¼Œå› æ­¤ä¹Ÿå¢åŠ äº†æŸ¥æ‰¾çš„å¼€é”€ã€‚</li><li><strong>å®ç°æ–¹å¼</strong>ï¼šç©ºé—²åˆ†åŒºä»¥<strong>åœ°å€é€’å¢</strong>çš„é¡ºåºæ’åˆ—(å¯æ’æˆä¸€ä¸ª<strong>å¾ªç¯é“¾è¡¨</strong>)ã€‚æ¯æ¬¡åˆ†é…å†…å­˜æ—¶<u>ä»ä¸Šæ¬¡æŸ¥æ‰¾ç»“æŸçš„ä½ç½®å¼€å§‹</u> ï¼ŒæŸ¥æ‰¾ç©ºé—²åˆ†åŒºé“¾(æˆ–ç©ºé—²åˆ†åŒºè¡¨)ï¼Œæ‰¾åˆ°å¤§å°èƒ½æ»¡è¶³è¦æ±‚çš„ç¬¬ä¸€ä¸ªç©ºé—²åˆ†åŒºã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š ç®—æ³•å¼€é”€å°</li></ul></li></ol><h4 id="8-ä»€ä¹ˆæ˜¯å†…å­˜è¦†ç›–å’Œå†…å­˜äº¤æ¢ï¼Ÿ">8. ä»€ä¹ˆæ˜¯å†…å­˜è¦†ç›–å’Œå†…å­˜äº¤æ¢ï¼Ÿ</h4><ul><li><strong>å†…å­˜è¦†ç›–</strong><ul><li><strong>æ€æƒ³</strong>ï¼š æŠŠç”¨æˆ·ç©ºé—´åˆ†æˆä¸ºä¸€ä¸ª<strong>å›ºå®šåŒº</strong>å’Œ<strong>è‹¥å¹²ä¸ªè¦†ç›–åŒº</strong>ã€‚å°†ç»å¸¸æ´»è·ƒçš„éƒ¨åˆ†æ”¾åœ¨å›ºå®šåŒºï¼Œå…¶ä½™éƒ¨åˆ†æŒ‰ç…§è°ƒç”¨å…³ç³»åˆ†æ®µï¼Œé¦–å…ˆå°†é‚£äº›å³å°†è¦è®¿é—®çš„æ®µæ”¾å…¥è¦†ç›–åŒºï¼Œå…¶ä»–æ®µæ”¾åœ¨å¤–å­˜ä¸­ï¼Œåœ¨éœ€è¦è°ƒç”¨å‰ï¼Œç³»ç»Ÿå°†å…¶è°ƒå…¥è¦†ç›–åŒºï¼Œæ›¿æ¢è¦†ç›–åŒºä¸­åŸæœ‰çš„æ®µã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>æ‰“ç ´</strong>äº†å¿…é¡»å°†<strong>ä¸€ä¸ªè¿›ç¨‹çš„å…¨éƒ¨ä¿¡æ¯è£…å…¥å†…å­˜åæ‰èƒ½è¿è¡Œ</strong>çš„é™åˆ¶ ã€‚</li></ul></li><li><strong>å†…å­˜äº¤æ¢</strong><ul><li><strong>æ€æƒ³</strong>ï¼š <u>å†…å­˜ç©ºé—´ç´§å¼ </u> æ—¶ï¼Œç³»ç»Ÿå°†å†…å­˜ä¸­<strong>æŸäº›è¿›ç¨‹æš‚æ—¶æ¢å‡ºå¤–å­˜</strong>ï¼ŒæŠŠå¤–å­˜ä¸­æŸäº›å·²<strong>å…·å¤‡è¿è¡Œæ¡ä»¶çš„è¿›ç¨‹æ¢å…¥å†…å­˜</strong>ã€‚</li></ul></li></ul><h2 id="4-5-è™šæ‹Ÿå†…å­˜">4.5 è™šæ‹Ÿå†…å­˜</h2><h4 id="0-ä»€ä¹ˆæ˜¯è™šæ‹ŸæŠ€æœ¯-ï¼Ÿä»æ—¶é—´å’Œç©ºé—´ä¸¤æ–¹é¢æ¥è¯´ã€‚">0. ä»€ä¹ˆæ˜¯è™šæ‹ŸæŠ€æœ¯ ï¼Ÿä»æ—¶é—´å’Œç©ºé—´ä¸¤æ–¹é¢æ¥è¯´ã€‚</h4><p>è™šæ‹ŸæŠ€æœ¯<strong>æŠŠä¸€ä¸ªç‰©ç†å®ä½“è½¬æ¢ä¸ºå¤šä¸ªé€»è¾‘å®ä½“</strong> ï¼š</p><ul><li><strong>æ—¶åˆ†å¤ç”¨æŠ€æœ¯</strong> ï¼š å¦‚å¤šä¸ªè¿›ç¨‹èƒ½åœ¨åŒä¸€ä¸ªå¤„ç†å™¨ä¸Šå¹¶å‘æ‰§è¡Œä½¿ç”¨äº†æ—¶åˆ†å¤ç”¨æŠ€æœ¯ï¼Œè®©<u>æ¯ä¸ªè¿›ç¨‹è½®æµå ç”¨å¤„ç†å™¨ï¼Œæ¯æ¬¡åªæ‰§è¡Œä¸€å°ä¸ªæ—¶é—´ç‰‡å¹¶å¿«é€Ÿåˆ‡æ¢</u> ï¼›</li><li><strong>ç©ºåˆ†å¤ç”¨æŠ€æœ¯</strong>ï¼š <u>ç‰©ç†å†…å­˜æŠ½è±¡ä¸ºåœ°å€ç©ºé—´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å„è‡ªçš„åœ°å€ç©ºé—´</u>ã€‚åœ°å€ç©ºé—´çš„é¡µè¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œåœ°å€ç©ºé—´çš„é¡µå¹¶ä¸éœ€è¦å…¨éƒ¨åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œå½“ä½¿ç”¨åˆ°ä¸€ä¸ªæ²¡æœ‰åœ¨ç‰©ç†å†…å­˜çš„é¡µæ—¶ï¼Œæ‰§è¡Œé¡µé¢ç½®æ¢ç®—æ³•ï¼Œå°†è¯¥é¡µç½®æ¢åˆ°å†…å­˜ä¸­ã€‚</li></ul><h4 id="1-ä»‹ç»ä¸€ä¸‹å±€éƒ¨æ€§åŸç†å§ï¼Ÿ">1. ä»‹ç»ä¸€ä¸‹å±€éƒ¨æ€§åŸç†å§ï¼Ÿ</h4><p>å±€éƒ¨æ€§åŸç†æ˜¯è™šæ‹Ÿå†…å­˜æŠ€æœ¯çš„åŸºç¡€ï¼Œæ­£æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå…·æœ‰å±€éƒ¨æ€§åŸç†ï¼Œæ‰å¯ä»¥åªè£…â¼Šéƒ¨åˆ†ç¨‹åºåˆ°å†…å­˜å°±å¼€å§‹è¿è¡Œã€‚</p><p>å±€éƒ¨æ€§åŸç†è¡¨ç°åœ¨ä»¥ä¸‹ä¸¤ä¸ªâ½…é¢ï¼š</p><ol><li><strong>æ—¶é—´å±€éƒ¨æ€§</strong>ï¼šå¦‚æœç¨‹åºä¸­çš„<strong>æŸæ¡æŒ‡ä»¤</strong>â¼€æ—¦æ‰§è¡Œï¼Œä¸ä¹…ä»¥å<strong>è¯¥æŒ‡ä»¤å¯èƒ½å†æ¬¡æ‰§</strong>è¡Œï¼›å¦‚æœæŸæ•°æ®è¢«è®¿é—®è¿‡ï¼Œä¸ä¹…ä»¥åè¯¥æ•°æ®å¯èƒ½å†æ¬¡è¢«è®¿é—®ã€‚äº§â½£æ—¶é—´å±€éƒ¨æ€§çš„å…¸å‹åŸå› ï¼Œæ˜¯ç”±äºåœ¨ç¨‹åºä¸­å­˜åœ¨ç€å¤§é‡çš„å¾ªç¯æ“ä½œã€‚</li></ol><blockquote><p>æ—¶é—´å±€éƒ¨æ€§æ˜¯é€šè¿‡å°†è¿‘æ¥ä½¿ç”¨çš„æŒ‡ä»¤å’Œæ•°æ®ä¿å­˜åˆ°é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ä¸­ï¼Œå¹¶ä½¿ç”¨é«˜é€Ÿç¼“å­˜çš„å±‚æ¬¡ç»“æ„å®ç°ã€‚</p></blockquote><ol start="2"><li><strong>ç©ºé—´å±€éƒ¨æ€§</strong>ï¼šâ¼€æ—¦ç¨‹åºè®¿é—®äº†<strong>æŸä¸ªå­˜å‚¨å•å…ƒ</strong>ï¼Œåœ¨ä¸ä¹…ä¹‹åï¼Œå…¶<strong>é™„è¿‘çš„å­˜å‚¨å•</strong>å…ƒä¹Ÿå°†è¢«è®¿é—®ï¼Œå³ç¨‹åºåœ¨â¼€æ®µæ—¶é—´å†…æ‰€è®¿é—®çš„åœ°å€ï¼Œå¯èƒ½é›†ä¸­åœ¨â¼€å®šçš„èŒƒå›´ä¹‹å†…ï¼Œè¿™æ˜¯å› ä¸ºæŒ‡ä»¤é€šå¸¸æ˜¯é¡ºåºå­˜æ”¾ã€é¡ºåºæ‰§è¡Œçš„ï¼Œæ•°æ®ä¹Ÿâ¼€èˆ¬æ˜¯ä»¥å‘é‡ã€æ•°ç»„ã€è¡¨ç­‰å½¢å¼ç°‡èšå­˜å‚¨çš„ã€‚</li></ol><blockquote><p>ç©ºé—´å±€éƒ¨æ€§é€šå¸¸æ˜¯ä½¿ç”¨æ•™å¤§çš„é«˜é€Ÿç¼“å­˜ï¼Œå¹¶å°†é¢„å–æœºåˆ¶é›†æˆåˆ°é«˜é€Ÿç¼“å­˜æ§åˆ¶é€»è¾‘ä¸­å®ç°ã€‚</p></blockquote><p>è™šæ‹Ÿå†…å­˜æŠ€æœ¯å®é™…ä¸Šå°±æ˜¯å»ºâ½´äº† â€œå†…å­˜â¼€å¤–å­˜â€çš„ä¸¤çº§å­˜å‚¨å™¨çš„ç»“æ„ï¼Œåˆ©ç”¨å±€éƒ¨æ€§åŸç†å®ç°é«™é€Ÿç¼“å­˜ã€‚</p><h4 id="2-ä»‹ç»ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Ÿé¡µå¼å­˜å‚¨ï¼Ÿ">2.<strong>ä»‹ç»ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯è™šæ‹Ÿå†…å­˜ï¼Ÿé¡µå¼å­˜å‚¨</strong>ï¼Ÿ</h4><ul><li><p><strong>è™šæ‹Ÿå†…å­˜</strong></p><p>è™šæ‹Ÿå†…å­˜æ˜¯ä¸€ç§å­˜å‚¨æœºåˆ¶ï¼Œå¯ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ‹¥æœ‰å¾ˆå¤§ä¸»å†…å­˜çš„é”™è§‰ã€‚<strong>é€šè¿‡å°†è¾…å­˜çš„ä¸€éƒ¨åˆ†ä½œä¸ºä¸»å­˜</strong>æ¥å®Œæˆã€‚åœ¨è™šæ‹Ÿå†…å­˜ä¸­ï¼Œç”¨æˆ·å¯ä»¥å­˜å‚¨æ¯”å¯ç”¨ä¸»å†…å­˜æ›´å¤§çš„è¿›ç¨‹ã€‚</p><blockquote><p>æ¯ä¸ªè¿›ç¨‹åˆ›å»ºåŠ è½½çš„æ—¶å€™ï¼Œä¼šè¢«åˆ†é…ä¸€ä¸ªå¤§å°ä¸º4Gçš„è¿ç»­çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä»…ä»…æ˜¯æ¯ä¸ªè¿›ç¨‹â€œè®¤ä¸ºâ€è‡ªå·±æ‹¥æœ‰4Gçš„å†…å­˜ã€‚ç­‰åˆ°è¿›ç¨‹çœŸæ­£è¿è¡Œçš„æ—¶å€™ï¼Œ<strong>éœ€è¦æŸäº›æ•°æ®å¹¶ä¸”æ•°æ®ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œæ‰ä¼šè§¦å‘ç¼ºé¡µå¼‚å¸¸ï¼Œè¿›è¡Œç£ç›˜æ•°æ®æ‹·è´åˆ°ç‰©ç†å†…å­˜ä¸­</strong></p></blockquote><p><img src="https://i.loli.net/2021/04/20/NO5zyG824P9FSHs.jpg" alt="img"></p></li><li><p><strong>é¡µå¼å­˜å‚¨</strong></p><p>å¤§éƒ¨åˆ†è™šæ‹Ÿå­˜å‚¨ç³»ç»Ÿé‡‡ç”¨çš„æ˜¯ä¸€ç§ç§°ä¸º<strong>åˆ†é¡µï¼ˆpaging</strong>ï¼‰çš„æŠ€æœ¯ã€‚è¿™ç§æ–¹å¼å«åšè™šæ‹Ÿé¡µå¼å­˜å‚¨ç®¡ç†ã€‚</p><ul><li><p>ç‰©ç†å†…å­˜ç©ºé—´åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„å†…å­˜å—ï¼Œç§°ä¸ºç‰©ç†é¡µé¢ï¼Œæˆ–è€…æ˜¯<strong>é¡µæ¡†</strong>ï¼ˆpage frameï¼‰</p></li><li><p>è™šæ‹Ÿåœ°å€ç©ºé—´ä¹Ÿåˆ’åˆ†æˆå¤§å°ç›¸åŒçš„å—ï¼Œç§°ä¸ºè™šæ‹Ÿé¡µé¢ï¼Œæˆ–è€…ç®€ç§°<strong>é¡µé¢</strong>ï¼ˆpageï¼‰</p><blockquote><p>é¡µè¡¨ï¼šå°†<strong>è™šæ‹Ÿé¡µé¢æ˜ å°„ä¸º</strong>ç›¸åº”çš„<strong>ç‰©ç†é¡µé¢</strong>ã€‚</p></blockquote></li></ul></li></ul><h4 id="3-è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å®ç°-ï¼Ÿ">3. è™šæ‹Ÿå†…å­˜çš„æŠ€æœ¯å®ç° ï¼Ÿ</h4><p>è™šæ‹Ÿå†…å­˜çš„å®ç°éœ€è¦å»ºâ½´åœ¨ç¦»æ•£åˆ†é…çš„å†…å­˜ç®¡ç†â½…å¼çš„åŸºç¡€ä¸Šã€‚ è™šæ‹Ÿå†…å­˜çš„å®ç°æœ‰ä»¥ä¸‹ä¸‰ç§â½…å¼ï¼š</p><ol><li><strong>è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†</strong> ï¼šå»ºâ½´åœ¨åˆ†é¡µç®¡ç†ä¹‹ä¸Šï¼Œä¸ºäº†æ”¯æŒè™šæ‹Ÿå­˜å‚¨å™¨åŠŸèƒ½è€Œå¢åŠ äº†<strong>è¯·æ±‚è°ƒé¡µåŠŸèƒ½å’Œé¡µé¢ç½®æ¢åŠŸèƒ½</strong>ã€‚è¯·æ±‚åˆ†é¡µæ˜¯â½¬å‰æœ€å¸¸ç”¨çš„â¼€ç§å®ç°è™šæ‹Ÿå­˜å‚¨å™¨çš„â½…æ³•ã€‚è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œåœ¨ä½œä¸šå¼€å§‹è¿è¡Œä¹‹å‰ï¼Œä»…è£…â¼Šå½“å‰è¦æ‰§è¡Œçš„éƒ¨åˆ†é¡µå³å¯è¿è¡Œã€‚å‡å¦‚åœ¨ä½œä¸šè¿è¡Œçš„è¿‡ç¨‹ä¸­å‘ç°è¦è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜ï¼Œåˆ™ç”±å¤„ç†å™¨é€šçŸ¥æ“ä½œç³»ç»ŸæŒ‰ç…§å¯¹åº”çš„é¡µé¢ç½®æ¢ç®—æ³•å°†ç›¸åº”çš„é¡µé¢è°ƒâ¼Šåˆ°ä¸»å­˜ï¼ŒåŒæ—¶æ“ä½œç³»ç»Ÿä¹Ÿå¯ä»¥å°†æš‚æ—¶ä¸ç”¨çš„é¡µé¢ç½®æ¢åˆ°å¤–å­˜ä¸­ã€‚</li><li><strong>è¯·æ±‚åˆ†æ®µå­˜å‚¨ç®¡ç†</strong>ï¼šå»ºâ½´åœ¨åˆ†æ®µå­˜å‚¨ç®¡ç†ä¹‹ä¸Šï¼Œå¢åŠ äº†<strong>è¯·æ±‚è°ƒæ®µåŠŸèƒ½ã€åˆ†æ®µç½®æ¢åŠŸèƒ½</strong>ã€‚è¯·æ±‚åˆ†æ®µå‚¨å­˜ç®¡ç†â½…å¼å°±å¦‚åŒè¯·æ±‚åˆ†é¡µå‚¨å­˜ç®¡ç†â½…å¼â¼€æ ·ï¼Œåœ¨ä½œä¸šå¼€å§‹è¿è¡Œä¹‹å‰ï¼Œä»…è£…â¼Šå½“å‰è¦æ‰§è¡Œçš„éƒ¨åˆ†æ®µå³å¯è¿è¡Œï¼›åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä½¿ç”¨è¯·æ±‚è°ƒâ¼Šä¸­æ–­åŠ¨æ€è£…â¼Šè¦è®¿é—®ä½†â¼œä¸åœ¨å†…å­˜çš„ç¨‹åºæ®µï¼›å½“å†…å­˜ç©ºé—´å·²æ»¡ï¼Œè€Œâ¼œéœ€è¦è£…â¼Šæ–°çš„æ®µæ—¶ï¼Œæ ¹æ®ç½®æ¢åŠŸèƒ½é€‚å½“è°ƒå‡ºæŸä¸ªæ®µï¼Œä»¥ä¾¿è…¾å‡ºç©ºé—´è€Œè£…â¼Šæ–°çš„æ®µã€‚</li><li><strong>è¯·æ±‚æ®µé¡µå¼å­˜å‚¨ç®¡ç†</strong></li></ol><h4 id="4-è¯·ä½ ä»‹ç»ä¸€ä¸‹é¡µé¢ç½®æ¢ç®—æ³•ï¼Ÿ">4. è¯·ä½ ä»‹ç»ä¸€ä¸‹é¡µé¢ç½®æ¢ç®—æ³•ï¼Ÿ</h4><p>å½“å‘â½£ç¼ºé¡µä¸­æ–­æ—¶ï¼Œå¦‚æœå½“å‰å†…å­˜ä¸­å¹¶æ²¡æœ‰ç©ºé—²çš„é¡µé¢ï¼Œæ“ä½œç³»ç»Ÿå°±å¿…é¡»åœ¨å†…å­˜é€‰æ‹©â¼€ä¸ªé¡µé¢å°†å…¶ç§»å‡ºå†…å­˜ï¼Œä»¥ä¾¿ä¸ºå³å°†è°ƒâ¼Šçš„é¡µé¢è®©å‡ºç©ºé—´ã€‚ç”¨æ¥é€‰æ‹©æ·˜æ±°å“ªâ¼€é¡µçš„è§„åˆ™å«åšé¡µé¢ç½®æ¢ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé¡µ<br>â¾¯ç½®æ¢ç®—æ³•çœ‹æˆæ˜¯æ·˜æ±°é¡µé¢çš„è§„åˆ™ã€‚</p><ul><li><p><strong>OPT ï¼ˆæœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•ï¼‰</strong>ï¼šæœ€ä½³(Optimal, OPT)ç½®æ¢ç®—æ³•æ‰€é€‰æ‹©çš„è¢«æ·˜æ±°é¡µé¢å°†æ˜¯ä»¥åæ°¸ä¸ä½¿ç”¨çš„ï¼Œæˆ–è€…æ˜¯åœ¨æœ€â»“æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢,è¿™æ ·å¯ä»¥ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡ã€‚</p><blockquote><p>ä½†ç”±äºâ¼ˆä»¬â½¬å‰æ— æ³•é¢„çŸ¥è¿›ç¨‹åœ¨å†…å­˜ä¸‹çš„è‹¥åƒé¡µé¢ä¸­å“ªä¸ªæ˜¯æœªæ¥æœ€â»“æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„ï¼Œå› â½½è¯¥ç®—æ³•æ— æ³•å®ç°ã€‚â¼€èˆ¬ä½œä¸ºè¡¡é‡å…¶ä»–ç½®æ¢ç®—æ³•çš„â½…æ³•ã€‚</p></blockquote></li><li><p><strong>FIFOï¼ˆFirst In First Outï¼‰ ï¼ˆå…ˆè¿›å…ˆå‡ºé¡µé¢ç½®æ¢ç®—æ³•</strong>ï¼‰: æ€»æ˜¯æ·˜æ±°æœ€å…ˆè¿›â¼Šå†…å­˜çš„é¡µé¢ï¼Œå³é€‰æ‹©åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€ä¹…çš„é¡µé¢è¿›è¡Œæ·˜æ±°ã€‚</p></li><li><p><strong>LRU ï¼ˆLeast Currently Usedï¼‰ï¼ˆæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•</strong>ï¼‰ï¼šLRUç®—æ³•èµ‹äºˆæ¯ä¸ªé¡µé¢â¼€ä¸ªè®¿é—®å­—æ®µï¼Œç”¨æ¥è®°å½•â¼€ä¸ªé¡µé¢â¾ƒä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»å†çš„æ—¶é—´ Tï¼Œå½“é¡»æ·˜æ±°â¼€ä¸ªé¡µé¢æ—¶ï¼Œé€‰æ‹©ç°æœ‰é¡µé¢ä¸­å…¶ T å€¼æœ€å¤§çš„ï¼Œå³æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚</p></li><li><p><strong>LFU ï¼ˆLeast Frequently Usedï¼‰ï¼ˆæœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•</strong>ï¼‰: è¯¥ç½®æ¢ç®—æ³•é€‰æ‹©åœ¨å‰æ—¶æœŸä½¿ç”¨æœ€å°‘çš„é¡µé¢ä½œä¸ºæ·˜æ±°é¡µã€‚</p></li></ul><h4 id="5-ä½ æ€ä¹ˆç†è§£æ“ä½œç³»ç»Ÿé‡Œçš„å†…å­˜ç¢ç‰‡ï¼Œæœ‰ä»€ä¹ˆè§£å†³åŠæ³•ï¼Ÿ">5.<strong>ä½ æ€ä¹ˆç†è§£æ“ä½œç³»ç»Ÿé‡Œçš„å†…å­˜ç¢ç‰‡ï¼Œæœ‰ä»€ä¹ˆè§£å†³åŠæ³•</strong>ï¼Ÿ</h4><p>å†…å­˜ç¢ç‰‡åˆ†ä¸ºï¼šå†…éƒ¨ç¢ç‰‡å’Œå¤–éƒ¨ç¢ç‰‡ã€‚</p><ul><li><p><strong>å†…éƒ¨ç¢ç‰‡</strong>ï¼š å·²ç»<strong>è¢«åˆ†é…</strong>å‡ºå»ï¼ˆèƒ½æ˜ç¡®æŒ‡å‡ºå±äºå“ªä¸ªè¿›ç¨‹ï¼‰å´<strong>ä¸èƒ½è¢«åˆ©ç”¨</strong>çš„å†…å­˜ç©ºé—´ï¼›</p><blockquote><p><strong>å†…å­˜æ³„æ¼</strong>ï¼šä¸å†ä¼šè¢«ä½¿ç”¨çš„<strong>å¯¹è±¡</strong>çš„å†…å­˜ä¸èƒ½è¢«<strong>å›æ”¶</strong> ã€‚</p></blockquote></li><li><p><strong>å¤–éƒ¨ç¢ç‰‡</strong>ï¼š è¿˜<strong>æ²¡æœ‰è¢«åˆ†é…</strong>å‡ºå»ï¼ˆä¸å±äºä»»ä½•è¿›ç¨‹ï¼‰ï¼Œä½†ç”±äº<strong>å¤ªå°äº†æ— æ³•åˆ†é…</strong>ï¼Œç»™ç”³è¯·å†…å­˜ç©ºé—´çš„æ–°è¿›ç¨‹çš„å†…å­˜ç©ºé—²åŒºåŸŸã€‚</p></li></ul><h4 id="6-ä»€ä¹ˆæ˜¯å†…å­˜æŠ–åŠ¨ï¼Ÿ">6. ä»€ä¹ˆæ˜¯å†…å­˜æŠ–åŠ¨ï¼Ÿ</h4><ul><li><strong>ç°è±¡</strong>ï¼šåˆšåˆšæ¢å‡ºçš„é¡µé¢é©¬ä¸Šåˆè¦æ¢å…¥å†…å­˜ï¼Œåˆšåˆšæ¢å…¥çš„é¡µé¢é©¬ä¸Šåˆè¦æ¢å‡ºå¤–å­˜ï¼Œè¿™ç§<strong>é¢‘ç¹çš„é¡µé¢è°ƒåº¦è¡Œä¸º</strong>ç§°ä¸ºæŠ–åŠ¨ï¼Œæˆ–é¢ ç°¸ï¼›</li><li><strong>åŸå› </strong>ï¼š ç¨‹é¢‘ç¹è®¿é—®çš„é¡µé¢æ•°ç›®é«˜äºå¯ç”¨çš„ç‰©ç†å—æ•°(åˆ†é…ç»™è¿›ç¨‹çš„ç‰©ç†å—ä¸å¤Ÿ) ï¼›</li><li><strong>è§£å†³</strong>ï¼š åˆ†é…æ›´å¤šçš„ç‰©ç†å—</li></ul><h2 id="4-6-å¹¶å‘å’Œæ­»é”">4.6 å¹¶å‘å’Œæ­»é”</h2><h4 id="0-ä»‹ç»å‡ ç§å…¸å‹çš„é”ï¼Ÿ">0. ä»‹ç»å‡ ç§å…¸å‹çš„é”ï¼Ÿ</h4><ol><li><strong>è¯»å†™é”</strong>ã€‚ å¯ä»¥åŒæ—¶è¯»ï¼Œä½†å†™å¿…é¡»äº’æ–¥ï¼Œåªå…è®¸ä¸€ä¸ªå†™ï¼›</li><li><strong>äº’æ–¥é”</strong>ã€‚ ä¸€æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰é”ï¼Œå…¶å®ƒåªèƒ½ç­‰å¾…ï¼›</li><li><strong>æ¡ä»¶å˜é‡</strong>ï¼š  äº’æ–¥é”ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹æ˜¯ä»–åªæœ‰ä¸¤ç§çŠ¶æ€ï¼šé”å®šå’Œéé”å®šï¼›è€Œæ¡ä»¶å˜é‡<strong>é€šè¿‡å…è®¸çº¿ç¨‹é˜»å¡å’Œç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å‘é€ä¿¡å·</strong>çš„æ–¹æ³•å¼¥è¡¥äº†äº’æ–¥é”çš„ä¸è¶³ï¼›</li><li><strong>è‡ªæ—‹é”</strong>ã€‚ å¦‚æœè¿›çº¿ç¨‹æ— æ³•å–å¾—é”ï¼Œè¿›çº¿ç¨‹ä¸ä¼šç«‹åˆ»æ”¾å¼ƒCPUæ—¶é—´ç‰‡ï¼Œè€Œæ˜¯ä¸€ç›´å¾ªç¯å°è¯•è·å–é”ï¼Œç›´åˆ°è·å–ä¸ºæ­¢ã€‚</li></ol><h4 id="1-ã€é‡ç‚¹ã€‘ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ­»é”ï¼Ÿè§£å†³æ­»é”çš„ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ">1. ã€<strong>é‡ç‚¹</strong>ã€‘<strong>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ­»é”ï¼Ÿè§£å†³æ­»é”çš„ç­–ç•¥æœ‰å“ªäº›</strong>ï¼Ÿ</h4><ul><li><p><strong>ä»€ä¹ˆæ˜¯æ­»é”</strong></p><p>æ­»é”æ˜¯æŒ‡<u>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡</u>ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç§°ä¸ºæ­»é”è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ã€‚</p></li><li><p><strong>å‘ç”Ÿæ­»é”çš„æ¡ä»¶</strong></p><ol><li><strong>äº’æ–¥</strong>ï¼šä¸€ä¸ªèµ„æºåªèƒ½ç»™ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼›</li><li><strong>å æœ‰å¹¶ç­‰å¾…</strong>ï¼šè¿›ç¨‹æŒæœ‰èµ„æºå¹¶ç”³è¯·æ–°èµ„æºï¼Œåœ¨ç”³è¯·åˆ°éœ€è¦çš„èµ„æºä¹‹å‰ï¼Œ<u>å·²æœ‰çš„èµ„æºä¸é‡Šæ”¾</u>ï¼›</li><li><strong>ä¸å¯å‰¥å¤º</strong>ï¼šè¿›ç¨‹ç”³è¯·åˆ°çš„èµ„æºåœ¨ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸å¯ä»¥è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ï¼›</li><li><strong>å¾ªç¯ç­‰å¾…</strong>ï¼šå„ä¸ªè¿›ç¨‹çš„èµ„æºè¯·æ±‚å½¢æˆé¦–å°¾è¿æ¥å¾ªç¯ç­‰å¾…ã€‚</li></ol></li><li><p><strong>è§£å†³æ–¹æ³•ï¼šé¢„é˜²ï¼Œé¿å…ï¼Œæ£€æµ‹ä¸æ¢å¤ä¸‰ç§</strong></p><ol><li><strong>é¢„é˜²ï¼šç ´åæ­»é”ä¼šå‘ç”Ÿçš„å››ä¸ªæ¡ä»¶</strong><ul><li>ç ´åäº’æ–¥ï¼šè¿™ä¸ªæ¡ä»¶æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç ´åï¼Œå› ä¸ºæˆ‘ä»¬ç”¨é”æœ¬æ¥å°±æ˜¯æƒ³è®©ä»–ä»¬äº’æ–¥çš„</li><li><strong>ç ´åè¯·æ±‚å’Œä¿æŒ</strong>ï¼šå®è¡Œèµ„æºé¢„å…ˆåˆ†é…ç­–ç•¥ã€‚å³è¿›ç¨‹åœ¨è¿è¡Œå‰ä¸€æ¬¡æ€§åœ°å‘ç³»ç»Ÿç”³è¯·å®ƒæ‰€éœ€è¦çš„å…¨éƒ¨èµ„æºï¼›</li><li><strong>ç ´åä¸å‰¥å¤ºæ¡ä»¶</strong> ï¼šå ç”¨éƒ¨åˆ†èµ„æºçš„çº¿ç¨‹è¿›â¼€æ­¥ç”³è¯·å…¶ä»–èµ„æºæ—¶ï¼Œ<strong>å¦‚æœç”³è¯·ä¸åˆ°</strong>ï¼Œå¯ä»¥<strong>ä¸»åŠ¨é‡Šæ”¾å®ƒå æœ‰çš„èµ„æº</strong>ï¼›</li><li><strong>ç ´åå¾ªç¯ç­‰å¾…</strong>ï¼šèµ„æºåˆ†ç±»æ ‡å·ï¼Œè¿›è¡Œæœ‰åºåˆ†é…ã€‚</li></ul></li><li><strong>é¿å…</strong>ï¼š <u>å®ƒä¸é™åˆ¶è¿›ç¨‹æœ‰å…³ç”³è¯·èµ„æºçš„å‘½ä»¤</u>ï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹æ‰€å‘å‡ºçš„æ¯ä¸€ä¸ªç”³è¯·èµ„æºå‘½ä»¤åŠ ä»¥<strong>åŠ¨æ€åœ°æ£€æŸ¥</strong>ï¼Œå¹¶æ ¹æ®æ£€æŸ¥ç»“æœå†³å®šæ˜¯å¦è¿›è¡Œèµ„æºåˆ†é…<ul><li><strong>å®‰å…¨åºåˆ—</strong>ï¼šæ‰¾åˆ°ä¸€ç§èƒ½è®©è¿›ç¨‹å®‰å…¨æ‰§è¡Œå®Œçš„æœ‰åºåºåˆ—<code>&#123;P1ï¼ŒP2ï¼Œ...ï¼ŒPn&#125;</code></li><li><strong>é“¶è¡Œå®¶ç®—æ³•</strong>ï¼šç³»ç»Ÿåœ¨ä¸ºè¿›ç¨‹åˆ†é…èµ„æºä¹‹å‰ï¼Œé¦–å…ˆè®¡ç®—æ­¤æ¬¡èµ„æºåˆ†é…çš„å®‰å…¨æ€§ï¼Œ<strong>å¦‚æœæ˜¯å®‰å…¨çš„ï¼Œåˆ™è¿›è¡Œåˆ†é…</strong>ï¼›å¦‚æœè¿™æ¬¡åˆ†é…ä¼šå¯¼è‡´è¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œä¸è¿›è¡Œåˆ†é…ã€‚</li></ul></li><li><strong>æ¢å¤</strong>ï¼š ç”¨<u>èµ„æºåˆ†é…å›¾ã€è¿›ç¨‹ç­‰å¾…å›¾</u>æ¥ååŠ©è¿™ç§æ£€æµ‹å‡ºæ­»é”ï¼Œç„¶åè¿›è¡Œæ¢å¤ã€‚<ul><li>ç³»ç»Ÿé‡æ–°å¯åŠ¨ï¼Œä½†ä»£ä»·å¾ˆå¤§</li><li><strong>æ’¤æ¶ˆå‚ä¸æ­»é”çš„å…¨éƒ¨æˆ–éƒ¨åˆ†è¿›ç¨‹ï¼Œå‰¥å¤ºèµ„æº</strong></li></ul></li></ol></li></ul><h5 id="1-1-ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Ÿ">1.1 <strong>ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”</strong>ï¼Ÿ</h5><ul><li>åœ¨<strong>å•ä½“åº”ç”¨çš„</strong>æ—¶å€™ï¼Œå¦‚æœ<strong>å¤šä¸ªçº¿ç¨‹è¦è®¿é—®å…±äº«èµ„æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸çº¿ç¨‹é—´åŠ é”çš„æœºåˆ¶</strong>ï¼Œåœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹è¿™ä¸ªèµ„æºè¿›è¡Œæ“ä½œï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…é”çš„é‡Šæ”¾ï¼ŒJavaä¸­ä¹Ÿæœ‰ä¸€äº›å¤„ç†é”çš„æœºåˆ¶ï¼Œæ¯”å¦‚synchronizedã€‚</li><li>è€Œåˆ°äº†<strong>åˆ†å¸ƒå¼çš„ç¯å¢ƒ</strong>ä¸­ï¼Œå½“<strong>æŸä¸ªèµ„æºå¯ä»¥è¢«å¤šä¸ªç³»ç»Ÿè®¿é—®ä½¿ç”¨åˆ°çš„æ—¶å€™ï¼ˆä¾‹å¦‚ï¼Œæœ‰å¤šä¸ªå®¢æˆ·ç«¯éœ€è¦è®¿é—®å¹¶æ“ä½œåŒä¸€ä¸ªèµ„æºï¼Œè¿˜éœ€è¦ä¿æŒè¿™ä¸ªèµ„æºä¸€è‡´æ€§çš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ã€åˆ†å¸ƒå¼é”ï¼‰</strong>ï¼Œä¸ºäº†ä¿è¯å¤§å®¶è®¿é—®è¿™ä¸ªæ•°æ®æ˜¯ä¸€è‡´æ€§çš„ï¼Œé‚£ä¹ˆå°±è¦æ±‚å†åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½è¢«ä¸€ä¸ªç³»ç»Ÿä½¿ç”¨ï¼Œè¿™æ—¶å€™<strong>çº¿ç¨‹ä¹‹é—´çš„é”æœºåˆ¶å°±æ— æ³•èµ·åˆ°ä½œç”¨</strong>äº†ï¼Œå› ä¸ºåˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç³»ç»Ÿæ˜¯ä¼šéƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šé¢çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ã€åˆ†å¸ƒå¼é”ã€‘äº†ã€‚</li></ul><h4 id="2-ï¼ˆå¾…è¡¥å……ï¼‰è¯·ä½ è§£é‡Šä¸€ä¸‹ï¼Œé€šå¸¸ç³»ç»ŸCPUæ¯”è¾ƒé«˜æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ">2. ï¼ˆå¾…è¡¥å……ï¼‰<strong>è¯·ä½ è§£é‡Šä¸€ä¸‹ï¼Œé€šå¸¸ç³»ç»ŸCPUæ¯”è¾ƒé«˜æ˜¯ä»€ä¹ˆåŸå› </strong>ï¼Ÿ</h4><ol><li>é¦–å…ˆæŸ¥çœ‹æ˜¯å“ªäº›è¿›ç¨‹çš„CPUå ç”¨ç‡æœ€é«˜</li></ol><h4 id="3-è¯´ä¸€ä¸‹NIOï¼ŒBIOï¼ŒAIOåŒºåˆ«">3.<strong>è¯´ä¸€ä¸‹NIOï¼ŒBIOï¼ŒAIOåŒºåˆ«?</strong></h4><blockquote><p>å‚è€ƒï¼š<a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/basis/IO%E6%A8%A1%E5%9E%8B.md">JAVaGuide</a></p></blockquote><p>ã€<strong>BIOï¼ˆåŒæ­¥é˜»å¡ï¼‰</strong>ã€‘</p><ul><li><p><strong>BIO</strong>ï¼šåŒæ­¥é˜»å¡ IO æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºå‘èµ· read è°ƒç”¨åï¼Œä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°åœ¨å†…æ ¸æŠŠ<u> </u>ã€‚</p><img src="https://i.loli.net/2021/05/06/HqJyg2Ykxtm6Wba.png" alt="å›¾æºï¼šã€Šæ·±å…¥æ‹†è§£Tomcat & Jettyã€‹" style="zoom: 67%;" /></li></ul><p>ã€<strong>NIOï¼ˆåŒæ­¥éé˜»å¡ï¼‰</strong>ã€‘</p><p>NIO æœ¬èº«æ˜¯åŸºäº <u>äº‹ä»¶é©±åŠ¨</u> çš„æ€æƒ³æ¥å®ç°çš„ï¼Œå…¶ç›®çš„å°±æ˜¯è§£å†³ BIO çš„å¤§å¹¶å‘é—®é¢˜ï¼š</p><ul><li>BIO æ¨¡å‹ä¸­ï¼Œ<strong>å¦‚æœéœ€è¦å¹¶å‘å¤„ç†å¤šä¸ª I/O è¯·æ±‚ï¼Œé‚£å°±éœ€è¦å¤šçº¿ç¨‹æ¥æ”¯æŒ</strong>ï¼›</li><li><strong>IO å¤šè·¯å¤ç”¨æ¨¡å‹</strong>ä¸­ï¼Œçº¿ç¨‹é¦–å…ˆå‘èµ· <u>select è°ƒç”¨ï¼Œè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å°±ç»ª</u>ï¼Œç­‰å†…æ ¸æŠŠæ•°æ®å‡†å¤‡å¥½äº†ï¼Œç”¨æˆ·çº¿ç¨‹å†å‘èµ· <strong>read è°ƒç”¨</strong>ã€‚<strong>read è°ƒç”¨çš„è¿‡ç¨‹ï¼ˆæ•°æ®ä»å†…æ ¸ç©ºé—´-&gt;ç”¨æˆ·ç©ºé—´ï¼‰è¿˜æ˜¯é˜»å¡çš„</strong>ã€‚</li></ul><img src="https://i.loli.net/2021/05/06/9iJE3IaVOW2xAwh.png" alt="img" style="zoom:67%;" /><p>ã€<strong>AIOï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰</strong>ã€‘</p><blockquote><p>Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥ IO æ¨¡å‹ ã€‚</p></blockquote><p><strong>AIOï¼š</strong> å¼‚æ­¥éé˜»å¡æ— éœ€ä¸€ä¸ªçº¿ç¨‹å»è½®è¯¢æ‰€æœ‰IOæ“ä½œçš„çŠ¶æ€æ”¹å˜ï¼Œåœ¨ç›¸åº”çš„çŠ¶æ€æ”¹å˜åï¼Œç³»ç»Ÿä¼šé€šçŸ¥å¯¹åº”çš„çº¿ç¨‹æ¥å¤„ç†ã€‚</p><blockquote><p>å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œ<strong>å›è°ƒæœºåˆ¶</strong>å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/06/uIcCQeBUliqT2gk.png" alt="img" style="zoom:67%;" />0.</p><h4 id="4-ã€é‡ç‚¹ã€‘ä»‹ç»ä¸€ä¸‹selectï¼Œpollï¼Œepoll-åŸç†ï¼Ÿ">4. ã€é‡ç‚¹ã€‘<strong>ä»‹ç»ä¸€ä¸‹selectï¼Œpollï¼Œepoll åŸç†ï¼Ÿ</strong></h4><blockquote><p><strong>å‚è€ƒ</strong></p><ol><li><a href="https://blog.csdn.net/jiejiemcu/article/details/107083724">selectã€pollã€epollçš„åŸç†ä¸åŒºåˆ«</a></li></ol></blockquote><h5 id="4-1-ä»é˜»å¡I-O-éé˜»å¡I-Oè¯´èµ·">4.1 ä»é˜»å¡I/O &amp; éé˜»å¡I/Oè¯´èµ·</h5><ul><li><p><strong>é˜»å¡I/O</strong></p><blockquote><p>åœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯é˜»å¡çš„ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/17/aJFOtPvy4xiMKkI.png" alt="image-20210517125922790"></p><ol><li>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†<code>read()/recvfrom()</code>ç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œå®ƒä¼šè¿›å…¥å†…æ ¸ç©ºé—´ä¸­ï¼›</li><li>å½“è¿™ä¸ªç½‘ç»œI/Oæ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œå†…æ ¸å°±è¦ç­‰å¾…æ•°æ®çš„åˆ°æ¥ï¼Œæ­¤æ—¶<strong>ç”¨æˆ·è¿›ç¨‹è¢«é˜»å¡</strong>ï¼›</li><li>å½“å†…æ ¸ç©ºé—´çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»<strong>å†…æ ¸ç©ºé—´ä¸­æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</strong>ï¼›</li><li>ç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤é˜»å¡çš„çš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œè¯»å–æ•°æ®ã€‚</li></ol></li><li><p><strong>éé˜»å¡I/O</strong></p><blockquote><p>linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºéé˜»å¡æ¨¡å¼ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå½“å†…æ ¸ç©ºé—´å¹¶æ— æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼š<u>é©¬ä¸Šè¿”å›ç»“æœè€Œä¸ä¼šé˜»å¡</u>ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/17/hW2DtsGBiU8AnHN.png" alt="image-20210517130232559"></p><ol><li>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†<code>read()/recvfrom()</code>ç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œå®ƒä¼šè¿›å…¥å†…æ ¸ç©ºé—´ä¸­ï¼›</li><li>å¦‚æœå†…æ ¸ç©ºé—´ä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šé˜»å¡ç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯<strong>ç«‹åˆ»è¿”å›ä¸€ä¸ªerror</strong>ï¼›</li><li>å¯¹äºåº”ç”¨è¿›ç¨‹æ¥è¯´ï¼Œå®ƒå‘èµ·ä¸€ä¸ª<code>read()</code>æ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥å†æ¬¡è°ƒç”¨read()/recvfrom()ç­‰å‡½æ•°ï¼›</li><li>å½“å†…æ ¸ç©ºé—´çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»å†…æ ¸ç©ºé—´ä¸­æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼›</li><li>ç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤é˜»å¡çš„çš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œè¯»å–æ•°æ®ã€‚</li></ol></li></ul><blockquote><p>å¤šè·¯å¤ç”¨I/Oå°±æ˜¯æˆ‘ä»¬è¯´çš„<code>selectï¼Œpollï¼Œepoll</code>ç­‰æ“ä½œï¼Œå¤ç”¨çš„å¥½å¤„å°±åœ¨äº<strong>å•ä¸ªè¿›ç¨‹</strong>å°±å¯ä»¥åŒæ—¶å¤„ç†<strong>å¤šä¸ª</strong>ç½‘ç»œè¿æ¥çš„I/Oï¼Œèƒ½å®ç°è¿™ç§åŠŸèƒ½çš„åŸç†å°±æ˜¯<code>selectã€pollã€epoll</code>ç­‰å‡½æ•°ä¼šä¸æ–­çš„<strong>è½®è¯¢</strong>å®ƒä»¬æ‰€è´Ÿè´£çš„æ‰€æœ‰<code>socket</code>ï¼Œå½“æŸä¸ª<code>socket</code>æœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚</p></blockquote><h5 id="4-2-selectåŸç†">4.2 selectåŸç†</h5><blockquote><p>æ›´åŠ æ·±åˆ»å¯¹æ¯”ç†è§£ï¼š<a href="https://www.cnblogs.com/skyfsm/p/7079458.html">Linuxç¼–ç¨‹ä¹‹select</a></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span> <span class="params">(<span class="keyword">int</span> n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>selectå‡½æ•°ç›‘è§†çš„æ–‡ä»¶socketæè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsï¼›</li><li>è°ƒç”¨åselect<strong>å‡½æ•°ä¼šé˜»å¡ï¼ˆä¸æ˜¯çº¿ç¨‹ï¼‰</strong>ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ® <u>å¯readã€å¯writeã€exceptã€è¶…æ—¶timeout</u>ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">select(socket);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>) </span><br><span class="line">&#123;</span><br><span class="line">sockets = select(); <span class="comment">// è¿˜æ˜¯è¦ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">for</span>(socket in sockets) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(can_read(socket)) </span><br><span class="line">&#123;</span><br><span class="line">read(socket, buffer);</span><br><span class="line">process(buffer);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¦ç»†æ‰§è¡ŒåŸç†å¦‚ä¸‹ï¼š</p><ol><li><p>ç”¨æˆ·é¦–å…ˆå°†éœ€è¦è¿›è¡ŒIOæ“ä½œçš„<strong>socketæ·»åŠ åˆ°select</strong>ä¸­ï¼Œç„¶å<strong>é˜»å¡å‡½æ•°selectï¼ˆä¸æ˜¯çº¿ç¨‹ï¼‰ç­‰å¾…ç³»ç»Ÿè°ƒç”¨è¿”å›</strong>ï¼›</p></li><li><p><strong>å½“æ•°æ®åˆ°è¾¾æ—¶ï¼Œsocketè¢«æ¿€æ´»ï¼Œselectå‡½æ•°è¿”å›</strong>ï¼Œä¼šå”¤é†’å…¶ç­‰å¾…é˜Ÿåˆ—ä¸Šç¡çœ çš„å†…æ ¸è¿›ç¨‹ï¼Œå³åœ¨<strong>socketå¯è¯»å†™æ—¶å”¤é†’</strong>ï¼Œæˆ–è€…åœ¨<strong>è¶…æ—¶</strong>åå”¤é†’ï¼›</p><blockquote><p>æ¯æ¬¡è°ƒç”¨<code>select</code>æŸ¥çœ‹fdï¼Œéƒ½éœ€è¦æŠŠfdé›†åˆæ‹·è´è¿›è¡Œç³»ç»Ÿè°ƒç”¨<strong>é™·å…¥å†…æ ¸æ€</strong> ã€‚</p></blockquote></li><li><p>è¿”å›<code>select()</code>å‡½æ•°çš„è°ƒç”¨ç»“æœç»™ç”¨æˆ·è¿›ç¨‹ï¼Œ<strong>è¿”å›å°±ç»ªsocketæè¿°ç¬¦çš„æ•°ç›®</strong>ï¼Œè¶…æ—¶è¿”å›0ï¼Œå‡ºé”™è¿”å›-1ï¼›</p></li><li><p>åœ¨select()å‡½æ•°è¿”å›å<strong>è¿˜æ˜¯éœ€è¦è½®è¯¢</strong>å»æ‰¾åˆ°å°±ç»ªçš„socketæè¿°ç¬¦çš„ï¼ˆ<u>å°†æ­¤å‰ä¼ å…¥å†…æ ¸ç©ºé—´çš„<code>fd_set</code>æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</u>ï¼‰ï¼Œæ­¤æ—¶ç”¨æˆ·è¿›ç¨‹æ‰å¯ä»¥å»æ“ä½œsocketï¼›</p></li><li><p>è¿›ç¨‹è°ƒç”¨<code>read() / recvfrom()</code> è¯»å–æ•°æ® ã€‚</p></li></ol><p><strong>selectä¼˜ç‚¹</strong>ï¼š</p><blockquote><p>ä»æµç¨‹ä¸Šæ¥çœ‹ï¼Œä½¿ç”¨selectå‡½æ•°è¿›è¡ŒIOè¯·æ±‚å’Œ<strong>åŒæ­¥é˜»å¡æ¨¡å‹</strong>æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œç”šè‡³è¿˜å¤šäº†æ·»åŠ ç›‘è§†socketï¼Œä»¥åŠè°ƒç”¨selectå‡½æ•°çš„é¢å¤–æ“ä½œï¼Œæ•ˆç‡æ›´å·®ã€‚</p><p><strong>é‚£ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨selectï¼Ÿ</strong></p></blockquote><ul><li>ä½¿ç”¨selectä»¥åæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ç”¨æˆ·å¯ä»¥åœ¨ä¸€<strong>ä¸ªçº¿ç¨‹å†…åŒæ—¶å¤„ç†å¤šä¸ªsocket</strong>çš„IOè¯·æ±‚ã€‚ç”¨æˆ·å¯ä»¥æ³¨å†Œå¤šä¸ªsocketï¼Œç„¶åä¸æ–­åœ°è°ƒç”¨selectè¯»å–è¢«æ¿€æ´»çš„socketï¼Œå³å¯è¾¾åˆ°åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…åŒæ—¶å¤„ç†å¤šä¸ªIOè¯·æ±‚çš„ç›®çš„ï¼›</li><li>è€Œåœ¨<strong>åŒæ­¥é˜»å¡æ¨¡å‹</strong>ä¸­ï¼Œå¿…é¡»é€šè¿‡<strong>å¤šçº¿ç¨‹çš„æ–¹å¼æ‰èƒ½è¾¾åˆ°è¿™ä¸ªç›®çš„</strong>ã€‚</li></ul><p><strong>selectç¼ºç‚¹</strong>ï¼š</p><ol><li><p><strong>æè¿°ç¬¦æ•°é‡</strong>ï¼š<code>select</code>æ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å¤ªå°äº†ï¼Œé»˜è®¤æ˜¯<code>1024</code>  ï¼›</p></li><li><p><strong>ç³»ç»Ÿå¼€é”€</strong>ï¼šæ¯æ¬¡è°ƒç”¨<code>select</code>éƒ½éœ€è¦æŠŠfdé›†åˆæ‹·è´è¿›è¡Œç³»ç»Ÿè°ƒç”¨<strong>é™·å…¥å†…æ ¸æ€</strong>ï¼Œè¿™ä¸ªå¼€é”€åœ¨fdå¾ˆå¤šæ—¶ä¼šå¾ˆå¤§ ï¼›</p></li><li><p><strong>äºŒæ¬¡è½®è¯¢</strong>ï¼š<code>select</code>éœ€è¦äºŒæ¬¡æŸ¥è¯¢æ‹·è´æ‰€æœ‰æ–‡ä»¶æè¿°fd_setè¿›è¡Œéå†æŸ¥çœ‹æ˜¯å¦æœ‰æè¿°ç¬¦å‡†å¤‡å°±ç»ªã€‚</p></li></ol><h5 id="4-3-pollåŸç†">4.3 pollåŸç†</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">poll</span> <span class="params">(struct pollfd *fds, <span class="keyword">unsigned</span> <span class="keyword">int</span> nfds, <span class="keyword">int</span> timeout)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> fd; <span class="comment">/* file descriptor */</span></span><br><span class="line">    <span class="keyword">short</span> events; <span class="comment">/* requested events to watch */</span></span><br><span class="line">    <span class="keyword">short</span> revents; <span class="comment">/* returned events witnessed */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸åŒä¸selectä½¿ç”¨ä¸‰ä¸ªä½å›¾æ¥è¡¨ç¤ºä¸‰ä¸ªfdsetçš„æ–¹å¼ï¼Œpollä½¿ç”¨ä¸€ä¸ª <strong>pollfdæŒ‡é’ˆ</strong>å®ç°ã€‚</p><blockquote><p>pollä½¿ç”¨<strong>é“¾è¡¨</strong>ç»´æŠ¤è¿™äº›socketæè¿°ç¬¦ï¼Œè€Œselectä½¿ç”¨çš„æ˜¯<strong>æ•°ç»„</strong>ï¼ˆä½å›¾ï¼‰ã€‚</p></blockquote><p>å…¶ä»–çš„éƒ½å·®ä¸å¤šå’Œselect()å‡½æ•°ä¸€æ ·ï¼Œpoll()å‡½æ•°è¿”å›åï¼Œéœ€è¦è½®è¯¢pollfdæ¥è·å–å°±ç»ªçš„æè¿°ç¬¦ï¼Œæ ¹æ®æè¿°ç¬¦çš„çŠ¶æ€è¿›è¡Œå¤„ç†ï¼Œ<u>ä½†æ˜¯pollæ²¡æœ‰æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡çš„é™åˆ¶</u>ã€‚</p><p><strong>pollç¼ºç‚¹</strong>ï¼š</p><p>è§£å†³äº†selecç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼ˆæ–‡ä»¶æè¿°ç¬¦æ•°é‡å¤ªå°‘ï¼‰ï¼Œä½†æ˜¯ä¾æ—§å­˜åœ¨åé¢ä¸¤ä¸ªç¼ºç‚¹ã€‚</p><ol start="2"><li><p><strong>ç³»ç»Ÿå¼€é”€</strong>ï¼šæ¯æ¬¡è°ƒç”¨<code>poll</code>éƒ½éœ€è¦æŠŠfdé›†åˆæ‹·è´è¿›è¡Œç³»ç»Ÿè°ƒç”¨<strong>é™·å…¥å†…æ ¸æ€</strong>ï¼Œè¿™ä¸ªå¼€é”€åœ¨fdå¾ˆå¤šæ—¶ä¼šå¾ˆå¤§ ï¼›</p></li><li><p><strong>äºŒæ¬¡è½®è¯¢</strong>ï¼š<code>poll</code>éœ€è¦äºŒæ¬¡æŸ¥è¯¢æ‹·è´æ‰€æœ‰æ–‡ä»¶æè¿°fd_setè¿›è¡Œéå†æŸ¥çœ‹æ˜¯å¦æœ‰æè¿°ç¬¦å‡†å¤‡å°±ç»ªã€‚</p></li></ol><h5 id="4-3-epollåŸç†">4.3 epollåŸç†</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// epollåªæœ‰epoll_create()ã€epoll_ctl()ã€epoll_wait() 3ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_create</span><span class="params">(<span class="keyword">int</span> size)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_ctl</span><span class="params">(<span class="keyword">int</span> epfd, <span class="keyword">int</span> op, <span class="keyword">int</span> fd, struct epoll_event *event)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, struct epoll_event *events,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure><ul><li><p><code>epoll_create</code></p><p>åˆ›å»ºä¸€ä¸ªepollæ–‡ä»¶æè¿°ç¬¦çš„epfdï¼ˆæˆ–è€…ç§°ä¹‹ä¸ºå¥æŸ„ï¼‰, <strong>epollä½¿ç”¨ä¸€ä¸ªepfdæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªsocketæè¿°ç¬¦</strong>ã€‚</p><blockquote><p>å½“åˆ›å»ºå¥½epollå¥æŸ„åï¼Œå®ƒå°±æ˜¯ä¼šå ç”¨ä¸€ä¸ªfdå€¼ï¼Œå¿…é¡»è°ƒç”¨close()å…³é—­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´fdè¢«è€—å°½ ã€‚</p></blockquote></li><li><p><code>epoll_ctl</code></p><p>è¯¥å‡½æ•°ç”¨äºæ§åˆ¶æŸä¸ªepollæ–‡ä»¶æè¿°ç¬¦ä¸Šçš„äº‹ä»¶ï¼Œå¯ä»¥æ³¨å†Œäº‹ä»¶ï¼Œä¿®æ”¹äº‹ä»¶ï¼Œä»¥åŠåˆ é™¤äº‹ä»¶ã€‚ç›¸å…³å‚æ•°ï¼š</p><blockquote><p>ä½¿ç”¨<strong>çº¢é»‘æ ‘</strong>å¯¹ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œï¼šæ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤ç­‰ã€‚</p></blockquote><ul><li><p><code>epdf</code>ï¼šç”±epoll_create()å‡½æ•°è¿”å›çš„epollæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥æŸ„ï¼‰ï¼›</p></li><li><p><code>op</code> ï¼š opæ˜¯æ“ä½œçš„é€‰é¡¹ï¼Œæ³¨å†Œè¦ç›‘å¬çš„ç›®æ ‡socketæè¿°ç¬¦fdåˆ°epollå¥æŸ„ä¸­ ï¼›ä¿®æ”¹epollå¥æŸ„å·²ç»æ³¨å†Œçš„fdçš„ç›‘å¬äº‹ä»¶ï¼›ä»epollå¥æŸ„åˆ é™¤å·²ç»æ³¨å†Œçš„socketæè¿°ç¬¦ ï¼›</p></li><li><p><code>fd</code>ï¼šæŒ‡å®šç›‘å¬çš„socketæè¿°ç¬¦ï¼›</p></li><li><p><code>event</code>ï¼šäº‹ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">epoll_data</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span>        *ptr;</span><br><span class="line">    <span class="keyword">int</span>          fd;</span><br><span class="line">    <span class="keyword">uint32_t</span>     u32;</span><br><span class="line">    <span class="keyword">uint64_t</span>     u64;</span><br><span class="line">&#125; <span class="keyword">epoll_data_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> &#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span>     events;      <span class="comment">/* Epoll events */</span></span><br><span class="line">    <span class="keyword">epoll_data_t</span> data;        <span class="comment">/* User data variable */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>epoll_wait()</code></p><p>epoll_wait()å‡½æ•°çš„ä½œç”¨å°±æ˜¯ç­‰å¾…ç›‘å¬çš„äº‹ä»¶çš„å‘ç”Ÿï¼Œ<strong>ç±»ä¼¼äºè°ƒç”¨select()å‡½æ•°</strong>ã€‚ ç›¸å…³å‚æ•°å¦‚ä¸‹ï¼š</p><blockquote><p>å‡½æ•°çš„è¿”å›å€¼è¡¨ç¤ºéœ€è¦å¤„ç†çš„äº‹ä»¶æ•°ç›®ï¼Œå¦‚è¿”å›0è¡¨ç¤ºå·²è¶…æ—¶ã€‚</p></blockquote><ul><li><code>events</code>ï¼šç”¨æ¥ä»å†…æ ¸å¾—åˆ°äº‹ä»¶çš„é›†åˆã€‚</li><li><code>maxevents</code> ï¼šå‘Šä¹‹å†…æ ¸è¿™ä¸ªeventsæœ‰å¤šå¤§ï¼Œè¿™ä¸ª maxeventsçš„å€¼ä¸èƒ½å¤§äºåˆ›å»ºepoll_create()æ—¶çš„æŒ‡å®šçš„sizeã€‚</li><li><code>timeout</code>ï¼šè¶…æ—¶æ—¶é—´ã€‚</li></ul></li></ul><p><strong>epollé«˜æ•ˆè¿è¡Œè¿‡ç¨‹</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/31cdfd6f5a48">å½»åº•ææ‡‚epollé«˜æ•ˆè¿è¡Œçš„åŸç†</a></p></blockquote><ol><li><p>æ‰§è¡Œ<code>epoll_create</code>ä¼šåœ¨å†…æ ¸çš„é«˜é€ŸcacheåŒºä¸­å»ºç«‹ä¸€é¢—çº¢é»‘æ ‘ä»¥åŠå°±ç»ªé“¾è¡¨(è¯¥é“¾è¡¨å­˜å‚¨å·²ç»å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦)ã€‚æ¥ç€ç”¨æˆ·æ‰§è¡Œ<code>epoll_ctl</code> å‡½æ•°æ·»åŠ æ–‡ä»¶æè¿°ç¬¦ä¼šåœ¨çº¢é»‘æ ‘ä¸Šå¢åŠ ç›¸åº”çš„ç»“ç‚¹ã€‚</p><blockquote><p>selectï¼šåˆ›å»º3ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†å¹¶<u>æ‹·è´åˆ°å†…æ ¸</u>ä¸­ ; pollï¼šå°†ä¼ å…¥çš„struct pollfdç»“æ„ä½“æ•°ç»„<u>æ‹·è´åˆ°å†…æ ¸</u>ä¸­è¿›è¡Œç›‘å¬ã€‚</p></blockquote></li><li><p>è°ƒç”¨<code>epoll_wait</code> <strong>é˜»å¡ï¼Œç­‰å¾…å¯è¯»äº‹ä»¶</strong>ï¼›</p></li><li><p>å†…æ ¸åœ¨æ£€æµ‹åˆ°æ»¡è¶³æ¡ä»¶çš„socketæè¿°ç¬¦ä¼šè°ƒç”¨<strong>å›è°ƒå‡½æ•°</strong> ï¼Œå›è°ƒå‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦<strong>æ”¾åœ¨å°±ç»ªé“¾è¡¨</strong>ä¸­ ï¼›</p><blockquote><p>è€Œselect/poll éƒ½éœ€è¦ ï¼Œéå†æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦fd_set ã€‚</p><p>è€Œæ‰§è¡Œepoll_ctlçš„addæ“ä½œæ—¶ï¼Œä¸ä»…å°†æ–‡ä»¶æè¿°ç¬¦æ”¾åˆ°çº¢é»‘æ ‘ä¸Šï¼Œè€Œä¸”ä¹Ÿæ³¨å†Œäº†å›è°ƒå‡½æ•°ï¼Œåªéœ€è°ƒç”¨å›è°ƒå‡½æ•°ã€‚</p></blockquote></li><li><p>epoll_waitåªç”¨è§‚å¯Ÿå°±ç»ªé“¾è¡¨ä¸­æœ‰æ— æ•°æ®å³å¯ï¼Œæœ€åå°†é“¾è¡¨çš„æ•°æ®<strong>è¿”å›ç»™è¯»å†™äº‹ä»¶æ•°ç»„events</strong> &amp;<strong>è¿”å›å°±ç»ªçš„æ•°é‡</strong>ï¼Œåªç”¨<strong>éå†events</strong>ä¾æ¬¡å¤„ç†å³å¯ã€‚</p><blockquote><p>è¿™é‡Œè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯é€šè¿‡<strong>mmapè®©å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å…±äº«åŒä¸€å—å†…å­˜</strong>å®ç°ä¼ é€’çš„ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„æ‹·è´ã€‚</p><p>è€Œselect/poll <u>åªè¿”å›socketå°±ç»ªæ•°ç›®</u>ï¼Œ è¿˜éœ€è¦å°†<strong>æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦å†æ¬¡ä»å†…æ ¸â†’ç”¨æˆ·</strong>ï¼Œéå†å°±ç»ªçš„socketæ–‡ä»¶æè¿°ç¬¦ã€‚</p></blockquote></li></ol><h5 id="4-4-selectï¼Œpollï¼Œepoll-å„è‡ªåŒºåˆ«ï¼Ÿ">4.4 selectï¼Œpollï¼Œepoll å„è‡ªåŒºåˆ«ï¼Ÿ</h5><blockquote><p>ä¸é”™çš„æ–‡ç« ï¼š<a href="https://www.codenong.com/cs105364662/">https://www.codenong.com/cs105364662/</a></p></blockquote><p><strong>ç›¸åŒç‚¹</strong>ï¼š</p><ul><li><p>selectï¼Œpollï¼Œepoll éƒ½æ˜¯ IO å¤šè·¯å¤ç”¨çš„æœºåˆ¶ï¼ˆNIOï¼Ÿyesï¼‰ï¼›</p><blockquote><p>IO å¤šè·¯å¤ç”¨çš„æœ¬è´¨æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œè®©<strong>å•ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦</strong>ï¼Œå½“å‘ç°æŸä¸ªæè¿°ç¬¦å°±ç»ªä¹‹åï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p></blockquote></li><li><p>selectï¼Œpollï¼Œepoll éƒ½æ˜¯åŒæ­¥ IO ã€‚</p></li></ul><p><strong>ä¸åŒç‚¹</strong>ï¼š</p><img src="https://i.loli.net/2021/05/17/xj2ncf8VLbAGrwh.png" alt="image-20210517125057917" style="zoom: 80%;" /><ol><li><strong>IO æ•ˆç‡</strong>ï¼šï¼ˆ1ï¼‰select åªçŸ¥é“<u>æœ‰ IO äº‹ä»¶å‘ç”Ÿï¼Œå´ä¸çŸ¥é“æ˜¯å“ªå‡ ä¸ªæµ</u>ï¼Œåªèƒ½é‡‡å–è½®è¯¢æ‰€æœ‰æµï¼ˆ fd_set é›†åˆï¼‰çš„æ–¹å¼ï¼Œæ•…å…¶å…·æœ‰ O(n) çš„æ— å·®åˆ«è½®è¯¢å¤æ‚åº¦ï¼Œå¤„ç†çš„æµè¶Šå¤šï¼Œæ— å·®åˆ«è½®è¯¢æ—¶é—´å°±è¶Šé•¿ï¼›ï¼ˆ2ï¼‰poll ä¸ select å¹¶æ— åŒºåˆ«ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(n)ï¼›ï¼ˆ3ï¼‰epoll ä¼šå°†å“ªä¸ªæµå‘ç”Ÿäº†æ€æ ·çš„ IO äº‹ä»¶é€šçŸ¥æˆ‘ä»¬ï¼ˆå½“æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œ<u>ç³»ç»Ÿæ³¨å†Œçš„å›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨</u>ï¼Œå°†å°±ç»ªæè¿°ç¬¦æ”¾åˆ° readyList é‡Œé¢ï¼‰ï¼Œ<strong>å®ƒæ˜¯äº‹ä»¶é©±åŠ¨çš„</strong>ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼›</li><li><strong>æ“ä½œæ–¹å¼</strong>ï¼šselect å’Œ poll éƒ½æ˜¯é‡‡å–éå†çš„æ–¹å¼ï¼Œè€Œ epoll åˆ™æ˜¯é‡‡å–äº†å›è°ƒçš„æ–¹å¼ï¼›</li><li><strong>åº•å±‚å®ç°</strong>ï¼šselect çš„åº•å±‚å®ç°ä¸ºæ•°ç»„ï¼Œpoll çš„åº•å±‚å®ç°ä¸ºé“¾è¡¨ï¼›è€Œ epoll çš„åº•å±‚å®ç°ä¸ºçº¢é»‘æ ‘ï¼›</li><li><strong>æœ€å¤§è¿æ¥æ•°</strong>ï¼šselect çš„æœ€å¤§è¿æ¥æ•°ä¸º 1024 æˆ– 2048ï¼›è€Œ poll å’Œ epoll æ˜¯æ— ä¸Šé™çš„ï¼›</li><li><strong>å¯¹æè¿°ç¬¦çš„æ‹·è´</strong>ï¼šselect å’Œ poll æ¯æ¬¡è¢«è°ƒç”¨æ—¶éƒ½ä¼šæŠŠæè¿°ç¬¦é›†åˆä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œè€Œ epoll åœ¨è°ƒç”¨ epoll_ctl æ—¶ä¼šæ‹·è´è¿›å†…æ ¸å¹¶ä¿å­˜ï¼Œä¹‹åæ¯æ¬¡ epoll_wait æ—¶ä¸ä¼šæ‹·è´ï¼›</li><li><strong>æ€§èƒ½</strong>ï¼š<u>epoll åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹æ€§èƒ½è¿œè¶… select å’Œ poll</u>ï¼Œä½†åœ¨è¿æ¥æ•°å°‘å¹¶ä¸”è¿æ¥éƒ½ååˆ†æ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œselect å’Œ poll çš„æ€§èƒ½å¯èƒ½æ¯” epoll å¥½ï¼Œå› ä¸º epoll çš„é€šçŸ¥æœºåˆ¶éœ€è¦å¾ˆå¤šå‡½æ•°å›è°ƒ ã€‚</li></ol><h5 id="4-5-ET-LT-æ¨¡å¼ä»‹ç»ï¼Ÿå„è‡ªä¼˜ç¼ºç‚¹ï¼Ÿ">4.5 ET , LT æ¨¡å¼ä»‹ç»ï¼Ÿå„è‡ªä¼˜ç¼ºç‚¹ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1636224">https://cloud.tencent.com/developer/article/1636224</a></p></blockquote><ul><li><p><strong>è¾¹ç¼˜è§¦å‘æ¨¡å¼</strong>ï¼ˆ<strong>E</strong>dge <strong>T</strong>riggerï¼ŒETï¼‰ï¼Œåªæœ‰ä¸€ä¸ªäº‹ä»¶ä»æ— åˆ°æœ‰æ‰ä¼šè§¦å‘ï¼›</p><blockquote><ol><li>ä½ç”µå¹³ =&gt; é«˜ç”µå¹³ ã€‚</li></ol></blockquote></li><li><p><strong>æ°´å¹³è§¦å‘æ¨¡å¼</strong>ï¼ˆ<strong>L</strong>evel <strong>T</strong>riggerï¼ŒLTï¼‰ï¼Œä¸€ä¸ªäº‹ä»¶åªè¦æœ‰ï¼Œå°±ä¼šä¸€ç›´è§¦å‘ã€‚</p><blockquote><ol><li>ä½ç”µå¹³ =&gt; é«˜ç”µå¹³ ; 2. å¤„äºé«˜ç”µå¹³çŠ¶æ€</li></ol></blockquote></li><li><p><strong>ä¸¾ä¾‹è¯´æ˜</strong></p><ul><li><strong>socket çš„è¯»äº‹ä»¶</strong><ul><li><strong>LTæ¨¡å¼</strong>ï¼Œåªè¦ socket ä¸Šæœ‰æœªè¯»å®Œçš„æ•°æ®ï¼Œå°±ä¼šä¸€ç›´äº§ç”Ÿ EPOLLIN äº‹ä»¶ï¼›</li><li><strong>ETæ¨¡å¼</strong>ï¼Œsocket ä¸Šæ¯æ–°æ¥ä¸€æ¬¡æ•°æ®å°±ä¼šè§¦å‘ä¸€æ¬¡ï¼Œå¦‚æœä¸Šä¸€æ¬¡è§¦å‘åï¼Œ<strong>æœªå°† socket ä¸Šçš„æ•°æ®è¯»å®Œï¼Œä¹Ÿä¸ä¼šå†è§¦å‘</strong>ï¼Œé™¤éå†æ–°æ¥ä¸€æ¬¡æ•°æ®ã€‚</li></ul></li><li><strong>å¯¹äº socket å†™äº‹ä»¶</strong><ul><li><strong>LTæ¨¡å¼</strong>ï¼Œå¦‚æœ socket çš„ TCP çª—å£ä¸€ç›´ä¸é¥±å’Œï¼Œä¼šä¸€ç›´è§¦å‘ EPOLLOUT äº‹ä»¶ï¼›</li><li><strong>ETæ¨¡å¼</strong>ï¼Œåªä¼šè§¦å‘ä¸€æ¬¡ï¼Œé™¤é TCP çª—å£ç”±ä¸é¥±å’Œå˜æˆé¥±å’Œå†ä¸€æ¬¡å˜æˆä¸é¥±å’Œï¼Œæ‰ä¼šå†æ¬¡è§¦å‘ EPOLLOUT äº‹ä»¶ã€‚</li></ul></li></ul></li><li><p><strong>ä¼˜ç¼ºç‚¹</strong></p><ul><li>ä½¿ç”¨ LT æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±å†³å®š<strong>æ¯æ¬¡æ”¶å–å¤šå°‘å­—èŠ‚ï¼ˆå¯¹äºæ™®é€š socketï¼‰æˆ–ä½•æ—¶æ¥æ”¶è¿æ¥</strong>ï¼ˆå¯¹äºä¾¦å¬ socketï¼‰ï¼Œä½†æ˜¯å¯èƒ½ä¼š<strong>å¯¼è‡´å¤šæ¬¡è§¦å‘</strong>ï¼›</li><li>ä½¿ç”¨ ET æ¨¡å¼ï¼Œæˆ‘ä»¬å¿…é¡»<strong>æ¯æ¬¡éƒ½è¦å°†æ•°æ®æ”¶å®Œ</strong>ï¼ˆå¯¹äºæ™®é€š socketï¼‰æˆ–å¿…é¡»ç†è§£è°ƒç”¨ accept æ¥æ”¶è¿æ¥ï¼ˆå¯¹äºä¾¦å¬socketï¼‰ï¼Œå…¶<strong>ä¼˜ç‚¹æ˜¯è§¦å‘æ¬¡æ•°å°‘</strong>ã€‚</li></ul></li></ul><h4 id="5-æ“ä½œç³»ç»Ÿåº•å±‚æ˜¯æ€ä¹ˆå®ç°åŸå­æ“ä½œçš„ï¼Ÿ">5. æ“ä½œç³»ç»Ÿåº•å±‚æ˜¯æ€ä¹ˆå®ç°åŸå­æ“ä½œçš„ï¼Ÿ</h4><p>å¤„ç†å™¨ä½¿ç”¨åŸºäºå¯¹<strong>ç¼“å­˜åŠ é”</strong>æˆ–<strong>æ€»çº¿åŠ é”</strong>çš„æ–¹å¼ï¼Œæ¥å®ç°å¤šå¤„ç†å™¨ä¹‹é—´çš„åŸå­æ“ä½œã€‚</p><ol><li><p><strong>æ€»çº¿é”</strong>ï¼š å¤„ç†å™¨æä¾›çš„ä¸€ä¸ªLOCKï¼ƒä¿¡å·ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨åœ¨æ€»çº¿ä¸Šè¾“å‡ºæ­¤ä¿¡å·æ—¶ï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°†è¢«é˜»å¡ä½ï¼Œé‚£ä¹ˆè¯¥å¤„ç†å™¨<strong>å¯ä»¥ç‹¬å å…±äº«å†…å­˜</strong>ï¼›</p><blockquote><p><strong>æ€»çº¿é”å®šæŠŠCPUå’Œå†…å­˜ä¹‹é—´çš„é€šä¿¡é”ä½äº†</strong>ï¼Œè¿™ä½¿å¾—é”å®šæœŸé—´ï¼Œå…¶ä»–å¤„ç†å™¨ä¸èƒ½æ“ä½œå…¶ä»–å†…å­˜åœ°å€çš„æ•°æ®</p></blockquote></li><li><p><strong>ç¼“å­˜é”</strong>ï¼šç›¸æ¯”æ€»çº¿é”ï¼Œç¼“å­˜é”å³é™ä½äº†é”çš„åŠ›åº¦ã€‚æ ¸å¿ƒæœºåˆ¶æ˜¯åŸºäº<u>ç¼“å­˜ä¸€è‡´æ€§åè®®</u>æ¥å®ç°çš„ã€‚</p><blockquote><p>è¯¦ç»†å‚è€ƒï¼š<a href="https://www.jianshu.com/p/06717ac8312c">JMMåŸºç¡€ï¼ˆæ€»çº¿é”ã€ç¼“å­˜é”ã€MESIç¼“å­˜ä¸€è‡´æ€§åè®®ã€CPU å±‚é¢çš„å†…å­˜å±éšœï¼‰</a></p></blockquote></li></ol><h2 id="4-7-å…¶å®ƒ">4.7 å…¶å®ƒ</h2><h4 id="1-å¸¸è§çš„ç£ç›˜è°ƒåº¦ç®—æ³•ï¼Ÿ">1. å¸¸è§çš„ç£ç›˜è°ƒåº¦ç®—æ³•ï¼Ÿ</h4><p>è¯»å†™ä¸€ä¸ªç£ç›˜å—çš„æ—¶é—´çš„å½±å“å› ç´ æœ‰ï¼š</p><ul><li>æ—‹è½¬æ—¶é—´ï¼ˆä¸»è½´è½¬åŠ¨ç›˜é¢ï¼Œä½¿å¾—ç£å¤´ç§»åŠ¨åˆ°é€‚å½“çš„æ‰‡åŒºä¸Šï¼‰</li><li>å¯»é“æ—¶é—´ï¼ˆåˆ¶åŠ¨æ‰‹è‡‚ç§»åŠ¨ï¼Œä½¿å¾—ç£å¤´ç§»åŠ¨åˆ°é€‚å½“çš„ç£é“ä¸Šï¼‰</li><li>å®é™…çš„æ•°æ®ä¼ è¾“æ—¶é—´</li></ul><p>å…¶ä¸­ï¼Œ<strong>å¯»é“æ—¶é—´æœ€é•¿</strong>ï¼Œå› æ­¤ç£ç›˜è°ƒåº¦çš„ä¸»è¦ç›®æ ‡æ˜¯ä½¿ç£ç›˜çš„å¹³å‡å¯»é“æ—¶é—´æœ€çŸ­ã€‚</p><ol><li><p><strong>å…ˆæ¥å…ˆæœåŠ¡</strong>ã€‚ æŒ‰ç…§ç£ç›˜è¯·æ±‚çš„é¡ºåºè¿›è¡Œè°ƒåº¦ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå…¬å¹³ã€ç®€å•ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šæœªå¯¹å¯»é“åšä»»ä½•ä¼˜åŒ–ï¼Œä½¿å¹³å‡å¯»é“æ—¶é—´å¯èƒ½è¾ƒé•¿ã€‚</li></ul></li><li><p><strong>æœ€çŸ­å¯»é“ä¼˜å…ˆ</strong>ã€‚ ä¼˜å…ˆè°ƒåº¦ä¸å½“å‰ç£å¤´æ‰€åœ¨ç£é“è·ç¦»æœ€è¿‘çš„ç£é“ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š å¹³å‡å¯»é“æ—¶é—´æ¯”è¾ƒä½ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šä¸å…¬å¹³ï¼Œå¦‚æœæ–°åˆ°è¾¾çš„ç£é“è¯·æ±‚æ€»æ˜¯æ¯”ä¸€ä¸ªåœ¨ç­‰å¾…çš„ç£é“è¯·æ±‚è¿‘ï¼Œé‚£ä¹ˆåœ¨ç­‰å¾…çš„ç£é“è¯·æ±‚ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚</li></ul></li><li><p><strong>ç”µæ¢¯æ‰«æç®—æ³•</strong>ã€‚ ç”µæ¢¯æ€»æ˜¯ä¿æŒä¸€ä¸ªæ–¹å‘è¿è¡Œï¼Œç›´åˆ°è¯¥æ–¹å‘æ²¡æœ‰è¯·æ±‚ä¸ºæ­¢ï¼Œç„¶åæ”¹å˜è¿è¡Œæ–¹å‘ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š æ€§èƒ½è¾ƒå¥½ï¼ŒåŒæ—¶ä¸ä¼šå­˜åœ¨é¥¥é¥¿ç°è±¡ã€‚</li></ul></li></ol><h4 id="2-æœåŠ¡å™¨é«˜å¹¶å‘çš„è§£å†³æ–¹æ¡ˆä½ çŸ¥é“å¤šå°‘ï¼Ÿ">2. æœåŠ¡å™¨é«˜å¹¶å‘çš„è§£å†³æ–¹æ¡ˆä½ çŸ¥é“å¤šå°‘ï¼Ÿ</h4><ul><li><strong>åº”ç”¨æ•°æ®ä¸é™æ€èµ„æºåˆ†ç¦»</strong>ï¼šå°†é™æ€èµ„æºï¼ˆå›¾ç‰‡ï¼Œè§†é¢‘ï¼Œjsï¼Œcssç­‰ï¼‰å•ç‹¬ä¿å­˜åˆ°ä¸“é—¨çš„é™æ€èµ„æºæœåŠ¡å™¨ä¸­ï¼Œåœ¨å®¢æˆ·ç«¯è®¿é—®çš„æ—¶å€™ä»<strong>é™æ€èµ„æºæœåŠ¡å™¨ä¸­è¿”å›é™æ€èµ„æº</strong>ï¼Œä»<strong>ä¸»æœåŠ¡å™¨ä¸­è¿”å›åº”ç”¨æ•°æ®</strong>ï¼›</li><li><strong>å®¢æˆ·ç«¯ç¼“å­˜</strong> ï¼šä¾‹å¦‚å…ˆç”Ÿæˆé™æ€é¡µé¢ï¼Œç„¶åç”¨ajaxå¼‚æ­¥è¯·æ±‚è·å–åŠ¨æ€æ•°æ®ï¼›</li><li><strong>é›†ç¾¤å’Œåˆ†å¸ƒå¼</strong> ï¼šä½¿ç”¨æœåŠ¡å™¨é›†ç¾¤å’Œåˆ†å¸ƒå¼æ¶æ„ï¼Œä½¿å¾—åŸæœ¬å±äºä¸€ä¸ªæœåŠ¡å™¨çš„è®¡ç®—å‹åŠ›åˆ†æ•£åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚åŒæ—¶åŠ å¿«è¯·æ±‚å¤„ç†çš„é€Ÿåº¦ï¼›</li><li><strong>åå‘ä»£ç†</strong>ï¼š åœ¨è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨é€šè¿‡åˆ«çš„æœåŠ¡å™¨è·å–èµ„æºæˆ–ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰_è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/p/46361/"/>
      <url>/p/46361/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>ä¸‰ã€è®¡ç®—æœºç½‘ç»œ</h1><h2 id="3-1-ISO-OSIæ¨¡å‹-å’Œ-TCP-IP-æ¨¡å‹">3.1 ISO/OSIæ¨¡å‹  å’Œ TCP/IP æ¨¡å‹</h2><h4 id="1-è¯·ä½ ç®€è¦ä»‹ç»ä¸€ä¸‹TCP-IP-äº”å±‚åè®®-å’Œ-ISO-OSIä¸ƒå±‚åè®®ï¼Ÿ">1.<strong>è¯·ä½ ç®€è¦ä»‹ç»ä¸€ä¸‹TCP/IP äº”å±‚åè®® å’Œ ISO/OSIä¸ƒå±‚åè®®ï¼Ÿ</strong></h4><p><img src="https://uploadfiles.nowcoder.com/images/20190814/980266035_1565787665824_1ABB2DC3D76311944FFDBE9980FBAADD" alt="img"></p><ul><li><p><strong>åº”ç”¨å±‚</strong>ï¼šä¸ºç”¨æˆ·çš„<strong>åº”ç”¨ç¨‹åº</strong>ï¼ˆå¦‚ï¼šç”µå­é‚®ä»¶ã€æ–‡ä»¶ä¼ è¾“å’Œä»¿çœŸç»ˆç«¯ï¼‰<u><strong>*æä¾›ç½‘ç»œæœåŠ¡</strong></u>ï¼›</p></li><li><p><strong>è¡¨ç¤ºå±‚</strong>ï¼š å¯ä»¥ç¡®ä¿ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚æ‰€å‘é€çš„ä¿¡æ¯å¯ä»¥è¢«å¦ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚è¯»å–ï¼›</p></li><li><p><strong>ä¼šè¯å±‚</strong>ï¼š  é€šè¿‡è¿è¾“å±‚ï¼ˆç«¯å£å·ï¼šä¼ è¾“ç«¯å£ä¸æ¥æ”¶ç«¯å£ï¼‰å»ºç«‹æ•°æ®ä¼ è¾“çš„é€šè·¯ï¼Œä¸»è¦åœ¨ä½ çš„ç³»ç»Ÿä¹‹é—´å‘èµ·ä¼šè¯æˆ–è€…æ¥å—ä¼šè¯è¯·æ±‚ï¼›</p></li><li><p><strong>è¿è¾“å±‚:</strong> ä»»åŠ¡æ˜¯ä¸ºä¸¤å°ä¸»æœºä¸­<strong>è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡</strong>æä¾›é€šç”¨çš„<u><strong>*æ•°æ®ä¼ è¾“æœåŠ¡</strong></u>ï¼Œä¼ è¾“çš„æ˜¯<strong>æŠ¥æ–‡æ®µï¼ˆtcpï¼‰/ç”¨æˆ·æ•°æ®æŠ¥ï¼ˆudpï¼‰</strong>ï¼›</p><blockquote><p>å¤ç”¨ï¼šå¤šä¸ªåº”ç”¨å±‚è¿›ç¨‹å¯åŒæ—¶ä½¿ç”¨ä¸‹é¢è¿è¾“å±‚çš„æœåŠ¡ã€‚<br>åˆ†ç”¨ï¼šè¿è¾“å±‚æŠŠæ”¶åˆ°çš„ä¿¡æ¯åˆ†åˆ«äº¤ä»˜ä¸Šé¢åº”ç”¨å±‚ä¸­çš„ç›¸åº”è¿›ç¨‹ã€‚</p></blockquote></li><li><p><strong>ç½‘ç»œå±‚</strong>ï¼š ä¸ºä¸»æœºé—´<u><strong>*æä¾›é€šä¿¡æœåŠ¡</strong></u>ã€‚åœ¨å‘é€æ•°æ®æ—¶ï¼Œç½‘ç»œå±‚æŠŠè¿è¾“å±‚çš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–åŒ…è¿›è¡Œä¼ é€ã€‚åœ¨TCP/IPä½“ç³»ä¸­ï¼Œç”±äºç½‘ç»œå±‚ä½¿ç”¨IPåè®®ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå«åšIPæ•°æ®æŠ¥ï¼Œæˆ–ç®€ç§°ä¸º<strong>æ•°æ®æŠ¥</strong></p></li><li><p><strong>æ•°æ®é“¾è·¯å±‚ï¼ˆå¿˜</strong>ï¼‰ï¼š ä¸¤å°ä¸»æœºé€šä¿¡ï¼Œæ€»æ˜¯åœ¨<strong>ä¸€æ®µä¸€æ®µçš„é“¾è·¯</strong>ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦éœ€è¦ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®®ã€‚åœ¨ä¸¤ä¸ªç›¸é‚»ç»“ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œæ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„<u><strong>*IPæ•°æ®æŠ¥ç»„è£…æˆå¸§</strong></u>ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»ç»“ç‚¹é—´çš„é“¾è·¯ä¸Šä¼ é€å¸§ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ã€‚</p></li><li><p><strong>ç‰©ç†å±‚</strong>ï¼šä¸»è¦ä½œç”¨æ˜¯<u>ä¼ å…¥æ¯”ç‰¹æµï¼ˆå°±æ˜¯ç”±1ã€0è½¬åŒ–ä¸ºç”µæµå¼ºå¼±æ¥è¿›è¡Œä¼ è¾“ï¼Œåˆ°è¾¾ç›®çš„åœ°åå†è½¬åŒ–ä¸º1ã€0ï¼‰</u>ï¼Œå®šä¹‰ç‰©ç†è®¾å¤‡æ ‡å‡†ï¼ˆä¾‹å¦‚ç½‘çº¿çš„æ¥å£ç±»å‹ã€å…‰çº¿çš„æ¥å£ç±»å‹ã€å„ç§ä¼ è¾“ä»‹è´¨çš„ä¼ è¾“é€Ÿç‡ï¼‰ã€‚</p></li></ul><h4 id="2-è¯·ä½ ç®€è¦ä»‹ç»ä¸€ä¸‹å„å±‚çš„åè®®ï¼Ÿ">2.<strong>è¯·ä½ ç®€è¦ä»‹ç»ä¸€ä¸‹å„å±‚çš„åè®®ï¼Ÿ</strong></h4><ul><li><p><strong>ç‰©ç†å±‚</strong>ï¼šæš‚æ— </p></li><li><p><strong>ï¼ˆ<u>å¿«æ‰‹</u>ï¼‰æ•°æ®é“¾è·¯å±‚</strong>ï¼šæ•°æ®é“¾è·¯å±‚ä¸»è¦æ˜¯è´Ÿè´£ä¼ è¾“æ•°æ®ï¼Œ</p><ul><li><p><strong>PPPï¼ˆç‚¹åˆ°ç‚¹åè®®</strong>ï¼‰ï¼šåœ¨<strong>ç‚¹å¯¹ç‚¹</strong>è¿æ¥ä¸Šä¼ è¾“å¤šåè®®æ•°æ®åŒ…æä¾›äº†ä¸€ä¸ªæ ‡å‡†æ–¹æ³•ï¼ŒPPP æœ€åˆè®¾è®¡æ˜¯ä¸º<strong>ä¸¤ä¸ªå¯¹ç­‰èŠ‚ç‚¹</strong>ä¹‹é—´çš„ IP <strong>æµé‡ä¼ è¾“</strong>æä¾›ä¸€ç§å°è£…åè®®ã€‚è¿™ç§é“¾è·¯æä¾›<strong>å…¨åŒå·¥</strong>æ“ä½œï¼Œå¹¶æŒ‰ç…§é¡ºåºä¼ é€’æ•°æ®åŒ…ã€‚</p><blockquote><p>è®¾è®¡ç›®çš„ä¸»è¦æ˜¯ç”¨æ¥é€šè¿‡æ‹¨å·æˆ–ä¸“çº¿æ–¹å¼å»ºç«‹ç‚¹å¯¹ç‚¹è¿æ¥å‘é€æ•°æ®ï¼Œä½¿å…¶æˆä¸ºå„ç§ä¸»æœºã€ç½‘æ¡¥å’Œè·¯ç”±å™¨ä¹‹é—´ç®€å•è¿æ¥çš„ä¸€ç§å…±é€šçš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote></li><li><p><strong>ä»¥å¤ªç½‘ï¼ˆEthernet)</strong>ï¼š</p></li><li><p><strong>CSMA/CD åè®®</strong>ï¼š å†²çªæ£€æµ‹çš„è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®æŠ€æœ¯(è½½æ³¢ç›‘å¬å¤šç‚¹æ¥å…¥/ç¢°æ’æ£€æµ‹)ã€‚</p><blockquote><p>è®¸å¤šè®¡ç®—æœºä»¥<strong>å¤šç‚¹æ¥å…¥</strong>çš„æ–¹å¼è¿æ¥<strong>åœ¨ä¸€æ ¹æ€»çº¿</strong>ä¸Šï¼Œæ¯ä¸ªä¸»æœºéƒ½å¿…é¡»ä¸åœåœ°ç›‘å¬ä¿¡é“ã€‚å‘é€å‰ç›‘å¬ï¼Œå¦‚æœå¿™åˆ™ç­‰å¾…ï¼Œå¦‚æœç©ºé—²åˆ™å‘é€ã€‚</p><p>è‹¥æ£€æµ‹åˆ°ä¿¡é“æœ‰å¹²æ‰°ä¿¡å·ï¼Œåˆ™è¡¨ç¤ºäº§ç”Ÿäº†ç¢°æ’ï¼Œäºæ˜¯å°±è¦åœæ­¢å‘é€æ•°æ®ï¼Œè®¡ç®—å‡ºé€€é¿ç­‰å¾…æ—¶é—´ï¼Œç„¶åä½¿ç”¨ CSMA æ–¹æ³•ç»§ç»­å°è¯•å‘é€ã€‚</p></blockquote></li></ul></li><li><p><strong>ç½‘ç»œå±‚</strong>ï¼š <a href="https://www.hhcycj.com/post/item/491.html">å¯å‚è€ƒ</a></p><p><strong>IP</strong>ï¼šç½‘ç»œåè®®ï¼Œéå¸¸é‡è¦çš„ä¸­é—´å±‚åè®®ï¼ŒTCPå’ŒUDPå¿…é¡»åŸºäºIPå·¥ä½œ</p><p><strong>ICMP</strong>ï¼šéå¸¸é‡è¦çš„ä¸­é—´å±‚åè®®ï¼Œç”¨äºåœ¨ <u>IPä¸»æœºã€è·¯ç”±å™¨</u> ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯</p><p><strong>IGMP</strong>ï¼šç½‘ç»œç»„æ¶ˆæ¯åè®®ï¼Œç”¨æ¥åœ¨<u>IPä¸»æœº</u>å’Œä¸å…¶<strong>ç›´æ¥ç›¸é‚»çš„<u>ç»„æ’­è·¯ç”±å™¨</u>ä¹‹é—´</strong>å»ºç«‹ã€ç»´æŠ¤ç»„æ’­ç»„æˆå‘˜</p><p><strong>ARP</strong>ï¼šåœ°å€è§£æåè®®ï¼Œå»ºç«‹<code>IPâ†’MAC</code>åœ°å€æ˜ å°„è¡¨</p><p><strong>RARP</strong>ï¼šåå‘åœ°å€è§£æåè®®ï¼ŒæŸä¸ªç½‘ç»œè®¾å¤‡çš„MACç‰©ç†åœ°å€è½¬æ¢ä¸ºIPåœ°å€</p></li><li><p><strong>è¿è¾“å±‚:TCP(Transmission Control Protocol)</strong> é¢å‘è¿æ¥çš„ï¼Œæ•°æ®ä¼ è¾“çš„å•ä½æ˜¯<u><strong>æŠ¥æ–‡æ®µ</strong></u>ï¼Œèƒ½å¤Ÿæä¾›å¯é çš„äº¤ä»˜ã€‚</p><p><strong>UDP(User Datagram Protocol)</strong> ï¼šæ— è¿æ¥çš„ï¼Œæ•°æ®ä¼ è¾“çš„å•ä½<strong>æ˜¯<u>ç”¨æˆ·æ•°æ®æŠ¥</u>ï¼Œä¸ä¿è¯æä¾›å¯é çš„äº¤ä»˜</strong>ï¼Œåªèƒ½æä¾›â€œå°½æœ€å¤§åŠªåŠ›äº¤ä»˜â€</p></li><li><p><strong>åº”ç”¨å±‚</strong>ï¼šå¦‚æ”¯æŒä¸‡ç»´ç½‘åº”ç”¨çš„<strong>HTTP</strong>åè®®ï¼Œæ”¯æŒç”µå­é‚®ä»¶çš„<strong>SMTP</strong>åè®®ï¼Œæ”¯æŒæ–‡ä»¶ä¼ é€çš„<strong>FTP</strong>åè®®ï¼ŒDNSï¼ŒPOP3ï¼ŒSNMPï¼ŒTelnetç­‰ç­‰ã€‚</p></li></ul><h5 id="2-1-RARP-å·¥ä½œåŸç†ï¼Ÿ">2.1 RARP å·¥ä½œåŸç†ï¼Ÿ</h5><p>RARPå‘å‡ºè¦åå‘è§£é‡Šçš„ç‰©ç†åœ°å€å¹¶å¸Œæœ›è¿”å›å…¶IPåœ°å€ï¼Œåº”ç­”åŒ…æ‹¬èƒ½å¤Ÿæä¾›æ‰€éœ€ä¿¡æ¯çš„RARPæœåŠ¡å™¨å‘å‡ºçš„IPåœ°å€ã€‚</p><blockquote><p>ç½‘ç»œä¸Šçš„æ¯å°è®¾å¤‡éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¡¬ä»¶åœ°å€ï¼Œé€šå¸¸æ˜¯ç”±è®¾å¤‡å‚å•†åˆ†é…çš„MACåœ°å€ã€‚</p></blockquote><ol><li>ä¸»æœºä»ç½‘å¡ä¸Šè¯»å–MACåœ°å€ï¼Œç„¶ååœ¨ç½‘ç»œä¸Šå‘é€ä¸€ä¸ªRARPè¯·æ±‚çš„å¹¿æ’­æ•°æ®åŒ…ï¼›</li><li><strong>RARPæœåŠ¡å™¨</strong>æ”¶åˆ°äº†<strong>RARPè¯·æ±‚æ•°æ®åŒ…</strong>ï¼Œ<strong>ä¸ºå…¶åˆ†é…IPåœ°å€</strong>ï¼Œå¹¶å°†<strong>RARPå›åº”å‘é€</strong>ç»™ä¸»æœºï¼›</li><li>ä¸»æœºæ”¶åˆ°RARPå›åº”åï¼Œå°±ä½¿ç”¨å¾—åˆ°çš„IPåœ°å€è¿›è¡Œé€šè®¯ã€‚</li></ol><h4 id="3-ç«¯å£åœ¨å“ªä¸€å±‚ï¼Ÿæœ‰æ•ˆç«¯å£èŒƒå›´ï¼Ÿ">3. ç«¯å£åœ¨å“ªä¸€å±‚ï¼Ÿæœ‰æ•ˆç«¯å£èŒƒå›´ï¼Ÿ</h4><p>ç«¯å£åœ¨<strong>ä¼ è¾“å±‚</strong>ã€‚ä¼ è¾“å±‚ä»¥ä¸‹çš„åŒ…å°è£…è¿‡ç¨‹ï¼š</p><ul><li>æ•°æ®æŠ¥åœ¨ä¼ è¾“å±‚ï¼šåŠ æºç«¯å£å·å’Œç›®çš„ç«¯å£å·ï¼›</li><li>åœ¨ç½‘ç»œå±‚åŠ ä¸Šï¼šæºipå’Œç›®çš„ip ï¼›</li><li>åœ¨æ•°æ®é“¾è·¯å±‚è½¬åŒ–æˆï¼šæ•°æ®æ¡¢è¿›è¡Œæ ¡éªŒï¼›</li><li>åœ¨ç‰©ç†å±‚å˜æˆä¿¡å·ï¼ˆç”µã€å…‰ã€ç­‰ä¿¡å·ï¼‰å‘é€å‡ºå»ã€‚</li></ul><p>UDPå’ŒTCPæŠ¥å¤´ä½¿ç”¨<strong>ä¸¤ä¸ªå­—èŠ‚å­˜æ”¾ç«¯å£å·</strong>ï¼Œç«¯å£ä¸€å…±æœ‰ä¸€å…±æœ‰<strong>65535</strong>ä¸ªã€‚</p><ul><li>çŸ¥åç«¯å£å·ä»0~1023ï¼Œæ¯”å¦‚å…¶ä¸­HTTPæ˜¯80ï¼ŒFTPæ˜¯20ï¼ˆæ•°æ®ç«¯å£ï¼‰ã€21ï¼ˆæ§åˆ¶ç«¯å£ï¼‰ ï¼›</li><li>åŠ¨æ€ç«¯å£çš„èŒƒå›´æ˜¯ä»1024~65535ã€‚</li></ul><h2 id="3-2-è¿è¾“å±‚">3.2 è¿è¾“å±‚</h2><h4 id="0-TCPæŠ¥æ–‡å¤´ï¼ŸUDPæŠ¥æ–‡å¤´ï¼Ÿ">0. TCPæŠ¥æ–‡å¤´ï¼ŸUDPæŠ¥æ–‡å¤´ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="http://st233.com/blog.php?id=30">IPã€TCPã€UDPæŠ¥æ–‡å¤´è¯´æ˜</a></p></blockquote><ul><li><p><strong>TCPæŠ¥æ–‡å¤´</strong></p><p><img src="https://i.loli.net/2021/06/11/RtnwTmysWBvVlPD.png" alt="img"></p><ul><li><p><strong>æ¥æºç«¯å£</strong>ï¼šå‘ç›®æ ‡ä¸»æœºæŒ‡æ˜æ¥å…¥ä»–çš„ä¸»æœºæ‰€ä½¿ç”¨çš„ç«¯å£å· ç”¨äºç›®æ ‡ä¸»æœºå›åº”</p></li><li><p><strong>ç›®æ ‡ç«¯å£</strong>ï¼šæŒ‡æ˜è¦è¿æ¥çš„ç›®æ ‡ä¸»æœºçš„ç«¯å£å·</p><blockquote><p>ä»è¿™ä¹Ÿå¯ä»¥çœ‹ä¹¦ï¼Œç«¯å£å 16bitï¼Œæ•…èŒƒå›´æ˜¯0~65535ã€‚</p></blockquote></li><li><p><strong>é¡ºåºå·ï¼šæ•°æ®åŒ…ç¼–å·</strong>ï¼Œ è¡¨æ˜å‘é€çš„æ•°æ®åŒ…çš„é¡ºåº ã€‚å…¶å€¼é€šå¸¸åº”è¯¥ä¸º<code>ä¸Šæ¬¡å‘é€åŒ…ä¸­çš„é¡ºåºå·+1</code> ï¼Œè‹¥è¯¥æ•°æ®åŒ…æ˜¯æ•´ä¸ªTCPè¿æ¥ä¸­çš„ç¬¬ä¸€ä¸ªåŒ…(SYNåŒ…) åˆ™è¯¥å€¼éšæ„(é€šå¸¸éšæœº)</p></li><li><p><strong>ç¡®è®¤å·</strong>ï¼šé€šå¸¸è¯¥å€¼æ˜¯<code>æ¥å—åˆ°çš„é¡ºåºå·+1</code> ï¼Œè‹¥è¯¥æ•°æ®åŒ…æ˜¯æ•´ä¸ªTCPè¿æ¥ä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…(SYNåŒ…) åˆ™è¯¥å€¼éšæ„(é€šå¸¸ä¸º0)</p></li><li><p><strong>é¦–éƒ¨é•¿åº¦</strong>ï¼šTCPå¤´é•¿åº¦ ã€‚è¡¨æ˜åŒ…å¥½å¤šå°‘ä¸ª32Bit åŒ…æ‹¬å¯é€‰å¤´(å¦‚æœæœ‰) å€¼ä¸ºTCPå¤´å¤§å°é™¤ä»¥4 ï¼š</p><ul><li>å¦‚ï¼šæ²¡æœ‰å¯é€‰å¤´TCPå¤´ä¸º20å­—èŠ‚ åˆ™è¯¥å€¼ä¸º5</li></ul></li><li><p><strong>æ ‡å¿—ä½</strong>ï¼š</p></li><li><ul><li>ç´§æ€¥æ ‡å¿—ä½(URG)ï¼šå¼€å¯æ—¶è¡¨æ˜æ­¤æ•°æ®åŒ…å¤„äºç´§æ€¥çŠ¶æ€åº”è¯¥ä¼˜å…ˆå¤„ç†</li><li>ç¡®è®¤æ ‡å¿—ä½(ACK)ï¼šå¼€å¯æ—¶è¡¨æ˜ç¡®è®¤å·æœ‰æ•ˆ å¦åˆ™å¿½ç•¥ç¡®è®¤å·</li><li>æ¨é€æ ‡å¿—ä½(PSH)ï¼šå¼€å¯æ—¶è¡¨æ˜åº”è¯¥å°½å¿«äº¤ä»˜ç»™åº”ç”¨è¿›ç¨‹ è€Œä¸å¿…ç­‰åˆ°ç¼“å­˜åŒºå¡«æ»¡æ‰æ¨é€</li><li>å¤ä½æ ‡å¿—ä½(RST)ï¼šå¼€å¯æ—¶è¡¨æ˜TCPè¿æ¥å‡ºç°è¿æ¥å‡ºç°é”™è¯¯ æ•°æ®åŒ…éæ³•æ‹’ç»è¿æ¥</li><li>åŒæ­¥æ ‡å¿—ä½(SYN)ï¼šå¼€å¯æ—¶è¡¨æ˜ä¸€ä¸ªè¿æ¥çš„è¯·æ±‚æˆ–è€…æ¥å—æŠ¥æ–‡</li><li>ç»ˆæ­¢æ ‡å¿—ä½(FIN)ï¼šå¼€å¯æ—¶è¡¨æ˜é‡Šæ”¾ä¸€ä¸ªè¿æ¥</li></ul></li><li><p><strong>çª—å£å¤§å°</strong>ï¼šè¡¨ç¤ºæœŸæœ›æ¥å—åˆ°çš„æ¯ä¸ªæ•°æ®åŒ…å­—èŠ‚æ•°</p></li><li><p><strong>æ ¡éªŒå’Œ</strong>ï¼šè¯¥å€¼ä¸ºTCPæŠ¥æ–‡å¤´æ‹¬æ•°æ®éƒ¨åˆ†ä¸­æ¯16Bitçš„äºŒè¿›åˆ¶åç æ±‚å’Œ</p></li><li><p><strong>ç´§æ€¥æŒ‡é’ˆ</strong>ï¼šè‹¥æŒ‡å®šè¯¥å€¼ ä»–åº”è¯¥æ˜¯ä¸€ä¸ªåç§»é‡ è¯¥å€¼åŠ ä¸Šé¡ºåºå·è¡¨ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚çš„é¡ºåºå·</p></li><li><p><strong>å¯é€‰å­—æ®µ</strong>ï¼šåŒ…å«æœ€å¤§è½½è·ä¸çª—å£æ¯”ä¾‹ç­‰ä¿¡æ¯ æ³¨ï¼šè‹¥ä½¿ç”¨è¯¥å­—æ®µåˆ™é•¿åº¦å¿…é¡»ä¸º32Bitçš„å€æ•° ä¸è¶³åˆ™å¡«å……0</p></li></ul></li><li><p><strong>UDPæŠ¥æ–‡</strong></p><p><img src="https://i.loli.net/2021/06/11/Bfh3THSLgzZCUAu.png" alt="img"></p><ul><li><p><strong>æ¥æºç«¯å£</strong>ï¼šå‘ç›®æ ‡ä¸»æœºæŒ‡æ˜æ¥å…¥ä»–çš„ä¸»æœºæ‰€ä½¿ç”¨çš„ç«¯å£å· ç”¨äºç›®æ ‡ä¸»æœºå›åº”</p></li><li><p><strong>ç›®æ ‡ç«¯å£</strong>ï¼šæŒ‡æ˜è¦è¿æ¥çš„ç›®æ ‡ä¸»æœºçš„ç«¯å£å·</p></li><li><p><strong>æ•°æ®åŒ…é•¿åº¦</strong>ï¼šUDPå¤´å’Œæ•°æ®æ€»é•¿åº¦å­—èŠ‚æ•°</p></li><li><p><strong>æ£€éªŒå’Œ</strong>ï¼šè¯¥å€¼ä¸ºUDPæŠ¥æ–‡å¤´æ‹¬æ•°æ®éƒ¨åˆ†ä¸­æ¯16Bitçš„äºŒè¿›åˆ¶åç æ±‚å’Œ</p></li><li><ul><li><strong>æ³¨ï¼šUDPæ£€éªŒå’Œä¸æ˜¯å¿…é¡»çš„</strong></li></ul></li></ul></li></ul><h4 id="1-è¯·ä½ è¯´æ˜ä¸€ä¸‹ï¼ŒTCPåè®®çš„3æ¬¡æ¡æ‰‹ï¼ˆè¿›è¡Œè¿æ¥ï¼‰ï¼Ÿ">1. è¯·ä½ è¯´æ˜ä¸€ä¸‹ï¼ŒTCPåè®®çš„3æ¬¡æ¡æ‰‹ï¼ˆè¿›è¡Œè¿æ¥ï¼‰ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903834708344840">ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹é¢è¯•å®˜æƒ³è€ƒæˆ‘ä»¬ä»€ä¹ˆï¼Ÿ</a></p></blockquote><blockquote><p>TCPä¸­ï¼Œå¯¹<strong>ç¡®è®¤ACKæŠ¥æ–‡æ˜¯ä¸éœ€è¦å‘é€ç¡®è®¤</strong>çš„ ã€‚</p></blockquote><ul><li><p><strong>ç®€ç•¥è¿‡ç¨‹</strong></p><blockquote><p>âš ï¸ SYN å’ŒACKæŠ¥æ–‡æ˜¯ä¸€èµ·å‘çš„ï¼ï¼</p></blockquote><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/27203200-7e3630b0fe1442898e6824ac061d475e.x-png" alt="TCPä¸‰æ¬¡æ¡æ‰‹åŸç†- asfion - åšå®¢å›­"></p><p><strong>1ã€ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘ä¸€ä¸ª SYN æŠ¥æ–‡ï¼Œå¹¶æŒ‡æ˜å®¢æˆ·ç«¯çš„åˆå§‹åŒ–åºåˆ—å· <strong>ISNÂ©</strong>ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <strong>SYN_Send</strong> çŠ¶æ€ã€‚</p><p><strong>2ã€ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ï¼šï¼ˆâš ï¸ <strong>SYN+ACKæ˜¯åœ¨ä¸€ä¸ªåŒ…é‡Œå‘çš„ï¼ï¼ˆå­—èŠ‚ä¸€é¢</strong>ï¼‰ ï¼‰æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡ä¹‹åï¼Œä¼šä»¥è‡ªå·±çš„ SYN æŠ¥æ–‡ä½œä¸ºåº”ç­”ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æŒ‡å®šäº†è‡ªå·±çš„åˆå§‹åŒ–åºåˆ—å· <strong>ISN(s)</strong>ï¼ŒåŒæ—¶ä¼šæŠŠå®¢æˆ·ç«¯çš„ ISN + 1 ä½œä¸º ACK çš„å€¼ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ SYNï¼Œæ­¤æ—¶æœåŠ¡å™¨å¤„äº <strong>SYN_REVD</strong> çš„çŠ¶æ€ã€‚</p><p><strong>3ã€ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ° SYN æŠ¥æ–‡ä¹‹åï¼Œä¼šå‘é€ä¸€ä¸ª ACK æŠ¥æ–‡ï¼Œå½“ç„¶ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠŠæœåŠ¡å™¨çš„ ISN + 1 ä½œä¸º ACK çš„å€¼ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°äº†æœåŠ¡ç«¯çš„ SYN æŠ¥æ–‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <strong>establised</strong> çŠ¶æ€ã€‚</p><p>æœåŠ¡å™¨æ”¶åˆ° ACK æŠ¥æ–‡ä¹‹åï¼Œä¹Ÿå¤„äº <strong>establised çŠ¶æ€</strong>ï¼Œæ­¤æ—¶ï¼ŒåŒæ–¹ä»¥å»ºç«‹èµ·äº†é“¾æ¥ã€‚</p></li></ul><h5 id="1-1-ISN-ï¼ˆInitial-Sequence-Numberï¼‰æ˜¯å›ºå®šçš„å—ï¼Ÿ">1.1 ISN ï¼ˆInitial Sequence Numberï¼‰æ˜¯å›ºå®šçš„å—ï¼Ÿ</h5><ul><li><p><strong>ISNä½œç”¨</strong></p><p>ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤æ¢ ISNï¼Œä»¥ä¾¿è®©å¯¹æ–¹çŸ¥é“<strong>æ¥ä¸‹æ¥æ¥æ”¶æ•°æ®çš„æ—¶å€™å¦‚ä½•æŒ‰åºåˆ—å·ç»„è£…æ•°æ®</strong>ã€‚</p></li><li><p><strong>ISNä¸ºä»€ä¹ˆä¸å›ºå®š</strong>ï¼ˆè¿˜æ˜¯ä¸å¤ªç†è§£ï¼‰</p><blockquote><p>ISNéšæ—¶é—´è€Œå˜åŒ–ï¼Œå› æ­¤æ¯ä¸ªè¿æ¥éƒ½å°†å…·æœ‰ä¸åŒçš„ISNã€‚ISNå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª<strong>32æ¯”ç‰¹</strong>çš„è®¡æ•°å™¨ï¼Œ<strong>æ¯4msåŠ 1</strong> ã€‚</p></blockquote><ul><li><strong>é˜²æ­¢åœ¨ç½‘ç»œä¸­è¢«å»¶è¿Ÿçš„åˆ†ç»„åœ¨ä»¥åè¢«é‡å¤ä¼ è¾“</strong>ï¼Œè€Œå¯¼è‡´æŸä¸ªè¿æ¥çš„ä¸€ç«¯å¯¹å®ƒä½œé”™è¯¯çš„åˆ¤æ–­ï¼›</li><li>å¦‚æœ ISN æ˜¯å›ºå®šçš„ï¼Œæ”»å‡»è€…å¾ˆ<strong>å®¹æ˜“çŒœå‡ºåç»­çš„ç¡®è®¤å·</strong>ï¼Œå› æ­¤ ISN æ˜¯åŠ¨æ€ç”Ÿæˆçš„ã€‚</li></ul></li></ul><h4 id="2-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ">2.<strong>ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼Ÿ</h4><p>1.<strong>ç”¨æ¥ç¡®å®šæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„å‘é€èƒ½åŠ›æ˜¯å¦æ­£å¸¸ï¼›</strong></p><ul><li><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ç½‘ç»œåŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°äº†ã€‚è¿™æ ·æœåŠ¡ç«¯å°±èƒ½å¾—å‡ºç»“è®ºï¼š<u>å®¢æˆ·ç«¯çš„å‘é€èƒ½åŠ›ã€æœåŠ¡ç«¯çš„æ¥æ”¶èƒ½åŠ›æ˜¯æ­£å¸¸çš„ã€‚</u></li><li><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ï¼šæœåŠ¡ç«¯å‘åŒ…ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°äº†ã€‚è¿™æ ·å®¢æˆ·ç«¯å°±èƒ½å¾—å‡ºç»“è®ºï¼š<u>æœåŠ¡ç«¯çš„æ¥æ”¶ã€å‘é€èƒ½åŠ›ï¼Œå®¢æˆ·ç«¯çš„æ¥æ”¶ã€å‘é€èƒ½åŠ›æ˜¯æ­£å¸¸çš„</u>ã€‚<strong>ä¸è¿‡æ­¤æ—¶æœåŠ¡å™¨å¹¶ä¸èƒ½ç¡®è®¤å®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›æ˜¯å¦æ­£å¸¸</strong>ã€‚</li><li><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘åŒ…ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°äº†ã€‚è¿™æ ·æœåŠ¡ç«¯å°±èƒ½å¾—å‡ºç»“è®ºï¼š<u>å®¢æˆ·ç«¯çš„æ¥æ”¶ã€å‘é€èƒ½åŠ›æ­£å¸¸ï¼ŒæœåŠ¡å™¨è‡ªå·±çš„å‘é€ã€æ¥æ”¶èƒ½åŠ›ä¹Ÿæ­£å¸¸ã€‚</u></li></ul><p>2.<strong>æŒ‡å®šè‡ªå·±çš„åˆå§‹åŒ–åºåˆ—å·ï¼Œä¸ºåé¢çš„å¯é ä¼ é€åšå‡†å¤‡ï¼›</strong></p><ul><li>å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„èµ·å§‹åºåˆ—å·å¯ä»¥ç¡®è®¤ï¼Œ<u>æœåŠ¡ç«¯çš„èµ·å§‹åºåˆ—å·</u>å°†å¾—ä¸åˆ°ç¡®è®¤ã€‚</li></ul><ol start="3"><li><strong>å¦‚æœæ˜¯ https åè®®çš„è¯ï¼Œä¸‰æ¬¡æ¡æ‰‹è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿˜ä¼šè¿›è¡Œæ•°å­—<u>è¯ä¹¦çš„éªŒè¯ä»¥åŠåŠ å¯†å¯†é’¥</u>çš„ç”Ÿæˆ</strong>ã€‚</li></ol><h5 id="2-1-ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥æºå¸¦æ•°æ®å—ï¼Ÿ">2.1 ä¸‰æ¬¡æ¡æ‰‹å¯ä»¥æºå¸¦æ•°æ®å—ï¼Ÿ</h5><p><strong>ç¬¬ä¸€æ¬¡ã€ç¬¬äºŒæ¬¡æ¡æ‰‹ä¸å¯ä»¥æºå¸¦æ•°æ® ï¼Œ</strong> ç¬¬ä¸‰æ¬¡å¯ä»¥æºå¸¦æ•°æ®ï¼š</p><ul><li><strong>å¯¹äºç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼Œä¸å¯ä»¥æ”¾æ•°æ®ï¼Œå…¶ä¸­ä¸€ä¸ªç®€å•çš„åŸå› å°±æ˜¯ä¼šè®©æœåŠ¡å™¨æ›´åŠ å®¹æ˜“å—åˆ°æ”»å‡»äº†ã€‚<ul><li>å¦‚æœæœ‰äººè¦æ¶æ„æ”»å‡»æœåŠ¡å™¨ï¼Œé‚£ä»–æ¯æ¬¡éƒ½åœ¨ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¸­çš„ SYN æŠ¥æ–‡ä¸­æ”¾å…¥å¤§é‡çš„æ•°æ®ï¼Œ<strong>æ¶ˆè€—æœåŠ¡å™¨ç©ºé—´æ¥æ¥æ”¶æ•°æ®</strong>ï¼›</li></ul></li><li><strong>å¯¹äºç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼Œå®¢æˆ·ç«¯å·²ç»å¤„äº ESTABLISHED çŠ¶æ€ã€‚å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä»–å·²ç»å»ºç«‹èµ·è¿æ¥äº†ï¼Œ<strong>å·²ç»çŸ¥é“æœåŠ¡å™¨çš„æ¥æ”¶ã€å‘é€èƒ½åŠ›æ­£å¸¸</strong>ï¼Œæ‰€ä»¥èƒ½æºå¸¦æ•°æ®ã€‚</li></ul><h4 id="3-è¯·ä½ è¯´æ˜ä¸€ä¸‹ï¼ŒTCPåè®®çš„4æ¬¡æŒ¥æ‰‹ï¼ˆæ–­å¼€è¿æ¥ï¼‰ï¼Ÿ">3.<strong>è¯·ä½ è¯´æ˜ä¸€ä¸‹ï¼ŒTCPåè®®çš„4æ¬¡æŒ¥æ‰‹ï¼ˆæ–­å¼€è¿æ¥ï¼‰</strong>ï¼Ÿ</h4><blockquote><p><a href="https://www.zhihu.com/question/63264012">ä¸ºä»€ä¹ˆä¸åƒä¸‰æ¬¡æ¡æ‰‹ä¸€æ ·æ‰§è¡Œä¸‰æ¬¡å³å¯ï¼Ÿ</a></p><p>å› ä¸ºç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡å¯¹äºè¢«åŠ¨æ–¹æ¥è¯´ï¼Œæ„ä¹‰æ˜¯ä¸ä¸€æ ·çš„ã€‚<br>ç¬¬äºŒæ¬¡æ˜¯ä¸ºäº†è®©ä¸»åŠ¨æ–¹é—­å˜´ï¼ˆä¸å†å‘æŒ¥æ‰‹è¯·æ±‚ï¼‰ï¼Œè‡ªå·±è¯¥å¹²å˜›è¿˜æ˜¯å¹²å˜›ï¼ˆä½†æ˜¯è‡ªå·±å¯èƒ½è¿˜æœ‰æ•°æ®ç¾å¤„ç†å®Œï¼‰ã€‚<br>ç¬¬ä¸‰æ¬¡æ˜¯ä¸ºäº†è¡¨ç¤ºâ€œæˆ‘çš„æ´»å„¿å¹²å®Œäº†ï¼Œå¯ä»¥ç»“æŸäº†â€ã€‚<br>é€šå¸¸serveræ¥æ”¶åˆ°æŒ¥æ‰‹çš„æ—¶å€™ï¼Œæ‰‹é‡Œè¿˜æœ‰æ´»å„¿æ²¡åšå®Œã€‚</p></blockquote><p>ç”±äºTCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œå› æ­¤æ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»å•ç‹¬è¿›è¡Œå…³é—­ã€‚è¿™ä¸ªåŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆå®ƒçš„æ•°æ®å‘é€ä»»åŠ¡åå°±èƒ½å‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢è¿™ä¸ªæ–¹å‘çš„è¿æ¥ã€‚</p><p><u>æ”¶åˆ°ä¸€ä¸ª FINåªæ„å‘³ç€è¿™ä¸€æ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®æµåŠ¨ï¼Œä¸€ä¸ªTCPè¿æ¥åœ¨æ”¶åˆ°ä¸€ä¸ªFINåä»èƒ½å‘é€æ•°æ®</u>ã€‚é¦–å…ˆè¿›è¡Œå…³é—­çš„ä¸€æ–¹å°†æ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè€Œå¦ä¸€æ–¹æ‰§è¡Œè¢«åŠ¨å…³é—­ã€‚</p><p>TCPçš„è¿æ¥çš„æ‹†é™¤éœ€è¦å‘é€å››ä¸ªåŒ…ï¼Œå› æ­¤ç§°ä¸ºå››æ¬¡æŒ¥æ‰‹(four-way handshake)ã€‚å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å‡å¯ä¸»åŠ¨å‘èµ·æŒ¥æ‰‹åŠ¨ä½œï¼Œåœ¨socketç¼–ç¨‹ä¸­ï¼Œä»»ä½•ä¸€æ–¹æ‰§è¡Œclose()æ“ä½œå³å¯äº§ç”ŸæŒ¥æ‰‹æ“ä½œã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20211127191012778.png" alt="image-20211127191012778"></p><p>ï¼ˆ1ï¼‰å®¢æˆ·ç«¯Aå‘é€ä¸€ä¸ªFINï¼Œ<u>æŠ¥æ–‡ä¸­ä¼šæŒ‡å®šä¸€ä¸ªåºåˆ—å·</u>Mï¼Œç”¨æ¥å…³é—­å®¢æˆ·Aåˆ°æœåŠ¡å™¨Bçš„æ•°æ®ä¼ é€ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº<strong>FIN_WAIT1</strong>çŠ¶æ€ï¼›</p><p>ï¼ˆ2ï¼‰æœåŠ¡å™¨Bæ”¶åˆ°è¿™ä¸ªFINï¼Œå®ƒå‘å›ä¸€ä¸ªACKï¼Œ<u>ç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·M+1</u>ã€‚å’ŒSYNä¸€æ ·ï¼Œä¸€ä¸ªFINå°†å ç”¨ä¸€ä¸ªåºå·ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº <strong>CLOSE_WAIT</strong>çŠ¶æ€ï¼›</p><p>ï¼ˆ3ï¼‰æœåŠ¡å™¨Bå…³é—­ä¸å®¢æˆ·ç«¯Açš„è¿æ¥ï¼Œå‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯Aå’Œåºåˆ—å·Nï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº <strong>LAST_ACK</strong> çš„çŠ¶æ€ï¼›</p><p>ï¼ˆ4ï¼‰å®¢æˆ·ç«¯Aå‘å›ACKæŠ¥æ–‡ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºN+1ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <strong>TIME_WAIT</strong> çŠ¶æ€ï¼Œéœ€è¦è¿‡ä¸€é˜µå­ä»¥ç¡®ä¿æœåŠ¡ç«¯æ”¶åˆ°è‡ªå·±çš„ ACK æŠ¥æ–‡ä¹‹åæ‰ä¼šè¿›å…¥ <strong>CLOSED</strong> çŠ¶æ€ï¼›æœåŠ¡ç«¯æ”¶åˆ° ACK æŠ¥æ–‡ä¹‹åï¼Œå°±å¤„äºå…³é—­è¿æ¥äº†ï¼Œå¤„äº <strong>CLOSED</strong> çŠ¶æ€ã€‚</p><h5 id="3-1-ä¸ºä»€ä¹ˆTCPå››æ¬¡æŒ¥æ‰‹è¦åŸºäºå…¨åŒå·¥ï¼Œä¸åŸºäºåŠåŒå·¥å‘¢ï¼ŸåŸºäºåŠåŒå·¥å¯ä»¥æ”¹ä¸ºä¸‰æ¬¡æŒ¥æ‰‹å—ï¼Ÿ">3.1 ä¸ºä»€ä¹ˆTCPå››æ¬¡æŒ¥æ‰‹è¦åŸºäºå…¨åŒå·¥ï¼Œä¸åŸºäºåŠåŒå·¥å‘¢ï¼ŸåŸºäºåŠåŒå·¥å¯ä»¥æ”¹ä¸ºä¸‰æ¬¡æŒ¥æ‰‹å—ï¼Ÿ</h5><blockquote><p>åŠåŒå·¥ï¼šåŒæ—¶åªèƒ½æœ‰ä¸€ç«¯å‘é€æ¶ˆæ¯ ï¼› å…¨åŒå·¥ï¼šä¸¤ç«¯éƒ½å¯ä»¥éšæœºæ¥å—/å‘é€ã€‚</p></blockquote><p>åœ¨å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ä¸­ï¼Œä¼¼ä¹C/Sä¸¤ç«¯éƒ½æ˜¯ç­‰å¾…å¯¹æ–¹å‘é€FIN/ACKï¼Œæ‰ä¼šå‘é€å¯¹åº”çš„ACK/FINç‰ˆæœ¬ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€æ–¹åœ¨å‘é€æ¶ˆæ¯ï¼Œæ»¡è¶³åŠåŒå·¥ã€‚</p><p>ä½†æ˜¯ï¼ŒåŠåŒå·¥æ¨¡å¼æ•ˆç‡ä¼šæ›´ä½ï¼šæ¯”å¦‚Cç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘é€FINæŠ¥æ–‡è¯·æ±‚å…³é—­ï¼Œä½†æ˜¯Sç«¯ï¼ˆ<strong>æœåŠ¡ç«¯</strong>ï¼‰ä¾æ—§<strong>å¯ä»¥åŒæ—¶å‘ç”Ÿæ•°æ®</strong> ï¼Œè¿™ä¸ªæ—¶å€™æ•ˆç‡æ›´é«˜ã€‚</p><h5 id="3-2ï¼ˆé‡ç‚¹ï¼‰-æœåŠ¡å™¨å‡ºç°å¤§é‡close-waitçš„è¿æ¥çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆè§£å†³æ–¹æ³•ï¼Ÿ">3.2ï¼ˆé‡ç‚¹ï¼‰ æœåŠ¡å™¨å‡ºç°å¤§é‡close_waitçš„è¿æ¥çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆè§£å†³æ–¹æ³•ï¼Ÿ</h5><p>close_waitçŠ¶æ€æ˜¯åœ¨ï¼ŒTCPå››æ¬¡æŒ¥æ‰‹çš„æ—¶å€™<strong>æœåŠ¡å™¨æ”¶åˆ°FINï¼Œä½†æ˜¯æ²¡æœ‰å‘é€è‡ªå·±çš„FINæ—¶å‡ºç°çš„</strong>ã€‚æœåŠ¡å™¨å‡ºç°å¤§é‡close_waitçŠ¶æ€çš„åŸå› æœ‰ä¸¤ç§ï¼š</p><ul><li><strong>æœåŠ¡å™¨å†…éƒ¨ä¸šåŠ¡å¤„ç†å ç”¨äº†è¿‡å¤šæ—¶é—´</strong>ï¼Œéƒ½æ²¡èƒ½å¤„ç†å®Œä¸šåŠ¡ï¼›æˆ–è€…è¿˜æœ‰æ•°æ®éœ€è¦å‘é€ï¼›æˆ–è€…æœåŠ¡å™¨çš„ä¸šåŠ¡é€»è¾‘æœ‰é—®é¢˜ï¼Œæ²¡æœ‰æ‰§è¡Œclose()æ–¹æ³•</li><li>æœåŠ¡å™¨çš„çˆ¶è¿›ç¨‹æ´¾ç”Ÿå‡ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ç»§æ‰¿äº†socketï¼Œæ”¶åˆ°FINçš„æ—¶å€™<strong>å­è¿›ç¨‹å¤„ç†ä½†çˆ¶è¿›ç¨‹æ²¡æœ‰å¤„ç†è¯¥ä¿¡å·</strong>ï¼Œå¯¼è‡´socketçš„å¼•ç”¨ä¸ä¸º0æ— æ³•å›æ”¶</li></ul><p>å¤„ç†æ–¹æ³•ï¼š</p><ul><li>åœæ­¢åº”ç”¨ç¨‹åº</li><li>ä¿®æ”¹ç¨‹åºé‡Œçš„bug</li></ul><h4 id="4-ä¸ºä»€ä¹ˆè¦æœ‰TIME-WAIT-çŠ¶æ€ï¼Ÿä¸ºä»€ä¹ˆç­‰å¾…æ˜¯2MSLï¼Ÿ">4. ä¸ºä»€ä¹ˆè¦æœ‰TIME_WAIT çŠ¶æ€ï¼Ÿä¸ºä»€ä¹ˆç­‰å¾…æ˜¯2MSLï¼Ÿ</h4><ul><li><p><strong>è¦ç¡®ä¿æœåŠ¡å™¨æ˜¯å¦å·²ç»æ”¶åˆ°äº†å®¢æˆ·ç«¯æœ€åçš„ACK æŠ¥æ–‡</strong>ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°çš„è¯ï¼Œ<u>æœåŠ¡å™¨ä¼šé‡æ–°å‘ FIN + ACKæŠ¥æ–‡ç»™å®¢æˆ·ç«¯</u>ï¼Œå®¢æˆ·ç«¯å†æ¬¡æ”¶åˆ° FIN + ACK æŠ¥æ–‡ä¹‹åï¼Œå°±çŸ¥é“ä¹‹å‰çš„ ACK æŠ¥æ–‡ä¸¢å¤±äº†ï¼Œç„¶å<u>å†æ¬¡å‘é€ ACK æŠ¥æ–‡ã€‚</u></p></li><li><p><strong>ç¡®ä¿ä¹‹å‰è¿æ¥çš„ä¸€äº›æ•°æ®ä¸åœ¨æ»ç•™åœ¨ç½‘ç»œä¸­</strong>ï¼šç¡®ä¿å·²ç»å¤±æ•ˆè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µä¸ä¼šå†å‡ºç°åœ¨æœ¬è¿æ¥ä¸­ï¼Œ<strong>å®¢æˆ·ç«¯å‘å®Œæœ€åä¸€ä¸ªACKæŠ¥æ–‡æ®µå</strong>ï¼Œå†ç»è¿‡<strong>2MSL</strong>å¯ä»¥ä½¿å¾—æœ¬è¿æ¥ä¸­æ‰€æœ‰çš„æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚å®¢æˆ·ç«¯å°±å¯ä»¥æ”¾å¿ƒåœ°<strong>é‡Šæ”¾</strong>TCPå ç”¨çš„èµ„æºã€ç«¯å£å·ï¼Œè¿æ¥ä»»ä½•æœåŠ¡å™¨ã€‚</p><blockquote><p>å¦‚æœ<strong>å®¢æˆ·ç«¯</strong>ç›´æ¥CLOSEDï¼Œç„¶ååˆå†æ¬¡å‘æœåŠ¡å™¨<strong>å‘èµ·ä¸€ä¸ªæ–°è¿æ¥</strong>ï¼Œæœ‰å¯èƒ½<strong>æ–°ã€è€è¿æ¥çš„ç«¯å£å·ä¸€æ ·</strong>çš„ã€‚å‡è®¾æ–°ã€è€è¿æ¥ç«¯å£å·ä¸€è‡´ï¼Œè‹¥è€è¿æ¥çš„ä¸€äº›æ•°æ®ä»æ»ç•™åœ¨ç½‘ç»œä¸­ï¼Œè¿™äº›æ»ç•™æ•°æ®åœ¨æ–°è¿æ¥å»ºç«‹åæ‰åˆ°è¾¾æœåŠ¡å™¨ï¼Œé‰´äºå‰åç«¯å£å·ä¸€è‡´ï¼ŒTCPåè®®å°±é»˜è®¤è¿™äº›æ•°æ®å±äºæ–°è¿æ¥ï¼Œäºæ˜¯æ•°æ®å°±è¿™æ ·ä¹±æˆä¸€é”…ç²¥äº†ã€‚</p></blockquote></li></ul><h5 id="4-1-ä¸ºä»€ä¹ˆæ˜¯2MSL">4.1 ä¸ºä»€ä¹ˆæ˜¯2MSL?</h5><p>MSLæ˜¯æŠ¥æ–‡åœ¨ç½‘ç»œä¸­æœ€é•¿ç”Ÿå­˜æ—¶é—´ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¥ç¨‹å€¼(ç»éªŒå€¼)ï¼Œä¸åŒçš„ç³»ç»Ÿä¸­å¯èƒ½ä¸åŒ ã€‚</p><p>è€ƒè™‘æœ€å æƒ…å†µï¼Œå®¢æˆ·ç«¯Aæœ€åä¸€æ¬¡æŒ¥æ‰‹å‘é€ç»™æœåŠ¡ç«¯Bçš„ACKæŠ¥æ–‡ä¸¢å¤±äº†ï¼š</p><ol><li>ACKä»æœ€å¤šç»è¿‡1MSLä¼šåˆ°è¾¾æœåŠ¡ç«¯ï¼Œ<strong>è¶…è¿‡1MSLæœåŠ¡ç«¯ä¼šé‡å‘FIN</strong></li><li>æœåŠ¡ç«¯é‡å‘çš„FINæœ€å¤šç»è¿‡1MSLåˆ°è¾¾A</li></ol><p>æ‰€ä»¥ä¸ºäº†ç¡®ä¿ï¼Œå®¢æˆ·ç«¯èƒ½<strong>æ¥æ”¶åˆ°æœåŠ¡ç«¯é‡å‘çš„FINæŠ¥æ–‡</strong>ã€‚</p><h4 id="5-ã€é‡ç‚¹ã€‘è¯·é—®TCPä¸ºä»€ä¹ˆè¦æ›´å¯é ï¼Ÿå“ªç§åœºæ™¯ä¼šæœ‰æ‰€åº”ç”¨ï¼Ÿ">5. ã€é‡ç‚¹ã€‘<strong>è¯·é—®TCPä¸ºä»€ä¹ˆè¦æ›´å¯é ï¼Ÿå“ªç§åœºæ™¯ä¼šæœ‰æ‰€åº”ç”¨ï¼Ÿ</strong></h4><ol><li><p><strong>è¶…æ—¶é‡ä¼ </strong>ï¼šå½“ TCP å‘å‡ºâ¼€ä¸ªæŠ¥æ–‡æ®µåï¼Œå®ƒå¯åŠ¨â¼€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…â½¬çš„ç«¯ç¡®è®¤æ”¶åˆ°è¿™ä¸ªæŠ¥â½‚æ®µã€‚å¦‚æœä¸èƒ½åŠæ—¶æ”¶åˆ°â¼€ä¸ªç¡®è®¤ï¼Œå°†é‡å‘è¿™ä¸ªæŠ¥â½‚æ®µï¼›</p></li><li><p><strong>æ•°æ®æ’åº</strong>ï¼šTCPæœ‰ä¸“é—¨çš„åºåˆ—å·<strong>ISNå­—æ®µ</strong>ï¼Œå¯æä¾›æ•°æ®re-orderï¼›</p></li><li><p><strong>æµé‡æ§åˆ¶</strong>ï¼šæ»‘åŠ¨çª—å£å’Œè®¡æ—¶å™¨çš„ä½¿ç”¨ã€‚TCPçª—å£ä¸­ä¼šæŒ‡æ˜åŒæ–¹èƒ½å¤Ÿ<u>å‘é€æ¥æ”¶çš„æœ€å¤§æ•°æ®é‡ï¼›</u></p><blockquote><p><strong>ARQåè®®</strong>ï¼š ä¹Ÿæ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“çš„ï¼Œå®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯æ¯å‘å®Œâ¼€ä¸ªåˆ†ç»„å°±åœâ½Œå‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚åœ¨æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹â¼€ä¸ªåˆ†ç»„ã€‚</p></blockquote></li><li><p><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šTCPçš„æ‹¥å¡æ§åˆ¶ç”±4ä¸ªæ ¸å¿ƒç®—æ³•ç»„æˆã€‚â€œæ…¢å¯åŠ¨â€ï¼ˆSlow Startï¼‰ã€<u>â€œæ‹¥å¡é¿å…â€</u>ï¼ˆCongestion avoidanceï¼‰ã€â€œå¿«é‡ä¼  â€ï¼ˆFast Retransmitï¼‰ã€â€œå¿«æ¢å¤â€ï¼ˆFast Recoveryï¼‰ï¼›</p></li><li><p><strong>æ ¡éªŒå’Œ</strong>ï¼š TCP å°†ä¿æŒå®ƒâ¾¸éƒ¨å’Œæ•°æ®çš„æ£€éªŒå’Œã€‚è¿™æ˜¯â¼€ä¸ªç«¯åˆ°ç«¯çš„æ£€éªŒå’Œï¼Œâ½¬çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ”¶åˆ°æ®µçš„æ£€éªŒå’Œæœ‰å·®é”™ï¼ŒTCP å°†<strong>ä¸¢å¼ƒè¿™ä¸ªæŠ¥â½‚æ®µå’Œä¸ç¡®è®¤æ”¶åˆ°æ­¤æŠ¥â½‚æ®µ</strong>ã€‚</p></li></ol><p>ã€<strong>åº”ç”¨åœºæ™¯</strong>ã€‘</p><p><u>å½“å¯¹ç½‘ç»œé€šè®¯è´¨é‡æœ‰è¦æ±‚çš„æ—¶å€™ï¼Œ</u>æ¯”å¦‚ï¼šæ•´ä¸ªæ•°æ®è¦å‡†ç¡®æ— è¯¯çš„ä¼ é€’ç»™å¯¹æ–¹ï¼Œè¿™å¾€å¾€ç”¨äºä¸€äº›è¦æ±‚å¯é çš„åº”ç”¨</p><ul><li>æ¯”å¦‚HTTPã€HTTPSã€FTPç­‰ä¼ è¾“æ–‡ä»¶çš„åè®®ï¼ŒPOPã€SMTPç­‰é‚®ä»¶ä¼ è¾“çš„åè®®</li></ul><h5 id="5-1-è¶…æ—¶é‡ä¼ æœºåˆ¶åŸç†ï¼Ÿ">5.1 è¶…æ—¶é‡ä¼ æœºåˆ¶åŸç†ï¼Ÿ</h5><p>åŸºæœ¬åŸç†ï¼šåœ¨å‘é€ä¸€ä¸ªæ•°æ®ä¹‹åï¼Œå°±å¼€å¯ä¸€ä¸ª<strong>å®šæ—¶å™¨</strong>ï¼Œè‹¥æ˜¯åœ¨è¿™ä¸ªæ—¶é—´å†…<strong>æ²¡æœ‰æ”¶åˆ°å‘é€æ•°æ®çš„ACKç¡®è®¤æŠ¥æ–‡</strong>ï¼Œåˆ™å¯¹è¯¥æŠ¥æ–‡è¿›è¡Œ<strong>é‡ä¼ </strong>ï¼Œåœ¨è¾¾åˆ°ä¸€å®šæ¬¡æ•°è¿˜æ²¡æœ‰æˆåŠŸæ—¶æ”¾å¼ƒå¹¶å‘é€ä¸€ä¸ªå¤ä½ä¿¡å·ã€‚</p><p>TCPä¸­æœ‰å››ç§è®¡æ—¶å™¨ï¼ˆTimerï¼‰ï¼Œåˆ†åˆ«ä¸ºï¼š</p><ol><li><p><strong>é‡ä¼ è®¡æ—¶å™¨</strong>ï¼šåœ¨<strong>æ»‘åŠ¨çª—å£åè®®</strong>ä¸­ï¼Œæ¥å—çª—å£ä¼šåœ¨<strong>è¿ç»­æ”¶åˆ°çš„åŒ…åºåˆ—ï¼ˆè¿ç»­ARQï¼‰<strong>ä¸­çš„</strong>æœ€åä¸€ä¸ªåŒ…</strong>å‘æ¥æ”¶ç«¯å‘é€ä¸€ä¸ªACKã€‚å½“ç½‘ç»œæ‹¥å µçš„æ—¶å€™ï¼Œå‘é€ç«¯çš„æ•°æ®åŒ…å’Œæ¥æ”¶ç«¯çš„ACKåŒ…éƒ½æœ‰å¯èƒ½ä¸¢å¤±ã€‚TCPä¸ºäº†ä¿è¯æ•°æ®å¯é ä¼ è¾“ï¼Œå°±è§„å®šåœ¨<strong>é‡ä¼ çš„â€œæ—¶é—´ç‰‡â€<strong>åˆ°äº†ä»¥åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ACKï¼Œå°±</strong>é‡å‘æ­¤åŒ…</strong>ï¼Œä»¥é¿å…é™·å…¥æ— é™ç­‰å¾…ä¸­ã€‚</p></li><li><p><strong>åšæŒè®¡æ—¶å™¨</strong>ï¼šåœ¨<strong>æ»‘åŠ¨çª—å£åè®®</strong>ä¸­ï¼Œå½“å‘é€TCPæ”¶åˆ°<strong>çª—å£å¤§å°ä¸º0</strong>çš„ç¡®è®¤ACKæ—¶ï¼Œå°±åšæŒå¯åŠ¨è®¡æ—¶å™¨ã€‚å½“åšæŒè®¡æ—¶å™¨æœŸé™åˆ°æ—¶ï¼Œå‘é€TCPå°±å‘é€ä¸€ä¸ªç‰¹æ®Šçš„æŠ¥æ–‡æ®µï¼Œå«åšæ¢æµ‹æŠ¥æ–‡ã€‚è¿™ä¸ªæŠ¥æ–‡æ®µåªæœ‰ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚ä»–æœ‰ä¸€ä¸ªåºå·ï¼Œä½†ä»–çš„åºå·æ°¸è¿œä¸éœ€è¦ç¡®è®¤ï¼›ç”šè‡³åœ¨è®¡ç®—æœºå¯¹å…¶ä»–éƒ¨åˆ†çš„æ•°æ®çš„ç¡®è®¤æ—¶è¯¥åºå·ä¹Ÿè¢«å¿½ç•¥ã€‚æ¢æµ‹æŠ¥æ–‡æ®µæé†’æ¥å—TCPï¼šç¡®è®¤å·²ä¸¢å¤±ï¼Œå¿…é¡»é‡ä¼ ã€‚</p></li><li><p><strong>ä¿æ´»è®¡æ—¶å™¨</strong>ï¼šä¿æ´»è®¡æ—¶å™¨ä½¿ç”¨åœ¨æŸäº›å®ç°ä¸­ï¼Œç”¨æ¥<strong>é˜²æ­¢åœ¨ä¸¤ä¸ªTCPä¹‹é—´çš„è¿æ¥å‡ºç°é•¿æ—¶é—´çš„ç©ºé—²</strong>ã€‚å‡å®šå®¢æˆ·æ‰“å¼€äº†åˆ°æœåŠ¡å™¨çš„è¿æ¥ï¼Œä¼ é€äº†ä¸€äº›æ•°æ®ï¼Œç„¶åå°±ä¿æŒé™é»˜äº†ã€‚ä¹Ÿè®¸è¿™ä¸ªå®¢æˆ·å‡ºæ•…éšœäº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¿æ¥å°†æ°¸è¿œçš„å¤„äºæ‰“å¼€çŠ¶æ€ã€‚</p><p>é€šå¸¸è®¾ç½®ä¸ºä¸¤å°æ—¶ã€‚è‹¥æœåŠ¡å™¨è¿‡äº†ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œä»–å°±å‘é€æ¢æµ‹æŠ¥æ–‡æ®µã€‚è‹¥<strong>å‘é€äº†10ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µ</strong>ï¼ˆæ¯ä¸€ä¸ªåƒä¸ª75ç§’ï¼‰è¿˜æ²¡æœ‰å“åº”ï¼Œå°±å‡å®šå®¢æˆ·é™¤äº†æ•…éšœï¼Œå› è€Œå°±ç»ˆæ­¢äº†è¯¥è¿æ¥ã€‚</p></li><li><p><strong>æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨</strong>ï¼šå››æ¬¡æŒ¥æ”¶åtime waiterçŠ¶æ€ä¸­ä½¿ç”¨ã€‚</p></li></ol><h5 id="5-2-ä»‹ç»ä¸€ä¸‹ARQåè®®-ï¼Ÿ">5.2 ä»‹ç»ä¸€ä¸‹ARQåè®® ï¼Ÿ</h5><p>â¾ƒåŠ¨é‡ä¼ è¯·æ±‚ï¼ˆAutomatic Repeat-reQuestï¼ŒARQï¼‰æ˜¯OSIæ¨¡å‹ä¸­æ•°æ®é“¾è·¯å±‚å’Œä¼ è¾“å±‚çš„é”™è¯¯çº æ­£åè®®ä¹‹â¼€ã€‚å®ƒé€šè¿‡ä½¿ç”¨<strong>ç¡®è®¤å’Œè¶…æ—¶</strong>è¿™ä¸¤ä¸ªæœºåˆ¶ï¼Œåœ¨ä¸å¯é æœåŠ¡çš„åŸºç¡€ä¸Šå®ç°å¯é çš„ä¿¡æ¯ä¼ è¾“ã€‚å¦‚æœå‘é€æ–¹åœ¨å‘é€åâ¼€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤å¸§ï¼Œå®ƒé€šå¸¸ä¼šé‡æ–°å‘é€ã€‚</p><p>ARQåŒ…æ‹¬<strong>åœâ½Œç­‰å¾…ARQåè®®</strong>å’Œ<strong>è¿ç»­ARQåè®®</strong>ã€‚</p><ul><li><strong>åœâ½Œç­‰å¾…ARQåè®®</strong>ã€‚ åœâ½Œç­‰å¾…åè®®æ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“çš„ï¼Œå®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯æ¯å‘å®Œâ¼€ä¸ª<strong>åˆ†ç»„</strong>å°±åœâ½Œå‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ï¼ˆå›å¤ACKï¼‰ã€‚å¦‚æœè¿‡äº†â¼€æ®µæ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´åï¼‰ï¼Œè¿˜æ˜¯æ²¡æœ‰æ”¶åˆ° ACK ç¡®è®¤ï¼Œè¯´æ˜æ²¡æœ‰å‘é€æˆåŠŸï¼Œéœ€è¦é‡æ–°å‘é€ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹â¼€ä¸ªåˆ†ç»„ï¼›åœ¨åœâ½Œç­‰å¾…åè®®ä¸­ï¼Œè‹¥æ¥æ”¶æ–¹æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ã€‚<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•</li><li><strong>ç¼ºç‚¹</strong>ï¼šä¿¡é“åˆ©ç”¨ä½ï¼Œç­‰å¾…æ—¶é—´é•¿</li></ul></li><li><strong>è¿ç»­ARQåè®®</strong>ã€‚è¿ç»­ ARQ åè®®å¯æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚å‘é€æ–¹ç»´æŒâ¼€<strong>ä¸ªå‘é€çª—å£</strong>ï¼Œå‡¡ä½äºå‘é€çª—å£å†…çš„åˆ†ç»„å¯ä»¥è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚æ¥æ”¶æ–¹â¼€èˆ¬é‡‡ç”¨<strong>ç´¯è®¡ç¡®è®¤</strong>ï¼Œå¯¹æŒ‰åºåˆ°è¾¾çš„<strong>æœ€åâ¼€ä¸ªåˆ†ç»„å‘é€ç¡®</strong>è®¤ï¼Œè¡¨æ˜åˆ°è¿™ä¸ªåˆ†ç»„ä¸ºâ½Œçš„æ‰€æœ‰åˆ†ç»„éƒ½å·²ç»æ­£ç¡®æ”¶åˆ°äº†ã€‚<ul><li><strong>ä¼˜ç‚¹</strong>ï¼š ä¿¡é“åˆ©ç”¨ç‡é«˜ï¼Œå®¹æ˜“å®ç°ï¼Œå³ä½¿ç¡®è®¤ä¸¢å¤±ï¼Œä¹Ÿä¸å¿…é‡ä¼ ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š ä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ”¶åˆ°çš„æ‰€æœ‰åˆ†ç»„çš„ä¿¡æ¯ã€‚ â½å¦‚ï¼šå‘é€æ–¹å‘é€äº† 5æ¡ æ¶ˆæ¯ï¼Œ<strong>ä¸­é—´ç¬¬ä¸‰æ¡ä¸¢å¤±ï¼ˆ3å·</strong>ï¼‰ï¼Œè¿™æ—¶æ¥æ”¶æ–¹<strong>åªèƒ½å¯¹å‰ä¸¤ä¸ªå‘é€ç¡®è®¤</strong>ã€‚å‘é€æ–¹æ— æ³•çŸ¥é“åä¸‰ä¸ªåˆ†ç»„çš„ä¸‹è½ï¼Œè€Œåªå¥½æŠŠå<strong>ä¸‰ä¸ªå…¨éƒ¨é‡ä¼ </strong>â¼€æ¬¡ã€‚è¿™ä¹Ÿå« <strong>Go-Back-N</strong>ï¼ˆå›é€€ Nï¼‰ï¼Œè¡¨ç¤ºéœ€è¦é€€å›æ¥é‡ä¼ å·²ç»å‘é€è¿‡çš„N ä¸ªæ¶ˆæ¯ã€‚</li></ul></li></ul><h5 id="5-2-ä»‹ç»ä¸€ä¸‹è¿ç»­ARQåè®®æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶ï¼Ÿ">5.2 ä»‹ç»ä¸€ä¸‹è¿ç»­ARQåè®®æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶ï¼Ÿ</h5><p>TCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶æ˜¯ä¸ºäº†<strong>æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶</strong>ã€‚ æ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥â½‚ä¸­çš„çª—å£å­—æ®µå¯ä»¥ç”¨æ¥æ§åˆ¶<strong>å‘é€æ–¹çª—å£</strong>å¤§å°ï¼Œä»è€Œå½±å“å‘é€æ–¹çš„å‘é€é€Ÿç‡ã€‚å°†çª—å£å­—æ®µè®¾ç½®ä¸º 0ï¼Œåˆ™å‘é€æ–¹ä¸èƒ½å‘é€æ•°æ®ã€‚</p><h5 id="5-3-ä»‹ç»ä¸€ä¸‹æ‹¥å¡æ§åˆ¶ï¼Ÿ">5.3 ä»‹ç»ä¸€ä¸‹æ‹¥å¡æ§åˆ¶ï¼Ÿ</h5><p>ä¸ºäº†è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼ŒTCP å‘é€æ–¹è¦ç»´æŒâ¼€ä¸ª <u>æ‹¥å¡çª—å£(cwnd)</u> çš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡æ§åˆ¶çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚å‘é€æ–¹è®©â¾ƒâ¼°çš„<strong>å‘é€çª—å£ == å–ä¸ºæ‹¥å¡çª—å£å’Œæ¥æ”¶æ–¹çš„æ¥å—çª—å£ä¸­è¾ƒå°çš„â¼€ä¸ª</strong>ã€‚</p><p>TCPçš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼š</p><ul><li><p><strong>æ…¢å¼€å§‹</strong>ï¼š æ…¢å¼€å§‹ç®—æ³•çš„æ€è·¯æ˜¯å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æœâ½´å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨â¼Šåˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¼•èµ·ç½‘ç»œé˜»å¡ï¼Œå› ä¸ºç°åœ¨è¿˜ä¸çŸ¥é“ç½‘ç»œçš„ç¬¦åˆæƒ…å†µã€‚ç»éªŒè¡¨æ˜ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæ¢æµ‹â¼€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚cwndåˆå§‹å€¼ä¸º1ï¼Œ<strong>æ¯ç»è¿‡â¼€ä¸ªä¼ æ’­è½®æ¬¡RTTï¼ŒcwndåŠ å€</strong>ï¼›</p></li><li><p><strong>æ‹¥å¡é¿å…</strong>ï¼š æ‹¥å¡é¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡çª—â¼cwndç¼“æ…¢å¢å¤§ï¼Œå³æ¯ç»è¿‡<strong>â¼€ä¸ªå¾€è¿”æ—¶é—´RTTï¼Œå°±æŠŠå‘é€æ”¾çš„cwndåŠ 1</strong>ï¼›</p></li><li><p><strong>å¿«é‡ä¼ /å¿«æ¢å¤</strong>ï¼š</p><blockquote><p>åŒºåˆ†å¿«é‡ä¼ ï¼Œè¿ç»­ARQä¸­é—´ä¸¢å¤±æ˜¯Go back nã€‚</p></blockquote><p>åœ¨ TCP/IP ä¸­ï¼Œå¿«é€Ÿé‡ä¼ å’Œæ¢å¤ï¼ˆfast retransmit and recoveryï¼ŒFRRï¼‰æ˜¯â¼€ç§æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œ<u>å®ƒèƒ½å¿«é€Ÿæ¢å¤ä¸¢å¤±çš„æ•°æ®åŒ…ã€‚</u>å¦‚æœ<strong>æ¥æ”¶æœº</strong>æ¥æ”¶åˆ°â¼€ä¸ªã€<strong>ä¸æŒ‰é¡ºåºã€‘çš„æ•°æ®æ®µï¼Œå®ƒä¼šâ½´å³ç»™å‘é€æœºå‘é€â¼€ä¸ªé‡å¤ç¡®è®¤ï¼ˆè€Œä¸æ˜¯ç­‰åˆ°è‡ªå·±å‘é€æ•°æ®æ—¶æ‰æå¸¦ç¡®è®¤ï¼‰ã€‚å¦‚æœå‘é€æœºæ¥æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤</strong>ï¼Œå®ƒä¼šå‡å®šç¡®è®¤æŒ‡å‡ºçš„æ•°æ®æ®µä¸¢å¤±äº†ï¼Œå¹¶â½´å³é‡ä¼ è¿™äº›ä¸¢å¤±çš„æ•°æ®æ®µï¼ˆ<strong>è€Œä¸å¿…ç»§ç»­ç­‰å¾…ä¸ºè¯¥æŠ¥æ–‡æ®µè®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨çš„è¶…æ—¶</strong>ï¼‰ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/20170823152124856" alt="img"></p></li></ul><h5 id="5-4-å¦‚ä½•åŒºåˆ†æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Ÿ">5.4 å¦‚ä½•åŒºåˆ†æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Ÿ</h5><ul><li><strong>æµé‡æ§åˆ¶å±äºé€šä¿¡åŒæ–¹åå•†ï¼Œæ‹¥å¡æ§åˆ¶æ¶‰åŠé€šä¿¡é“¾è·¯å…¨å±€ï¼›</strong></li><li>æµé‡æ§åˆ¶éœ€è¦é€šä¿¡åŒæ–¹å„ç»´æŠ¤ä¸€ä¸ªå‘é€çª—ã€ä¸€ä¸ªæ¥æ”¶çª—ï¼Œå¯¹ä»»æ„ä¸€æ–¹ï¼Œ<strong>æ¥æ”¶çª—å¤§å°ç”±è‡ªèº«å†³å®šï¼Œå‘é€çª—å¤§å°ç”±æ¥æ”¶æ–¹å“åº”çš„TCPæŠ¥æ–‡æ®µä¸­çª—å£å€¼ç¡®å®š</strong>ï¼›æ‹¥å¡æ§åˆ¶çš„æ‹¥å¡çª—å£å¤§å°å˜åŒ–ç”±è¯•æ¢æ€§å‘é€ä¸€å®šæ•°æ®é‡æ•°æ®æ¢æŸ¥ç½‘ç»œçŠ¶å†µåè€Œè‡ªé€‚åº”è°ƒæ•´ã€‚</li></ul><h4 id="6-å¦‚ä½•æé«˜å®¢æˆ·ç«¯å¹¶å‘æ•°ï¼Ÿ">6.<strong>å¦‚ä½•æé«˜å®¢æˆ·ç«¯å¹¶å‘æ•°ï¼Ÿ</strong></h4><p>å®¢æˆ·ç«¯å»ºç«‹çš„tcpæ•°é‡å—é™äºæœ€å¤§æ–‡ä»¶å¥æŸ„æ•°ï¼Œä¸€ä¸ªè¿æ¥å°±ä¼šå»ºä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œåœ¨linux ä¸Šé»˜è®¤æ˜¯<strong>1024</strong>ã€‚</p><ul><li>ä½¿ç”¨<code>ulimit</code> å¯ä»¥ä¿®æ”¹æœ€å¤§è¿›ç¨‹æ•°ï¼ˆ<strong>æœ€å¤§ä¸º65535</strong>ï¼‰</li></ul><h4 id="7-è¯´è¯´HTTPã€TCPã€Socket-çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ">7.<strong>è¯´è¯´HTTPã€TCP</strong>ã€Socket çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li><strong>TCP/IP</strong> ä»£è¡¨ä¼ è¾“æ§åˆ¶åè®®/ç½‘é™…åè®®ï¼ŒæŒ‡çš„æ˜¯ä¸€ç³»åˆ—åè®®æ—ï¼›</li><li><strong>HTTP</strong> æœ¬èº«å°±æ˜¯ä¸€ä¸ªåè®®ï¼Œæ˜¯ä» <u>Web æœåŠ¡å™¨å’Œæœ¬åœ°æµè§ˆå™¨</u>çš„è¶…æ–‡æœ¬ä¼ é€åè®®ï¼›</li><li><strong>Socket</strong> æ˜¯ TCP/IP ç½‘ç»œçš„ <strong>API</strong> ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé—¨é¢æ¨¡å¼ï¼Œå®ƒæŠŠå¤æ‚çš„ TCP/IP åè®®æ—éšè—åœ¨Socket æ¥å£åé¢ã€‚å¯¹ç”¨æˆ·æ¥è¯´ï¼Œä¸€ç»„ç®€å•çš„æ¥å£å°±æ˜¯å…¨éƒ¨ï¼Œè®© Socket å»ç»„ç»‡æ•°æ®ï¼Œä»¥ç¬¦åˆæŒ‡å®šçš„åè®®ã€‚</li></ul><h4 id="8-ä»€ä¹ˆæ˜¯åŠè¿æ¥é˜Ÿåˆ—ï¼Ÿæ³›æ´ªæ”»å‡»ï¼ˆDDosæ”»å‡»çš„ä¸€ç§ï¼‰ï¼Œä»¥åŠè§£å†³ç­–ç•¥-ï¼Ÿ">8. ä»€ä¹ˆæ˜¯åŠè¿æ¥é˜Ÿåˆ—ï¼Ÿ<strong>æ³›æ´ªæ”»å‡»ï¼ˆDDosæ”»å‡»çš„ä¸€ç§ï¼‰ï¼Œä»¥åŠè§£å†³ç­–ç•¥</strong> ï¼Ÿ</h4><ul><li><p><strong>åŠè¿æ¥é˜Ÿåˆ—</strong></p><p>æœåŠ¡å™¨ç¬¬ä¸€æ¬¡æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN ä¹‹åï¼Œå°±ä¼šå¤„äº SYN_RCVD çŠ¶æ€ï¼Œæ­¤æ—¶åŒæ–¹è¿˜æ²¡æœ‰å®Œå…¨å»ºç«‹å…¶è¿æ¥ï¼ŒæœåŠ¡å™¨ä¼šæŠŠæ­¤ç§çŠ¶æ€ä¸‹è¯·æ±‚è¿æ¥æ”¾åœ¨ä¸€ä¸ª<strong>é˜Ÿåˆ—</strong>é‡Œï¼Œæˆ‘ä»¬æŠŠè¿™ç§é˜Ÿåˆ—ç§°ä¹‹ä¸º<strong>åŠè¿æ¥é˜Ÿåˆ—</strong>ã€‚</p><blockquote><p>å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹èµ·è¿æ¥çš„å°±ä¼šæ”¾åœ¨<strong>å…¨è¿æ¥é˜Ÿåˆ—</strong>ä¸­ã€‚å¦‚æœé˜Ÿåˆ—æ»¡äº†å°±æœ‰å¯èƒ½ä¼šå‡ºç°ä¸¢åŒ…ç°è±¡ã€‚</p></blockquote></li><li><p><strong>æ³›æ´ªæ”»å‡»</strong></p><p>åœ¨ TCP çš„ä¸‰æ¬¡æ¡æ‰‹æœºåˆ¶çš„ç¬¬ä¸€æ­¥ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡å™¨å‘é€ SYN æŠ¥æ–‡æ®µã€‚</p><ol><li>æœåŠ¡å™¨æ¥æ”¶åˆ° SYN æŠ¥æ–‡æ®µåä¼šä¸ºè¯¥ <u>TCPåˆ†é…<strong>ç¼“å­˜å’Œå˜é‡</strong></u>ï¼Œå¦‚æœ<u>æ”»å‡»åˆ†å­<strong>ä¼ªé€ å¤§é‡ä¸å­˜åœ¨çš„IPåœ°å€</strong>ï¼Œå¤§é‡åœ°å¾€æœåŠ¡å™¨å‘é€ SYN æŠ¥æ–‡æ®µ</u>ï¼ŒæœåŠ¡å™¨çš„è¿æ¥èµ„æºç»ˆå°†è¢«è€—å°½ï¼Œå¯¼è‡´<strong>å†…å­˜æº¢å‡º</strong>æ— æ³•ç»§ç»­æœåŠ¡ã€‚</li><li>å½“æœåŠ¡ç«¯æ¥æ”¶åˆ° SYN åè¿›å…¥ SYN-RECV çŠ¶æ€ï¼Œæ­¤æ—¶çš„è¿æ¥ç§°ä¸º<strong>åŠè¿æ¥</strong>ï¼ŒåŒæ—¶ä¼šè¢«æœåŠ¡ç«¯å†™å…¥ä¸€ä¸ª<strong>åŠè¿æ¥é˜Ÿåˆ—</strong>ã€‚<br>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ”»å‡»è€…åœ¨çŸ­æ—¶é—´å†…ä¸æ–­çš„å‘æœåŠ¡ç«¯å‘é€å¤§é‡çš„ SYN åŒ…è€Œä¸å“åº”ï¼Œé‚£ä¹ˆæœåŠ¡å™¨çš„<strong>åŠè¿æ¥é˜Ÿåˆ—å¾ˆå¿«ä¼šè¢«å†™æ»¡</strong>ï¼Œä»è€Œå¯¼è‡´æ— æ³•å·¥ä½œã€‚</li></ol></li><li><p><strong>è§£å†³ç­–ç•¥</strong></p><p><strong>è®¾ç½®éªŒè¯æœºåˆ¶</strong>ï¼šå½“æœåŠ¡å™¨æ¥å—åˆ° SYN æŠ¥æ–‡æ®µæ—¶ï¼Œ<strong>ä¸ç›´æ¥ä¸ºè¯¥ TCP åˆ†é…èµ„æº</strong>ï¼Œè€Œåªæ˜¯æ‰“å¼€ä¸€ä¸ª<u>åŠå¼€çš„å¥—æ¥å­—</u>ã€‚æ¥ç€ä¼šä½¿ç”¨ SYN æŠ¥æ–‡æ®µçš„<u>æº Idï¼Œç›®çš„ Idï¼Œç«¯å£å·</u>ä»¥åŠåªæœ‰æœåŠ¡å™¨è‡ªå·±çŸ¥é“çš„ä¸€ä¸ª<u>ç§˜å¯†å‡½æ•°ç”Ÿæˆä¸€ä¸ª cookieï¼Œå¹¶<strong>æŠŠ cookieä½œä¸ºåºåˆ—å·å“åº”</strong></u> ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯æ˜¯æ­£å¸¸å»ºç«‹è¿æ¥ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªç¡®è®¤å­—æ®µä¸º <strong>cookie + 1 çš„æŠ¥æ–‡æ®µ</strong>ã€‚æ¥ä¸‹æ¥æœåŠ¡å™¨ä¼šæ ¹æ®ç¡®è®¤æŠ¥æ–‡çš„æº Idï¼Œç›®çš„ Idï¼Œç«¯å£å·ä»¥åŠç§˜å¯†å‡½æ•°è®¡ç®—å‡ºä¸€ä¸ªç»“æœï¼Œå¦‚æœç»“æœçš„å€¼ + 1 ç­‰äºç¡®è®¤å­—æ®µçš„å€¼ï¼Œåˆ™è¯æ˜æ˜¯åˆšåˆšè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œè¿™æ—¶å€™æ‰ä¸ºè¯¥ TCP åˆ†é…èµ„æº ã€‚</p><p><strong>é˜²ç«å¢™è¿‡æ»¤</strong>ï¼š æš‚ä¸äº†è§£å…·ä½“</p></li></ul><h4 id="9-ä¸ºä»€ä¹ˆDNSï¼ˆåŸŸåè§£æï¼‰ç”¨UDPï¼Œè€ŒåŒºåŸŸä¼ é€ç”¨TCP">9.<strong>ä¸ºä»€ä¹ˆDNSï¼ˆåŸŸåè§£æï¼‰ç”¨UDPï¼Œè€ŒåŒºåŸŸä¼ é€ç”¨TCP?</strong></h4><ul><li><strong>DNSç”¨UDP</strong>ï¼šå®¢æˆ·ç«¯å‘DNSæœåŠ¡å™¨æŸ¥è¯¢åŸŸåï¼Œä¸€<u>èˆ¬è¿”å›çš„å†…å®¹éƒ½ä¸è¶…è¿‡512å­—èŠ‚ï¼Œç”¨UDPä¼ è¾“å³å¯</u>ã€‚ä¸ç”¨ç»è¿‡TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿™æ ·<u>DNSæœåŠ¡å™¨è´Ÿè½½æ›´ä½ï¼Œå“åº”æ›´å¿«</u>ã€‚</li><li><strong>åŒºåŸŸä¼ é€ç”¨TCPï¼š</strong> TCPåè®®å¯é æ€§å¥½ï¼Œ<u>TCPåè®®ä¼ è¾“çš„å†…å®¹å¤§ï¼Œè€ŒUDPæœ€å¤§åªèƒ½ä¼ 512å­—èŠ‚</u>ã€‚</li></ul><h4 id="10-è¯´ä¸€ä¸‹-TCP-ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿæ€ä¹ˆè§£å†³ç²˜åŒ…ï¼Ÿ">10.<strong>è¯´ä¸€ä¸‹ TCP ç²˜åŒ…æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿæ€ä¹ˆè§£å†³ç²˜åŒ…ï¼Ÿ</strong></h4><p><strong>TCPç²˜åŒ…</strong></p><p><strong>TCPç²˜åŒ…</strong>æ˜¯æŒ‡å‘é€æ–¹å‘é€çš„è‹¥å¹²åŒ…æ•°æ®åˆ°æ¥æ”¶æ–¹æ¥æ”¶æ—¶ç²˜æˆä¸€åŒ…ï¼Œä»æ¥æ”¶ç¼“å†²åŒºçœ‹ï¼Œåä¸€åŒ…æ•°æ®çš„å¤´ç´§æ¥ç€å‰ä¸€åŒ…æ•°æ®çš„å°¾ã€‚</p><p>å®¢æˆ·ç«¯è¦å‘é€åŸä¿¡æ¯æ˜¯Aå’ŒBä¸¤ä¸ªæ•°æ®åŒ…ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°ä¹‹åï¼Œå¯èƒ½å‡ºç°å¦‚ä¸‹æƒ…å†µï¼š</p><ul><li><strong>æ­£å¸¸æƒ…å†µ</strong>ï¼šè¯»å–åˆ°äº†Aå’ŒBä¸¤ä¸ªæ•°æ®åŒ…ï¼›</li><li><strong>ç²˜åŒ…</strong>ï¼šAå’ŒBä¸¤ä¸ªæ•°æ®åŒ…ä¸€èµ·è¯»å–äº†ï¼›</li><li><strong>æ‹†åŒ…</strong>ï¼šè¯»å–äº†Aæ•°æ®åŒ…çš„ä¸€éƒ¨åˆ†ï¼ŒAçš„å¦ä¸€éƒ¨åˆ†å’ŒBæ•°æ®åŒ…ä¸€èµ·è¯»å–äº†ã€‚</li></ul><p><strong>TCPç²˜åŒ…åŸå› </strong></p><ul><li><strong>ã€å‘é€æ–¹ã€‘TCPé»˜è®¤ä½¿ç”¨Nagleç®—æ³•</strong>ã€‚å®¢æˆ·ç«¯é€šè¿‡socketç»™æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œä¸ºäº†ä¼ è¾“æ›´æœ‰æ•ˆç‡ï¼Œä¼šå°†<strong>å¤šæ¬¡é—´éš”è¾ƒå°çš„ä¸”æ•°æ®é‡å°çš„æ•°æ®</strong>ï¼Œé€šè¿‡<strong>nagle</strong>ç®—æ³•ï¼Œåˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°æ®å—ï¼Œç„¶åè¿›è¡Œå°åŒ…ã€‚è¿™æ ·åšæé«˜äº†æ•ˆç‡ï¼Œç¼ºç‚¹å°±æ˜¯ä½ å‘é€åˆ°æœåŠ¡ç«¯çš„æ•°æ®ï¼ŒæœåŠ¡ç«¯ä¸çŸ¥é“æ˜¯ä¸æ˜¯å®Œæ•´çš„ï¼Œä¸çŸ¥é“å“ªå‡ å°å—æ•°æ®æ‹¼èµ·æ¥æ‰æ˜¯åŸæ¥çš„æ•°æ®ï¼›</li><li><strong>ã€æ¥æ”¶æ–¹ã€‘æ¥ä¸åŠæ¥æ”¶ç¼“å­˜åŒºçš„åŒ…</strong>ï¼Œå¯¼è‡´å¤šä¸ªåŒ…æ¥æ”¶ï¼›</li><li>TCP<strong>è¿æ¥å¤ç”¨</strong>é€ æˆçš„ç²˜åŒ…é—®é¢˜ï¼›</li><li>æµé‡æ§åˆ¶ï¼Œ<strong>æ‹¥å¡æ§åˆ¶</strong>ä¹Ÿå¯èƒ½å¯¼è‡´ç²˜åŒ…ã€‚</li></ul><p><strong>è§£å†³ç²˜åŒ…</strong></p><p>è§£å†³é—®é¢˜çš„å…³é”®åœ¨äºå¦‚ä½•ç»™<strong>æ¯ä¸ªæ•°æ®åŒ…æ·»åŠ è¾¹ç•Œä¿¡æ¯</strong>ï¼š</p><ol><li><strong>Nagleç®—æ³•</strong>é—®é¢˜å¯¼è‡´çš„ï¼Œéœ€è¦ç»“åˆåº”ç”¨åœºæ™¯é€‚å½“å…³é—­è¯¥ç®—æ³•ï¼›</li><li><strong>å‘é€ç«¯ç»™æ¯ä¸ªæ•°æ®åŒ…æ·»åŠ åŒ… <u>é¦–éƒ¨</u> <strong>ï¼Œé¦–éƒ¨ä¸­åº”è¯¥è‡³å°‘åŒ…å«æ•°æ®åŒ…çš„</strong>é•¿åº¦</strong>ï¼Œè¿™æ ·æ¥æ”¶ç«¯åœ¨æ¥æ”¶åˆ°æ•°æ®åï¼Œé€šè¿‡è¯»å–åŒ…é¦–éƒ¨çš„é•¿åº¦å­—æ®µï¼Œä¾¿çŸ¥é“æ¯ä¸€ä¸ªæ•°æ®åŒ…çš„å®é™…é•¿åº¦äº†ï¼›</li><li><strong>æ•°æ®åŒ…ä¹‹é—´è®¾ç½®è¾¹ç•Œ</strong>ï¼Œå¦‚æ·»åŠ ç‰¹æ®Šç¬¦å·ï¼Œè¿™æ ·ï¼Œæ¥æ”¶ç«¯é€šè¿‡è¿™ä¸ªè¾¹ç•Œå°±å¯ä»¥å°†ä¸åŒçš„æ•°æ®åŒ…æ‹†åˆ†å¼€ ï¼›</li><li><strong>å‘é€ç«¯å°†æ¯ä¸ªæ•°æ®åŒ…å°è£…ä¸ºå›ºå®šé•¿åº¦</strong>ï¼ˆä¸å¤Ÿçš„å¯ä»¥é€šè¿‡è¡¥0å¡«å……ï¼‰ï¼Œè¿™æ ·æ¥æ”¶ç«¯æ¯æ¬¡ä»æ¥æ”¶ç¼“å†²åŒºä¸­è¯»å–å›ºå®šé•¿åº¦çš„æ•°æ®å°±è‡ªç„¶è€Œç„¶çš„æŠŠæ¯ä¸ªæ•°æ®åŒ…æ‹†åˆ†å¼€æ¥ã€‚</li></ol><h4 id="11-TCP-UDPçš„åŒºåˆ«ï¼Ÿ">11. TCP, UDPçš„åŒºåˆ«ï¼Ÿ</h4><ul><li>UDP åœ¨<strong>ä¼ é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥</strong>ã€‚è¿œåœ°ä¸»æœºåœ¨æ”¶åˆ° UDP æŠ¥â½‚åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ã€‚è™½ç„¶UDP ä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ UDP ç¡®æ˜¯â¼€ç§æœ€æœ‰æ•ˆçš„â¼¯ä½œæ–¹å¼ï¼ˆâ¼€èˆ¬ç”¨äºå³æ—¶é€šä¿¡ï¼‰<ul><li>â½å¦‚ï¼š <u>QQ è¯­â¾³ã€ QQ è§†é¢‘ ã€ç›´æ’­</u>ç­‰ç­‰</li></ul></li><li>TCP <strong>æä¾›é¢å‘è¿æ¥çš„æœåŠ¡</strong>ã€‚åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºâ½´è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚ TCP ä¸æä¾›â¼´æ’­æˆ–å¤šæ’­æœåŠ¡ã€‚ç”±äº TCP è¦æä¾›å¯é çš„ï¼Œé¢å‘è¿æ¥çš„ä¼ è¾“æœåŠ¡ï¼ˆTCPçš„å¯é ä½“ç°åœ¨TCPåœ¨ä¼ é€’æ•°æ®ä¹‹å‰ï¼Œä¼šæœ‰ä¸‰æ¬¡æ¡â¼¿æ¥å»ºâ½´è¿æ¥ï¼Œè€Œä¸”åœ¨æ•°æ®ä¼ é€’æ—¶ï¼Œæœ‰ç¡®è®¤ã€çª—å£ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼Œåœ¨æ•°æ®ä¼ å®Œåï¼Œè¿˜ä¼šæ–­å¼€è¿æ¥ç”¨æ¥èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼‰ï¼Œè¿™â¼€éš¾ä»¥é¿å…å¢åŠ äº†è®¸å¤šå¼€é”€ï¼Œå¦‚ç¡®è®¤ï¼Œæµé‡æ§åˆ¶ï¼Œè®¡æ—¶å™¨ä»¥åŠè¿æ¥ç®¡ç†ç­‰ã€‚è¿™ä¸ä»…ä½¿åè®®æ•°æ®å•å…ƒçš„â¾¸éƒ¨å¢å¤§å¾ˆå¤šï¼Œè¿˜è¦å ç”¨è®¸å¤šå¤„ç†æœºèµ„æºã€‚<ul><li>TCP â¼€èˆ¬ç”¨äº<u>â½‚ä»¶ä¼ è¾“ã€å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•</u>ç­‰åœºæ™¯ã€‚</li></ul></li><li><strong>æ•°æ®åŒ…</strong>ï¼š TCPæ˜¯<strong>æŠ¥æ–‡æ®µ</strong>ï¼ŒUDPæ˜¯<strong>ç”¨æˆ·æ•°æ®æŠ¥</strong>ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong> ï¼š TCPç”¨äºä¸€äº›éœ€è¦å¯é ä¼ è¾“çš„åœºæ™¯ï¼› UDPåˆ™åº”ç”¨ä¸€äº›å³æ—¶é€šä¿¡åœºæ™¯ï¼Œä¸éœ€è¦å¯é ä¼ è¾“çš„åœºæ™¯ã€‚</li><li><strong>é•¿åº¦</strong>ï¼šUDPåœ¨DNSæœ€é•¿åªèƒ½æ˜¯512å­—èŠ‚ï¼ŒTCPä¼šæ›´é•¿ã€‚</li></ul><h2 id="3-3-ç½‘ç»œå±‚">3.3 ç½‘ç»œå±‚</h2><h4 id="1-è¯·ç®€å•è§£é‡Šä¸€ä¸‹ï¼ŒARPåè®®å’ŒARPæ”»å‡»">1.<strong>è¯·ç®€å•è§£é‡Šä¸€ä¸‹ï¼ŒARPåè®®å’ŒARPæ”»å‡»?</strong></h4><ul><li>ARPåè®®ï¼šåœ°å€è§£æåè®®ï¼Œå»ºç«‹<code>IP/MAC</code>åœ°å€æ˜ å°„è¡¨</li><li>ARPæ”»å‡»ï¼š</li></ul><h4 id="2-ä»€ä¹ˆæ˜¯ICMPåè®®ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">2.<strong>ä»€ä¹ˆæ˜¯ICMPåè®®ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</h4><p>ç”¨äºåœ¨<strong>IPä¸»æœºã€è·¯ç”±å™¨</strong>ä¹‹é—´ä¼ é€’æ§åˆ¶æ¶ˆæ¯ã€‚</p><blockquote><p>æ§åˆ¶æ¶ˆæ¯æ˜¯æŒ‡ï¼š<strong>ç½‘ç»œé€šä¸é€šã€ä¸»æœºæ˜¯å¦å¯è¾¾ã€è·¯ç”±æ˜¯å¦å¯ç”¨</strong>ç­‰ç½‘ç»œæœ¬èº«çš„æ¶ˆæ¯ã€‚è¿™äº›æ§åˆ¶æ¶ˆæ¯è™½ç„¶å¹¶ä¸ä¼ è¾“ç”¨æˆ·æ•°æ®ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·æ•°æ®çš„ä¼ é€’èµ·ç€é‡è¦çš„ä½œç”¨ã€‚</p></blockquote><h4 id="3-è¯·ä½ è®²ä¸€ä¸‹è·¯ç”±å™¨å’Œäº¤æ¢æœºçš„åŒºåˆ«ï¼Ÿ">3.<strong>è¯·ä½ è®²ä¸€ä¸‹è·¯ç”±å™¨å’Œäº¤æ¢æœºçš„åŒºåˆ«ï¼Ÿ</strong></h4><ol><li><p><strong>åŠ¨æ€IP</strong>ï¼š<u>è·¯ç”±å™¨å¯ä»¥ç»™ä½ çš„å±€åŸŸç½‘è‡ªåŠ¨åˆ†é…IP</u>ï¼Œè™šæ‹Ÿæ‹¨å·ï¼Œå°±åƒä¸€ä¸ªäº¤é€šè­¦å¯Ÿï¼ŒæŒ‡æŒ¥ç€ä½ çš„ç”µè„‘è¯¥å¾€å“ªèµ°ï¼Œä½ è‡ªå·±ä¸ç”¨æ“å¿ƒé‚£ä¹ˆå¤šäº†ã€‚<u>äº¤æ¢æœºåªæ˜¯ç”¨æ¥åˆ†é…ç½‘ç»œæ•°æ®çš„</u>ã€‚</p><p><u>è·¯ç”±å™¨å¯ä»¥æŠŠä¸€ä¸ªIPåˆ†é…ç»™å¾ˆå¤šä¸ªä¸»æœºä½¿ç”¨ï¼Œè¿™äº›ä¸»æœºå¯¹å¤–åªè¡¨ç°å‡ºä¸€ä¸ªIP</u>ã€‚äº¤æ¢æœºå¯ä»¥æŠŠå¾ˆå¤šä¸»æœºè¿èµ·æ¥ï¼Œè¿™äº›ä¸»æœºå¯¹å¤–å„æœ‰å„çš„IPã€‚</p></li><li><p><strong>å¯»å€æ–¹å¼</strong>ï¼šè·¯ç”±å™¨åœ¨<strong>ç½‘ç»œå±‚</strong>ï¼Œ<u>è·¯ç”±å™¨æ ¹æ®IPåœ°å€å¯»å€</u>ï¼Œè·¯ç”±å™¨å¯ä»¥å¤„ç†TCP/IPåè®®ï¼Œäº¤æ¢æœºä¸å¯ä»¥ï¼›äº¤æ¢æœºåœ¨<strong>ä¸­ç»§å±‚</strong>ï¼Œ<u>äº¤æ¢æœºæ ¹æ®MACåœ°å€</u>å¯»å€ã€‚</p></li><li><p><strong>é˜²ç«å¢™</strong>ï¼šè·¯ç”±å™¨æä¾›é˜²ç«å¢™çš„æœåŠ¡ï¼Œäº¤æ¢æœºä¸èƒ½æä¾›è¯¥åŠŸèƒ½ã€‚é›†çº¿å™¨ã€äº¤æ¢æœºéƒ½æ˜¯åšç«¯å£æ‰©å±•çš„ï¼Œå°±æ˜¯æ‰©å¤§å±€åŸŸç½‘(é€šå¸¸éƒ½æ˜¯ä»¥å¤ªç½‘)çš„æ¥å…¥ç‚¹ï¼Œä¹Ÿå°±æ˜¯èƒ½è®©å±€åŸŸç½‘å¯ä»¥è¿è¿›æ¥æ›´å¤šçš„ç”µè„‘ã€‚è·¯ç”±å™¨æ˜¯ç”¨æ¥åšç½‘é—´è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥è¿æ¥ä¸åŒçš„ç½‘ç»œã€‚</p></li></ol><h4 id="4-è¯·è§£é‡Špingå‘½ä»¤è¿‡ç¨‹ï¼Ÿ">4.<strong>è¯·è§£é‡Š<code>ping</code>å‘½ä»¤è¿‡ç¨‹ï¼Ÿ</strong></h4><ol><li>åŸŸååœ¨DNSæœåŠ¡å™¨æŸ¥æ‰¾IPåœ°å€ï¼›</li><li>é€šè¿‡Pingç¨‹åºå‘é€<strong>ICMPåŒ…ï¼›</strong></li><li>åŒä¸€ç½‘æ®µçš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨IPå±‚çš„<strong>ARPåè®®</strong>è¯·æ±‚<strong>å¹¿æ’­</strong>ï¼ˆä¸åŒç½‘æ®µçš„æƒ…å†µä¸‹ï¼Œäº¤ç»™è·¯ç”±å™¨å¤„ç†ï¼‰ï¼Œ<strong>æŸ¥æ‰¾ç›®æ ‡ä¸»æœºçš„MACåœ°å€</strong>ï¼›</li><li>ç›®æ ‡ä¸»æœºARPåè®®æ”¶åˆ°è¯·æ±‚åï¼Œå°†æœ¬æœº<strong>MACåœ°å€å¡«å……</strong>å¹¶<strong>å‘é€ARPåº”ç­”</strong>å›åˆ°è¯·æ±‚å‘é€æ–¹ï¼›</li><li>è¯·æ±‚å‘é€æ–¹å‘é€<strong>ICMPæ•°æ®</strong>åˆ°ç›®æ ‡ä¸»æœºï¼›</li><li>ç›®æ ‡ä¸»æœº<strong>å“åº”ICMPåŒ…</strong>ï¼›</li><li>è¯·æ±‚ä¸»æœºæ”¶åˆ°ç›®æ ‡ä¸»æœºçš„<strong>ICMPå“åº”åŒ…</strong>ã€‚</li></ol><h4 id="5-ï¼ˆè¡¥å……ä»‹ç»ï¼‰ä»‹ç»ä¸€ä¸‹IPV6ï¼Ÿä¸€å…±å¤šå°‘ä½ï¼Ÿ">5. ï¼ˆè¡¥å……ä»‹ç»ï¼‰ä»‹ç»ä¸€ä¸‹IPV6ï¼Ÿä¸€å…±å¤šå°‘ä½ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/05/17/i5Nz6lF9RXYsShw.png" alt="IPv6 åè®®åŸºç¡€_æœå­å“¥ä¸¶çš„åšå®¢-CSDNåšå®¢"></p><p>æºIPå’Œç›®çš„IPåœ°å€éƒ½æ˜¯ï¼Œ128ï¼ˆ4*32ï¼‰ä½ï¼ˆå›¾ä¸­æ ‡è¯†ä¸æ¸…æ™°ï¼‰ï¼</p><h4 id="6-ä»‹ç»ä¸€ä¸‹IPåœ°å€åˆ†ç±»ï¼ŸCç±»å“ªäº›æ˜¯ä¿ç•™åœ°å€ï¼Ÿç½‘ç»œå·å…¨-0-å…¨-1-ï¼Œä¸»æœºå·å…¨-0-å…¨1-åˆ†åˆ«ä»€ä¹ˆå«ä¹‰ï¼Ÿ">6. ä»‹ç»ä¸€ä¸‹IPåœ°å€åˆ†ç±»ï¼ŸCç±»å“ªäº›æ˜¯ä¿ç•™åœ°å€ï¼Ÿç½‘ç»œå·å…¨ 0 å…¨ 1   ï¼Œä¸»æœºå·å…¨ 0 å…¨1 åˆ†åˆ«ä»€ä¹ˆå«ä¹‰ï¼Ÿ</h4><ul><li><p><strong>IPåœ°å€åˆ†ç±»</strong></p><p><code>IPåœ°å€ == &#123;&lt;ç½‘ç»œå·&gt;ï¼Œ&lt;ä¸»æœºå·&gt;&#125;</code></p><p><img src="https://i.loli.net/2021/05/17/ZINJCj9l8WM7qhf.jpg" alt="img"></p><ul><li><p><strong>Aç±»</strong>ï¼š ç¬¬1ä½å›ºå®šä¸º0ï¼Œç½‘ç»œå·åªæœ‰7ä½ ã€‚0ï¼ˆ0000 0000ï¼‰çš„IPåœ°å€æ˜¯<strong>ä¿ç•™åœ°å€</strong>ï¼Œæ„æ€æ˜¯â€œæœ¬ç½‘ç»œâ€ ï¼› 127ï¼ˆ0111 1111ï¼‰çš„IPåœ°å€ä¹Ÿæ˜¯<strong>ä¿ç•™åœ°å€</strong>ï¼Œä½œä¸ºæœ¬åœ°ç¯å›è½¯ä»¶æµ‹è¯• ã€‚</p><blockquote><p>ç‰¹åˆ«çš„ï¼Œ<strong>ä¸»æœºå·å…¨1</strong>çš„æ˜¯<a href="https://baike.baidu.com/item/%E5%B9%BF%E6%92%AD%E5%9C%B0%E5%9D%80">å¹¿æ’­åœ°å€</a>ï¼Œå®ƒä»£è¡¨äº†ç½‘ç»œå…¨éƒ¨çš„<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA">ä¸»æœº</a>ã€‚</p></blockquote></li><li><p><strong>Bç±»</strong>ï¼š ç¬¬1ã€2ä½å›ºå®šä¸º10ï¼Œç½‘ç»œå·æœ‰14ä½å¯ä»¥ä½¿ç”¨ ã€‚</p><blockquote><p>Bç±»åœ°å€ç½‘ç»œå·ä¸º128.0ï¼ˆ1000 000  0000 0000ï¼‰çš„IPåœ°å€æ˜¯ä¸æŒ‡æ´¾çš„ï¼Œæ‰€ä»¥å¯æŒ‡æ´¾çš„ç½‘ç»œå·éœ€è¦å‡ä¸€ã€‚</p></blockquote></li><li><p><strong>Cç±»</strong>ï¼š ç¬¬1ã€2ã€3ä½å›ºå®šä¸º110ï¼Œç½‘ç»œå·æœ‰21ä½å¯ä»¥ä½¿ç”¨ ã€‚</p><blockquote><p>ï¼ˆå¿«æ‰‹é—®ï¼‰Cç±»IPåœ°å€åŒ…å«<strong>ç§æœ‰Cç±»åœ°å€</strong>ï¼ŒèŒƒå›´ä»192.0.0.0 åˆ°223.255.255.255ï¼Œå…¶ä¸­ç§æœ‰Cç±»åœ°å€èŒƒå›´ä»<strong>192.168.0.0 åˆ°192.168.255.255ã€‚</strong></p></blockquote></li></ul></li><li><p><strong>å…¨0æˆ–è€…å…¨1çš„å«ä¹‰</strong></p><ul><li><p><strong>ç½‘ç»œå·å…¨0ï¼š</strong>ï¼ˆ1ï¼‰å¦‚æœä¸»æœºå·ä¹Ÿä¸ºå…¨0ï¼Œé‚£ä¹ˆæ­¤ç±»ipåœ°å€å¯ä»¥å½“æºç«¯ä½†ä¸å¯ä»¥åšç›®çš„ç«¯ ï¼ˆ2ï¼‰å¦‚æœä¸»æœºå·ä¸å…¨ä¸º0ï¼Œé‚£ä¹ˆæ­¤ç±»ipåœ°å€çš„ä½¿ç”¨å’Œï¼ˆ1)ç›¸åŒï¼Œåªæ˜¯å®ƒä»£è¡¨çš„æ˜¯ç½‘ç»œä¸Šç‰¹å®šçš„ä¸»æœº</p></li><li><p><strong>ç½‘ç»œå·å…¨1ï¼š<strong>å…¨1çš„ç½‘ç»œå·å’Œ</strong>ä»»æ„çš„ä¸»æœºå·</strong>ç»„åˆå½“åš<strong>å›ç¯åœ°å€</strong>æ¥ä½¿ç”¨ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼š127ï¼ˆ0111 1111ï¼‰çš„IPåœ°å€</p></blockquote></li><li><p><strong>ä¸»æœºå·å…¨0ï¼š</strong> å…¨ä¸º0ï¼Œæ‰€å¾—åˆ°çš„åœ°å€å°±æ˜¯192.168.100.0ï¼Œå®ƒæ˜¯ä¸€ä¸ªç½‘ç»œåœ°å€ï¼Œä»£è¡¨çš„æ˜¯ä¸€ä¸ª<strong>ç½‘æ®µ</strong>ï¼›</p></li><li><p><strong>ä¸»æœºå·å…¨1ï¼š</strong> æœºå·å…¨1 ä»£è¡¨çš„æ˜¯<strong>å¹¿æ’­åœ°å€</strong>ï¼Œå¹¿æ’­åœ°å€æ˜¯ä¸å¯ä»¥åšæºç«¯çš„ï¼Œä½†æ˜¯å¯ä»¥åšç›®çš„ç«¯ã€‚</p></li></ul></li></ul><h2 id="3-4-åº”ç”¨å±‚">3.4 åº”ç”¨å±‚</h2><h4 id="1-è¯·ä½ è°ˆè°ˆDNSçš„å¯»å€è¿‡ç¨‹ï¼Ÿ">1.<strong>è¯·ä½ è°ˆè°ˆDNSçš„å¯»å€è¿‡ç¨‹ï¼Ÿ</strong></h4><p>ï¼ˆ1ï¼‰æ£€æŸ¥<strong>æµè§ˆå™¨ç¼“å­˜ã€æ£€æŸ¥æœ¬åœ°hostsæ–‡</strong>ä»¶ï¼šæ˜¯å¦æœ‰è¿™ä¸ªç½‘å€çš„æ˜ å°„ï¼Œå¦‚æœæœ‰ï¼Œå°±è°ƒç”¨è¿™ä¸ªIPåœ°å€æ˜ å°„ï¼Œè§£æå®Œæˆã€‚</p><p>ï¼ˆ2ï¼‰å¦‚æœæ²¡æœ‰ï¼Œåˆ™æŸ¥æ‰¾<strong>æœ¬åœ°DNSè§£æå™¨ç¼“å­˜</strong>ï¼šæ˜¯å¦æœ‰è¿™ä¸ªç½‘å€çš„æ˜ å°„ï¼Œå¦‚æœæœ‰ï¼Œè¿”å›æ˜ å°„ï¼Œè§£æå®Œæˆã€‚</p><blockquote><p><strong>æœ¬åœ°dnsæœåŠ¡å™¨ä¸€èˆ¬éƒ½æ˜¯ä½ çš„ç½‘ç»œæ¥å…¥æœåŠ¡å™¨å•†æä¾›</strong>ï¼Œæ¯”å¦‚ä¸­å›½ç”µä¿¡ï¼Œä¸­å›½ç§»åŠ¨ç­‰ã€‚</p></blockquote><p>ï¼ˆ3ï¼‰å¦‚æœæ²¡æœ‰ï¼Œåˆ™æŸ¥æ‰¾å¡«å†™æˆ–åˆ†é…çš„<strong>é¦–é€‰DNSæœåŠ¡å™¨</strong>ï¼šç§°ä¸ºæœ¬åœ°DNSæœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°æŸ¥è¯¢æ—¶ï¼š</p><ul><li><p>å¦‚æœè¦æŸ¥è¯¢çš„åŸŸååŒ…å«åœ¨æœ¬åœ°é…ç½®åŒºåŸŸèµ„æºä¸­ï¼Œè¿”å›è§£æç»“æœï¼ŒæŸ¥è¯¢ç»“æŸï¼Œæ­¤è§£æå…·æœ‰æƒå¨æ€§ã€‚</p></li><li><p>å¦‚æœè¦æŸ¥è¯¢çš„åŸŸåä¸ç”±æœ¬åœ°DNSæœåŠ¡å™¨åŒºåŸŸè§£æï¼Œä½†æœåŠ¡å™¨ç¼“å­˜äº†æ­¤ç½‘å€çš„æ˜ å°„å…³ç³»ï¼Œè¿”å›è§£æç»“æœï¼ŒæŸ¥è¯¢ç»“æŸï¼Œæ­¤è§£æä¸å…·æœ‰æƒå¨æ€§ã€‚</p></li></ul><p>ï¼ˆ4ï¼‰å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨ä¹Ÿå¤±æ•ˆï¼š</p><ul><li>å¦‚æœæœªé‡‡ç”¨<u>è½¬å‘æ¨¡å¼</u>ï¼ˆ<strong>è¿­ä»£</strong>ï¼Œä»ä¸Šè‡³ä¸‹ï¼‰ï¼ˆ1ï¼‰<strong>æœ¬åœ°DNSæœåŠ¡å™¨</strong>å°±æŠŠ<strong>è¯·æ±‚å‘è‡³13å°æ ¹DNS</strong>ï¼Œæ ¹DNSæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåˆ¤æ–­è¿™ä¸ªåŸŸåï¼ˆ<a href="http://xn--bvs.com">å¦‚.com</a>ï¼‰æ˜¯è°æ¥æˆæƒç®¡ç†ï¼Œ<u>å¹¶è¿”å›ä¸€ä¸ªè´Ÿè´£è¯¥é¡¶çº§åŸŸåæœåŠ¡å™¨çš„IP</u>ï¼Œï¼ˆ2ï¼‰æœ¬åœ°DNSæœåŠ¡å™¨æ”¶åˆ°é¡¶çº§åŸŸåæœåŠ¡å™¨IPä¿¡æ¯åï¼Œç»§ç»­å‘è¯¥<strong>é¡¶çº§åŸŸå</strong>æœåŠ¡å™¨IPå‘é€è¯·æ±‚ï¼Œï¼ˆ3ï¼‰è¯¥æœåŠ¡å™¨å¦‚æœæ— æ³•è§£æï¼Œåˆ™ä¼šæ‰¾åˆ°è´Ÿè´£è¿™ä¸ªåŸŸåçš„ä¸‹ä¸€çº§DNSæœåŠ¡å™¨ï¼ˆå¦‚http://baidu.comï¼‰çš„IPç»™æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œå¾ªç¯å¾€å¤ç›´è‡³æŸ¥è¯¢åˆ°æ˜ å°„ï¼Œï¼ˆ4ï¼‰å°†è§£æç»“æœ<strong>è¿”å›<u>æœ¬åœ°DNSæœåŠ¡å™¨</u>ï¼Œå†ç”±æœ¬åœ°DNSæœåŠ¡å™¨</strong>è¿”å›è§£æç»“æœï¼ŒæŸ¥è¯¢å®Œæˆã€‚</li><li>å¦‚æœé‡‡ç”¨<u>è½¬å‘æ¨¡å¼</u>ï¼ˆ<strong>é€’å½’</strong>ï¼Œä»ä¸‹è‡³ä¸Šï¼‰ï¼ˆ1ï¼‰åˆ™æ­¤DNSæœåŠ¡å™¨å°±ä¼šæŠŠè¯·æ±‚è½¬<strong>å‘è‡³ä¸Šä¸€çº§DNSæœåŠ¡å™¨</strong>ï¼Œï¼ˆ2ï¼‰å¦‚æœä¸Šä¸€çº§DNSæœåŠ¡å™¨ä¸èƒ½è§£æï¼Œåˆ™ç»§ç»­å‘ä¸Šè¯·æ±‚ï¼Œï¼ˆ3ï¼‰æœ€ç»ˆå°†è§£æç»“æœä¾æ¬¡<u>è¿”å›æœ¬åœ°DNSæœåŠ¡å™¨</u>ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨å†è¿”å›ç»™å®¢æˆ·æœºï¼ŒæŸ¥è¯¢å®Œæˆã€‚</li></ul><h5 id="1-1-æ€ä¹ˆè·å–13å°æ ¹æœåŠ¡å™¨ï¼Ÿ">1.1 æ€ä¹ˆè·å–13å°æ ¹æœåŠ¡å™¨ï¼Ÿ</h5><p>ping -R ? æŠ“åŒ…ï¼Ÿ</p><h5 id="1-2-è§£é‡Šä¸€ä¸‹DNSåŠ«æŒå’ŒDNSæ±¡æŸ“ï¼Ÿ">1.2 <strong>è§£é‡Šä¸€ä¸‹DNSåŠ«æŒå’ŒDNSæ±¡æŸ“</strong>ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903991764058126">ä»€ä¹ˆæ˜¯httpåŠ«æŒ ? </a></p></blockquote><p><strong>ä¸€ã€DNSåŠ«æŒ</strong></p><p>DNSåŠ«æŒæŸäº›æ‰‹æ®µå–å¾—<strong>æŸåŸŸåçš„è§£æè®°å½•æ§åˆ¶æƒ</strong>ï¼Œè¿›è€Œä¿®æ”¹æ­¤åŸŸåçš„è§£æç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·ä¸€ä¸ªé”™è¯¯çš„æŸ¥è¯¢ç»“æœã€‚</p><ul><li><p><strong>åŠ«æŒè¿‡ç¨‹</strong></p><ol><li><p>å®¢æˆ·ç«¯å‘èµ·åŸŸåè¯·æ±‚åˆ°DNSè§£ææœåŠ¡å™¨ï¼ˆä¸€èˆ¬æ˜¯LocalDNSï¼‰ï¼Œ<u>ä½†æ­¤æ—¶DNSè§£ææœåŠ¡å™¨è¢«æ”»å‡»ç¯¡æ”¹</u>ï¼›</p></li><li><p>è¢«æ”»å‡»ç¯¡æ”¹åçš„DNSè§£ææœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘ç»™è™šå‡æœåŠ¡å™¨ï¼›</p><blockquote><p>DNSæŸ¥è¯¢æ²¡æœ‰ä»»ä½•è®¤è¯æœºåˆ¶ä¸”åŸºäºUDPä¸å¯é è¿æ¥ï¼Œå› æ­¤å¾ˆå®¹æ˜“è¢«ç¯¡æ”¹ã€‚</p></blockquote></li><li><p>è™šå‡æœåŠ¡å™¨è¿”å›<u>å“åº”è™šå‡ä¿¡æ¯</u>ç»™è¢«æ”»å‡»ç¯¡æ”¹åçš„DNSè§£ææœåŠ¡å™¨ï¼ˆä¹Ÿå¯èƒ½ç›´æ¥ä¸å“åº”ï¼‰ï¼›</p></li></ol></li><li><p><strong>è§£å†³åŠæ³•</strong></p><p>DNSåŠ«æŒçš„æœ¬è´¨æ˜¯<strong>è¿è¥å•†çš„DNSè§£ææœåŠ¡å™¨è¢«æ”»å‡»ç¯¡æ”¹</strong></p><ul><li>ä½¿ç”¨å›½å¤–å…è´¹å…¬ç”¨çš„DNSæœåŠ¡å™¨è§£å†³ã€‚ä¾‹å¦‚OpenDNSï¼ˆ208.67.222.222ï¼‰æˆ–GoogleDNSï¼ˆ8.8.8.8ï¼‰</li><li>ç›´æ¥ä½¿ç”¨ipè¿›è¡Œè®¿é—®</li></ul></li></ul><p><strong>äºŒã€DNSæ±¡æŸ“</strong></p><p>DNSæ±¡æŸ“æ˜¯ä¸€ç§è®©ä¸€èˆ¬ç”¨æˆ·ç”±äº<strong>å¾—åˆ°è™šå‡ç›®æ ‡ä¸»æœºIP</strong>è€Œä¸èƒ½ä¸å…¶é€šä¿¡çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ç§DNSç¼“å­˜æŠ•æ¯’æ”»å‡»ï¼ˆDNS cache poisoningï¼‰ã€‚å› ä¸ºæ˜¯ä¸æ˜¯<u>åŠ«æŒå•ä¸ªDNSæœåŠ¡å™¨ï¼Œè€Œæ˜¯ç›‘å¬æ‰€æœ‰çš„ï¼Œæ‰€ä»¥ä¸ªäººæ¯”è¾ƒéš¾é˜²èŒƒã€‚</u></p><ul><li><p><strong>æ±¡æŸ“åŸç†</strong></p><ol><li><p>é€šè¿‡å¯¹UDPç«¯å£53ä¸Šçš„<strong>DNSæŸ¥è¯¢è¿›è¡Œå…¥ä¾µæ£€æµ‹</strong>ï¼›</p><blockquote><p>ç”±äºé€šå¸¸çš„DNSæŸ¥è¯¢æ²¡æœ‰ä»»ä½•è®¤è¯æœºåˆ¶ï¼Œè€Œä¸”DNSæŸ¥è¯¢é€šå¸¸åŸºäºçš„UDPæ˜¯æ— è¿æ¥ä¸å¯é çš„åè®®ï¼Œå› æ­¤DNSçš„æŸ¥è¯¢éå¸¸å®¹æ˜“è¢«ç¯¡æ”¹ã€‚</p></blockquote></li><li><p>ä¸€ç»å‘ç°ä¸å…³é”®è¯ç›¸åŒ¹é…çš„è¯·æ±‚åˆ™<u><strong>ç«‹å³ä¼ªè£…æˆç›®æ ‡åŸŸåçš„è§£ææœåŠ¡å™¨</strong></u>ï¼ˆNSï¼ŒName Serverï¼‰ç»™æŸ¥è¯¢è€…è¿”å›è™šå‡ç»“æœã€‚</p></li></ol></li><li><p><strong>è§£å†³åŠæ³•</strong></p><ol><li>VPNä»£ç†æˆ–è€…åŸŸåè¿œç¨‹è§£æçš„æ–¹æ³•è§£å†³</li><li>é€šè¿‡ä¿®æ”¹Hostsï¼Œæ‰‹åŠ¨è®¾ç½®<u>åŸŸåæ­£ç¡®çš„IPåœ°å€</u></li></ol></li></ul><h4 id="2-Forwardå’ŒRedirectçš„åŒºåˆ«ï¼Ÿ">2. <strong>Forwardå’ŒRedirectçš„åŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><p><strong>æµè§ˆå™¨ URL åœ°å€</strong>ï¼šForward æ˜¯æœåŠ¡å™¨<u>å†…éƒ¨çš„é‡å®šå‘</u>ï¼ŒæœåŠ¡å™¨<strong>å†…éƒ¨è¯·æ±‚æŸä¸ª servlet</strong>ï¼Œç„¶åè·å–å“åº”çš„å†…å®¹ï¼Œ<strong>æµè§ˆå™¨çš„ URL åœ°å€ä¸ä¼šå˜åŒ–</strong>ï¼›Redirect æ˜¯å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯è¿”å›äº†ä¸€ä¸ª<strong>302</strong> çŠ¶æ€ç å’Œ<strong>æ–°çš„ location</strong>ï¼Œå®¢æˆ·ç«¯<u><strong>é‡æ–°å‘èµ· HTTP è¯·æ±‚</strong></u>ï¼ŒæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯å“<u>åº” location å¯¹åº”çš„ URL åœ°å€ï¼Œ</u>æµè§ˆå™¨çš„ <strong>URL åœ°å€å‘ç”Ÿäº†å˜åŒ–</strong>ã€‚</p></li><li><p><strong>æ•°æ®çš„å…±äº«</strong>ï¼šForward æ˜¯æœåŠ¡å™¨å†…éƒ¨çš„é‡å®šå‘ï¼Œrequest åœ¨æ•´ä¸ªé‡å®šå‘è¿‡ç¨‹ä¸­æ˜¯ä¸å˜çš„ï¼Œ<strong>request ä¸­çš„ä¿¡æ¯åœ¨ servlet é—´æ˜¯å…±äº«</strong>çš„ã€‚Redirect å‘èµ·äº†<strong>ä¸¤æ¬¡ HTTP è¯·æ±‚</strong>åˆ†åˆ«ä½¿ç”¨<strong>ä¸åŒçš„request</strong>ã€‚</p></li><li><p><strong>è¯·æ±‚çš„æ¬¡æ•°</strong>ï¼šForward åªæœ‰ä¸€æ¬¡è¯·æ±‚ï¼›Redirect æœ‰ä¸¤æ¬¡è¯·æ±‚ã€‚</p></li></ul><h4 id="3-è¯·ä½ ç®€å•è®²è§£ä¸€ä¸‹ï¼Œè´Ÿè½½å‡è¡¡åå‘ä»£ç†æ¨¡å¼çš„ä¼˜ç‚¹ã€ç¼ºç‚¹ï¼Ÿ">3.<strong>è¯·ä½ ç®€å•è®²è§£ä¸€ä¸‹ï¼Œè´Ÿè½½å‡è¡¡åå‘ä»£ç†æ¨¡å¼çš„ä¼˜ç‚¹ã€ç¼ºç‚¹ï¼Ÿ</strong></h4><blockquote><p>è”ç³»å®é™…ï¼š<a href="https://server.zol.com.cn/633/6339623_all.html">æ­£åå‘ä»£ç†ã€ç§‘å­¦ä¸Šç½‘ã€VPNä¹‹é—´çš„å…³ç³»</a> å’Œ<a href="https://superxlcr.github.io/2018/07/01/%E4%B8%8A%E7%BD%91%E9%99%90%E5%88%B6%E5%92%8C%E7%BF%BB%E5%A2%99%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/">ç¿»å¢™åŸºæœ¬åŸç†ï¼ˆçœ‹ä»–çš„å…¶ä»–æ–‡ç« è¡¥å……ï¼‰</a></p></blockquote><p>ã€åŸºæœ¬ä»‹ç»ã€‘</p><ol><li><p><strong>åå‘ä»£ç†</strong>ï¼ˆReverse Proxyï¼‰ï¼šæ–¹å¼æ˜¯æŒ‡<u>ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚</u>ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»<strong>æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯</strong>ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªæœåŠ¡å™¨ï¼›</p><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼š ç½‘ç»œç»œå¤–éƒ¨ç”¨æˆ·ä¸èƒ½ç›´æ¥è®¿é—®çœŸå®çš„æœåŠ¡å™¨ï¼Œå…·å¤‡é¢å¤–çš„å®‰å…¨æ€§</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼š åå‘ä»£ç†æ˜¯å¤„äºOSIå‚è€ƒæ¨¡å‹ç¬¬ä¸ƒå±‚åº”ç”¨çš„ï¼Œæ‰€ä»¥å°±å¿…é¡»ä¸ºæ¯ä¸€ç§åº”ç”¨æœåŠ¡ä¸“é—¨å¼€å‘ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ï¼›é™åˆ¶äº†åº”ç”¨èŒƒå›´ï¼›</p><p><u><strong>é’ˆå¯¹æ¯ä¸€æ¬¡ä»£ç†ï¼Œä»£ç†æœåŠ¡å™¨å°±å¿…é¡»æ‰“å¼€ä¸¤ä¸ªè¿æ¥</strong></u>ï¼Œä¸€ä¸ªå¯¹å¤–ï¼Œä¸€ä¸ªå¯¹å†…ï¼Œå› æ­¤åœ¨å¹¶å‘è¿æ¥è¯·æ±‚æ•°é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œ<strong>ä»£ç†æœåŠ¡å™¨çš„è´Ÿè½½ä¹Ÿå°±éå¸¸å¤§äº†</strong>ï¼Œåœ¨æœ€åä»£ç†æœåŠ¡å™¨æœ¬èº«ä¼šæˆä¸ºæœåŠ¡çš„ç“¶é¢ˆã€‚</p></li></ul></li><li><p><strong>åå‘ä»£ç†è´Ÿè½½å‡è¡¡æŠ€æœ¯</strong>ï¼šæ˜¯æŠŠå°†æ¥è‡ªinternetä¸Šçš„è¿æ¥è¯·æ±‚ä»¥åå‘ä»£ç†çš„æ–¹å¼åŠ¨æ€åœ°<strong>è½¬å‘</strong>ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„<strong>å¤šå°æœåŠ¡å™¨</strong>è¿›è¡Œå¤„ç†ï¼Œä»è€Œè¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚</p><ul><li><strong>å®ç°</strong>ï¼šapache mod_proxyã€netscape proxyç­‰ï¼Œä¹Ÿå¯ä»¥åœ¨é«˜é€Ÿç¼“å­˜å™¨ã€è´Ÿè½½å‡è¡¡å™¨ç­‰ç¡¬ä»¶è®¾å¤‡ä¸Šå®ç°ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šå¯ä»¥å°†ä¼˜åŒ–çš„ <u>è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œä»£ç†æœåŠ¡å™¨çš„é«˜é€Ÿç¼“å­˜æŠ€æœ¯</u>ç»“åˆåœ¨ä¸€èµ·ï¼Œæå‡é™æ€ç½‘é¡µçš„è®¿é—®é€Ÿåº¦ï¼Œæä¾›æœ‰ç›Šçš„æ€§èƒ½</li><li><strong>ç¼ºç‚¹</strong>ï¼š</li></ul></li></ol><h5 id="3-1-è¯·è§£é‡Šä¸‹è´Ÿè½½å‡è¡¡çš„ç›¸å…³ç®—æ³•ï¼Ÿ">3.1 è¯·è§£é‡Šä¸‹è´Ÿè½½å‡è¡¡çš„ç›¸å…³ç®—æ³•ï¼Ÿ</h5><p>ä¸åŒçš„åç«¯æœåŠ¡å™¨å¯èƒ½æœºå™¨çš„é…ç½®å’Œå½“å‰ç³»ç»Ÿçš„è´Ÿè½½å¹¶ä¸ç›¸åŒï¼Œå› æ­¤å®ƒä»¬çš„æŠ—å‹èƒ½åŠ›ä¹Ÿä¸ç›¸åŒã€‚</p><ul><li>ç»™é…ç½®é«˜ã€è´Ÿè½½ä½çš„æœºå™¨é…ç½®æ›´é«˜çš„æƒé‡ï¼Œè®©å…¶å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼›</li><li>ç»™é…ç½®ä½ã€è´Ÿè½½é«˜çš„æœºå™¨åˆ†é…è¾ƒä½çš„æƒé‡ï¼Œé™ä½ç³»ç»Ÿè´Ÿè½½ã€‚</li></ul><p>ä¸‹é¢æ˜¯å‡ ç§æ¯”è¾ƒç›¸å…³çš„ç®—æ³•ã€‚</p><ul><li><p><strong>åŠ æƒè½®è¯¢ç®—æ³•</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://www.fanhaobai.com/2018/11/load-balance-round-robin.html">åŠ æƒè½®è¯¢ç®—æ³•</a></p></blockquote><ul><li><p>åŸºæœ¬å®šä¹‰</p><ol><li>å‡è®¾æœ‰ N å°å®ä¾‹ S = {S1, S2, â€¦, Sn}ï¼Œæƒé‡ W = {W1, W2, â€¦, Wn}</li><li>currentPos è¡¨ç¤ºå½“å‰é€‰æ‹©çš„å®ä¾‹ IDï¼Œåˆå§‹åŒ–ä¸º -1ï¼›</li><li>currentWeight è¡¨ç¤ºå½“å‰æƒé‡ï¼Œåˆå§‹å€¼ä¸º max(S)ï¼›</li><li>max(S) è¡¨ç¤º N å°å®ä¾‹çš„æœ€å¤§æƒé‡å€¼ï¼Œgcd(S) è¡¨ç¤º N å°å®ä¾‹æƒé‡çš„æœ€å¤§å…¬çº¦æ•°ã€‚</li></ol></li><li><p>ç®—æ³•è¿‡ç¨‹</p><ol><li>ä»ä¸Šä¸€æ¬¡è°ƒåº¦å®ä¾‹èµ·ï¼Œ<strong>éå†åé¢</strong>çš„æ¯ä¸ªå®ä¾‹ï¼›</li><li>è‹¥æ‰€æœ‰å®ä¾‹å·²è¢«éå†è¿‡ä¸€æ¬¡ï¼Œåˆ™å‡å° currentWeight ä¸º currentWeight - gcd(S)ï¼Œå¹¶ä»å¤´å¼€å§‹éå†ï¼›è‹¥ currentWeight å°äºç­‰äº 0ï¼Œåˆ™é‡ç½®ä¸º max(S)ï¼›</li><li><strong>ç›´åˆ°</strong> éå†çš„å®ä¾‹çš„æƒé‡ &gt;= currentWeight æ—¶ç»“æŸï¼Œ<strong>æ­¤æ—¶å®ä¾‹ä¸ºéœ€è°ƒåº¦çš„å®ä¾‹</strong>ï¼›</li><li>æ¯æ¬¡è°ƒåº¦é‡å¤æ­¥éª¤ 1ã€2ã€3ï¼›</li></ol></li><li><p>ç®—æ³•å®ä¾‹</p><p><img src="https://i.loli.net/2021/05/30/YCVDN4miMvPy7sJ.png" alt="image-20210529232315965"></p><p>ä¾‹å¦‚ï¼Œä¸Šè¿° 4 ä¸ªæœåŠ¡ï¼Œæœ€å¤§æƒé‡ max(S) ä¸º 4ï¼Œæœ€å¤§å…¬çº¦æ•° gcd(S) ä¸º 1ã€‚å…¶è°ƒåº¦è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2021/05/30/7A4s6i3opra8LWR.png" alt="image-20210529232350799"></p></li><li><p>ç®—æ³•ä¼˜ç¼ºç‚¹</p><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼š ç›¸æ¯” <u>ç®€å•è½®è¯¢</u> æ–¹å¼ï¼Œé€šè¿‡æƒé‡è¿›è¡Œåˆ†é…ï¼Œæ›´åŠ å‡åŒ€</p></li><li><p><strong>ç¼ºç‚¹</strong>ï¼šå¦‚ä¸‹ä¸€ä¸ªæç«¯æƒ…å†µ</p><blockquote><p>æœåŠ¡å®ä¾‹ S = {a, b, c}ï¼Œæƒé‡ W = {5, 1, 1}ï¼Œä½¿ç”¨åŠ æƒè½®è¯¢è°ƒåº¦ç”Ÿæˆçš„å®ä¾‹åºåˆ—ä¸º {a, a, a, a, a, b, c}ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨è¿ç»­ 5 ä¸ªè¯·æ±‚éƒ½è¢«è°ƒåº¦åˆ°å®ä¾‹ aã€‚</p></blockquote><p>å…³äºè¿™ç‚¹ï¼Œå¯ä»¥é‡‡ç”¨  <a href="https://www.fanhaobai.com/2018/11/load-balance-round-robin.html#">å¹³æ»‘åŠ æƒè½®è¯¢</a> è°ƒåº¦ç®—æ³• ã€‚</p></li></ul></li></ul></li><li><p><strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</strong></p><p>è´Ÿè½½å‡è¡¡ç®—æ³•ä¸­çš„å“ˆå¸Œç®—æ³•ï¼Œå°±æ˜¯æ ¹æ®æŸä¸ªå€¼ç”Ÿæˆä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åå¯¹åº”åˆ°æŸå°æœåŠ¡å™¨ä¸Šå»ï¼Œå³<strong>å“ˆå¸Œç¯</strong>ã€‚</p><p><img src="https://i.loli.net/2021/05/30/fAa2jzXxGZ7lVq1.png" alt="image-20210529232953082"></p><p>ä½†æ˜¯å¯èƒ½å‡ºç°ä¸€ç§ï¼Œ<strong>å“ˆå¸Œå€¾æ–œ</strong>çš„æƒ…å†µï¼šAè´Ÿè´£çš„åŒºåŸŸå¤ªå¤§ï¼ŒBï¼ŒCè´Ÿè´£çš„å°ã€‚è¿™ä¸ªæ—¶å€™é‡‡ç”¨è™šæ‹ŸèŠ‚ç‚¹å»è§£å†³ï¼Œè¿™é‡Œä¸è¡¨ã€‚</p></li></ul><h5 id="3-2-DNS-è´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆç­–ç•¥ï¼Ÿ">3.2 DNS è´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆç­–ç•¥ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href=""></a></p></blockquote><ul><li><strong>åŸç†</strong>ï¼š è¿˜æ˜¯ä¸å¤ªæ˜ç™½ï¼ŒDNSé€’å½’æŸ¥è¯¢æœ¬èº«å°±æ˜¯ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥å§ï¼Ÿå¤šå°æœåŠ¡å™¨æ»¡è¶³åŒä¸€ä¸ªæŸ¥è¯¢æœåŠ¡ï¼Ÿ</li></ul><h4 id="4-è¯·è¯´æ˜ä¸€ä¸‹httpå’Œhttpsçš„åŒºåˆ«ï¼Ÿ">4.<strong>è¯·è¯´æ˜ä¸€ä¸‹httpå’Œhttpsçš„åŒºåˆ«ï¼Ÿ</strong></h4><ol><li>httpsåè®®è¦ç”³è¯·è¯ä¹¦åˆ°caï¼Œéœ€è¦ä¸€å®š<u>ç»æµæˆæœ¬</u>ï¼›</li><li>httpæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œhttpsæ˜¯åŠ å¯†çš„å®‰å…¨ä¼ è¾“ï¼›</li><li>ï¼ˆğŸš©*1ï¼‰è¿æ¥çš„ç«¯å£ä¸ä¸€æ ·ï¼Œhttpæ˜¯<strong>80</strong>ï¼Œhttpsæ˜¯<strong>443</strong>ï¼›</li><li>httpè¿æ¥å¾ˆç®€å•ï¼Œæ²¡æœ‰çŠ¶æ€ï¼›</li><li>httpsæ˜¯sslåŠ å¯†çš„ä¼ è¾“ï¼Œèº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œç›¸å¯¹httpæ˜æ–‡ä¼ è¾“æ¯”è¾ƒå®‰å…¨ã€‚</li></ol><h5 id="4-1-è®²ä¸€è®²httpçš„è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ï¼Ÿåè®®ï¼Ÿ">4.1 è®²ä¸€è®²httpçš„è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ï¼Ÿåè®®ï¼Ÿ</h5><ul><li><p><strong>è¯·æ±‚æŠ¥æ–‡å’Œåè®®</strong></p><p>ä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡ç”±<strong>è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰</strong>ã€<strong>è¯·æ±‚å¤´éƒ¨ï¼ˆheaderï¼‰</strong>ã€<strong>ç©ºè¡Œ</strong>å’Œ<strong>è¯·æ±‚æ•°æ®</strong>4ä¸ªéƒ¨åˆ†ç»„æˆï¼Œä¸‹å›¾ç»™å‡ºäº†è¯·æ±‚æŠ¥æ–‡çš„ä¸€èˆ¬æ ¼å¼ã€‚</p><p><img src="https://i.loli.net/2021/05/17/uxX1gbcnhTsS9td.png" alt="img"></p><ul><li><p><strong>è¯·æ±‚è¡Œ</strong> ï¼šç”±è¯·æ±‚æ–¹æ³•å­—æ®µã€URLå­—æ®µå’ŒHTTPåè®®ç‰ˆæœ¬å­—æ®µ3ä¸ªå­—æ®µç»„æˆã€‚</p><blockquote><p><strong>HTTPåè®®</strong> :  çš„è¯·æ±‚æ–¹æ³•æœ‰GETã€POSTã€HEADã€PUTã€DELETEã€OPTIONSã€TRACEã€CONNECTã€‚</p></blockquote></li><li><p><strong>è¯·æ±‚å¤´éƒ¨</strong>ï¼š è¯·æ±‚å¤´éƒ¨ç”±<strong>å…³é”®å­—/å€¼</strong>å¯¹ç»„æˆï¼Œæ¯è¡Œä¸€å¯¹ï¼Œå…³é”®å­—å’Œå€¼ç”¨è‹±æ–‡å†’å·â€œ:â€åˆ†éš” ã€‚ è¯·æ±‚å¤´éƒ¨<strong>é€šçŸ¥æœåŠ¡å™¨æœ‰å…³äºå®¢æˆ·ç«¯è¯·æ±‚çš„ä¿¡æ¯</strong>ã€‚</p><blockquote><p>User-Agentï¼šäº§ç”Ÿè¯·æ±‚çš„æµè§ˆå™¨ç±»å‹ã€‚</p><p>Acceptï¼šå®¢æˆ·ç«¯å¯è¯†åˆ«çš„å†…å®¹ç±»å‹åˆ—è¡¨ã€‚</p><p><strong>Host</strong>ï¼šè¯·æ±‚çš„ä¸»æœºåï¼Œå…è®¸å¤šä¸ªåŸŸååŒå¤„ä¸€ä¸ªIPåœ°å€ï¼Œå³è™šæ‹Ÿä¸»æœºã€‚</p></blockquote></li><li><p><strong>è¯·æ±‚æ•°æ® :</strong> è¯·æ±‚æ•°æ®<strong>ä¸åœ¨GETæ–¹æ³•ä¸­ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨POSTæ–¹æ³•</strong>ä¸­ä½¿ç”¨ã€‚POSTæ–¹æ³•é€‚ç”¨äºéœ€è¦å®¢æˆ·å¡«å†™è¡¨å•çš„åœºåˆã€‚</p></li></ul></li><li><p><strong>å“åº”æŠ¥æ–‡å’Œåè®®</strong></p><p>HTTPå“åº”ä¹Ÿç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>çŠ¶æ€è¡Œã€å“åº”å¤´ã€ç©ºæ ¼ã€å“åº”æ•°æ®</strong>ã€‚</p><p><img src="https://i.loli.net/2021/05/17/QNIRoY5f7jk6sHv.jpg" alt="img"></p><ul><li><strong>çŠ¶æ€è¡Œ</strong> ï¼š çŠ¶æ€è¡Œï¼ˆstatus lineï¼‰é€šè¿‡æä¾›ä¸€ä¸ªçŠ¶æ€ç æ¥è¯´æ˜æ‰€è¯·æ±‚çš„èµ„æºæƒ…å†µã€‚å¦‚<strong>404</strong>ç­‰</li></ul></li></ul><h5 id="4-2-ä¸€ä¸ªTCPè¿æ¥ä¸­å¤šä¸ªHTTPè¯·æ±‚å‘ç”Ÿå¯ä»¥ã€åŒæ—¶ã€‘ä¸€èµ·å‘ç”Ÿå—ï¼Ÿ">4.2  ä¸€ä¸ªTCPè¿æ¥ä¸­å¤šä¸ªHTTPè¯·æ±‚å‘ç”Ÿå¯ä»¥ã€åŒæ—¶ã€‘ä¸€èµ·å‘ç”Ÿå—ï¼Ÿ</h5><ul><li><strong>HTTP/1.1å•ä¸ª TCP è¿æ¥åœ¨åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚</strong>ã€‚æ„æ€æ˜¯è¯´ï¼šä¸¤ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸä¸èƒ½é‡å ï¼Œä»»æ„ä¸¤ä¸ª HTTP è¯·æ±‚ä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´åœ¨åŒä¸€ä¸ª TCP è¿æ¥é‡Œä¸èƒ½é‡å ï¼›</li><li><strong>Pipelining æŠ€æœ¯ &amp; Multiplexingã€‚</strong> Pipelining æŠ€æœ¯å¯ä»¥å®Œæˆè¿™ä¸ªå¤šä¸ªè¯·æ±‚åŒæ—¶å‘é€ï¼Œä½†æ˜¯ç”±äºæµè§ˆå™¨é»˜è®¤å…³é—­ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸å¯è¡Œçš„ã€‚åœ¨ HTTP2 ä¸­ç”±äº Multiplexing ç‰¹ç‚¹çš„å­˜åœ¨ï¼Œå¤šä¸ª HTTP è¯·æ±‚å¯ä»¥åœ¨åŒä¸€ä¸ª TCP è¿æ¥ä¸­å¹¶è¡Œè¿›è¡Œï¼›</li></ul><blockquote><p>é‚£ä¹ˆåœ¨ HTTP/1.1 æ—¶ä»£ï¼Œæµè§ˆå™¨æ˜¯å¦‚ä½•æé«˜é¡µé¢åŠ è½½æ•ˆç‡çš„å‘¢ï¼Ÿ</p></blockquote><ul><li>ç»´æŒå’ŒæœåŠ¡å™¨å·²ç»å»ºç«‹çš„ TCP è¿æ¥ï¼Œåœ¨åŒä¸€è¿æ¥ä¸Š<strong>é¡ºåºå¤„ç†å¤šä¸ªè¯·æ±‚</strong>ï¼›</li><li><strong>å’ŒæœåŠ¡å™¨å»ºç«‹å¤šä¸ª TCP è¿æ¥</strong>ã€‚</li></ul><h4 id="5-è¯·è¯´æ˜ä¸€ä¸‹http1-0-å’Œhttps1-1-åŒºåˆ«ï¼Ÿ">5.<strong>è¯·è¯´æ˜ä¸€ä¸‹http1.0 å’Œhttps1.1 åŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><strong>é•¿è¿æ¥</strong><ul><li>HTTP1.0é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥ï¼Œæ¯æ¬¡HTTPè¯·æ±‚éƒ½éœ€è¦å»ºç«‹æ–°çš„TCPè¿æ¥ï¼Œè¿æ¥ä¸èƒ½å¤ç”¨ï¼›</li><li>HTTP1.1æ”¯æŒ<strong>æŒä¹…è¿æ¥å’Œè¯·æ±‚çš„æµæ°´çº¿å¤„ç†ï¼ˆä½†ä¸æ˜¯å¹¶å‘ï¼ï¼</strong>ï¼‰ï¼Œåœ¨<strong>ä¸€ä¸ªTCPè¿æ¥ä¸Šå¯ä»¥ä¼ é€å¤šä¸ªHTTPè¯·æ±‚å’Œå“åº”</strong>ï¼Œ<u>å‡å°‘å»ºç«‹å’Œå…³é—­TCPè¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿï¼Œæé«˜æ•ˆç‡</u></li></ul></li><li><strong>hostå­—æ®µ</strong><ul><li>åœ¨<strong>HTTP1.0ä¸­ä¸ºæ¯å°æœåŠ¡å™¨ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œå› æ­¤ï¼Œè¯·æ±‚æ¶ˆæ¯ä¸­çš„URLå¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºå</strong>ï¼ˆhostnameï¼‰</li><li>HTTP1.1çš„è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯éƒ½åº”æ”¯æŒHostå¤´åŸŸï¼ˆ<u>è¡¥å……ï¼šF12 æŠ“åŒ…å¯ä»¥çœ‹åˆ°</u>ï¼‰ï¼Œä¸”è¯·æ±‚æ¶ˆæ¯ä¸­å¦‚æœ<strong>æ²¡æœ‰Hostå¤´åŸŸ</strong>ï¼Œä¼š<strong>æŠ¥400 Bad Requesté”™è¯¯</strong></li></ul></li><li><strong>ç¼“å­˜å¤„ç†</strong><ul><li>HTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥</li></ul></li><li><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨</strong><ul><li>HTTP1.0ä¸­å­˜åœ¨æµªè´¹å¸¦å®½ç°è±¡ï¼Œä¾‹å¦‚ï¼šï¼ˆ1ï¼‰å®¢æˆ·ç«¯åªéœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´<u>å°†æ•´ä¸ªå¯¹è±¡å‘é€è¿‡æ¥</u>ï¼›(2) ä¸‹è½½å¤§æ–‡ä»¶ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼Œåœ¨å‘ç”Ÿæ–­è¿åéœ€è¦é‡æ–°ä¸‹è½½å®Œæ•´çš„åŒ…ï¼›</li><li>HTTP1.1åˆ™åœ¨è¯·æ±‚å¤´ä¸­å¼•å…¥rangeå¤´åŸŸï¼Œå®ƒå…è®¸<strong>åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†(å› æ­¤ä¹Ÿæ”¯æŒæ–­ç‚¹é‡ä¼ )</strong>ï¼Œå³è¿”å›ç æ˜¯206ï¼›</li></ul></li><li><strong>æ–°å¢ä¸€äº›é”™è¯¯é€šçŸ¥çŠ¶æ€ç </strong><ul><li>å¦‚ï¼š409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çª ã€‚</li></ul></li></ul><h4 id="6-è¯·è¯´æ˜ä¸€ä¸‹http1-0-å’Œhttps2-0-åŒºåˆ«ï¼Ÿ">6.<strong>è¯·è¯´æ˜ä¸€ä¸‹http1.0 å’Œhttps2.0 åŒºåˆ«</strong>ï¼Ÿ</h4><h4 id="7-è¯·è®²ä¸€ä¸‹æµè§ˆå™¨ä»æ¥æ”¶åˆ°ä¸€ä¸ªURLï¼Œåˆ°æœ€åå±•ç¤ºå‡ºé¡µé¢ï¼Œç»å†äº†å“ªäº›è¿‡ç¨‹ï¼Ÿ">7.<strong>è¯·è®²ä¸€ä¸‹æµè§ˆå™¨ä»æ¥æ”¶åˆ°ä¸€ä¸ªURLï¼Œåˆ°æœ€åå±•ç¤ºå‡ºé¡µé¢ï¼Œç»å†äº†å“ªäº›è¿‡ç¨‹</strong>ï¼Ÿ</h4><ol><li><p>åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥URLï¼›</p></li><li><p>DNSåŸŸåè§£æï¼Œè·å¾—åŸŸåç›¸å¯¹åº”çš„IPåœ°å€ï¼ˆè¯¦è§ï¼š<u>åº”ç”¨å±‚DNSå¯»å€è¿‡ç¨‹</u>ï¼‰ï¼›</p><blockquote><p>æµè§ˆå™¨é¦–å…ˆä¼šä»ï¼ˆ1ï¼‰æœ¬åœ°æµè§ˆå™¨ç¼“å­˜ã€hostsæ–‡ä»¶æ˜¯å¦å­˜åœ¨ç›¸åº”çš„åŸŸåã€IPå¯¹åº”å…³ç³»ï¼Œå¦‚æœæœ‰åˆ™å‘è¿™ä¸ªIPåœ°å€å‘é€è¯·æ±‚ï¼Œå¦‚æœæ²¡æœ‰åˆ™å‘ï¼ˆ2ï¼‰æœ¬åœ°DNS<strong>è§£æå™¨</strong>ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œï¼ˆ3ï¼‰å†å»DNS<strong>æœåŠ¡å™¨</strong>ä¸­æ‰¾IPã€‚</p></blockquote></li><li><p>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·TCPè¿æ¥ï¼Œä¸æµè§ˆå™¨å»ºç«‹TCPä¸‰æ¬¡æ¡æ‰‹ï¼›ç„¶å <u><strong>å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚</strong></u>ï¼Œè¯·æ±‚æ•°æ®åŒ…</p><blockquote><p><strong>HTTPè¯·æ±‚æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šè¯·æ±‚è¡Œã€è¯·æ±‚æŠ¥å¤´å’Œè¯·æ±‚æ­£æ–‡</strong>ã€‚</p><p>ä¸æœåŠ¡å™¨å»ºç«‹äº†è¿æ¥åï¼Œå°±å¯ä»¥å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚äº†ã€‚å‘é€HTTPè¯·æ±‚çš„è¿‡ç¨‹å°±æ˜¯<u>æ„å»ºHTTPè¯·æ±‚æŠ¥æ–‡</u>ï¼Œå¹¶é€šè¿‡TCPåè®®å‘é€åˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆ<u>HTTPåè®®80/8080ï¼ŒHTTPSåè®®443</u>ï¼‰ã€‚</p></blockquote></li><li><p>æœåŠ¡ç«¯ï¼ˆç”±webæœåŠ¡å™¨ï¼‰å¤„ç†æ”¶åˆ°çš„è¯·æ±‚</p><blockquote><p>æœåŠ¡å™¨ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œç”±webæœåŠ¡å™¨ï¼ˆå‡†ç¡®æ¥è¯´åº”è¯¥æ˜¯HTTPæœåŠ¡å™¨ï¼‰å¤„ç†è¯·æ±‚ï¼Œè¯¸å¦‚Apacheã€Ngnixã€IIS ã€‚</p></blockquote></li><li><p>æœåŠ¡å™¨è¿”å›ç›¸åº”ç»“æœï¼ˆå“åº”æŠ¥æ–‡ï¼‰è‡³æµè§ˆå™¨</p><blockquote><p>HTTPå“åº”æŠ¥æ–‡ä¹Ÿæ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<strong>çŠ¶æ€ç ã€å“åº”æŠ¥å¤´å’Œå“åº”æŠ¥æ–‡</strong>ã€‚</p><p>çŠ¶æ€ç æ˜¯ç”±ä¸‰ä½æ•°ç»„æˆï¼Œ<u>ç¬¬ä¸€ä¸ªæ•°å­—å®šä¹‰äº†å“åº”çš„ç±»åˆ«</u>ï¼š</p><ul><li><strong>1XX</strong>ï¼šæŒ‡ç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºè¯·æ±‚å·²æ¥å—ï¼Œç»§ç»­å¤„ç†ï¼›</li><li><strong>2XX</strong>ï¼šæˆåŠŸï¼Œè¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å—ï¼›</li><li><strong>3XX</strong>ï¼šé‡å®šå‘ï¼Œè¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œï¼›</li><li><strong>4XX</strong>ï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®ç°ï¼›</li><li><strong>5XX</strong>ï¼šæœåŠ¡å™¨ç«¯é”™è¯¯ï¼ŒæœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ã€‚</li></ul></blockquote></li><li><p>å››æ¬¡æŒ¥æ‰‹å…³é—­TCPè¿æ¥</p><blockquote><p>å››æ¬¡æŒ¥æ‰‹ï¼Œå½“åŒæ–¹æ²¡æœ‰è¯·æ±‚æˆ–å“åº”ä¼ é€’æ—¶ï¼Œä»»æ„ä¸€æ–¹éƒ½å¯ä»¥å‘èµ·å…³é—­è¯·æ±‚ã€‚</p></blockquote></li><li><p>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</p><blockquote><p>æµè§ˆå™¨åœ¨ <u>æ”¶åˆ°HTMLã€CSSã€JSæ–‡ä»¶</u>åï¼Œå°±éœ€è¦è¿›è¡Œæ¸²æŸ“ã€‚</p><p>ï¼ˆ1ï¼‰æµè§ˆå™¨è§£æHTMLæ–‡ä»¶æ„å»º<u>DOMæ ‘</u>ï¼Œï¼ˆ2ï¼‰ç„¶åè§£æCSSæ–‡ä»¶æ„å»º<u>æ¸²æŸ“æ ‘</u>ï¼Œï¼ˆ3ï¼‰ç­‰åˆ°æ¸²æŸ“æ ‘æ„å»ºå®Œæˆåï¼Œæµè§ˆå™¨å¼€å§‹å¸ƒå±€æ¸²æŸ“æ ‘å¹¶å°†å…¶<u>ç»˜åˆ¶åˆ°å±å¹•</u>ä¸Š</p></blockquote></li></ol><h4 id="8-è¯·è§£é‡Šä¸€ä¸‹SSLå·¥ä½œè¿‡ç¨‹ï¼ˆHttpsä¼ è¾“è¿‡ç¨‹ï¼‰ï¼Ÿ">8.<strong>è¯·è§£é‡Šä¸€ä¸‹SSLå·¥ä½œè¿‡ç¨‹ï¼ˆHttpsä¼ è¾“è¿‡ç¨‹ï¼‰ï¼Ÿ</strong></h4><blockquote><p>httpsæ˜¯httpçš„æ‰©å±•ï¼Œåœ¨ä¼ è¾“å±‚ä½¿ç”¨äº†å®‰å…¨åè®®ï¼š<strong>å®‰å…¨å¥—æ¥å­—å±‚SSL(Secure Socket Layer)</strong>ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html</a></p></blockquote><blockquote><p><strong>å…¬é’¥</strong>é€šå¸¸ç”¨äºåŠ å¯†ä¼šè¯å¯†é’¥ã€éªŒè¯æ•°å­—ç­¾åï¼Œæˆ–åŠ å¯†å¯ä»¥ç”¨ç›¸åº”çš„ç§é’¥è§£å¯†çš„æ•°æ®ã€‚å…¬é’¥å’Œç§é’¥æ˜¯é€šè¿‡ä¸€ç§ç®—æ³•å¾—åˆ°çš„ä¸€ä¸ªå¯†é’¥å¯¹(å³ä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥)ã€‚</p><ul><li>é€šè¿‡è¿™ç§ç®—æ³•å¾—åˆ°çš„å¯†é’¥å¯¹èƒ½ä¿è¯åœ¨ä¸–ç•ŒèŒƒå›´å†…æ˜¯å”¯ä¸€çš„ã€‚</li><li>ä½¿ç”¨è¿™ä¸ªå¯†é’¥å¯¹çš„æ—¶å€™,å¦‚æœç”¨å…¶ä¸­ä¸€ä¸ªå¯†é’¥åŠ å¯†ä¸€æ®µæ•°æ®ï¼Œå¿…é¡»ç”¨å¦ä¸€ä¸ªå¯†é’¥è§£å¯†ã€‚</li></ul></blockquote><p>SSL/TLSåè®®çš„åŸºæœ¬æ€è·¯æ˜¯é‡‡ç”¨<a href="http://en.wikipedia.org/wiki/Public-key_cryptography">å…¬é’¥åŠ å¯†æ³•</a>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å…ˆå‘æœåŠ¡å™¨ç«¯ç´¢è¦å…¬é’¥ï¼Œç„¶åç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯†æ–‡åï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ã€‚</p><p><img src="https://i.loli.net/2021/04/21/aH6gjc5UT9Xu2io.png" alt="image-20210421171336262"></p><p>æ‰€ä»¥åŸºæœ¬è¿‡ç¨‹æ˜¯ï¼š</p><blockquote><p>ï¼ˆ1ï¼‰ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯ç´¢è¦å¹¶éªŒè¯å…¬é’¥ã€‚</p><p>ï¼ˆ2ï¼‰ åŒæ–¹åå•†ç”Ÿæˆ&quot;å¯¹è¯å¯†é’¥&quot;ã€‚</p><p>ï¼ˆ3ï¼‰ åŒæ–¹é‡‡ç”¨&quot;å¯¹è¯å¯†é’¥&quot;è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚</p></blockquote><ol><li><p><strong>åå•†åŠ å¯†ç®—æ³•</strong>ã€‚å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰å…ˆå‘æœåŠ¡å™¨å‘å‡º<u>åŠ å¯†é€šä¿¡çš„è¯·æ±‚</u>ï¼Œè¿™è¢«å«åšClientHelloè¯·æ±‚ï¼›</p><blockquote><p>ï¼ˆ1ï¼‰ æ”¯æŒçš„åè®®ç‰ˆæœ¬ï¼Œæ¯”å¦‚TLS 1.0ç‰ˆã€‚</p><p>ï¼ˆ2ï¼‰ <u>ä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•°</u>ï¼Œæ¥ç”Ÿæˆ&quot;å¯¹è¯å¯†é’¥&quot;ã€‚</p><p>ï¼ˆ3ï¼‰ æ”¯æŒçš„åŠ å¯†æ–¹æ³•ï¼Œæ¯”å¦‚RSAå…¬é’¥åŠ å¯†ã€‚</p><p>ï¼ˆ4ï¼‰ æ”¯æŒçš„å‹ç¼©æ–¹æ³•ã€‚</p></blockquote></li><li><p><strong>æœåŠ¡å™¨å›åº”</strong>ã€‚æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘å‡ºå›åº”ï¼Œè¿™å«åšSeverHelloï¼›</p><blockquote><p>ï¼ˆ1ï¼‰ ç¡®è®¤ä½¿ç”¨çš„åŠ å¯†é€šä¿¡åè®®ç‰ˆæœ¬ï¼Œæ¯”å¦‚TLS 1.0ç‰ˆæœ¬ã€‚å¦‚æœæµè§ˆå™¨ä¸æœåŠ¡å™¨æ”¯æŒçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼ŒæœåŠ¡å™¨å…³é—­åŠ å¯†é€šä¿¡ã€‚</p><p>ï¼ˆ2ï¼‰ <u>ä¸€ä¸ªæœåŠ¡å™¨ç”Ÿæˆçš„éšæœºæ•°</u>ï¼Œç¨åç”¨äºç”Ÿæˆ&quot;å¯¹è¯å¯†é’¥&quot;ã€‚</p><p>ï¼ˆ3ï¼‰ ç¡®è®¤ä½¿ç”¨çš„åŠ å¯†æ–¹æ³•ï¼Œæ¯”å¦‚RSAå…¬é’¥åŠ å¯†ã€‚</p><p>ï¼ˆ4ï¼‰ æœåŠ¡å™¨è¯ä¹¦ã€‚</p></blockquote></li><li><p><strong>å®¢æˆ·ç«¯é‰´åˆ«</strong>ã€‚å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å›åº”ä»¥åï¼Œï¼ˆ1ï¼‰<u>é¦–å…ˆéªŒè¯æœåŠ¡å™¨è¯ä¹¦</u>ï¼šå¦‚æœè¯ä¹¦ä¸æ˜¯å¯ä¿¡æœºæ„é¢å¸ƒã€æˆ–è€…è¯ä¹¦ä¸­çš„åŸŸåä¸å®é™…åŸŸåä¸ä¸€è‡´ã€æˆ–è€…è¯ä¹¦å·²ç»è¿‡æœŸï¼Œå°±ä¼šå‘è®¿é—®è€…æ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šï¼Œç”±å…¶é€‰æ‹©æ˜¯å¦è¿˜è¦ç»§ç»­é€šä¿¡ã€‚</p><p>ï¼ˆ2ï¼‰<u>å¦‚æœè¯ä¹¦æ²¡æœ‰é—®é¢˜ï¼Œå®¢æˆ·ç«¯å°±ä¼šä»è¯ä¹¦ä¸­å–å‡ºæœåŠ¡å™¨çš„å…¬é’¥</u>ã€‚ç„¶åï¼Œå‘æœåŠ¡å™¨å‘é€ä¸‹é¢ä¸‰é¡¹ä¿¡æ¯ï¼š</p><blockquote><p>ï¼ˆ1ï¼‰ <u>ä¸€ä¸ªéšæœºæ•°</u>ã€‚è¯¥éšæœºæ•°ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†ï¼Œé˜²æ­¢è¢«çªƒå¬ã€‚</p><p>ï¼ˆ2ï¼‰ <u>ç¼–ç æ”¹å˜é€šçŸ¥</u>ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨åŒæ–¹å•†å®šçš„åŠ å¯†æ–¹æ³•å’Œå¯†é’¥å‘é€ã€‚</p><p>ï¼ˆ3ï¼‰ <u>å®¢æˆ·ç«¯æ¡æ‰‹ç»“æŸé€šçŸ¥</u>ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™ä¸€é¡¹åŒæ—¶ä¹Ÿæ˜¯å‰é¢å‘é€çš„æ‰€æœ‰å†…å®¹çš„hashå€¼ï¼Œç”¨æ¥ä¾›æœåŠ¡å™¨æ ¡éªŒã€‚</p></blockquote></li><li><p><strong>ä¼šè¯ç§˜é’¥è®¡ç®—</strong>ã€‚ æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¬¬ä¸‰ä¸ªéšæœºæ•°pre-master keyä¹‹åï¼Œè®¡ç®—ç”Ÿæˆæœ¬æ¬¡ä¼šè¯æ‰€ç”¨çš„&quot;ä¼šè¯å¯†é’¥&quot;ï¼ˆä½¿ç”¨3ä¸ªéšæœºæ•°ç”Ÿæˆæ›´å®‰å…¨ï¼‰ï¼›</p><blockquote><p>ï¼ˆ1ï¼‰ç¼–ç æ”¹å˜é€šçŸ¥ï¼Œè¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨åŒæ–¹å•†å®šçš„åŠ å¯†æ–¹æ³•å’Œå¯†é’¥å‘é€ã€‚</p><p>ï¼ˆ2ï¼‰æœåŠ¡å™¨æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼Œè¡¨ç¤ºæœåŠ¡å™¨çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™ä¸€é¡¹åŒæ—¶ä¹Ÿæ˜¯å‰é¢å‘é€çš„æ‰€æœ‰å†…å®¹çš„hashå€¼ï¼Œç”¨æ¥ä¾›å®¢æˆ·ç«¯æ ¡éªŒã€‚</p></blockquote></li><li><p><strong>å®‰å…¨æ•°æ®ä¼ è¾“</strong>ã€‚åŒæ–¹ç”¨ä¼šè¯ç§˜é’¥åŠ å¯†å’Œè§£å¯†ä¹‹é—´ä¼ é€çš„æ•°æ®ã€‚</p></li></ol><h5 id="8-1-å…¬é’¥å¦‚ä½•ä¿è¯ä¸è¢«ç¯¡æ”¹ï¼Ÿè¯´ä¸€è¯´è¯ä¹¦ã€‚">8.1 å…¬é’¥å¦‚ä½•ä¿è¯ä¸è¢«ç¯¡æ”¹ï¼Ÿè¯´ä¸€è¯´è¯ä¹¦ã€‚</h5><p>å°†å…¬é’¥æ”¾åœ¨æ•°å­—è¯ä¹¦ä¸­ã€‚åªè¦è¯ä¹¦æ˜¯å¯ä¿¡çš„ï¼Œå…¬é’¥å°±æ˜¯å¯ä¿¡çš„ã€‚</p><ul><li><p>æ•°å­—è¯ä¹¦è®¤è¯æœºæ„ï¼ˆCAï¼ŒCertificate Authorityï¼‰æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŒæ–¹éƒ½å¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æœºæ„ã€‚</p></li><li><p>æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ CA æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼ŒCA åœ¨åˆ¤æ˜æå‡ºç”³è¯·è€…çš„èº«ä»½ä¹‹åï¼Œ<strong>ä¼šå¯¹å·²ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾å</strong>ï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†è¯¥å…¬å¼€å¯†é’¥æ”¾å…¥å…¬å¼€å¯†é’¥è¯ä¹¦åç»‘å®šåœ¨ä¸€èµ·ã€‚</p></li><li><p>è¿›è¡Œ HTTPS é€šä¿¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠŠè¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å–å¾—å…¶ä¸­çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå…ˆä½¿ç”¨æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼ˆ<strong>è¯ä¹¦ä¸å¯ä¿¡æµè§ˆå™¨ä¼šæç¤º</strong>ï¼‰ï¼Œå°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚</p></li></ul><h5 id="8-2-å…¬é’¥åŠ å¯†è®¡ç®—é‡å¤ªå¤§ï¼Œå¦‚ä½•å‡å°‘è€—ç”¨çš„æ—¶é—´ï¼Ÿ">8.2 å…¬é’¥åŠ å¯†è®¡ç®—é‡å¤ªå¤§ï¼Œå¦‚ä½•å‡å°‘è€—ç”¨çš„æ—¶é—´ï¼Ÿ</h5><p>æ¯ä¸€æ¬¡å¯¹è¯ï¼ˆsessionï¼‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½ç”Ÿæˆä¸€ä¸ª&quot;å¯¹è¯å¯†é’¥&quot;ï¼ˆsession keyï¼‰ï¼Œç”¨å®ƒæ¥åŠ å¯†ä¿¡æ¯ã€‚ç”±äº<strong>å¯¹è¯å¯†é’¥æ˜¯å¯¹ç§°åŠ å¯†</strong>ï¼Œæ‰€ä»¥<strong>è¿ç®—é€Ÿåº¦éå¸¸å¿«</strong>ï¼Œè€ŒæœåŠ¡å™¨å…¬é’¥åªç”¨äºåŠ å¯†&quot;å¯¹è¯å¯†é’¥&quot;æœ¬èº«ï¼Œè¿™æ ·å°±å‡å°‘äº†åŠ å¯†è¿ç®—çš„æ¶ˆè€—æ—¶é—´ã€‚</p><h5 id="8-3-ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™åˆ·æ–°é¡µé¢ä¸éœ€è¦é‡æ–°å»ºç«‹-SSL-è¿æ¥ï¼Ÿ">8.3 ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™åˆ·æ–°é¡µé¢ä¸éœ€è¦é‡æ–°å»ºç«‹ SSL è¿æ¥ï¼Ÿ</h5><p>TCP è¿æ¥æœ‰çš„æ—¶å€™ä¼šè¢«æµè§ˆå™¨å’ŒæœåŠ¡ç«¯ç»´æŒä¸€æ®µæ—¶é—´ï¼Œ<strong>TCP ä¸éœ€è¦é‡æ–°å»ºç«‹ï¼ŒSSL è‡ªç„¶ä¹Ÿä¼šç”¨ä¹‹å‰çš„</strong>ã€‚</p><h4 id="9-ä»‹ç»ä¸€ä¸‹å¸¸è§çš„å‡ ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ">9. ä»‹ç»ä¸€ä¸‹å¸¸è§çš„å‡ ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Ÿä¼˜ç¼ºç‚¹ï¼Ÿ</h4><ul><li><p><strong>éå¯¹ç§°åŠ å¯†</strong></p><p>éå¯¹ç§°å¯†é’¥åŠ å¯†ï¼Œåˆç§°å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆPublic-Key Encryptionï¼‰ï¼ŒåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚</p><p>å…¬å¼€å¯†é’¥æ‰€æœ‰äººéƒ½å¯ä»¥è·å¾—ï¼Œ<strong>é€šä¿¡å‘é€æ–¹è·å¾—æ¥æ”¶æ–¹çš„å…¬å¼€å¯†é’¥ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¬å¼€å¯†é’¥è¿›è¡ŒåŠ å¯†</strong>ï¼Œ<strong>æ¥æ”¶æ–¹æ”¶åˆ°é€šä¿¡å†…å®¹åä½¿ç”¨ç§æœ‰å¯†é’¥è§£å¯†</strong>ã€‚</p></li><li><p><strong>å¸¸ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•</strong></p><p><img src="https://i.loli.net/2021/04/21/8cmyAzUZYDw5vJt.png" alt="é¢è¯•é¢˜â€”â€”å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†3"></p><ul><li>RSAï¼šç”± RSA å…¬å¸å‘æ˜ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒ<strong>å˜é•¿å¯†é’¥</strong>çš„å…¬å…±å¯†é’¥ç®—æ³•ï¼Œéœ€è¦åŠ å¯†çš„æ–‡ä»¶å—çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„</li><li>DSAï¼ˆDigital Signature Algorithmï¼‰<strong>ï¼šæ•°å­—ç­¾å</strong>ç®—æ³•ï¼Œæ˜¯ä¸€ç§æ ‡å‡†çš„ DSSï¼ˆæ•°å­—ç­¾åæ ‡å‡†ï¼‰</li><li>ECCï¼ˆElliptic Curves Cryptographyï¼‰<strong>ï¼šæ¤­åœ†æ›²çº¿åŠ å¯†</strong></li></ul></li><li><p><strong>éå¯¹ç§°åŠ å¯†ä¼˜ç¼ºç‚¹</strong></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š å¯ä»¥æ›´å®‰å…¨åœ°å°†å…¬å¼€å¯†é’¥ä¼ è¾“ç»™é€šä¿¡å‘é€æ–¹ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼š è¿ç®—é€Ÿåº¦æ…¢ã€‚</li></ul></li></ul><h4 id="10-å…¬é’¥åŠ å¯†â€“ç§é’¥è§£å¯†ä¸å…¬é’¥è§£å¯†â€“ç§é’¥åŠ å¯†æœ‰ä»€ä¹ˆåŒºåˆ«">10.<strong>å…¬é’¥åŠ å¯†â€“ç§é’¥è§£å¯†ä¸å…¬é’¥è§£å¯†â€“ç§é’¥åŠ å¯†æœ‰ä»€ä¹ˆåŒºåˆ«?</strong></h4><p>ä¸»è¦æ˜¯åº”ç”¨åœºæ™¯ä¸åŒã€‚</p><ul><li><p>åŠ è§£å¯†ï¼šå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</p><blockquote><p>ä¸å¸Œæœ›åˆ«äººçŸ¥é“æˆ‘çš„æ¶ˆæ¯ï¼Œ<u>æ‰€ä»¥åªæœ‰æˆ‘æ‰èƒ½è§£å¯†</u>ï¼Œæ‰€ä»¥å¯å¾—å‡ºå…¬é’¥è´Ÿè´£åŠ å¯†ï¼Œç§é’¥è´Ÿè´£è§£å¯†</p></blockquote></li><li><p>ç­¾åï¼šç§é’¥ç­¾åï¼Œå…¬é’¥éªŒç­¾</p><blockquote><p>æ˜¯ä¸å¸Œæœ›æœ‰äººå†’å……æˆ‘å‘æ¶ˆæ¯ï¼Œåªæœ‰<u>æˆ‘æ‰èƒ½å‘å¸ƒè¿™ä¸ªç­¾å</u>ï¼Œæ‰€ä»¥å¯å¾—å‡ºç§é’¥è´Ÿè´£ç­¾åï¼Œå…¬é’¥è´Ÿè´£éªŒè¯</p></blockquote></li><li><p><strong>httpså¯ä»¥åªæœ‰éå¯¹ç§°åŠ å¯†å—?</strong></p><p>https<u>éªŒè¯è¯ä¹¦é˜¶æ®µæ˜¯éå¯¹ç§°åŠ å¯†</u>ï¼Œä½†æ˜¯åœ¨æ•°æ®ä¼ è¾“é˜¶æ®µæ˜¯å¯¹ç§°åŠ å¯†ã€‚<strong>httpsä¸å¯ä»¥åªæœ‰éå¯¹ç§°åŠ å¯†</strong>ï¼š</p><ul><li><strong>éå¯¹ç§°åŠ å¯†</strong>çš„åŠ è§£å¯†<strong>æ•ˆç‡æ˜¯éå¸¸ä½</strong>çš„ï¼Œè€Œ http çš„åº”ç”¨åœºæ™¯ä¸­é€šå¸¸ç«¯ä¸ç«¯ä¹‹é—´å­˜åœ¨å¤§é‡çš„äº¤äº’ï¼Œéå¯¹ç§°åŠ å¯†çš„æ•ˆç‡æ˜¯æ— æ³•æ¥å—çš„ï¼›</li><li>åœ¨ HTTPS çš„åœºæ™¯ä¸­åªæœ‰æœåŠ¡ç«¯ä¿å­˜äº†ç§é’¥ï¼Œä¸€å¯¹å…¬ç§é’¥åªèƒ½å®ç°å•å‘çš„åŠ è§£å¯†ï¼Œæ‰€ä»¥HTTPS ä¸­å†…å®¹ä¼ è¾“åŠ å¯†é‡‡å–çš„æ˜¯å¯¹ç§°åŠ å¯†ï¼Œè€Œä¸æ˜¯éå¯¹ç§°åŠ å¯†ã€‚</li></ul></li></ul><h4 id="11-HTTPS-ä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦CAè¯ä¹¦ï¼Ÿåªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼ŸHTTPS-ç»å¯¹å®‰å…¨å—ï¼Ÿ">11. <strong>HTTPS ä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦CAè¯ä¹¦ï¼Ÿåªæœ‰è®¤è¯æœºæ„å¯ä»¥ç”Ÿæˆè¯ä¹¦å—ï¼ŸHTTPS ç»å¯¹å®‰å…¨å—ï¼Ÿ</strong></h4><ul><li><p><strong>å®‰å…¨</strong>ï¼šå› ä¸º HTTPS ä¿è¯äº†ä¼ è¾“å®‰å…¨ï¼Œé˜²æ­¢ä¼ è¾“è¿‡ç¨‹è¢«ç›‘å¬ã€é˜²æ­¢æ•°æ®è¢«çªƒå–ï¼Œå¯ä»¥ç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ï¼›</p></li><li><p><strong>CAè¯ä¹¦</strong>ï¼š <u>HTTP åè®®è¢«è®¤ä¸ºä¸å®‰å…¨æ˜¯å› ä¸ºä¼ è¾“è¿‡ç¨‹å®¹æ˜“è¢«ç›‘å¬è€…å‹¾çº¿ç›‘å¬ã€ä¼ªé€ æœåŠ¡å™¨</u>ï¼Œè€Œ HTTPS åè®®ä¸»è¦è§£å†³çš„ä¾¿æ˜¯ç½‘ç»œä¼ è¾“çš„å®‰å…¨æ€§é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦CAè¯ä¹¦</p></li><li><p><strong>è¯ä¹¦ç”Ÿæˆ</strong>ï¼š å¦‚æœéœ€è¦æµè§ˆå™¨ä¸æç¤ºå®‰å…¨é£é™©ï¼Œé‚£åªèƒ½ä½¿ç”¨è®¤è¯æœºæ„ç­¾å‘çš„è¯ä¹¦ã€‚ä½†<strong>æµè§ˆå™¨é€šå¸¸åªæ˜¯æç¤ºå®‰å…¨é£é™©ï¼Œå¹¶ä¸é™åˆ¶ç½‘ç«™ä¸èƒ½è®¿é—®</strong>ï¼Œæ‰€ä»¥ä»æŠ€æœ¯ä¸Š<strong>è°éƒ½å¯ä»¥ç”Ÿæˆè¯ä¹¦</strong>ï¼Œåªè¦æœ‰è¯ä¹¦å°±å¯ä»¥å®Œæˆç½‘ç«™çš„ HTTPS ä¼ è¾“ã€‚</p></li><li><p><strong>ä¸ç»å¯¹å®‰å…¨</strong>ï¼š ä¸æ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œå¯ä»¥é€šè¿‡ä¸­é—´äººæ”»å‡»ã€‚</p><blockquote><p>CAè¯ä¹¦ä¸æ˜¯å¯ä»¥è§£å†³â€œä¸­é—´äººâ€å—ï¼Ÿ</p></blockquote><p>è¿‡ç¨‹åŸç†ï¼š</p><ol><li>æœ¬åœ°è¯·æ±‚è¢«åŠ«æŒï¼ˆ<u>å¦‚DNSåŠ«æŒç­‰</u>ï¼‰ï¼Œæ‰€æœ‰è¯·æ±‚å‡å‘é€åˆ°ä¸­é—´äººçš„æœåŠ¡å™¨</li><li>ä¸­é—´äººæœåŠ¡å™¨è¿”å›ä¸­é—´äººè‡ªå·±çš„è¯ä¹¦ï¼ˆ<strong>ä½†æ˜¯è¿™ä¸€æ­¥æœåŠ¡å™¨ä¸æ˜¯ä¼šå¯¹æœåŠ¡å™¨è¯ä¹¦è¿›è¡ŒéªŒè¯å—ï¼Ÿ</strong>ï¼‰</li><li>å®¢æˆ·ç«¯åˆ›å»ºéšæœºæ•°ï¼Œé€šè¿‡ä¸­é—´äººè¯ä¹¦çš„å…¬é’¥å¯¹éšæœºæ•°åŠ å¯†åä¼ é€ç»™ä¸­é—´äººï¼Œç„¶åå‡­éšæœºæ•°æ„é€ å¯¹ç§°åŠ å¯†å¯¹ä¼ è¾“å†…å®¹è¿›è¡ŒåŠ å¯†ä¼ è¾“</li><li>ä¸­é—´äººå› ä¸ºæ‹¥æœ‰å®¢æˆ·ç«¯çš„éšæœºæ•°ï¼Œå¯ä»¥é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡Œå†…å®¹è§£å¯†</li><li>ä¸­é—´äººä»¥å®¢æˆ·ç«¯çš„è¯·æ±‚å†…å®¹å†å‘å®˜æ–¹ç½‘ç«™å‘èµ·è¯·æ±‚</li><li>å› ä¸ºä¸­é—´äººä¸æœåŠ¡å™¨çš„é€šä¿¡è¿‡ç¨‹æ˜¯åˆæ³•çš„ï¼Œå®˜æ–¹ç½‘ç«™é€šè¿‡å»ºç«‹çš„å®‰å…¨é€šé“è¿”å›åŠ å¯†åçš„æ•°æ®</li><li>ä¸­é—´äººå‡­å€Ÿä¸å®˜æ–¹ç½‘ç«™å»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹å†…å®¹è¿›è¡Œè§£å¯†</li><li>ä¸­é—´äººé€šè¿‡ä¸å®¢æˆ·ç«¯å»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹å®˜æ–¹å†…å®¹è¿”å›çš„æ•°æ®è¿›è¡ŒåŠ å¯†ä¼ è¾“</li><li>å®¢æˆ·ç«¯é€šè¿‡ä¸ä¸­é—´äººå»ºç«‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹è¿”å›ç»“æœæ•°æ®è¿›è¡Œè§£å¯†</li></ol></li></ul><h4 id="12-httpåº”ç­”ç ä¸­çš„301-2-4ã€500ã€502ã€503ã€504çŠ¶æ€ç è¿›è¡Œè§£é‡Šï¼Ÿ">12. <strong>httpåº”ç­”ç ä¸­çš„301/2/4ã€500ã€502ã€503ã€504çŠ¶æ€ç è¿›è¡Œè§£é‡Š</strong>ï¼Ÿ</h4><ul><li><p><strong>200ï¼š</strong>  è¯·æ±‚æˆåŠŸã€‚</p></li><li><p><img src="https://i.loli.net/2021/04/21/MRi5Oy9Ltd3v8uA.png" alt="image-20210421150625709"></p></li><li><p><strong>500ï¼š</strong> 500 (<strong>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</strong>) æœåŠ¡å™¨é‡åˆ°é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚ ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨<strong>æ— æ³•è¯†åˆ«è¯·æ±‚æ–¹æ³•</strong>æ—¶å¯èƒ½ä¼šè¿”å›æ­¤ä»£ç ã€‚</p></li><li><p><strong>501ï¼š<strong>æœåŠ¡å™¨</strong>ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½</strong>ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</p></li><li><p><strong>502ï¼š</strong> ä½œä¸º<strong>ç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨</strong>å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»<u>ä¸Šæ¸¸æœåŠ¡å™¨</u>æ¥æ”¶åˆ°<strong>æ— æ•ˆ</strong>çš„å“åº”ã€‚</p></li><li><p><strong>503ï¼š</strong> ç”±äºè¶…è½½æˆ–ç³»ç»Ÿç»´æŠ¤ï¼ŒæœåŠ¡å™¨æš‚æ—¶çš„<strong>æ— æ³•å¤„ç†å®¢æˆ·ç«¯</strong>çš„è¯·æ±‚ã€‚</p></li><li><p><strong>504(åŠæ—¶)</strong>ï¼šä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œ<strong>æœªèƒ½åŠæ—¶</strong>ä»ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆURIæ ‡è¯†å‡ºçš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚HTTPã€FTPã€LDAPï¼‰æˆ–è€…è¾…åŠ©æœåŠ¡å™¨ï¼ˆä¾‹å¦‚DNSï¼‰æ”¶åˆ°å“åº”ã€‚</p></li></ul><h4 id="13-ä»‹ç»ä¸€ä¸‹httpè¯·æ±‚getã€postç­‰ï¼Ÿ">13.<strong>ä»‹ç»ä¸€ä¸‹httpè¯·æ±‚getã€postç­‰</strong>ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/04/21/WRLspE4fvjdKq8F.png" alt="image-20210421140204266"></p><p><strong>é‡ç‚¹åŒºåˆ†ä¸€ä¸‹getå’Œpostï¼š</strong></p><ul><li><p><code>get</code> ï¼šGETæ–¹æ³•ç”¨äºä½¿ç”¨ç»™å®šçš„URIä»ç»™å®šæœåŠ¡å™¨ä¸­<u>æ£€ç´¢ä¿¡æ¯</u>ï¼Œå³ä»æŒ‡å®šèµ„æºä¸­è¯·æ±‚æ•°æ®ã€‚</p><ul><li><strong>GETè¯·æ±‚æ˜¯å¯ä»¥ç¼“å­˜çš„</strong>ï¼Œæµè§ˆå™¨å†å²è®°å½•ä¸­æŸ¥æ‰¾åˆ°GETè¯·æ±‚ï¼›<strong>é•¿åº¦æœ‰é™åˆ¶</strong>ï¼›ä¸å®‰å…¨ï¼Œ<strong>urlä¼šæš´éœ²è¯·æ±‚çš„å‚æ•°</strong></li></ul></li><li><p><code>post</code>ï¼šPOSTæ–¹æ³•ç”¨äºå°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ä»¥<u>åˆ›å»ºæˆ–æ›´æ–°èµ„æº</u> ã€‚</p><ul><li><strong>POSTè¯·æ±‚ä¸ä¼šè¢«ç¼“å­˜</strong>ï¼›<strong>é•¿åº¦æ— é™åˆ¶</strong>ï¼›æ›´å®‰å…¨</li></ul></li><li><p><strong>ç‰¹åˆ«çš„ï¼š<code>GETäº§ç”Ÿä¸€ä¸ªTCPæ•°æ®åŒ…;POSTäº§ç”Ÿä¸¤ä¸ªTCPæ•°æ®åŒ…ã€‚</code></strong></p><ul><li><p>getï¼šhttp headerå’Œbodyä¸€å¹¶å‘é€å‡ºå» ï¼›</p></li><li><p>postï¼šæµè§ˆå™¨å…ˆå‘é€headerï¼ŒæœåŠ¡å™¨å“åº”100 continueï¼Œæµè§ˆå™¨å†å‘é€body ã€‚</p><blockquote><p>âš ï¸ postæ˜¯ä¸ä¸€å®šä¼šå‘ç”Ÿä¸¤ä¸ªçš„ã€‚</p><ul><li>HTTP åè®®ä¸­æ²¡æœ‰æ˜ç¡®è¯´æ˜ POST ä¼šäº§ç”Ÿä¸¤ä¸ª TCP æ•°æ®åŒ…ï¼Œè€Œä¸”å®é™…æµ‹è¯•(Chrome)å‘ç°ï¼Œheader å’Œ body ä¸ä¼šåˆ†å¼€å‘é€ï¼›</li><li>header å’Œ body åˆ†å¼€å‘é€<strong>æ˜¯éƒ¨åˆ†æµè§ˆå™¨æˆ–æ¡†æ¶çš„è¯·æ±‚æ–¹æ³•</strong>ï¼Œä¸å±äº post å¿…ç„¶è¡Œä¸ºã€‚</li></ul></blockquote></li></ul></li></ul><h5 id="13-1-Getæ–¹æ³•é•¿åº¦æœ‰é™åˆ¶æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ">13.1 Getæ–¹æ³•é•¿åº¦æœ‰é™åˆ¶æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</h5><p>HTTP åè®®æ²¡æœ‰ Body å’Œ URL çš„é•¿åº¦é™åˆ¶ï¼Œ<strong>å¯¹ URL é™åˆ¶çš„å¤§å¤šæ˜¯æµè§ˆå™¨ / æœåŠ¡å™¨çš„åŸå› </strong>ã€‚</p><ul><li>æœåŠ¡å™¨æ˜¯å› ä¸ºå¤„ç†é•¿ URL è¦æ¶ˆè€—æ¯”è¾ƒå¤šçš„èµ„æºï¼Œä¸ºäº†æ€§èƒ½å’Œå®‰å…¨ï¼ˆé˜²æ­¢æ¶æ„æ„é€ é•¿ URL æ¥æ”»å‡»ï¼‰è€ƒè™‘ï¼Œä¼šç»™ URL é•¿åº¦åŠ é™åˆ¶ï¼›</li><li>æµè§ˆå™¨ä¹Ÿä¼šè®¾ç½®urlæœ‰é™ã€‚</li></ul><h5 id="13-2-POST-æ–¹æ³•ç›¸æ¯”GETæ–¹æ³•æ˜¯ç»å¯¹å®‰å…¨å—ï¼Ÿ">13.2 POST æ–¹æ³•ç›¸æ¯”GETæ–¹æ³•æ˜¯ç»å¯¹å®‰å…¨å—ï¼Ÿ</h5><ul><li>POST æ¯” GET å®‰å…¨ï¼Œå› ä¸ºæ•°æ®åœ¨åœ°å€æ ä¸Šä¸å¯è§ï¼›</li><li><strong>POSTä¸æ˜¯ç»å¯¹å®‰å…¨</strong>ï¼Œä»ä¼ è¾“çš„è§’åº¦æ¥è¯´ï¼Œä»–ä»¬éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸º HTTP åœ¨ç½‘ç»œä¸Šæ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œåªè¦åœ¨ç½‘ç»œèŠ‚ç‚¹ä¸Šæ‰åŒ…ï¼Œå°±èƒ½å®Œæ•´åœ°è·å–æ•°æ®æŠ¥æ–‡ã€‚</li></ul><p>æƒ³è¦å®‰å…¨ï¼Œåªæœ‰ä½¿ç”¨<strong>HTTPS</strong>ã€‚</p><h4 id="14-HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®-å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€">14.  HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®,å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€?</h4><p>Cookie å’Œ Sessionéƒ½æ˜¯ç”¨æ¥è·Ÿè¸ªæµè§ˆå™¨ç”¨æˆ·èº«ä»½çš„ä¼šè¯æ–¹å¼ï¼Œä½†æ˜¯ä¸¤è€…çš„åº”ç”¨åœºæ™¯ä¸å¤ªâ¼€æ ·ã€‚</p><ul><li><strong>Cookie â¼€èˆ¬ç”¨æ¥ä¿å­˜ç”¨æˆ·<u>ä¿¡æ¯</u></strong><ul><li>æˆ‘ä»¬åœ¨ Cookie ä¸­<strong>ä¿å­˜å·²ç»ç™»å½•è¿‡å¾—ç”¨æˆ·ä¿¡æ¯</strong>ï¼Œä¸‹æ¬¡è®¿é—®ç½‘ç«™çš„æ—¶å€™é¡µé¢å¯ä»¥â¾ƒåŠ¨å¸®ä½ ç™»å½•çš„â¼€äº›åŸºæœ¬ä¿¡æ¯ç»™å¡«äº†ï¼›</li><li>â¼€èˆ¬çš„ç½‘ç«™éƒ½ä¼šæœ‰<strong>ä¿æŒç™»å½•</strong>ä¹Ÿå°±æ˜¯è¯´ä¸‹æ¬¡ä½ å†è®¿é—®ç½‘ç«™çš„æ—¶å€™å°±ä¸éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œè¿™æ˜¯å› ä¸ºç”¨æˆ·ç™»å½•çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥<strong>å­˜æ”¾äº†â¼€ä¸ª Token åœ¨ Cookie</strong>ä¸­ï¼Œä¸‹æ¬¡ç™»å½•çš„æ—¶å€™åªéœ€è¦æ ¹æ® Token å€¼æ¥æŸ¥æ‰¾ç”¨æˆ·å³å¯(ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œé‡æ–°ç™»å½•â¼€èˆ¬è¦å°† Token<br>é‡å†™)ï¼›</li><li>ç™»å½•â¼€æ¬¡ç½‘ç«™åè®¿é—®ç½‘ç«™å…¶ä»–é¡µé¢ä¸éœ€è¦é‡æ–°ç™»å½•ã€‚</li></ul></li><li><strong>Session çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„<u>çŠ¶æ€</strong></u>ã€‚<ul><li><strong>å…¸å‹çš„åœºæ™¯æ˜¯è´­ç‰©â»‹</strong>ï¼Œå½“ä½ è¦æ·»åŠ å•†å“åˆ°è´­ç‰©â»‹çš„æ—¶å€™ï¼Œç³»ç»Ÿä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œå› ä¸º HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€‚æœåŠ¡ç«¯ç»™ç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºç‰¹å®šçš„ Session ä¹‹åå°±å¯ä»¥æ ‡è¯†è¿™ä¸ªç”¨æˆ·å¹¶ä¸”è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·äº†ã€‚</li><li><strong>æ—¢ç„¶ Session å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç° Session è·Ÿè¸ªå‘¢</strong>ï¼Ÿå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡åœ¨Cookie ä¸­é™„åŠ â¼€ä¸ª Session ID æ¥æ–¹å¼æ¥è·Ÿè¸ªã€‚</li></ul></li></ul><h4 id="15-cookie-ã€sessionçš„ä½œç”¨å’ŒåŒºåˆ«ï¼Ÿ">15. <strong>cookie ã€sessionçš„ä½œç”¨å’ŒåŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><p><strong>Cookie</strong></p><ul><li><p><strong>ä½œç”¨</strong>ï¼š æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨<u>æµè§ˆå™¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Š</u>ã€‚é€šå¸¸ï¼Œå®ƒç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ï¼Œå¦‚ä¿æŒç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚</p><blockquote><p>Cookie ä½¿åŸºäºæ— çŠ¶æ€çš„ HTTP åè®®è®°å½•ç¨³å®šçš„çŠ¶æ€ä¿¡æ¯æˆä¸ºäº†å¯èƒ½ã€‚</p></blockquote></li></ul></li><li><p><strong>Session</strong></p><ul><li><strong>ä½œç”¨</strong>ï¼š Session ä»£è¡¨ç€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯<strong>ä¸€æ¬¡ä¼šè¯çš„è¿‡ç¨‹</strong>ï¼ŒSession <u>å¯¹è±¡å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯</u>ã€‚</li></ul></li><li><p><strong>äºŒè€…åŒºåˆ«</strong></p><ul><li><strong>ä½œç”¨èŒƒå›´ä¸åŒ</strong>ï¼ŒCookie ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ï¼ŒSession ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼›</li><li><strong>æœ‰æ•ˆæœŸä¸åŒ</strong>ï¼ŒCookie å¯è®¾ç½®ä¸ºé•¿æ—¶é—´ä¿æŒï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„é»˜è®¤ç™»å½•åŠŸèƒ½ï¼ŒSession ä¸€èˆ¬å¤±æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­æˆ–è€… Session è¶…æ—¶éƒ½ä¼šå¤±æ•ˆï¼›</li><li><strong>å®‰å…¨æ€§</strong>ï¼š Cookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæ¯”è¾ƒå®¹æ˜“é­åˆ°ä¸æ³•è·å–ï¼Œæ—©æœŸæœ‰äººå°†ç”¨æˆ·çš„ç™»å½•åå’Œå¯†ç å­˜å‚¨åœ¨ Cookie ä¸­å¯¼è‡´ä¿¡æ¯è¢«çªƒå–ï¼›Session å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå®‰å…¨æ€§ç›¸å¯¹ Cookie è¦å¥½ä¸€äº›ï¼›</li><li><strong>å­˜å‚¨å¤§å°ä¸åŒ</strong>ï¼š  <u>å•ä¸ª Cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4K</u>ï¼ŒSession å¯å­˜å‚¨æ•°æ®è¿œé«˜äº Cookieï¼›</li><li><strong>å­˜å–ç±»å‹çš„ä¸åŒ</strong>ï¼ŒCookie åªèƒ½ä¿å­˜ ASCIIï¼ŒSession å¯ä»¥å­˜ä»»æ„æ•°æ®ç±»å‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥åœ¨ Session ä¸­ä¿æŒä¸€äº›å¸¸ç”¨å˜é‡ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ UserId ç­‰ã€‚</li></ul></li></ul><h5 id="15-1-Sessionçš„å…±äº«æ–¹å¼ï¼Ÿï¼ˆå¥½æœªæ¥é—®è¿‡ï¼‰">15.1 Sessionçš„å…±äº«æ–¹å¼ï¼Ÿï¼ˆå¥½æœªæ¥é—®è¿‡ï¼‰</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/jing99/p/11785070.html">Sessionå¦‚ä½•å…±äº«</a></p></blockquote><ul><li><p><strong>é—®é¢˜æè¿°</strong></p><ol><li>åœ¨é›†ç¾¤ç¯å¢ƒä¸­ï¼Œå‡è®¾å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡Aï¼ŒæœåŠ¡Aå“åº”è¿”å›äº†ä¸€ä¸ªsessionIdå¹¶ä¸”å­˜å…¥äº†æœ¬åœ°Cookieä¸­ã€‚ç¬¬äºŒæ¬¡ä¸è®¿é—®æœåŠ¡Aäº†ï¼Œè½¬å»è®¿é—®æœåŠ¡Bï¼›</li><li>è®¿é—®æœåŠ¡Bçš„æ—¶å€™ï¼Œä¼šå°†sessionIdåŠ å…¥åˆ°è¯·æ±‚å¤´ä¸­ï¼Œè€ŒæœåŠ¡Bå› ä¸ºé€šè¿‡sessionIdæ²¡æœ‰æ‰¾åˆ°ç›¸å¯¹åº”çš„æ•°æ®ï¼Œå› æ­¤å®ƒå°±ä¼š<strong>åˆ›å»ºä¸€ä¸ªæ–°çš„sessionIdå¹¶ä¸”å“åº”è¿”å›ç»™å®¢æˆ·ç«¯</strong></li></ol><p>è¿™æ ·å°±é€ æˆäº†ä¸èƒ½å…±äº«Sessionçš„é—®é¢˜ã€‚</p></li><li><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><ol><li><strong>ä½¿ç”¨Cookieå®ç°</strong>ã€‚ å°†ç³»ç»Ÿç”¨æˆ·çš„Sessionä¿¡æ¯åŠ å¯†ã€åºåˆ—åŒ–åï¼Œä»¥Cookieçš„æ–¹å¼ï¼Œ ç»Ÿä¸€ç§æ¤åœ¨æ ¹åŸŸåä¸‹ï¼ˆå¦‚ï¼š.host.comï¼‰ï¼Œåˆ©ç”¨æµè§ˆå™¨è®¿é—®è¯¥æ ¹åŸŸåä¸‹çš„æ‰€æœ‰äºŒçº§åŸŸåç«™ç‚¹æ—¶ï¼Œä¼šä¼ é€’ä¸ä¹‹åŸŸåå¯¹åº”çš„æ‰€æœ‰Cookieå†…å®¹çš„ç‰¹æ€§ï¼Œä»è€Œå®ç°ç”¨æˆ·çš„CookieåŒ–Sessionåœ¨å¤šæœåŠ¡é—´çš„å…±äº«è®¿é—®ã€‚</li><li><strong>æ•°æ®åº“åŒæ­¥sessionã€‚</strong>  æ¯æ¬¡å°†sessionæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ã€‚è¿™ä¸ªæ–¹æ¡ˆè¿˜æ˜¯æ¯”è¾ƒå¯è¡Œçš„ã€‚<ul><li><strong>ç¼ºç‚¹</strong>ï¼š Sessionçš„å¹¶å‘è¯»å†™èƒ½åŠ›å–å†³äºMySQLæ•°æ®åº“çš„æ€§èƒ½ï¼Œå¯¹æ•°æ®åº“çš„å‹åŠ›å¤§ï¼ŒåŒæ—¶éœ€è¦è‡ªå·±å®ç°Sessionæ·˜æ±°é€»è¾‘ï¼Œä»¥ä¾¿å®šæ—¶ä»æ•°æ®è¡¨ä¸­æ›´æ–°ã€åˆ é™¤ Sessionè®°å½•ï¼Œå½“å¹¶å‘è¿‡é«˜æ—¶å®¹æ˜“å‡ºç°è¡¨é”ã€‚</li></ul></li><li><strong>ä½¿ç”¨tokenä»£æ›¿sessionã€‚</strong> å°±æ˜¯Tokenæ–¹å¼æ›¿ä»£äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡è§£å†³ã€‚</li><li><strong>Spring-Sesionå®ç°</strong> ã€‚å°†åŸæœ¬éœ€è¦ç”±WebæœåŠ¡å™¨åˆ›å»ºä¼šè¯çš„è¿‡ç¨‹è½¬äº¤ç»™Spring-Sessionè¿›è¡Œåˆ›å»ºã€‚Spring-Sessionä¼šå°†åŸæœ¬åº”è¯¥ä¿å­˜åœ¨WebæœåŠ¡å™¨å†…å­˜çš„Sessionå­˜æ”¾åˆ°Redisä¸­ã€‚ç„¶å<strong>WebæœåŠ¡å™¨ä¹‹é—´é€šè¿‡è¿æ¥Redisæ¥å…±äº«æ•°æ®</strong>ï¼Œè¾¾åˆ°Sessonå…±äº«çš„ç›®çš„ã€‚</li></ol></li></ul><h4 id="16-Cookie-å’Œ-Sessionæœ‰ä»€ä¹ˆå…³è”ï¼Ÿï¼ˆé—®è¿‡ï¼‰tokenæœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¼˜ç‚¹ï¼Œï¼ˆJWTï¼‰ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ">16.  Cookie å’Œ Sessionæœ‰ä»€ä¹ˆå…³è”ï¼Ÿï¼ˆé—®è¿‡ï¼‰tokenæœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¼˜ç‚¹ï¼Œï¼ˆJWTï¼‰ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844904009061367821">ä¸€æ–‡å½»åº•ææ‡‚Cookieã€Sessionã€Tokenåˆ°åº•æ˜¯ä»€ä¹ˆ</a></p></blockquote><ul><li><p><strong>ä¸ºä»€ä¹ˆéœ€è¦sessionï¼Ÿ</strong></p><blockquote><p>æ—¢ç„¶æµè§ˆå™¨å·²ç»é€šè¿‡<code>Cookie</code>å®ç°äº†æœ‰çŠ¶æ€è¿™ä¸€éœ€æ±‚ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆåˆæ¥äº†ä¸€ä¸ª<code>Session</code>å‘¢ï¼Ÿ</p></blockquote><p>å¦‚æœå°†è´¦æˆ·çš„ä¸€äº›é‡è¦ä¿¡æ¯éƒ½å­˜å…¥<code>Cookie</code>ä¸­çš„è¯ï¼Œä¸€æ—¦<strong>è¢«æ‹¦æˆª</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰€æœ‰çš„è´¦æˆ·ä¿¡æ¯éƒ½ä¼šä¸¢å¤±æ‰ã€‚æ‰€ä»¥å°±å‡ºç°äº†<code>Session</code>ï¼Œåœ¨ä¸€æ¬¡ä¼šè¯ä¸­å°†é‡è¦ä¿¡æ¯ä¿å­˜åœ¨<code>Session</code>ä¸­ï¼Œæµè§ˆå™¨åªè®°å½•<code>SessionId</code>ä¸€ä¸ª<code>SessionId</code>å¯¹åº”ä¸€æ¬¡ä¼šè¯è¯·æ±‚ã€‚</p></li><li><p><strong>sessionå’ŒcookieäºŒè€…å…³è”</strong></p><p><img src="https://i.loli.net/2021/05/04/jNerb9CXZ6Jpgs2.jpg" alt="img"></p><blockquote><p>ä»¥ç”¨æˆ·ä¸€æ¬¡ç™»å½•ä¸ºä¾‹ã€‚</p></blockquote><ol><li>ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œç”¨æˆ·æäº¤åŒ…å«<strong>ç”¨æˆ·åå’Œå¯†ç </strong>çš„è¡¨å•ï¼Œæ”¾å…¥ HTTP è¯·æ±‚æŠ¥æ–‡ä¸­ï¼›</li><li>æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæ­£ç¡®åˆ™æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° <strong>Redis</strong> ä¸­ï¼Œå®ƒåœ¨ Redis ä¸­çš„ Key ç§°ä¸º Session IDï¼›å¹¶å°†æ­¤ Session çš„å”¯ä¸€æ ‡è¯†ä¿¡æ¯ SessionID è¿”å›ç»™æµè§ˆå™¨ï¼›</li><li>æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ SessionID ä¿¡æ¯åï¼Œä¼šå°†æ­¤ä¿¡æ¯å­˜å…¥åˆ° Cookie ä¸­ï¼ŒåŒæ—¶ Cookie è®°å½•æ­¤ SessionID å±äºå“ªä¸ªåŸŸåï¼›</li><li>å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨åˆ¤æ–­<u>æ­¤åŸŸåä¸‹æ˜¯å¦å­˜åœ¨ Cookie ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨è‡ªåŠ¨å°† Cookie ä¿¡æ¯ä¹Ÿå‘é€ç»™æœåŠ¡ç«¯</u>ï¼›</li><li>æœåŠ¡ç«¯ä¼šä» Cookie ä¸­è·å– SessionIDï¼Œå†æ ¹æ® SessionID æŸ¥æ‰¾å¯¹åº”çš„ <u>Session ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆ–è€…ç™»å½•å¤±æ•ˆ</u>ï¼Œå¦‚æœæ‰¾åˆ° Session è¯æ˜ç”¨æˆ·å·²ç»ç™»å½•å¯æ‰§è¡Œåé¢æ“ä½œã€‚</li></ol></li><li><p><strong>ä»€ä¹ˆæ˜¯Tokenï¼Ÿ</strong></p><blockquote><p><code>Session</code>æ˜¯å°†è¦éªŒè¯çš„ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå¹¶ä»¥<code>SessionId</code>å’Œæ•°æ®è¿›è¡Œå¯¹åº”ï¼Œ<code>SessionId</code>ç”±å®¢æˆ·ç«¯å­˜å‚¨ï¼Œåœ¨è¯·æ±‚æ—¶å°†<code>SessionId</code>ä¹Ÿå¸¦è¿‡å»ï¼Œå› æ­¤å®ç°äº†çŠ¶æ€çš„å¯¹åº”ã€‚</p></blockquote><p>ä½†æ˜¯ï¼Œè€Œ<code>Token</code>æ˜¯åœ¨æœåŠ¡ç«¯å°†<strong>ç”¨æˆ·ä¿¡æ¯ç»è¿‡Base64Urlã€ç¼–ç ï¼Œä¸æ˜¯åŠ å¯†ã€‘è¿‡åä¼ ç»™åœ¨å®¢æˆ·ç«¯</strong>ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™éƒ½ä¼šå¸¦ä¸Šè¿™ä¸€æ®µä¿¡æ¯ï¼Œå› æ­¤æœåŠ¡ç«¯æ‹¿åˆ°æ­¤ä¿¡æ¯è¿›è¡Œè§£å¯†åå°±çŸ¥é“æ­¤ç”¨æˆ·æ˜¯è°äº†ã€‚</p><p>è¿™ä¸ªæ–¹æ³•å«åš<strong>JWT(Json Web Token)</strong>ã€‚</p><blockquote><p>ä¸€ä¸ªä¾‹å­ç†è§£ï¼šåŸºäºTokençš„èº«ä»½éªŒè¯æµç¨‹ï¼Œåœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨ç”¨æˆ·çš„ç™»å½•è®°å½• ã€‚</p><ol><li><p>å®¢æˆ·ç«¯<strong>ä½¿ç”¨ç”¨æˆ·åè·Ÿå¯†</strong>ç è¯·æ±‚ç™»å½•</p></li><li><p>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå»éªŒè¯ç”¨æˆ·åä¸å¯†ç </p></li><li><p>éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼š<strong>ç­¾å‘ä¸€ä¸ª Token</strong>ï¼Œå†æŠŠè¿™ä¸ª Token å‘é€ç»™å®¢æˆ·ç«¯</p><blockquote><p>Tokenåœ¨æœåŠ¡å™¨ç«¯ï¼Œå¯ä»¥ä¿å­˜åœ¨Redisç¼“å­˜ä¸­ã€‚</p></blockquote></li><li><p>å®¢æˆ·ç«¯æ”¶åˆ° Token ä»¥åå¯ä»¥æŠŠå®ƒå­˜å‚¨èµ·æ¥ï¼Œæ¯”å¦‚<strong>æ”¾åœ¨ Cookie é‡Œæˆ–è€… Local Storage</strong> é‡Œ</p></li><li><p>å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºçš„æ—¶å€™éœ€è¦å¸¦ç€æœåŠ¡ç«¯ç­¾å‘çš„ Token</p></li><li><p>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå»éªŒè¯å®¢æˆ·ç«¯è¯·æ±‚é‡Œé¢å¸¦ç€çš„ Tokenï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›è¯·æ±‚çš„æ•°æ®</p></li></ol></blockquote><ul><li><p><strong>Tokençš„ä¼˜ç‚¹</strong></p><ol><li><strong>æ— çŠ¶æ€ï¼Œå¯æ‰©å±•å’Œè§£è€¦</strong>ï¼š ä½¿ç”¨ token è€Œä¸æ˜¯ cookie çš„æœ€å¤§ä¼˜ç‚¹åº”è¯¥å°±æ˜¯æ— çŠ¶æ€ï¼Œ<strong>åç«¯ä¸éœ€è¦ä¿æŒå¯¹ token çš„è®°å½•ï¼Œæ¯ä¸ª token éƒ½æ˜¯ç‹¬ç«‹çš„</strong>ï¼ŒåŒ…å«äº†æ£€æŸ¥å…¶æœ‰æ•ˆæ€§çš„æ‰€æœ‰æ•°æ®ï¼Œå¹¶é€šè¿‡ç”³æ˜ä¼ è¾¾äº†ç”¨æˆ·ä¿¡æ¯ã€‚</li><li><strong>åœ¨ JWT ä¸­å­˜å‚¨æ•°æ®</strong> ï¼š å½“ä½¿ç”¨ cookie è¿›è¡ŒéªŒè¯æ—¶ï¼Œä½ æ˜¯å°† session id å­˜å‚¨åˆ° cookie é‡Œï¼ŒJWT å…è®¸ä½ å­˜å‚¨ä»»ä½•ç±»å‹çš„å…ƒæ•°æ®ï¼Œåªè¦æ˜¯åˆæ³•çš„ JSONã€‚</li><li><strong>è‡ªåŒ…å«</strong>ï¼šç”±äºä¸²åŒ…å«äº†ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“ã€‚</li></ol></li><li><p><strong>JWTä»‹ç»</strong></p><p>JWTæœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼šHeaderï¼ŒPayloadï¼ŒSignatureã€‚</p><p><img src="https://i.loli.net/2021/05/26/AC6ULh5293HQngE.png" alt="image-20210526214555872"></p><ul><li><p><strong>Headerï¼š</strong> ä¸€ä¸ªJsonå¯¹è±¡ï¼Œæè¿°JWTçš„å…ƒæ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸‹é¢è¿™æ ·å­çš„ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>, # ç­¾åçš„ç®—æ³•ä¸ºHS256</span><br><span class="line">  <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>    # Tokenç±»å‹ä¸ºJWT</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Payloadï¼š</strong> ä¹Ÿæ˜¯ä¸€ä¸ªJsonå¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ è¾“çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ä¸€äº›ç§æœ‰å­—æ®µï¼Œå¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;xiaoMing&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;age&quot;</span>: <span class="number">14</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Signature</strong>ï¼š <strong>å¯¹å‰é¢çš„ä¸¤éƒ¨åˆ†çš„æ•°æ®è¿›è¡Œç­¾å</strong>ï¼Œ<strong>é˜²æ­¢æ•°æ®ç¯¡æ”¹</strong> ã€‚</p><blockquote><p>é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ª<strong>ç§˜é’¥</strong>ï¼Œè¿™ä¸ªç§˜é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ï¼Œç„¶åä½¿ç”¨<strong>Headerä¸­æŒ‡å®šçš„ç­¾åç®—æ³•</strong>(é»˜è®¤æƒ…å†µæ˜¯HMAC SHA256)ã€‚ç®—å‡ºç­¾åä»¥åå°†Headerã€Payloadã€Signatureä¸‰éƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ<strong>æ¯ä¸ªéƒ¨åˆ†ç”¨<code>.</code>åˆ†å‰²å¼€æ¥</strong>ï¼Œå°±å¯ä»¥è¿”ç»™ç”¨æˆ·äº†ã€‚</p></blockquote></li></ul></li></ul></li></ul><h5 id="16-1-sessionå’Œcookieåº”è¯¥å¦‚ä½•å»é€‰æ‹©ï¼ˆé€‚ç”¨åœºæ™¯ï¼‰ï¼Ÿ">16.1 sessionå’Œcookieåº”è¯¥å¦‚ä½•å»é€‰æ‹©ï¼ˆé€‚ç”¨åœºæ™¯ï¼‰ï¼Ÿ</h5><ul><li>Cookie åªèƒ½å­˜å‚¨ ASCII ç å­—ç¬¦ä¸²ï¼Œè€Œ Session åˆ™å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå› æ­¤åœ¨<strong>è€ƒè™‘æ•°æ®å¤æ‚æ€§æ—¶é¦–é€‰ Session</strong>ï¼›</li><li>Cookie å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå®¹æ˜“è¢«æ¶æ„æŸ¥çœ‹ã€‚å¦‚æœéè¦å°†ä¸€äº›éšç§æ•°æ®å­˜åœ¨ Cookie ä¸­ï¼Œå¯ä»¥å°† Cookie å€¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿›è¡Œè§£å¯†ï¼›<strong>è€ƒè™‘å®‰å…¨è€ƒè™‘session</strong></li><li>å¯¹äºå¤§å‹ç½‘ç«™ï¼Œå¦‚æœç”¨æˆ·æ‰€æœ‰çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ Session ä¸­ï¼Œé‚£ä¹ˆå¼€é”€æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤<strong>ä¸å»ºè®®å°†æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Session ä¸­ï¼Œä¸€èˆ¬æ˜¯cookieå’Œsessioné…åˆä½¿ç”¨çš„</strong>ã€‚</li></ul><h4 id="17-è¯´è¯´HTTPã€TCPã€Socket-çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ">17.<strong>è¯´è¯´HTTPã€TCPã€Socket çš„å…³ç³»æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</h4><ul><li>TCP/IP ä»£è¡¨<u>ä¼ è¾“æ§åˆ¶åè®®/ç½‘é™…åè®®</u>ï¼ŒæŒ‡çš„æ˜¯ä¸€ç³»åˆ—åè®®æ—ï¼›</li><li>HTTP æœ¬èº«å°±æ˜¯ä¸€ä¸ªåè®®ï¼Œæ˜¯<u>ä» Web æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨</u>çš„ä¼ é€åè®®ï¼›</li><li><strong>Socket æ˜¯ TCP/IP ç½‘ç»œçš„ API</strong> ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé—¨é¢æ¨¡å¼ï¼Œå®ƒæŠŠå¤æ‚çš„ TCP/IP åè®®æ—éšè—åœ¨Socket æ¥å£åé¢ã€‚å¯¹ç”¨æˆ·æ¥è¯´ï¼Œä¸€ç»„ç®€å•çš„æ¥å£å°±æ˜¯å…¨éƒ¨ï¼Œè®© Socket å»ç»„ç»‡æ•°æ®ï¼Œä»¥ç¬¦åˆæŒ‡å®šçš„åè®®ã€‚</li></ul><h2 id="3-5-å…¶å®ƒ">3.5 å…¶å®ƒ</h2><h4 id="1-ä»‹ç»ä¸€ä¸‹CDN-ï¼Ÿ-CDNåˆ†å‘èŠ‚ç‚¹å„ä¸ªæ•°æ®éƒ½ä¸€æ ·å—ï¼Ÿ">1. ä»‹ç»ä¸€ä¸‹CDN ï¼Ÿ <strong>CDN</strong>åˆ†å‘èŠ‚ç‚¹å„ä¸ªæ•°æ®éƒ½ä¸€æ ·å—ï¼Ÿ</h4><ul><li><p><strong>CDNï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œ</strong></p><ul><li><p><strong>è§£å†³é™æ€ç½‘é¡µåŠ è½½</strong></p><p>ä¸åŒåœ°åŒºç”¨æˆ·è®¿é—®æœåŠ¡å™¨é€Ÿåº¦ä¸åŒï¼Œ<strong>å¯ä»¥æŠŠé™æ€ç½‘é¡µæ”¾åœ¨ä¸åŒåœ°åŒºçš„æœåŠ¡å™¨ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥å°±è¿‘å»è¿æ¥</strong>ï¼Œå¤§å¤§æå‡ä½“éªŒï¼›</p></li><li><p>å‘å±•è½¬æ¢æˆï¼Œ<strong>å°±è¿‘æ¥å…¥è§£å†³è®¿é—®ç½‘ç»œèµ„æº</strong></p><ol><li>å¦‚ä¸€ä¸ªç”µä¿¡ç”¨æˆ·é€è¯·æ±‚ï¼Œè¿›å…¥è§£æç³»ç»Ÿï¼Œä¼š<strong>è®©ç”¨æˆ·è¿æ¥åˆ°æœ€è¿‘çš„è¾¹ç¼˜èŠ‚ç‚¹</strong>ï¼Œç„¶åè¯·æ±‚æ•°æ®ï¼›</li><li>å¦‚æœè¾¹ç¼˜èŠ‚ç‚¹æ²¡æœ‰æ•°æ®ï¼Œåˆ™å»è®¿é—®<strong>æºèŠ‚ç‚¹</strong>ï¼›</li><li>æºèŠ‚ç‚¹ä¹Ÿæ²¡æœ‰ï¼Œå°±ä¼šå»è®¿é—®<strong>ä¸»å¹²èŠ‚ç‚¹ï¼Œå»è”é€šæœåŠ¡å™¨ä¸­æŸ¥æ‰¾ï¼›</strong></li><li>æœ€åè¿”å›æ•°æ®ã€‚</li></ol></li></ul></li><li><p><strong>CDNåˆ†å‘èŠ‚ç‚¹å„ä¸ªæ•°æ®ä¸ä¸€æ ·</strong></p><p>ä¸ä¸€æ ·ï¼Œå°±ç›¸å½“äºDNSæœåŠ¡å™¨<strong>ç¼“å­˜</strong>äº†äº›åŸŸåâ†’ipæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰çš„è¯è¿˜è¦å‘ä¸Šçº§æŸ¥è¯¢ï¼Œæœ€ç»ˆæŠŠæºç«™æ•°æ®æ‹‰ä¸‹æ¥ã€‚</p></li></ul><h4 id="2-ä»€ä¹ˆæ˜¯CDNä¸‰çº§æº¯æºï¼Ÿ">2.  ä»€ä¹ˆæ˜¯CDNä¸‰çº§æº¯æºï¼Ÿ</h4><ul><li><strong>CDNç›®çš„</strong>ã€‚CDN ç³»ç»Ÿè®¾è®¡çš„é¦–è¦ç›®æ ‡æ˜¯<strong>å°½é‡å‡å°‘ç”¨æˆ·çš„è®¿é—®å“åº”æ—¶é—´</strong></li><li><strong>CDNå®ç°æ€è·¯</strong>ã€‚ä¸ºè¾¾åˆ°è¿™ä¸€ç›®æ ‡ï¼ŒCDN ç³»ç»Ÿåº”è¯¥<strong>å°½é‡å°†ç”¨æˆ·æ‰€éœ€è¦çš„å†…å®¹å­˜æ”¾åœ¨è·ç¦»ç”¨æˆ·æœ€è¿‘çš„ä½ç½®</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè´Ÿè´£ä¸ºç”¨æˆ·æä¾›å†…å®¹æœåŠ¡çš„ <strong>Cacheè®¾å¤‡åº”éƒ¨ç½²åœ¨ç‰©ç†ä¸Šçš„ç½‘ç»œè¾¹ç¼˜ä½ç½®</strong>ï¼Œæˆ‘ä»¬ç§°è¿™ä¸€å±‚ä¸º CDNè¾¹ç¼˜å±‚ ã€‚</li><li><strong>CDNç³»ç»Ÿæ¶æ„</strong>ã€‚CDN ç³»ç»Ÿä¸­è´Ÿè´£å…¨å±€æ€§ç®¡ç†å’Œæ§åˆ¶çš„è®¾å¤‡ç»„æˆ ä¸­å¿ƒå±‚ ï¼Œ<strong>ä¸­å¿ƒå±‚åŒæ—¶ä¿å­˜ç€æœ€å¤šçš„å†…å®¹å‰¯æœ¬</strong>ï¼Œå½“è¾¹ç¼˜å±‚è®¾å¤‡æœªå‘½ä¸­æ—¶ï¼Œä¼šå‘ä¸­å¿ƒå±‚è¯·æ±‚ï¼Œå¦‚æœåœ¨ä¸­å¿ƒå±‚ä»æœªå‘½ä¸­ï¼Œåˆ™éœ€è¦ä¸­å¿ƒå±‚å‘æºç«™å›æºã€‚</li></ul><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210813124031742.png" alt="image-20210813124031742"></p><p>å„ä½åŒå­¦ä»¬å¥½ï¼š<br>æˆ‘ä»¬ä»Šå¹´å¤§æ•°æ®è¯¾ç¨‹å·²ç»æ¥è¿‘å°¾å£°ï¼Œè¿™é—¨è¯¾å·²ç»å¼€è®¾äº†ä¸‰å¹´ï¼Œæ¯å¹´éƒ½ä¼šé‚€è¯·åŒå­¦ä»¬æ¥å…±åŒå»ºè®¾ã€‚æ¯å¹´æˆ‘ä»¬ä¹Ÿéƒ½ä¼šæ ¹æ®åŒå­¦ä»¬çš„åé¦ˆè¿›è¡Œå®Œå–„ï¼Œä»Šå¹´æˆ‘ä»¬é¢„è®¡ä¼šè¿›è¡Œä¸€æ¬¡æ›´å¤§çš„ç³»ç»Ÿæ€§æ›´æ–°ã€‚<br>æŒ‰ç…§å½“åˆæ‰¿è¯ºï¼Œç°åœ¨æˆ‘ä»¬ç»Ÿè®¡ä¸‹å¤§å®¶å¼€æºè´¡çŒ®ï¼Œè¯·æŒ‰ç…§ç¤ºä¾‹ï¼Œåœ¨è¿›è¡Œä¸‹æ–¹è¯„è®ºå®Œæˆå¡«å†™ã€‚</p><ul><li>[æ³¨1] ï¼šä¸ºä¿è¯å¤§å®¶éšç§æƒ…å†µï¼Œè¯¥Issue<strong>ä¼šåœ¨ä¸‰å¤©å†…ç»Ÿè®¡å®Œæ¯•åå…³é—­</strong>ï¼Œè¯·åŠæ—¶å¡«å†™~</li></ul><table><thead><tr><th style="text-align:center">ç»„å·</th><th style="text-align:center">è´¡çŒ®ç±»å‹ï¼ˆæ–‡æ¡£å»ºè®¾ã€Issueã€PRç­‰ï¼‰</th><th style="text-align:center">é“¾æ¥ï¼ˆæˆ–å…¶å®ƒè¯æ˜æˆªå›¾ï¼‰</th><th style="text-align:center">è´¡çŒ®äºº</th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center">01ç»„</td><td style="text-align:center">issue</td><td style="text-align:center"><a href="">test-issue</a></td><td style="text-align:center">å¼ ä¸‰ï¼ˆ20196666ï¼‰ã€æå››ï¼ˆ20197777ï¼‰</td><td style="text-align:center"></td></tr></tbody></table><p>æ„Ÿè°¢å¤§å®¶çš„ç§¯æå‚ä¸ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰_è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</title>
      <link href="/p/44980/"/>
      <url>/p/44980/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>äºŒã€Linux &amp; Git</h1><h2 id="2-1-Linux">2.1 Linux</h2><h3 id="2-1-1-å¸¸ç”¨å‘½ä»¤">2.1.1 å¸¸ç”¨å‘½ä»¤</h3><ol><li><p><strong>æŸ¥çœ‹80ç«¯å£çŠ¶æ€</strong>ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ntulp | grep 80</span><br></pre></td></tr></table></figure><ul><li><code>-t</code> : æŒ‡æ˜æ˜¾ç¤ºTCPç«¯å£</li><li><code>-u</code> : æŒ‡æ˜æ˜¾ç¤ºUDPç«¯å£</li><li><code>-l</code> : ä»…æ˜¾ç¤ºç›‘å¬å¥—æ¥å­—(æ‰€è°“å¥—æ¥å­—å°±æ˜¯ä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¯»å†™ä¸æ”¶å‘é€šè®¯åè®®(protocol)ä¸èµ„æ–™çš„ç¨‹åº)</li><li><code>-p</code> : æ˜¾ç¤ºè¿›ç¨‹æ ‡è¯†ç¬¦å’Œç¨‹åºåç§°ï¼Œæ¯ä¸€ä¸ªå¥—æ¥å­—/ç«¯å£éƒ½å±äºä¸€ä¸ªç¨‹åº</li><li><code>-n</code> : ä¸è¿›è¡ŒDNSè½®è¯¢ï¼Œæ˜¾ç¤ºIP(å¯ä»¥åŠ é€Ÿæ“ä½œ)</li></ul></li><li><p><strong>æ€ä¹ˆæŸ¥çœ‹æŒ‡å®šç«¯å£æ˜¯å¦å¼€æ”¾</strong>ï¼Ÿ</p><p>é€šè¿‡ netstat å‘½ä»¤ï¼Œæ³¨æ„åŠ ä¸Š-aå‚æ•°ï¼Œçœ‹æ˜¯å¦æœ‰<code>0.0.0.0:22</code> åœ¨è¢«ç›‘å¬ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210906215822732.png" alt="image-20210906215822732"></p><p>é€šè¿‡lsofå‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æ˜¾ç¤ºï¼Œåˆ™ç«¯å£æ²¡æœ‰è¢«æ‰“å¼€ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210906215941036.png" alt="image-20210906215941036"></p></li><li><p><strong>æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ï¼Ÿæ€ä¹ˆé€€å‡ºï¼Ÿæ€ä¹ˆæœç´¢è¿›ç¨‹ï¼Ÿæ€ä¹ˆæŸ¥çœ‹æŸä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜å’ŒCPUä½¿ç”¨æƒ…å†µ</strong>ï¼Ÿ</p><ul><li><p>æ‰€æœ‰è¿›ç¨‹çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -aux  <span class="comment"># å†…å­˜ä¸­è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line">ps -l    <span class="comment"># æœ¬æ¬¡ç™»é™†æ‰€æœ‰çš„è¿›ç¨‹ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/19/ayQRIA8FcqBjtlV.png" alt="image-20210519183338193"></p></li><li><p>é€€å‡ºè¿›ç¨‹ï¼š</p><p><code>exit</code></p></li><li><p>æœç´¢è¿›ç¨‹ï¼š</p><p><code>ps -ef </code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep &lt;è¿›ç¨‹å&gt;</span><br></pre></td></tr></table></figure><ul><li><code>-e</code>ç›¸å½“äº<code>-a</code>æ˜¯å…¨éƒ¨åˆ—å‡ºï¼Œ<code>-f</code>æ˜¯æ˜¾ç¤ºUIDç­‰ï¼›</li></ul></li><li><p>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹ï¼ˆå¦‚kalfaï¼‰CPUå’Œå†…å­˜å ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep java</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/23/r5vaDgo4sYGfA8c.png" alt="image-20210523171131744"></p><ul><li>1.3æ˜¯<strong>CPUå ç”¨ç‡</strong>ï¼Œ12.7æ˜¯<strong>å†…å­˜å ç”¨ç‡</strong>ï¼Œ943100æ˜¯<strong>ç‰©ç†å†…å­˜ä½¿ç”¨é‡</strong></li></ul><p>è¿˜å¯ä»¥ä½¿ç”¨ topå‘½ä»¤æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹ï¼ˆPIDï¼‰çš„å†…å­˜å’ŒCPUä½¿ç”¨ç‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -p 2913</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>æŸ¥çœ‹å ç”¨æŒ‡å®šç«¯å£çš„è¿›ç¨‹</strong> ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :8040</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥åª<u>èƒ½è·å–è¿›ç¨‹å</u>ï¼Œè¿˜è¦<code>ps</code> å‘½ä»¤è¿›ä¸€æ­¥è·å–è¿›ç¨‹<code>id</code></p><p>å¦‚æœè¦æ€æ­»ç›¸åº”è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 &lt;è¿›ç¨‹id&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä»»åŠ¡ç®¡ç†å™¨</strong>ï¼ˆcpuå ç”¨ç‡ã€å†…å­˜å ç”¨ç‡ã€è¿›ç¨‹ï¼‰ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure><p>ï¼ˆ<strong>æ€»å¿˜</strong>ï¼‰è¿˜å¯ä»¥ä½¿ç”¨ topå‘½ä»¤æŸ¥çœ‹<strong>æŒ‡å®šè¿›ç¨‹ï¼ˆPIDï¼‰çš„å†…å­˜å’ŒCPUä½¿ç”¨ç‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top -p</span><br></pre></td></tr></table></figure></li><li><p><strong>å†…å­˜ä½¿ç”¨æƒ…å†µ å’Œ ç£ç›˜ä½¿ç”¨æƒ…å†µ</strong>ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -m  <span class="comment"># å†…å­˜ä½¿ç”¨æƒ…å†µ</span></span><br></pre></td></tr></table></figure><p>ç£ç›˜ä½¿ç”¨æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -m</span><br></pre></td></tr></table></figure><p><code>-m</code> : ä»¥Mbä¸ºå•ä½æ˜¾ç¤ºç£ç›˜ä½¿ç”¨é‡å’Œå ç”¨ç‡</p></li><li><p><strong>ç»Ÿè®¡å•è¯ä¸ªæ•°</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -o &lt;å•è¯&gt; &lt;æ–‡ä»¶åœ°å€&gt; ï½œ wc -l   <span class="comment"># -lè¡¨ç¤ºç»Ÿè®¡è¡Œæ•°</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®æ”¹ç”¨æˆ·æƒé™åŠå¸¸ç”¨å‚æ•°</strong>ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod &lt;å‚æ•°(å¯é€‰)&gt; &lt;æ¨¡å¼&gt; &lt;æ–‡ä»¶/æ–‡ä»¶å¤¹&gt;</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å‚æ•°ï¼š</p><ul><li><code>-R</code> ï¼šé€’å½’çš„ä¿®æ”¹æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰å­æ–‡ä»¶/æ–‡ä»¶å¤¹çš„æ‰€å±ç”¨æˆ·</li></ul><blockquote><p>ã€ç¤ºä¾‹ã€‘å¦‚ä½•ä¿®æ”¹ <code>/test5/5.txt</code> ï¼Œæƒé™ä»<code>rw-r--r--</code> â€”&gt; <code>r--rwxrwx </code> ï¼Ÿ</p><p><img src="https://camo.githubusercontent.com/fc3e66b1514a14614059e9423b7393b39d9a79db57cdcf11f0efd07fd95d32ca/68747470733a2f2f692e6c6f6c692e6e65742f323032302f30392f31372f527a664d625165377471756b786c452e706e67" alt="1580875509098"></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·ï¼ˆUï¼‰æƒé™[å‡å»å†™]æƒé™</span></span><br><span class="line">chmod u-w /test5/5.txt</span><br><span class="line"><span class="comment"># ç»„ï¼ˆGï¼‰/å…¶ä»–ç”¨æˆ·ï¼ˆOï¼‰æƒé™[åŠ ä¸Šå†™ã€æ‰§è¡Œ]</span></span><br><span class="line">chmod go+wx /test5/5.txt</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/04/20/3wrFPWplI47MTbO.png" alt="1580875689076"></p></li><li><p><strong>æŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤æœ‰å“ªäº›</strong>ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi æ–‡ä»¶å   <span class="comment">#ç¼–è¾‘æ–¹å¼æŸ¥çœ‹ï¼Œå¯ä¿®æ”¹</span></span><br><span class="line">cat æ–‡ä»¶å  <span class="comment">#æ˜¾ç¤ºå…¨éƒ¨æ–‡ä»¶å†…å®¹</span></span><br><span class="line">more æ–‡ä»¶å <span class="comment">#åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹</span></span><br><span class="line">less æ–‡ä»¶å <span class="comment">#ä¸ more ç›¸ä¼¼ï¼Œæ›´å¥½çš„æ˜¯å¯ä»¥å¾€å‰ç¿»é¡µ</span></span><br><span class="line">tail æ–‡ä»¶å <span class="comment">#ä»…æŸ¥çœ‹å°¾éƒ¨ï¼Œè¿˜å¯ä»¥æŒ‡å®šè¡Œæ•°</span></span><br><span class="line">head æ–‡ä»¶å <span class="comment">#ä»…æŸ¥çœ‹å¤´éƒ¨,è¿˜å¯ä»¥æŒ‡å®šè¡Œæ•°</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½ å¹³æ—¶æ€ä¹ˆæŸ¥çœ‹æ—¥å¿—çš„</strong>ï¼Ÿ</p><p>LinuxæŸ¥çœ‹æ—¥å¿—çš„å‘½ä»¤æœ‰å¤šç§: tailã€catã€tacã€headã€echoç­‰ï¼Œæœ¬æ–‡åªä»‹ç»å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚</p><ul><li><p><strong>tailï¼ˆæœ€å¸¸ä½¿ç”¨ï¼‰</strong></p><p>å‘½ä»¤æ ¼å¼: <code>tail[å¿…è¦å‚æ•°][é€‰æ‹©å‚æ•°][æ–‡ä»¶]</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail -n 10 test.log æŸ¥è¯¢æ—¥å¿—å°¾éƒ¨æœ€å10è¡Œçš„æ—¥å¿—;</span><br><span class="line">tail -n +10 test.log æŸ¥è¯¢10è¡Œä¹‹åçš„æ‰€æœ‰æ—¥å¿—;</span><br><span class="line">tail -fn 10 test.log å¾ªç¯å®æ—¶æŸ¥çœ‹æœ€å10è¡Œè®°å½•(æœ€å¸¸ç”¨çš„)</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬è¿˜ä¼šé…åˆç€grepæœç´¢ç”¨ï¼Œä¾‹å¦‚ :</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -fn 1000 test.log | grep <span class="string">&#x27;å…³é”®å­—&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€æ¬¡æ€§æŸ¥è¯¢çš„æ•°æ®é‡å¤ªå¤§,å¯ä»¥è¿›è¡Œç¿»é¡µæŸ¥çœ‹ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -n 4700 aa.log |more -1000 å¯ä»¥è¿›è¡Œå¤šå±æ˜¾ç¤º(ctrl + f æˆ–è€… ç©ºæ ¼é”®å¯ä»¥å¿«æ·é”®)</span><br></pre></td></tr></table></figure></li><li><p><strong>å…¶å®ƒé…åˆçš„å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span>              <span class="comment"># æ‰€æœ‰çš„å†å²è®°å½•</span></span><br><span class="line"><span class="built_in">history</span> | grep XXX   <span class="comment"># å†å²è®°å½•ä¸­åŒ…å«æŸäº›æŒ‡ä»¤çš„è®°å½•</span></span><br><span class="line"><span class="built_in">history</span> | more       <span class="comment"># åˆ†é¡µæŸ¥çœ‹è®°å½•</span></span><br><span class="line"><span class="built_in">history</span> -c           <span class="comment"># æ¸…ç©ºæ‰€æœ‰çš„å†å²è®°å½•</span></span><br><span class="line">!! é‡å¤æ‰§è¡Œä¸Šä¸€ä¸ªå‘½ä»¤</span><br><span class="line">æŸ¥è¯¢å‡ºæ¥è®°å½•åé€‰ä¸­ : !323</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>æ€ä¹ˆè®©è¿›ç¨‹åå°è¿è¡Œ</strong>ï¼Ÿ</p><ol><li><p>å‘½ä»¤åé¢åŠ ä¸Š**&amp;**å³å¯ï¼Œå®é™…ä¸Šï¼Œè¿™æ ·æ˜¯å°†å‘½ä»¤æ”¾å…¥åˆ°ä¸€ä¸ªä½œä¸šé˜Ÿåˆ—ä¸­äº†ï¼›</p><p>é€šå¸¸é…åˆ<strong>nohup</strong> ï¼Œå¿½ç•¥å‘é€ç»™å­å‘½ä»¤çš„æŒ‚æ–­SIGHUPä¿¡å·ï¼ˆ<strong>ç»ˆç«¯å…³é—­</strong>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup subcommand &amp;</span><br></pre></td></tr></table></figure></li><li><p>ctrl + z æŒ‚èµ·è¿›ç¨‹ï¼Œä½¿ç”¨jobsæŸ¥çœ‹åºå·ï¼Œåœ¨ä½¿ç”¨bg %åºå·åå°è¿è¡Œè¿›ç¨‹ï¼›</p><blockquote><p>ctrl + c æ˜¯è¿›ç¨‹ç»ˆæ­¢ã€‚</p></blockquote></li><li><p>è¿è¡ŒæŒ‡ä»¤å‰é¢**+ setsid**ï¼Œä½¿å…¶çˆ¶è¿›ç¨‹ç¼–ç¨‹initè¿›ç¨‹ï¼Œ<strong>ä¸å—SIGHUPä¿¡å·çš„å½±å“</strong>ã€‚</p></li></ol></li></ol><h3 id="2-1-2-å…¶å®ƒé—®é¢˜">2.1.2 å…¶å®ƒé—®é¢˜</h3><h4 id="1-è¯·é—®-proc-ç›®å½•æœ‰ä»€ä¹ˆç”¨ï¼Ÿ">1.<strong>è¯·é—®<code>/proc</code> ç›®å½•æœ‰ä»€ä¹ˆç”¨</strong>ï¼Ÿ</h4><p>Linuxç³»ç»Ÿä¸Šçš„/procç›®å½•æ˜¯ä¸€ç§æ–‡ä»¶ç³»ç»Ÿï¼Œå³procæ–‡ä»¶ç³»ç»Ÿã€‚ /procæ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯<strong>å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€</strong>çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶ï¼š</p><ul><li><strong>æŸ¥çœ‹ç³»ç»Ÿæœ‰å…³ï¼ˆ1ï¼‰ç¡¬ä»¶åŠå½“å‰ï¼ˆ2ï¼‰æ­£åœ¨è¿è¡Œè¿›ç¨‹</strong>çš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ›´æ”¹å…¶ä¸­æŸäº›æ–‡ä»¶æ¥æ”¹å˜å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚</li></ul><h4 id="2-Linuxçš„è½¯-ç¡¬é“¾æ¥æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">2. <strong>Linuxçš„è½¯/ç¡¬é“¾æ¥æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.linuxprobe.com/soft-and-hard-links.html">â€œè½¯é“¾æ¥â€å’Œâ€œç¡¬é“¾æ¥â€çš„åŒºåˆ«</a></p></blockquote><ul><li><p><strong>ä»€ä¹ˆæ˜¯é“¾æ¥</strong> ï¼Ÿ</p><p>æ–‡ä»¶åœ¨Linuxä¸Šè¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼š<strong>ç”¨æˆ·æ•°æ® (user data) ä¸å…ƒæ•°æ® (metadata)</strong> ã€‚</p><ul><li><strong>ç”¨æˆ·æ•°æ®</strong>ï¼šå³æ–‡ä»¶æ•°æ®å—ï¼Œä¿ç•™è®°å½•æ–‡ä»¶çœŸå®å†…å®¹çš„åœ°æ–¹</li><li><strong>å…ƒæ•°æ®</strong>ï¼š  æ˜¯æ–‡ä»¶çš„é™„åŠ å±æ€§ï¼Œå¦‚åˆ›å»ºå¤§å°ã€æ—¶é—´ï¼Œæ‰€æœ‰ä¿¡æ¯ç­‰ã€‚å…¶ä¸­<strong>inodeå·</strong> ï¼Œæ˜¯æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ã€‚</li></ul><p>ç³»ç»Ÿé€šè¿‡inodeå·å¿«é€Ÿæ‰¾åˆ°æ–‡ä»¶ï¼Œæœ‰ä¸€ç§æ–¹å¼å¯ä»¥<strong>å¿«é€Ÿå¯»æ‰¾åˆ°æ•°æ®å…ƒä¿¡æ¯</strong>ï¼Œé‚£å°±æ˜¯è½¯/ç¡¬é“¾æ¥ã€‚</p><p>ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶<code>myfile</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ touch myfile &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;This is a plain text file.&quot;</span> &gt; myfile</span><br><span class="line">$ cat myfile</span><br><span class="line"></span><br><span class="line">This is a plain text file.</span><br></pre></td></tr></table></figure><p>æ¥å±•ç¤ºäºŒè€…åŒºåˆ«ã€‚</p></li><li><p><strong>ç¡¬é“¾æ¥</strong></p><p>å»ºç«‹ <code>myfile</code> çš„ä¸€ä¸ªç¡¬é“¾æ¥ <code>hard</code> ï¼Œå¯ä»¥çœ‹åˆ°äºŒè€…çš„<code>inode</code>  æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æŒ‡å‘äº†åŒä¸€ä¸ªç‰©ç†åŒºå—</strong>ã€‚</p><blockquote><p>ç¡¬é“¾æ¥inode ï¼šæŒ‡å‘æ–‡ä»¶çš„åœ°å€ &amp; ç»´æŠ¤äº†ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œåªè¦æœ‰æ–‡ä»¶è¿˜æŒ‡å‘è¿™ä¸ªåŒºå—ï¼Œå®ƒå°±ä¸ä¼šä»ç¡¬ç›˜æ¶ˆå¤±ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ln myfile hard  <span class="comment"># å»ºç«‹ç¡¬é“¾æ¥hard</span></span><br><span class="line">$ ls -li</span><br><span class="line"></span><br><span class="line">25869085 -rw-r--r-- 2 unixzii staff 27 7 8 17:39 hard</span><br><span class="line">25869085 -rw-r--r-- 2 unixzii staff 27 7 8 17:39 myfile</span><br></pre></td></tr></table></figure><ul><li><p><strong>æ“ä½œç¡¬é“¾æ¥æ›´æ–°æ–‡ä»¶ï¼Œç­‰ä»·æ›´æ–°åŸæ–‡ä»¶</strong></p><p>ä½¿ç”¨hardç¡¬é“¾æ¥ä¿®æ”¹æ–‡ä»¶ï¼Œå‘ç°åŸæ–‡ä»¶ä¹Ÿè¢«ä¿®æ”¹äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;New line&quot;</span> &gt;&gt; hard</span><br><span class="line">$ cat myfile</span><br><span class="line"></span><br><span class="line">This is a plain text file.</span><br><span class="line">New line</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ é™¤åŸæ–‡ä»¶ï¼Œä½¿ç”¨ç¡¬é“¾æ¥ä¾æ—§å¯ä»¥æ˜¾ç¤º</strong></p><p>å› ä¸º<strong>ç£ç›˜å—è¿˜æœ‰ç¡¬é“¾æ¥åœ¨å¼•ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šæ¶ˆå¤±</strong>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rm myfile  <span class="comment"># åˆ é™¤åŸæ–‡ä»¶</span></span><br><span class="line">$ cat hard   <span class="comment"># ç¡¬é“¾æ¥ä¾æ—§å¯ä»¥æ˜¾ç¤º</span></span><br><span class="line"></span><br><span class="line">This is a plain text file.</span><br><span class="line">New line</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>è½¯é“¾æ¥</strong></p><p>å»ºç«‹ä¸€ä¸ª<code>soft</code>è½¯é“¾æ¥å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°äºŒè€…çš„inodeå·æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><blockquote><p>è½¯è¿æ¥çš„inode ï¼šä¿å­˜çœŸå®çš„æ–‡ä»¶çš„<strong>ç»å¯¹è·¯å¾„åœ°å€</strong>ï¼Œæ‰¾åˆ°è½¯é“¾æ¥ï¼Œè¿˜<strong>è¦æ ¹æ®inodeå·æ‰¾åˆ°çœŸå®æ–‡ä»¶è·¯å¾„</strong>ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ln -s myfile soft <span class="comment"># å»ºç«‹è½¯è¿æ¥soft</span></span><br><span class="line">$ ls -li</span><br><span class="line"></span><br><span class="line">25869085 -rw-r--r-- 2 unixzii staff 27 7 8 17:39 myfile</span><br><span class="line">25869216 lrwxr-xr-x 1 unixzii staff 6 7 8 17:47 soft -&gt; myfile</span><br></pre></td></tr></table></figure><ul><li><p><strong>æ“ä½œè½¯é“¾æ¥æ›´æ–°æ–‡ä»¶ï¼Œç­‰ä»·æ›´æ–°åŸæ–‡ä»¶</strong></p><p>å› ä¸ºè½¯é“¾æ¥å°±æ˜¯ç›¸å½“ä¸ªå¿«æ·æ–¹å¼ï¼Œå½“ç„¶æ›´æ–°åŸæ–‡ä»¶ã€‚</p></li><li><p><strong>åˆ é™¤åŸæ–‡ä»¶ï¼Œä½¿ç”¨è½¯é“¾æ¥ä¸ä¼šæ˜¾ç¤º</strong></p><p>å› ä¸ºè½¯ä»¶inodeæŒ‡å‘çš„ç»å¯¹åœ°å€ï¼Œå·²ç»ä¸å­˜åœ¨æ–‡ä»¶äº†ï¼Œæ‰€ä»¥å½“ç„¶ä¸å­˜åœ¨æ–‡ä»¶äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ rm myfile</span><br><span class="line">$ cat soft</span><br><span class="line"></span><br><span class="line">cat: soft: No such file or directory</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>è½¯ç¡¬è¿æ¥åŒºåˆ«æ€»ç»“</strong></p><ol><li><p><strong>inodeå·ä¸åŒ</strong>ã€‚ç¡¬é“¾æ¥åŸæ–‡ä»¶/é“¾æ¥æ–‡ä»¶å…¬ç”¨ä¸€ä¸ªinodeå·ï¼Œè¯´æ˜ä»–ä»¬æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œè½¯é“¾æ¥åŸæ–‡ä»¶/é“¾æ¥æ–‡ä»¶æ‹¥æœ‰ä¸åŒçš„inodeå·ï¼Œè¡¨æ˜ä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ï¼›</p></li><li><p><strong>é“¾æ¥æ•°ç›®ä¸åŒ</strong>ã€‚ è½¯é“¾æ¥çš„é“¾æ¥æ•°ç›®ä¸ä¼šå¢åŠ ï¼›ç¡¬é“¾æ¥æ¯å¤šä¸€ä¸ªé“¾æ¥å°±ä¼š+1ã€‚</p></li><li><p><strong>æ–‡ä»¶å¤§å°ä¸åŒ</strong>ã€‚ç¡¬é“¾æ¥æ–‡ä»¶æ˜¾ç¤ºçš„å¤§å°æ˜¯è·ŸåŸæ–‡ä»¶æ˜¯ä¸€æ · ï¼›è½¯é“¾æ¥æ˜¾ç¤ºçš„å¤§å°ä¸åŸæ–‡ä»¶å°±ä¸åŒäº†ï¼ŒBBBå¤§å°æ˜¯95Bï¼Œè€ŒBBBsoftæ˜¯3Bï¼Œå› ä¸ºBBBå…±æœ‰3ä¸ªå­—ç¬¦ã€‚</p></li><li><p><strong>æ–‡ä»¶ç³»ç»Ÿé™åˆ¶</strong>ã€‚ è½¯é“¾æ¥æ²¡æœ‰ä»»ä½•æ–‡ä»¶ç³»ç»Ÿçš„é™åˆ¶ï¼Œä»»ä½•ç”¨æˆ·å¯ä»¥åˆ›å»ºæŒ‡å‘ç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚</p><blockquote><p><strong>å»ºç«‹è½¯é“¾æ¥å°±æ˜¯å»ºç«‹äº†ä¸€ä¸ªæ–°æ–‡ä»¶</strong>ï¼šå½“è®¿é—®é“¾æ¥æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå°±ä¼šå‘ç°ä»–æ˜¯ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œå®ƒè¯»å–é“¾æ¥æ–‡ä»¶æ‰¾åˆ°çœŸæ­£è¦è®¿é—®çš„æ–‡ä»¶ã€‚</p></blockquote></li></ol></li></ul><h3 id="3-æŸ¥è¯¢æ—¥å¿—çš„top10-IP">3. æŸ¥è¯¢æ—¥å¿—çš„top10 IP?</h3><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="built_in">log</span> | cut -d <span class="string">&#x27; &#x27;</span> -f 1 | sort | uniq -c | sort -nr | awk <span class="string">&#x27;&#123;print $0&#125;&#x27;</span> | head -n 10</span><br></pre></td></tr></table></figure><ol><li><p><code>cat *.log</code>  ï¼šå°†æ–‡æœ¬å†…å®¹æ‰“å°åˆ°å±å¹•</p></li><li><p><code>cut</code>ï¼šæˆªå–æŒ‡å®šIPé‚£ä¸€åˆ—</p></li><li><p><code>sort </code>ï¼ŒæŒ‰IP ASCIIç æ’åºï¼šè¿›è¡Œæ’åºï¼Œé»˜è®¤æ˜¯æŒ‰ç…§asciiç è¿›è¡Œæ’åºçš„</p></li><li><p><code>uniq -c  </code> ï¼Œç»Ÿè®¡é‡å¤çš„IP ï¼šç»Ÿè®¡<strong>ç›¸é‚»çš„è¡Œ</strong>çš„é‡å¤æ•°é‡ï¼Œç»“æœæ˜¯ç±»ä¼¼ <code>3 127.13.13.13</code> ï¼Œå‰é¢çš„æ•°å­—ä»£ç é‡å¤çš„è¡Œæ•°</p><p><code>sort|uniq -c</code>  ç»Ÿè®¡é‡å¤çš„è¡Œæ•°</p></li><li><p><code>sort -n</code>ï¼Œå†æ¬¡æ’åº ï¼šæ˜¯æŒ‰ç…§æ•°å€¼è¿›è¡Œç”±å°åˆ°å¤§è¿›è¡Œæ’åºï¼Œ -ræ˜¯è¡¨ç¤ºé€†åºï¼Œ-tæ˜¯æŒ‡å®šåˆ†å‰²ç¬¦ï¼Œ-kæ˜¯æ‰§è¡ŒæŒ‰ç…§ç¬¬å‡ åˆ—è¿›è¡Œæ’åº</p></li><li><p><code>awk</code> ï¼Œåªæ˜¾ç¤ºIPï¼šæŒ‰ç…§åˆ†å‰²ç¬¦å°†ä¸€è¡Œåˆ†å‰²ä¸ºå¤šä¸ªåˆ—ï¼Œç¬¬ä¸€åˆ—ç”¨1è¡¨ç¤ºï¼Œç¬¬äºŒåˆ—ç”¨â€‹2è¡¨ç¤ºï¼Œä¾æ¬¡ç±»æ¨</p><p><code>awk -F&quot; &quot; '&#123;print $2&#125;</code>   ï¼Œè¡¨ç¤ºç”¨ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦è¿›è¡Œåˆ†å‰²ï¼Œæ‰“å°å‡ºç¬¬2åˆ—</p></li><li><p><code>head -n ï¼š</code>è¡¨ç¤ºå–å‰nä¸ª</p></li></ol><h2 id="2-2-Git">2.2 Git</h2><blockquote><p><a href="https://zhuanlan.zhihu.com/p/96631135">è®²gitåŸç†çš„çš„ä¸€ç¯‡ä¸é”™æ–‡ç« </a></p></blockquote><h3 id="2-2-1-å¸¸é—®å‘½ä»¤">2.2.1 å¸¸é—®å‘½ä»¤</h3><h4 id="1-ä»€ä¹ˆæ˜¯Gitï¼Ÿæ˜¯ç”¨ä»€ä¹ˆè¯­è¨€ç¼–å†™çš„ï¼Ÿ">1.ä»€ä¹ˆæ˜¯Gitï¼Ÿæ˜¯ç”¨ä»€ä¹ˆè¯­è¨€ç¼–å†™çš„ï¼Ÿ</h4><ul><li>Gitæ˜¯ä¸€ä¸ª <u>åˆ†å¸ƒå¼</u> <u>ä»£ç æ§åˆ¶ç³»ç»Ÿ</u> ï¼›</li><li>Gitä½¿ç”¨ C è¯­è¨€ç¼–å†™ï¼š<u>ä½¿å¾— GIT å¾ˆå¿«ï¼ŒC è¯­è¨€å‡å°‘è¿è¡Œæ—¶å¼€é”€</u>æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</li></ul><h4 id="2-å¦‚ä½•åœ¨Gitä¸­åˆ›å»ºå­˜å‚¨åº“ï¼Ÿ">2.å¦‚ä½•åœ¨Gitä¸­åˆ›å»ºå­˜å‚¨åº“ï¼Ÿ</h4><ol><li>å¦‚æœé¡¹ç›®ä¸å­˜åœ¨ï¼Œåˆ›å»º</li><li>ç„¶åè¿è¡Œ <code>git init</code> ï¼Œä¼šåœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>.git</code> ç›®å½•</li></ol><h4 id="3-åˆ—ä¸¾å·¥ä½œä¸­å¸¸ç”¨çš„å‡ ä¸ªgitå‘½ä»¤ï¼Ÿ">3.<strong>åˆ—ä¸¾å·¥ä½œä¸­å¸¸ç”¨çš„å‡ ä¸ªgitå‘½ä»¤</strong>ï¼Ÿ</h4><ul><li><code>git add</code> : å¢åŠ æ–‡ä»¶</li><li><code>git commit -m</code> ï¼šæäº¤æ–‡ä»¶</li><li><code>git status</code> ï¼šæ‹‰å–è¿œç¨‹åˆ†æ”¯</li><li><code>git push</code> ï¼šåˆå¹¶å½“å‰åˆ†æ”¯å’Œä¸»åˆ†æ”¯</li><li><code>git pull</code> OR <code>git fetch/git merge</code> ï¼šæ‹‰å–è¿œç¨‹åˆ†æ”¯</li></ul><h4 id="4-è®²è®²Git-commit-åŸºæœ¬å‚æ•°ï¼Ÿ">4.<strong>è®²è®²Git commit åŸºæœ¬å‚æ•°</strong>ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/qianqiannian/p/6005628.html">https://www.cnblogs.com/qianqiannian/p/6005628.html</a></p></blockquote><ul><li><code>git commit -m â€œmessageâ€</code> ï¼šç®€è¦è¯´æ˜è¿™æ¬¡æäº¤çš„è¯­å¥</li><li><code>git commit -a</code> ï¼šå³ä½¿æ²¡æœ‰ç»è¿‡ <code>git add</code> ï¼Œä¹Ÿå¯ä»¥å°†æ‰€æœ‰ <u>ä¿®æ”¹</u> æˆ– <u>åˆ é™¤</u> çš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œ<strong>ä½†æ–°å»ºçš„æ–‡ä»¶ä¸ä¼šæäº¤</strong></li><li><code>git commit --amend</code> ï¼šè¿½åŠ æäº¤ï¼Œå®ƒå¯ä»¥åœ¨<u>ä¸å¢åŠ ä¸€ä¸ªæ–°çš„commit-id</u> çš„æƒ…å†µä¸‹å°†æ–°ä¿®æ”¹çš„ä»£ç è¿½åŠ åˆ°å‰ä¸€æ¬¡çš„commit-idä¸­ï¼Œ</li></ul><h4 id="5-åœ¨Gitä¸­ï¼Œä½ å¦‚ä½•è¿˜åŸå·²ç»-push-å¹¶å…¬å¼€çš„æäº¤ï¼Ÿ">5.<strong>åœ¨Gitä¸­ï¼Œä½ å¦‚ä½•è¿˜åŸå·²ç» push å¹¶å…¬å¼€çš„æäº¤</strong>ï¼Ÿ</h4><ul><li><p>åˆ é™¤æˆ–ä¿®å¤æ–°æäº¤ä¸­çš„é”™è¯¯æ–‡ä»¶ï¼Œå¹¶å°†å…¶<strong>è¦†ç›–</strong>æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;commit message&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œ<strong>æ’¤æ¶ˆ</strong>åœ¨é”™è¯¯æäº¤ä¸­æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;name of bad commit&gt;</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-git-pull-å’Œ-git-fetch-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">6. <strong>git pull å’Œ git fetch æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><p><code>git pull</code></p><p>å–å›è¿œç¨‹ä¸»æœºæŸä¸ªåˆ†æ”¯çš„æ›´æ–°ï¼Œ<strong>å†ä¸æœ¬åœ°çš„æŒ‡å®šåˆ†æ”¯åˆå¹¶</strong> ï¼ˆå¯èƒ½è¦è§£å†³å†²çªï¼‰ã€‚</p></li><li><p><code>git fetch</code></p><p>ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°ï¼Œ<strong>ä¸ä¼šè‡ªåŠ¨åˆå¹¶</strong> ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ <code>git merge</code></p></li></ul><h4 id="7-ä»€ä¹ˆæ˜¯-git-stash-ä½ ä¸€èˆ¬ä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨å®ƒï¼Ÿ">7.<strong>ä»€ä¹ˆæ˜¯ git stash?ä½ ä¸€èˆ¬ä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨å®ƒ</strong>ï¼Ÿ</h4><blockquote><p>ç»å¸¸æœ‰è¿™æ ·çš„äº‹æƒ…å‘ç”Ÿï¼Œå½“ä½ æ­£åœ¨è¿›è¡Œé¡¹ç›®ä¸­æŸä¸€éƒ¨åˆ†çš„å·¥ä½œï¼Œé‡Œé¢çš„ä¸œè¥¿å¤„äºä¸€ä¸ªæ¯”è¾ƒæ‚ä¹±çš„çŠ¶æ€ï¼Œè€Œä½ æƒ³è½¬åˆ°å…¶ä»–åˆ†æ”¯ä¸Šè¿›è¡Œä¸€äº›å·¥ä½œã€‚é—®é¢˜æ˜¯ï¼Œä½ ä¸æƒ³æäº¤è¿›è¡Œäº†ä¸€åŠçš„å·¥ä½œï¼Œå¦åˆ™ä»¥åä½ æ— æ³•å›åˆ°è¿™ä¸ªå·¥ä½œç‚¹ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯<code>git stash</code>å‘½ä»¤ã€‚å‚¨è—(stash)å¯ä»¥è·å–ä½ å·¥ä½œç›®å½•çš„ä¸­é—´çŠ¶æ€â€”â€”ä¹Ÿå°±æ˜¯ä½ ä¿®æ”¹è¿‡çš„è¢«è¿½è¸ªçš„æ–‡ä»¶å’Œæš‚å­˜çš„å˜æ›´â€”â€”å¹¶å°†å®ƒä¿å­˜åˆ°ä¸€ä¸ªæœªå®Œç»“å˜æ›´çš„å †æ ˆä¸­ï¼Œéšæ—¶å¯ä»¥é‡æ–°åº”ç”¨</p></blockquote><ul><li><strong>ä½¿ç”¨æƒ…å†µ</strong>ï¼š å½“å‰åˆ†æ”¯è¿˜æ²¡å¤„ç†å®Œï¼Œä¸èƒ½å»commitæäº¤ï¼Œä½†æ˜¯è¦å»å¤„ç†ä¸€ä¸ªç´§æ€¥å¼€å‘é¡¹ç›®ï¼Œä½¿ç”¨ <code>git stash</code></li><li>å¤„ç†å®Œå<code>git stash pop</code> ç»§ç»­å¤„ç†å·¥ä½œ</li></ul><h4 id="8-å¦‚æœæœ¬æ¬¡æäº¤è¯¯æ“ä½œï¼Œå¦‚ä½•æ’¤é”€ï¼Ÿ">8.<strong>å¦‚æœæœ¬æ¬¡æäº¤è¯¯æ“ä½œï¼Œå¦‚ä½•æ’¤é”€</strong>ï¼Ÿ</h4><ul><li><p><strong>åœºæ™¯1</strong>:æ”¹ä¹±äº†ï¼ˆåŒ…æ‹¬åˆ é™¤ç­‰ï¼‰å·¥ä½œåŒºæŸä¸ªæ–‡ä»¶çš„å†…å®¹ï¼ˆ<code>git add ä¹‹å‰</code>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- &lt;file&gt;</span><br></pre></td></tr></table></figure><p>ä¸¢å¼ƒä¹‹å‰æ‰€æœ‰çš„ä¿®æ”¹ã€‚</p></li><li><p><strong>åœºæ™¯2</strong>:æ’¤é”€æäº¤åˆ°ç´¢å¼•åŒºçš„æ–‡ä»¶ ï¼ˆ<code>git add ä¹‹å</code>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD &lt;file&gt;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å›åˆ°äº†åœºæ™¯1ï¼Œç„¶åå†ä½¿ç”¨ <code>git checkout</code></p></li><li><p><strong>åœºæ™¯3</strong>ï¼š æ’¤é”€å·²ç»æäº¤ä¹‹åçš„æ–‡ä»¶ï¼ˆ<code>git commitä¹‹å</code>ï¼‰ï¼š</p><p>å›é€€ç‰ˆæœ¬å·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog  <span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">$ git reset --hard  3928   <span class="comment"># å›é€€ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure></li><li><p><strong>åœºæ™¯4ï¼š</strong> æ’¤é”€å·²ç»pushåˆ°è¿œç¨‹åˆ†æ”¯ä¹‹åçš„æ–‡ä»¶ï¼ˆ<code>git pushä¹‹å</code>ï¼‰</p><ul><li><p>åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œ<strong>æ’¤æ¶ˆ</strong>åœ¨é”™è¯¯æäº¤ä¸­æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;name of bad commit&gt;</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æˆ–ä¿®å¤æ–°æäº¤ä¸­çš„é”™è¯¯æ–‡ä»¶ï¼Œå¹¶å°†å…¶<strong>è¦†ç›–</strong>æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;commit message&quot;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="9-ä½¿ç”¨è¿‡git-mergeå’Œgit-rebaseå—ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">9.<strong>ä½¿ç”¨è¿‡git mergeå’Œgit rebaseå—ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«</strong>ï¼Ÿ</h4><p>éƒ½æ˜¯ç”¨æ¥åˆå¹¶åˆ†æ”¯çš„ï¼Œä½†æ˜¯ï¼š</p><ul><li><p><code>git merge &lt;å½“å‰åˆ†æ”¯è¦åˆå¹¶çš„åˆ†æ”¯&gt;</code> ï¼š åœ¨å½“å‰åˆ†æ”¯åˆå¹¶&lt;æŒ‡å®šè¦åˆå¹¶çš„åˆ†æ”¯&gt;ï¼Œä¼šè‡ªåŠ¨åœ¨å½“å‰åˆ†æ”¯ï¼ˆä¸‹å›¾ä¸ºmasterï¼‰åˆ›å»ºä¸€ä¸ªcommitèŠ‚ç‚¹ï¼Œä¿ç•™äº†è¦åˆå¹¶çš„åˆ†æ”¯ï¼ˆä¸‹å›¾ä¸ºbranch1ï¼‰çš„æäº¤è®°å½•</p><p><img src="https://i.loli.net/2021/05/02/oLOVlIs7yNazKnJ.png" alt="preview"></p></li><li><p><code>git rebase &lt;å½“å‰åˆ†æ”¯å˜åŸºçš„åŸºç‚¹åˆ†æ”¯&gt;</code> ï¼šç›¸å½“å°†å½“å‰åˆ†æ”¯ï¼ˆä¸‹å›¾ä¸ºbranch1ï¼‰çš„åˆ†æ”¯èŠ‚ç‚¹ï¼ˆ5,6ï¼‰ ä¾æ¬¡æäº¤åˆ°åŸºç‚¹åˆ†æ”¯ï¼ˆmasterï¼‰çš„4èŠ‚ç‚¹ä¹‹åï¼Œä¿ç•™äº†æ›´å¹²å‡€çš„å†å²è®°å½•ï¼Œæ²¡æœ‰ç”Ÿæˆè¡Œçš„commit èŠ‚ç‚¹</p><p><img src="https://i.loli.net/2021/05/02/ebDoLAUMSd13QRI.png" alt="image-20210502231023075"></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_JVM</title>
      <link href="/p/42516/"/>
      <url>/p/42516/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h2 id="1-6-JVMç›¸å…³">1.6 JVMç›¸å…³</h2><h3 id="1-6-1-å¸¸é—®é—®é¢˜">1.6.1 å¸¸é—®é—®é¢˜</h3><h4 id="1-ï¼ˆè¢«é—®è¿‡ï¼‰JVMå¯åŠ¨çš„åŸºæœ¬é…ç½®å‚æ•°æœ‰å“ªäº›ï¼Ÿï¼ˆæˆ–è€…è¯´è°ƒä¼˜å‚æ•°ï¼‰">1. ï¼ˆè¢«é—®è¿‡ï¼‰<strong>JVMå¯åŠ¨çš„åŸºæœ¬é…ç½®å‚æ•°æœ‰å“ªäº›</strong>ï¼Ÿï¼ˆæˆ–è€…è¯´è°ƒä¼˜å‚æ•°ï¼‰</h4><p><strong>ã€Œå †æ ˆå†…å­˜ç›¸å…³ã€</strong></p><ul><li><p>-Xmsï¼š è®¾ç½®åˆå§‹å †çš„å¤§å°</p></li><li><p>-Xmxï¼š è®¾ç½®æœ€å¤§å †çš„å¤§å°</p></li><li><p>-Xmn ï¼šè®¾ç½®å¹´è½»ä»£å¤§å°ï¼Œç›¸å½“äºåŒæ—¶é…ç½®-XX:NewSizeå’Œ-XX:MaxNewSizeä¸ºä¸€æ ·çš„å€¼</p></li><li><p>-Xssï¼š æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°</p></li><li><p>-XX:NewSize è®¾ç½®å¹´è½»ä»£å¤§å°(for 1.3/1.4)</p></li><li><p>-XX:MaxNewSize å¹´è½»ä»£æœ€å¤§å€¼(for 1.3/1.4)</p></li><li><p>-XX:NewRatio å¹´è½»ä»£ä¸å¹´è€ä»£çš„æ¯”å€¼(é™¤å»æŒä¹…ä»£)</p></li><li><p>-XX:SurvivorRatio EdenåŒºä¸SurvivoråŒºçš„çš„æ¯”å€¼</p></li><li><p>-XX:PretenureSizeThreshold å½“åˆ›å»ºçš„å¯¹è±¡è¶…è¿‡æŒ‡å®šå¤§å°æ—¶ï¼Œç›´æ¥æŠŠå¯¹è±¡åˆ†é…åœ¨è€å¹´ä»£ã€‚</p></li><li><p>-XX:MaxTenuringThresholdè®¾å®šå¯¹è±¡åœ¨Survivorå¤åˆ¶çš„æœ€å¤§å¹´é¾„é˜ˆå€¼ï¼Œè¶…è¿‡é˜ˆå€¼è½¬ç§»åˆ°è€å¹´ä»£</p></li></ul><p><strong>ã€Œåƒåœ¾æ”¶é›†å™¨ç›¸å…³ã€</strong></p><p>-XX:+UseParallelGCï¼šé€‰æ‹©åƒåœ¾æ”¶é›†å™¨ä¸ºå¹¶è¡Œæ”¶é›†å™¨ã€‚</p><ul><li><p>-XX:ParallelGCThreads=20ï¼šé…ç½®å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•°</p></li><li><p>-XX:+UseConcMarkSweepGCï¼šè®¾ç½®å¹´è€ä»£ä¸ºå¹¶å‘æ”¶é›†ã€‚</p></li><li><p>-XX:CMSFullGCsBeforeCompaction=5 ç”±äºå¹¶å‘æ”¶é›†å™¨ä¸å¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©ã€æ•´ç†ï¼Œæ‰€ä»¥è¿è¡Œä¸€æ®µæ—¶é—´ä»¥åä¼šäº§ç”Ÿâ€œç¢ç‰‡â€ï¼Œä½¿å¾—è¿è¡Œæ•ˆç‡é™ä½ã€‚æ­¤å€¼è®¾ç½®è¿è¡Œ5æ¬¡GCä»¥åå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©ã€æ•´ç†ã€‚</p></li><li><p>-XX:+UseCMSCompactAtFullCollectionï¼šæ‰“å¼€å¯¹å¹´è€ä»£çš„å‹ç¼©ã€‚å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œä½†æ˜¯å¯ä»¥æ¶ˆé™¤ç¢ç‰‡</p></li></ul><p><strong>ã€Œè¾…åŠ©ä¿¡æ¯ç›¸å…³ã€</strong></p><ul><li><p>-XX:+PrintGCDetails æ‰“å°GCè¯¦ç»†ä¿¡æ¯</p></li><li><p>-XX:+HeapDumpOnOutOfMemoryErrorè®©JVMåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºçš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆå†…å­˜å¿«ç…§,æ’æŸ¥é—®é¢˜ç”¨</p></li><li><p>-XX:+DisableExplicitGCç¦æ­¢ç³»ç»ŸSystem.gc()ï¼Œé˜²æ­¢æ‰‹åŠ¨è¯¯è§¦å‘FGCé€ æˆé—®é¢˜.</p></li><li><p>-XX:+PrintTLAB æŸ¥çœ‹TLABç©ºé—´çš„ä½¿ç”¨æƒ…å†µ</p></li></ul><h4 id="2-è¯´è¯´å †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ">2.<strong>è¯´è¯´å †å’Œæ ˆçš„åŒºåˆ«</strong>ï¼Ÿ</h4><ol><li><p><strong>åŠŸèƒ½ä¸åŒ</strong>ï¼šæ ˆå†…å­˜ç”¨æ¥å­˜å‚¨<u>å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨</u>ï¼Œè€Œå †å†…å­˜ç”¨<u>æ¥å­˜å‚¨Javaä¸­çš„å¯¹è±¡</u>ï¼›</p><blockquote><p>æ³¨ï¼šæ— è®ºæ˜¯æˆå‘˜å˜é‡ï¼Œå±€éƒ¨å˜é‡ï¼Œè¿˜æ˜¯ç±»å˜é‡ï¼Œå®ƒä»¬æŒ‡å‘çš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚</p></blockquote></li><li><p><strong>å…±äº«æ€§ä¸åŒ</strong>ï¼šæ ˆå†…å­˜æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼› å †å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±æœ‰çš„ï¼›</p></li><li><p><strong>å¼‚å¸¸é”™è¯¯ä¸åŒ</strong>ï¼šå¦‚æœæ ˆå†…å­˜æˆ–è€…å †å†…å­˜ä¸è¶³ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ä½†ä¸åŒï¼›</p><blockquote><p>æ ˆç©ºé—´ä¸è¶³ï¼š<code>java.lang.StackOverFlowError</code>ã€‚ å †ç©ºé—´ä¸è¶³ï¼š<code>java.lang.OutOfMemoryError</code>ï¼›</p></blockquote></li><li><p><strong>ç©ºé—´å¤§å°</strong>ï¼šæ ˆçš„ç©ºé—´å¤§å°è¿œè¿œå°äºå †çš„ã€‚</p></li></ol><h4 id="3-ã€é‡ç‚¹ã€‘è¯·é—®JVMè¿è¡Œæ—¶å†…å­˜å¸ƒå±€åˆ†å¸ƒï¼Ÿ-å“ªäº›æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Ÿ">3.<strong>ã€é‡ç‚¹ã€‘è¯·é—®JVMè¿è¡Œæ—¶å†…å­˜å¸ƒå±€åˆ†å¸ƒï¼Ÿ å“ªäº›æ˜¯çº¿ç¨‹å…±äº«çš„</strong>ï¼Ÿ</h4><p>ä»æ¦‚å¿µä¸Šå¤§è‡´åˆ†ä¸º 6 ä¸ªï¼ˆé€»è¾‘ï¼‰åŒºåŸŸï¼Œå‚è€ƒä¸‹å›¾ã€‚æ³¨ï¼šMethod Area ä¸­è¿˜æœ‰ä¸€ä¸ªå¸¸é‡æ± åŒºï¼Œå›¾ä¸­æœªæ˜ç¡®æ ‡å‡ºã€‚</p><ul><li>æ€»çš„æ¥çœ‹ï¼ŒJVM æŠŠå†…å­˜åˆ’åˆ†ä¸º<u>â€œæ ˆ(stack)â€ä¸â€œå †(heap)â€</u>ä¸¤å¤§ç±»</li></ul><p><img src="https://static001.infoq.cn/resource/image/dd/a9/dd614bf56417939aa0e0694fedf2caa9.png" alt="img"></p><p><u>çº¿ç¨‹ç§æœ‰çš„ï¼š</u></p><ul><li><p><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼šå½“åŒæ—¶è¿›è¡Œçš„çº¿ç¨‹æ•°è¶…è¿‡CPUæ•°æˆ–å…¶å†…æ ¸æ•°æ—¶ï¼Œå°±è¦é€šè¿‡æ—¶é—´ç‰‡è½®è¯¢åˆ†æ´¾CPUçš„æ—¶é—´èµ„æºï¼Œä¸å…å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ã€‚è¿™æ—¶ï¼Œ<u>æ¯ä¸ªçº¿ç¨‹å°±éœ€è¦ä¸€ä¸ªå±äºè‡ªå·±çš„è®¡æ•°å™¨æ¥è®°å½•ä¸‹ä¸€æ¡è¦è¿è¡Œçš„æŒ‡ä»¤</u>ï¼›</p></li><li><p><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼š <u>æ¯ä¸ªjavaæ–¹æ³•æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ª<strong>æ¡¢æ ˆ</strong></u>æ¥å­˜å‚¨æ–¹æ³•çš„ï¼š</p><ul><li><p>å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥æ–¹æ³•ã€è¿”å›å€¼ã€è¿”å›åœ°å€ç­‰ä¿¡æ¯ï¼›</p></li><li><p>æ ˆçš„å¤§å°å†³å®šäº†æ–¹æ³•è°ƒç”¨çš„å¯è¾¾æ·±åº¦ï¼ˆé€’å½’å¤šå°‘å±‚æ¬¡ï¼Œæˆ–åµŒå¥—è°ƒç”¨å¤šå°‘å±‚å…¶ä»–æ–¹æ³•ï¼‰ï¼Œâ€œ<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.6">æ ˆå¸§å‚è€ƒ</a>â€ ï¼›</p></li></ul></li><li><p><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼š ä¸è™šæ‹Ÿæœºæ ˆä½œç”¨ç›¸ä¼¼ã€‚ä½†å®ƒä¸æ˜¯ä¸ºJavaæ–¹æ³•æœåŠ¡çš„ï¼Œè€Œæ˜¯è°ƒç”¨æ“ä½œç³»ç»ŸåŸç”Ÿæœ¬åœ°æ–¹æ³•æ—¶ï¼Œæ‰€éœ€è¦çš„å†…å­˜åŒºåŸŸã€‚</p><ul><li>æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºâ¼€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚</li></ul></li></ul><p><u>çº¿ç¨‹å…±äº«çš„ï¼š</u></p><ul><li><p><strong>å †</strong>ï¼šGC åƒåœ¾å›æ”¶çš„ä¸»ç«™åœºï¼Œç”¨äº<u>å­˜æ”¾ç±»çš„å®ä¾‹å¯¹è±¡åŠ æ•°ç»„å®ä¾‹</u>ç­‰ï¼›</p><p><img src="https://i.loli.net/2021/05/05/6Ri9BzxGtLpFemP.png" alt="img"></p></li><li><p><strong>æ–¹æ³•åŒº</strong>ï¼š çº¿ç¨‹å…±äº«çš„ï¼Œç”¨äºå­˜æ”¾è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»çš„å…ƒæ•°æ®ä¿¡æ¯</strong>ï¼š</p><ul><li>å¦‚ <u><strong>å¸¸é‡</strong>ã€<strong>é™æ€å˜é‡</strong></u>å’Œ <u> å³æ—¶<strong>ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç </strong></u><strong>ï¼›</strong></li><li><strong>è¿è¡Œæ—¶å¸¸é‡æ± ï¼šå­—ç¬¦ä¸²</strong>ï¼Œint -128~127 èŒƒå›´çš„å€¼ç­‰ï¼Œå®ƒæ˜¯ <u>æ–¹æ³•åŒº</u> ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</li></ul></li></ul><h5 id="3-1-JVM-å †ä¸­åˆæ€ä¹ˆåˆ†çš„ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåˆ’åˆ†ï¼Ÿä¸ºä»€ä¹ˆè¦å–æ¶ˆæ°¸ä¹…ä»£ç”¨å…ƒç©ºé—´ä»£æ›¿ï¼Ÿ">3.1 JVM å †ä¸­åˆæ€ä¹ˆåˆ†çš„ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåˆ’åˆ†ï¼Ÿä¸ºä»€ä¹ˆè¦å–æ¶ˆæ°¸ä¹…ä»£ç”¨å…ƒç©ºé—´ä»£æ›¿ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/111809384">https://zhuanlan.zhihu.com/p/111809384</a></p></blockquote><ul><li><p><strong>å †åˆ’åˆ†</strong>ï¼šå †åˆè¢«åˆ’åˆ†ä¸ºï¼Œæ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ã€‚æ–°ç”Ÿä»£åˆè¢«åˆ’åˆ†ä¸ºedenå’ŒsurvivoråŒºã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆåˆ’åˆ†æ–°ç”Ÿä»£ã€è€å¹´ä»£</strong>ï¼Ÿ</p><p>å› ä¸ºæœ‰çš„å¯¹è±¡å¯¿å‘½é•¿ï¼Œæœ‰çš„å¯¹è±¡å¯¿å‘½çŸ­ã€‚<strong>åº”è¯¥å°†å¯¿å‘½é•¿çš„å¯¹è±¡æ”¾åœ¨ä¸€ä¸ªåŒºï¼Œå¯¿å‘½çŸ­çš„å¯¹è±¡æ”¾åœ¨ä¸€ä¸ªåŒºã€‚ä¸åŒçš„åŒºé‡‡ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚å¯¿å‘½çŸ­çš„åŒºæ¸…ç†é¢‘æ¬¡é«˜ä¸€ç‚¹ï¼Œå¯¿å‘½é•¿çš„åŒºæ¸…ç†é¢‘æ¬¡ä½ä¸€ç‚¹ã€‚æé«˜æ•ˆç‡</strong>ã€‚</p></li><li><p><strong>ä»£æ›¿</strong>ï¼š åœ¨java7ç‰ˆæœ¬å‰ï¼Œå †å’Œæ–¹æ³•åŒºè¿åœ¨äº†ä¸€èµ·ï¼Œä½†è¿™å¹¶ä¸èƒ½è¯´å †å’Œæ–¹æ³•åŒºæ˜¯ä¸€èµ·çš„ï¼Œå®ƒä»¬åœ¨é€»è¾‘ä¸Šä¾æ—§æ˜¯åˆ†å¼€çš„ã€‚<strong>ä½†åœ¨ç‰©ç†ä¸Šæ¥è¯´ï¼Œå®ƒä»¬åˆæ˜¯è¿ç»­çš„ä¸€å—å†…å­˜</strong>ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210906224656302.png" alt="image-20210906224656302" style="zoom:50%;" /><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–¹æ³•åŒºå’Œå‰é¢è®²åˆ°çš„Edenå’Œè€å¹´ä»£æ˜¯è¿ç»­çš„</strong>ã€‚</p><p><strong>æ°¸ä¹…ä»£çš„åƒåœ¾æ”¶é›†æ˜¯å’Œè€å¹´ä»£æ†ç»‘åœ¨ä¸€èµ·çš„ï¼Œå› æ­¤æ— è®ºè°æ»¡äº†ï¼Œéƒ½ä¼šè§¦å‘æ°¸ä¹…ä»£å’Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†</strong>ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210906224744446.png" alt="image-20210906224744446" style="zoom:50%;" /><p>åœ¨Java8ä¸­ï¼Œå…ƒç©ºé—´(Metaspace)ç™»ä¸Šèˆå°ï¼Œ<strong>æ–¹æ³•åŒºå­˜åœ¨äºå…ƒç©ºé—´(Metaspace)</strong>ã€‚åŒæ—¶ï¼Œå…ƒç©ºé—´ä¸å†ä¸å †è¿ç»­ï¼Œ<strong>è€Œä¸”æ˜¯å­˜åœ¨äºæœ¬åœ°å†…å­˜ï¼ˆNative memoryï¼‰ã€‚æœ¬åœ°å†…å­˜ï¼ˆNative memoryï¼‰ï¼Œä¹Ÿç§°ä¸ºC-Heap</strong>ï¼Œæ˜¯ä¾›JVMè‡ªèº«è¿›ç¨‹ä½¿ç”¨çš„ã€‚å½“Java Heapç©ºé—´ä¸è¶³æ—¶ä¼šè§¦å‘GCï¼Œä½†Native memoryç©ºé—´ä¸å¤Ÿå´ä¸ä¼šè§¦å‘GCã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/image-20210906224848120.png" alt="image-20210906224848120" style="zoom:50%;" /><p><strong>å…ƒç©ºé—´å­˜åœ¨äºæœ¬åœ°å†…å­˜ï¼Œæ„å‘³ç€åªè¦æœ¬åœ°å†…å­˜è¶³å¤Ÿï¼Œå®ƒä¸ä¼šå‡ºç°åƒæ°¸ä¹…ä»£ä¸­â€œjava.lang.OutOfMemoryError: PermGen spaceâ€è¿™ç§é”™è¯¯ã€‚çœ‹ä¸Šå›¾ä¸­çš„æ–¹æ³•åŒºï¼Œæ˜¯ä¸æ˜¯â€œè†¨èƒ€â€äº†</strong>ã€‚</p></li></ul><h5 id="3-2-ç¨‹åºè®¡æ•°å™¨å­˜å“ªäº›ä¸œè¥¿ï¼Ÿèƒ½ä¸ºç©ºå—ï¼Ÿ">3.2 <strong>ç¨‹åºè®¡æ•°å™¨å­˜å“ªäº›ä¸œè¥¿ï¼Ÿèƒ½ä¸ºç©ºå—</strong>ï¼Ÿ</h5><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ç”¨äºå­˜æ”¾ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€åœ¨å•å…ƒçš„åœ°å€çš„åœ°æ–¹ã€‚</p><p>å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼ä¸ºç©ºï¼ˆUbdifinedï¼‰ã€‚</p><h4 id="4-ï¼ˆæ–°ï¼‰è¯´ä¸€ä¸‹Javaåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Ÿ">4. ï¼ˆæ–°ï¼‰è¯´ä¸€ä¸‹Javaåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/05/16/EBIujUDhkF9VRtg.png" alt="image-20210516205754856"></p><ol><li><p><strong>ç±»åŠ è½½æ£€æŸ¥</strong>ï¼š è™šæ‹Ÿæœºé‡åˆ°â¼€æ¡ new æŒ‡ä»¤æ—¶ï¼Œâ¾¸å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨<strong>å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨</strong>ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„<strong>ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡</strong>ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p></li><li><p><strong>åˆ†é…å†…å­˜</strong>ï¼š åœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°â½£å¯¹è±¡åˆ†é…å†…å­˜ã€‚å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠâ¼€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» <u>Java å †ä¸­åˆ’åˆ†å‡ºæ¥</u>ã€‚</p><blockquote><p><strong>ï¼ˆé‡è¦ï¼‰åˆ†é…æ–¹å¼æœ‰ â€œæŒ‡é’ˆç¢°æ’â€ å’Œ â€œç©ºé—²åˆ—è¡¨â€ ä¸¤ç§</strong>ï¼Œé€‰æ‹©é‚£ç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´â¼œç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®šã€‚</p><p><img src="https://i.loli.net/2021/05/16/S27KdREVrpGqt5I.png" alt="image-20210516210222497"></p></blockquote></li><li><p><strong>åˆå§‹åŒ–å¯¹è±¡å­—æ®µé›¶å€¼</strong>ã€‚ å†…å­˜åˆ†é…å®Œæˆåï¼Œè¿›è¡Œå¯¹è±¡åˆå§‹åŒ–æ“ä½œã€‚</p><blockquote><p>ä¾‹å¦‚ç»™<strong>å¯¹è±¡ä¸­ï¼ˆåŒºåˆ†ç±»åŠ è½½è¿‡ç¨‹ï¼Œåˆå§‹åŒ–ç±»å˜é‡</strong>ï¼‰æ‰€æœ‰çš„åŸºæœ¬æ•°æ®å˜é‡èµ‹ä¸Šåˆå§‹åŒ–å€¼ï¼Œ å½“æˆ‘ä»¬æ²¡æœ‰å¯¹å®ƒä»¬è¿›è¡Œèµ‹å€¼æ“ä½œæ—¶å°±å¯ä»¥ä½¿ç”¨å¯¹è±¡äº†ã€‚</p></blockquote></li><li><p><strong>è®¾ç½®å¯¹è±¡å¤´</strong>ï¼š åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯<u>å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œå—ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯</u>ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨<u>åå‘é”</u>ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚</p></li><li><p><strong>æ‰§è¡Œinit() &amp; æ„é€ å‡½æ•°</strong>ã€‚ç„¶åæ‰§è¡Œå¯¹è±¡å†…éƒ¨ç”Ÿæˆçš„initæ–¹æ³•ï¼Œç„¶åæ‰§è¡Œæ„é€ å™¨æ–¹æ³•ï¼ˆç¨‹åºå‘˜è®¾ç½®çš„ï¼‰ã€‚</p></li><li><p><strong>å†…å­˜åœ°å€èµ‹ç»™å¼•ç”¨</strong>ï¼š åœ¨è™šæ‹Ÿæœºä¼šå°†åˆšåˆ›å»ºå¥½å¯¹è±¡çš„å†…å­˜åœ°å€èµ‹ç»™å¼•ç”¨å¯¹è±¡ã€‚å®Œæˆæ­¤æ“ä½œåï¼Œä¾¿å¯ä»¥åœ¨ç¨‹åºä¸­é€šè¿‡å¼•ç”¨è®¿é—®å¯¹è±¡çš„å®ä¾‹æ•°æ®ã€‚</p></li></ol><h5 id="4-1-ä»€ä¹ˆæ˜¯æŒ‡é’ˆç¢°æ’ï¼Ÿç©ºé—²åˆ—è¡¨ï¼ŸTLAB">4.1 ä»€ä¹ˆæ˜¯æŒ‡é’ˆç¢°æ’ï¼Ÿç©ºé—²åˆ—è¡¨ï¼ŸTLAB?</h5><p>ä¸‰ç§è™šæ‹Ÿæœº<strong>åˆ’åˆ†å †å†…å­˜</strong>åŒºåŸŸçš„æ–¹æ³•ï¼ŒTLABä¹Ÿå¯ç”¨æ¥ç»™å †å†…å­˜åˆ†é…ç©ºé—´ã€‚</p><ul><li><p><strong>æŒ‡é’ˆç¢°æ’</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒJVMçš„å¯¹è±¡éƒ½æ”¾åœ¨å †å†…å­˜ä¸­ï¼ˆå‘ç”Ÿé€ƒé€¸åˆ†æé™¤å¤–ï¼‰ã€‚å½“ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼ŒJavaè™šæ‹Ÿæœºå¼€å§‹ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚</p><ul><li>å¦‚æœJavaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰è¢«<strong>ä½¿ç”¨è¿‡çš„çš„å†…å­˜éƒ½è¢«æ”¾åˆ°ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾åˆ°å¦å¤–ä¸€è¾¹</strong>ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ª<strong>æŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹</strong>çš„æŒ‡ç¤ºå™¨ï¼Œ<u>æ‰€åˆ†é…å†…å­˜ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´æ–¹å‘æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„å®ä¾‹</u>ï¼Œè¿™ç§åˆ†é…æ–¹å¼å°±æ˜¯æŒ‡é’ˆç¢°æ’ã€‚</li></ul></li><li><p><strong>ç©ºé—²åˆ—è¡¨</strong></p><p><u>å¦‚æœJavaå †å†…å­˜ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯è§„æ•´çš„</u>ï¼Œå·²è¢«ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™åœ¨ä¸€èµ·ï¼Œ<u>ä¸å¯ä»¥è¿›è¡ŒæŒ‡é’ˆç¢°æ’</u>ã€‚</p><ul><li>è™šæ‹Ÿæœºå¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œ<strong>è®°å½•å“ªäº›å†…å­˜æ˜¯å¯ç”¨çš„</strong>ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨æ‰¾åˆ°ä¸€å—å¤§çš„ç©ºé—´åˆ†é…ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ï¼Œè¿™ç§åˆ†é…æ–¹å¼å°±æ˜¯ç©ºé—²åˆ—è¡¨ã€‚</li></ul></li><li><p><strong>TLAB</strong></p><p>TLAB æ˜¯è™šæ‹Ÿæœºåœ¨å†…å­˜çš„<u><strong>eden åŒº</strong>åˆ’åˆ†å‡ºæ¥çš„ä¸€å—ä¸“ç”¨ç©ºé—´ï¼Œæ˜¯çº¿ç¨‹ä¸“å±çš„</u>ã€‚ åœ¨å¯ç”¨TLAB çš„æƒ…å†µä¸‹ï¼Œå½“çº¿ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œè™šæ‹Ÿæœºä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—TLAB ç©ºé—´ï¼Œåªç»™å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½å•ç‹¬æ‹¥æœ‰ä¸€ä¸ªç©ºé—´ï¼Œå¦‚æœéœ€è¦åˆ†é…å†…å­˜ï¼Œå°±åœ¨è‡ªå·±çš„ç©ºé—´ä¸Šåˆ†é…ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨ç«äº‰çš„æƒ…å†µï¼Œå¯ä»¥å¤§å¤§æé«˜åˆ†é…æ•ˆç‡ã€‚</p><blockquote><p>è™šæ‹Ÿæœºé€šè¿‡ -XX:UseTLAB è®¾å®šå®ƒçš„ã€‚</p></blockquote></li></ul><h5 id="4-2-JVMå¦‚ä½•ä¿è¯å¯¹è±¡åˆ†é…çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ">4.2 JVMå¦‚ä½•ä¿è¯å¯¹è±¡åˆ†é…çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</h5><p>å› ä¸ºåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆ›å»ºå¯¹è±¡æ˜¯å¾ˆé¢‘ç¹çš„äº‹æƒ…ï¼Œä½œä¸ºè™šæ‹Ÿæœºæ¥è¯´ï¼Œå¿…é¡»è¦ä¿è¯çº¿ç¨‹æ˜¯å®‰å…¨çš„ï¼Œé€šå¸¸æ¥è®²ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨ä¸¤ç§æ–¹å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š</p><ul><li><strong>TLAB</strong>ï¼š ä¸º<strong>æ¯â¼€ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨EdenåŒºåˆ†é…â¼€å—â¼‰å†…å­˜TLAB</strong>ï¼ŒJVMåœ¨<strong>ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œâ¾¸å…ˆåœ¨TLABåˆ†é…</strong>ï¼Œå½“<u>å¯¹è±¡å¤§äºTLABä¸­çš„å‰©ä½™å†…å­˜æˆ–TLABçš„å†…å­˜å·²ç”¨å°½æ—¶</u>ï¼Œå†é‡‡ç”¨çš„CASè¿›è¡Œå†…å­˜åˆ†é…ã€‚</li><li><strong>CAS+å¤±è´¥é‡è¯•</strong>ï¼š CAS æ˜¯ä¹è§‚é”çš„â¼€ç§å®ç°æ–¹å¼ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯ï¼Œæ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºâ½Œã€‚è™šæ‹Ÿæœºé‡‡ç”¨ CAS é…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ã€‚</li></ul><h4 id="5-æè¿°ä¸€ä¸‹å¯¹è±¡åˆ†é…ã€åŸåˆ™ã€‘ï¼Ÿï¼ˆåŒºåˆ†å‰é¢newå¯¹è±¡ã€è¿‡ç¨‹ã€‘ï¼‰">5.<strong>æè¿°ä¸€ä¸‹å¯¹è±¡åˆ†é…ã€åŸåˆ™ã€‘ï¼Ÿï¼ˆåŒºåˆ†å‰é¢newå¯¹è±¡ã€è¿‡ç¨‹ã€‘</strong>ï¼‰</h4><p>JVM ä¸­çš„å †å¯åˆ’åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œ<u>æ–°ç”Ÿä»£å’Œè€å¹´ä»£</u>ï¼Œå¤§å°æ¯”ä¾‹ä¸º1:2ï¼š</p><ul><li>æ–°ç”Ÿä»£åˆ†ä¸º Eden åŒºå’Œ Survivor åŒºï¼Œ Survivor å¹¸å­˜è€…åŒºåˆåˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å— from å’Œ to åŒº</li></ul><p><img src="https://i.loli.net/2021/05/05/6Ri9BzxGtLpFemP.png" alt="img"></p><p>å…·ä½“å›æ”¶è¿‡ç¨‹ï¼š</p><p><img src="https://i.loli.net/2021/04/19/p2LqRv6krQnbga4.png" alt="image-20210419224230046"></p><p>å¯¹è±¡çš„æ­£å¸¸æµç¨‹ï¼š<em>Eden åŒº -&gt; Survivor åŒº -&gt; è€å¹´ä»£</em>ã€‚</p><ol><li>æ–°çš„å¯¹è±¡<strong>ä¼˜å…ˆåœ¨ Eden åŒºåˆ†é…</strong>ï¼ˆ<em>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´åŒºï¼Œé¿å…åœ¨EdenåŒºåŠä¸¤ä¸ªSurvivoråŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶</em>ï¼‰ ,<strong>å½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´æ—¶</strong>ï¼Œä¼šå‘èµ·ä¸€æ¬¡<em><strong>Minor GC</strong></em>ï¼›</li><li><em><strong>Minor GC</strong></em>é‡‡ç”¨<strong>å¤åˆ¶å›æ”¶ç®—æ³•</strong>çš„æ”¹è¿›ç‰ˆæœ¬å›æ”¶Edenä¸­å¯¹è±¡ï¼š<ul><li>å…ˆå°†Edenå­˜æ´»å¯¹è±¡è¿ç§»åˆ° to åŒºï¼Œç„¶åæ¸…ç©ºEden</li><li>æœ€åäº¤æ¢toå’ŒfromåŒºåŸŸ<strong>æ ‡ç­¾</strong></li></ul></li><li>æ¯ç»è¿‡ä¸€æ¬¡<em><strong>Minor GC</strong></em>  ï¼ˆåœ¨äº¤æ¢åŒºï¼‰åå¯¹è±¡å¹´é¾„åŠ 1ï¼Œå¯¹è±¡å¹´é¾„è¾¾åˆ°<em><strong>15æ¬¡</strong></em>åå°†ä¼šæ™‹å‡åˆ°è€å¹´ä»£ï¼›</li><li>å¯¹è±¡æå‰æ™‹å‡åˆ°è€å¹´ä»£ï¼ŒåŠ¨æ€å¹´é¾„åˆ¤å®šï¼šå¦‚æœåœ¨ Survivor åŒºä¸­ç›¸<u>åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°æ€»å’Œå¤§äº Survivor åŒºå¤§å°çš„ä¸€åŠ</u>ï¼Œ å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼›</li><li>è€å¹´ä»£ç©ºé—´ä¸å¤Ÿæ—¶è¿›è¡Œ<em><strong>Full GC</strong></em>ã€‚</li></ol><h5 id="5-1-å¯¹è±¡ä¸€å®šåˆ†é…åˆ°å †ä¸Šå—ï¼Ÿ">5.1 å¯¹è±¡ä¸€å®šåˆ†é…åˆ°å †ä¸Šå—ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzAxOTQxOTc5NQ==&amp;mid=2650500024&amp;idx=1&amp;sn=0997c486387bf56bbe8ca909d55a7edf&amp;chksm=83c88c44b4bf05521d66f6a396550cd9c8379c3fdddee1ee198968f6a9ddd172550d3329a94d&amp;scene=21#wechat_redirect">é¢è¯•å®˜ï¼šæ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡å’Œæ•°ç»„éƒ½ä¼šåœ¨å †å†…å­˜åˆ†é…ç©ºé—´</a></p></blockquote><blockquote><p>å°ä¼™ï¼Œæ¥ç»™æˆ‘è®²ä¸€ä¸‹æ˜¯ä¸æ˜¯<strong>æ‰€æœ‰çš„å¯¹è±¡å’Œæ•°ç»„</strong>éƒ½ä¼šåœ¨å †å†…å­˜åˆ†é…ç©ºé—´ï¼Ÿ</p></blockquote><p>å¹¶ä¸æ˜¯ï¼Œè¿™æ¶‰åŠåˆ°<strong>å¯¹è±¡é€ƒé€¸</strong>ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><p>StringBufferå¯¹è±¡ï¼Œæœ€ç»ˆä¼šè¢«returnï¼Œä¹Ÿå°±æ˜¯<strong>ä¼šè¢«è¯¥æ–¹æ³•ä¹‹å¤–çš„ç»™åˆ©ç”¨</strong>ã€‚ å‘ç”Ÿäº†å¯¹è±¡é€ƒé€¸ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/640" alt="å›¾ç‰‡"></p><p><strong>åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡æ˜¯åœ¨Javaå †ä¸­åˆ†é…å†…å­˜çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®éçš„å¸¸è¯†</strong>ã€‚ ä½†æ˜¯ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œé‚£å°±æ˜¯å¦‚æœç»è¿‡é€ƒé€¸åˆ†æåå‘ç°ï¼Œä¸€<strong>ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯</strong>ï¼Œé‚£ä¹ˆå°±å¯èƒ½è¢«<strong>ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…</strong>ã€‚</p><h4 id="6-å¯¹è±¡çš„è®¿é—®å®šä½æœ‰å“ªä¸¤ç§æ–¹å¼">6.<strong>å¯¹è±¡çš„è®¿é—®å®šä½æœ‰å“ªä¸¤ç§æ–¹å¼</strong>?</h4><p>å»ºâ½´å¯¹è±¡å°±æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬çš„Javaç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡çš„è®¿é—®æ–¹å¼æœ‰è™šæ‹Ÿæœºå®ç°è€Œå®šï¼Œâ½¬å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰ï¼š<strong>â‘ ä½¿ç”¨å¥æŸ„å’Œ â‘¡ç›´æ¥æŒ‡é’ˆä¸¤ç§</strong>ã€‚</p><ol><li><p><strong>å¥æŸ„</strong>ï¼š å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆJavaå †ä¸­å°†ä¼šåˆ’åˆ†å‡ºâ¼€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯<strong>å¯¹è±¡çš„å¥æŸ„åœ°å€</strong>ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†<strong>å¯¹è±¡å®ä¾‹æ•°æ®</strong>ä¸<strong>ç±»å‹æ•°æ®ï¼ˆå­˜æ”¾åœ¨æ–¹æ³•åŒº</strong>ï¼‰å„â¾ƒçš„å…·ä½“åœ°å€ä¿¡æ¯ï¼›</p><blockquote><p>ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/16/4XShu2w1nRbZl5x.png" alt="image-20210516211902118"></p></li><li><p><strong>ç›´æ¥æŒ‡é’ˆ</strong>ï¼š å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œé‚£ä¹ˆ Java å †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œ<strong>è€Œreference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€</strong>ã€‚</p><blockquote><p>ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†â¼€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/16/lTvrqnOFu5X9VJk.png" alt="image-20210516212141885"></p></li></ol><h4 id="7-å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦éœ€è¦å›æ”¶ï¼ˆæ­»äº¡ï¼‰ï¼Ÿ">7.<strong>å¦‚ä½•åˆ¤æ–­å¯¹è±¡æ˜¯å¦éœ€è¦å›æ”¶ï¼ˆæ­»äº¡</strong>ï¼‰ï¼Ÿ</h4><ul><li><strong>å¯è¾¾æ€§åˆ†æ</strong>ï¼šæ ¹æ®å¼•ç”¨çš„å…³ç³»æ„é€ å¼•ç”¨é“¾ï¼ˆæœ‰å‘å›¾ï¼‰ï¼Œåœ¨å›¾ä¸­ä¸å¯è¾¾çš„å¯¹è±¡å°±æ˜¯è¦è¢«å›æ”¶çš„ï¼›</li><li><strong>å¼•ç”¨è®¡æ•°</strong>ï¼šæœ‰åœ°æ–¹å¼•ç”¨è¯¥å¯¹è±¡ï¼Œè®¡æ•°å™¨++ï¼Œå¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨â€“ï¼Œæœ‰å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</li></ul><h4 id="8-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå˜é‡ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨ç±»ï¼Ÿ">8. å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå˜é‡ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨ç±»ï¼Ÿ</h4><ul><li><p><strong>åˆ¤æ–­å¸¸é‡æ˜¯åºŸå¼ƒå˜é‡</strong></p><p>è¿è¡Œæ—¶å¸¸é‡æ± ä¸»è¦å›æ”¶çš„æ˜¯åºŸå¼ƒçš„å¸¸é‡ã€‚</p><p>å‡å¦‚åœ¨å¸¸é‡æ± ä¸­å­˜åœ¨å­—ç¬¦ä¸² â€œabcâ€ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ä»»ä½•Stringå¯¹è±¡å¼•ç”¨è¯¥å­—ç¬¦ä¸²å¸¸é‡çš„è¯ï¼Œå°±è¯´æ˜å¸¸é‡&quot;abc&quot; å°±æ˜¯åºŸå¼ƒå¸¸é‡ï¼Œå¦‚æœè¿™æ—¶å‘â½£å†…å­˜å›æ”¶çš„è¯è€Œä¸”æœ‰å¿…è¦çš„è¯ï¼Œâ€œabcâ€ å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± ã€‚</p></li><li><p><strong>åˆ¤æ–­ç±»æ˜¯æ— ç”¨ç±»</strong>ï¼Ÿ</p><p>è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸‹é¢3ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™â¾¥è¯´çš„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡â¼€æ ·ä¸ä½¿ç”¨äº†å°±ä¼šå¿…ç„¶è¢«å›æ”¶ã€‚</p><ul><li><p>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ï¼›</p></li><li><p>åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ï¼›</p></li><li><p>è¯¥ç±»å¯¹åº”çš„ java.lang.Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</p></li></ul></li></ul><h3 id="1-6-1-GCç›¸å…³">1.6.1 GCç›¸å…³</h3><blockquote><p>ä¸é”™çš„GCä»‹ç»æ–‡ç« ï¼š<a href="https://www.infoq.cn/article/3wyretkqrhivtw4frmr3">ä¸€æ–‡çœ‹æ‡‚ JVM å†…å­˜å¸ƒå±€åŠ GC åŸç†</a></p></blockquote><h4 id="1-è¯·ä»‹ç»GCåŸºæœ¬åŸç†ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼ŸGCå¯ä»¥é©¬ä¸Šå›æ”¶å†…å­˜å—ï¼Ÿå¦‚ä½•ä¸»åŠ¨è®©è™šæ‹Ÿæœºå›æ”¶ï¼Ÿ">1.<strong>è¯·ä»‹ç»GCåŸºæœ¬åŸç†ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼ŸGCå¯ä»¥é©¬ä¸Šå›æ”¶å†…å­˜å—ï¼Ÿå¦‚ä½•ä¸»åŠ¨è®©è™šæ‹Ÿæœºå›æ”¶</strong>ï¼Ÿ</h4><p>å½“ç¨‹åºå‘˜åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒGCå°±å¼€å§‹ç›‘æ§è¿™ä¸ªå¯¹è±¡çš„<u>åœ°å€ã€å¤§å°</u>åŠ<u>ä½¿ç”¨æƒ…å†µ</u> ï¼Œå½“GCç¡®å®šä¸€äº›å¯¹è±¡ä¸ºâ€ä¸å¯è¾¾â€æ—¶ï¼ŒGCå°±æœ‰è´£ä»»å›æ”¶è¿™äº›å†…å­˜ç©ºé—´ ï¼š</p><ul><li><strong>åŸºæœ¬åŸç†</strong>ï¼š GCé‡‡ç”¨<u><strong>æœ‰å‘å›¾</strong></u>çš„æ–¹å¼è®°å½•å’Œç®¡ç†<strong>å †(heap)<strong>ä¸­çš„æ‰€æœ‰å¯¹è±¡ ï¼Œå¹¶ç¡®å®šå¯¹è±¡</strong>æ˜¯å¦â€œå¯è¾¾â€</strong></li><li><strong>GCä¼˜ç‚¹</strong>ï¼šï¼ˆ1ï¼‰ä½¿å¾—ç¨‹åºå‘˜ä¸ç”¨è€ƒè™‘å†…å­˜ç®¡ç† ï¼ˆ2ï¼‰Javaä¸­çš„å¯¹è±¡ä¸å†æœ‰&quot;ä½œç”¨åŸŸ&quot;çš„æ¦‚å¿µï¼Œåªæœ‰å¯¹è±¡çš„å¼•ç”¨æ‰æœ‰&quot;ä½œç”¨åŸŸ&quot; ï¼ˆ3ï¼‰æœ‰æ•ˆé˜²æ­¢å†…å­˜æ³„æ¼</li><li><strong>é©¬ä¸Šå›æ”¶</strong>ï¼š ç¨‹åºå‘˜<strong>ä¸èƒ½å®æ—¶</strong>çš„è°ƒç”¨åƒåœ¾å›æ”¶å™¨å¯¹æŸä¸ªå¯¹è±¡æˆ–æ‰€æœ‰å¯¹è±¡è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</li><li><strong>ä¸»åŠ¨å›æ”¶</strong>ï¼š æ‰‹åŠ¨æ‰§è¡Œ<code>System.gc()</code> ï¼Œä½†æ˜¯Javaè¯­è¨€è§„èŒƒ <u>å¹¶ä¸ä¿è¯</u> GCä¸€å®šä¼šæ‰§è¡Œã€‚</li></ul><h5 id="1-1-æœ¬åœ°javaç¨‹åºé»˜è®¤å¯åŠ¨çš„æ˜¯ä»€ä¹ˆåƒåœ¾å›æ”¶å™¨ï¼Ÿ">1.1 æœ¬åœ°javaç¨‹åºé»˜è®¤å¯åŠ¨çš„æ˜¯ä»€ä¹ˆåƒåœ¾å›æ”¶å™¨ï¼Ÿ</h5><p>cmdæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintCommandLineFlags -version</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š<a href="http://codewenda.com/xx%EF%BC%9Auseparallelgc%E5%92%8C-xx%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9A-useparnewgc/">-XXï¼šUseParallelGC</a>ã€‚</p><h4 id="2-ä»€ä¹ˆæ˜¯GC-Rootï¼Ÿå¯ä»¥ä½œä¸ºGC-Rootçš„å¯¹è±¡ï¼Ÿ">2.<strong>ä»€ä¹ˆæ˜¯GC Rootï¼Ÿå¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡</strong>ï¼Ÿ</h4><ul><li><p><strong>GC Root <strong>ï¼š  åˆ¤æ–­å¯¹è±¡æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æï¼Œæ‰€ä»¥æ‰€æœ‰çš„å¯è¾¾æ€§ç®—æ³•</strong>éƒ½ä¼šæœ‰èµ·ç‚¹</strong> ï¼Œè¿™å°±æ˜¯ GC Rootã€‚</p><ul><li><strong>ç‰¹ç‚¹</strong>ï¼šå½“å‰æ—¶åˆ»å­˜æ´»çš„å¯¹è±¡ï¼</li></ul><p>é€šè¿‡GC Root æ‰¾å‡ºæ‰€æœ‰æ´»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå‰©ä¸‹æ‰€æœ‰çš„æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡å°±æ˜¯éœ€è¦å›æ”¶çš„å¯¹è±¡ã€‚</p><p><img src="https://pic1.zhimg.com/80/v2-38552a00d9bfb53f0c780e26a0d4b078_720w.jpg" alt="img"></p></li><li><p><strong>GC Rootå¯¹è±¡</strong>ï¼š ï¼ˆ1ï¼‰è™šæ‹Ÿæœºæ ˆä¸­<strong>å¼•ç”¨</strong>çš„<strong>å¯¹è±¡</strong>ï¼›ï¼ˆ2ï¼‰æ–¹æ³•åŒºä¸­çš„<strong>é™æ€</strong>å˜é‡ã€<strong>å¸¸é‡</strong>å¯¹è±¡ï¼›ï¼ˆ3ï¼‰æœ¬åœ°æ–¹æ³•<strong>å¼•ç”¨</strong>çš„<strong>å¯¹è±¡</strong>ï¼›ï¼ˆ4ï¼‰è¢«<code>synchronized</code>ä¿®é¥°çš„å¯¹è±¡ç­‰ã€‚</p></li></ul><h4 id="3-å“ªäº›å†…å­˜åŒºåŸŸéœ€è¦GC">3.<strong>å“ªäº›å†…å­˜åŒºåŸŸéœ€è¦GC?</strong></h4><ul><li><p><strong>ï¼ˆæ— éœ€ï¼‰çº¿ç¨‹ç‹¬äº«åŒºåŸŸ</strong>ï¼š<code>PC Regiesterã€JVM Stackã€Native Method Stack</code>ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸéƒ½ä¸çº¿ç¨‹ç›¸åŒï¼ˆå³ï¼šä¸çº¿ç¨‹å…±ç”Ÿæ­»ï¼‰ï¼Œæ‰€ä»¥æ— éœ€ GC;</p></li><li><p><strong>ï¼ˆéœ€ï¼‰çº¿ç¨‹å…±äº«</strong>çš„ Heap åŒºã€Method Area åˆ™æ˜¯ GC å…³æ³¨çš„é‡ç‚¹å¯¹è±¡ã€‚</p></li></ul><p><img src="https://static001.infoq.cn/resource/image/e3/71/e36c624e8b4300775123f95a34b86571.png" alt="img"></p><h4 id="4-ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘Full-GCï¼Ÿ">4.<strong>ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘Full GCï¼Ÿ</strong></h4><ol><li><p><strong>è°ƒç”¨ System.gc()</strong> ï¼›</p></li><li><p><strong>è€å¹´ä»£ç©ºé—´ä¸è¶³</strong>ï¼›</p></li><li><p><strong>é€šè¿‡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</strong>ï¼›</p><blockquote><p>å¦‚æœå‘ç°<strong>ç»Ÿè®¡ä¹‹å‰Minor GCçš„å¹³å‡æ™‹å‡å¤§å°æ¯”ç›®å‰old genå‰©ä½™çš„ç©ºé—´å¤§</strong>ï¼Œåˆ™ä¸ä¼šè§¦å‘Minor GCè€Œæ˜¯è½¬ä¸ºè§¦å‘full GCã€‚</p></blockquote></li><li><p><strong>æ–¹æ³•åŒºç©ºé—´ä¸è¶³</strong>ã€‚</p><blockquote><p>JVMè§„èŒƒä¸­è¿è¡Œæ—¶æ•°æ®åŒºåŸŸä¸­çš„æ–¹æ³•åŒºï¼Œåœ¨HotSpotè™šæ‹Ÿæœºä¸­åˆè¢«ä¹ æƒ¯ç§°ä¸ºæ°¸ç”Ÿä»£æˆ–è€…æ°¸ç”ŸåŒºï¼ŒPermanet Generationä¸­å­˜æ”¾çš„ä¸ºä¸€äº›<u><strong>classçš„ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®</strong></u>ï¼Œå½“ç³»ç»Ÿä¸­<strong>è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤š</strong>æ—¶ï¼ŒPermanet Generationå¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨CMS GCçš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§è¡ŒFull GCã€‚å¦‚æœç»è¿‡Full GCä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆJVMä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š<code>java.lang.OutOfMemoryError: PermGen space</code> ã€‚<br>ä¸ºé¿å…Perm Genå æ»¡é€ æˆFull GCç°è±¡ï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§Perm Genç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨CMS GCã€‚</p></blockquote></li></ol><h4 id="5-ä»€ä¹ˆæ—¶å€™è§¦å‘-Minor-GC-ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´minor-gcè¿è¡Œé¢‘ç¹ï¼ŸåŒæ ·çš„ï¼Œä»€ä¹ˆåŸå› åˆä¼šå¯¼è‡´minor-gcè¿è¡Œå¾ˆæ…¢ï¼Ÿ">5.<strong>ä»€ä¹ˆæ—¶å€™è§¦å‘ Minor GC ? ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´minor gcè¿è¡Œé¢‘ç¹ï¼ŸåŒæ ·çš„ï¼Œä»€ä¹ˆåŸå› åˆä¼šå¯¼è‡´minor gcè¿è¡Œå¾ˆæ…¢</strong>ï¼Ÿ</h4><ul><li><p><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘Minor GC ?</strong></p><p><strong>å½“EdenåŒºä¸è¶³æ—¶</strong>å°±ä¼šè§¦å‘ Minor GC ã€‚</p></li><li><p><strong>minor gcè¿è¡Œé¢‘ç¹</strong></p></li></ul><ol><li><p>äº§ç”Ÿäº†å¤ªå¤šæœç”Ÿå¤•ç­çš„å¯¹è±¡å¯¼è‡´éœ€è¦é¢‘ç¹minor gc</p></li><li><p>æ–°ç”Ÿä»£ç©ºé—´è®¾ç½®å¤ªå°</p></li></ol><ul><li><p><strong>minor gcè¿è¡Œå¾ˆæ…¢</strong></p><ol><li><u>æ–°ç”Ÿä»£ç©ºé—´è®¾ç½®è¿‡å¤§</u>ï¼›</li><li><u>å¯¹è±¡å¼•ç”¨é“¾è¾ƒé•¿</u>ï¼Œè¿›è¡Œå¯è¾¾æ€§åˆ†ææ—¶é—´è¾ƒé•¿ï¼›</li><li><u>æ–°ç”Ÿä»£survivoråŒºè®¾ç½®çš„æ¯”è¾ƒå°</u>ï¼Œæ¸…ç†åå‰©ä½™çš„å¯¹è±¡ä¸èƒ½è£…è¿›å»éœ€è¦ç§»åŠ¨åˆ°è€å¹´ä»£ï¼Œé€ æˆç§»åŠ¨å¼€é”€ï¼›</li><li><u>å†…å­˜åˆ†é…æ‹…ä¿å¤±è´¥</u>ï¼Œç”±minor gcè½¬åŒ–ä¸ºfull gcï¼›</li><li><u>é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ•ˆç‡è¾ƒä½</u>ï¼Œæ¯”å¦‚æ–°ç”Ÿä»£ä½¿ç”¨serialæ”¶é›†å™¨ã€‚</li></ol></li></ul><h4 id="6-æè¿°ä¸€ä¸‹GCç®—æ³•ï¼Ÿ">6.<strong>æè¿°ä¸€ä¸‹GCç®—æ³•</strong>ï¼Ÿ</h4><p>GCç®—æ³•åŒ…å«ï¼šå¼•ç”¨è®¡æ•°æ³•ï¼Œæ ‡è®°æ¸…é™¤ï¼Œæ ‡è®°å¤åˆ¶ï¼Œæ ‡è®°å‹ç¼©ã€‚</p><ul><li><strong>å¼•ç”¨è®¡æ•°</strong>ï¼šå¯¹äºä¸€ä¸ªå¯¹è±¡Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†Aï¼Œåˆ™Açš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ 1ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡1ã€‚åªè¦å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ä¸º0ï¼Œåˆ™å¯¹è±¡Aå°±ä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼›</li><li><strong>æ ‡è®°æ¸…é™¤</strong>ï¼š åƒåœ¾å›æ”¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°é˜¶æ®µå’Œæ¸…é™¤é˜¶æ®µã€‚åœ¨æ ‡è®°é˜¶æ®µï¼Œé¦–å…ˆé€šè¿‡æ ¹èŠ‚ç‚¹ï¼Œæ ‡è®°æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„å¯è¾¾å¯¹è±¡ï¼›ç„¶åï¼Œåœ¨æ¸…é™¤é˜¶æ®µï¼Œ<u>æ¸…é™¤æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œ<strong>ä½†ä¼šäº§ç”Ÿå¾ˆå¤šåƒåœ¾ç¢ç‰‡</strong></u> ï¼›</li><li><strong>æ ‡è®°å¤åˆ¶</strong>ï¼š å°†å†…å­˜å¯¹åŠåˆ†ï¼Œæ€»æ˜¯<strong>ä¿ç•™ä¸€å—ç©ºç€</strong>ï¼ˆä¸Šå›¾ä¸­çš„å³ä¾§ï¼‰ï¼Œå°†å·¦ä¾§å­˜æ´»çš„å¯¹è±¡ï¼ˆæµ…ç°è‰²åŒºåŸŸï¼‰å¤åˆ¶åˆ°å³ä¾§ã€‚<strong>é¿å…äº†å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä½†æ˜¯å†…å­˜æµªè´¹å¾ˆä¸¥é‡</strong>ï¼Œ<u>ç›¸å½“äºåªèƒ½ä½¿ç”¨ 50%çš„å†…å­˜</u>ï¼›</li><li><strong>æ ‡è®°å‹ç¼©ï¼ˆæ ‡è®°æ•´ç†</strong>ï¼‰ï¼šæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸<u>â€œæ ‡è®°-æ¸…é™¤â€</u>ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤<strong>ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†</strong>ï¼Œè€Œæ˜¯è®©<strong>æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨</strong>ï¼Œç„¶å<strong>ç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜</strong>ï¼ˆç±»ä¼¼äº windows çš„ç£ç›˜ç¢ç‰‡æ•´ç†ï¼‰ï¼Œé¿å…åƒåœ¾ç¢ç‰‡ã€‚</li></ul><h5 id="6-1-æ–°ç”Ÿä»£å’Œè€å¹´ä»£ç”¨å“ªäº›ç®—æ³•ï¼Ÿstwé—®é¢˜ä¼šå‘ç”Ÿåœ¨æ–°ç”Ÿä»£å—">6.1 <strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ç”¨å“ªäº›ç®—æ³•ï¼Ÿstwé—®é¢˜ä¼šå‘ç”Ÿåœ¨æ–°ç”Ÿä»£å—?</strong></h5><ul><li><p><strong>é’ˆå¯¹æ–°ç”Ÿä»£ï¼Œé‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://tech.meituan.com/2017/12/29/jvm-optimize.html">https://tech.meituan.com/2017/12/29/jvm-optimize.html</a></p></blockquote><p>å¤§å¤šæ•°å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­è¢«åˆ›å»ºï¼Œå…¶ä¸­å¾ˆå¤šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ã€‚<strong>æ¯æ¬¡æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼ˆåˆç§°Minor GCï¼‰ååªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»</strong>ï¼Œæ‰€ä»¥é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦<strong>å°‘é‡çš„å¤åˆ¶æˆæœ¬</strong>å°±å¯ä»¥å®Œæˆå›æ”¶ã€‚</p><p>HotSpotå®ç°çš„<strong>å¤åˆ¶ç®—æ³•æµç¨‹</strong>å¦‚ä¸‹:</p><ol><li>å½“EdenåŒºæ»¡çš„æ—¶å€™,<strong>ä¼šè§¦å‘ç¬¬ä¸€æ¬¡Minor gcï¼ŒæŠŠè¿˜æ´»ç€çš„å¯¹è±¡æ‹·è´åˆ°Survivor FromåŒº</strong>ï¼›å½“EdenåŒº<strong>å†æ¬¡è§¦å‘Minor gc</strong>çš„æ—¶å€™,ä¼šæ‰«æEdenåŒºå’ŒFromåŒºåŸŸï¼Œ<strong>å¯¹ä¸¤ä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶,ç»è¿‡è¿™æ¬¡å›æ”¶åè¿˜å­˜æ´»çš„å¯¹è±¡,åˆ™ç›´æ¥å¤åˆ¶åˆ°ToåŒºåŸŸ</strong>,å¹¶å°†Edenå’ŒFromåŒºåŸŸæ¸…ç©ºã€‚</li><li>å½“åç»­Edenåˆå‘ç”ŸMinor gcçš„æ—¶å€™,ä¼šå¯¹<strong>Edenå’ŒToåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶</strong>,å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°FromåŒºåŸŸ,å¹¶å°†Edenå’ŒToåŒºåŸŸæ¸…ç©ºã€‚</li><li>éƒ¨åˆ†å¯¹è±¡ä¼šåœ¨Fromå’ŒToåŒºåŸŸä¸­å¤åˆ¶æ¥å¤åˆ¶å»ï¼Œ<strong>å¦‚æ­¤äº¤æ¢15æ¬¡</strong>(ç”±JVMå‚æ•°MaxTenuringThresholdå†³å®š,è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯15)ï¼Œæœ€ç»ˆå¦‚æœè¿˜æ˜¯å­˜æ´»,å°±å­˜å…¥åˆ°è€å¹´ä»£ã€‚</li></ol></li><li><p><strong>é’ˆå¯¹è€å¹´ä»£å¯¹è±¡å­˜æ´»ç‡é«˜çš„ç‰¹ç‚¹</strong></p><p>åœ¨æ–°ç”Ÿä»£ä¸­ç»å†äº†Næ¬¡åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå°±ä¼šè¢«æ”¾åˆ°å¹´è€ä»£ï¼Œ<strong>è¯¥åŒºåŸŸä¸­å¯¹è±¡å­˜æ´»ç‡é«˜</strong>ã€‚</p><p>è€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼ˆåˆç§°Major GCï¼‰é€šå¸¸ä½¿ç”¨<strong>æ ‡è®°-æ¸…ç†æˆ–æ ‡è®°-æ•´ç†ç®—æ³•ã€‚æ•´å †åŒ…æ‹¬æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶ç§°ä¸ºFull GC</strong>ï¼ˆHotSpot VMé‡Œï¼Œé™¤äº†CMSä¹‹å¤–ï¼Œå…¶å®ƒèƒ½æ”¶é›†è€å¹´ä»£çš„GCéƒ½ä¼šåŒæ—¶æ”¶é›†æ•´ä¸ªGCå †ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£ï¼‰ã€‚</p></li></ul><h4 id="7-ä»€ä¹ˆæ˜¯Stop-The-World-ä»€ä¹ˆæ˜¯å®‰å…¨ç‚¹ï¼Ÿå®‰å…¨åŒºåŸŸï¼Ÿ">7.<strong>ä»€ä¹ˆæ˜¯Stop The World ?</strong> ä»€ä¹ˆæ˜¯å®‰å…¨ç‚¹ï¼Ÿå®‰å…¨åŒºåŸŸï¼Ÿ</h4><ul><li><p><strong>Stop The World</strong></p><p>è¿›è¡Œ<strong>åƒåœ¾å›æ”¶</strong>çš„è¿‡ç¨‹ä¸­ï¼Œ<u>ä¼š<strong>æ¶‰åŠå¯¹è±¡çš„ç§»åŠ¨ã€‚ä¸ºäº†ä¿è¯å¯¹è±¡å¼•ç”¨æ›´æ–°çš„æ­£ç¡®æ€§</strong>ï¼Œå¿…é¡»æš‚åœæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹</u>ï¼Œåƒè¿™æ ·çš„åœé¡¿ï¼Œè™šæ‹Ÿæœºè®¾è®¡è€…å½¢è±¡æè¿°ä¸ºã€ŒStop The Worldã€ã€‚ä¹Ÿç®€ç§°ä¸ºSTWã€‚JVMåœ¨æš‚åœçš„æ—¶å€™ï¼Œéœ€è¦é€‰å‡†ä¸€ä¸ªæ—¶æœºã€‚</p><p>ç”±äºJVMç³»ç»Ÿè¿è¡ŒæœŸé—´çš„å¤æ‚æ€§ï¼Œä¸å¯èƒ½åšåˆ°éšæ—¶æš‚åœï¼Œå› æ­¤å¼•å…¥äº†<strong>å®‰å…¨ç‚¹</strong>çš„æ¦‚å¿µã€‚</p></li><li><p><strong>å®‰å…¨ç‚¹</strong></p><blockquote><p>å®‰å…¨ç‚¹ï¼Œå³ç¨‹åºï¼ˆéGCå…ˆï¼‰æ‰§è¡Œæ—¶å¹¶éåœ¨æ‰€æœ‰åœ°æ–¹éƒ½èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œåªæœ‰åœ¨åˆ°è¾¾å®‰å…¨ç‚¹æ—¶æ‰èƒ½æš‚åœã€‚</p></blockquote><p>å®‰å…¨ç‚¹çš„åˆå§‹ç›®çš„å¹¶ä¸æ˜¯è®©å…¶ä»–çº¿ç¨‹åœä¸‹ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªç¨³å®šçš„æ‰§è¡ŒçŠ¶æ€ã€‚åœ¨è¿™ä¸ªæ‰§è¡ŒçŠ¶æ€ä¸‹ï¼Œ<strong>Javaè™šæ‹Ÿæœºçš„å †æ ˆä¸ä¼šå‘ç”Ÿå˜åŒ–</strong>ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œ<strong>åƒåœ¾å›æ”¶å™¨ä¾¿èƒ½å¤Ÿâ€œå®‰å…¨â€åœ°æ‰§è¡Œå¯è¾¾æ€§åˆ†æ</strong>ã€‚åªè¦ä¸ç¦»å¼€è¿™ä¸ªå®‰å…¨ç‚¹ï¼ŒJavaè™šæ‹Ÿæœºä¾¿èƒ½å¤Ÿåœ¨åƒåœ¾å›æ”¶çš„åŒæ—¶ï¼Œç»§ç»­è¿è¡Œè¿™æ®µæœ¬åœ°ä»£ç ã€‚</p></li><li><p><strong>å¦‚ä½•ä¿è¯ä¸­æ–­æ—¶æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å®‰å…¨ç‚¹</strong></p><ul><li><p><strong>æŠ¢å…ˆå¼ä¸­æ–­ï¼ˆPreemptive Suspensionï¼‰</strong><br>æŠ¢å…ˆå¼ä¸­æ–­ä¸éœ€è¦çº¿ç¨‹çš„æ‰§è¡Œä»£ç ä¸»åŠ¨å»é…åˆï¼Œåœ¨GCå‘ç”Ÿæ—¶ï¼Œé¦–å…ˆæŠŠæ‰€æœ‰çº¿ç¨‹å…¨éƒ¨ä¸­æ–­ï¼Œ<strong>å¦‚æœå‘ç°æœ‰çº¿ç¨‹ä¸­æ–­çš„åœ°æ–¹ä¸åœ¨å®‰å…¨ç‚¹ä¸Šï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©å®ƒâ€œè·‘â€åˆ°å®‰å…¨ç‚¹ä¸Š</strong>ã€‚ç°åœ¨å‡ ä¹æ²¡æœ‰è™šæ‹Ÿæœºé‡‡ç”¨è¿™ç§æ–¹å¼æ¥æš‚åœçº¿ç¨‹ä»è€Œå“åº”GCäº‹ä»¶ã€‚</p></li><li><p><strong>ä¸»åŠ¨å¼ä¸­æ–­ï¼ˆVoluntary Suspensionï¼‰</strong><br>ä¸»åŠ¨å¼ä¸­æ–­çš„æ€æƒ³æ˜¯å½“GCéœ€è¦ä¸­æ–­çº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¯¹çº¿ç¨‹æ“ä½œï¼Œä»…ä»…ç®€å•åœ°è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå„ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ä¸»åŠ¨å»è½®è¯¢è¿™ä¸ªæ ‡å¿—ï¼Œå‘ç°ä¸­æ–­æ ‡å¿—ä¸ºçœŸæ—¶å°±è‡ªå·±ä¸­æ–­æŒ‚èµ·ã€‚<strong>è½®è¯¢æ ‡å¿—çš„åœ°æ–¹å’Œå®‰å…¨ç‚¹æ˜¯é‡åˆçš„</strong>ï¼Œå¦å¤–å†åŠ ä¸Šåˆ›å»ºå¯¹è±¡éœ€è¦åˆ†é…å†…å­˜çš„åœ°æ–¹ã€‚</p></li></ul></li></ul><h4 id="8-å¸¸è§çš„åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼ˆæ¯”å¦‚G1ï¼‰ï¼Ÿ">8. å¸¸è§çš„åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼ˆæ¯”å¦‚G1ï¼‰ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/05/16/ypmn6LRB5trC3Dl.png" alt="image-20210516215006746"></p><ul><li><p><strong>Serialæ”¶é›†å™¨</strong>ã€‚ Serialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚å¤§å®¶çœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ”¶é›†å™¨æ˜¯â¼€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨äº†ã€‚å®ƒçš„<strong>å•çº¿ç¨‹</strong> çš„æ„ä¹‰ä¸ä»…ä»…æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨â¼€æ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†â¼¯ä½œï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†â¼¯ä½œçš„æ—¶å€™å¿…é¡»<strong>æš‚åœå…¶ä»–æ‰€æœ‰çš„â¼¯ä½œçº¿ç¨‹ï¼ˆ â€œStop The Worldâ€</strong>ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚</p></li><li><p><strong>ParNewæ”¶é›†å™¨</strong>ã€‚ ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯<strong>Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</strong>ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€å›æ”¶ç­–ç•¥ç­‰ç­‰ï¼‰å’ŒSerialæ”¶é›†å™¨å®Œå…¨â¼€æ ·ã€‚</p><ul><li>æ–°â½£ä»£é‡‡ç”¨<u><strong>æ ‡è®°-å¤åˆ¶</strong>ç®—æ³•ï¼Œâ½¼å¹´ä»£é‡‡ç”¨<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•</u>ã€‚</li></ul></li><li><p><strong>Parallel Scavengeæ”¶é›†å™¨</strong>ã€‚ Parallel Scavenge æ”¶é›†å™¨ç±»ä¼¼äºParNew æ”¶é›†å™¨ã€‚ é‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„å‘¢ï¼Ÿ Parallel Scavengeæ”¶é›†å™¨æä¾›äº†å¾ˆå¤šå‚æ•°ä¾›ç”¨æˆ·æ‰¾åˆ°æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡ã€‚</p><blockquote><p>å¦‚æœå¯¹äºæ”¶é›†å™¨è¿ä½œä¸å¤ªäº†è§£çš„è¯ï¼Œâ¼¿â¼¯ä¼˜åŒ–å­˜åœ¨çš„è¯å¯ä»¥é€‰æ‹©æŠŠå†…å­˜ç®¡ç†ä¼˜åŒ–äº¤ç»™è™šæ‹Ÿæœºå»å®Œæˆä¹Ÿæ˜¯â¼€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚-</p></blockquote><ul><li><u>æ–°â½£ä»£é‡‡ç”¨<strong>æ ‡è®°-å¤åˆ¶</strong>ç®—æ³•ï¼Œâ½¼å¹´ä»£é‡‡ç”¨<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•</u>ã€‚</li></ul></li><li><p><strong>ï¼ˆé‡ç‚¹ï¼‰CMSæ”¶é›†å™¨ã€‚<strong>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥</strong>è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚è¿™æ˜¯å› ä¸ºCMSæ”¶é›†å™¨å·¥ä½œæ—¶ï¼ŒGCå·¥ä½œçº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¯ä»¥<code>å¹¶å‘</code>æ‰§è¡Œï¼Œä»¥æ­¤æ¥è¾¾åˆ°é™ä½æ”¶é›†åœé¡¿æ—¶é—´çš„ç›®çš„ã€‚</p><ul><li>CMSæ”¶é›†å™¨ä»…ä½œç”¨äº<strong>è€å¹´ä»£</strong>çš„æ”¶é›†ï¼ŒåŸºäº <u>â€œ<strong>æ ‡è®°-æ¸…é™¤</strong>â€</u> ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚</li><li><strong>ç¼ºç‚¹ï¼ˆå¿«æ‰‹</strong>ï¼‰ï¼š CMSæ”¶é›†å™¨<strong>å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ</strong>ï¼›CMSæ”¶é›†å™¨<strong>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾</strong>ï¼ˆFloating Garbageï¼‰ã€‚</li></ul></li><li><p><strong>ï¼ˆé‡ç‚¹ï¼‰G1æ”¶é›†å™¨</strong>ã€‚ G1é‡æ–°å®šä¹‰äº†å †ç©ºé—´ï¼Œ<strong>æ‰“ç ´äº†åŸæœ‰çš„åˆ†ä»£æ¨¡å‹ï¼Œå°†å †åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªåŒºåŸŸ</strong>ã€‚è¿™ä¹ˆåšçš„ç›®çš„æ˜¯åœ¨è¿›è¡Œæ”¶é›†æ—¶ä¸å¿…åœ¨å…¨å †èŒƒå›´å†…è¿›è¡Œï¼Œè¿™æ˜¯å®ƒæœ€æ˜¾è‘—çš„ç‰¹ç‚¹ã€‚åŒºåŸŸåˆ’åˆ†çš„å¥½å¤„å°±æ˜¯å¸¦æ¥äº†<strong>åœé¡¿æ—¶é—´å¯é¢„æµ‹çš„æ”¶é›†æ¨¡å‹</strong>ï¼šç”¨æˆ·å¯ä»¥æŒ‡å®šæ”¶é›†æ“ä½œåœ¨å¤šé•¿æ—¶é—´å†…å®Œæˆã€‚å³G1æä¾›äº†æ¥è¿‘å®æ—¶çš„æ”¶é›†ç‰¹æ€§ã€‚</p><ul><li><strong>å¹¶è¡Œä¸å¹¶å‘</strong>ï¼šG1èƒ½å……åˆ†åˆ©â½¤CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUï¼ˆCPUæˆ–è€…CPUæ ¸â¼¼ï¼‰æ¥ç¼©çŸ­Stop-The-Worldåœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li><li><strong>åˆ†ä»£æ”¶é›†</strong>ï¼šè™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬â½´ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚</li><li><strong>ç©ºé—´æ•´åˆ</strong>ï¼šä¸CMSçš„<u>â€œæ ‡è®°â€“æ¸…é™¤â€</u>ç®—æ³•ä¸åŒï¼ŒG1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯<strong>åŸºäº<u>æ ‡è®°-å¤åˆ¶</u>ç®—æ³•</strong>å®ç°çš„ã€‚</li><li><strong>å¯é¢„æµ‹çš„åœé¡¿</strong>ï¼šè¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦â¼€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºâ½´å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨â¼€ä¸ªâ»“åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚</li></ul></li></ul><h5 id="8-1-ä»‹ç»ä¸€ä¸‹CMS-å’Œ-G1-åƒåœ¾å›æ”¶å™¨åŸç†ï¼Ÿ">8.1 ä»‹ç»ä¸€ä¸‹CMS å’Œ G1 åƒåœ¾å›æ”¶å™¨åŸç†ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/heyonggang/p/11718170.html">å¼„æ˜ç™½CMSå’ŒG1ï¼Œå°±é è¿™ä¸€ç¯‡äº†</a></p></blockquote><ul><li><p><strong>CMSæ”¶é›†å™¨</strong></p><p>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥<strong>è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚è¿™æ˜¯å› ä¸ºCMSæ”¶é›†å™¨å·¥ä½œæ—¶ï¼ŒGCå·¥ä½œçº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä»¥æ­¤æ¥è¾¾åˆ°é™ä½æ”¶é›†åœé¡¿æ—¶é—´çš„ç›®çš„ã€‚</p><p>CMSæ”¶é›†å™¨ä»…ä½œç”¨äºè€å¹´ä»£çš„æ”¶é›†ï¼Œæ˜¯åŸºäº<u>æ ‡è®°-æ¸…é™¤</u>ç®—æ³•çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰ :</strong> éœ€è¦<strong>STW</strong>ï¼Œæ ‡è®°ä¸€ä¸‹GC Rootsèƒ½<strong>ç›´æ¥</strong>å…³è”åˆ°çš„å¯¹è±¡ ï¼›</li><li><strong>å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰</strong>ï¼šä»GC Rootså¼€å§‹å †ä¸­å¯¹è±¡è¿›<strong>è¡Œå¯è¾¾æ€§åˆ†æ</strong>ï¼Œæ‰¾å‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œï¼›</li><li><strong>é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰</strong>ï¼šéœ€è¦<strong>STW</strong> ï¼Œ<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´</strong>å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´<strong>æ ‡è®°äº§ç”Ÿå˜åŠ¨</strong>çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½• ï¼›</li><li><strong>å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰</strong>ï¼š æ¸…é™¤å¯¹è±¡ã€‚</li></ol></li><li><p><strong>G1æ”¶é›†å™¨</strong></p><p>åœ¨å †çš„ç»“æ„è®¾è®¡æ—¶ï¼ŒG1æ‰“ç ´äº†ä»¥å¾€å°†æ”¶é›†èŒƒå›´å›ºå®šåœ¨æ–°ç”Ÿä»£æˆ–è€å¹´ä»£çš„æ¨¡å¼ï¼ŒG1å°†å †åˆ†æˆè®¸å¤š<strong>ç›¸åŒå¤§å°</strong>çš„åŒºåŸŸå•å…ƒï¼Œæ¯ä¸ªå•å…ƒç§°ä¸º<strong>Region</strong>ã€‚Regionæ˜¯ä¸€å—åœ°å€è¿ç»­çš„å†…å­˜ç©ºé—´ï¼ŒG1æ¨¡å—çš„ç»„æˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><blockquote><p>åŒºåŸŸåˆ’åˆ†çš„å¥½å¤„å°±æ˜¯å¸¦æ¥äº†<strong>åœé¡¿æ—¶é—´å¯é¢„æµ‹çš„æ”¶é›†æ¨¡å‹</strong>ï¼šç”¨æˆ·å¯ä»¥æŒ‡å®šæ”¶é›†æ“ä½œåœ¨å¤šé•¿æ—¶é—´å†…å®Œæˆã€‚å³G1æä¾›äº†æ¥è¿‘å®æ—¶çš„æ”¶é›†ç‰¹æ€§ã€‚</p></blockquote><p>å’ŒCMSæŒºåƒçš„ã€‚</p><ol><li>åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½<strong>ç›´æ¥å…³è”</strong>åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNext Top at Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ç”¨çš„Regionä¸­åˆ›å»ºæ–°å¯¹è±¡ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚</li><li>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰ï¼šæ˜¯ä»GC Rootså¼€å§‹å †ä¸­å¯¹è±¡è¿›è¡Œ<strong>å¯è¾¾æ€§åˆ†</strong>æï¼Œæ‰¾å‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</li><li>æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰ï¼šæ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´<strong>æ ‡è®°äº§ç”Ÿå˜åŠ¨</strong>çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹Remembered Set Logsé‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠRemembered Set Logsçš„æ•°æ®åˆå¹¶åˆ°Remembered Setä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚</li><li><strong>ç­›é€‰å›æ”¶</strong>ï¼ˆLive Data Counting and Evacuationï¼‰ï¼šé¦–å…ˆ<strong>å¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åº</strong>ï¼Œæ ¹æ®ç”¨æˆ·<strong>æ‰€æœŸæœ›çš„GCåœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’</strong>ã€‚è¿™ä¸ªé˜¶æ®µä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…æé«˜æ”¶é›†æ•ˆç‡ã€‚</li></ol></li></ul><h5 id="8-2-ä¸ºä»€ä¹ˆCMSä¸ç”¨æ ‡è®°-å‹ç¼©ç®—æ³•ï¼Ÿ">8.2 ä¸ºä»€ä¹ˆCMSä¸ç”¨æ ‡è®°-å‹ç¼©ç®—æ³•ï¼Ÿ</h5><p>CMSä¸»è¦å…³æ³¨<strong>ä½å»¶è¿Ÿ</strong>ï¼Œå› è€Œé‡‡ç”¨å¹¶å‘æ–¹å¼ã€‚</p><p>åœ¨<strong>å¹¶å‘æ¸…ç†åƒåœ¾</strong>æ—¶ï¼Œå¦‚æœé‡‡ç”¨å‹ç¼©ç®—æ³•ï¼Œè¿™<strong>æ¶‰åŠåˆ°ç§»åŠ¨å­˜æ´»çš„å¯¹è±¡ã€‚å¦‚æœä¸è¿›è¡Œåœé¡¿ä¼šå¾ˆéš¾å¤„ç†</strong>ï¼Œè¿èƒŒäº†CMSåˆè¡·ï¼Œæ‰€ä»¥é‡‡ç”¨<strong>æ ‡è®°-æ¸…é™¤</strong>ç®—æ³•ã€‚</p><h4 id="9-ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ">9.<strong>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</strong>ï¼Ÿ</h4><p>å¹¿ä¹‰å¹¶é€šä¿—çš„è¯´ï¼Œå°±æ˜¯ï¼š<u>ä¸å†ä¼šè¢«ä½¿ç”¨çš„<strong>å¯¹è±¡</strong>çš„å†…å­˜ä¸èƒ½è¢«å›æ”¶</u>ï¼Œå°±æ˜¯å†…å­˜æ³„æ¼ã€‚</p><p><strong>å†…å­˜æ³„æ¼åœºæ™¯</strong>ï¼š</p><ul><li><p>é™æ€é›†åˆç±»ã€æ•°ç»„<strong>æ·»åŠ å¯¹è±¡ä»¥åé—æ¼äº†å¯¹äºä»–ä»¬çš„å¤„ç†</strong>ï¼Œä¾‹å¦‚HashMapå’ŒVectorï¼›</p></li><li><p>å„ç§è¿æ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ã€IOè¿æ¥ï¼›</p></li><li><p>å•ä¾‹æ¨¡å¼ï¼›</p></li><li><p>å˜é‡ä¸åˆç†çš„ä½œç”¨åŸŸã€‚</p></li></ul><h3 id="1-6-2-ç±»åŠ è½½">1.6.2 ç±»åŠ è½½</h3><h4 id="1-ä»‹ç»ä¸€ä¸‹ç±»æ–‡ä»¶ç»“æ„ï¼Ÿ">1. ä»‹ç»ä¸€ä¸‹ç±»æ–‡ä»¶ç»“æ„ï¼Ÿ</h4><p>Classâ½‚ä»¶å­—èŠ‚ç ç»“æ„ç»„ç»‡ç¤ºæ„å›¾ ã€‚</p><p><img src="https://i.loli.net/2021/05/16/VkMjgwfFb9NGr2L.png" alt="image-20210516220600929"></p><ol><li><strong>é­”æ•°:</strong> ç¡®å®šè¿™ä¸ªâ½‚ä»¶æ˜¯å¦ä¸ºâ¼€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥æ”¶çš„ Class â½‚ä»¶ã€‚</li><li><strong>Class â½‚ä»¶ç‰ˆæœ¬</strong>ï¼šClass â½‚ä»¶çš„ç‰ˆæœ¬å·ï¼Œä¿è¯ç¼–è¯‘æ­£å¸¸æ‰§è¡Œã€‚</li><li><strong>å¸¸é‡æ± </strong> ï¼šå¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤å¤§å¸¸é‡ï¼šå­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</li><li><strong>è®¿é—®æ ‡å¿—</strong>ï¼šæ ‡å¿—ç”¨äºè¯†åˆ«â¼€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ª Class æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œæ˜¯å¦ä¸º public æˆ–è€… abstract ç±»å‹ï¼Œå¦‚æœæ˜¯ç±»çš„è¯æ˜¯å¦å£°æ˜ä¸º final ç­‰ç­‰ã€‚</li><li><strong>å½“å‰ç±»ç´¢å¼•,â½—ç±»ç´¢å¼•</strong> ï¼šç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œâ½—ç±»ç´¢å¼•ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„â½—ç±»çš„å…¨é™å®šåï¼Œç”±äº Java è¯­â¾”çš„å•ç»§æ‰¿ï¼Œæ‰€ä»¥â½—ç±»ç´¢å¼•åªæœ‰â¼€ä¸ªï¼Œé™¤äº† java.lang.Object ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ java ç±»éƒ½æœ‰â½—ç±»ï¼Œå› æ­¤é™¤äº† java.lang.Object å¤–ï¼Œæ‰€æœ‰ Java ç±»çš„â½—ç±»ç´¢å¼•<br>éƒ½ä¸ä¸º 0ã€‚</li><li><strong>æ¥å£ç´¢å¼•é›†åˆ</strong>ï¼šæ¥å£ç´¢å¼•é›†åˆç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†é‚£äº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ implents (å¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯æ¥å£çš„è¯åˆ™æ˜¯ extends ) åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</li><li><strong>å­—æ®µè¡¨é›†åˆ</strong>ï¼šæè¿°æ¥å£æˆ–ç±»ä¸­å£°æ˜çš„å˜é‡ã€‚å­—æ®µåŒ…æ‹¬ç±»çº§å˜é‡ä»¥åŠå®ä¾‹å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬åœ¨æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚</li><li><strong>æ–¹æ³•è¡¨é›†åˆ</strong> ï¼šç±»ä¸­çš„æ–¹æ³•ã€‚</li><li><strong>å±æ€§è¡¨é›†åˆ</strong>ï¼š åœ¨ Class â½‚ä»¶ï¼Œå­—æ®µè¡¨ï¼Œæ–¹æ³•è¡¨ä¸­éƒ½å¯ä»¥æºå¸¦â¾ƒâ¼°çš„å±æ€§è¡¨é›†åˆã€‚</li></ol><h4 id="2-ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Ÿè¯·ä½ è§£é‡Šä¸€ä¸‹javaç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ï¼Ÿ">2. ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Ÿè¯·ä½ è§£é‡Šä¸€ä¸‹javaç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ï¼Ÿ</h4><blockquote><p>å‚è€ƒ ï¼š <a href="https://cloud.tencent.com/developer/article/1350078">ä¸€ä¸ªç®€å•javaç¨‹åºçš„è¿è¡Œå…¨è¿‡ç¨‹</a></p></blockquote><p><u>ç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªç”¨æ¥åŠ è½½ç±»æ–‡ä»¶çš„<strong>ç±»</strong></u> ã€‚</p><p>æˆ‘ä»¬æ‰€è¯´çš„ç±»åŠ è½½è¿‡ç¨‹å³æ˜¯æŒ‡<strong>JVMè™šæ‹ŸæœºæŠŠ.classæ–‡ä»¶ä¸­ç±»ä¿¡æ¯åŠ è½½</strong>è¿›å†…å­˜ã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹3å¤§æ­¥ã€5å°æ­¥ï¼š</p><p><img src="https://i.loli.net/2021/04/21/m1Ot3nQcMGq2YfW.jpg" alt="img"></p><ol><li><p><strong>ç¼–è¯‘</strong>ã€‚ å°†ç¼–è¯‘çš„<code>.java</code> æ–‡ä»¶ç¼–è¯‘ä¸º<code>.class</code>å­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶åäº¤ç»™JVMè¿è¡Œï¼›</p></li><li><p><strong>åŠ è½½</strong> ï¼šclasså­—èŠ‚ç æ–‡ä»¶ä»å„ä¸ªæ¥æºé€šè¿‡<strong>ç±»åŠ è½½å™¨</strong>è£…è½½å…¥<u>å†…å­˜</u>ä¸­ ã€‚</p><blockquote><ul><li><strong>æ¥æº</strong>ï¼šåŒ…æœ¬åœ°è·¯å¾„ä¸‹ç¼–è¯‘ç”Ÿæˆçš„.classæ–‡ä»¶ï¼Œä»jaråŒ…ä¸­çš„.classæ–‡ä»¶ï¼Œä»è¿œç¨‹ç½‘ç»œï¼Œä»¥åŠåŠ¨æ€ä»£ç†å®æ—¶ç¼–è¯‘</li><li><strong>ç±»åŠ è½½å™¨</strong> ï¼šä¸€èˆ¬åŒ…æ‹¬<strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong>ï¼Œ<strong>æ‰©å±•ç±»åŠ è½½å™¨</strong>ï¼Œ<strong>ç³»ç»Ÿç±»åŠ è½½å™¨</strong>ï¼Œä»¥åŠç”¨æˆ·çš„<u><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong> ï¼ˆä»£ç åŠ å¯†é˜²æ­¢åç¼–è¯‘ï¼‰</u>ã€‚</li></ul></blockquote></li><li><p><strong>é“¾æ¥</strong>ï¼š åˆ†ä¸ºï¼ŒéªŒè¯ã€å‡†å¤‡ã€è§£æï¼ˆâ€æ­£-ä¸­-å‡†-å¿ƒâ€œï¼‰ä¸‰é˜¶æ®µ</p><ul><li><p><strong>éªŒè¯</strong>ï¼š ä¿è¯åŠ è½½è¿›æ¥çš„<u>å­—èŠ‚æµç¬¦åˆè™šæ‹Ÿæœºè§„èŒƒ</u>ï¼›</p><blockquote><p><strong>æ–‡ä»¶æ ¼å¼çš„éªŒè¯</strong>ï¼Œæ¯”å¦‚å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ï¼Ÿæ–‡ä»¶ä¸­æ˜¯å¦æœ‰ä¸è§„èŒƒçš„æˆ–è€…é™„åŠ çš„å…¶ä»–ä¿¡æ¯ï¼Ÿ</p><p><strong>å…ƒæ•°æ®çš„éªŒè¯</strong>ï¼Œæ¯”å¦‚è¯¥ç±»æ˜¯å¦ç»§æ‰¿äº†è¢«finalä¿®é¥°çš„ç±»ï¼Ÿç±»ä¸­çš„å­—æ®µï¼Œæ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»å†²çªï¼Ÿæ˜¯å¦å‡ºç°äº†ä¸åˆç†çš„é‡è½½ï¼Ÿ</p><p><strong>å­—èŠ‚ç çš„éªŒè¯</strong>ï¼Œä¿è¯ç¨‹åºè¯­ä¹‰çš„åˆç†æ€§ï¼Œæ¯”å¦‚è¦ä¿è¯<u>ç±»å‹è½¬æ¢çš„åˆç†æ€§</u>ã€‚</p><p><strong>ç¬¦å·å¼•ç”¨çš„éªŒè¯</strong>ï¼Œæ¯”å¦‚æ ¡éªŒç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å…¨é™å®šåæ˜¯å¦èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„ç±»ï¼Ÿæ ¡éªŒç¬¦å·å¼•ç”¨ä¸­çš„è®¿é—®æ€§ï¼ˆprivateï¼Œpublicç­‰ï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®ï¼Ÿ</p></blockquote></li><li><p><strong>å‡†å¤‡</strong>ï¼šç±»å˜é‡ï¼ˆ<strong>æ³¨æ„ï¼Œä¸æ˜¯å®ä¾‹å˜é‡</strong> ï¼‰åˆ†é…å†…å­˜ï¼Œå¹¶ä¸”èµ‹äºˆ<strong>åˆå€¼</strong>ï¼ˆè™šæ‹Ÿæœºæ ¹æ®ä¸åŒç±»å‹è®¾å®šçš„åˆå§‹å€¼ï¼‰ï¼›</p><blockquote><p>è¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½å°†åœ¨<strong>æ–¹æ³•åŒº</strong>ä¸­è¿›è¡Œåˆ†é… ï¼Œè¿›è¡Œ<strong>é›¶åˆå§‹åŒ–</strong>ï¼š</p><ul><li>å³æ•°å­—ç±»å‹åˆå§‹åŒ–ä¸º 0 ï¼Œboolean åˆå§‹åŒ–ä¸º falseï¼Œå¼•ç”¨ç±»å‹åˆå§‹åŒ–ä¸º null ç­‰</li></ul></blockquote></li><li><p><strong>è§£æ</strong>ï¼šå°†å¸¸é‡æ± å†…çš„ <u>ç¬¦å·å¼•ç”¨</u> æ›¿æ¢ä¸º <u>ç›´æ¥å¼•ç”¨</u> çš„è¿‡ç¨‹ã€‚</p><blockquote><p><u>ç¬¦å·å¼•ç”¨ï¼š</u>å³ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²ç»™å‡ºäº†ä¸€äº›èƒ½å¤Ÿå”¯ä¸€æ€§è¯†åˆ«ä¸€ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå˜é‡ï¼Œä¸€ä¸ªç±»çš„ç›¸å…³ä¿¡æ¯ã€‚<br><u>ç›´æ¥å¼•ç”¨ï¼š</u>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæˆ–è€…ä¸€ä¸ªåç§»é‡ã€‚æ¯”å¦‚ç±»æ–¹æ³•ï¼Œç±»å˜é‡çš„ç›´æ¥å¼•ç”¨æ˜¯æŒ‡å‘æ–¹æ³•åŒºçš„æŒ‡é’ˆï¼›è€Œå®ä¾‹æ–¹æ³•ï¼Œå®ä¾‹å˜é‡çš„ç›´æ¥å¼•ç”¨åˆ™æ˜¯ä»å®ä¾‹çš„å¤´æŒ‡é’ˆå¼€å§‹ç®—èµ·åˆ°è¿™ä¸ªå®ä¾‹å˜é‡ä½ç½®çš„åç§»é‡ã€‚</p><p>ğŸŒ¾ å®ä¾‹ï¼š è°ƒç”¨æ–¹æ³•hello()ï¼Œæ–¹æ³•çš„åœ°å€æ˜¯1234567ï¼Œé‚£ä¹ˆhelloå°±æ˜¯ç¬¦å·å¼•ç”¨ï¼Œ1234567å°±æ˜¯ç›´æ¥å¼•ç”¨ã€‚</p></blockquote></li></ul></li><li><p><strong>åˆå§‹åŒ–</strong>ã€‚ åˆå§‹åŒ–å°±æ˜¯æ‰§è¡Œç±»çš„<code> cinit</code>()çš„è¿‡ç¨‹ã€‚</p><blockquote><p>â” å’Œå‡†å¤‡é˜¶æ®µé‚£ä¸ªåˆå§‹åŒ–çœ‹å¾—æˆ‘æœ‰ç‚¹è¿·ç³Šï¼Ÿ</p><ul><li><strong>åœ¨ç¼–è¯‘é˜¶æ®µ</strong>ï¼Œç¼–è¯‘å™¨æ”¶é›†æ‰€æœ‰çš„<strong>é™æ€å­—æ®µçš„èµ‹å€¼è¯­å¥åŠé™æ€ä»£ç å—</strong>ï¼Œå¹¶æŒ‰ <u>è¯­å¥å‡ºç°çš„é¡ºåº</u> æ‹¼æ¥å‡ºä¸€ä¸ªç±»åˆå§‹åŒ–æ–¹æ³• <code>&lt;clinit&gt;()</code>ã€‚æ­¤æ—¶ï¼Œæ‰§è¡Œå¼•æ“ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯¹é™æ€å­—æ®µè¿›è¡Œä»£ç ä¸­ç¼–å†™çš„åˆå§‹åŒ–æ“ä½œã€‚</li></ul></blockquote></li></ol><h4 id="3-çŸ¥é“ç±»çš„ç”Ÿå‘½å‘¨æœŸå—ï¼Ÿ">3.<strong>çŸ¥é“ç±»çš„ç”Ÿå‘½å‘¨æœŸå—</strong>ï¼Ÿ</h4><p><strong>åœ¨ç±»åŠ è½½çš„è¿‡ç¨‹</strong>å†åŠ ä¸Šï¼š</p><ol start="4"><li><strong>ä½¿ç”¨</strong>ã€‚newå‡ºå¯¹è±¡ç¨‹åºä¸­ä½¿ç”¨</li><li><strong>å¸è½½</strong>ã€‚æ‰§è¡Œåƒåœ¾å›æ”¶</li></ol><h4 id="4-è¯·ä½ ä»‹ç»ä¸€ä¸‹ç±»åŠ è½½å™¨ï¼Ÿ">4.<strong>è¯·ä½ ä»‹ç»ä¸€ä¸‹ç±»åŠ è½½å™¨</strong>ï¼Ÿ</h4><img src="https://upload-images.jianshu.io/upload_images/7634245-7b7882e1f4ea5d7d.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt="img" style="zoom:50%;" /><p>JVMé¢„å®šä¹‰çš„ä¸‰ç§ç±»å‹ç±»åŠ è½½å™¨ï¼š</p><ul><li><strong>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrapClassLoaderï¼‰</strong>ï¼šæ˜¯ä¸€èˆ¬ç”¨æœ¬åœ°ä»£ç å®ç°ï¼Œè´Ÿè´£å°† <code>&lt;Java_Runtime_Home&gt;/lib</code>ä¸‹é¢çš„ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼›</li><li><strong>æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtensionClassLoaderï¼‰</strong>ï¼š<code>&lt; Java_Runtime_Home &gt;/lib/ext</code>æˆ–è€…ç”±ç³»ç»Ÿå˜é‡ <code>java.ext.dir</code>æŒ‡å®šä½ç½®ä¸­çš„ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼›</li><li><strong>ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰</strong>ï¼šåˆå«åº”ç”¨ç±»åŠ è½½å™¨ï¼Œå…¶çˆ¶ç±»æ˜¯Extensionã€‚å®ƒæ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ç±»åŠ è½½å™¨ã€‚å®ƒä»<u>ç¯å¢ƒå˜é‡æˆ–è€…ç³»ç»Ÿå±æ€§<code>java.class.path</code></u>æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»ï¼Œæ˜¯<strong>ç”¨æˆ·è‡ªå®šä¹‰åŠ è½½å™¨çš„é»˜è®¤çˆ¶åŠ è½½å™¨</strong>ã€‚</li></ul><h4 id="5-è¯·ä½ ä»‹ç»ä¸€ä¸‹åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ">5.<strong>è¯·ä½ ä»‹ç»ä¸€ä¸‹åŒäº²å§”æ´¾æœºåˆ¶ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåš</strong>ï¼Ÿ</h4><ul><li><p><strong>åŒäº²å§”æ´¾æœºåˆ¶</strong>ã€‚æŸä¸ªç‰¹å®šçš„ç±»åŠ è½½å™¨åœ¨æ¥åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œé¦–å…ˆå°†åŠ è½½ä»»åŠ¡<strong>å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨</strong>ï¼Œ<strong>ä¾æ¬¡é€’å½’</strong>ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼›<strong>åªæœ‰çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡æ—¶ï¼Œæ‰è‡ªå·±å»åŠ è½½</strong>ï¼›</p></li><li><p><strong>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿé˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä»½åŒæ ·çš„å­—èŠ‚ç </strong> ã€‚</p><blockquote><p>æ¯”å¦‚ä¸¤ä¸ªç±»Aå’Œç±»Béƒ½è¦åŠ è½½Systemç±»ï¼š</p><ul><li>å¦‚æœä¸ç”¨å§”æ‰˜ï¼šè€Œæ˜¯è‡ªå·±åŠ è½½è‡ªå·±çš„ï¼Œé‚£ä¹ˆç±»Aå°±ä¼šåŠ è½½ä¸€ä»½Systemå­—èŠ‚ç ï¼Œç„¶åç±»Båˆä¼šåŠ è½½ä¸€ä»½Systemå­—èŠ‚ç ï¼Œ<strong>è¿™æ ·å†…å­˜ä¸­å°±å‡ºç°äº†ä¸¤ä»½Systemå­—èŠ‚ç </strong>ã€‚</li><li>å¦‚æœä½¿ç”¨å§”æ‰˜æœºåˆ¶ï¼šä¼šé€’å½’çš„å‘çˆ¶ç±»æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯<strong>é¦–é€‰ç”¨Bootstrapå°è¯•åŠ è½½</strong>ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†å‘ä¸‹ã€‚è¿™é‡Œçš„Systemå°±èƒ½åœ¨Bootstrapä¸­æ‰¾åˆ°ç„¶ååŠ è½½ï¼Œå¦‚æœæ­¤æ—¶ç±»Bä¹Ÿè¦åŠ è½½Systemï¼Œä¹Ÿä»Bootstrapå¼€å§‹ï¼Œæ­¤æ—¶<strong>Bootstrapå‘ç°å·²ç»åŠ è½½è¿‡äº†Systemé‚£ä¹ˆç›´æ¥è¿”å›å†…å­˜ä¸­çš„Systemå³å¯è€Œä¸éœ€è¦é‡æ–°åŠ è½½</strong>ï¼Œè¿™æ ·å†…å­˜ä¸­å°±åªæœ‰ä¸€ä»½Systemçš„å­—èŠ‚ç äº†ã€‚</li></ul></blockquote></li></ul><h5 id="5-1-å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨-ï¼Œå¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶-ï¼Ÿ">5.1 å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ï¼Œå¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ ï¼Ÿ</h5><ul><li><p><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ &amp; æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶</strong></p><p>åœ¨å®ç°è‡ªå·±çš„ClassLoaderä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹JDKä¸­çš„ClassLoaderæ˜¯æ€ä¹ˆå®ç°çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="keyword">protected</span> <span class="keyword">synchronized</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)</span><br><span class="line"> <span class="number">2</span>     <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line"> <span class="number">3</span>     &#123;</span><br><span class="line"> <span class="number">4</span>     <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line"> <span class="number">5</span>     Class c = findLoadedClass(name);</span><br><span class="line"> <span class="number">6</span>     <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line"> <span class="number">7</span>         <span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="number">8</span>         <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line"> <span class="number">9</span>             c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line"><span class="number">10</span>         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="number">11</span>             c = findBootstrapClass0(name);</span><br><span class="line"><span class="number">12</span>         &#125;</span><br><span class="line"><span class="number">13</span>         &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line"><span class="number">14</span>             <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line"><span class="number">15</span>             <span class="comment">// to find the class.</span></span><br><span class="line"><span class="number">16</span>             c = findClass(name);</span><br><span class="line"><span class="number">17</span>         &#125;</span><br><span class="line"><span class="number">18</span>     &#125;</span><br><span class="line"><span class="number">19</span>     <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line"><span class="number">20</span>         resolveClass(c);</span><br><span class="line"><span class="number">21</span>     &#125;</span><br><span class="line"><span class="number">22</span>     <span class="keyword">return</span> c;</span><br><span class="line"><span class="number">23</span>     &#125;</span><br></pre></td></tr></table></figure><p>1ã€<strong>å¦‚æœä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œé‚£ä¹ˆåªéœ€è¦é‡å†™findClassæ–¹æ³•å³å¯</strong></p><p><strong>ï¼ˆ1ï¼‰ç»§æ‰¿ClassLoader</strong></p><p><strong>ï¼ˆ2ï¼‰é‡å†™findClass()æ–¹æ³•</strong></p><p>2ã€<strong>å¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œé‚£ä¹ˆå°±é‡å†™æ•´ä¸ªloadClassæ–¹æ³•</strong></p><p><strong>ï¼ˆ1ï¼‰ç»§æ‰¿ClassLoader</strong></p><p><strong>ï¼ˆ2ï¼‰é‡å†™findClass()æ–¹æ³•</strong>6</p><p><strong>ï¼ˆ3ï¼‰è°ƒç”¨defineClass()æ–¹æ³•</strong></p></li><li><p><strong>tomcat ä¸ºä»€ä¹ˆè¦è¿èƒŒåŒäº²å§”æ‰˜æœºåˆ¶</strong>ï¼Ÿ</p><ol><li>åŒäº²å§”æ‰˜æœºåˆ¶ä¸èƒ½æ»¡è¶³tomcatçš„ä¸šåŠ¡éœ€æ±‚ï¼›</li><li>Webappç±»åŠ è½½å™¨éœ€è¦ç‹¬ç«‹åŠ è½½è‡ªèº«çš„classä»¥åŠä¾èµ–çš„jarï¼›</li><li>ä¾‹å¦‚ï¼Œ<strong>webapp1</strong>ä¾èµ–çš„springç‰ˆæœ¬ä¸º4.xï¼Œå¦ä¸€ä¸ª<strong>webapp2</strong>ä¾èµ–çš„springç‰ˆæœ¬ä¸º5.x. å¦‚æœä½¿ç”¨åŒäº²å§”æ‰˜ï¼Œé‚£ä¹ˆspringçš„ç‰ˆæœ¬åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼Œæ²¡æ³•æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚</li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> æ ¡æ‹› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é”</title>
      <link href="/p/45493/"/>
      <url>/p/45493/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h2 id="1-5-é”">1.5 é”</h2><h4 id="ã€æ–°å¢ã€‘-javaå¸¸ç”¨çš„å¹¶å‘å·¥å…·ç±»ï¼Ÿ">ã€æ–°å¢ã€‘ javaå¸¸ç”¨çš„å¹¶å‘å·¥å…·ç±»ï¼Ÿ</h4><blockquote><p>è¿™ç¯‡ä¸é”™ï¼š<a href="https://zhuanlan.zhihu.com/p/163654320">ã€Šä»Šå¤©é¢è¯•äº†å—ã€‹- å¹¶å‘ç¼–ç¨‹ä¹‹AQSåŒæ­¥å·¥å…·ç±»</a></p></blockquote><p>JUCå°±æ˜¯java.util.concurrentåŒ…ï¼Œè¿™ä¸ªåŒ…ä¿—ç§°JUCï¼Œé‡Œé¢éƒ½æ˜¯<strong>è§£å†³å¹¶å‘é—®é¢˜</strong>ã€‚</p><p>å¸¸ç”¨å››å¤§å¹¶å‘å·¥å…·åŒ…ï¼ˆä»¥ä¸‹éƒ½æ˜¯åŸºäº<strong>AQS</strong>å®ç°çš„ï¼‰ï¼š</p><ol><li><p><strong>CountDownLatch</strong>ï¼š CyclicBarrieræè¿°çš„æ˜¯â€œå…è®¸ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œç›´åˆ°<strong>åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹</strong>ï¼Œæ‰ä¼šè¿›è¡Œåç»­ä»»åŠ¡â€ã€‚</p><p>è€Œ<strong>CountDownLatch</strong>æ‰€æè¿°çš„æ˜¯â€œåœ¨<strong>å®Œæˆä¸€ç»„æ­£åœ¨å…¶ä»–çº¿ç¨‹ä¸­</strong>æ‰§è¡Œçš„æ“ä½œä¹‹å‰ï¼Œå®ƒå… ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸€ç›´ç­‰å¾…â€ã€‚</p><p>åœ¨APIä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼šç”¨ç»™å®šçš„è®¡æ•°åˆå§‹CountDownLatchã€‚ç”±äºè°ƒç”¨äº†countDownæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨å½“å‰è®¡æ•°åˆ°è¾¾é›¶ä¹‹å‰ï¼Œawaitæ–¹æ³•ä¼šä¸€ç›´å—é˜»å¡ã€‚ä¹‹åï¼Œä¼šé‡Šæ”¾æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œawaitçš„æ‰€æœ‰åç»­è°ƒç”¨éƒ½å°†ç«‹å³è¿”å›ã€‚è¿™ç§ç°è±¡åªå‡ºç°ä¸€æ¬¡ï¼ˆè®¡æ•°æ— æ³•è¢«é‡ç½®ã€‚å¦‚æœéœ€è¦é‡ç½®è®¡æ•°ï¼Œè¯·è€ƒè™‘ä½¿CyclicBarrierï¼‰ã€‚</p></li><li><p><strong>CyclicBarrier</strong>ï¼šCyclicBarrieræ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ã€‚å®ƒå…è®¸<strong>ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…</strong>ï¼Œ<strong>ç›´åˆ°åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹</strong>ã€‚åœ¨æ¶‰åŠä¸€ç»„å›ºå®šå¤§å°çš„çº¿ç¨‹çš„ç¨‹åºé‡Œï¼Œè¿™äº›çº¿ç¨‹å¿…é¡»ä¸æ—¶çš„äº’ç›¸ç­‰å¾…ï¼Œæ­¤æ—¶CyclicBarrier å¾ˆæœ‰ç”¨ã€‚å› ä¸ºCyclicBarrieråœ¨é‡Šæ”¾ç­‰å¾…çº¿ç¨‹åå¯ä»¥é‡ç”¨ï¼Œå› æ­¤æˆä¸ºå¾ªç¯çš„å±éšœã€‚</p><blockquote><p>ä½¿ç”¨**await()**æ–¹æ³•ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨await()æ–¹æ³•å‘Šè¯‰CyclicBarrier æˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ã€‚å½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾äº†å±éšœï¼Œç»“æŸé˜»å¡ï¼Œæ‰€æœ‰çº¿ç¨‹å¯ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘ã€‚</p></blockquote></li><li><p><strong>Semaphore</strong>ï¼šä¿¡å·é‡Semaphoreæ˜¯ä¸€ä¸ªæ§åˆ¶è®¿é—®<strong>å¤šä¸ªå…±äº«èµ„æºçš„è®¡æ•°å™¨</strong>ï¼Œå’ŒCountDownLatchä¸€æ ·ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œå…±äº«é”â€ã€‚åœ¨APIæ˜¯è¿™ä¹ˆä»‹ç»ä¿¡å·é‡çš„ï¼šä¸€ä¸ªè®¡æ•°ä¿¡å·é‡ï¼Œä»æ¦‚å¿µä¸Šè®²ï¼Œä¿¡å·é‡ç»´æŠ¤äº†ä¸€ä¸ªè®¸å¯é›†ã€‚</p></li><li><p><strong>ExChanger</strong> ï¼šExchangeræ˜¯ä¸€ä¸ªåŒæ­¥å™¨ï¼Œå­—é¢ä¸Šå°±å¯ä»¥çœ‹å‡ºè¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨æ˜¯äº¤æ¢æ•°æ®ã€‚Exchangeræœ‰ç‚¹<strong>ç±»ä¼¼CyclicBarrier</strong>ï¼Œå‰é¢è¯´åˆ°CyclicBarrieræ˜¯ä¸€ä¸ªæ …æ ï¼Œåˆ°è¾¾æ …æ çš„ çº¿ç¨‹éœ€è¦ç­‰å¾…ä¸€å®šæ•°é‡çš„çº¿ç¨‹åˆ°è¾¾åï¼Œæ‰èƒ½é€šè¿‡æ …æ ã€‚Exchangerå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªåŒå‘çš„æ …æ ã€‚çº¿ç¨‹1åˆ°è¾¾æ …æ åï¼Œä¼šé¦–å…ˆè§‚å¯Ÿæœ‰æ²¡æœ‰å…¶ä»–çº¿ç¨‹å·²ç»åˆ°è¾¾æ …æ ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šç­‰å¾…ã€‚å¦‚æœå·²ç»æœ‰å…¶ä»–çº¿ç¨‹ï¼ˆæ¯”å¦‚çº¿ç¨‹2ï¼‰åˆ°è¾¾äº†ï¼Œå°±ä¼š<strong>ä»¥æˆå¯¹çš„æ–¹å¼äº¤æ¢å„è‡ªæºå¸¦çš„ä¿¡æ¯</strong>ï¼Œå› æ­¤Exchangeréå¸¸é€‚åˆ<strong>ä¸¤ä¸ªçº¿ç¨‹</strong>ä¹‹é—´çš„<strong>æ•°æ®äº¤æ¢</strong>ã€‚</p></li></ol><h4 id="1-5-1-synchronized-ç›¸å…³">1.5.1 synchronized ç›¸å…³</h4><h5 id="1-1-é‡ç‚¹-è¯´ä¸€è¯´è‡ªå·±å¯¹äº-synchronized-å…³é”®å­—çš„äº†è§£-synchronized-åº•å±‚åŸç†">1.1 [é‡ç‚¹]<strong>è¯´ä¸€è¯´è‡ªå·±å¯¹äº synchronized å…³é”®å­—çš„äº†è§£? synchronized åº•å±‚åŸç†</strong> ?</h5><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/356010805">Javaé¢è¯•å¸¸è§é—®é¢˜ï¼šMonitorå¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿ</a></p><p><a href="https://www.cnblogs.com/aspirant/p/11470858.html">æ·±å…¥åˆ†æSynchronizedåŸç†(é˜¿é‡Œé¢è¯•é¢˜)</a></p></blockquote><ul><li><p><strong>åŸºæœ¬äº†è§£</strong></p><p>synchronizedå…³é”®å­—è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œsynchronizedå…³é”®å­—å¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><ul><li>synchronizedå±äºé‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯<strong>ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„<u>Mutex Lock</u></strong> æ¥å®ç°çš„ï¼›</li><li>Java çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œ<strong>è€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢</strong>æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ—©æœŸçš„synchronizedæ•ˆç‡ä½çš„åŸå› ã€‚</li></ul></li><li><p><strong>moniterä»‹ç»</strong></p><blockquote><p><strong>Monitorå¯¹è±¡å­˜åœ¨äºæ¯ä¸ªJavaå¯¹è±¡çš„å¯¹è±¡å¤´Mark Wordä¸­ï¼ˆå­˜å‚¨çš„æŒ‡é’ˆçš„æŒ‡å‘ï¼‰ï¼ŒSynchronizedé”ä¾¿æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–é”çš„ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆJavaä¸­ä»»æ„å¯¹è±¡å¯ä»¥ä½œä¸ºé”çš„åŸå› ï¼ŒåŒæ—¶notify/notifyAll/waitç­‰æ–¹æ³•ä¼šä½¿ç”¨åˆ°Monitoré”å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»åœ¨åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨</strong>ã€‚</p></blockquote><p>åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼ŒMonitoræ˜¯åŸºäºC++çš„<strong>ObjectMonitorç±»</strong>å®ç°çš„ï¼Œå…¶ä¸»è¦æˆå‘˜åŒ…æ‹¬ï¼š</p><ul><li>_ownerï¼šæŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹</li><li>_WaitSetï¼šå­˜æ”¾å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹é˜Ÿåˆ—ï¼Œå³è°ƒç”¨wait()æ–¹æ³•çš„çº¿ç¨‹</li><li>EntryListï¼šå­˜æ”¾å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹é˜Ÿåˆ—</li><li>_countï¼šçº¦ä¸º_WaitSet å’Œ _EntryList çš„èŠ‚ç‚¹æ•°ä¹‹å’Œ</li><li>_cxq: å¤šä¸ªçº¿ç¨‹äº‰æŠ¢é”ï¼Œä¼šå…ˆå­˜å…¥è¿™ä¸ªå•å‘é“¾è¡¨</li><li>_recursions: è®°å½•é‡å…¥æ¬¡æ•°</li></ul></li><li><p><strong>åº•å±‚åŸç†</strong></p><p>synchronized å…³é”®å­—åº•å±‚åŸç†å±äº JVM å±‚é¢ã€‚</p><p><strong>â‘  synchronizedåŒæ­¥è¯­å¥å—çš„æƒ…å†µ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedDemo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;synchronized ä»£ç å—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ JDK â¾ƒå¸¦çš„ javap å‘½ä»¤æŸ¥çœ‹ SynchronizedDemo ç±»çš„ç›¸å…³å­—èŠ‚ç ä¿¡æ¯ï¼š</p><ul><li><p>â¾¸å…ˆåˆ‡æ¢åˆ°ç±»çš„å¯¹åº”â½¬å½•æ‰§è¡Œ javac SynchronizedDemo.java å‘½ä»¤â½£æˆç¼–è¯‘åçš„ .class â½‚ä»¶ï¼Œç„¶åæ‰§è¡Œ <code>javap -c -s-v -l SynchronizedDemo.class</code></p></li><li><p><img src="https://i.loli.net/2021/05/16/DTSB86Z2GcRy9XC.png" alt="image-20210516130259067"></p></li></ul><p><strong>synchronized</strong>åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯monitorenterå’Œ monitorexitæŒ‡ä»¤ï¼Œå…¶ä¸­<strong>monitorenteræŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼ŒmonitorexitæŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®</strong>ã€‚</p><ol><li><p>å½“æ‰§è¡Œmonitorenter æŒ‡ä»¤æ—¶ï¼Œçº¿ç¨‹è¯•å›¾è·å–é”ä¹Ÿå°±æ˜¯è·å– monitorçš„æŒæœ‰æƒã€‚å½“è®¡æ•°å™¨ä¸º0åˆ™å¯ä»¥æˆåŠŸè·å–ï¼Œè·å–åå°†é”è®¡æ•°å™¨è®¾ä¸º1ä¹Ÿå°±æ˜¯åŠ 1 ;</p><blockquote><p>monitorå¯¹è±¡å­˜åœ¨äºæ¯ä¸ªJavaå¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ synchronized é”ä¾¿æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–é”çš„ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆJavaä¸­ä»»æ„å¯¹è±¡å¯ä»¥ä½œä¸ºé”çš„åŸå› ã€‚</p></blockquote></li><li><p>ç›¸åº”çš„åœ¨æ‰§è¡Œmonitorexit æŒ‡ä»¤åï¼Œ<strong>å°†é”è®¡æ•°å™¨è®¾ä¸º0</strong>ï¼Œè¡¨æ˜é”è¢«é‡Šæ”¾ï¼›</p></li><li><p>å¦‚æœè·å–å¯¹è±¡é”å¤±è´¥ï¼Œé‚£å½“å‰çº¿ç¨‹å°±è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°é”è¢«å¦å¤–â¼€ä¸ªçº¿ç¨‹é‡Šæ”¾ä¸ºâ½Œã€‚</p></li></ol></li></ul><p><strong>â‘¡ synchronizedä¿®é¥°æ–¹æ³•çš„çš„æƒ…å†µ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;synchronized æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/16/oElScfCHI978Qtw.png" alt="image-20210516131938787"></p><ul><li><p>synchronized ä¿®é¥°çš„æ–¹æ³•å¹¶æ²¡æœ‰ monitorenter æŒ‡ä»¤å’Œ monitorexit æŒ‡ä»¤ï¼Œå–å¾—ä»£ä¹‹çš„ç¡®å®æ˜¯<code>ACC_SYNCHRONIZED</code> æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯â¼€ä¸ªåŒæ­¥æ–¹æ³•ï¼ŒJVM é€šè¿‡è¯¥ ACC_SYNCHRONIZED è®¿é—®ã€‚</p><blockquote><p>å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆè·å–monitorï¼Œè·å–æˆåŠŸä¹‹åæ‰èƒ½æ‰§è¡Œæ–¹æ³•ä½“ï¼Œæ–¹æ³•æ‰§è¡Œå®Œåå†é‡Šæ”¾monitorã€‚<strong>åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å¾—åŒä¸€ä¸ªmonitorå¯¹è±¡</strong>ã€‚</p></blockquote><p>ä¸¤ç§åŒæ­¥æ–¹å¼<strong>æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«</strong>ï¼Œåªæ˜¯æ–¹æ³•çš„åŒæ­¥æ˜¯ä¸€ç§éšå¼çš„æ–¹å¼æ¥å®ç°ï¼Œæ— éœ€é€šè¿‡å­—èŠ‚ç æ¥å®Œæˆã€‚ä¸¤ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œæ˜¯JVMé€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿçš„<strong>äº’æ–¥åŸè¯­mutex</strong>æ¥å®ç°ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€ç­‰å¾…é‡æ–°è°ƒåº¦ï¼Œä¼šå¯¼è‡´â€œç”¨æˆ·æ€å’Œå†…æ ¸æ€â€ä¸¤ä¸ªæ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œå¯¹æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ã€‚</p></li></ul><h5 id="1-2-è¯·ä½ è°ˆè°ˆå…³äºSynchronizedå’ŒReentrantLockï¼Ÿ">1.2 <strong>è¯·ä½ è°ˆè°ˆå…³äºSynchronizedå’ŒReentrantLockï¼Ÿ</strong></h5><ul><li><p><strong>ç›¸ä¼¼ç‚¹</strong></p><ul><li><p><strong>éƒ½æ˜¯é˜»å¡å¼åŒæ­¥</strong>ï¼šä¸€ä¸ªçº¿ç¨‹è·å¾—äº†å¯¹è±¡é”ï¼Œè¿›å…¥äº†åŒæ­¥å—ï¼Œå…¶ä»–è®¿é—®è¯¥åŒæ­¥å—çš„çº¿ç¨‹éƒ½å¿…é¡»é˜»å¡åœ¨åŒæ­¥å—å¤–é¢ç­‰å¾…ï¼›</p><blockquote><p>çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„ä»£ä»·æ˜¯æ¯”è¾ƒé«˜çš„ï¼ˆæ“ä½œç³»ç»Ÿéœ€è¦åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œä»£ä»·å¾ˆé«˜ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡å¯¹é”ä¼˜åŒ–è¿›è¡Œæ”¹å–„ï¼‰ã€‚</p></blockquote></li><li><p><strong>éƒ½æ˜¯å¯é‡å…¥é”</strong>ï¼šæ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¯é‡å¤è·å¾—é”ï¼Œæ¯è·å¾—ä¸€æ¬¡ï¼Œé”çš„è®¡æ•°å™¨éƒ½è‡ªå¢1ï¼Œæ‰€ä»¥è¦ç­‰åˆ°é”çš„è®¡æ•°å™¨ä¸‹é™ä¸º0æ—¶æ‰èƒ½é‡Šæ”¾é”ã€‚</p></li></ul></li><li><p><strong>ä¸åŒç‚¹</strong></p><ul><li><p><strong>å®ç°åŸç†</strong>ï¼š Synchronizedæ˜¯javaè¯­è¨€çš„å…³é”®å­—ï¼Œæ˜¯åŸç”Ÿè¯­æ³•å±‚é¢çš„äº’æ–¥ï¼Œ JVM å±‚é¢ï¼›ReentrantLockæ˜¯JDK 1.5åçš„APIå±‚é¢çš„äº’æ–¥é”ï¼Œéœ€è¦<u>lock()å’Œunlock()æ–¹æ³•é…åˆtry/finallyè¯­å¥å—æ¥å®Œæˆ</u>ï¼›</p><blockquote><p><img src="https://i.loli.net/2021/04/28/tSoiYbRl5kdA9my.png" alt="image-20210428222639476"></p></blockquote></li><li><p><strong>æ˜¯å¦é¿å…æ­»é”</strong>ï¼š synchronized<strong>åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶</strong>ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”ï¼Œ<strong>å› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”ç°è±¡</strong>å‘ç”Ÿï¼›Lockä¸ä¼šä¸»åŠ¨é€‚åº” <code>unLock()</code> é‡Šæ”¾ï¼Œå¿…é¡»æ‰‹åŠ¨åœ¨f<code>inally</code>é‡Šæ”¾ï¼›ç›¸â½synchronizedï¼ŒReentrantLockå¢åŠ äº†â¼€äº›é«˜çº§åŠŸèƒ½ã€‚ä¸»è¦æ¥è¯´ä¸»è¦æœ‰ä¸‰ç‚¹ï¼šâ‘ ç­‰å¾…å¯ä¸­æ–­ï¼›â‘¡å¯å®ç°å…¬å¹³é”ï¼›â‘¢å¯å®ç°é€‰æ‹©æ€§é€šçŸ¥ï¼ˆé”å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶ï¼‰</p></li><li><p><u><strong>çº¿ç¨‹ç­‰å¾…å¯ä¸­æ–­</strong>ï¼š</u> Lockå¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œçº¿ç¨‹å¯ä»¥ä¸­æ–­å»å¹²åˆ«çš„äº‹åŠ¡ï¼›è€Œsynchronizedå´ä¸è¡Œï¼Œä½¿ç”¨synchronizedæ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼›</p></li><li><p><strong>å…¬å¹³é”</strong>ï¼š synchronizedçš„é”æ˜¯éå…¬å¹³é”ï¼ŒReentrantLocké»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³é”ï¼Œä½†å¯ä»¥é€šè¿‡å¸¦å¸ƒå°”å€¼çš„æ„é€ å‡½æ•°è¦æ±‚ä½¿ç”¨å…¬å¹³é”ï¼›</p><ul><li><strong>é€‰æ‹©æ€§é€šçŸ¥</strong>ï¼š synchronizedå…³é”®å­—ä¸wait()å’Œnotify()/notifyAll()æ–¹æ³•ç›¸ç»“åˆå¯ä»¥å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼ŒReentrantLockç±»å½“ç„¶ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯éœ€è¦å€ŸåŠ©äºConditionæ¥å£ä¸newCondition() æ–¹æ³•ã€‚<br>Conditionæ˜¯JDK1.5ä¹‹åæ‰æœ‰çš„ï¼Œå®ƒå…·æœ‰å¾ˆå¥½çš„çµæ´»æ€§ï¼Œâ½å¦‚å¯ä»¥å®ç°å¤šè·¯é€šçŸ¥åŠŸèƒ½ä¹Ÿå°±æ˜¯åœ¨â¼€ä¸ªLockå¯¹è±¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªConditionå®ä¾‹ï¼ˆå³å¯¹è±¡ç›‘è§†å™¨ï¼‰ï¼Œçº¿ç¨‹å¯¹è±¡å¯ä»¥æ³¨å†Œåœ¨æŒ‡å®šçš„Conditionä¸­ï¼Œä»è€Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è¿›è¡Œçº¿ç¨‹é€šçŸ¥ï¼Œåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šæ›´åŠ çµæ´»ã€‚ åœ¨ä½¿â½¤notify()/notifyAll()æ–¹æ³•è¿›è¡Œé€šçŸ¥æ—¶ï¼Œè¢«é€šçŸ¥çš„çº¿ç¨‹æ˜¯ç”± JVM é€‰æ‹©çš„ï¼Œâ½¤ReentrantLockç±»ç»“åˆConditionå®ä¾‹å¯ä»¥å®ç°â€œé€‰æ‹©æ€§é€šçŸ¥â€ ï¼Œè¿™ä¸ªåŠŸèƒ½éå¸¸é‡è¦ï¼Œè€Œä¸”æ˜¯Conditionæ¥å£é»˜è®¤æä¾›çš„ã€‚è€Œsynchronizedå…³é”®å­—å°±ç›¸å½“äºæ•´ä¸ªLockå¯¹è±¡ä¸­åªæœ‰â¼€ä¸ªConditionå®ä¾‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ³¨å†Œåœ¨å®ƒâ¼€ä¸ªèº«ä¸Šã€‚å¦‚æœæ‰§è¡ŒnotifyAll()æ–¹æ³•çš„è¯å°±ä¼šé€šçŸ¥æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è¿™æ ·ä¼šé€ æˆå¾ˆå¤§çš„æ•ˆç‡é—®é¢˜ï¼Œ<u>è€ŒConditionå®ä¾‹çš„signalAll()æ–¹æ³• åªä¼šå”¤é†’æ³¨å†Œåœ¨è¯¥Conditionå®ä¾‹ä¸­çš„æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</u>ã€‚</li></ul></li></ul></li></ul><h5 id="1-3-synchronizedé”ä½çš„æ˜¯ä»€ä¹ˆï¼Œåœ¨é¡¹ç›®ä¸­é‡åˆ°äº†å—ï¼Ÿ">1.3 <strong>synchronizedé”ä½çš„æ˜¯ä»€ä¹ˆï¼Œåœ¨é¡¹ç›®ä¸­é‡åˆ°äº†å—</strong>ï¼Ÿ</h5><p>synchronizedæœ¬èº«å¹¶ä¸æ˜¯é”ï¼Œé”æœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œsynchronizedæœ€å¤šç›¸å½“äºâ€œåŠ é”â€æ“ä½œï¼Œæ‰€ä»¥synchronizedå¹¶ä¸æ˜¯é”ä½ä»£ç å—ã€‚</p><p>ï¼ˆ<strong>é‡ç‚¹</strong>ï¼‰Javaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ï¼Œå…·ä½“è¡¨ç¤ºæœ‰ä¸‰ç§å½¢å¼ï¼š</p><p><img src="https://i.loli.net/2021/05/04/LzjeqdIi5rbM819.png" alt="image-20210504232344320"></p><blockquote><p>é¢è¯•ä¸­é¢è¯•å®˜ç»å¸¸ä¼šè¯´ï¼šâ€œå•ä¾‹æ¨¡å¼äº†è§£å—ï¼Ÿæ¥ç»™æˆ‘â¼¿å†™â¼€ä¸‹ï¼ç»™æˆ‘è§£é‡Šâ¼€ä¸‹åŒé‡æ£€éªŒé”æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„åŸç†å‘—ï¼â€</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton uniqueInstance;</span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Singleton       <span class="title">getUniqueInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›â¼ŠåŠ é”ä»£ç </span></span><br><span class="line">       <span class="keyword">if</span> (uniqueInstance WX <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//ç±»å¯¹è±¡åŠ é”</span></span><br><span class="line">        <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">        <span class="keyword">if</span> (uniqueInstance WX <span class="keyword">null</span>) &#123;</span><br><span class="line">        uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniqueInstance = <span class="keyword">new</span> Singleton();</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š</p><ol><li><p>ä¸º uniqueInstance åˆ†é…å†…å­˜ç©ºé—´</p></li><li><p>åˆå§‹åŒ– uniqueInstance</p></li><li><p>å°† uniqueInstance æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€</p></li></ol><p>ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1&gt;3&gt;2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´â¼€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getUniqueInstance() åå‘ç° uniqueInstance ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å›uniqueInstanceï¼Œ<u>ä½†æ­¤æ—¶ uniqueInstance è¿˜æœªè¢«åˆå§‹åŒ–</u>ã€‚</p><h5 id="1-4-synchronizedé”çš„ä¼˜åŒ–æœºåˆ¶äº†è§£å—ï¼Ÿ">1.4 <strong>synchronizedé”çš„ä¼˜åŒ–æœºåˆ¶äº†è§£å—</strong>ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903726545633287">æ­»ç£•Synchronizedåº•å±‚å®ç°</a></p><p><a href="https://tech.meituan.com/2018/11/15/java-lock.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></p></blockquote><p>synchronizedæœ¬èº«ä¹Ÿåœ¨ä¸æ–­ä¼˜åŒ–é”çš„æœºåˆ¶ï¼Œæœ‰äº›æƒ…å†µä¸‹ä»–å¹¶ä¸ä¼šæ˜¯ä¸€ä¸ªå¾ˆé‡é‡çº§çš„é”äº†ã€‚ä¼˜åŒ–æœºåˆ¶åŒ…æ‹¬ï¼š</p><ul><li>è‡ªé€‚åº”é”ã€è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€è½»é‡çº§é”å’Œåå‘é”ï¼›</li><li>é”çš„çŠ¶æ€ä»ä½åˆ°é«˜ä¾æ¬¡ä¸ºï¼š<strong>æ— é”-&gt;åå‘é”-&gt;è½»é‡çº§é”-&gt;é‡é‡çº§é”</strong>ã€‚</li></ul><p><img src="https://i.loli.net/2021/05/16/PjXkchreF9sSEKG.png" alt="image-20210516131559341"></p><p>å¸¸è§çš„é”ï¼š</p><ul><li><p><strong>æ— é”</strong>ï¼šæ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œ<strong>ä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸ</strong>ã€‚</p><blockquote><p>é”åˆ°åº•å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¯¹è±¡å¤´ä¸­ã€‚</p><p>å¯¹è±¡å¤´ä¸»è¦åˆåŒ…æ‹¬äº†ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Class Pointï¼ˆç±»å‹æŒ‡é’ˆï¼‰ã€‚</p></blockquote><ol start="0"><li><p>åˆå§‹mark word å°†æ˜¯å¯åå‘çŠ¶æ€ï¼Œæ­¤æ—¶çš„ <u>æ˜¯å¦åå‘é”</u> ä¸º 0ï¼Œè¡¨ç¤ºå½“å‰æ²¡æœ‰ä»»ä½•ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯¥é”ã€‚</p><p><img src="https://i.loli.net/2021/05/21/bNepQwU6scYXCv5.png" alt="image-20210521210754337"></p></li></ol></li><li><p><strong>åå‘é”</strong>ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å‡ºç°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚</p><blockquote><p>JDK1.6 ä¸­ä¸ºäº†æé«˜ä¸€ä¸ªå¯¹è±¡åœ¨ä¸€æ®µå¾ˆé•¿çš„æ—¶é—´å†…éƒ½åªè¢«ä¸€ä¸ªçº¿ç¨‹ç”¨åšé”å¯¹è±¡åœºæ™¯ä¸‹çš„æ€§èƒ½ï¼Œå¼•å…¥äº†åå‘é”ã€‚åœ¨<strong>ç¬¬ä¸€æ¬¡</strong>è·å¾—é”æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ª CAS æ“ä½œï¼ˆè§ä¸‹ï¼‰ï¼›<strong>ä¹‹å</strong>è¯¥çº¿ç¨‹å†è·å–é”ï¼Œåªä¼šæ‰§è¡Œå‡ ä¸ªç®€å•çš„å‘½ä»¤ï¼Œè€Œä¸æ˜¯å¼€é”€ç›¸å¯¹è¾ƒå¤§çš„ CAS å‘½ä»¤ã€‚</p></blockquote><ol><li><p><strong>CASE 1 :</strong> çº¿ç¨‹<strong>ç¬¬ä¸€æ¬¡</strong>è·å¾—é”ï¼Œå¦‚æœ<strong>æœªåå‘</strong>ï¼Œé€šè¿‡ <strong>CAS</strong> æŒ‡ä»¤ï¼š</p><p><img src="https://i.loli.net/2021/05/21/fwEX4OAMFnyWrbJ.png" alt="image-20210521210949942"></p><ul><li><strong>æ’å…¥çº¿ç¨‹ID :</strong> å‘mark wordæ’å…¥çº¿ç¨‹ID</li><li><strong>åå‘é”æ ‡è¯†</strong>ï¼šå°† mark word ä¸­çš„åå‘é”æ ‡è¯†ä»<code>0â†’1</code></li><li><s><strong>é”æ ‡å¿—ä½</strong>ï¼šä¸ä¿®æ”¹ï¼å› ä¸ºä¸å˜ï¼</s></li></ul><p>å¦‚æœæ“ä½œæˆåŠŸï¼šï¼Œåˆ™è¯´æ˜è·å¾—äº†åå‘é”ï¼Œä»¥åå½“å‰<u>çº¿ç¨‹ç­‰äºowner</u>å°±å¯ä»¥<strong>é›¶æˆæœ¬</strong>çš„ç›´æ¥è·å¾—é”ï¼›</p><p>å¦‚æœæ“ä½œå¤±è´¥ï¼Œè¯´æ˜æœ‰å…¶å®ƒçº¿ç¨‹è·å–äº†é”ï¼š</p><ul><li><strong>å¦‚æœåå‘çº¿ç¨‹è¿˜å­˜åœ¨</strong>ï¼šç›´æ¥è¿›è¡Œå‡çº§ä¸ºè½»é‡çº§é”ï¼›</li><li><strong>å¦‚æœåå‘çº¿ç¨‹ä¸å­˜åœ¨ï¼šå…ˆä¿®æ”¹é”æ ‡è¯†ä¸º01â†’00</strong> ï¼Œå†å‡çº§ä¸ºè½»é‡çº§é”ã€‚</li></ul></li><li><p><strong>CASE 2 :</strong>  è¿™æ˜¯<strong>ä¸€æ¬¡å¯é‡å…¥</strong>ï¼Œåå‘çº¿ç¨‹æ˜¯è‡ªå·±ã€‚</p><p>åœ¨<u>å½“å‰çº¿ç¨‹æ ˆ</u>ä¸­æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ <strong>Lock Record</strong> <strong>ï¼šå¹¶å°†å…¶ obj æŒ‡å‘é”å¯¹è±¡ &amp; Displaced Mark Word ç½®ä¸ºnull</strong></p><img src="https://i.loli.net/2021/05/18/LXj2NZi7fVOzpox.png" alt="img" style="zoom:50%;" /></li></ol></li><li><p><strong>è½»é‡çº§é”</strong>ï¼šå½“å‘ç°å¤šçº¿ç¨‹ç«äº‰æ—¶ï¼Œåå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¼šåœ¨ safepointï¼ˆæ­¤æ—¶ç”¨æˆ·ä»£ç ä¸ä¼šæ‰§è¡Œï¼‰ä¸­å»æŸ¥çœ‹<u>åå‘çš„çº¿ç¨‹æ˜¯å¦è¿˜å­˜æ´»</u>ã€‚</p><p><img src="https://i.loli.net/2021/05/18/anN1S6AD7MI9gK8.jpg" alt="img"></p><ol><li>å¦‚æœåå‘çš„çº¿ç¨‹å·²ç»ä¸å­˜æ´»æˆ–è€…ä¸åœ¨åŒæ­¥å—ä¸­ï¼Œåˆ™å°†å¯¹è±¡å¤´çš„ mark word æ”¹ä¸ºæ— é”çŠ¶æ€ï¼ˆunlockedï¼‰ï¼Œ<strong>é‡æ–°åå‘æ–°çš„çº¿ç¨‹</strong>ï¼›</li><li>å¦‚æœå­˜æ´»ä¸”è¿˜åœ¨<strong>åŒæ­¥å—</strong>ä¸­ï¼ŒåŸåå‘çš„çº¿ç¨‹ç»§ç»­æ‹¥æœ‰é”ï¼Œå½“å‰çº¿ç¨‹åˆ™èµ°å…¥åˆ°è½»é‡çº§é”çš„åŠ é”é€»è¾‘ä¸­ï¼›</li></ol><p>è½»é‡çº§é”çš„å¤„ç†æµç¨‹ ï¼š</p><ol start="3"><li>å‘ç°å·²ç»æœ‰åå‘çš„çº¿ç¨‹äº†ï¼Œåˆ™ä¼š<strong>å…ˆ æ’¤ é”€åå‘é”ï¼Œç„¶åå‡çº§ä¸ºè½»é‡é”</strong> ã€‚é€šè¿‡<strong>CASå‘½ä»¤æ›´æ–°</strong>ï¼š</li></ol><p><img src="https://i.loli.net/2021/06/02/BMyh36f2OPCGkKe.png" alt="image-20210602161303534"></p><ul><li><p><strong>ä¿®æ”¹æ­¤å‰ <u>å½“å‰çº¿ç¨‹æ ˆå¸§Lock Record</u>ï¼š</strong> ï¼ˆ1ï¼‰Displaced Mark Word å¤åˆ¶ mark word ï¼ˆæ­¤æ—¶<strong>æ— é”</strong>çŠ¶æ€ï¼‰ä¸­çš„ç°æœ‰å†…å®¹</p></li><li><p><strong>ä¿®æ”¹mark word <strong>ï¼š<u>mark word æŒ‡å‘</strong>å½“å‰çº¿ç¨‹æ ˆå¸§Lock Recordçš„</strong> <strong>Displaced Mark Word</strong>çš„åœ°å€</u>ï¼Œè§ä¸Šå›¾ï¼›</p></li><li><p><strong>ä¿®æ”¹é”æ ‡å¿—ä½</strong>ï¼š <code>01 â†’ 00</code></p><p><img src="https://i.loli.net/2021/05/21/QNDEreAK6Ulohvg.png" alt="image-20210521214141329"></p></li></ul><ol start="4"><li><p>ä¸Šè¿°CASæ›´æ–°æˆåŠŸï¼Œåˆ™<strong>å½“å‰çº¿ç¨‹è·å¾—äº†å¯¹è±¡çš„é”</strong>  ï¼›</p><p>å¦‚æœä¸æˆåŠŸï¼š</p><ul><li><p>æ£€æŸ¥Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§çš„Lock Record ï¼Œæ˜¯åˆ™æ˜¯ä¸€æ¬¡<strong>å¯é‡å…¥</strong></p><blockquote><p>è®¾ç½®<code>Lock Record</code>ç¬¬ä¸€éƒ¨åˆ†ï¼ˆ<code>Displaced Mark Word</code>ï¼‰ä¸ºnullï¼Œèµ·åˆ°äº†ä¸€ä¸ªé‡å…¥è®¡æ•°å™¨çš„ä½œç”¨ã€‚ç„¶åç»“æŸã€‚</p></blockquote></li><li><p>å¦‚æœä¸æ˜¯åˆ™æ˜¯è¿›è¡Œ<strong>è‡ªæ—‹ç­‰å¾…</strong></p></li></ul></li><li><p>å½“<strong>1.è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°</strong>ï¼ˆé»˜è®¤10ï¼‰ï¼Œæˆ–è€…<strong>2.ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶</strong>ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p></li></ol></li><li><p><strong>é‡é‡çº§é”</strong>ï¼šå†…ç½®é”åœ¨Javaä¸­è¢«æŠ½è±¡ä¸º<strong>ç›‘è§†å™¨é”ï¼ˆmonitorï¼‰</strong>ã€‚åœ¨JDK 1.6ä¹‹å‰ï¼Œç›‘è§†å™¨é”å¯ä»¥è®¤ä¸ºç›´æ¥å¯¹åº”åº•å±‚æ“ä½œç³»ç»Ÿä¸­çš„äº’æ–¥é‡ï¼ˆmutexï¼‰ã€‚è¿™ç§<strong>åŒæ­¥æ–¹å¼çš„æˆæœ¬éå¸¸é«˜</strong>ï¼Œ<u>åŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨å¼•èµ·çš„å†…æ ¸æ€ä¸ç”¨æˆ·æ€åˆ‡æ¢ã€çº¿ç¨‹é˜»å¡é€ æˆçš„çº¿ç¨‹åˆ‡æ¢ç­‰</u>ã€‚</p><blockquote><p>Monitorå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·æˆ–ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚<strong>æ¯ä¸€ä¸ªJavaå¯¹è±¡å°±æœ‰ä¸€æŠŠçœ‹ä¸è§çš„é”Monitor</strong>ï¼Œç§°ä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚</p><p>Monitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ª<strong>Owner</strong>å­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚</p></blockquote><p>å¦‚æœé”ç«äº‰æƒ…å†µä¸¥é‡ï¼ŒæŸä¸ªè¾¾åˆ°æœ€å¤§è‡ªæ—‹æ¬¡æ•°çš„çº¿ç¨‹ï¼Œä¼šå°†è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚<u>çº¿ç¨‹å»è·å–é‡é‡çº§é”ï¼Œå…¶å®å°±æ˜¯å°±å°è¯•è·å–å¯¹è±¡çš„monitoré”ã€‚</u></p><blockquote><p>å³å°† monitoré”çš„ <strong>Ownerå­—æ®µä¿®æ”¹ä¸ºå½“å‰çº¿ç¨‹ID</strong> ã€‚</p></blockquote><p>å¦‚æœè·å–æˆåŠŸï¼Œæ­¤æ—¶çº¿ç¨‹è·å¾—äº†é”ï¼Œ<strong>CASä¿®æ”¹</strong> ï¼š</p><ol start="2"><li><p><strong>ä¿®æ”¹mark word</strong> ï¼šç„¶åå°†å¯¹è±¡å¤´mark word æ”¹ä¸º<strong>æŒ‡å‘è¯¥ monitor çš„æŒ‡é’ˆ</strong>ã€‚</p></li><li><p><strong>é”æ ‡å¿—ä½</strong>ï¼š<code>00 â†’ 10</code></p><p><img src="https://i.loli.net/2021/05/21/NLFv3fKIh14RlzY.png" alt="image-20210521214213205"></p></li></ol></li></ul><h5 id="1-5-ä¸ºä»€ä¹ˆè¯´Synchronizedæ˜¯éå…¬å¹³é”ï¼Œè¿™æ ·çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ">1.5 <strong>ä¸ºä»€ä¹ˆè¯´Synchronizedæ˜¯éå…¬å¹³é”ï¼Œè¿™æ ·çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</h5><p>å¹¶éæ˜¯æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´å‰åç»™ç­‰å¾…çº¿ç¨‹åˆ†é…é”çš„ï¼Œ<strong>æ¯å½“é”è¢«é‡Šæ”¾åï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰æœºä¼šç«äº‰åˆ°é”</strong>ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æé«˜æ‰§è¡Œæ€§èƒ½ï¼›</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ˜¯å¯èƒ½äº§ç”Ÿçº¿ç¨‹é¥¥é¥¿ç°è±¡ã€‚</li></ul><h5 id="1-6-ä¸ºä»€ä¹ˆè¯´synchronizedæ˜¯ä¸€ä¸ªæ‚²è§‚é”ï¼Ÿä¹è§‚é”çš„å®ç°åŸç†åˆæ˜¯ä»€ä¹ˆï¼Ÿ">1.6 <strong>ä¸ºä»€ä¹ˆè¯´synchronizedæ˜¯ä¸€ä¸ªæ‚²è§‚é”ï¼Ÿä¹è§‚é”çš„å®ç°åŸç†åˆæ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</h5><blockquote><p>æ²¡çœ‹å®Œï¼Œäº†è§£äº†ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š<a href="https://www.cnblogs.com/jojop/p/14022029.html">https://www.cnblogs.com/jojop/p/14022029.html</a></p></blockquote><ul><li><p><strong>synchronizedæ‚²è§‚é”</strong></p><p>Synchronizedæ˜¾ç„¶æ˜¯ä¸€ä¸ªæ‚²è§‚é”ï¼Œå› ä¸ºå®ƒçš„å¹¶å‘ç­–ç•¥æ˜¯æ‚²è§‚çš„ï¼š</p><ul><li><strong>ä¸ç®¡æ˜¯å¦ä¼šäº§ç”Ÿç«äº‰ï¼Œä»»ä½•çš„æ•°æ®éƒ½å¿…é¡»åŠ é”</strong>ã€‚</li></ul></li><li><p><strong>synchronizedåŸç†</strong></p><p>Synchronizedæ˜¯é€šè¿‡<strong>è·å–å¯¹è±¡å†…éƒ¨çš„ä¸€ä¸ªå«åšç›‘è§†å™¨é”ï¼ˆmonitor</strong>ï¼‰æ¥å®ç°çš„ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªç›‘è§†å™¨é”ï¼ˆmonitorï¼‰ã€‚å½“monitorè¢«å ç”¨æ—¶å°±ä¼šå¤„äºé”å®šçŠ¶æ€ï¼Œçº¿ç¨‹æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶å°è¯•è·å–monitorçš„æ‰€æœ‰æƒã€‚</p><blockquote><p>ç›‘è§†å™¨é”æœ¬è´¨åˆæ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockæ¥å®ç°çš„ã€‚è€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢è¿™å°±éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œè¿™ä¸ªæˆæœ¬éå¸¸é«˜ï¼ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆSynchronizedæ•ˆç‡ä½çš„åŸå› ã€‚</p></blockquote><ol><li><p>å¦‚æœmonitorçš„è¿›å…¥æ•°ä¸º0ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥monitorï¼Œç„¶åå°†è¿›å…¥æ•°è®¾ç½®ä¸º1ï¼Œè¯¥çº¿ç¨‹å³ä¸ºmonitorçš„æ‰€æœ‰è€…ï¼›</p></li><li><p>å¦‚æœçº¿ç¨‹å·²ç»å æœ‰è¯¥monitorï¼Œ<u>åªæ˜¯é‡æ–°è¿›å…¥</u>ï¼Œåˆ™è¿›å…¥monitorçš„è¿›å…¥æ•°åŠ 1ï¼›</p></li><li><p>å¦‚æœ<u>å…¶ä»–çº¿ç¨‹å·²ç»å ç”¨äº†monitorï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€</u>ï¼Œç›´åˆ°monitorçš„è¿›å…¥æ•°ä¸º0ï¼Œå†é‡æ–°å°è¯•è·å–monitorçš„æ‰€æœ‰æƒã€‚</p></li></ol></li><li><p><strong>ä¹è§‚é”å®ç°åŸç†ï¼šCAS</strong></p><blockquote><p>å‚è€ƒå¥½æ–‡ï¼š<a href="https://zhuanlan.zhihu.com/p/94762520">ä¸€æ–‡å½»åº•ææ‡‚CASå®ç°åŸç†</a></p></blockquote></li></ul><h5 id="1-7-ï¼ˆCASåŸç†é‡ç‚¹ï¼‰ä»€ä¹ˆæ˜¯CASï¼ŸCASçš„ç¼ºç‚¹ï¼Ÿè¯´è¯´CASæºç å®ç°ï¼Ÿ">1.7 ï¼ˆCASåŸç†é‡ç‚¹ï¼‰ä»€ä¹ˆæ˜¯CASï¼ŸCASçš„ç¼ºç‚¹ï¼Ÿè¯´è¯´CASæºç å®ç°ï¼Ÿ</h5><p>ä¹è§‚é”çš„æ ¸å¿ƒç®—æ³•æ˜¯CASï¼ˆCompared And Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ï¼š</p><ul><li><p><strong>å…³é”®é€»è¾‘</strong>ï¼š CASï¼Œæœ‰å‡ ä¸ªé‡è¦çš„å‚æ•°ï¼š</p><p>ï¼ˆ1ï¼‰<strong>this</strong>ï¼ŒUnsafe å¯¹è±¡æœ¬èº«ï¼Œéœ€è¦é€šè¿‡è¿™ä¸ªç±»æ¥è·å– value çš„å†…å­˜åç§»åœ°å€ã€‚</p><p>ï¼ˆ2ï¼‰<strong>valueOffset</strong>ï¼Œvalue å˜é‡çš„å†…å­˜åç§»åœ°å€ã€‚</p><p>ï¼ˆ3ï¼‰<strong>expect</strong>ï¼ŒæœŸæœ›æ›´æ–°çš„å€¼ã€‚</p><p>ï¼ˆ4ï¼‰<strong>update</strong>ï¼Œè¦æ›´æ–°çš„æœ€æ–°å€¼ã€‚</p><p>å¦‚æœåŸå­å˜é‡ä¸­çš„ <strong>value å€¼ç­‰äº expect</strong>ï¼Œåˆ™ä½¿ç”¨ update å€¼æ›´æ–°è¯¥å€¼å¹¶è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</p></li><li><p><strong>CASç‰¹æ€§</strong>ï¼š CASå…·æœ‰åŸå­æ€§ï¼Œå®ƒçš„åŸå­æ€§ç”±CPUç¡¬ä»¶æŒ‡ä»¤å®ç°ä¿è¯ã€‚</p><ul><li>ã€<strong>ç¼ºç‚¹1</strong>ã€‘<strong>ABAé—®é¢˜</strong>ï¼šå¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹Vå€¼å‡è®¾åŸæ¥æ˜¯Aï¼Œå…ˆä¿®æ”¹æˆBï¼Œå†ä¿®æ”¹å›æˆAã€‚å½“å‰çº¿ç¨‹çš„CASæ“ä½œæ— æ³•åˆ†è¾¨å½“å‰Vå€¼æ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ–ã€‚<ul><li><strong>è§£å†³ABAï¼š</strong> åœ¨å˜é‡å‰é¢åŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™å˜é‡çš„<strong>ç‰ˆæœ¬å·éƒ½<code>+1</code></strong>ï¼Œå³<code>A-&gt;B-&gt;A</code>å°±å˜æˆäº†<code>1A-&gt;2B-&gt;3A</code></li></ul></li><li>ã€<strong>ç¼ºç‚¹2ã€‘åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</strong>ï¼šå½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯CASçš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯CASå°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ã€‚</li><li>ã€<strong>ç¼ºç‚¹3</strong>ã€‘<strong>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</strong>ï¼šå¯¹äºèµ„æºç«äº‰ä¸¥é‡ï¼ˆçº¿ç¨‹å†²çªä¸¥é‡ï¼‰çš„æƒ…å†µï¼ŒCASè‡ªæ—‹çš„æ¦‚ç‡ä¼šæ¯”è¾ƒå¤§ï¼Œä»è€Œæµªè´¹æ›´å¤šçš„CPUèµ„æºï¼Œæ•ˆç‡ä½äºsynchronizedã€‚</li></ul></li><li><p><strong>CASæºç åˆ†æ</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000014858404?utm_source=sf-similar-article">Java CAS åŸç†åˆ†æ</a></p></blockquote><blockquote><p>CAS å…¨ç§°æ˜¯ compare and swapï¼Œæ˜¯ä¸€ç§ç”¨äºåœ¨<strong>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®ç°åŒæ­¥</strong>åŠŸèƒ½çš„æœºåˆ¶ã€‚</p></blockquote><p>CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•° â€“ å†…å­˜ä½ç½®ã€é¢„æœŸæ•°å€¼å’Œæ–°å€¼ã€‚CAS çš„å®ç°é€»è¾‘æ˜¯å°†å†…å­˜ä½ç½®å¤„çš„æ•°å€¼ä¸é¢„æœŸæ•°å€¼æƒ³æ¯”è¾ƒï¼Œè‹¥ç›¸ç­‰ï¼Œåˆ™å°†å†…å­˜ä½ç½®å¤„çš„å€¼æ›¿æ¢ä¸ºæ–°å€¼ã€‚è‹¥ä¸ç›¸ç­‰ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œã€‚</p><p>Java å¹¶æ²¡æœ‰ç›´æ¥å®ç° CASï¼ŒCAS ç›¸å…³çš„å®ç°æ˜¯é€šè¿‡ C++ å†…è”æ±‡ç¼–çš„å½¢å¼å®ç°çš„ï¼Œä¸‹é¢æ˜¯å…·ä½“åˆ†æã€‚</p><ul><li><p><strong>èƒŒæ™¯ä»‹ç»</strong></p><p>åœ¨å¤šæ ¸å¿ƒæ—¶ä»£ä¸‹ï¼Œ<strong>å¤šä¸ªæ ¸å¿ƒé€šè¿‡åŒä¸€æ¡æ€»çº¿å’Œå†…å­˜ä»¥åŠå…¶ä»–ç¡¬ä»¶è¿›è¡Œé€šä¿¡</strong>ã€‚</p><p><img src="https://segmentfault.com/img/remote/1460000014858409?w=1598&amp;h=710" alt="img"></p><p><strong>CPU çš„å¤šä¸ªæ ¸å¿ƒåŒæ—¶å¯¹åŒä¸€ç‰‡å†…å­˜è¿›è¡Œæ“ä½œ</strong>ï¼Œä¼šå¯¼è‡´é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œé€’å¢æŒ‡ä»¤<code>inc dword ptr [...]</code>ï¼Œç­‰ä»·äº<code>DEST = DEST + 1</code>ã€‚è¯¥æŒ‡ä»¤åŒ…å«ä¸‰ä¸ªæ“ä½œ<code>è¯»-&gt;æ”¹-&gt;å†™</code>ï¼Œæ¶‰åŠä¸¤æ¬¡è®¿å­˜ã€‚</p><ol><li>æ ¸å¿ƒ1,2ä»å†…å­˜è¯»å–æ•°æ®<code>1</code>ï¼Œå¹¶å†™åˆ°å„è‡ªå¯„å­˜å™¨ä¸­</li><li>æ ¸å¿ƒ1å°†å¯„å­˜å™¨ä¸­æ•°æ®<code>1â†’2</code></li><li>æ ¸å¿ƒ2å°†å¯„å­˜å™¨ä¸­æ•°æ®<code>1â†’2</code></li><li>ç„¶åéƒ½å†™å›ä¸»å­˜ï¼Œæ­¤æ—¶ä¸º<code>2</code></li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºæ ¸å¿ƒ2åœ¨æ ¸å¿ƒ1<strong>å†™å…¥ä¸»å­˜æ“ä½œå®Œæˆå‰è¿›è¡Œè¯»å–</strong>ï¼Œå¯¼è‡´å¹¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„<code>3</code> ã€‚</p><p>é€šè¿‡åœ¨é€’å¢<code>inc</code> æŒ‡ä»¤å‰æ·»åŠ  lock å‰ç¼€ï¼Œå¯ä»¥è®©æ ¸å¿ƒç‹¬å æŸä¸ªå†…å­˜åŒºåŸŸï¼Œç”±æ­¤å¯ä»¥é¿å…ä¸Šé¢é—®é¢˜ã€‚lock å‰ç¼€ä¿è¯æ ¸å¿ƒç‹¬å æŸç‰‡å†…å­˜åŒºåŸŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><strong>æ€»çº¿é”</strong>ã€‚æ€»çº¿è¢«é”å®šåï¼Œå…¶ä»–æ ¸å¿ƒå°±ä¸èƒ½è®¿é—®å†…å­˜äº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–æ ¸å¿ƒçŸ­æ—¶å†…åœæ­¢å·¥ä½œï¼›</li><li><strong>ç¼“å­˜é”</strong>ã€‚è‹¥<strong>æŸå¤„</strong>å†…å­˜æ•°æ®è¢«ç¼“å­˜åœ¨å¤„ç†å™¨ç¼“å­˜ä¸­ï¼Œå¤„ç†å™¨å‘å‡ºçš„ LOCK# ä¿¡å·ä¸ä¼šé”å®šæ€»çº¿ï¼Œè€Œæ˜¯<strong>é”å®šç¼“å­˜å¯¹åº”çš„å†…å­˜åŒºåŸŸ</strong>ã€‚å…¶ä»–å¤„ç†å™¨åœ¨è¿™ç‰‡å†…å­˜åŒºåŸŸé”å®šæœŸé—´ï¼Œæ— æ³•å¯¹è¿™ç‰‡å†…å­˜åŒºåŸŸè¿›è¡Œç›¸å…³æ“ä½œã€‚ï¼ˆ<strong>ä¸æ˜¯ä¹è§‚æœºåˆ¶éƒ½å¯ä»¥æ“ä½œå—ï¼Ÿä¸èƒ½å†™å…¥å†…å­˜</strong>ï¼Ÿï¼‰</li></ol></li><li><p><strong>æºç åˆ†æ</strong></p><blockquote><p>æˆ‘ä»¬åˆ†æï¼Œ<code>java.util.concurrent.atomic</code> åŒ…ä¸‹çš„åŸå­ç±» <code>AtomicInteger</code> ä¸­çš„ <code>compareAndSet</code> æ–¹æ³• ã€‚</p></blockquote><ol><li><p>AtomicIntegerå…·ä½“å®ç°ä¸­ï¼ŒcompareAndSet å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå£³å­ï¼Œä¸»è¦çš„é€»è¾‘å°è£…åœ¨ Unsafe çš„ compareAndSwapInt æ–¹æ³•ä¸­ï¼›</p></li><li><p>compareAndSwapIntæ˜¯ä¸€ä¸ªnativeæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapInt</span><span class="params">(Object o, <span class="keyword">long</span> offset,<span class="keyword">int</span> expected,<span class="keyword">int</span> x)</span></span>;</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicInteger</span> <span class="keyword">extends</span> <span class="title">Number</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setup to use Unsafe.compareAndSwapInt for updates</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è®¡ç®—å˜é‡ value åœ¨ç±»å¯¹è±¡ä¸­çš„åç§»</span></span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicInteger.class.getDeclaredField(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> Error(ex); &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * compareAndSet å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå£³å­ï¼Œä¸»è¦çš„é€»è¾‘å°è£…åœ¨ Unsafeçš„compareAndSwapInt æ–¹æ³•ä¸­</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Unsafe</span> </span>&#123;</span><br><span class="line">    <span class="comment">// compareAndSwapInt æ˜¯ native ç±»å‹çš„æ–¹æ³•ï¼Œç»§ç»­å¾€ä¸‹çœ‹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapInt</span><span class="params">(Object o, <span class="keyword">long</span> offset,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="keyword">int</span> expected,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                  <span class="keyword">int</span> x)</span></span>;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬è¿›å…¥unsafe.cppï¼ˆcompareAndSwapIntæ˜¯nativeæ–¹æ³•ï¼‰å…·ä½“å®ç°ä¸­ï¼Œçœ‹çœ‹è°ƒç”¨ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unsafe.cpp</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * è¿™ä¸ªçœ‹èµ·æ¥å¥½åƒä¸åƒä¸€ä¸ªå‡½æ•°ï¼Œä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œä¸æ˜¯é‡ç‚¹ã€‚UNSAFE_ENTRY å’Œ UNSAFE_END éƒ½æ˜¯å®ï¼Œ</span></span><br><span class="line"><span class="comment"> * åœ¨é¢„ç¼–è¯‘æœŸé—´ä¼šè¢«æ›¿æ¢æˆçœŸæ­£çš„ä»£ç ã€‚ä¸‹é¢çš„ jbooleanã€jlong å’Œ jint ç­‰æ˜¯ä¸€äº›ç±»å‹å®šä¹‰ï¼ˆtypedefï¼‰ï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">UNSAFE_ENTRY</span>(jboolean, <span class="built_in">Unsafe_CompareAndSwapInt</span>(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))</span><br><span class="line">  <span class="built_in">UnsafeWrapper</span>(<span class="string">&quot;Unsafe_CompareAndSwapInt&quot;</span>);</span><br><span class="line">  oop p = JNIHandles::<span class="built_in">resolve</span>(obj);</span><br><span class="line">  <span class="comment">// æ ¹æ®åç§»é‡ï¼Œè®¡ç®— value çš„åœ°å€ã€‚è¿™é‡Œçš„ offset å°±æ˜¯ AtomaicInteger ä¸­çš„ valueOffset</span></span><br><span class="line">  jint* addr = (jint *) <span class="built_in">index_oop_from_field_offset_long</span>(p, offset);</span><br><span class="line">  <span class="comment">// è°ƒç”¨ Atomic ä¸­çš„å‡½æ•° cmpxchgï¼Œè¯¥å‡½æ•°å£°æ˜äº Atomic.hpp ä¸­</span></span><br><span class="line">  <span class="keyword">return</span> (jint)(Atomic::<span class="built_in">cmpxchg</span>(x, addr, e)) == e;</span><br><span class="line">UNSAFE_END</span><br><span class="line"></span><br><span class="line"><span class="comment">// atomic.cpp</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">Atomic::cmpxchg</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> exchange_value, <span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span>* dest, <span class="keyword">unsigned</span> <span class="keyword">int</span> compare_value)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">assert</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">unsigned</span> <span class="keyword">int</span>) == <span class="built_in"><span class="keyword">sizeof</span></span>(jint), <span class="string">&quot;more work to do&quot;</span>);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * æ ¹æ®æ“ä½œç³»ç»Ÿç±»å‹è°ƒç”¨ä¸åŒå¹³å°ä¸‹çš„é‡è½½å‡½æ•°ï¼Œè¿™ä¸ªåœ¨é¢„ç¼–è¯‘æœŸé—´ç¼–è¯‘å™¨ä¼šå†³å®šè°ƒç”¨å“ªä¸ªå¹³å°ä¸‹çš„é‡è½½</span></span><br><span class="line"><span class="comment">   * æ¥ä¸‹æ¥åˆ†æ atomic_windows_x86.inline.hpp ä¸­çš„ cmpxchg å‡½æ•°å®ç°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span>)Atomic::<span class="built_in">cmpxchg</span>((jint)exchange_value, (<span class="keyword">volatile</span> jint*)dest,</span><br><span class="line">                                       (jint)compare_value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†æ Windows å¹³å°ä¸‹çš„ Atomic::cmpxchg å‡½æ•°ä¸ºä¾‹ï¼Œçœ‹çœ‹å…·ä½“å®ç°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// atomic_windows_x86.inline.hpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCK_IF_MP(mp) __asm cmp mp, 0  \</span></span><br><span class="line"><span class="meta">                       __asm je L0      \</span></span><br><span class="line"><span class="meta">                       __asm _emit 0xF0 \</span></span><br><span class="line"><span class="meta">                       __asm L0:</span></span><br><span class="line">            </span><br><span class="line"><span class="function"><span class="keyword">inline</span> jint <span class="title">Atomic::cmpxchg</span> <span class="params">(jint exchange_value, <span class="keyword">volatile</span> jint* dest, jint compare_value)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å¤šæ ¸ CPU</span></span><br><span class="line">  <span class="keyword">int</span> mp = os::is_MP();</span><br><span class="line">  __asm &#123;</span><br><span class="line">    <span class="comment">// å°†å‚æ•°å€¼æ”¾å…¥å¯„å­˜å™¨ä¸­</span></span><br><span class="line">    mov edx, dest  <span class="comment">// æ³¨æ„: dest æ˜¯æŒ‡é’ˆç±»å‹ï¼Œè¿™é‡Œæ˜¯æŠŠå†…å­˜åœ°å€å­˜å…¥ edx å¯„å­˜å™¨ä¸­</span></span><br><span class="line">    mov ecx, exchange_value</span><br><span class="line">    mov eax, <span class="function">compare_value</span></span><br><span class="line"><span class="function">    <span class="title">LOCK_IF_MP</span><span class="params">(mp)</span>  <span class="comment">// æ ¸å¿ƒæ¯”è¾ƒå†™å…¥æ“ä½œ</span></span></span><br><span class="line"><span class="function">    cmpxchg dword ptr [edx], ecx</span></span><br><span class="line"><span class="function">  &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­LOCK_IF_MPå®é™…å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// LOCK_IF_MP</span></span><br><span class="line">    cmp mp, <span class="number">0</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * å¦‚æœ mp = 0ï¼Œè¡¨æ˜æ˜¯çº¿ç¨‹è¿è¡Œåœ¨å•æ ¸ CPU ç¯å¢ƒä¸‹ã€‚æ­¤æ—¶ je ä¼šè·³è½¬åˆ° L0 æ ‡è®°å¤„ï¼Œ</span></span><br><span class="line"><span class="comment">     * ä¹Ÿå°±æ˜¯è¶Šè¿‡ _emit 0xF0 æŒ‡ä»¤ï¼Œç›´æ¥æ‰§è¡Œ cmpxchg æŒ‡ä»¤ã€‚ä¹Ÿå°±æ˜¯ä¸åœ¨ä¸‹é¢çš„ cmpxchg æŒ‡ä»¤å‰åŠ  lock å‰ç¼€ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    je L0</span><br><span class="line">     <span class="comment">/* 0xF0 æ˜¯ lock å‰ç¼€çš„æœºå™¨ç ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨ lockï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº†æœºå™¨ç çš„å½¢å¼ã€‚*/</span></span><br><span class="line">    _emit <span class="number">0xF0</span></span><br><span class="line">L0:</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * æ¯”è¾ƒå¹¶äº¤æ¢ã€‚ç®€å•è§£é‡Šä¸€ä¸‹ä¸‹é¢è¿™æ¡æŒ‡ä»¤ï¼Œç†Ÿæ‚‰æ±‡ç¼–çš„æœ‹å‹å¯ä»¥ç•¥è¿‡ä¸‹é¢çš„è§£é‡Š:</span></span><br><span class="line"><span class="comment">     *   cmpxchg: å³â€œæ¯”è¾ƒå¹¶äº¤æ¢â€æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">     *   dword: å…¨ç§°æ˜¯ double wordï¼Œåœ¨ x86/x64 ä½“ç³»ä¸­ï¼Œä¸€ä¸ª</span></span><br><span class="line"><span class="comment">     *          word = 2 byteï¼Œdword = 4 byte = 32 bit</span></span><br><span class="line"><span class="comment">     *   ptr: å…¨ç§°æ˜¯ pointerï¼Œä¸å‰é¢çš„ dword è¿èµ·æ¥ä½¿ç”¨ï¼Œè¡¨æ˜è®¿é—®çš„å†…å­˜å•å…ƒæ˜¯ä¸€ä¸ªåŒå­—å•å…ƒ</span></span><br><span class="line"><span class="comment">     *   [edx]: [...] è¡¨ç¤ºä¸€ä¸ªå†…å­˜å•å…ƒï¼Œedx æ˜¯å¯„å­˜å™¨ï¼Œdest æŒ‡é’ˆå€¼å­˜æ”¾åœ¨ edx ä¸­ã€‚</span></span><br><span class="line"><span class="comment">     *          é‚£ä¹ˆ [edx] è¡¨ç¤ºå†…å­˜åœ°å€ä¸º dest çš„å†…å­˜å•å…ƒ</span></span><br><span class="line"><span class="comment">     *        </span></span><br><span class="line"><span class="comment">     * è¿™ä¸€æ¡æŒ‡ä»¤çš„æ„æ€å°±æ˜¯ï¼Œå°† eax å¯„å­˜å™¨ä¸­çš„å€¼ï¼ˆcompare_valueï¼‰ä¸ [edx] åŒå­—å†…å­˜å•å…ƒä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     * è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™å°† ecx å¯„å­˜å™¨ä¸­çš„å€¼ï¼ˆexchange_valueï¼‰å­˜å…¥ [edx] å†…å­˜å•å…ƒä¸­ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    cmpxchg dword ptr [edx], ecx</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å®é™…ä¸¾ä¾‹è¯´æ˜</strong></p><p>AtomicInteger ç±»ä¸»è¦åˆ©ç”¨ <strong>CAS (compare and swap) + volatile</strong> æ¥ä¿è¯åŸå­æ“ä½œã€‚AtomicInteger çš„ä¸»è¦æ–¹æ³•éƒ½æ˜¯é€šè¿‡è°ƒç”¨Unsafeç±»æ–¹æ³•å»å®ç°ï¼Œå¦‚ compareAndSet å®é™…æ˜¯è°ƒç”¨AtomicInteger çš„compareAndSwapIntæ–¹æ³•ã€‚</p><blockquote><p>ä¸‹é¢ä»¥ getAndIncrementå®ç°æ¥è¯´æ˜ã€‚</p></blockquote><ol><li><p>getAndIncrementè°ƒç”¨äº† Unsafeçš„getAndAddIntæ–¹æ³•ï¼Œä¼ é€’äº†ï¼ˆ1ï¼‰å½“å‰thiså¯¹è±¡ï¼Œï¼ˆ2ï¼‰valueåç§»é‡ï¼Œç”¨æ¥è®¡ç®—å¾—åˆ°valueå€¼ï¼ˆ3ï¼‰è¦åŠ ä¸Šçš„å€¼ï¼Œç”±äºæ˜¯é€’å¢æ‰€ä»¥æ˜¯1</p><blockquote><p>âš ï¸ <strong>ä¸ºä»€ä¹ˆä¸ä¼ valueçš„å€¼ï¼Œè€Œæ˜¯åç§»é‡</strong>ï¼Ÿ ä¼ åç§»é‡æ˜¯ä¸ºäº†è®¡ç®—valueæ‰€åœ¨çš„å†…å­˜åœ°å€ï¼Œè¿›è€Œè·å–æœ€æ–°çš„valueå€¼ã€‚</p></blockquote></li><li><p>getAndAddInté‡‡ç”¨CASæ–¹å¼è¿›è¡Œæ›´æ–°ï¼Œè¿˜éœ€è¦è¿›è¡Œå½“å‰æœŸæœ›å€¼çš„è®¡ç®—</p><ul><li>é€šè¿‡<code>getIntVolatile</code>è·å–åˆ°<strong>çº¿ç¨‹æ­¤æ—¶å†…å­˜valueå€¼</strong>ï¼ˆæœŸæœ›å€¼ï¼‰ï¼Œä¹Ÿå°±æ˜¯è®°å½•<strong>æ‰§è¡ŒCASå‰</strong>çš„å†…å­˜æœ€æ–°valueå€¼ï¼›</li></ul></li><li><p>ç„¶åå¼€å§‹æ‰§è¡ŒUnsafeçš„ <code>compareAndSwapInt</code> ï¼Œä¸»è¦æ˜¯é€šè¿‡<code>Atomic::cmpxchg</code> é€»è¾‘æ¥å®ç°</p><p>ï¼ˆ1ï¼‰å°†è¦destï¼ˆvalueå†…å­˜åœ°å€ï¼‰ï¼ŒcompareValueï¼ˆæœŸæœ›å€¼ï¼‰ï¼Œexchange_valueï¼ˆè¦æ›´æ–°çš„å€¼ï¼‰å†™å…¥å¯„å­˜å™¨ä¸­</p><p>ï¼ˆ2ï¼‰çº¿ç¨‹å¦‚æœæ˜¯è¿è¡Œå¤šæ ¸CPUï¼Œä¸Š<strong>LOCK#é”ï¼Œå°†destå†…å­˜åŒºåŸŸé”ä½</strong> ï¼›å¦åˆ™ä¸ä¸ŠLOCK#é”</p><p>ï¼ˆ3ï¼‰æ‰§è¡Œcmpxchgï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢å‘½ä»¤ï¼‰ï¼Œå¦‚æœdestçš„valueå€¼ï¼ˆ<strong>æ‰§è¡ŒCASä¸­</strong>çš„æœ€æ–°valueå€¼ï¼‰ == compareValueï¼Œåˆ™å†™å…¥exchange_value ï¼›</p><p>ï¼ˆ4ï¼‰å¦åˆ™å†™å…¥å¤±è´¥ï¼Œé€šè¿‡ä¸æ–­è‡ªæ—‹ï¼ˆå¾ªç¯ï¼‰æœŸæœ›å¾—åˆ°æ‰§è¡Œ</p></li></ol></li></ul></li></ul><h5 id="1-8-è¯·è¯´æ˜ä¸€ä¸‹synchronizedçš„-u-å¯é‡å…¥-u-æ€ä¹ˆå®ç°ï¼Ÿ">1.8 <strong>è¯·è¯´æ˜ä¸€ä¸‹synchronizedçš„<u>å¯é‡å…¥</u>æ€ä¹ˆå®ç°</strong>ï¼Ÿ</h5><p>æ¯ä¸ªé”å…³è”ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è€…å¯¹è±¡å’Œä¸€ä¸ªè®¡æ•°å™¨ã€‚</p><ol><li>å½“è®¡æ•°å™¨ä¸º0æ—¶è¡¨ç¤ºè¯¥é”æ²¡æœ‰è¢«ä»»ä½•çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆä»»ä½•çº¿ç¨‹éƒ½éƒ½å¯èƒ½è·å¾—è¯¥é”ï¼ˆå³monitorå¯¹è±¡ï¼‰è€Œè°ƒç”¨ç›¸åº”æ–¹æ³•ã€‚</li><li>å½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚æˆåŠŸåï¼ŒJVMå¯¹è±¡å¤´ä¼šè®°ä¸‹æŒæœ‰é”çš„çº¿ç¨‹ï¼Œå¹¶å°†è®¡æ•°å™¨è®¡ä¸º1ã€‚æ­¤æ—¶å…¶ä»–çº¿ç¨‹è¯·æ±‚è¯¥é”ï¼Œåˆ™å¿…é¡»ç­‰å¾…ã€‚</li><li>è€Œè¯¥æŒæœ‰é”çš„çº¿ç¨‹å¦‚æœ<strong>å†æ¬¡è¯·æ±‚è¿™ä¸ªé”ï¼Œå°±å¯ä»¥å†æ¬¡æ‹¿åˆ°è¿™ä¸ªé”ï¼ŒåŒæ—¶è®¡æ•°å™¨ä¼šé€’å¢</strong>ã€‚</li><li>å½“çº¿ç¨‹é€€å‡ºä¸€ä¸ªsynchronizedæ–¹æ³•/å—æ—¶ï¼Œè®¡æ•°å™¨ä¼šé€’å‡ï¼Œå¦‚æœè®¡æ•°å™¨ä¸º0åˆ™é‡Šæ”¾è¯¥é”ã€‚</li></ol><h5 id="1-9-åœ¨synchronizedåå‘é”è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨hashcodeæ–¹æ³•ï¼Œmarkwordä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ">1.9 åœ¨synchronizedåå‘é”è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨hashcodeæ–¹æ³•ï¼Œmarkwordä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h5><p>ç¬¬ä¸€æ¬¡è°ƒç”¨Hashcodeï¼šå½“<u>å¯¹è±¡çš„hashCode()æ–¹æ³•</u>ï¼ˆéç”¨æˆ·è‡ªå®šä¹‰ï¼‰ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼ŒJVMä¼šç”Ÿæˆå¯¹åº”çš„<strong>identity hash code</strong>å€¼ï¼Œå¹¶å°†è¯¥å€¼<u>å­˜å‚¨åˆ°Mark Word</u>ä¸­ ã€‚</p><blockquote><p>åç»­å¦‚æœè¯¥å¯¹è±¡çš„hashCode()æ–¹æ³•å†æ¬¡è¢«è°ƒç”¨åˆ™ä¸ä¼šå†é€šè¿‡JVMè¿›è¡Œè®¡ç®—å¾—åˆ°ï¼Œ<strong>è€Œæ˜¯ç›´æ¥ä»Mark Wordä¸­è·å–ï¼Œä¿è¯å”¯ä¸€ç›¸åŒ</strong>ã€‚</p></blockquote><ul><li><strong>æ— é”çŠ¶æ€</strong>ï¼šåœ¨æ— é”çŠ¶æ€ä¸‹ï¼ŒMark Wordä¸­å¯ä»¥å­˜å‚¨å¯¹è±¡çš„identity hash codeå€¼ ï¼›</li><li><strong>åå‘é”çŠ¶æ€</strong>ï¼šéœ€è¦è®¡ç®—å…¶identity hash codeçš„è¯ï¼Œåˆ™å®ƒçš„åå‘é”ä¼šè¢«æ’¤é”€ï¼ˆå› ä¸ºæ²¡æœ‰ä¿å­˜çš„ä½ç½®ï¼‰ï¼Œå¹¶ä¸”é”ä¼šè†¨èƒ€ä¸ºè½»é‡çº§é”æˆ–è€…é‡é‡é” ï¼›</li><li><strong>è½»é‡é”çŠ¶æ€</strong>ï¼š<u>çº¿ç¨‹æ ˆå¸§</u>çš„Lock Recodeå¯ä»¥è®°å½•å­˜å‚¨Displaced Mark Word ï¼Œæ‰€ä»¥è½»é‡çº§é”å¯ä»¥å’Œidentity hash code <strong>å…±å­˜</strong> ï¼›</li><li><strong>é‡é‡çº§é”çŠ¶æ€</strong>ï¼š<u>ObjectMonitor</u>ç±»é‡Œæœ‰å­—æ®µHashCode<strong>å¯ä»¥è®°å½•</strong>éåŠ é”çŠ¶æ€<strong>ä¸‹çš„mark wordï¼Œæ‰€ä»¥é‡é‡çº§é”ä¹Ÿå¯ä»¥å’Œidentity hash codeå…±å­˜</strong>ï¼›</li></ul><h5 id="1-10-Synchronized-ç¡®å®šä¸å¯ä¸­æ–­å—ï¼Ÿå¦‚æœä¸€ä¸ªçº¿ç¨‹è®¿é—®Synchronized-ä»£ç ï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥èƒ½å¦ä¸­æ–­ï¼Ÿæ¯”å¦‚ä½¿ç”¨Stopï¼Ÿæ˜¯åœ¨ä¸­æ–­å‰è¿˜æ˜¯ä¸­æ–­åè·å–é”ï¼Ÿ">1.10 Synchronized ç¡®å®šä¸å¯ä¸­æ–­å—ï¼Ÿå¦‚æœä¸€ä¸ªçº¿ç¨‹è®¿é—®Synchronized ä»£ç ï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥èƒ½å¦ä¸­æ–­ï¼Ÿæ¯”å¦‚ä½¿ç”¨Stopï¼Ÿæ˜¯åœ¨ä¸­æ–­å‰è¿˜æ˜¯ä¸­æ–­åè·å–é”ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/deel_feel/article/details/105771902">https://blog.csdn.net/deel_feel/article/details/105771902</a></p></blockquote><p>æ­£ç¡®è¯´æ³•æ—¶ï¼š<strong>åªæœ‰è·å–åˆ°é”ä¹‹åæ‰èƒ½ä¸­æ–­ï¼Œç­‰å¾…é”æ—¶ä¸å¯ä¸­æ–­</strong>ã€‚</p><h4 id="1-5-2-Reetrantlock-ç›¸å…³">1.5.2 Reetrantlock ç›¸å…³</h4><p>ReentrantLockæ„æ€ä¸ºå¯é‡å…¥é” ã€‚</p><h5 id="2-1-éå…¬å¹³é”å’Œå…¬å¹³é”åœ¨reetrantlocké‡Œçš„å®ç°è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ">2.1 <strong>éå…¬å¹³é”å’Œå…¬å¹³é”åœ¨reetrantlocké‡Œçš„å®ç°è¿‡ç¨‹æ˜¯æ€æ ·çš„</strong>ï¼Ÿ</h5><blockquote><p><a href="https://tech.meituan.com/2018/11/15/java-lock.html">ç¾å›¢æŠ€æœ¯æ–‡ç« -java-lock</a></p></blockquote><ul><li><p>å…¬å¹³é”ï¼šé‚£ä¹ˆé”çš„ <u>è·å–é¡ºåº</u> å°±åº”è¯¥ç¬¦åˆè¯·æ±‚çš„ <u>ç»å¯¹æ—¶é—´é¡ºåº</u>ï¼ŒFIFO</p></li><li><p>éå…¬å¹³é”ï¼šåªè¦<strong>CAS</strong>è®¾ç½®åŒæ­¥çŠ¶æ€æˆåŠŸstateï¼Œåˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–äº†é”</p><blockquote><p>ä½†å…¬å¹³é”è¿˜éœ€è¦åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¡¨ç¤ºæœ‰çº¿ç¨‹æ¯”å½“å‰çº¿ç¨‹æ›´æ—©è¯·æ±‚è·å–é”ï¼Œå› æ­¤éœ€è¦ç­‰å¾…ã€‚</p></blockquote></li></ul><p>ã€<strong>æºç åˆ†æ</strong>ã€‘</p><ul><li><p><strong>åŸºæœ¬ç»“æ„</strong></p><p>æ ¹æ®ä»£ç å¯çŸ¥ï¼ŒReentrantLocké‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±»<strong>Sync</strong>ï¼ŒSyncç»§æ‰¿AQSï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨Syncä¸­å®ç°çš„ã€‚</p><ul><li>Syncæœ‰å…¬å¹³é”FairSyncå’Œéå…¬å¹³é”NonfairSyncä¸¤ä¸ªå­ç±»ï¼›</li><li>ReentrantLocké»˜è®¤ä½¿ç”¨éå…¬å¹³é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨æ¥æ˜¾ç¤ºçš„æŒ‡å®šä½¿ç”¨å…¬å¹³é”ã€‚</li></ul><p><img src="https://i.loli.net/2021/05/21/YDAreyBEImxQfj2.png" alt="img"></p></li><li><p><strong>å…¬å¹³å’Œéå…¬å¹³é”åŒºåˆ†</strong></p><p><img src="https://i.loli.net/2021/05/21/zsPnT7qrXN5ovKZ.png" alt="img"></p><p>å…¬å¹³é”ä¸éå…¬å¹³é”çš„lock()æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå…¬å¹³é”åœ¨<strong>CASè·å–åŒæ­¥çŠ¶æ€æ—¶</strong>ï¼Œå¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼š<strong>hasQueuedPredecessors()</strong>ã€‚</p><p><img src="https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/bd0036bb.png" alt="img"></p><ul><li><strong>è¯¥æ–¹æ³•ä¸»è¦åšä¸€ä»¶äº‹æƒ…</strong>ï¼šä¸»è¦æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä½äºåŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªã€‚å¦‚æœæ˜¯åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li></ul></li></ul><h5 id="2-2-ReentrantLockçš„å®ç°åŸç†ï¼Ÿ">2.2 ReentrantLockçš„å®ç°åŸç†ï¼Ÿ</h5><p>ReentrantLockçš„å®ç°åŸºäºé˜Ÿåˆ—åŒæ­¥ï¼ˆAbstractQueuedSynchronizerï¼Œåé¢ç®€ç§°AQSï¼‰ã€‚å…³äºAQSçš„å®ç°åŸç†è§ä¸‹ã€‚</p><p>ReentrantLockçš„æ ¸å¿ƒï¼Œæ˜¯é€šè¿‡ä¿®æ”¹AQSä¸­stateçš„å€¼æ¥åŒæ­¥é”çš„çŠ¶æ€ã€‚</p><h5 id="2-3-å¸Œæœ›ç­‰å¾…ä¸€æ®µæ—¶é—´é”æ²¡æœ‰è·å–ï¼Œå¯ä»¥è‡ªåŠ¨æ”¾å¼ƒç”¨å“ªç§é”ï¼Ÿ">2.3 å¸Œæœ›ç­‰å¾…ä¸€æ®µæ—¶é—´é”æ²¡æœ‰è·å–ï¼Œå¯ä»¥è‡ªåŠ¨æ”¾å¼ƒç”¨å“ªç§é”ï¼Ÿ</h5><p>Lockï¼ˆReentranLockï¼‰</p><p>ä½†æ˜¯åŸºäºAQSçš„æºç å“ªé‡Œä½“ç°äº†ï¼Ÿ åº”è¯¥Locké”çš„ä»£ç é‡Œè‡ªå·±çš„å®ç°å§ã€‚</p><h4 id="1-5-3-AQS-ç›¸å…³">1.5.3 AQS ç›¸å…³</h4><h5 id="3-1-ä»€ä¹ˆæ˜¯AQSè¯·ä½ ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Ÿ">3.1 ä»€ä¹ˆæ˜¯AQSè¯·ä½ ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Ÿ</h5><p>AQSçš„å…¨ç§°ä¸ºï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œè¿™ä¸ªç±»åœ¨java.util.concurrent.locksåŒ…ä¸‹é¢ã€‚</p><p><img src="https://i.loli.net/2021/05/16/QhJg8pnTv3zWj4w.png" alt="image-20210516144436982"></p><p><strong>AQSæ˜¯â¼€ä¸ªç”¨æ¥æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶</strong>ï¼Œä½¿â½¤AQSèƒ½ç®€å•ä¸”é«˜æ•ˆåœ°æ„é€ å‡ºåº”ç”¨â¼´æ³›çš„å¤§é‡çš„åŒæ­¥å™¨ã€‚</p><ul><li>ä¾‹å¦‚ï¼šReentrantLockï¼ŒSemaphoreï¼ŒReentrantReadWriteLockï¼ŒSynchronousQueueç­‰ç­‰çš†æ˜¯åŸºäºAQSçš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬â¾ƒâ¼°ä¹Ÿèƒ½åˆ©â½¤AQSéå¸¸è½»æ¾å®¹æ˜“åœ°æ„é€ å‡ºç¬¦åˆæˆ‘ä»¬â¾ƒâ¼°éœ€æ±‚çš„åŒæ­¥å™¨ã€‚</li></ul><h5 id="3-2-è¯·ä»‹ç»ä¸€ä¸‹AQSåŸç†ï¼Ÿ">3.2 è¯·ä»‹ç»ä¸€ä¸‹AQSåŸç†ï¼Ÿ</h5><blockquote><p>åç»­å»ºè®®ç ”è¯»ï¼š<a href="https://tech.meituan.com/2019/12/05/aqs-theory-and-apply.html">ä»ReentrantLockçš„å®ç°çœ‹AQSçš„åŸç†åŠåº”ç”¨</a></p></blockquote><p>å…ˆå¸¦ç€é—®é¢˜æ¥è¿›è¡Œçœ‹ä¸‹é¢å†…å®¹ï¼š</p><blockquote><p>Qï¼šæŸä¸ªçº¿ç¨‹è·å–é”å¤±è´¥çš„åç»­æµç¨‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>Aï¼šå­˜åœ¨æŸç§æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œçº¿ç¨‹ç»§ç»­ç­‰å¾…ï¼Œä»ç„¶ä¿ç•™è·å–é”çš„å¯èƒ½ï¼Œè·å–é”æµç¨‹ä»åœ¨ç»§ç»­ã€‚</p><p>Qï¼šæ—¢ç„¶è¯´åˆ°äº†æ’é˜Ÿç­‰å€™æœºåˆ¶ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šæœ‰æŸç§é˜Ÿåˆ—å½¢æˆï¼Œè¿™æ ·çš„é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„å‘¢ï¼Ÿ</p><p>Aï¼šæ˜¯CLHå˜ä½“çš„FIFOåŒç«¯é˜Ÿåˆ—ã€‚</p><p>Qï¼šå¤„äºæ’é˜Ÿç­‰å€™æœºåˆ¶ä¸­çš„çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥æœ‰æœºä¼šè·å–é”å‘¢ï¼Ÿ</p><p>Aï¼šå¯ä»¥è¯¦ç»†çœ‹ä¸‹2.3.1.3å°èŠ‚ã€‚</p><p>Qï¼šå¦‚æœå¤„äºæ’é˜Ÿç­‰å€™æœºåˆ¶ä¸­çš„çº¿ç¨‹ä¸€ç›´æ— æ³•è·å–é”ï¼Œéœ€è¦ä¸€ç›´ç­‰å¾…ä¹ˆï¼Ÿè¿˜æ˜¯æœ‰åˆ«çš„ç­–ç•¥æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Ÿ</p><p>Aï¼šçº¿ç¨‹æ‰€åœ¨èŠ‚ç‚¹çš„çŠ¶æ€ä¼šå˜æˆå–æ¶ˆçŠ¶æ€ï¼Œå–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹ä¼šä»é˜Ÿåˆ—ä¸­é‡Šæ”¾ï¼Œå…·ä½“å¯è§2.3.2å°èŠ‚ã€‚</p><p>Qï¼šLockå‡½æ•°é€šè¿‡Acquireæ–¹æ³•è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯å…·ä½“æ˜¯å¦‚ä½•åŠ é”çš„å‘¢ï¼Ÿ</p><p>Aï¼šAQSçš„Acquireä¼šè°ƒç”¨tryAcquireæ–¹æ³•ï¼ŒtryAcquireç”±å„ä¸ªè‡ªå®šä¹‰åŒæ­¥å™¨å®ç°ï¼Œé€šè¿‡tryAcquireå®ŒæˆåŠ é”è¿‡ç¨‹ã€‚</p></blockquote><ul><li><p><strong>æ ¸å¿ƒåŸç†æ¦‚è§ˆ</strong></p><p>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„â¼¯ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚</p><p>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦â¼€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œ<u>è¿™ä¸ªæœºåˆ¶AQSæ˜¯â½¤CLHé˜Ÿåˆ—é”å®ç°çš„</u>ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ â¼Šåˆ°é˜Ÿåˆ—ä¸­ã€‚</p><blockquote><p>CLH(Craig,Landin,and Hagersten)é˜Ÿåˆ—æ˜¯â¼€ä¸ª<strong>è™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—</strong>ï¼ˆè™šæ‹Ÿçš„åŒå‘é˜Ÿåˆ—å³ä¸å­˜åœ¨é˜Ÿåˆ—å®ä¾‹ï¼Œä»…å­˜åœ¨ç»“ç‚¹ä¹‹é—´çš„å…³è”å…³ç³»ï¼‰ã€‚AQSæ˜¯å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆâ¼€ä¸ªCLHé”é˜Ÿåˆ—çš„â¼€ä¸ªç»“ç‚¹ï¼ˆNodeï¼‰æ¥å®ç°é”çš„åˆ†é…ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/16/XqshLCnMYKbB7Ip.png" alt="image-20210516145134124"></p><p>AQSä½¿ç”¨â¼€ä¸ªintæˆå‘˜å˜é‡<code>state</code>æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆè·å–èµ„æºçº¿ç¨‹çš„æ’é˜Ÿâ¼¯ä½œã€‚<strong>AQSä½¿â½¤CASå¯¹è¯¥åŒæ­¥çŠ¶æ€è¿›è¡ŒåŸå­æ“ä½œå®ç°å¯¹å…¶å€¼çš„ä¿®æ”¹</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state; <span class="comment">//å…±äº«å˜é‡ï¼Œä½¿â½¤volatileä¿®é¥°ä¿è¯çº¿ç¨‹å¯è§æ€§</span></span><br></pre></td></tr></table></figure><p>çŠ¶æ€ä¿¡æ¯é€šè¿‡protectedç±»å‹çš„getStateï¼ŒsetStateï¼ŒcompareAndSetStateè¿›è¡Œæ“ä½œ ã€‚</p><img src="https://i.loli.net/2021/05/28/g7GORpXKhuo8aS4.png" alt="image-20210526122910138" style="zoom:67%;" /></li><li><p><strong>AQS å¯¹èµ„æºçš„å…±äº«æ–¹å¼</strong><br>AQSå®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹stateå­—æ®µæ¥å®ç°å¤šçº¿ç¨‹çš„ç‹¬å ï¼ˆç»å…¸å¦‚ReentranLockï¼‰å’Œå…±äº«æ¨¡å¼ã€‚</p><p><img src="https://i.loli.net/2021/05/26/YdcSGMs5jgiFnmk.png" alt="img"></p><ul><li><strong>Exclusiveï¼ˆç‹¬å ï¼‰</strong>ï¼šåªæœ‰â¼€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ReentrantLockã€‚â¼œå¯åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ï¼š<ul><li>å…¬å¹³é”ï¼šæŒ‰ç…§çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­çš„æ’é˜Ÿé¡ºåºï¼Œå…ˆåˆ°è€…å…ˆæ‹¿åˆ°é”</li><li>éå…¬å¹³é”ï¼šå½“çº¿ç¨‹è¦è·å–é”æ—¶ï¼Œæ— è§†é˜Ÿåˆ—é¡ºåºç›´æ¥å»æŠ¢é”ï¼Œè°æŠ¢åˆ°å°±æ˜¯è°çš„</li></ul></li><li><strong>Shareï¼ˆå…±äº«ï¼‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚Semaphore/CountDownLatchã€‚Semaphoreã€CountDownLatchã€ CyclicBarrierã€ReadWriteLock æˆ‘ä»¬éƒ½ä¼šåœ¨åé¢è®²åˆ°ã€‚</li></ul></li><li><p><strong>AQSè¯¦ç»†åŸç†</strong></p><blockquote><p>æœ€ç»ˆå‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/90851418">ä»æºç è§’åº¦å½»åº•ç†è§£ReentrantLock(é‡å…¥é”)</a></p></blockquote><blockquote><p>ä»¥ä¸‹æ˜¯åŸºäºReentractLockè¯­å¢ƒä¸‹è¿›è¡Œåˆ†æã€‚</p></blockquote><ul><li><p><strong>åŠ é”è¿‡ç¨‹ï¼šéå…¬å¹³é”</strong></p><blockquote><p>ç®€å•æ¥è¯´ï¼š<strong>æ–°å»ºçº¿ç¨‹â†’CASå°è¯•å¿«é€Ÿè·å–é”â†’tryAcquire()CASä¿®æ”¹stateâ†’addWaiter() è·å–å¤±è´¥CASå°è¯•æ’å…¥é˜Ÿå°¾å…¥é˜Ÿâ†’acquireQueuedç­‰å¾…å‰é©±çº¿ç¨‹å”¤é†’ç»§ç»­CASè·å–é”</strong></p></blockquote><p><img src="https://pic3.zhimg.com/80/v2-28c16752466cd95dfe0504f0306d6352_720w.jpg" alt="img"></p><p>åŠ é”æµç¨‹ä»<code>lock.lock()</code>å¼€å§‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    sync.lock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥è¯¥æºç ,æ­£ç¡®æ‰¾åˆ°sycnçš„å®ç°ç±»åå¯ä»¥çœ‹åˆ°çœŸæ­£æœ‰å†…å®¹çš„å…¥å£æ–¹æ³•ï¼š</p></li></ul><ol><li><strong>CASå°è¯•å¿«é€ŸåŠ é”</strong>ï¼Œåœ¨ReentranLockåªæœ‰state=0ï¼Œæ‰èƒ½æ›´æ–°æˆåŠŸï¼ˆå› ä¸ºæ˜¯éå¤šçº¿ç¨‹å…±äº«èµ„æºï¼‰</li><li>è·å–é”å¤±è´¥æ‰§è¡Œacquireæ–¹æ³•</li></ol>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// åŠ é”æµç¨‹çœŸæ­£æ„ä¹‰ä¸Šçš„å…¥å£</span></span><br><span class="line">  <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//ä»¥casæ–¹å¼å°è¯•å°†AQSä¸­çš„stateä»0æ›´æ–°ä¸º1</span></span><br><span class="line">      <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">          setExclusiveOwnerThread(Thread.currentThread());<span class="comment">//è·å–é”æˆåŠŸåˆ™å°†å½“å‰çº¿ç¨‹æ ‡è®°ä¸ºæŒæœ‰é”çš„çº¿ç¨‹,ç„¶åç›´æ¥è¿”å›</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          acquire(<span class="number">1</span>);<span class="comment">//è·å–é”å¤±è´¥åˆ™æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>acquire</code> åœ¨ä¸»è¦çš„é€»è¾‘éƒ½åœ¨ifåˆ¤æ–­æ¡ä»¶ä¸­,è¿™é‡Œé¢æœ‰3ä¸ªé‡è¦çš„æ–¹æ³•tryAcquire()ï¼ŒaddWaiter() å’Œ acquireQueued() ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">          acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">          selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p><strong>acquireæµç¨‹1ï¼štryAcquire()</strong></p><p>tryAcquire()åœ¨å…¬å¹³å’Œéå…¬å¹³ä¸‹è·å–çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œè¿™é‡Œ<strong>åªè¯´éå…¬å¹³</strong>å®ç°ã€‚</p><ol><li><p>å¦‚æœ<strong>state==0ï¼ˆæœªè¢«å…¶å®ƒçº¿ç¨‹æŒæœ‰ï¼‰</strong>ï¼Œ<strong>CAS</strong>å°è¯•è·å–é”,</p></li><li><p>å¦‚æœå½“å‰çº¿ç¨‹==æŒæœ‰é”çš„çº¿ç¨‹ï¼Œ<strong>å¯é‡å…¥</strong> ï¼Œ<strong>state+1</strong></p><ol start="3"><li><p>å¦åˆ™ reture falseè·å–é”å¤±è´¥ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">final</span> Thread current = Thread.currentThread();<span class="comment">//è·å–å½“å‰çº¿ç¨‹å®ä¾‹</span></span><br><span class="line">     <span class="keyword">int</span> c = getState();<span class="comment">//è·å–stateå˜é‡çš„å€¼,å³å½“å‰é”è¢«é‡å…¥çš„æ¬¡æ•°</span></span><br><span class="line">     <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;   <span class="comment">//stateä¸º0,è¯´æ˜å½“å‰é”æœªè¢«ä»»ä½•çº¿ç¨‹æŒæœ‰</span></span><br><span class="line">         <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) &#123; <span class="comment">//ä»¥casæ–¹å¼è·å–é”</span></span><br><span class="line">             setExclusiveOwnerThread(current);  <span class="comment">//å°†å½“å‰çº¿ç¨‹æ ‡è®°ä¸ºæŒæœ‰é”çš„çº¿ç¨‹</span></span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//è·å–é”æˆåŠŸ,éé‡å…¥</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123; <span class="comment">//å½“å‰çº¿ç¨‹å°±æ˜¯æŒæœ‰é”çš„çº¿ç¨‹,è¯´æ˜è¯¥é”è¢«é‡å…¥äº†</span></span><br><span class="line">         <span class="keyword">int</span> nextc = c + acquires;<span class="comment">//è®¡ç®—stateå˜é‡è¦æ›´æ–°çš„å€¼</span></span><br><span class="line">         <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">         setState(nextc);<span class="comment">//éåŒæ­¥æ–¹å¼æ›´æ–°stateå€¼</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;  <span class="comment">//è·å–é”æˆåŠŸ,é‡å…¥</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">false</span>;     <span class="comment">//èµ°åˆ°è¿™é‡Œè¯´æ˜å°è¯•è·å–é”å¤±è´¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ol></li><li><p><strong>acquireæµç¨‹2ï¼šaddWaiter()</strong></p><p>ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>é¦–å…ˆé€šè¿‡new Node()åˆ›å»ºä¸€ä¸ªç©ºç»“ç‚¹ï¼›</li><li>å¦‚æœé˜Ÿåˆ—ä¸ç©º**ï¼Œä»¥<strong>CAS</strong>æ–¹å¼è®©æ–°èŠ‚ç‚¹æ’å…¥åˆ°é˜Ÿå°¾;</li><li>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰§è¡Œ<code>enq(node)</code> é€»è¾‘</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>&#123;</span><br><span class="line">       Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);<span class="comment">//é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹,å¹¶å°†å½“å‰çº¿ç¨‹å®ä¾‹å°è£…åœ¨å†…éƒ¨,modeè¿™é‡Œä¸ºnull</span></span><br><span class="line">       <span class="comment">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class="line">       Node pred = tail;</span><br><span class="line">       <span class="keyword">if</span> (pred != <span class="keyword">null</span>) &#123;</span><br><span class="line">           node.prev = pred;</span><br><span class="line">           <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">               pred.next = node;</span><br><span class="line">               <span class="keyword">return</span> node;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       enq(node);<span class="comment">//å…¥é˜Ÿçš„é€»è¾‘è¿™é‡Œéƒ½æœ‰</span></span><br><span class="line">       <span class="keyword">return</span> node;</span><br><span class="line">   &#125;</span><br><span class="line">      <span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">               Node t = tail;<span class="comment">//tæŒ‡å‘å½“å‰é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹,é˜Ÿåˆ—ä¸ºç©ºåˆ™ä¸ºnull</span></span><br><span class="line">               <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123; <span class="comment">// Must initialize  //é˜Ÿåˆ—ä¸ºç©º</span></span><br><span class="line">                   <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node())) <span class="comment">//æ„é€ æ–°ç»“ç‚¹,CASæ–¹å¼è®¾ç½®ä¸ºé˜Ÿåˆ—é¦–å…ƒç´ ,å½“head==nullæ—¶æ›´æ–°æˆåŠŸ</span></span><br><span class="line">                       tail = head;<span class="comment">//å°¾æŒ‡é’ˆæŒ‡å‘é¦–ç»“ç‚¹</span></span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;  <span class="comment">//é˜Ÿåˆ—ä¸ä¸ºç©º</span></span><br><span class="line">                   node.prev = t;</span><br><span class="line">                   <span class="keyword">if</span> (compareAndSetTail(t, node)) &#123; <span class="comment">//CASå°†å°¾æŒ‡é’ˆæŒ‡å‘å½“å‰ç»“ç‚¹,å½“t(åŸæ¥çš„å°¾æŒ‡é’ˆ)==tail(å½“å‰çœŸå®çš„å°¾æŒ‡é’ˆ)æ—¶æ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">                       t.next = node;    <span class="comment">//åŸå°¾ç»“ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘å½“å‰ç»“ç‚¹</span></span><br><span class="line">                       <span class="keyword">return</span> t;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>acquireæµç¨‹3ï¼šacquireQueued()</strong></p><blockquote><p><strong>çº¿ç¨‹åŠ å…¥åŒæ­¥é˜Ÿåˆ—åï¼Œè·å–é”çš„æµç¨‹æ˜¯ä»€ä¹ˆå‘¢</strong>ï¼Ÿ</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸æ–­åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯è€äºŒï¼Œå¹¶å°è¯•å»è·å–é”ã€‚</p></blockquote><img src="https://pic4.zhimg.com/v2-f83b087a039a8de3f9815d9018e2273f_b.jpg" alt="img" style="zoom:80%;" /><ul><li><code>SIGNAL ï¼š</code>æ„å‘³ç€çº¿ç¨‹é‡Šæ”¾é”åä¼šå”¤é†’åé¢é˜»å¡çš„çº¿ç¨‹ã€‚æ¯•ç«Ÿï¼Œåªæœ‰ç¡®ä¿èƒ½å¤Ÿè¢«å”¤é†’ï¼Œå½“å‰çº¿ç¨‹æ‰èƒ½æ”¾å¿ƒçš„é˜»å¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">          <span class="comment">//æ­»å¾ªç¯,æ­£å¸¸æƒ…å†µä¸‹çº¿ç¨‹åªæœ‰è·å¾—é”æ‰èƒ½è·³å‡ºå¾ªç¯</span></span><br><span class="line">          <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">              <span class="keyword">final</span> Node p = node.predecessor();<span class="comment">//è·å¾—å½“å‰çº¿ç¨‹æ‰€åœ¨ç»“ç‚¹çš„å‰é©±ç»“ç‚¹</span></span><br><span class="line">              <span class="comment">//ç¬¬ä¸€ä¸ªifåˆ†å¥</span></span><br><span class="line">              <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123; </span><br><span class="line">                  setHead(node); <span class="comment">//å°†å½“å‰ç»“ç‚¹è®¾ç½®ä¸ºé˜Ÿåˆ—å¤´ç»“ç‚¹</span></span><br><span class="line">                  p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                  failed = <span class="keyword">false</span>;</span><br><span class="line">                  <span class="keyword">return</span> interrupted;<span class="comment">//æ­£å¸¸æƒ…å†µä¸‹æ­»å¾ªç¯å”¯ä¸€çš„å‡ºå£</span></span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">//ç¬¬äºŒä¸ªifåˆ†å¥</span></span><br><span class="line">              <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;  <span class="comment">//åˆ¤æ–­æ˜¯å¦è¦é˜»å¡å½“å‰çº¿ç¨‹</span></span><br><span class="line">                  parkAndCheckInterrupt())      <span class="comment">//é˜»å¡å½“å‰çº¿ç¨‹</span></span><br><span class="line">                  interrupted = <span class="keyword">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (failed)</span><br><span class="line">              cancelAcquire(node);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><p><strong>è§£é”ï¼šéå…¬å¹³é”</strong></p><img src="https://i.loli.net/2021/05/26/sSQZlA2paTcNKXi.png" alt="image-20210526170709280" style="zoom:67%;" /></li><li><p><strong>åŠ é”ï¼šå…¬å¹³é”</strong></p><blockquote><p>ç®€å•æ¥è¯´ï¼š<strong>æ–°æ¥çº¿ç¨‹â†’ã€å¿…é¡»ã€‘å…ˆCASåŠ å…¥ç­‰å¾…é˜Ÿåˆ—â†’ç­‰å¾…å‰é©±èŠ‚ç‚¹é‡Šæ”¾é”ï¼ˆstate=0ï¼‰ï¼Œå¦‚æœæ˜¯è€äºŒåˆ™è·å–é”</strong>ã€‚</p></blockquote><p>å…¬å¹³é”åŠ é”å…¥å£åŠ é”ä»ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">finally void lock() &#123;</span><br><span class="line">    acqiuire();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¹‹å‰éå…¬å¹³é”çš„é€»è¾‘ä¸­ï¼Œçº¿ç¨‹æœ‰ä¸‰æ¬¡æœºä¼šè·å–é”ï¼š</p><ol><li><strong>æ–°åˆ›å»ºæ—¶</strong>ï¼ŒCASå°è¯•ä¿®æ”¹state=1ï¼Œå»è·å–</li><li><strong>å¯é‡å…¥</strong>ï¼Œå½“å‰è·å–é”çº¿ç¨‹ä¸ºè‡ªå·±</li><li><strong>å‰é©±èŠ‚ç‚¹é‡Šæ”¾é”</strong>ï¼Œè‡ªå·±ä½œä¸ºè€äºŒè¢«å”¤é†’</li></ol><p>è€Œ<strong>å…¬å¹³é”</strong>ï¼Œåªèƒ½æŒ‰åŠ å…¥é˜Ÿåˆ—çš„<u>å…ˆåæ¬¡åº &amp; å¯é‡å…¥</u>è·å¾—é” ï¼š</p><ol><li><p>æ‰€æœ‰çº¿ç¨‹åœ¨è·å–é”å‰<strong>å¿…é¡»å…ˆåŠ å…¥åŒæ­¥é˜Ÿåˆ—</strong></p></li><li><p>å¦‚æœstate=0ï¼Œ<code>hasQueuedPredecessors</code>åˆ¤æ–­å½“å‰æ˜¯å¤´èŠ‚ç‚¹ï¼Œåˆ™è·å–é”</p></li></ol><p><img src="https://i.loli.net/2021/05/26/wZSLYOP4bTGEqRJ.jpg" alt="img"></p></li></ul></li></ul><h5 id="3-3-ä¸ºä»€ä¹ˆåŸºäºFIFOçš„åŒæ­¥é˜Ÿåˆ—å¯ä»¥å®ç°éå…¬å¹³é”ï¼Ÿ">3.3 ä¸ºä»€ä¹ˆåŸºäºFIFOçš„åŒæ­¥é˜Ÿåˆ—å¯ä»¥å®ç°éå…¬å¹³é”ï¼Ÿ</h5><p>å› ä¸ºéå…¬å¹³é”ï¼Œé™¤äº†ç­‰<strong>å‰é©±èŠ‚ç‚¹å”¤é†’å»è·å–é”</strong> ï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼è·å–é”ï¼š</p><ol><li><p><strong>æ–°åˆ›å»ºæ—¶</strong>ï¼ŒCASå°è¯•ä¿®æ”¹state=1ï¼Œå»è·å–</p><blockquote><p>å…¬å¹³é”ï¼šè¿›æ¥å…ˆæ‰§è¡Œ<code>hasQueuedPredecessors()</code> , çœ‹ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦æœ‰æœ‰æ•ˆèŠ‚ç‚¹ï¼Œæœ‰çš„è¯ä¸èƒ½è·å–é”ï¼</p></blockquote></li><li><p><strong>å¯é‡å…¥</strong>ï¼Œå½“å‰è·å–é”çº¿ç¨‹ä¸ºè‡ªå·±</p><blockquote><p>å…¬å¹³é”ï¼šä¹Ÿå¯ä»¥</p></blockquote></li><li><p><strong>åŒæ­¥é˜Ÿåˆ—ç­‰å¾…</strong>ï¼Œç­‰å¾…å”¤é†’è·å–é”</p><blockquote><p>å…¬å¹³é”ï¼šä¹Ÿå¯ä»¥</p></blockquote></li></ol><p>å¹¶ä¸”åœ¨é”é‡Šæ”¾æ—¶ï¼šæ˜¯<strong>å…ˆé‡Šæ”¾é”ï¼ˆä¿®æ”¹state=-1ï¼‰ï¼Œå†å»å”¤é†’åç»§èŠ‚ç‚¹</strong></p><ol><li>ä¼šå¯¼è‡´æ–°æ¥çš„çº¿ç¨‹ï¼Œå¯èƒ½åœ¨<strong>åç»§èŠ‚ç‚¹è¢«å”¤é†’å‰</strong>å°±è·å–äº†é”ï¼Œè¿™å°±ä¸ä¼šå…¬å¹³</li></ol><h5 id="3-4-ã€æ˜“å¿˜ã€‘ä¸ºä»€ä¹ˆéå…¬å¹³é”æ€§èƒ½å¥½ï¼Ÿ">3.4 ã€æ˜“å¿˜ã€‘ä¸ºä»€ä¹ˆéå…¬å¹³é”æ€§èƒ½å¥½ï¼Ÿ</h5><ol><li>.çº¿ç¨‹ä¸å¿…åŠ å…¥ç­‰å¾…é˜Ÿåˆ—å°±å¯ä»¥è·å¾—é”,ä¸ä»…<strong>å…å»äº†æ„é€ ç»“ç‚¹å¹¶åŠ å…¥é˜Ÿåˆ—çš„ç¹çæ“ä½œ</strong> ï¼Œ<strong>èŠ‚çœäº†çº¿ç¨‹é˜»å¡ã€å”¤é†’</strong>çš„å¼€é”€ï¼ˆè¿™æ¶‰åŠåˆ°ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼‰ï¼›</li><li><strong>å‡å°‘CASç«äº‰</strong>ã€‚å¦‚æœ<strong>çº¿ç¨‹å¿…é¡»è¦åŠ å…¥é˜»å¡é˜Ÿåˆ—æ‰èƒ½è·å–é”</strong>,é‚£<strong>0</strong>å°†å˜å¾—å¼‚å¸¸æ¿€çƒˆ,CASæ“ä½œè™½ç„¶ä¸ä¼šå¯¼è‡´å¤±è´¥çº¿ç¨‹æŒ‚èµ·,ä½†ä¸æ–­å¤±è´¥é‡è¯•å¯¼è‡´çš„å¯¹CPUçš„æµªè´¹ä¹Ÿä¸èƒ½å¿½è§†</li></ol><h5 id="3-4-AQS-æœ‰å“ªäº›ç»„ä»¶ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Ÿä»‹ç»ä¸€ä¸‹CountDownLatchçš„åº”ç”¨åœºæ™¯-ï¼Ÿ">3.4 AQS æœ‰å“ªäº›ç»„ä»¶ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Ÿä»‹ç»ä¸€ä¸‹CountDownLatchçš„åº”ç”¨åœºæ™¯ ï¼Ÿ</h5><p><img src="https://i.loli.net/2021/05/26/OWhD4Hu3GkBP2vc.png" alt="image-20210526215800096"></p><ul><li><p><strong>Semaphore(ä¿¡å·é‡)ï¼š<strong>Semaphore(ä¿¡å·é‡)å¯ä»¥æŒ‡å®š</strong>å¤šä¸ª</strong>çº¿ç¨‹<strong>åŒæ—¶</strong>è®¿é—®æŸä¸ªèµ„æºï¼› <strong>synchronized å’Œ ReentrantLock</strong> éƒ½æ˜¯â¼€æ¬¡åªå…è®¸<strong>â¼€ä¸ª</strong>çº¿ç¨‹è®¿é—®<strong>åŒæ—¶</strong>æŸä¸ªèµ„æºã€‚</p><blockquote><p>è®¡æ•°ä¿¡å·é‡å…·å¤‡ä¸¤ç§æ“ä½œåŠ¨ä½œï¼Œç§°ä¸ºVï¼ˆsignal()ï¼‰ä¸Pï¼ˆwait()ï¼‰ï¼ˆå³éƒ¨åˆ†å‚è€ƒä¹¦å¸¸ç§°çš„â€œPVæ“ä½œâ€ï¼‰ã€‚Væ“ä½œä¼šå¢åŠ ä¿¡å·æ ‡Sçš„æ•°å€¼ï¼ŒPæ“ä½œä¼šå‡å°‘å®ƒã€‚</p><p>è¿è¡ŒPï¼ˆwait()ï¼‰ï¼Œä¿¡å·æ ‡Sçš„å€¼å°†è¢«å‡å°‘ã€‚ä¼å›¾è¿›å…¥ä¸´ç•ŒåŒºæ®µçš„è¿›ç¨‹ï¼Œéœ€è¦å…ˆè¿è¡ŒPï¼ˆwait()ï¼‰ã€‚å½“ä¿¡å·æ ‡<strong>Så‡ä¸ºè´Ÿå€¼</strong>æ—¶ï¼Œè¿›ç¨‹ä¼šè¢«æŒ¡ä½ï¼Œä¸èƒ½ç»§ç»­ï¼›å½“<strong>ä¿¡å·æ ‡Sä¸ä¸ºè´Ÿå€¼</strong>æ—¶ï¼Œè¿›ç¨‹å¯ä»¥è·å‡†è¿›å…¥ä¸´ç•ŒåŒºæ®µã€‚</p></blockquote></li><li><p><strong>CountDownLatch ï¼ˆå€’è®¡æ—¶å™¨ï¼‰</strong>ï¼š CountDownLatchæ˜¯â¼€ä¸ªåŒæ­¥â¼¯å…·ç±»ï¼Œç”¨æ¥åè°ƒå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€‚è¿™ä¸ªâ¼¯å…·é€šå¸¸ç”¨æ¥æ§åˆ¶çº¿ç¨‹ç­‰å¾…ï¼Œ<u>å®ƒå¯ä»¥è®©<strong>æŸâ¼€ä¸ªçº¿ç¨‹ç­‰å¾…ç›´åˆ°å€’è®¡æ—¶ç»“æŸ</strong></u>ï¼Œå†å¼€å§‹æ‰§è¡Œã€‚</p></li><li><p><strong>CyclicBarrier(å¾ªç¯æ …æ )</strong>ï¼š CyclicBarrier å’Œ CountDownLatch éå¸¸ç±»ä¼¼ï¼Œå®ƒä¹Ÿå¯ä»¥å®ç°çº¿ç¨‹é—´çš„æŠ€æœ¯ç­‰å¾…ï¼Œä½†æ˜¯å®ƒçš„åŠŸèƒ½â½ CountDownLatch æ›´åŠ å¤æ‚å’Œå¼ºå¤§ã€‚ä¸»è¦åº”ç”¨åœºæ™¯å’ŒCountDownLatch ç±»ä¼¼ã€‚CyclicBarrier çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨ï¼ˆCyclicï¼‰çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©â¼€ç»„çº¿ç¨‹åˆ°è¾¾â¼€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åâ¼€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€â»”ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­â¼²æ´»ã€‚</p><blockquote><p>CyclicBarrieré»˜è®¤çš„æ„é€ æ–¹æ³•æ˜¯ CyclicBarrier(int parties)ï¼Œå…¶å‚æ•°è¡¨ç¤ºå±éšœæ‹¦æˆªçš„çº¿ç¨‹æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒâ½¤**await()**æ–¹æ³•å‘Šè¯‰ CyclicBarrier æˆ‘å·²ç»åˆ°è¾¾äº†å±éšœï¼Œç„¶åå½“å‰çº¿ç¨‹è¢«é˜»å¡ã€‚</p></blockquote></li></ul><p><strong>CountDownLatchçš„åº”ç”¨åœºæ™¯</strong></p><p>æˆ‘ä»¬è¦è¯»å–å¤„ç†<strong>6</strong>ä¸ªâ½‚ä»¶ï¼Œè¿™6ä¸ªä»»åŠ¡éƒ½æ˜¯æ²¡æœ‰æ‰§è¡Œé¡ºåºä¾èµ–çš„ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦è¿”å›ç»™ç”¨æˆ·çš„æ—¶å€™å°†è¿™6ä¸ªâ½‚ä»¶çš„å¤„ç†çš„ç»“æœè¿›è¡Œç»Ÿè®¡æ•´ç†ã€‚</p><p>ä¸ºæ­¤æˆ‘ä»¬å®šä¹‰äº†â¼€ä¸ªçº¿ç¨‹æ± å’Œ<strong>countä¸º6çš„ CountDownLatch å¯¹è±¡</strong> ã€‚ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†è¯»å–ä»»åŠ¡ï¼Œæ¯â¼€ä¸ªçº¿ç¨‹å¤„ç†å®Œä¹‹åå°±å°†count-1ï¼Œè°ƒç”¨ CountDownLatch å¯¹è±¡çš„ await() æ–¹æ³•ï¼Œç›´åˆ°æ‰€æœ‰â½‚ä»¶è¯»å–å®Œä¹‹åï¼Œæ‰ä¼šæ¥ç€æ‰§è¡Œåé¢çš„é€»è¾‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchExample1</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç†â½‚ä»¶çš„æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> threadCount = <span class="number">6</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºâ¼€ä¸ªå…·æœ‰å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± å¯¹è±¡ï¼ˆæ¨èä½¿ç”¨æ„é€ æ–¹æ³•åˆ›å»ºï¼‰</span></span><br><span class="line">     ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">     <span class="keyword">final</span> CountDownLatch countDownLatch = <span class="keyword">new</span></span><br><span class="line">CountDownLatch(threadCount);</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">         <span class="keyword">final</span> <span class="keyword">int</span> threadnum = i;</span><br><span class="line">         threadPool.execute(() â†’ &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//å¤„ç†â½‚ä»¶çš„ä¸šåŠ¡æ“ä½œ</span></span><br><span class="line">                ......</span><br><span class="line">               &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">               &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//è¡¨ç¤ºâ¼€ä¸ªâ½‚ä»¶å·²ç»è¢«å®Œæˆ</span></span><br><span class="line">                countDownLatch.countDown();</span><br><span class="line">              &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">       countDownLatch.await();</span><br><span class="line">       threadPool.shutdown();</span><br><span class="line">       System.out.println(<span class="string">&quot;finish&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-5-4-Volatile-å…³é”®å­—">1.5.4 Volatile å…³é”®å­—</h4><h5 id="4-0-JMM-æ˜¯ä»€ä¹ˆ-ï¼Ÿ-ç¼“å­˜ä¸€è‡´æ€§åè®®MESI-CPUå†…å­˜å±éšœï¼ŸJAVAå†…å­˜å±éšœï¼Ÿ">4.0 JMM æ˜¯ä»€ä¹ˆ ï¼Ÿ ç¼“å­˜ä¸€è‡´æ€§åè®®MESI ? CPUå†…å­˜å±éšœï¼ŸJAVAå†…å­˜å±éšœï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/06717ac8312c">å¹¶å‘ç¼–ç¨‹-ï¼ˆ4ï¼‰-JMMåŸºç¡€ï¼ˆæ€»çº¿é”ã€ç¼“å­˜é”ã€MESIç¼“å­˜ä¸€è‡´æ€§åè®®ã€CPU å±‚é¢çš„å†…å­˜å±éšœï¼‰</a></p></blockquote><ul><li><p><strong>JMMå®šä¹‰</strong></p><p>å…¨ç§°Java Memory Modelï¼ˆjavaå†…å­˜æ¨¡å‹ï¼‰æ˜¯ä¸€ç³»åˆ—çš„Javaè™šæ‹Ÿæœºå¹³å°å¯¹å¼€å‘è€…æä¾›çš„å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å†…å­˜å¯è§æ€§ã€æ˜¯å¦å¯ä»¥é‡æ’åºç­‰é—®é¢˜çš„æ— å…³å…·ä½“å¹³å°çš„ç»Ÿä¸€çš„ä¿è¯ã€‚</p></li><li><p><strong>MESI ç¼“å­˜ä¸€è‡´æ€§åè®®åè®®</strong></p><ul><li><p><strong>ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜</strong></p><p>CPUå¤„ç†é€Ÿåº¦ï¼Œè¿œå¤§äºI/Oè®¾å¤‡ï¼ˆç£ç›˜ï¼‰ï¼Œä¸ºäº†è§£å†³äº†å¤„ç†å™¨ä¸å†…å­˜çš„é€Ÿåº¦çŸ›ç›¾ï¼Œå¼•å…¥äº†<strong>é«˜é€Ÿç¼“å­˜</strong>ã€‚ä½†æ˜¯ç”±æ­¤ä¹Ÿå¸¦æ¥äº†ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><ul><li><strong>æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šç¼“å­˜å†…å­˜çš„æ•°æ®åœ¨å„è‡ªå¯„å­˜å™¨ä¸­</strong>ï¼Œåœ¨<strong>ä¸åŒ CPU ä¸­è¿è¡Œçš„ä¸åŒçº¿ç¨‹çœ‹åˆ°åŒä¸€ä»½å†…å­˜çš„ç¼“å­˜å€¼ä¸ä¸€æ ·</strong>å°±ä¼šå­˜åœ¨ç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li></ul></li><li><p><strong>MESIåè®®å†…å®¹</strong></p><p>ä¸ºäº†è¾¾åˆ°æ•°æ®è®¿é—®çš„ä¸€è‡´ï¼Œéœ€è¦å„ä¸ªå¤„ç†å™¨åœ¨è®¿é—®ç¼“å­˜æ—¶éµå¾ªä¸€äº›åè®®ï¼Œåœ¨è¯»å†™æ—¶æ ¹æ®åè®®æ¥æ“ä½œï¼Œ<strong>æœ€å¸¸è§çš„å°±æ˜¯ MESI åè®®</strong>ï¼š<br>MESI è¡¨ç¤ºç¼“å­˜è¡Œçš„å››ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><blockquote><p>åœ¨ MESI åè®®ä¸­ï¼Œæ¯ä¸ªç¼“å­˜çš„ç¼“å­˜æ§åˆ¶å™¨ä¸ä»…çŸ¥é“è‡ªå·±çš„ è¯»å†™æ“ä½œï¼Œè€Œä¸”<strong>ä¹Ÿç›‘å¬(snoop)å…¶å®ƒ Cache çš„è¯»å†™æ“ä½œ</strong>ã€‚</p></blockquote><ul><li><strong>M(Modify)</strong> è¡¨ç¤ºå…±äº«<strong>æ•°æ®</strong>åªç¼“å­˜åœ¨<strong>å½“å‰ CPU ç¼“å­˜</strong>ä¸­ï¼Œ å¹¶ä¸”æ˜¯è¢«ä¿®æ”¹çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜çš„æ•°æ®å’Œä¸»å†…å­˜ä¸­çš„<strong>æ•°æ®ä¸ä¸€è‡´</strong>ã€‚</li><li><strong>E(Exclusive)</strong> è¡¨ç¤ºç¼“å­˜çš„ç‹¬å çŠ¶æ€ï¼Œ<strong>æ•°æ®</strong>åªç¼“å­˜åœ¨<strong>å½“å‰ CPU ç¼“å­˜</strong>ä¸­ï¼Œå¹¶ä¸”<strong>æ²¡æœ‰è¢«ä¿®æ”¹</strong>ã€‚</li><li><strong>S(Shared)</strong> è¡¨ç¤º<strong>æ•°æ®</strong>å¯èƒ½è¢«<strong>å¤šä¸ª CPU ç¼“å­˜</strong>ï¼Œå¹¶ä¸”å„ä¸ªç¼“å­˜ä¸­çš„<strong>æ•°æ®å’Œä¸»å†…å­˜æ•°æ®ä¸€è‡´</strong>ã€‚</li><li><strong>I(Invalid)</strong> è¡¨ç¤ºç¼“å­˜å·²ç»<strong>å¤±æ•ˆ</strong>ã€‚</li></ul><p>å¯¹äº MESI åè®®ï¼Œä» CPU è¯»å†™è§’åº¦æ¥è¯´ä¼šéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p><p><img src="https://i.loli.net/2021/06/11/YbfKoySNDMX5swn.png" alt="image-20210611200929872"></p><ul><li><strong>CPU è¯»è¯·æ±‚</strong>ï¼šç¼“å­˜å¤„äº Mã€Eã€S çŠ¶æ€éƒ½å¯ä»¥è¢«è¯»å–ï¼ŒI çŠ¶ æ€ CPU åªèƒ½ä»ä¸»å­˜ä¸­è¯»å–æ•°æ®ï¼›</li><li><strong>CPU å†™è¯·æ±‚</strong>ï¼šç¼“å­˜å¤„äº Mã€E çŠ¶æ€æ‰å¯ä»¥è¢«å†™ã€‚å¯¹äº S çŠ¶ æ€çš„å†™ï¼Œéœ€è¦å°†<strong>å…¶ä»– CPU ä¸­ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆ</strong>æ‰å¯å†™ã€‚</li></ul></li><li><p><strong>Store Bufferesï¼ˆå­˜å‚¨ç¼“å­˜ï¼‰</strong></p><blockquote><p>CPU ç¼“å­˜è¡Œçš„çŠ¶æ€æ˜¯é€šè¿‡æ¶ˆæ¯ä¼ é€’æ¥è¿›è¡Œçš„ï¼Œå¦‚æœ CPU0 è¦å¯¹ä¸€ä¸ªåœ¨ç¼“å­˜ä¸­<strong>å…±äº«çš„å˜é‡</strong>è¿›è¡Œ<strong>å†™å…¥</strong>ï¼Œé¦–å…ˆå‘é€ä¸€ä¸ªå¤±æ•ˆçš„æ¶ˆæ¯ç»™åˆ°å…¶ä»–ç¼“å­˜äº†è¯¥æ•°æ®çš„ CPUã€‚å¹¶ä¸”è¦<strong>ç­‰åˆ°ä»–ä»¬çš„ç¡®è®¤å›æ‰§</strong>ã€‚CPU0 åœ¨è¿™æ®µæ—¶é—´å†…éƒ½ä¼šå¤„äº<strong>é˜»å¡çŠ¶æ€</strong>ã€‚</p></blockquote><p>ä¸ºäº†é¿å…é˜»å¡å¸¦æ¥çš„èµ„æºæµªè´¹ã€‚åœ¨ cpu ä¸­å¼•å…¥ äº† Store Bufferesï¼ˆå­˜å‚¨ç¼“å­˜ï¼‰ å’Œ Invalidate Queueï¼ˆæ— æ•ˆé˜Ÿåˆ—ï¼‰ã€‚</p><ul><li>CPU0 å†™å…¥å…±äº«æ•°æ®æ—¶ï¼Œ<strong>ç›´æ¥æŠŠæ•°æ®å†™å…¥åˆ° store bufferes ä¸­ï¼ŒåŒæ—¶å‘é€ invalidate æ¶ˆæ¯ï¼Œç„¶åç»§ç»­å»å¤„ç†å…¶ä»–æŒ‡ä»¤</strong>ï¼›</li><li>æ”¶åˆ°å…¶ä»–æ‰€æœ‰ CPU å‘é€äº† invalidate ACKæ¶ˆæ¯æ—¶ï¼Œ<strong>å†å°† store bufferes ä¸­çš„æ•°æ®æ•°æ®å­˜å‚¨è‡³ cache ä¸­</strong>ï¼›</li><li>æœ€åå†ä»<strong>æœ¬åœ°CacheåŒæ­¥åˆ°ä¸»å†…å­˜</strong>ã€‚</li></ul></li><li><p><strong>CPUå±‚é¢å†…å­˜å±éšœ</strong></p><blockquote><p>å†…å­˜å±éšœå°±æ˜¯<strong>å°† Store Bufferes ä¸­çš„æŒ‡ä»¤å†™å…¥åˆ°å†…å­˜</strong>ï¼Œä»è€Œä½¿å¾—å…¶ä»–è®¿é—®åŒä¸€å…±äº«å†…å­˜çš„çº¿ç¨‹çš„å¯è§æ€§ã€‚</p></blockquote><p>ç¡¬ä»¶å±‚çš„å†…å­˜å±éšœåˆ†ä¸ºä¸¤ç§ï¼š<strong>Load Barrier ï¼ˆè¯»å±éšœ</strong>ï¼‰å’Œ <strong>Store Barrierï¼ˆå†™å±éšœï¼‰åŠ Full Barrierï¼ˆå…¨å±éšœ</strong>ï¼‰æ˜¯è¯»å±éšœå’Œå†™å±éšœçš„åˆé›†ã€‚</p><ul><li><strong>å†™å±éšœ</strong>ï¼šå¼ºåˆ¶<strong>æŠŠå†™ç¼“å†²åŒº/é«˜é€Ÿç¼“å­˜</strong>ä¸­çš„è„æ•°æ®ç­‰<strong>å†™å›ä¸»å†…å­˜</strong></li><li><strong>è¯»å±éšœ</strong>ï¼šå°†ç¼“å†²åŒº/é«˜é€Ÿç¼“å­˜ä¸­ç›¸åº”çš„<strong>æ•°æ®å¤±æ•ˆ</strong>ã€‚</li></ul></li><li><p><strong>JAVA å†…å­˜å±éšœ</strong></p><p>javaçš„å†…å­˜å±éšœé€šå¸¸æ‰€è°“çš„å››ç§ï¼Œ<strong>LoadLoadï¼ˆLLï¼‰, StoreStoreï¼ˆSSï¼‰, LoadStoreï¼ˆLSï¼‰, StoreLoadï¼ˆSL</strong>)å®é™…ä¸Šä¹Ÿæ˜¯ä¸Šè¿°ä¸¤ç§çš„ç»„åˆï¼Œå®Œæˆä¸€ç³»åˆ—çš„å±éšœå’Œæ•°æ®åŒæ­¥åŠŸèƒ½ã€‚</p><ul><li><strong>LoadLoadï¼ˆLLï¼‰å±éšœ</strong>ï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadLoad; Load2ï¼Œåœ¨Load2åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li><li><strong>StoreStoreï¼ˆSSï¼‰å±éšœ</strong>ï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚</li><li><strong>LoadStoreï¼ˆLSï¼‰å±éšœ</strong>ï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li><li><strong>StoreLoadï¼ˆSLï¼‰å±éšœ</strong>ï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚</li></ul></li></ul></li></ul><h5 id="4-1-ä»€ä¹ˆæ˜¯HappenBeforeåŸåˆ™ï¼Ÿ">4.1 ä»€ä¹ˆæ˜¯HappenBeforeåŸåˆ™ï¼Ÿ</h5><p>åœ¨ JMM ä¸­ï¼Œ<strong>å¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œã€å¯è§ã€‘ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»è¦å­˜åœ¨ happens-before å…³ç³»</strong>ã€‚è¿™ä¸¤ä¸ªæ“ä½œå¯ä»¥æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„çº¿ç¨‹ã€‚</p><p><strong>å®ƒæ˜¯å¯è§æ€§ä¸æœ‰åºæ€§çš„ä¸€å¥—è§„åˆ™æ€»ç»“ï¼ŒæŠ›å¼€ä»¥ä¸‹ happens-before è§„åˆ™ï¼ŒJMM å¹¶ä¸èƒ½ä¿è¯ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™ï¼Œå¯¹äºå…¶å®ƒçº¿ç¨‹å¯¹è¯¥å…±äº«å˜é‡çš„è¯»å¯è§</strong> ã€‚</p><ul><li><p><strong>HappenBeforeåŸåˆ™</strong></p><ul><li><p><strong>as-if-serial è§„åˆ™ï¼ˆç¨‹åºé¡ºåºæ‰§è¡Œï¼‰</strong>ï¼šå•ä¸ªçº¿ç¨‹ä¸­çš„ä»£ç é¡ºåºä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œå¯¹äºç»“æœæ¥è¯´æ˜¯ä¸å˜çš„ã€‚</p></li><li><p><strong>volatile å˜é‡è§„åˆ™</strong>ï¼Œå¯¹äº volatile ä¿®é¥°çš„å˜é‡çš„<strong>å†™æ“ä½œ</strong>ï¼Œ ä¸€å®š happen-before åç»­å¯¹äº volatile å˜é‡çš„<strong>è¯»æ“ä½œ</strong>;</p></li><li><p><strong>ç›‘è§†å™¨é”è§„åˆ™ï¼ˆmonitor lock ruleï¼‰</strong>ï¼šå¯¹ä¸€ä¸ªç›‘è§†å™¨çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªç›‘è§†å™¨çš„åŠ é”ã€‚</p></li><li><p><strong>ä¼ é€’æ€§è§„åˆ™</strong>ï¼šå¦‚æœA happens-before Bï¼Œä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚</p></li><li><p><strong>start è§„åˆ™</strong>ï¼šå¦‚æœçº¿ç¨‹ A æ‰§è¡Œæ“ä½œ ThreadB.start(),é‚£ä¹ˆçº¿ç¨‹ A çš„ ThreadB.start()æ“ä½œ happens-before çº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œã€‚</p></li><li><p><strong>join è§„åˆ™</strong>ï¼šå¦‚æœçº¿ç¨‹ A æ‰§è¡Œæ“ä½œ ThreadB.join()å¹¶æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆçº¿ç¨‹ B ä¸­çš„ä»»æ„æ“ä½œ happens-before äºçº¿ç¨‹ A ä» ThreadB.join()æ“ä½œæˆåŠŸè¿”å›ã€‚</p></li></ul></li><li><p><strong>ä¸¾ä¾‹è¯´æ˜ï¼šä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åº</strong>ï¼Ÿ</p><p>è¯·çœ‹ä¸‹é¢ä»£ç ï¼š</p><blockquote><p><strong>å‡è®¾</strong> çº¿ç¨‹Aæ‰§è¡Œwriter()æ–¹æ³•ä¹‹<strong>å</strong>ï¼Œçº¿ç¨‹Bæ‰§è¡Œreader()æ–¹æ³•ï¼Œé‚£ä¹ˆçº¿ç¨‹Bæ‰§è¡Œ4çš„æ—¶å€™ä¸€å®šèƒ½çœ‹åˆ°çº¿ç¨‹Aå†™å…¥çš„å€¼å—ï¼Ÿ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolatileExample</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a = <span class="number">1</span>;           <span class="comment">//1</span></span><br><span class="line">        flag = <span class="keyword">true</span>;     <span class="comment">//2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;       <span class="comment">//3</span></span><br><span class="line">            <span class="keyword">int</span> i = a;    <span class="comment">//4</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆæ˜¯<strong>è‚¯å®šçš„</strong>ã€‚å› ä¸ºæ ¹æ®happens-beforeè§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹å…³ç³»ï¼š</p><ol><li>æ ¹æ®<strong>ç¨‹åºé¡ºåºè§„åˆ™</strong>ï¼Œ1 happens-before 2ï¼›3 happens-before 4</li><li>æ ¹æ®<strong>volatileè§„åˆ™</strong>ï¼Œ2 happens-before 3ï¼›</li><li>æ ¹æ®<strong>ä¼ é€’æ€§è§„åˆ™</strong>ï¼Œ1 happens-before 4 ã€‚</li></ol><p>å› æ­¤ï¼Œç»¼åˆè¿ç”¨<strong>ç¨‹åºé¡ºåºè§„åˆ™ã€volatileè§„åˆ™åŠä¼ é€’æ€§è§„åˆ™</strong>ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°1 happens-before 4ï¼Œå³çº¿ç¨‹Båœ¨æ‰§è¡Œ4çš„æ—¶å€™ä¸€å®šèƒ½çœ‹åˆ°Aå†™å…¥çš„å€¼ã€‚</p></li></ul><h5 id="4-2-Volatile-å…³é”®å­—åŸç†">4.2 Volatile å…³é”®å­—åŸç†</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/paddix/p/5428507.html">https://www.cnblogs.com/paddix/p/5428507.html</a> ã€‚</p></blockquote><p>æ­¤é¢˜è€ƒå¯Ÿçš„æ˜¯<code>volatile</code>è¿™ä¸ªå…³é”®å­—ã€‚å¯ä»¥ä»<code>volatile</code>çš„ä½œç”¨å’Œ<code>volatile</code>çš„åŸç†è¿™ä¸‰ä¸ªæ–¹é¢æ¥è¿›è¡Œå›ç­”ã€‚<strong>volatileåªèƒ½ä¿è¯å˜é‡çš„å¯è§æ€§ã€æœ‰åºæ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§</strong>ã€‚</p><ul><li><strong>å¯è§æ€§å®ç°åŸç†</strong></li></ul><blockquote><p>ä¸ºäº†å®ç°<strong>volatileå¯è§æ€§</strong>å’Œ<strong>happen-befor</strong>çš„è¯­ä¹‰ã€‚JVMåº•å±‚æ˜¯é€šè¿‡ä¸€ä¸ªå«åšâ€œ<strong>å†…å­˜å±éšœï¼ˆåŸºäºMESIï¼‰</strong>â€çš„ä¸œè¥¿æ¥å®Œæˆï¼ˆä¹Ÿå®ç°äº†<strong>æœ‰åºæ€§</strong> ï¼Ÿï¼‰ã€‚</p></blockquote><p><strong>çº¿ç¨‹æœ¬èº«å¹¶ä¸ç›´æ¥ä¸ä¸»å†…å­˜è¿›è¡Œæ•°æ®çš„äº¤äº’</strong>ï¼Œè€Œæ˜¯é€šè¿‡çº¿ç¨‹çš„å·¥ä½œå†…å­˜æ¥å®Œæˆç›¸åº”çš„æ“ä½œã€‚è¿™ä¹Ÿæ˜¯å¯¼è‡´çº¿ç¨‹é—´æ•°æ®ä¸å¯è§çš„æœ¬è´¨åŸå› ã€‚</p><p>ä½¿ç”¨<strong>MESI</strong> åè®®ï¼Œä½¿å¾—<strong>ä»»æ„ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº† volatile ä¿®é¥°çš„å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥é©¬ä¸Šè¯†åˆ«åˆ°æœ€æ–°å€¼</strong>ã€‚</p><blockquote><p>æœ€ç»ˆç›®æ ‡ï¼šä¿è¯äº†<strong>ç¼“å­˜çš„ä¸€è‡´æ€§</strong>ã€‚</p><p>å…·ä½“çš„è¯ï¼Œä¸‹é¢æ˜¯ç”¨<strong>å†…å­˜å±éšœ</strong>æ¥å®ç°çš„ã€‚</p></blockquote><ol><li>ä¿®æ”¹æœ¬åœ°å·¥ä½œå†…å­˜ï¼Œå¼ºåˆ¶åˆ·å›ä¸»å†…å­˜ï¼›</li></ol><p><img src="https://i.loli.net/2021/06/11/JTFaYRu13pfQg9d.png" alt="image-20210611204633903"></p><ol start="2"><li><p>å¼ºåˆ¶è®©å…¶ä»–çº¿ç¨‹çš„å·¥ä½œå†…å­˜å¤±æ•ˆè¿‡æœŸï¼›</p><p><img src="https://i.loli.net/2021/06/11/2kphvOoJu4K65Hb.png" alt="image-20210611204715422"></p></li><li><p>å…¶ä»–çº¿ç¨‹é‡æ–°ä»ä¸»å†…å­˜åŠ è½½æœ€æ–°å€¼ï¼›</p><p><img src="https://i.loli.net/2021/06/11/rvo58ueDB6CPyMa.png" alt="image-20210611204743839"></p></li></ol><ul><li><p><strong>æœ‰åºæ€§å®ç°åŸç†</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_42764468/article/details/106898608">https://blog.csdn.net/qq_42764468/article/details/106898608</a></p></blockquote><p>ä»æºä»£ç åˆ°æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå¯èƒ½ä¼šç»è¿‡ä¸‰ç§é‡æ’åºï¼š</p><p><img src="https:////upload-images.jianshu.io/upload_images/2845835-8fc217f556cd34f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/680/format/webp" alt="img"></p></li><li><p><strong>ã€æŒ‡ä»¤ã€‘é‡æ’åº</strong>ï¼Œ<strong>JMM</strong> ä¼šè¦æ±‚ç¼–è¯‘å™¨ç”ŸæˆæŒ‡ä»¤æ—¶ï¼Œä¼š<strong>æ’å…¥å†…å­˜å±éšœ</strong>æ¥ç¦æ­¢å¤„ç†å™¨é‡æ’åºã€‚</p></li></ul><blockquote><p>JMMå±äºè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ï¼šâ‘ ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œâ‘¡å¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p></blockquote><ul><li><p><strong>ç¼–è¯‘å™¨é‡æ’åº</strong>ï¼Œ<strong>JMM</strong> <strong>ç¦æ­¢äº†ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨</strong>é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚</p></li><li><p><strong>å†…å­˜é‡æ’åº</strong>ï¼šç”±äºå¤„ç†å™¨ä¼šä½¿ç”¨è¯»/å†™ç¼“å†²åŒºï¼Œå‡ºäºæ€§èƒ½çš„åŸå› ï¼Œå†…å­˜ä¼šå¯¹è¯»/å†™è¿›è¡Œé‡æ’åº</p></li></ul><p>JVM æ˜¯<strong>ä½¿ç”¨å†…å­˜å±éšœæ¥ç¦æ­¢ã€æŒ‡ä»¤ã€‘é‡æ’ï¼Œä»è€Œè¾¾åˆ°ï¼šå¯è§æ€§ + éƒ¨åˆ†æœ‰åºæ€§</strong>æ•ˆæœã€‚</p><blockquote><p><strong>lockå‰ç¼€æŒ‡ä»¤å®é™…ç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœ</strong>ï¼Ÿ ä¸‹é¢ä¸æ˜¯å¯è§æ€§å—ï¼Ÿï¼Ÿï¼Ÿ</p></blockquote><p>å¯¹volatileå˜é‡çš„<strong>å†™</strong>æ“ä½œä¸æ™®é€šå˜é‡çš„ä¸»è¦åŒºåˆ«æœ‰ä¸¤ç‚¹ï¼š</p><ol><li><p>ä¿®æ”¹volatileå˜é‡<strong>å‰</strong>ï¼Œ<strong>ä¼šå¼ºåˆ¶å°†ä¿®æ”¹åçš„å€¼åˆ·æ–°çš„ä¸»å†…å­˜ä¸­</strong>ã€‚</p><blockquote><p>æ¯ä¸ªvolatileå†™æ“ä½œå‰æ’å…¥<strong>StoreStoreï¼ˆSSï¼‰å±éšœ</strong></p></blockquote></li><li><p>ä¿®æ”¹volatileå˜é‡<strong>å</strong>ï¼Œ<strong>ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­å¯¹åº”çš„å˜é‡å€¼å¤±æ•ˆ</strong>ï¼Œå› æ­¤ï¼Œå†è¯»å–è¯¥å˜é‡å€¼çš„æ—¶å€™å°±éœ€è¦é‡æ–°ä»è¯»å–ä¸»å†…å­˜ä¸­çš„å€¼ã€‚</p><blockquote><p>åœ¨å†™æ“ä½œåæ’å…¥StoreLoadå±éšœï¼›</p></blockquote></li></ol><p>å¯¹volatileå˜é‡çš„<strong>è¯»</strong>æ“ä½œç±»ä¼¼ï¼š</p><ol><li><p>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œå‰æ’å…¥<strong>LoadLoadï¼ˆLLï¼‰å±éšœ</strong>ï¼›</p><blockquote><p>ç¡®ä¿Load2åŠåç»­LoadæŒ‡ä»¤åŠ è½½æ•°æ®ä¹‹å‰èƒ½è®¿é—®åˆ°Load1åŠ è½½çš„æ•°æ®ã€‚</p></blockquote></li><li><p>åœ¨è¯»æ“ä½œåæ’å…¥<strong>LoadStoreï¼ˆLSå±éšœ</strong>ï¼‰ã€‚</p><blockquote><p>ç¡®ä¿Store2å’Œåç»­StoreæŒ‡ä»¤æ‰§è¡Œå‰ï¼Œå¯ä»¥è®¿é—®åˆ°Load1åŠ è½½çš„æ•°æ®ã€‚</p></blockquote></li></ol><h5 id="4-3-volatileä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§ï¼Ÿ">4.3 volatileä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/simpleDi/p/11517150.html">ä¸ºä»€ä¹ˆvolatileèƒ½ä¿è¯æœ‰åºæ€§ä¸èƒ½ä¿è¯åŸå­æ€§</a></p></blockquote><p>å¯¹äºi++è¿™ç§å¤åˆæ“ä½œï¼Œå³ä½¿ä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°ä¹Ÿä¸èƒ½ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå¯èƒ½ä¼šå¼•å‘æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">i++;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°<code>i++</code>æ“ä½œï¼Œå…¶å®åˆ†ä¸ºä¸‰ä¸ªæ“ä½œï¼š</p><ol><li><p>çº¿ç¨‹è¯»å–i</p></li><li><p>temp = i + 1</p></li><li><p>i = temp</p></li></ol><p>A,Bä¸¤ä¸ªçº¿ç¨‹å¤šçº¿ç¨‹æ“ä½œæ—¶ï¼š</p><ol><li><p>Açº¿ç¨‹è¯»å–iå¹¶æ‰§è¡Œäº† temp = i + 1çš„æ“ä½œï¼Œ æ­¤æ—¶çš„ iï¼ˆ0ï¼‰ çš„å€¼è¿˜æ²¡æœ‰å˜åŒ–</p></li><li><p>æ­¤æ—¶Bä¹Ÿè¯»å…¥iå¹¶æ‰§è¡Œtemp = i + 1æ“ä½œï¼Œæ­¤æ—¶iï¼ˆ0ï¼‰ä¹Ÿæ²¡å˜åŒ–</p><blockquote><p>âš ï¸ è™½ç„¶æœ‰MESIåè®®ï¼Œä½†æ˜¯<code>temp</code>ä¸ä¿å­˜å˜é‡<code>i</code>æ‰€åœ¨å†…å­˜åŒºåŸŸï¼Œ<strong>æ˜¯cpuå†…éƒ¨çš„è®¡ç®—</strong>ï¼Œä¸ä¼šè¢«ç«‹é©¬åˆ·æ–°å†…å­˜ï¼</p></blockquote></li><li><p>å½“Aå†™å…¥i = tempï¼ˆ1ï¼‰æ—¶ï¼Œç”±äºå¯è§æ€§ç«‹é©¬åœ¨ä¸»å­˜è¢«åˆ·æ–°äº†å€¼ i=1</p></li><li><p>å½“Bä¹Ÿå†™å…¥i = tempæ—¶ï¼Œ<strong>æ­¤æ—¶Aä¾æ—§æ˜¯1ï¼Œè€Œä¸æ˜¯2</strong></p></li></ol><h5 id="4-4-å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§-ï¼Ÿ">4.4 <strong>å¹¶å‘ç¼–ç¨‹çš„ä¸‰ä¸ªé‡è¦ç‰¹æ€§</strong> ï¼Ÿ</h5><ol><li><strong>åŸå­æ€§ :</strong> â¼€ä¸ªçš„æ“ä½œæˆ–è€…å¤šæ¬¡æ“ä½œï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œå…¨éƒ¨éƒ½å¾—åˆ°æ‰§è¡Œå¹¶ä¸”ä¸ä¼šæ”¶åˆ°ä»»ä½•å› ç´ çš„â¼²æ‰°è€Œä¸­æ–­ï¼Œ<strong>è¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</strong>ã€‚ <code>synchronized</code> å¯ä»¥ä¿è¯ä»£ç ç‰‡æ®µçš„åŸå­æ€§ã€‚</li><li><strong>å¯è§æ€§ <strong>ï¼šå½“</strong>â¼€ä¸ªå˜é‡å¯¹å…±äº«å˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå¦å¤–çš„çº¿ç¨‹éƒ½æ˜¯â½´å³å¯ä»¥çœ‹åˆ°ä¿®æ”¹åçš„æœ€æ–°å€¼</strong>ã€‚ volatile å…³é”®å­—å¯ä»¥ä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§ã€‚</li><li><strong>æœ‰åºæ€§</strong>ï¼šä»£ç åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­çš„å…ˆåé¡ºåºï¼ŒJava åœ¨ç¼–è¯‘å™¨ä»¥åŠè¿è¡ŒæœŸé—´çš„ä¼˜åŒ–ï¼Œä»£ç çš„æ‰§è¡Œé¡ºåºæœªå¿…å°±æ˜¯ç¼–å†™ä»£ç æ—¶å€™çš„é¡ºåºã€‚ <code>volatile</code> å…³é”®å­—å¯ä»¥ç¦â½ŒæŒ‡ä»¤è¿›è¡Œé‡æ’åºä¼˜åŒ–ã€‚</li></ol><h5 id="4-5-è¯´è¯´-synchronized-å…³é”®å­—å’Œ-volatile-å…³é”®å­—çš„åŒºåˆ«ï¼Ÿ">4.5 <strong>è¯´è¯´</strong> synchronized <strong>å…³é”®å­—å’Œ</strong> volatile <strong>å…³é”®å­—çš„åŒºåˆ«</strong>ï¼Ÿ</h5><p>synchronizedå…³é”®å­—å’Œvolatileå…³é”®å­—æ¯”è¾ƒï¼š</p><ul><li><p><strong>volatileå…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°</strong>ï¼Œæ‰€ä»¥volatileæ€§èƒ½è‚¯å®šâ½synchronizedå…³é”®å­—è¦å¥½ã€‚</p></li><li><p><strong>volatileå…³é”®å­—åªèƒ½ç”¨äºå˜é‡</strong>ï¼Œè€Œsynchronizedå…³é”®å­—å¯ä»¥ä¿®é¥°æ–¹æ³•ä»¥åŠä»£ç å—ã€‚</p><blockquote><p>synchronizedå…³é”®å­—åœ¨JavaSE1.6ä¹‹åè¿›è¡Œäº†ä¸»è¦åŒ…æ‹¬ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—è€Œå¼•â¼Šçš„åå‘é”å’Œè½»é‡çº§é”ä»¥åŠå…¶å®ƒå„ç§ä¼˜åŒ–ä¹‹åæ‰§è¡Œæ•ˆç‡æœ‰äº†æ˜¾è‘—æå‡ï¼Œå®é™…å¼€å‘ä¸­ä½¿ç”¨<br>synchronized å…³é”®å­—çš„åœºæ™¯è¿˜æ˜¯æ›´å¤šâ¼€äº›ã€‚</p></blockquote></li><li><p><strong>volatileå…³é”®å­—åªèƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§</strong>ï¼Œä½†ä¸èƒ½ä¿è¯æ•°æ®çš„åŸå­æ€§ã€‚synchronizedå…³é”®å­—ä¸¤è€…éƒ½èƒ½ä¿è¯ã€‚</p></li><li><p><strong>å¤šçº¿ç¨‹è®¿é—®volatileå…³é”®å­—ä¸ä¼šå‘ç”Ÿé˜»å¡</strong>ï¼Œè€Œsynchronizedå…³é”®å­—å¯èƒ½ä¼šå‘â½£é˜»å¡</p></li></ul><h4 id="1-5-5-Atomic-åŸå­ç±»">1.5.5 Atomic åŸå­ç±»</h4><h5 id="5-1-ä»€ä¹ˆæ˜¯Atomic-åŸå­ç±»ï¼Ÿ">5.1 ä»€ä¹ˆæ˜¯Atomic åŸå­ç±»ï¼Ÿ</h5><p>æ‰€ä»¥ï¼Œæ‰€è°“åŸå­ç±»è¯´ç®€å•ç‚¹å°±æ˜¯<strong>å…·æœ‰åŸå­/åŸå­æ“ä½œç‰¹å¾çš„ç±»</strong>ã€‚</p><blockquote><p>åœ¨æˆ‘ä»¬è¿™â¾¥ Atomic æ˜¯æŒ‡â¼€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ã€‚å³ä½¿æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹â¼€èµ·æ‰§è¡Œçš„æ—¶å€™ï¼Œâ¼€ä¸ªæ“ä½œâ¼€æ—¦å¼€å§‹ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹â¼²æ‰°ã€‚</p></blockquote><h5 id="5-2-JUC-åŒ…ä¸­çš„åŸå­ç±»æ˜¯å“ª4ç±»">5.2 JUC <strong>åŒ…ä¸­çš„åŸå­ç±»æ˜¯å“ª</strong>4<strong>ç±»</strong>?</h5><p><img src="https://i.loli.net/2021/05/16/vS4DHpKCN9bjnTF.png" alt="image-20210516152124223"></p><h5 id="5-3-Volatile-å’Œ-atomic-å˜é‡åŒºåˆ«ï¼Ÿ">5.3 Volatile å’Œ  atomic  å˜é‡åŒºåˆ«ï¼Ÿ</h5><ul><li>Volatileå˜é‡å¯ä»¥ç¡®ä¿å…ˆè¡Œå…³ç³»ï¼Œå³å†™æ“ä½œä¼šå‘ç”Ÿåœ¨åç»­çš„è¯»æ“ä½œä¹‹å‰, ä½†å®ƒå¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚ä¾‹å¦‚ç”¨volatileä¿®é¥°countå˜é‡é‚£ä¹ˆ count++ æ“ä½œå°±ä¸æ˜¯åŸå­æ€§çš„ã€‚</li><li>è€ŒAtomicIntegerç±»æä¾›çš„atomicæ–¹æ³•å¯ä»¥è®©è¿™ç§æ“ä½œå…·æœ‰åŸå­æ€§å¦‚getAndIncrement()æ–¹æ³•ä¼šåŸå­æ€§çš„è¿›è¡Œå¢é‡æ“ä½œæŠŠå½“å‰å€¼åŠ ä¸€ï¼Œå…¶å®ƒæ•°æ®ç±»å‹å’Œå¼•ç”¨å˜é‡ä¹Ÿå¯ä»¥è¿›è¡Œç›¸ä¼¼æ“ä½œã€‚</li></ul><h5 id="5-4-è®²è®²-AtomicInteger-çš„ä½¿ç”¨-ï¼Ÿ">5.4 è®²è®² AtomicInteger çš„ä½¿ç”¨ ï¼Ÿ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span> <span class="comment">//è·å–å½“å‰çš„å€¼</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndSet</span><span class="params">(<span class="keyword">int</span> newValue)</span><span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndIncrement</span><span class="params">()</span><span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶â¾ƒå¢</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndDecrement</span><span class="params">()</span> <span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶â¾ƒå‡</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndAdd</span><span class="params">(<span class="keyword">int</span> delta)</span> <span class="comment">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> <span class="comment">//å¦‚æœè¾“â¼Šçš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“â¼Šå€¼ï¼ˆupdateï¼‰</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lazySet</span><span class="params">(<span class="keyword">int</span> newValue)</span><span class="comment">//æœ€ç»ˆè®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySetè®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„â¼€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span></span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AtomicIntegerTest</span> </span>&#123;</span><br><span class="line">       <span class="comment">// åŸºæœ¬ç±»å‹ä¹Ÿè¦æ˜¯åŸå­ç±»</span></span><br><span class="line">       <span class="keyword">private</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">       <span class="comment">//ä½¿â½¤AtomicIntegerä¹‹åï¼Œä¸éœ€è¦å¯¹è¯¥æ–¹æ³•åŠ é”ï¼Œä¹Ÿå¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            count.incrementAndGet();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> count.get();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-5ï¼ˆé‡ç‚¹æé—®ï¼‰-AtomicInteger-åŸç†ï¼Ÿ">5.5ï¼ˆé‡ç‚¹æé—®ï¼‰ AtomicInteger åŸç†ï¼Ÿ</h5><p>AtomicInteger ç±»ä¸»è¦åˆ©ç”¨ <strong>CAS (compare and swap) + volatile</strong> å’Œ <strong>native</strong> æ–¹æ³•æ¥ä¿è¯åŸå­æ“ä½œï¼Œä»è€Œé¿å… synchronized çš„é«˜å¼€é”€ï¼Œæ‰§è¡Œæ•ˆç‡å¤§ä¸ºæå‡ã€‚</p><p>æˆ‘ä»¬ä»¥è‡ªå¢æ–¹æ³•ä¸ºä¾‹ï¼š <code>getAndIncrement</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndIncrement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ¬è´¨æ˜¯åœ¨è°ƒç”¨ unsafeä¸­çš„ <code>getAndAddInt</code></p><blockquote><p>unsafeä¸­çš„compareAndSwapIntæ–¹æ³•å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compareAndSwapInt(Object o, <span class="keyword">long</span> offset,<span class="keyword">int</span> expected,<span class="keyword">int</span> x);  <span class="comment">// xæ˜¯å‡†å¤‡æ›´æ–°çš„å€¼</span></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndIncrement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.<span class="built_in">getAndAddInt</span>(<span class="keyword">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Unsafeä¸­çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getAndAddInt</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">int</span> var4)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> var5;</span><br><span class="line">    <span class="comment">// getIntVolatileæ–¹æ³•è·å–åˆ°æœŸæœ›å€¼valueåå»è°ƒç”¨compareAndSwapIntæ–¹æ³•ï¼Œå¤±è´¥åˆ™è¿›è¡Œé‡è¯•</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// var5æ˜¯è®¡ç®—å¾—åˆ°çš„æœŸæœ›å€¼ï¼Œè·å–æ­¤æ—¶å†…å­˜çš„æœ€æ–°å€¼ï¼ˆå› ä¸ºvalueæ˜¯votilateä¿®é¥°ï¼Œä¿®æ”¹æ€»æ˜¯è¢«èƒ½åŠæ—¶çœ‹åˆ°ï¼‰</span></span><br><span class="line">        var5 = <span class="keyword">this</span>.<span class="built_in">getIntVolatile</span>(var1, var2);</span><br><span class="line">    <span class="comment">// è®¡ç®—ä¼ å…¥compareAndSwapIntçš„å››ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="comment">// var1ï¼šä¼ å…¥çš„thiså¯¹è±¡ï¼›var2ï¼švalueå†…å­˜åç§»å€¼ï¼›var5ï¼šæœŸæœ›å€¼ï¼Œå¸Œæœ›å’Œã€var2ã€‘ä¸€è‡´ï¼› var5+var4ï¼švar5+var4ï¼ˆ1ï¼‰ï¼Œé€’å¢</span></span><br><span class="line">    &#125; <span class="keyword">while</span>(!<span class="keyword">this</span>.<span class="built_in">compareAndSwapInt</span>(var1, var2, var5, var5 + var4));</span><br><span class="line">    <span class="keyword">return</span> var5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ€ç»ˆæ€»ç»“å¦‚ä¸‹</strong></p><p>AtomicInteger ç±»ä¸»è¦åˆ©ç”¨ <strong>CAS (compare and swap) + volatile</strong> æ¥ä¿è¯åŸå­æ“ä½œã€‚AtomicInteger çš„ä¸»è¦æ–¹æ³•éƒ½æ˜¯é€šè¿‡è°ƒç”¨Unsafeç±»æ–¹æ³•å»å®ç°ï¼Œå¦‚ compareAndSet å®é™…æ˜¯è°ƒç”¨AtomicInteger çš„compareAndSwapIntæ–¹æ³•ã€‚</p><p>ä¸‹é¢ä»¥ getAndIncrementå®ç°æ¥è¯´æ˜ã€‚</p><ol><li><p>getAndIncrementè°ƒç”¨äº† Unsafeçš„getAndAddIntæ–¹æ³•ï¼Œä¼ é€’äº†ï¼ˆ1ï¼‰å½“å‰thiså¯¹è±¡ï¼Œï¼ˆ2ï¼‰valueåç§»é‡valueoffsetï¼Œç”¨æ¥è®¡ç®—å¾—åˆ°valueå€¼ï¼ˆ3ï¼‰è¦åŠ ä¸Šçš„å€¼ï¼Œç”±äºæ˜¯é€’å¢æ‰€ä»¥æ˜¯1</p><blockquote><p>âš ï¸ <strong>ä¸ºä»€ä¹ˆä¸ä¼ valueçš„å€¼ï¼Œè€Œæ˜¯åç§»é‡</strong>ï¼Ÿ ä¼ åç§»é‡æ˜¯ä¸ºäº†è®¡ç®—valueæ‰€åœ¨çš„å†…å­˜åœ°å€ï¼Œè¿›è€Œè·å–æœ€æ–°çš„valueå€¼ã€‚</p></blockquote></li><li><p>getAndAddInté‡‡ç”¨CASæ–¹å¼è¿›è¡Œæ›´æ–°ï¼Œè¿˜éœ€è¦è¿›è¡Œå½“å‰æœŸæœ›å€¼çš„è®¡ç®—</p><ul><li>é€šè¿‡<code>getIntVolatile</code>è·å–åˆ°<strong>çº¿ç¨‹æ­¤æ—¶å†…å­˜valueå€¼</strong>ï¼ˆæœŸæœ›å€¼ï¼‰ï¼Œä¹Ÿå°±æ˜¯è®°å½•<strong>æ‰§è¡ŒCASå‰</strong>çš„å†…å­˜æœ€æ–°valueå€¼ï¼›</li></ul></li><li><p>ç„¶åå¼€å§‹æ‰§è¡ŒUnsafeçš„ <code>compareAndSwapInt</code> ï¼Œä¸»è¦æ˜¯é€šè¿‡<code>Atomic::cmpxchg</code> é€»è¾‘æ¥å®ç°</p><p>ï¼ˆ1ï¼‰å°†è¦destï¼ˆvalueå†…å­˜åœ°å€ï¼‰ï¼ŒcompareValueï¼ˆæœŸæœ›å€¼ï¼‰ï¼Œexchange_valueï¼ˆè¦æ›´æ–°çš„å€¼ï¼‰å†™å…¥å¯„å­˜å™¨ä¸­</p><p>ï¼ˆ2ï¼‰çº¿ç¨‹å¦‚æœæ˜¯è¿è¡Œå¤šæ ¸CPUï¼Œä¸Š<strong>LOCK#é”ï¼Œå°†destå†…å­˜åŒºåŸŸé”ä½</strong> ï¼›å¦åˆ™ä¸ä¸ŠLOCK#é”</p><p>ï¼ˆ3ï¼‰æ‰§è¡Œcmpxchgï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢å‘½ä»¤ï¼‰ï¼Œå¦‚æœdestçš„valueå€¼ï¼ˆ<strong>æ‰§è¡ŒCASä¸­</strong>çš„æœ€æ–°valueå€¼ï¼‰ == compareValueï¼Œåˆ™å†™å…¥exchange_value ï¼›</p><p>ï¼ˆ4ï¼‰å¦åˆ™å†™å…¥å¤±è´¥ï¼Œé€šè¿‡ä¸æ–­<strong>è‡ªæ—‹ï¼ˆå¾ªç¯</strong>ï¼‰æœŸæœ›å¾—åˆ°æ‰§è¡Œ</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> æ ¡æ‹› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_å¤šçº¿ç¨‹</title>
      <link href="/p/8959/"/>
      <url>/p/8959/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h2 id="1-4-å¤šçº¿ç¨‹">1.4 å¤šçº¿ç¨‹</h2><h4 id="0-ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•è®©ä»–ä»¬æŒ‰é¡ºåºæ‰“å°Aã€Bã€Cï¼Ÿå¦‚æœæ˜¯å¾ªç¯æ‰“å°10æ¬¡å‘¢ï¼Ÿä¾æ¬¡æ‰“å°1-100å‘¢ï¼Ÿäº¤æ›¿æ‰“å°å¥‡å¶10æ¬¡å‘¢ï¼Ÿ">0.<strong>ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•è®©ä»–ä»¬æŒ‰é¡ºåºæ‰“å°Aã€Bã€Cï¼Ÿå¦‚æœæ˜¯å¾ªç¯æ‰“å°10æ¬¡å‘¢ï¼Ÿä¾æ¬¡æ‰“å°1~100å‘¢ï¼Ÿäº¤æ›¿æ‰“å°å¥‡å¶10æ¬¡å‘¢ï¼Ÿ</strong></h4><blockquote><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/370130458">https://zhuanlan.zhihu.com/p/370130458</a></p></blockquote><h5 id="0-1-synchronized-æ¡ä»¶å˜é‡">0.1 <strong>synchronized + æ¡ä»¶å˜é‡</strong></h5><ol><li><p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆå¾ªç¯æ‰“å°1æ¬¡ï¼‰</p><p>æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>æ–°å»ºä¸‰ä¸ªçº¿ç¨‹1ã€2ã€3 ï¼Œåˆ†åˆ«è´Ÿè´£æ‰“å°Aã€Bã€Cï¼›åŒæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼š<code>num%3==å½“å‰çº¿ç¨‹æ¡ä»¶å˜é‡?</code> ï¼›</li><li>æŠŠæ‰“å°çš„ä»£ç ç”¨synchronized åŠ é”ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°é”åï¼Œ<strong>whileå¾ªç¯åˆ¤æ–­</strong>æ˜¯å¦æ»¡è¶³å½“å‰çº¿ç¨‹çš„æ¡ä»¶å˜é‡ ï¼›</li><li><strong>å¦‚æœæ»¡è¶³</strong> ï¼Œä¾¿æ‰§è¡Œåç»­é€»è¾‘æ‰“å°å½“å‰çº¿ç¨‹ï¼Œä¹‹å<strong>notifyall()å”¤é†’å…¶å®ƒçº¿ç¨‹</strong>ï¼›</li><li><strong>å¦‚æœä¸æ»¡è¶³</strong>ï¼Œæ‰§è¡Œwaitç­‰å¾…é‡Šæ”¾é”ï¼›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wait_Notify_ACB</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;  <span class="comment">// targetNum ï¼š æ¯ä¸ªçº¿ç¨‹åº”è¯¥æ»¡è¶³çš„å¯¹åº”æ¡ä»¶å˜é‡</span></span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span> (num % <span class="number">3</span> != targetNum) </span><br><span class="line">                &#123;   <span class="comment">// while ï¼šçº¿ç¨‹é˜»å¡åœ¨wait(),å†æ¬¡è¢«å”¤é†’åº”è¯¥å…ˆæ£€æŸ¥ä¸‹æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æœªå¿…è½®åˆ°å½“å‰çº¿ç¨‹æ‰§è¡Œï¼›ç”¨ifä¼šå¯¼è‡´ç›´æ¥å¾€ä¸‹æ‰§è¡Œã€‚</span></span><br><span class="line">                    <span class="keyword">try</span> </span><br><span class="line">                    &#123;</span><br><span class="line">                        LOCK.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">                    &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                num++;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Wait_Notify_ACB  wait_notify_acb = <span class="keyword">new</span> Wait_Notify_ACB ();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆå¾ªç¯æ‰“å°10æ¬¡ï¼‰</p><p>æ‰“å°10æ¬¡ï¼Œåªéœ€è®©ä¸‰ä¸ªçº¿ç¨‹ï¼Œå°è¯•å»ç«äº‰10æ¬¡é”å³å¯ã€‚æ‰€ä»¥åœ¨<strong>synchronizedå‰åŠ ä¸Šforå¾ªç¯</strong>å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wait_Notify_ACB</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;  <span class="comment">// targetNum ï¼š æ¯ä¸ªçº¿ç¨‹åº”è¯¥æ»¡è¶³çš„å¯¹åº”æ¡ä»¶å˜é‡</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i&lt;<span class="number">10</span> ;i++)</span><br><span class="line">      &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span> (num % <span class="number">3</span> != targetNum) </span><br><span class="line">                &#123;   <span class="comment">// while ï¼šçº¿ç¨‹é˜»å¡åœ¨wait(),å†æ¬¡è¢«å”¤é†’åº”è¯¥å…ˆæ£€æŸ¥ä¸‹æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æœªå¿…è½®åˆ°å½“å‰çº¿ç¨‹æ‰§è¡Œï¼›ç”¨ifä¼šå¯¼è‡´ç›´æ¥å¾€ä¸‹æ‰§è¡Œã€‚</span></span><br><span class="line">                    <span class="keyword">try</span> </span><br><span class="line">                    &#123;</span><br><span class="line">                        LOCK.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">                    &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                num++;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Wait_Notify_ACB  wait_notify_acb = <span class="keyword">new</span> Wait_Notify_ACB ();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆæ‰“å°1~100)</p><p>è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œsynchronized ä¸­åŠ é”å‡½æ•°å¯¹num+1ï¼Œä¿è¯åªè¦æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wait_Notify_100</span> </span>&#123;</span><br><span class="line">â€‹</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxnum = <span class="number">10</span>;</span><br><span class="line">â€‹</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">                <span class="keyword">while</span> (num % <span class="number">3</span> != targetNum) &#123; <span class="comment">//æƒ³æƒ³è¿™é‡Œä¸ºä»€ä¹ˆä¸èƒ½ç”¨ifä»£æ›¿ï¼Œæƒ³ä¸èµ·æ¥å¯ä»¥çœ‹å…¬ä¼—å·ä¸Šä¸€ç¯‡æ–‡ç« </span></span><br><span class="line">                    <span class="keyword">if</span>(num &gt;= maxnum)&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        LOCK.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(num &gt;= maxnum)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                num++;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: &quot;</span> + num);</span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Wait_Notify_100  wait_notify_100 = <span class="keyword">new</span> Wait_Notify_100 ();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            wait_notify_100.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;thread1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            wait_notify_100.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;thread2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            wait_notify_100.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;thread3&quot;</span>).start();</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆå¥‡å¶æ‰“å°10æ¬¡ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Wait_Notify_Odd_Even</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object monitor = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> count;</span><br><span class="line">    Wait_Notify_Odd_Even(<span class="keyword">int</span> initCount) &#123;</span><br><span class="line">        <span class="keyword">this</span>.count = initCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printOddEven</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (monitor) &#123;</span><br><span class="line">            <span class="keyword">while</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> <span class="comment">// è¿™é‡Œä¸ç”¨whileå¾ªç¯åˆ¤æ–­ï¼Œæ˜¯å› ä¸ºä¸‹æ¬¡notifyAllçš„ä¸€å®šæ˜¯å¥‡æ•°æˆ–å¶æ•°</span></span><br><span class="line">                &#123;</span><br><span class="line">                    System.out.print( Thread.currentThread().getName() + <span class="string">&quot;ï¼š&quot;</span>);</span><br><span class="line">                    System.out.println(++count);</span><br><span class="line">                    monitor.notifyAll();</span><br><span class="line">                    monitor.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é˜²æ­¢count=10åï¼Œwhile()å¾ªç¯ä¸å†æ‰§è¡Œï¼Œæœ‰å­çº¿ç¨‹è¢«é˜»å¡æœªè¢«å”¤é†’ï¼Œå¯¼è‡´ä¸»çº¿ç¨‹ä¸èƒ½é€€å‡º</span></span><br><span class="line">            monitor.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Wait_Notify_Odd_Even waitNotifyOddEven = <span class="keyword">new</span> Wait_Notify_Odd_Even(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(waitNotifyOddEven::printOddEven, <span class="string">&quot;odd&quot;</span>).start();</span><br><span class="line">        Thread.sleep(<span class="number">10</span>); <span class="comment">//ä¸ºäº†ä¿è¯çº¿ç¨‹oddå…ˆæ‹¿åˆ°é”</span></span><br><span class="line">        <span class="keyword">new</span> Thread(waitNotifyOddEven::printOddEven, <span class="string">&quot;even&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h5 id="0-2-join">0.2 join</h5><p><code>join()</code>æ–¹æ³•**ï¼šåœ¨Açº¿ç¨‹ä¸­è°ƒç”¨äº†Bçº¿ç¨‹çš„join()æ–¹æ³•æ—¶ï¼Œè¡¨ç¤ºåªæœ‰å½“Bçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ—¶ï¼ŒAçº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œ**ã€‚</p><p>åŸºäºè¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬ä½¿å¾—ä¸‰ä¸ªçº¿ç¨‹æŒ‰é¡ºåºæ‰§è¡Œï¼Œç„¶åå¾ªç¯å¤šæ¬¡å³å¯ã€‚æ— è®ºçº¿ç¨‹1ã€çº¿ç¨‹2ã€çº¿ç¨‹3å“ªä¸ªå…ˆæ‰§è¡Œï¼Œæœ€åæ‰§è¡Œçš„é¡ºåºéƒ½æ˜¯çº¿ç¨‹1â€”â€”&gt;çº¿ç¨‹2â€”â€”&gt;çº¿ç¨‹3ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Join_ABC</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> printABC(<span class="keyword">null</span>),<span class="string">&quot;A&quot;</span>);</span><br><span class="line">            Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> printABC(t1),<span class="string">&quot;B&quot;</span>);</span><br><span class="line">            Thread t3 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> printABC(t2),<span class="string">&quot;C&quot;</span>);</span><br><span class="line">            t1.start();</span><br><span class="line">            t2.start();</span><br><span class="line">            t3.start();</span><br><span class="line">            Thread.sleep(<span class="number">10</span>); <span class="comment">//è¿™é‡Œæ˜¯è¦ä¿è¯åªæœ‰t1ã€t2ã€t3ä¸ºä¸€ç»„ï¼Œè¿›è¡Œæ‰§è¡Œæ‰èƒ½ä¿è¯t1-&gt;t2-&gt;t3çš„æ‰§è¡Œé¡ºåºã€‚</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">printABC</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Thread beforeThread;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">printABC</span><span class="params">(Thread beforeThread)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.beforeThread = beforeThread;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(beforeThread!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    beforeThread.join(); </span><br><span class="line">                    System.out.print(Thread.currentThread().getName());</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="0-3-Lock">0.3 Lock</h5><p>è¯¥æ–¹æ³•å¾ˆå®¹æ˜“ç†è§£ï¼Œä¸ç®¡å“ªä¸ªçº¿ç¨‹æ‹¿åˆ°é”ï¼Œ<strong>åªæœ‰ç¬¦åˆæ¡ä»¶çš„æ‰èƒ½æ‰“å°</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Lock_ABC</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;   <span class="comment">// å½“å‰çŠ¶æ€å€¼ï¼šä¿è¯ä¸‰ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ›¿æ‰“å°</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (num % <span class="number">3</span> == targetNum) &#123;</span><br><span class="line">                num++;</span><br><span class="line">                i++;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">            lock.unlock(); <span class="comment">// ä¸ç¬¦åˆè¦æ±‚ç›´æ¥é‡Šæ”¾é”ï¼Œä¸ä¼šåƒsyncä¸€æ ·é˜»å¡åœ¨syncæˆ–waitå¤„</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Lock_ABC lockABC = <span class="keyword">new</span> Lock_ABC();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lockABC.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lockABC.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lockABC.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="0-4-Semaphore">0.4 <strong>Semaphore</strong></h5><p>Semaphoreï¼šç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªç‰¹å®šèµ„æºçš„æ“ä½œæ•°é‡ï¼Œæˆ–è€…åŒæ—¶æ‰§è¡ŒæŸä¸ªåˆ¶å®šæ“ä½œçš„æ•°é‡ã€‚Semaphoreå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå…¶å€¼ä¸ºå¯ä»¥è®¿é—®çš„å…±äº«èµ„æºçš„ä¸ªæ•°ã€‚</p><ul><li>ä¸€ä¸ªçº¿ç¨‹è¦è®¿é—®å…±äº«èµ„æºï¼Œå…ˆä½¿ç”¨<code>acquire()</code>æ–¹æ³•è·å¾—ä¿¡å·é‡ï¼Œå¦‚æœä¿¡å·é‡çš„è®¡æ•°å™¨å€¼å¤§äºç­‰äº1ï¼Œæ„å‘³ç€æœ‰å…±äº«èµ„æºå¯ä»¥è®¿é—®ï¼Œåˆ™ä½¿å…¶è®¡æ•°å™¨å€¼å‡å»1ï¼Œå†è®¿é—®å…±äº«èµ„æºã€‚å¦‚æœè®¡æ•°å™¨å€¼ä¸º0,çº¿ç¨‹è¿›å…¥ä¼‘çœ ï¼›</li><li>å½“æŸä¸ªçº¿ç¨‹ä½¿ç”¨å®Œå…±äº«èµ„æºåï¼Œä½¿ç”¨<code>release()</code>é‡Šæ”¾ä¿¡å·é‡ï¼Œ<strong>å¹¶å°†ä¿¡å·é‡å†…éƒ¨çš„è®¡æ•°å™¨åŠ 1</strong>ï¼Œä¹‹å‰è¿›å…¥ä¼‘çœ çš„çº¿ç¨‹å°†è¢«å”¤é†’å¹¶å†æ¬¡è¯•å›¾è·å¾—ä¿¡å·é‡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SemaphoreABC</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore s1 = <span class="keyword">new</span> Semaphore(<span class="number">1</span>); <span class="comment">//å› ä¸ºå…ˆæ‰§è¡Œçº¿ç¨‹Aï¼Œæ‰€ä»¥è¿™é‡Œè®¾s1çš„è®¡æ•°å™¨ä¸º1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore s2 = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore s3 = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(Semaphore currentThread, Semaphore nextThread)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                currentThread.acquire();       <span class="comment">//é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå³ä¿¡å·é‡çš„è®¡æ•°å™¨å‡1ä¸º0</span></span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">                nextThread.release();          <span class="comment">//å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œå³ä¿¡å·é‡çš„è®¡æ•°å™¨åŠ 1</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        SemaphoreABC printer = <span class="keyword">new</span> SemaphoreABC();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            printer.printABC(s1, s2);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            printer.printABC(s2, s3);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            printer.printABC(s3, s1);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-1-çº¿ç¨‹åŸºæœ¬">1.4.1 çº¿ç¨‹åŸºæœ¬</h3><h4 id="1-ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ">1. ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿ<strong>å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></h4><h5 id="1-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿ">1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿ</h5><ul><li><p><strong>ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ</strong></p><p><strong>è¿›ç¨‹æ˜¯ç¨‹åºçš„â¼€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½</strong>ï¼Œå› æ­¤è¿›ç¨‹æ˜¯<strong>åŠ¨æ€</strong>çš„ã€‚ç³»ç»Ÿè¿è¡Œâ¼€ä¸ªç¨‹åºå³æ˜¯â¼€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚</p><blockquote><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ windows ä¸­é€šè¿‡æŸ¥çœ‹ä»»åŠ¡ç®¡ç†å™¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šçœ‹åˆ° window å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼ˆ.exe â½‚ä»¶çš„è¿è¡Œï¼‰ã€‚åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç¨‹åºåªå¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œé‡Œé¢å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚</p><p><img src="https://i.loli.net/2021/05/16/cxYPKI1LnR4V3Mt.png" alt="image-20210516101110229"></p></blockquote></li><li><p><strong>ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</strong></p><p><strong>çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯â¼€ä¸ªâ½è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½</strong>ã€‚â¼€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§â½£å¤šä¸ªçº¿ç¨‹ã€‚</p><ul><li>ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº</strong>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰â¾ƒâ¼°çš„<strong>ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong>å’Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong></li></ul><p>æ‰€ä»¥ç³»ç»Ÿåœ¨äº§â½£â¼€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œ<u>åˆ‡æ¢â¼¯ä½œ</u>æ—¶ï¼Œ<strong>è´Ÿæ‹…è¦â½è¿›ç¨‹å°å¾—å¤š</strong>ï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p><blockquote><p>â¼€ä¸ª Java ç¨‹åºçš„è¿è¡Œæ˜¯ main çº¿ç¨‹å’Œå¤šä¸ªå…¶ä»–çº¿ç¨‹åŒæ—¶è¿è¡Œã€‚</p></blockquote></li></ul><h5 id="1-2-å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ">1.2 å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h5><ol><li><strong>åŸå­æ€§</strong>ï¼Œç®€å•è¯´å°±æ˜¯<u>ç›¸å…³æ“ä½œä¸ä¼šä¸­é€”è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œä¸€èˆ¬é€šè¿‡åŒæ­¥æœºåˆ¶å®ç°</u>ï¼›</li><li><strong>å¯è§æ€§</strong>ï¼Œ<u>æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡ï¼Œå…¶çŠ¶æ€èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çŸ¥æ™“</u>ï¼Œé€šå¸¸è¢«è§£é‡Šä¸ºå°†çº¿ç¨‹æœ¬åœ°çŠ¶æ€åæ˜ åˆ°ä¸»å†…å­˜ä¸Šï¼Œvolatile å°±æ˜¯è´Ÿè´£ä¿è¯å¯è§æ€§çš„ï¼›</li><li><strong>æœ‰åºæ€§</strong>ï¼Œ<u>æ˜¯ä¿è¯çº¿ç¨‹å†…ä¸²è¡Œè¯­ä¹‰ï¼Œé¿å…æŒ‡ä»¤é‡æ’</u>ç­‰ã€‚</li></ol><h5 id="1-3-ä¸ºä»€ä¹ˆç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯-u-çº¿ç¨‹-u-ç§æœ‰çš„">1.3 ä¸ºä»€ä¹ˆç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯<u>çº¿ç¨‹</u>ç§æœ‰çš„?</h5><ul><li><p><strong>ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰</strong></p><p>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªâ¼‰äº†ã€‚</p><p>æ‰€ä»¥ï¼Œç¨‹åºè®¡æ•°å™¨<u>ç§æœ‰</u>ä¸»è¦æ˜¯ä¸ºäº†<strong>çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®</strong>ã€‚</p></li><li><p><strong>è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆç§æœ‰</strong></p><ul><li><p><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼š <u>æ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºâ¼€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯</u>ã€‚ä»æ–¹æ³•è°ƒç”¨ç›´â¾„æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€â¼€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­<strong>â¼Šæ ˆå’Œå‡ºæ ˆ</strong>çš„è¿‡ç¨‹ã€‚</p></li><li><p><strong>æœ¬åœ°æ–¹æ³•æ³•æ ˆ</strong>ï¼š å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š<strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ</strong> <strong>Java</strong> æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ <strong>Nativeæ–¹æ³•æœåŠ¡</strong>ã€‚ åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆâ¼†ä¸ºâ¼€ã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œä¸ºäº†<strong>ä¿è¯çº¿ç¨‹ä¸­çš„å±€éƒ¨å˜é‡ä¸è¢«åˆ«çš„çº¿ç¨‹è®¿é—®åˆ°</strong>ï¼Œè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p></li></ul><h4 id="2-åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆéçº¿ç¨‹æ± ï¼‰ï¼Ÿ-å“ªç§æœ€å¥½ï¼Ÿ">2.<strong>åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆéçº¿ç¨‹æ± ï¼‰ï¼Ÿ å“ªç§æœ€å¥½ï¼Ÿ</strong></h4><p>ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼æ¥è¿›è¡Œåˆ›å»ºï¼š</p><ol><li><p><strong>ç»§æ‰¿Threadç±»</strong>ï¼šï¼ˆ1ï¼‰å®šä¹‰Threadç±»çš„å­ç±»ï¼Œå¹¶é‡å†™è¯¥ç±»çš„runæ–¹æ³•ï¼ˆ2ï¼‰åˆ›å»ºThreadå­ç±»çš„å®ä¾‹å¯¹è±¡ ï¼ˆ3ï¼‰è°ƒç”¨å¯¹è±¡start()æ–¹æ³•</p><blockquote><ul><li>ä¼˜ç‚¹ï¼šç¼–å†™ç®€å•ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œåˆ™æ— éœ€ä½¿ç”¨ Thread.currentThread() æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨thiså³å¯è·å–å½“å‰çº¿ç¨‹ï¼›</li><li>ç¼ºç‚¹ï¼šå› ä¸ºçº¿ç¨‹ç±»å·²ç»ç»§æ‰¿äº†Threadç±»ï¼ŒJavaè¯­è¨€æ˜¯å•ç»§æ‰¿çš„ï¼Œæ‰€ä»¥å°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–çˆ¶ç±»äº†ã€‚</li></ul></blockquote></li><li><p><strong>å®ç°Runnableæ¥å£</strong>ï¼šï¼ˆ1ï¼‰å®šä¹‰runnableæ¥å£çš„<strong>å®ç°ç±»</strong>ï¼Œå¹¶é‡å†™è¯¥æ¥å£çš„run()æ–¹æ³• ï¼ˆ2ï¼‰åˆ›å»ºå®ç°ç±»çš„å®ä¾‹å¯¹è±¡ï¼ˆ3ï¼‰è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹</p></li><li><p><strong>é€šè¿‡Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹</strong>ï¼šï¼ˆ1ï¼‰åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»ï¼Œ<strong>å¹¶å®ç°call()æ–¹æ³•</strong>ï¼ˆ2ï¼‰åˆ›å»ºCallableå®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶ä½¿ç”¨FutureTaskç±»æ¥åŒ…è£…Callableå¯¹è±¡ï¼ˆ3ï¼‰ä½¿ç”¨FutureTaskå¯¹è±¡ä½œä¸ºThreadå¯¹è±¡çš„targetåˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ï¼ˆ4ï¼‰è°ƒç”¨FutureTaskå¯¹è±¡çš„get()æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼</p></li></ol><p>å…¶ä¸­ <u>å®ç°Runnalbeæ¥å£æ›´å¥½</u>  ï¼Œä½¿ç”¨å®ç°Runnableæ¥å£çš„æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹<strong>å¯ä»¥å¤„ç†åŒä¸€èµ„æº</strong>ï¼Œä»è€Œå®ç°èµ„æºçš„å…±äº«ã€‚</p><h4 id="3-å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ">3.<strong>å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ</strong></h4><ol><li><p>ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢ï¼›</p></li><li><p>ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢ï¼Œä½†æ˜¯ä¸æ¨èè¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºstopå’ŒsuspendåŠresumeä¸€æ ·éƒ½æ˜¯è¿‡æœŸä½œåºŸçš„æ–¹æ³•ï¼›</p></li><li><p>ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">     <span class="keyword">volatile</span> <span class="keyword">boolean</span> stop = <span class="keyword">false</span>;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot; is running&quot;</span>);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">           sleep(<span class="number">1000</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;week up from blcok...&quot;</span>);</span><br><span class="line">            stop = <span class="keyword">true</span>; <span class="comment">// åœ¨å¼‚å¸¸å¤„ç†ä»£ç ä¸­ä¿®æ”¹å…±äº«å˜é‡çš„çŠ¶æ€</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    System.out.println(getName() + <span class="string">&quot; is exiting...&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterruptThreadDemo3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span>          InterruptedException </span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">          MyThread m1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">          System.out.println(<span class="string">&quot;Starting thread...&quot;</span>);</span><br><span class="line">          m1.start();</span><br><span class="line">          Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">          System.out.println(<span class="string">&quot;Interrupt thread...: &quot;</span> +           m1.getName());</span><br><span class="line">          m1.stop = <span class="keyword">true</span>; <span class="comment">// è®¾ç½®å…±äº«å˜é‡ä¸ºtrue</span></span><br><span class="line">          m1.interrupt(); <span class="comment">// é˜»å¡æ—¶é€€å‡ºé˜»å¡çŠ¶æ€</span></span><br><span class="line">          Thread.sleep(<span class="number">3000</span>); <span class="comment">// ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’ä»¥ä¾¿è§‚å¯Ÿçº¿ç¨‹m1çš„ä¸­æ–­æƒ…å†µ</span></span><br><span class="line">          System.out.println(<span class="string">&quot;Stopping application...&quot;</span>);</span><br><span class="line">       &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="4-ä»€ä¹ˆæ˜¯Daemonçº¿ç¨‹ï¼Ÿå®ƒæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ">4.<strong>ä»€ä¹ˆæ˜¯Daemonçº¿ç¨‹ï¼Ÿå®ƒæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</strong></h4><p>æ‰€è°“åå°(daemon)çº¿ç¨‹ï¼Œä¹Ÿå«å®ˆæŠ¤çº¿ç¨‹ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åœ¨åå°æä¾›ä¸€ç§é€šç”¨æœåŠ¡çš„çº¿ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸ªçº¿ç¨‹å¹¶ä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚</p><ul><li><strong>æ„ä¹‰</strong>ï¼šJVMçš„åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯Daemonçº¿ç¨‹ï¼ŒFinalizerä¹Ÿæ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</li></ul><h4 id="5-è¯´è¯´CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«ï¼Ÿ">5.<strong>è¯´è¯´CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«ï¼Ÿ</strong></h4><p>ä¸¤ä¸ªçœ‹ä¸Šå»æœ‰ç‚¹åƒçš„ç±»ï¼Œéƒ½åœ¨<code>java.util.concurrent</code>ä¸‹ï¼Œéƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»£ç è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºï¼š</p><ol><li>CyclicBarrierçš„æŸä¸ªçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œ<strong>è¯¥çº¿ç¨‹å³åœæ­¢è¿è¡Œ</strong>ï¼Œ<strong>ç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½åˆ°è¾¾äº†è¿™ä¸ªç‚¹</strong>ï¼Œæ‰€æœ‰çº¿ç¨‹æ‰é‡æ–°è¿è¡ŒCountDownLatchåˆ™ä¸æ˜¯ï¼ŒæŸçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œåªæ˜¯ç»™æŸä¸ªæ•°å€¼**-1**è€Œå·²ï¼Œè¯¥çº¿ç¨‹ç»§ç»­è¿è¡Œï¼›</li><li>CyclicBarrier<strong>åªèƒ½å”¤èµ·ä¸€ä¸ªä»»åŠ¡</strong>ï¼ŒCountDownLatchå¯ä»¥å”¤èµ·å¤šä¸ªä»»åŠ¡</li><li>CyclicBarrierå¯é‡ç”¨ï¼Œ<strong>CountDownLatchä¸å¯é‡ç”¨ï¼Œè®¡æ•°å€¼ä¸º0è¯¥CountDownLatchå°±ä¸å¯å†ç”¨äº†</strong></li></ol><h4 id="6-è¯·ä½ ç®€è¦è¯´æ˜ä¸€ä¸‹çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Ÿ">6.<strong>è¯·ä½ ç®€è¦è¯´æ˜ä¸€ä¸‹çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Ÿ</strong></h4><p><img src="https://i.loli.net/2021/04/28/VCN8xckXHMdrl1R.png" alt="image-20210428164922743"></p><ol><li><strong>æ–°å»ºçŠ¶æ€</strong>ï¼šnewè¯­å¥åˆ›å»ºçš„çº¿ç¨‹å¯¹è±¡å¤„äºæ–°å»ºçŠ¶æ€ï¼Œä»…è¢«åˆ†é…äº†å†…å­˜ï¼›</li><li><strong>ç­‰å¾…çŠ¶æ€</strong>ï¼š å½“çº¿ç¨‹åœ¨newä¹‹åï¼Œå¹¶ä¸”<u>åœ¨è°ƒç”¨startæ–¹æ³•å‰</u>ï¼Œçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ ;</li><li><strong>å°±ç»ªçŠ¶æ€</strong>ï¼š å…¶ä»–çº¿ç¨‹è°ƒç”¨å®ƒçš„**start()**æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹å°±è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œ<u>åªå·®ç­‰å¾…cpuçš„ä½¿ç”¨æƒ </u> ;</li><li><strong>è¿è¡ŒçŠ¶æ€</strong>ï¼š <u>çº¿ç¨‹å ç”¨CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç </u>  ;</li><li><strong>é˜»å¡çŠ¶æ€</strong>ï¼š é˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸäº›åŸå› æ”¾å¼ƒCPUï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚<u>é˜»å¡çŠ¶æ€åˆ†ä¸ºä¸‰ç§ï¼š</u><ul><li><u>ç­‰å¾…é˜»å¡:</u> è¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œ**wait()**æ–¹æ³•ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…æ± ä¸­ï¼›</li><li><u>åŒæ­¥é˜»å¡:</u> è¿è¡Œçš„çº¿ç¨‹åœ¨è·å–<strong>å¯¹è±¡åŒæ­¥é”</strong>æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠçº¿ç¨‹æ”¾å…¥é”æ± ä¸­ï¼›</li><li><u>å…¶ä»–é˜»å¡:</u> è¿è¡Œçš„çº¿ç¨‹æ‰§è¡ŒSleep()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºI/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠçº¿ç¨‹è®¾ä¸ºé˜»å¡çŠ¶æ€ã€‚</li></ul></li><li><strong>æ­»äº¡çŠ¶æ€</strong>ï¼š çº¿ç¨‹æ‰§è¡Œå®Œ<strong>run()æ–¹æ³•ä¸­çš„ä»£ç </strong>ï¼Œæˆ–è€…é‡åˆ°äº†æœªæ•è·çš„å¼‚å¸¸ï¼Œå°±ä¼šé€€å‡ºrun()æ–¹æ³•ï¼Œç»“æŸç”Ÿå‘½å‘¨æœŸ</li></ol><h4 id="7-notify-å’ŒnotifyAll-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">7. <strong>notify()å’ŒnotifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><ul><li><strong>notifyå¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼ˆwhyï¼Ÿ</strong>ï¼‰ï¼Œè€ŒnotifyAllåˆ™ä¸ä¼šï¼›</li><li>ä½¿ç”¨notifyall,å¯ä»¥å”¤é†’ æ‰€æœ‰å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä½¿å…¶é‡æ–°è¿›å…¥é”çš„äº‰å¤ºé˜Ÿåˆ—ä¸­ï¼Œè€Œnotifyåªèƒ½å”¤é†’ä¸€ä¸ªã€‚</li></ul><h4 id="8-sleep-å’Œwait-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">8. <strong>sleep()å’Œwait() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4><ul><li><p><strong>ç»§æ‰¿çš„ç±»</strong>ï¼šsleep()æ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“è¯¥æ–¹æ³•æ˜¯å±äºThreadç±»ä¸­çš„ï¼›è€Œwait()æ–¹æ³•ï¼Œåˆ™æ˜¯å±äºObjectç±»ä¸­çš„ï¼›</p><blockquote><p><em>sleep()</em> æ˜¯ <em>Thread</em> ç±»é™æ€æ–¹æ³•ï¼Œå¯ä»¥ä½¿ <u>å½“å‰</u> çº¿ç¨‹é˜»å¡ï¼Œå¹¶æŒ‡å®šæš‚åœæ—¶é—´ï¼Œé‡ç‚¹åœ¨äºç†è§£ <u>å½“å‰</u>ã€‚ä¼‘çœ æ—¶é—´æœŸæ»¡åï¼Œè¯¥çº¿ç¨‹ä¸ä¸€å®šä¼šç«‹å³æ‰§è¡Œè¢«CPUè°ƒåº¦ï¼Œåªæ˜¯åˆ°äº†å°±ç»ªçŠ¶æ€ã€‚</p></blockquote></li><li><p><strong>æ˜¯å¦é‡Šæ”¾é”</strong>ï¼šsleep()æ–¹æ³•å¯¼è‡´äº†ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œè®©å‡ºcpuè¯¥å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯ä»–çš„ç›‘æ§çŠ¶æ€ä¾ç„¶ä¿æŒè€…ï¼Œå½“æŒ‡å®šçš„æ—¶é—´åˆ°äº†åˆä¼šè‡ªåŠ¨æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚<strong>åœ¨è°ƒç”¨sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼›å½“è°ƒç”¨wait()æ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”</strong>ï¼Œè¿›å…¥ç­‰å¾…æ­¤å¯¹è±¡çš„ç­‰å¾…é”å®šæ± ï¼›</p></li><li><p><strong>ç”¨å¤„</strong>ï¼š <strong>Wait é€šå¸¸è¢«ç”¨äºçº¿ç¨‹é—´äº¤äº’/é€šä¿¡</strong>ï¼Œsleep é€šå¸¸è¢«ç”¨äºæš‚åœæ‰§è¡Œï¼›</p></li><li><p><strong>å†æ¬¡å”¤é†’</strong>ï¼š wait() æ–¹æ³•è¢«è°ƒç”¨åï¼Œçº¿ç¨‹ä¸ä¼šâ¾ƒåŠ¨è‹é†’ï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹è°ƒç”¨åŒâ¼€ä¸ªå¯¹è±¡ä¸Šçš„ notify() æˆ–è€…notifyAll() æ–¹æ³•ã€‚sleep() æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ä¼šâ¾ƒåŠ¨è‹é†’ã€‚</p></li></ul><h5 id="8-1-Threadç±»ä¸­çš„yieldæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ">8.1 <strong>Threadç±»ä¸­çš„yieldæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></h5><p><em>yield()</em> ä¹Ÿæ˜¯ <em>Thread</em> ç±»é™æ€æ–¹æ³•ï¼Œ<strong>ä½¿å½“å‰çº¿ç¨‹å˜ä¸º<u>å°±ç»ªçŠ¶æ€</u></strong> ï¼ˆ<em>sleep()</em> æ˜¯é˜»å¡ï¼‰ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ›´å¤šæœºä¼šè·å–CPUã€‚æ‰§è¡Œyield()çš„çº¿ç¨‹æœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°æš‚åœçŠ¶æ€åé©¬ä¸Šåˆè¢«æ‰§è¡Œã€‚</p><h5 id="8-2-java-ä¸­Waitã€Sleepå’ŒYieldæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ">8.2 <strong>java ä¸­Waitã€Sleepå’ŒYieldæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ</strong></h5><p><a href="https://www.jianshu.com/p/25e959037eed">https://www.jianshu.com/p/25e959037eed</a></p><h4 id="9-volatile-æ˜¯ä»€ä¹ˆ-å¯ä»¥ä¿è¯æœ‰åºæ€§å—">9. <strong>volatile æ˜¯ä»€ä¹ˆ?å¯ä»¥ä¿è¯æœ‰åºæ€§å—?</strong></h4><ol><li>ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„,volatileå…³é”®å­—ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ï¼›</li><li>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚</li></ol><p><strong>èƒ½ä¿è¯æœ‰åºæ€§</strong>ï¼Œå› ä¸ºç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</p><h4 id="10-ä¸ºä»€ä¹ˆwait-notify-å’Œ-notifyAllè¿™äº›æ–¹æ³•ä¸åœ¨threadç±»é‡Œé¢ï¼Ÿ">10. ä¸ºä»€ä¹ˆwait, notify å’Œ notifyAllè¿™äº›æ–¹æ³•ä¸åœ¨threadç±»é‡Œé¢ï¼Ÿ</h4><p><a href="https://www.zhihu.com/question/321674476">https://www.zhihu.com/question/321674476</a></p><p>æ˜æ˜¾çš„åŸå› æ˜¯<strong>JAVAæä¾›çš„é”æ˜¯å¯¹è±¡çº§çš„è€Œä¸æ˜¯çº¿ç¨‹çº§çš„</strong>ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰é”ï¼Œé€šè¿‡çº¿ç¨‹è·å¾—ã€‚å¦‚æœçº¿ç¨‹éœ€è¦ç­‰å¾…æŸäº›é”é‚£ä¹ˆè°ƒç”¨å¯¹è±¡ä¸­çš„wait()æ–¹æ³•å°±æœ‰æ„ä¹‰äº†ã€‚<u>å¦‚æœwait()æ–¹æ³•å®šä¹‰åœ¨Threadç±»ä¸­ï¼Œçº¿ç¨‹æ­£åœ¨ç­‰å¾…çš„æ˜¯å“ªä¸ªé”å°±ä¸æ˜æ˜¾äº†</u>ã€‚</p><ul><li>ç®€å•çš„è¯´ï¼Œç”±äºwaitï¼Œnotifyå’ŒnotifyAlléƒ½æ˜¯é”çº§åˆ«çš„æ“ä½œï¼Œæ‰€ä»¥æŠŠä»–ä»¬å®šä¹‰åœ¨Objectç±»ä¸­å› ä¸ºé”å±äºå¯¹è±¡ã€‚</li></ul><h4 id="11-ä¸ºä»€ä¹ˆwaitå’Œnotifyæ–¹æ³•è¦åœ¨åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ">11.<strong>ä¸ºä»€ä¹ˆwaitå’Œnotifyæ–¹æ³•è¦åœ¨åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ</strong></h4><ul><li><u>wait()æ–¹æ³•<strong>å¼ºåˆ¶å½“å‰çº¿ç¨‹é‡Šæ”¾å¯¹è±¡é”</strong></u>ã€‚è¿™æ„å‘³ç€åœ¨è°ƒç”¨æŸå¯¹è±¡çš„wait()æ–¹æ³•ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹å¿…é¡»å·²ç»è·å¾—è¯¥å¯¹è±¡çš„é”ã€‚å› æ­¤ï¼Œçº¿ç¨‹å¿…é¡»åœ¨æŸä¸ªå¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­æ‰èƒ½è°ƒç”¨è¯¥å¯¹è±¡çš„wait()æ–¹æ³•ï¼›</li><li>åœ¨è°ƒç”¨å¯¹è±¡çš„notify()å’ŒnotifyAll()æ–¹æ³•ä¹‹å‰ï¼Œ<u>è°ƒç”¨çº¿ç¨‹å¿…é¡»<strong>å·²ç»å¾—åˆ°è¯¥å¯¹è±¡çš„é”</strong></u>ã€‚å› æ­¤ï¼Œå¿…é¡»åœ¨æŸä¸ªå¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­æ‰èƒ½è°ƒç”¨è¯¥å¯¹è±¡çš„notify()æˆ–notifyAll()æ–¹æ³•ã€‚</li></ul><h4 id="12-ï¼ˆæ²¡ç»†çœ‹ï¼‰Javaä¸­interrupted-å’Œ-isInterrupteddæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ">12. ï¼ˆæ²¡ç»†çœ‹ï¼‰<strong>Javaä¸­interrupted å’Œ isInterrupteddæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ</strong></h4><p>interrupted() å’Œ isInterrupted()çš„ä¸»è¦åŒºåˆ«æ˜¯å‰è€…ä¼šå°†ä¸­æ–­çŠ¶æ€æ¸…é™¤è€Œåè€…ä¸ä¼šã€‚Javaå¤šçº¿ç¨‹çš„ä¸­æ–­æœºåˆ¶æ˜¯ç”¨å†…éƒ¨æ ‡è¯†æ¥å®ç°çš„ï¼Œè°ƒThread.interrupt()æ¥ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹å°±ä¼šè®¾ç½®ä¸­æ–­æ ‡è¯†ä¸ºtrueã€‚å½“ä¸­æ–­çº¿ç¨‹è°ƒç”¨é™æ€æ–¹æ³•Thread.interrupted()æ¥æ£€æŸ¥ä¸­æ–­çŠ¶æ€æ—¶ï¼Œä¸­æ–­çŠ¶æ€ä¼šè¢«æ¸…é›¶ã€‚è€Œéé™æ€æ–¹æ³•isInterrupted()ç”¨æ¥æŸ¥è¯¢å…¶å®ƒçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¸”ä¸ä¼šæ”¹å˜ä¸­æ–­çŠ¶æ€æ ‡è¯†ã€‚ç®€å•çš„è¯´å°±æ˜¯ä»»ä½•æŠ›å‡ºInterruptedExceptionå¼‚å¸¸çš„æ–¹æ³•ã€‚</p><h3 id="1-4-2-çº¿ç¨‹æ± ">1.4.2 çº¿ç¨‹æ± </h3><h4 id="1-è¯·ä½ è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼ˆthread-poolï¼‰ï¼Ÿ">1.<strong>è¯·ä½ è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼ˆthread poolï¼‰ï¼Ÿ</strong></h4><p>çº¿ç¨‹æ± é¡¾åæ€ä¹‰å°±æ˜¯äº‹å…ˆåˆ›å»ºè‹¥å¹²ä¸ªå¯æ‰§è¡Œçš„çº¿ç¨‹æ”¾å…¥ä¸€ä¸ªæ± ï¼ˆå®¹å™¨ï¼‰ä¸­ï¼Œéœ€è¦çš„æ—¶å€™ä»æ± ä¸­è·å–çº¿ç¨‹ä¸ç”¨è‡ªè¡Œåˆ›å»ºï¼Œ<u>ä½¿ç”¨å®Œæ¯•ä¸éœ€è¦é”€æ¯çº¿ç¨‹è€Œæ˜¯æ”¾å›æ± ä¸­ï¼Œä»è€Œå‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¯¹è±¡çš„å¼€é”€</u>ã€‚ é™¤æ­¤ä¹‹å¤–ï¼š</p><ul><li>æé«˜æ€§èƒ½ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å‹æ¦¨CPUç®—åŠ›ï¼›</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼Œé™åˆ¶çº¿ç¨‹æ•°é‡å¹¶å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚</li></ul><h5 id="1-1-è¯·ä»‹ç»ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"><strong>1.1 è¯·ä»‹ç»ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</strong></h5><p><strong>æ ¸å¿ƒå‚æ•°</strong>ï¼šå…¶ä¸­<code>corePool</code>æ˜¯æ ¸å¿ƒçº¿ç¨‹æ± ï¼ˆä¿æ´»çº¿ç¨‹ï¼‰ï¼Œ<code>maximumPool</code>æ˜¯æ€»çº¿ç¨‹æ± ï¼ˆä¿æ´»çº¿ç¨‹+å·¥ä½œçº¿ç¨‹ï¼‰ï¼Œ<code>blockQueue </code>æ˜¯ç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—ï¼Œ<code>rejectedExecutionHandler</code>æ˜¯æ‹’ç»ç­–ç•¥ï¼š</p><p><img src="https://i.loli.net/2021/04/19/Pn4wc5621hqIXpl.png" alt="image-20210419235537833" style="zoom: 33%;" /><img src="https://segmentfault.com/img/remote/1460000038860133" alt="iShot2021-01-03 20.18.23.png" style="zoom: 67%;" /></p><p><strong>æµç¨‹ï¼šcorePoolSizeâ†’é˜Ÿåˆ—â†’maximumPoolâ†’æ‹’ç»ç­–ç•¥</strong></p><ol><li>æœªè¾¾åˆ°corePoolSizeæ—¶ï¼Œæ ¸å¿ƒçº¿ç¨‹æ± ä¼šå¼€è¾Ÿæ–°çº¿ç¨‹è¿è¡Œä»»åŠ¡ï¼ˆ<u>å¯ä»¥ä½¿ç”¨å·²æœ‰çº¿ç¨‹å—ï¼Ÿ</u>ï¼‰ï¼Œ<strong>ä»»åŠ¡ç»“æŸåçº¿ç¨‹ä¸é”€æ¯</strong>ï¼›</li><li>è¾¾åˆ°corePoolSizeï¼Œè€Œä»»åŠ¡é˜Ÿåˆ—æœªæ»¡æ—¶ï¼Œæ–°ä»»åŠ¡æäº¤åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œ<strong>çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeæ—¶è¢«é”€æ¯ï¼›</strong></li><li>ä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œä½†æœªè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ–°å»ºå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼›</li><li>è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°æ—¶ï¼Œ<strong>æŒ‰æ‹’ç»ç­–ç•¥å¤„ç†</strong>ï¼ŒåŒ…æ‹¬ï¼š<u>æŠ›å‡ºå¼‚å¸¸ã€ä½¿ç”¨è°ƒç”¨è€…çº¿ç¨‹è¿è¡Œä»»åŠ¡ã€ä¸¢å¼ƒæ–°ä»»åŠ¡ã€ä¸¢å¼ƒé˜Ÿåˆ—å¤´ä»»åŠ¡</u>ç­‰ã€‚</li></ol><h5 id="1-2-çº¿ç¨‹æ± ä¼šå›æ”¶æ ¸å¿ƒçº¿ç¨‹å—ï¼Ÿ">1.2 çº¿ç¨‹æ± ä¼šå›æ”¶æ ¸å¿ƒçº¿ç¨‹å—ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000038836285">çº¿ç¨‹æ± æ˜¯æ€ä¹ˆå›æ”¶ç©ºé—²çº¿ç¨‹çš„</a></p></blockquote><p>ä¼šï¼Œå¯ä»¥é€šè¿‡allowCoreThreadTimeOutå‚æ•°æ¥è¿›è¡Œè®¾ç½®ã€‚</p><ul><li><p>å…ˆå›å¿†ä¸€ä¸‹æ•´ä½“çº¿ç¨‹æ± æµç¨‹</p><img src="https://segmentfault.com/img/remote/1460000038860133" alt="iShot2021-01-03 20.18.23.png" style="zoom:67%;" /></li><li><p><strong>excuteæ–¹æ³•</strong></p><p>æˆ‘ä»¬çš„ä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± åï¼Œæ˜¯ä»è°ƒç”¨executeæ‰§è¡Œå¼€å§‹çš„ã€‚<br><img src="https://i.loli.net/2021/05/26/hc4w6ZIbm57CpOQ.png" alt="image-20210526234652655" style="zoom: 67%;" /></p><ul><li><p>æ ¸å¿ƒæ˜¯addWorkeråŠæ³•ï¼Œ é‡Œé¢æœ€æœ€é‡è¦çš„å°±æ˜¯åˆå§‹åŒ–WorkeråŒæ—¶å¯åŠ¨threadã€‚</p></li><li><p>Workerå®ç°äº†Runnableæ¥å£ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹å®ƒçš„runæ–¹æ³•ï¼Œçœ‹æˆªå›¾çš„â‘¢å¤„æ ‡è®°ï¼ŒæŠ½ç¦»å‡ºæ¥ä¸€ä¸ªrunWorkeræ–¹æ³•ï¼š</p><p><img src="https://i.loli.net/2021/05/26/39woAvIR4QjNfxd.png" alt="iShot2021-01-03 20.39.22.png"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼šâ‘ å¤„æ˜¯ä¸€ä¸ªwhileå¾ªç¯ï¼Œ<strong>getTask</strong>æ–¹æ³•å°±æ˜¯ä»çº¿ç¨‹æ± é˜Ÿåˆ—å–ä»»åŠ¡ï¼Œ<strong>å¦‚æœå–ä¸åˆ°ä»»åŠ¡</strong>å°±ä¼šæ‰§è¡Œ</p><p>â€‹                   â‘¡<strong>ä¸€æ—¦è·³å‡ºwhileå¾ªç¯ï¼Œå³è¿›å…¥åˆ°processWorkExitæ–¹æ³•ï¼Œè¿™å°±æ˜¯å›æ”¶Worker</strong></p></li></ul></li><li><p><strong>getTaskæ–¹æ³•</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œâ‘ åˆ¤æ–­æ˜¯å¦å›æ”¶çº¿ç¨‹çš„æ¡ä»¶ï¼Œ<strong>timed</strong> ï¼Œæœ‰ä¸¤ç§æƒ…å†µè¦å›æ”¶çº¿ç¨‹ï¼š</p><ol><li><strong>wc&gt;corePoolSize</strong> ï¼Œå½“å‰çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°</li><li><strong>allowCoreThreadTimeOut</strong>ï¼Œæ ¸å¿ƒçº¿ç¨‹è¶…æ—¶ï¼Œæ‰€ä»¥<strong>æ ¸å¿ƒçº¿ç¨‹æ˜¯ä¼šè¢«å›æ”¶</strong>çš„</li></ol><p>ç„¶åâ‘¡å¤„å°±æ˜¯ä»ä»»åŠ¡é˜Ÿåˆ—å–ä»»åŠ¡äº†ï¼Œ<strong>å¸¦äº†timeOutå‚æ•°çš„pollæ–¹æ³•è¶…æ—¶</strong> ï¼Œæœªèƒ½ä»ä»»åŠ¡é˜Ÿåˆ—è·å–ä»»åŠ¡å³è¿”å›nullï¼Œä»è€Œå®ç°æœ€ç»ˆçš„<strong>çº¿ç¨‹å›æ”¶</strong>ã€‚</p><blockquote><p>ä¸æ˜¯processWorkExitå¤„ç†å—ï¼Œæ€ä¹ˆåœ¨getTaskå¤„ç†ï¼Œè¿˜æ˜¯å¾—å¥½å¥½çœ‹çœ‹ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/26/hxJerXAo16msf38.png" alt="image-20210526235850331"></p></li></ul><h4 id="2-è¯·ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Ÿ">2.<strong>è¯·ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Ÿ</strong></h4><p><img src="https://uploadfiles.nowcoder.com/images/20180925/308572_1537880635592_7142B8354CA8A352B2B805F997C71549" alt="img"></p><p>ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜æ˜¯çº¿ç¨‹æ¨¡å‹ä¸­çš„ç»å…¸é—®é¢˜ï¼š</p><ul><li>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åœ¨<strong>åŒä¸€æ—¶é—´æ®µå†…å…±ç”¨åŒä¸€å­˜å‚¨ç©ºé—´</strong>ï¼Œç”Ÿäº§è€…å‘ç©ºé—´é‡Œç”Ÿäº§æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…å–èµ°æ•°æ®ã€‚</li></ul><h4 id="3-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ">3.<strong>çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</strong></h4><p>ä¸»è¦æœ‰4ç§æ‹’ç»ç­–ç•¥ï¼š</p><ol><li>AbortPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥</li><li><strong>CallerRunsPolicy</strong>ï¼šåªç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡</li><li>DiscardOldestPolicyï¼š<strong>ä¸¢å¼ƒç­‰å¾…é˜Ÿåˆ—ä¸­æœ€æ—§</strong>çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡</li><li>DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸</li></ol><h4 id="4-å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆå››å¤§æ–¹æ³•ï¼‰ï¼Ÿç›¸å…³å‚æ•°ï¼ˆä¸ƒå¤§å‚æ•°ï¼‰æ˜¯ä»€ä¹ˆ">4.<strong>å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆå››å¤§æ–¹æ³•ï¼‰ï¼Ÿç›¸å…³å‚æ•°ï¼ˆä¸ƒå¤§å‚æ•°ï¼‰æ˜¯ä»€ä¹ˆ?</strong></h4><p>javaé€šè¿‡Executorsæä¾›<strong>å››å¤§æ–¹æ³•</strong>ï¼š</p><ol><li><strong>newCachedThreadPool</strong>ï¼šåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œ<strong>å¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹</strong>ï¼›</li><li><strong>newFixedThreadPool</strong>ï¼šåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œ<u>å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°</u>ï¼Œ<strong>è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨<u>é˜Ÿåˆ—ä¸­ç­‰å¾…</u></strong>ï¼›</li><li><strong>newScheduledThreadPool</strong>ï¼šåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œ<u>æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ</u>ï¼›</li><li><strong>newSingleThreadExecutor</strong>ï¼š åˆ›å»ºä¸€ä¸ª<u>å•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± </u>ï¼Œå®ƒåªä¼šç”¨<strong>å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹</strong>æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯<u>æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œ</u>ã€‚</li></ol><p><strong>ä¸ƒå¤§å‚æ•°è®¾ç½®</strong>ï¼š</p><ol><li><p><strong>corePoolSize</strong>ï¼šå½“ä½¿ç”¨äº†<code>LinkedBlockingQueue = new LinkedBlockQueue</code>çš„æ—¶å€™ï¼Œ<strong>é˜Ÿåˆ—é•¿åº¦é»˜è®¤æ— é™é•¿</strong>ï¼Œä¼šå¯¼è‡´çº¿ç¨‹æ•°é‡æ°¸è¿œç­‰äº<code>corePoolSize</code>ï¼Œä»»åŠ¡æ¿€å¢æ—¶ä»»åŠ¡å“åº”æ—¶é—´ä¹Ÿæ¿€å¢ï¼›</p></li><li><p><strong>maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹ä¸ªæ•°ï¼Œå¢åŠ çº¿ç¨‹çš„å…¬å¼ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>ä»»åŠ¡æ•°</mtext><mo>âˆ’</mo><mi>q</mi><mi>u</mi><mi>e</mi><mi>u</mi><mi>e</mi><mi>C</mi><mi>a</mi><mi>p</mi><mi>a</mi><mi>c</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">)</mo><mo>Ã—</mo><mo stretchy="false">(</mo><mtext>åŸçº¿ç¨‹æ•°</mtext><mo>Ã·</mo><mtext>åŸä»»åŠ¡æ•°</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(ä»»åŠ¡æ•°-queueCapacity) \times (åŸçº¿ç¨‹æ•° \div åŸä»»åŠ¡æ•°)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">ä»»åŠ¡æ•°</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">åŸçº¿ç¨‹æ•°</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã·</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">åŸä»»åŠ¡æ•°</span><span class="mclose">)</span></span></span></span>ï¼›</p></li><li><p><strong>keepAliveTime</strong>ï¼šçº¿ç¨‹æœ€å¤§ï¼ˆç©ºé—²ï¼‰å­˜æ´»æ—¶é—´ï¼›</p></li><li><p><strong>rejectedExecutionHandler</strong>ï¼šçº¿ç¨‹è¢«æ‹’ç»çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è‡ªå·±é‡å†™ï¼›</p></li><li><p><strong>workQueue</strong> ï¼š é˜»å¡é˜Ÿåˆ—ï¼›</p></li><li><p><strong>unit</strong>ï¼škeepAliveTimeçš„å•ä½ ï¼›</p></li><li><p><strong>threadFactory</strong>ï¼šè¡¨ç¤ºç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ä¸€èˆ¬é»˜è®¤å³å¯</p></li></ol><h4 id="5-çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°corePoolSizeæ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ">5.<strong>çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°corePoolSizeæ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ</strong></h4><p>åˆ†ä¸ºCPUå¯†é›†å‹å’ŒIOå¯†é›†å‹æ¥è€ƒè™‘ï¼š</p><ul><li><p><strong>CPUå¯†é›†å‹</strong>ã€‚è¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º <code>Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1</code>ã€‚</p><blockquote><p><u>æ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹</u> ï¼šæ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚</p></blockquote></li><li><p><strong>IOå¯†é›†å‹</strong>ã€‚è¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œ<strong>è€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†</strong>ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ ï¼š <code>æ ¸å¿ƒçº¿ç¨‹æ•°=CPUæ ¸å¿ƒæ•°é‡*2</code></p></li></ul><h4 id="6-ï¼ˆä¸ç†Ÿæ‚‰ï¼‰Javaçº¿ç¨‹æ± ä¸­é˜Ÿåˆ—å¸¸ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ">6.<strong>ï¼ˆä¸ç†Ÿæ‚‰ï¼‰Javaçº¿ç¨‹æ± ä¸­é˜Ÿåˆ—å¸¸ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ</strong></h4><ul><li><code>ArrayBlockingQueue</code> ï¼šæ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼›</li><li><code>LinkedBlockingQueue</code> :ä¸€ä¸ªåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFO ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ æ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸è¦é«˜äº ArrayBlockingQueue ï¼›</li><li><code>SynchronousQueue</code> : ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼›</li><li><code>PriorityBlockingQueue</code>ï¼š ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—ï¼ŒPriorityBlockingQueue ä¹Ÿæ˜¯åŸºäºæœ€å°äºŒå‰å †å®ç°ã€‚</li></ul><h4 id="7-æœ‰ä¸‰ä¸ªçº¿ç¨‹T1-T2-T3-å¦‚ä½•ä¿è¯é¡ºåºæ‰§è¡Œï¼Ÿ">7.<strong>æœ‰ä¸‰ä¸ªçº¿ç¨‹T1,T2,T3,å¦‚ä½•ä¿è¯é¡ºåºæ‰§è¡Œï¼Ÿ</strong></h4><p>å› ä¸ºåœ¨æ¯ä¸ªçº¿ç¨‹çš„runæ–¹æ³•ä¸­ç”¨join()æ–¹æ³•é™å®šäº†ä¸‰ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JoinTest2</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="comment">// 1.ç°åœ¨æœ‰T1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œä½ æ€æ ·ä¿è¯T2åœ¨T1æ‰§è¡Œå®Œåæ‰§è¡Œï¼ŒT3åœ¨T2æ‰§è¡Œå®Œåæ‰§è¡Œ</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">     </span>&#123;</span><br><span class="line">         <span class="keyword">final</span> Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() </span><br><span class="line">         &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">               </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="keyword">final</span> Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                  <span class="comment">// t2çº¿ç¨‹å†…runæ–¹æ³•æœ€å¼€å§‹ï¼Œå¼•ç”¨t1.joinï¼Œç­‰å¾…t1çº¿ç¨‹æ‰§è¡Œå®Œ</span></span><br><span class="line">                   t1.join();</span><br><span class="line">                 &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">                 &#125;</span><br><span class="line">                   System.out.println(<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// t3çº¿ç¨‹å†…runæ–¹æ³•æœ€å¼€å§‹ï¼Œå¼•ç”¨t2.joinï¼Œç­‰å¾…t2çº¿ç¨‹æ‰§è¡Œå®Œ</span></span><br><span class="line">                        t2.join();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e)</span><br><span class="line">                          &#123;</span><br><span class="line">                           e.printStackTrace();</span><br><span class="line">                          &#125;</span><br><span class="line">                         System.out.println(<span class="string">&quot;t3&quot;</span>);</span><br><span class="line">                         &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//è¿™é‡Œä¸‰ä¸ªçº¿ç¨‹çš„å¯åŠ¨é¡ºåºå¯ä»¥ä»»æ„ï¼Œå¤§å®¶å¯ä»¥è¯•ä¸‹ï¼</span></span><br><span class="line">         t3.start();</span><br><span class="line">         t2.start();</span><br><span class="line">         t1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-3-å¤šçº¿ç¨‹">1.4.3 å¤šçº¿ç¨‹</h3><h4 id="1-è¯·ç®€è¿°ä¸€ä¸‹å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼Ÿ-ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿä½¿ç”¨å¤šçº¿ç¨‹ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ">1.<strong>è¯·ç®€è¿°ä¸€ä¸‹å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼Ÿ</strong> ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿä½¿ç”¨å¤šçº¿ç¨‹ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><ul><li><p><strong>åŒæ­¥æ–¹æ³•</strong>ï¼šå¯ä»¥ä½¿ç”¨synchronizedã€lockã€volatileå’ŒThreadLocalæ¥å®ç°åŒæ­¥ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</strong></p><ul><li>å‡å°‘<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</strong>ï¼ˆå…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒº ï¼Œæ³¨æ„ï¼Œå‡å°‘â‰ æ²¡æœ‰ï¼‰</li><li>åˆ©ç”¨å¥½å¤šçº¿ç¨‹æœºåˆ¶å¯ä»¥å¤§å¤§æ<strong>é«˜ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘èƒ½â¼’</strong>ä»¥åŠæ€§èƒ½</li><li><strong>å¤šæ ¸æ—¶ä»£</strong> ï¼šå¤šæ ¸æ—¶ä»£å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ CPU åˆ©ç”¨ç‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘ä»¬è¦è®¡ç®—â¼€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬åªç”¨â¼€ä¸ªçº¿ç¨‹çš„è¯ï¼ŒCPU <strong>åªä¼šâ¼€ä¸ª CPU æ ¸â¼¼</strong>è¢«åˆ©ç”¨åˆ°ï¼Œè€Œåˆ›å»ºå¤šä¸ªçº¿ç¨‹å°±å¯ä»¥è®©å¤šä¸ª CPU æ ¸â¼¼è¢«åˆ©ç”¨åˆ°ï¼Œè¿™æ ·å°±æé«˜äº† CPU çš„åˆ©ç”¨ç‡ã€‚</li></ul></li><li><p><strong>å¸¦æ¥çš„é—®é¢˜ï¼Ÿ</strong></p><ul><li><u>å†…å­˜æ³„æ¼ã€ä¸Šä¸‹â½‚åˆ‡æ¢ã€æ­»é”</u>è¿˜æœ‰å—é™äºç¡¬ä»¶å’Œè½¯ä»¶çš„èµ„æºé—²ç½®é—®é¢˜ã€‚</li></ul></li></ul><h4 id="2-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ">2. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><blockquote><p>å¥½æ–‡ï¼š<a href="https://zhuanlan.zhihu.com/p/94762520">ä¸€æ–‡ææ‡‚CAS</a></p></blockquote><ul><li><p><strong>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></p><p>å¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚<u>å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„</u>ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></li><li><p><strong>å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></p><ol><li><strong>ä½¿ç”¨ synchronized å…³é”®å­—</strong> ã€‚å¼€é”€æ¯”è¾ƒå¤§</li><li><strong>ä½¿ç”¨Lock é”</strong> ã€‚é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ Lock é”è¦æ¯”ä½¿ç”¨synchronized å…³é”®å­—ï¼Œåœ¨æ€§èƒ½ä¸Šå¾—åˆ°æå¤§çš„æé«˜ã€‚å› ä¸º Lock åº•å±‚æ˜¯é€šè¿‡ AQS + CAS æœºåˆ¶æ¥å®ç°çš„ã€‚</li><li><strong>ä½¿ç”¨ Atomic åŸå­ç±»</strong> ã€‚ä½¿ç”¨ Lock æ–¹å¼ï¼Œä¸€æ—¦ unlock() æ–¹æ³•ä½¿ç”¨ä¸è§„èŒƒï¼Œå¯èƒ½å¯¼è‡´æ­»é”ã€‚ Atomic åŸå­ç±»ï¼Œå› ä¸ºå…¶åº•å±‚åŸºäº CAS ä¹è§‚é”æ¥å®ç°çš„ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</li><li><strong>ä½¿ç”¨Volatileï¼Ÿä¸å¯è¡Œï¼</strong> å› ä¸ºæ— æ³•ä¿è¯åŸå­æ€§ã€‚</li></ol></li></ul><h4 id="3-çº¿ç¨‹å®‰å…¨éœ€è¦ä¿è¯å‡ ä¸ªåŸºæœ¬ç‰¹å¾ï¼Ÿ">3.<strong>çº¿ç¨‹å®‰å…¨éœ€è¦ä¿è¯å‡ ä¸ªåŸºæœ¬ç‰¹å¾ï¼Ÿ</strong></h4><ul><li><strong>åŸå­æ€§</strong>ï¼Œç®€å•è¯´å°±æ˜¯ç›¸å…³æ“ä½œä¸ä¼šä¸­é€”è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œä¸€èˆ¬é€šè¿‡åŒæ­¥æœºåˆ¶å®ç°ã€‚</li><li><strong>å¯è§æ€§</strong>ï¼Œæ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡ï¼Œå…¶çŠ¶æ€èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çŸ¥æ™“ï¼Œé€šå¸¸è¢«è§£é‡Šä¸ºå°†<br>çº¿ç¨‹æœ¬åœ°çŠ¶æ€åæ˜ åˆ°ä¸»å†…å­˜ä¸Šï¼Œvolatile å°±æ˜¯è´Ÿè´£ä¿è¯å¯è§æ€§çš„ã€‚</li><li><strong>æœ‰åºæ€§</strong>ï¼Œæ˜¯ä¿è¯çº¿ç¨‹å†…ä¸²è¡Œè¯­ä¹‰ï¼Œé¿å…æŒ‡ä»¤é‡æ’ç­‰ã€‚</li></ul><h4 id="4-ã€å¾…è¡¥å……ã€‘å¦‚ä½•åœ¨çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Ÿ">4. ã€å¾…è¡¥å……ã€‘<strong>å¦‚ä½•åœ¨çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Ÿ</strong></h4><p>å¯ä»¥ä½¿ç”¨åŠ é”ï¼Œæ¯”å¦‚synchronizedæˆ–è€…lockã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ConcurrentåŒ…ä¸‹çš„åŸå­ç±»ã€‚</p><h4 id="5-å¤šçº¿ç¨‹ä¸­çš„i-çº¿ç¨‹å®‰å…¨å—ï¼Ÿè¯·ç®€è¿°ä¸€ä¸‹åŸå› ï¼Ÿ">5.<strong>å¤šçº¿ç¨‹ä¸­çš„i++çº¿ç¨‹å®‰å…¨å—ï¼Ÿè¯·ç®€è¿°ä¸€ä¸‹åŸå› ï¼Ÿ</strong></h4><p>ä¸å®‰å…¨ï¼Œå› ä¸º<strong>i++ä¸æ˜¯åŸå­æ€§æ“ä½œ</strong>ã€‚i++åˆ†ä¸ºè¯»å–iå€¼ï¼Œå¯¹iå€¼åŠ ä¸€ï¼Œå†èµ‹å€¼ç»™i++ï¼Œæ‰§è¡ŒæœŸä¸­ä»»ä½•ä¸€æ­¥éƒ½æ˜¯æœ‰å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æŠ¢å çš„ã€‚</p><h4 id="6-ä»‹ç»ä¸€ä¸‹ThreadLocalåŸç†ï¼Ÿ">6.<strong>ä»‹ç»ä¸€ä¸‹ThreadLocalåŸç†ï¼Ÿ</strong></h4><blockquote><p>ä¸€ç¯‡è®²çš„ä¸é”™çš„æ–‡ç« ï¼š<a href="https://www.cnblogs.com/wupeixuan/p/12638203.html">https://www.cnblogs.com/wupeixuan/p/12638203.html</a></p></blockquote><p>å½“å¤šçº¿ç¨‹è®¿é—®å…±äº«å¯å˜æ•°æ®æ—¶ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹é—´åŒæ­¥çš„é—®é¢˜ï¼Œ<u><strong>å¹¶ä¸æ˜¯</strong>æ‰€æœ‰æ—¶å€™ï¼Œéƒ½è¦ç”¨åˆ°å…±äº«æ•°æ®</u>ï¼Œæ‰€ä»¥å°±éœ€è¦çº¿ç¨‹å°é—­å‡ºåœºäº†ã€‚<strong>æ•°æ®éƒ½è¢«å°é—­åœ¨å„è‡ªçš„çº¿ç¨‹ä¹‹ä¸­</strong>ï¼Œå°±ä¸éœ€è¦åŒæ­¥ï¼Œè¿™ç§é€šè¿‡å°†æ•°æ®å°é—­åœ¨çº¿ç¨‹ä¸­è€Œé¿å…ä½¿ç”¨åŒæ­¥çš„æŠ€æœ¯ç§°ä¸º<strong>çº¿ç¨‹å°é—­</strong>ã€‚</p><p>ThreadLocal æ˜¯ Java é‡Œä¸€ç§ç‰¹æ®Šå˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹çº§åˆ«å˜é‡ï¼Œ<u>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª ThreadLocal å°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„ä¸€ä¸ªå˜é‡</u>ï¼Œç«æ€æ¡ä»¶è¢«å½»åº•æ¶ˆé™¤äº†ï¼Œåœ¨å¹¶å‘æ¨¡å¼ä¸‹æ˜¯ç»å¯¹å®‰å…¨çš„å˜é‡ã€‚</p><ul><li><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p><p>åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼ŒTreadLocal åšåˆ°å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å¯¹è±¡ set æ“ä½œï¼Œä½†æ˜¯ get è·å–çš„å€¼è¿˜éƒ½æ˜¯æ¯ä¸ªçº¿ç¨‹ set çš„å€¼ï¼Œä½“ç°äº†çº¿ç¨‹çš„å°é—­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ThreadLocalå˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; THREAD_LOCAL = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ThreadLocalDemo().threadLocalTest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadLocalTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹è®¾ç½®å€¼</span></span><br><span class="line">        THREAD_LOCAL.set(<span class="string">&quot;wupx&quot;</span>);</span><br><span class="line">        String v = THREAD_LOCAL.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹å‰ï¼Œ&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot;</span> + v);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                String v = THREAD_LOCAL.get();</span><br><span class="line">                <span class="comment">// æ­¤æ—¶æ–°å»ºçº¿ç¨‹Thread-0å–åˆ°çš„æ˜¯nullï¼Œæ„å‘³ç€ä¸åŒçº¿ç¨‹å–åˆ°çš„å€¼ä¸åŒçš„</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot;</span> + v);</span><br><span class="line">                <span class="comment">// è®¾ç½® threadLocal</span></span><br><span class="line">                THREAD_LOCAL.set(<span class="string">&quot;huxy&quot;</span>);</span><br><span class="line">                v = THREAD_LOCAL.get();</span><br><span class="line">                System.out.println(<span class="string">&quot;é‡æ–°è®¾ç½®ä¹‹åï¼Œ&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ä¸ºï¼š&quot;</span> + v);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç»“æŸ</span></span><br><span class="line">        Thread.sleep(<span class="number">3000L</span>);</span><br><span class="line">        v = THREAD_LOCAL.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹åï¼Œ&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot;</span> + v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  è¾“å‡ºç»“æœ */</span></span><br><span class="line"><span class="comment">// è™½ç„¶Thread-0å·²ç»æ”¹å˜äº†å€¼ï¼Œä½†æ˜¯mainå–åˆ°çš„å€¼ä¾æ—§æ˜¯ä¸€æ ·çš„ã€‚</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹å‰ï¼Œmainçº¿ç¨‹å–åˆ°çš„å€¼ï¼šwupx</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹å–åˆ°çš„å€¼ï¼šnull</span></span><br><span class="line"><span class="comment">é‡æ–°è®¾ç½®ä¹‹åThread-0çº¿ç¨‹å–åˆ°çš„å€¼ä¸ºï¼šhuxy</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹æ‰§è¡Œç»“æŸ</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹åï¼Œmainçº¿ç¨‹å–åˆ°çš„å€¼ï¼šwupx</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ThreadLocalåŸç†</strong></p><p>ThreadLocalæœ‰ä¸€ä¸ª<strong>é™æ€å†…éƒ¨ç±»ThreadLocalMapï¼ŒThreadLocalMapåˆåŒ…å«äº†ä¸€ä¸ªEntryæ•°ç»„</strong>ï¼ŒEntryæœ¬èº«æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œä»–çš„keyæ˜¯æŒ‡å‘ThreadLocalçš„å¼±å¼•ç”¨ï¼ŒEntryå…·å¤‡äº†ä¿å­˜key valueé”®å€¼å¯¹çš„èƒ½åŠ›ã€‚</p><p><img src="https://i.loli.net/2021/05/16/MXKyQxYDjWdOku2.png" alt="image-20210516142348550"></p><ul><li><p><strong>ThreadLocalMap</strong></p><blockquote><p>ThreadLocalMap æ˜¯ ThreadLocal çš„é™æ€å†…éƒ¨ç±»ï¼Œå½“ä¸€ä¸ª<strong>çº¿ç¨‹æœ‰å¤šä¸ª ThreadLocal å¯¹è±¡æ—¶</strong>æ—¶ï¼Œéœ€è¦ä¸€ä¸ªå®¹å™¨æ¥ç®¡ç†å¤š ThreadLocalï¼ŒThreadLocalMap çš„ä½œç”¨å°±æ˜¯ç®¡ç†çº¿ç¨‹ä¸­å¤šä¸ª ThreadLocalã€‚</p></blockquote><p>ä»æºç ä¸­çœ‹åˆ° ThreadLocalMap å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„ Map ç»“æ„ï¼Œåº•å±‚æ˜¯æ•°ç»„ï¼Œæœ‰åˆå§‹åŒ–å¤§å°ï¼Œä¹Ÿæœ‰æ‰©å®¹é˜ˆå€¼å¤§å°ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯ Entryï¼Œ<strong>Entry çš„ key å°±æ˜¯ ThreadLocal çš„å¼•ç”¨ï¼Œvalue æ˜¯ ThreadLocal çš„å€¼</strong>ã€‚ThreadLocalMap è§£å†³ hash å†²çªçš„æ–¹å¼é‡‡ç”¨çš„æ˜¯<strong>çº¿æ€§æ¢æµ‹æ³•</strong>ï¼Œå¦‚æœå‘ç”Ÿå†²çªä¼šç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„ä½ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalMap</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é”®å€¼å¯¹å®ä½“çš„å­˜å‚¨ç»“æ„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line"><span class="comment">// å½“å‰çº¿ç¨‹å…³è”çš„ valueï¼Œè¿™ä¸ª value å¹¶æ²¡æœ‰ç”¨å¼±å¼•ç”¨è¿½è¸ª</span></span><br><span class="line">Object value;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„é€ é”®å€¼å¯¹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> k k ä½œ key,ä½œä¸º key çš„ ThreadLocal ä¼šè¢«åŒ…è£…ä¸ºä¸€ä¸ªå¼±å¼•ç”¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> v v ä½œ value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line"><span class="keyword">super</span>(k);</span><br><span class="line">value = v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹å®¹é‡ï¼Œå¿…é¡»ä¸º 2 çš„å¹‚</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨ ThreadLocal çš„é”®å€¼å¯¹å®ä½“æ•°ç»„ï¼Œé•¿åº¦å¿…é¡»ä¸º 2 çš„å¹‚</span></span><br><span class="line"><span class="keyword">private</span> Entry[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ThreadLocalMap å…ƒç´ æ•°é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å®¹çš„é˜ˆå€¼ï¼Œé»˜è®¤æ˜¯æ•°ç»„å¤§å°çš„ä¸‰åˆ†ä¹‹äºŒ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> threshold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Setæ–¹æ³•</strong></p><blockquote><p>è°ƒç”¨ ThreadLocalå¯¹è±¡.set(value)ï¼Œå®é™…åœ¨è°ƒç”¨å½“å‰çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡.set(this,value) ï¼Œä¼šæŠŠå½“å‰ <code>threadLocal</code> å¯¹è±¡ä½œä¸º keyï¼Œæƒ³è¦ä¿å­˜çš„å¯¹è±¡ä½œä¸º valueï¼Œå­˜å…¥ mapã€‚</p></blockquote><p>set æ–¹æ³•çš„æµç¨‹ä¸»è¦æ˜¯ï¼š</p><ul><li>å…ˆè·å–åˆ°å½“å‰çº¿ç¨‹çš„å¼•ç”¨</li><li>åˆ©ç”¨è¿™ä¸ªå¼•ç”¨æ¥è·è¿”å›å½“å‰çº¿ç¨‹åˆ° ThreadLocalMap</li><li>å¦‚æœ map ä¸ºç©ºï¼Œåˆ™å»åˆ›å»ºä¸€ä¸ª ThreadLocalMap</li><li>å¦‚æœ map ä¸ä¸ºç©ºï¼Œå°±åˆ©ç”¨ ThreadLocalMap çš„ <code>set (thiså½“å‰å¯¹è±¡ï¼Œvalue)</code> æ·»åŠ é”®å€¼å¯¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸ºå½“å‰ ThreadLocal å¯¹è±¡å…³è” value å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value è¦å­˜å‚¨åœ¨æ­¤çº¿ç¨‹çš„çº¿ç¨‹å‰¯æœ¬çš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line"><span class="comment">// è¿”å›å½“å‰ThreadLocalæ‰€åœ¨çš„çº¿ç¨‹</span></span><br><span class="line">Thread t = Thread.currentThread();</span><br><span class="line"><span class="comment">// è¿”å›å½“å‰çº¿ç¨‹æŒæœ‰çš„map</span></span><br><span class="line">ThreadLocalMap map = getMap(t);</span><br><span class="line"><span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœ ThreadLocalMap ä¸ä¸ºç©ºï¼Œåˆ™ç›´æ¥å­˜å‚¨&lt;ThreadLocal, T&gt;é”®å€¼å¯¹</span></span><br><span class="line">        <span class="comment">// æ­¤æ—¶thisæ˜¯ThreadLocalå¯¹è±¡ï¼Œè¿™æ˜¯åœ¨ThreadLocalç±»ä¸­</span></span><br><span class="line">map.set(<span class="keyword">this</span>, value);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// å¦åˆ™ï¼Œéœ€è¦ä¸ºå½“å‰çº¿ç¨‹åˆå§‹åŒ– ThreadLocalMapï¼Œå¹¶å­˜å‚¨é”®å€¼å¯¹ &lt;this, firstValue&gt;</span></span><br><span class="line">createMap(t, value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰çº¿ç¨‹ thread æŒæœ‰çš„ ThreadLocalMapå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Getæ–¹æ³•</strong></p><blockquote><p>è°ƒç”¨ThreadLocalå¯¹è±¡.get() æ–¹å¼æ—¶ï¼Œå®é™…åœ¨è°ƒç”¨ThreadLocalMapå¯¹è±¡.getEntry(this) æ–¹æ³•ã€‚thisæ˜¯å½“å‰ThreadLocalå¯¹è±¡ã€‚</p></blockquote><p>get æ–¹æ³•çš„ä¸»è¦æµç¨‹ä¸ºï¼š</p><ul><li>å…ˆè·å–åˆ°å½“å‰çº¿ç¨‹çš„å¼•ç”¨</li><li>è·å–å½“å‰çº¿ç¨‹å†…éƒ¨çš„ ThreadLocalMapå¯¹è±¡</li><li>å¦‚æœ map å­˜åœ¨ï¼Œåˆ™è·å–å½“å‰ ThreadLocal å¯¹åº”çš„ value å€¼</li><li>å¦‚æœ map ä¸å­˜åœ¨æˆ–è€…æ‰¾ä¸åˆ° value å€¼ï¼Œåˆ™è°ƒç”¨ setInitialValue() è¿›è¡Œåˆå§‹åŒ–</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰ ThreadLocal å¯¹è±¡å…³è”çš„å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// è¿”å›å½“å‰ ThreadLocal æ‰€åœ¨çš„çº¿ç¨‹</span></span><br><span class="line">Thread t = Thread.currentThread();</span><br><span class="line"><span class="comment">// ä»çº¿ç¨‹ä¸­æ‹¿åˆ° ThreadLocalMap</span></span><br><span class="line">ThreadLocalMap map = getMap(t);</span><br><span class="line"><span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">// ä» map ä¸­æ‹¿åˆ° entry</span></span><br><span class="line">ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">// å¦‚æœä¸ä¸ºç©ºï¼Œè¯»å–å½“å‰ ThreadLocal ä¸­ä¿å­˜çš„å€¼</span></span><br><span class="line"><span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">T result = (T) e.value;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è‹¥ map ä¸ºç©ºï¼Œåˆ™å¯¹å½“å‰çº¿ç¨‹çš„ ThreadLocal è¿›è¡Œåˆå§‹åŒ–ï¼Œæœ€åè¿”å›å½“å‰çš„ ThreadLocal å¯¹è±¡å…³è”çš„åˆå€¼ï¼Œå³ value</span></span><br><span class="line"><span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>resize æ–¹æ³•</strong></p><p>å½“å‰çº¿ç¨‹çš„ ThreadLocalMap ä¸­çš„ ThreadLocal çš„ä¸ªæ•°è¶…è¿‡å®¹é‡é˜ˆå€¼æ—¶ï¼ŒThreadLocalMap å°±è¦å¼€å§‹æ‰©å®¹äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç•¥</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="7-ä¸ºä»€ä¹ˆThreadLocalé€ æˆå†…å­˜æ³„æ¼ï¼Ÿ">7.<strong>ä¸ºä»€ä¹ˆ<code>ThreadLocal</code>é€ æˆå†…å­˜æ³„æ¼ï¼Ÿ</strong></h4><p>ThreadLocalMap æ˜¯ ThreadLocal çš„é™æ€å†…éƒ¨ç±»ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æœ‰å¤š ä¸ªThreadLocal æ—¶ï¼Œéœ€è¦ä¸€ä¸ªå®¹å™¨æ¥ç®¡ç†å¤šä¸ª ThreadLocalï¼ŒThreadLocalMap çš„ä½œç”¨å°±æ˜¯ç®¡ç†çº¿ç¨‹ä¸­å¤šä¸ª ThreadLocalã€‚</p><blockquote><p>æºç ä¸­çœ‹åˆ° ThreadLocalMap å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„ Map ç»“æ„ï¼š</p><p>åº•å±‚æ˜¯æ•°ç»„<code>Entry[] table</code>ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯ Entryç±»ï¼š<strong>Entry çš„ä¸¤ä¸ªå±æ€§ï¼Œ key æ˜¯ ThreadLocalç±»å‹çš„å¼•ç”¨ï¼Œvalue æ˜¯ ThreadLocal çš„å€¼</strong>ã€‚</p></blockquote><ul><li><strong>åŸå› </strong>ï¼š<code>ThreadLocalMap</code>çš„keyä¸º<strong>å¼±å¼•ç”¨</strong>ï¼ˆæœ‰ç”¨ä½†éå¿…éœ€ï¼Œä¸‹ä¸€æ¬¡GCä¼šè¢«å›æ”¶ï¼‰ï¼Œvalueä¸º<strong>å¼ºå¼•ç”¨</strong>ï¼ˆGCè¿‡ç¨‹ä¸ä¼šè¢«å›æ”¶ï¼‰ï¼Œ<u>æœ‰å¯èƒ½é€ æˆkeyè¢«GCï¼Œvalueæ²¡è¢«G</u>Cï¼Œ<code>ThreadLocalMap</code>ä¸­å‡ºç°<code>null</code>ä¸ºkeyçš„<code>Entry</code>ï¼Œäº§ç”Ÿ<u>å†…å­˜æ³„æ¼</u>ï¼ˆ<strong>è½¯å¼•ç”¨</strong>ï¼šæœ‰ç”¨ä½†éå¿…éœ€ï¼Œå†…å­˜æº¢å‡ºä¹‹å‰è¢«å›æ”¶ï¼‰ï¼›</li><li><strong>è§£å†³</strong>ï¼š è°ƒç”¨<code>set()</code>ã€<code>get()</code>å’Œ<code>remove()</code>æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨æ¸…ç†æ‰keyä¸º<code>null</code>çš„è®°å½•ï¼Œä½†ä½¿ç”¨<code>ThreadLocal</code>æ–¹æ³•å<strong>æ‰‹åŠ¨<code>remove()</code></strong>ã€‚</li></ul><h4 id="8-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ">8.<strong>ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</strong></h4><p><u>ä¸€ä¸ªçº¿ç¨‹<strong>è®©å‡ºå¤„ç†å™¨ä½¿ç”¨æƒ</strong>ï¼Œå°±æ˜¯â€œåˆ‡å‡ºâ€ï¼›å¦å¤–ä¸€ä¸ªçº¿ç¨‹è·å–å¤„ç†å™¨ä½¿ç”¨æƒï¼Œå°±æ˜¯â€œåˆ‡å…¥â€ã€‚</u>åœ¨è¿™ä¸ªåˆ‡å…¥åˆ‡å‡ºçš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šä¿å­˜å’Œæ¢å¤ç›¸å…³çš„è¿›åº¦ä¿¡æ¯ï¼Œè¿™ä¸ªè¿›åº¦ä¿¡æ¯å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€œä¸Šä¸‹æ–‡â€ï¼Œä¸Šä¸‹æ–‡ä¸­ä¸€èˆ¬åŒ…å«äº†å¯„å­˜å™¨çš„å­˜å‚¨å†…å®¹ä»¥åŠç¨‹åºè®¡æ•°å™¨å­˜å‚¨çš„æŒ‡ä»¤å†…å®¹ã€‚</p><h4 id="9-è¯·é—®ä»€ä¹ˆæ˜¯æ­»é”-deadlock">9.<strong>è¯·é—®ä»€ä¹ˆæ˜¯æ­»é”(deadlock)?</strong></h4><p>æ­»é”æ˜¯æŒ‡<u>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡</u>ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç§°ä¸ºæ­»é”è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ã€‚</p><h4 id="10-JAVAä¸­å¦‚ä½•ç¡®ä¿Nä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®Nä¸ªèµ„æºï¼Œä½†åŒæ—¶åˆä¸å¯¼è‡´æ­»é”ï¼Ÿ">10. <strong>JAVAä¸­å¦‚ä½•ç¡®ä¿Nä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®Nä¸ªèµ„æºï¼Œä½†åŒæ—¶åˆä¸å¯¼è‡´æ­»é”ï¼Ÿ</strong></h4><p><u>æœ€ç®€å•æ–¹æ³•ï¼š<strong>æŒ‡å®šè·å–é”çš„é¡ºåºï¼Œå¹¶å¼ºåˆ¶çº¿ç¨‹æŒ‰ç…§æŒ‡å®šçš„é¡ºåºè·å–é”</strong>ã€‚</u></p><p>å› æ­¤ï¼Œå¦‚æœæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯ä»¥åŒæ ·çš„é¡ºåºåŠ é”å’Œé‡Šæ”¾é”ï¼Œå°±ä¸ä¼šå‡ºç°æ­»é”äº†ã€‚æˆ–è€…é€šè¿‡ç ´åæ­»é”çš„å››ä¸ªæ¡ä»¶ï¼š</p><ul><li><strong>äº’æ–¥</strong> ï¼š ä¸å¯èƒ½ç ´åã€‚</li><li><strong>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶</strong>ï¼šè¿›ç¨‹å¿…é¡» <u>ç­‰æ‰€æœ‰è¦è¯·æ±‚çš„èµ„æºéƒ½ç©ºé—²æ—¶æ‰èƒ½ç”³è¯·èµ„æº</u>ï¼Œ è¿™ç§æ–¹æ³•ä¼šä½¿<strong>èµ„æºæµªè´¹ä¸¥é‡</strong> ã€‚å…è®¸è¿›ç¨‹è·å–åˆæœŸæ‰€éœ€èµ„æºåï¼Œä¾¿å¼€å§‹è¿è¡Œï¼Œè¿è¡Œè¿‡ç¨‹ä¸­å†é€æ­¥é‡Šæ”¾è‡ªå·±å æœ‰çš„èµ„æºã€‚</li><li><strong>ç ´åä¸å¯æŠ¢å æ¡ä»¶</strong>ï¼š æ–¹æ³•ä»£ä»·å¤§ï¼Œå®ç°å¤æ‚ã€‚</li><li><strong>ç ´åå¾ªåç­‰å¾…æ¡ä»¶</strong> ï¼šå¯¹å„è¿›ç¨‹è¯·æ±‚èµ„æºçš„é¡ºåºåšä¸€ä¸ªè§„å®šï¼Œé¿å…ç›¸äº’ç­‰å¾…ã€‚è¿™ç§æ–¹æ³•å¯¹<u>èµ„æºçš„åˆ©ç”¨ç‡æ¯”å‰ä¸¤ç§éƒ½é«˜</u>ï¼Œä½†æ˜¯å‰æœŸè¦ä¸ºè®¾å¤‡æŒ‡å®šåºå·ï¼Œæ–°è®¾å¤‡åŠ å…¥ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå…¶æ¬¡å¯¹ç”¨æˆ·ç¼–ç¨‹ä¹Ÿæœ‰é™åˆ¶ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> æ ¡æ‹› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é›†åˆ</title>
      <link href="/p/21069/"/>
      <url>/p/21069/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h2 id="1-3-é›†åˆ">1.3 é›†åˆ</h2><h3 id="1-3-1-é›†åˆç±»">1.3.1 é›†åˆç±»</h3><h4 id="1-è¯·è¯´æ˜Javaé›†åˆç±»æ¡†æ¶çš„åŸºæœ¬æ¥å£æœ‰å“ªäº›ï¼Ÿ">1.<strong>è¯·è¯´æ˜Javaé›†åˆç±»æ¡†æ¶çš„åŸºæœ¬æ¥å£æœ‰å“ªäº›</strong>ï¼Ÿ</h4><ul><li><code>Collection</code>ï¼šä»£è¡¨ä¸€ç»„å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ˜¯å®ƒçš„å­å…ƒç´ ã€‚</li><li><code>Set</code>ï¼šä¸åŒ…å«é‡å¤å…ƒç´ çš„Collectionã€‚</li><li><code>List</code>ï¼šæœ‰é¡ºåºçš„collectionï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«é‡å¤å…ƒç´ ã€‚</li><li><code>Map</code>ï¼šå¯ä»¥æŠŠé”®(key)æ˜ å°„åˆ°å€¼(value)çš„å¯¹è±¡ï¼Œé”®ä¸èƒ½é‡å¤ã€‚</li></ul><h4 id="2-ï¼ˆè¡¥å……ï¼šä¸¾ä¾‹è¯´æ˜ï¼‰è¯´è¯´ä»€ä¹ˆæ˜¯fail-fastï¼Ÿ">2.<strong>ï¼ˆè¡¥å……ï¼šä¸¾ä¾‹è¯´æ˜ï¼‰è¯´è¯´ä»€ä¹ˆæ˜¯fail-fastï¼Ÿ</strong></h4><p>fail-fast æœºåˆ¶æ˜¯ Java é›†åˆï¼ˆCollectionï¼‰ä¸­çš„ä¸€ç§é”™è¯¯<strong>å¿«é€Ÿåé¦ˆ</strong>æœºåˆ¶ã€‚å½“<strong>å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªé›†åˆçš„å†…å®¹è¿›è¡Œæ“ä½œæ—¶</strong>ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿ fail-fast äº‹ä»¶ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼šå½“æŸä¸€ä¸ªçº¿ç¨‹ A é€šè¿‡ iterator å»éå†æŸé›†åˆçš„è¿‡ç¨‹ä¸­ï¼Œ<strong>è‹¥è¯¥é›†åˆçš„å†…å®¹è¢«å…¶ä»–çº¿ç¨‹æ‰€æ”¹å˜äº†ï¼Œé‚£ä¹ˆçº¿ç¨‹ A è®¿é—®é›†åˆæ—¶ï¼Œå°±ä¼šæŠ›å‡º ConcurrentModifificationException å¼‚å¸¸</strong>ï¼Œäº§ç”Ÿ fail-fast äº‹ä»¶ã€‚è¿™é‡Œçš„æ“ä½œä¸»è¦æ˜¯æŒ‡ addã€remove å’Œ clearï¼Œå¯¹é›†åˆå…ƒç´ ä¸ªæ•°è¿›è¡Œä¿®æ”¹ã€‚</p></blockquote><h4 id="3-è¯·è¯´æ˜Listã€Mapã€Setä¸‰ä¸ªæ¥å£åŒºåˆ†ï¼Ÿ">3.<strong>è¯·è¯´æ˜Listã€Mapã€Setä¸‰ä¸ªæ¥å£åŒºåˆ†</strong>ï¼Ÿ</h4><ul><li><strong>é‡å¤å…ƒç´ </strong>ï¼šListä»¥ç‰¹å®šç´¢å¼•æ¥å­˜å–å…ƒç´ ï¼Œå¯ä»¥æœ‰é‡å¤å…ƒç´ ï¼›Mapä»¥é”®å€¼å¯¹æ˜ å°„ï¼Œä¸èƒ½æœ‰é‡å¤keyï¼›Setå…ƒç´ ä¸èƒ½é‡å¤</li><li><strong>ç»§æ‰¿collection</strong>ï¼š Listã€Setç»§æ‰¿äºcollectionï¼›Mapå’Œå‰äºŒè€…æ˜æ˜¾åŒºåˆ†ï¼Œä¸ç»§æ‰¿collection</li><li><strong>å®ç°æ–¹å¼</strong>ï¼š Listæ˜¯çº¿æ€§ç»“æ„çš„å®¹å™¨ ï¼Œå…¸å‹å®ç°æœ‰<u>ArrayList ã€LinkedListã€Vector</u>ï¼› Mapã€Setéƒ½æœ‰ <u>åŸºäºå“ˆå¸Œå­˜å‚¨å’Œæ’åºæ ‘</u> çš„ä¸¤ç§å®ç°ç‰ˆæœ¬ï¼Œå‰è€…å®ç°æœ‰ <u>HashMapå’ŒHashtable</u> ï¼Œåè€…æœ‰<u>HashSet</u></li></ul><h4 id="4-è¯·è®²è®²ä½ æ‰€çŸ¥é“çš„å¸¸ç”¨é›†åˆç±»ä»¥åŠä¸»è¦æ–¹æ³•ï¼Ÿ">4.<strong>è¯·è®²è®²ä½ æ‰€çŸ¥é“çš„å¸¸ç”¨é›†åˆç±»ä»¥åŠä¸»è¦æ–¹æ³•</strong>ï¼Ÿ</h4><p>æœ€å¸¸ç”¨çš„é›†åˆç±»æ˜¯List å’Œ Mapã€‚</p><ul><li><strong>List</strong>ï¼šå…¸å‹å®ç°æœ‰<u>ArrayList ã€LinkedListã€Vector</u> ï¼Œå¤§å°å¯å˜ï¼Œé€‚åˆç”¨äºæŒ‰æ•°å€¼ç´¢å¼•å…ƒç´ ç±»å‹ï¼›</li><li><strong>Map</strong>ï¼š å…¶ä¸­æ¯ä¸ªé”®æ˜ å°„åˆ°ä¸€ä¸ªå€¼ï¼Œå®ç°æœ‰ <u>HashMapå’ŒHashtable</u> ã€‚</li></ul><h3 id="1-3-2-Map-Set">1.3.2 <strong>Map &amp; Set</strong></h3><h4 id="1-è¯·ä½ ä»‹ç»ä¸€ä¸‹mapçš„åˆ†ç±»å’Œå¸¸è§çš„æƒ…å†µï¼Ÿ">1.<strong>è¯·ä½ ä»‹ç»ä¸€ä¸‹mapçš„åˆ†ç±»å’Œå¸¸è§çš„æƒ…å†µ</strong>ï¼Ÿ</h4><p>javaä¸ºæ•°æ®ç»“æ„ä¸­çš„æ˜ å°„å®šä¹‰äº†ä¸€ä¸ªæ¥å£<code>java.util.Map</code>  ï¼Œ å®ƒæœ‰å››ä¸ªå®ç°ç±»,åˆ†åˆ«æ˜¯<code>HashMapã€ Hashtableã€ LinkedHashMapã€ å’ŒTreeMap</code>.</p><ul><li><p><strong>Hashmap</strong>  ï¼šæ ¹æ®é”®çš„HashCodeå€¼å­˜å‚¨æ•°æ®,æ ¹æ®é”®å¯ä»¥ç›´æ¥è·å–å®ƒçš„å€¼ï¼Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ã€‚</p><ul><li>éå†ï¼šè®¿é—®å¿«ï¼Œéå†æ—¶å–å¾—çš„<u>æ•°æ®éšæœº</u></li><li>çº¿ç¨‹ï¼šä¸æ”¯æŒçº¿ç¨‹åŒæ­¥ï¼ˆä½†å¯ä»¥ç”¨Collectionsçš„synchronizedMap å®ç°åŒæ­¥ï¼‰</li><li>keyå’Œè®°å½•ï¼š<strong>HashMapå…è®¸é”®å’Œå€¼æ˜¯null</strong></li></ul></li><li><p><strong>Hashtable</strong> ï¼šå’ŒHashmapç±»ä¼¼ï¼Œæ˜¯å…¶å­ç±»ã€‚ä½†å…¶ï¼š</p></li><li><p>çº¿ç¨‹ï¼š æ”¯æŒçº¿ç¨‹åŒæ­¥ï¼Œä¹Ÿå¯¼è‡´å†™å…¥æ¯”è¾ƒæ…¢ï¼ˆä¸€ä¸ªæ—¶å€™åªèƒ½ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼‰</p></li><li><p>keyå’Œè®°å½•ï¼šä¸å…è®¸è®°å½•çš„é”®æˆ–è€…å€¼ä¸ºç©º ï¼›</p></li><li><p><strong>LinkedHashMap</strong> ï¼šHashMapçš„ä¸€ä¸ªå­ç±»ï¼Œ<u>ä¿å­˜äº†è®°å½•æ’å…¥é¡ºåº</u>ï¼š</p></li><li><p>éå†ï¼š<strong>éå†</strong>å…ˆå¾—åˆ°çš„è®°å½•æ˜¯å…ˆæ’å…¥ã€ä¸€èˆ¬æƒ…å†µæ¯”HashMapæ…¢ã€‚</p></li><li><p><strong>TreeMap</strong> ï¼š å®ç°SortMapæ¥å£ï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œ</p></li><li><p>éå†ï¼šå½“ç”¨<strong>éå†</strong>TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯<u>æ’è¿‡åº</u>çš„</p><ul><li>çº¿ç¨‹ï¼šçº¿ç¨‹å®‰å…¨</li></ul></li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨çš„æœ€å¤šçš„æ˜¯HashMap, åœ¨Map ä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ ï¼ŒHashMap æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä½†<u>å¦‚æœæ‚¨è¦æŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºéå†é”®</u>ï¼Œé‚£ä¹ˆTreeMapä¼šæ›´å¥½ã€‚å¦‚æœéœ€è¦<u>è¾“å‡ºçš„é¡ºåºå’Œè¾“å…¥çš„ç›¸åŒ</u>,é‚£ä¹ˆç”¨LinkedHashMap å¯ä»¥å®ç°,å®ƒè¿˜<strong>å¯ä»¥æŒ‰è¯»å–é¡ºåºæ¥æ’åˆ—</strong>ã€‚</p><h5 id="1-1-TreeMapçš„åº•å±‚å®ç°ï¼Ÿ">1.1  TreeMapçš„åº•å±‚å®ç°ï¼Ÿ</h5><p>TreeMapå®ç°äº†SotredMapæ¥å£ï¼Œå®ƒæ˜¯æœ‰åºçš„é›†åˆã€‚<strong>è€Œä¸”æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ç»“æ„ï¼Œæ¯ä¸ªkey-valueéƒ½ä½œä¸ºä¸€ä¸ªçº¢é»‘æ ‘çš„èŠ‚ç‚¹</strong>ã€‚å¦‚æœåœ¨è°ƒç”¨<strong>TreeMapçš„æ„é€ å‡½æ•°æ—¶æ²¡æœ‰æŒ‡å®šæ¯”è¾ƒå™¨ï¼Œåˆ™æ ¹æ®keyæ‰§è¡Œè‡ªç„¶æ’åº</strong>ã€‚è¿™ç‚¹ä¼šåœ¨æ¥ä¸‹æ¥çš„ä»£ç ä¸­åšè¯´æ˜ï¼Œå¦‚<strong>æœæŒ‡å®šäº†æ¯”è¾ƒå™¨åˆ™æŒ‰ç…§æ¯”è¾ƒå™¨æ¥è¿›è¡Œæ’åº</strong>ã€‚</p><ul><li>è‡ªç„¶æ’åºï¼šTreeMapçš„æ‰€æœ‰keyå¿…é¡»å®ç°Comparableæ¥å£ï¼Œæ‰€æœ‰çš„keyéƒ½æ˜¯åŒä¸€ä¸ªç±»çš„å¯¹è±¡</li><li>å®šåˆ¶æ’åºï¼šåˆ›å»ºTreeMapå¯¹è±¡ä¼ å…¥äº†ä¸€ä¸ªComparatorå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è´Ÿè´£å¯¹TreeMapä¸­æ‰€æœ‰çš„keyè¿›è¡Œæ’åºï¼Œé‡‡ç”¨å®šåˆ¶æ’åºä¸è¦æ±‚Mapçš„keyå®ç°Comparableæ¥å£ã€‚ç­‰ä¸‹é¢åˆ†æåˆ°æ¯”è¾ƒæ–¹æ³•çš„æ—¶å€™åœ¨åˆ†æè¿™ä¸¤ç§æ¯”è¾ƒæœ‰ä½•ä¸åŒã€‚</li></ul><h4 id="2-è¯·é—®HashMapå’ŒHashtableåŒºåˆ«ï¼Ÿ">2.<strong>è¯·é—®HashMapå’ŒHashtableåŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><strong>å…±åŒç‚¹</strong>ï¼šéƒ½å®ç°Mapæ¥å£</li><li><strong>ä¸åŒç‚¹</strong>ï¼š<ol><li><strong>å¯¹Null key å’ŒNull valueçš„æ”¯æŒ</strong>ï¼šHashMap<u>å…è®¸é”®å’Œå€¼æ˜¯null</u>ï¼Œè€ŒHashtableä¸å…è®¸é”®æˆ–è€…å€¼æ˜¯nullï¼›</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šHashtableæ˜¯åŒæ­¥çš„çº¿ç¨‹å®‰å…¨ï¼Œè€ŒHashMapä¸æ˜¯ï¼›</li><li><strong>åˆå§‹å®¹é‡å¤§å°å’Œæ¯æ¬¡æ‰©å……å®¹é‡å¤§å°ä¸åŒ</strong>ï¼š  ï¼ˆ1ï¼‰åˆ›å»ºæ—¶å¦‚æœä¸æŒ‡å®šå®¹é‡åˆå§‹å€¼ï¼ŒHashtable é»˜è®¤çš„åˆå§‹å¤§å°ä¸º<strong>11</strong>ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„<strong>2n+1</strong>ã€‚HashMap é»˜è®¤çš„åˆå§‹åŒ–å¤§å°ä¸º<strong>16</strong>ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„<strong>2</strong>å€ ï¼›ï¼ˆ2ï¼‰åˆ›å»ºæ—¶å¦‚æœç»™å®šäº†å®¹é‡åˆå§‹å€¼ï¼Œé‚£ä¹ˆ Hashtable ä¼šç›´æ¥ä½¿ç”¨<strong>ä½ ç»™å®šçš„å¤§å°</strong>ï¼Œè€Œ HashMap ä¼šå°†å…¶<strong>æ‰©å……ä¸º2çš„å¹‚æ¬¡æ–¹å¤§å°</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ <u>HashMap æ€»æ˜¯ä½¿ç”¨2çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°</u>ï¼›</li><li><strong>åº•å±‚æ•°æ®ç»“æ„</strong>ï¼š JDK1.8 ä»¥åçš„ HashMap åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨â»“åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚Hashtable æ²¡æœ‰è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿™æ ·çš„æœºåˆ¶ï¼›</li><li><strong>ç»§æ‰¿çˆ¶ç±»</strong>ï¼šHashMapæ˜¯ç»§æ‰¿è‡ªAbstractMapç±»ï¼Œè€ŒHashtableæ˜¯ç»§æ‰¿è‡ªDictionaryç±»ã€‚</li></ol></li></ul><h4 id="3-è¯·é—®Mapæ¥å£å®ç°ï¼šHashMapã€Hashtableå’ŒConcurrentHashMapåŒºåˆ«ï¼Ÿ">3.<strong>è¯·é—®Mapæ¥å£å®ç°ï¼šHashMapã€Hashtableå’ŒConcurrentHashMapåŒºåˆ«</strong>ï¼Ÿ</h4><p>éƒ½æ˜¯key-valueå­˜å‚¨å½¢å¼ã€‚</p><ul><li><p><strong>åº•å±‚æ•°æ®ç»“æ„</strong>ï¼š<code>HashMap</code>ä¸<code>ConcurrentHashMap</code>åº•å±‚æ•°æ®ç»“æ„ç›¸ä¼¼ï¼ˆæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼‰ï¼Œ<code>Hashtable</code>æ²¡æœ‰çº¢é»‘æ ‘ï¼›</p></li><li><p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<code>Hashtable</code>çš„<code>synchronized</code>ä¿®é¥°åœ¨æ–¹æ³•ï¼Œæ˜¯å¯¹è±¡çº§çš„åŠ é”ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼›<code>ConcurrentHashMap</code>ä½¿ç”¨äº†ä¿®é¥°å…·ä½“å¯¹è±¡çš„<code>synchronized</code>ï¼ˆé”ä¸€ä¸ªæ¡¶ï¼‰å’ŒCASæœºåˆ¶ï¼Œå®ç°äº†æ›´ç»†ç²’åº¦çš„é”ï¼›</p></li><li><p><strong>åœ°å€è®¡ç®—</strong>ï¼š</p></li></ul><ul><li><code>HashMap</code>ä½¿ç”¨<code>key.hashCode() ^ (key.hashCode() &gt;&gt;&gt; 16)</code>ï¼›-<ul><li><code>Hashtable</code>ä½¿ç”¨<code>(key.hashCode() &amp; 0x7fffffff) % tab.length()</code></li></ul></li><li><code>ConcurrentHashMap</code>ä½¿ç”¨<code>(key.hashCode() ^ (key.hashCode() &gt;&gt;&gt; 16)) &amp; 0x7fffffff</code>ã€‚</li></ul><h4 id="4-è¯´ä¸€è¯´çº¢é»‘æ ‘ç‰¹å¾ï¼Ÿ">4.<strong>è¯´ä¸€è¯´çº¢é»‘æ ‘ç‰¹å¾</strong>ï¼Ÿ</h4><blockquote><p>ç´§æ¥ä¸Šä¸ªé—®é¢˜ï¼Œé¢è¯•å®˜å¾ˆæœ‰å¯èƒ½ä¼šé—®çº¢é»‘æ ‘ã€‚</p></blockquote><ul><li>æ¯ä¸ªèŠ‚ç‚¹æ˜¯é»‘è‰²æ˜¯çº¢è‰²</li><li><strong>æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹æ˜¯é»‘è‰²</strong></li><li>çº¢è‰²èŠ‚ç‚¹ä¸èƒ½ç›¸é‚»</li><li>ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å­å­™èŠ‚ç‚¹è·¯å¾„ä¸Šç›¸åŒæ•°ç›®çš„é»‘èŠ‚ç‚¹</li></ul><p><img src="https://i.loli.net/2021/05/05/yismA9xYt5MEeFw.png" alt="image-20210505132113159"></p><h4 id="5-hashmapçš„åŸºæœ¬åŸç†ï¼Œæ‰©å®¹æ–¹å¼ï¼ˆrehashï¼‰ï¼Ÿ">5. <strong>hashmapçš„åŸºæœ¬åŸç†ï¼Œæ‰©å®¹æ–¹å¼ï¼ˆrehashï¼‰</strong>ï¼Ÿ</h4><blockquote><p>å¾ˆæ£’çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.jianshu.com/p/dde9b12343c1">https://www.jianshu.com/p/dde9b12343c1</a></p><p>æ›´æ£’çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/81587796">https://zhuanlan.zhihu.com/p/81587796</a></p></blockquote><ul><li><p><code>HashMapå®šä¹‰</code></p><p>HashMapç»§æ‰¿äº†Mapç«¯å£ï¼Œå®ç°äº†Serializableç­‰æ¥å£ã€‚å­˜å‚¨HashMapçš„æ˜¯ä¸€ä¸ªEntry[]æ•°ç»„ï¼ŒEntryæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼š</p><blockquote><p>æ‰€ä»¥æˆ‘ä»¬è¯´HashMapå®ç°çš„æ˜¯ä¸€ä¸ª<code>æ•°ç»„+é“¾è¡¨</code> ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Cloneable</span>, <span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">transient</span> Entry&lt;K,V&gt;[] table;</span><br></pre></td></tr></table></figure></li><li><p><code>Entryç±»</code></p><p>Entryåœ¨HashMapä¸­å®ç°ä¸ºä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå°è£…äº†keyå’Œvalueï¼Œè¿˜æœ‰<u>ç±»å‹ä¸ºEntryçš„nextæŒ‡å‘ä¸‹ä¸€ä¸ªEntryå¼•ç”¨</u>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> K key;</span><br><span class="line">       V value;</span><br><span class="line">       Entry&lt;K,V&gt; next;</span><br><span class="line">       <span class="keyword">int</span> hash;</span><br></pre></td></tr></table></figure></li><li><p><code>å›¾è§£HashMap</code></p><p>æ ¹æ®å‰é¢æ‰€çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°HashMapçš„å®ç°å¦‚ä¸‹ï¼ˆé»˜è®¤åˆå§‹åŒ–å®¹é‡ä¸º16ï¼‰ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/4843132-05b3a55bd2686dd3.png" alt="img"></p></li><li><p><code>putæ–¹æ³•å®ç°</code></p><ol><li><p>è¾“å…¥çš„<code>key</code>æ ¹æ®<code>hash(key)</code> è®¡ç®—å‡ºhashå€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// å¯¹keyä¸ºnullçš„å¤„ç†</span></span><br><span class="line">       <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">           <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">       <span class="comment">// æ ¹æ®keyç®—å‡ºhashå€¼</span></span><br><span class="line">       <span class="keyword">int</span> hash = hash(key);</span><br></pre></td></tr></table></figure><ul><li><p><strong>hashæ–¹æ³•å¦‚ä¸‹ï¼ˆJDK1.8ç‰ˆæœ¬</strong>ï¼‰</p><p>ä¸‹é¢è¿™æ®µä»£ç ä¹Ÿå«<strong>æ‰°åŠ¨å‡½æ•°</strong> ï¼Œå‚è€ƒï¼š<a href="https://www.zhihu.com/question/20733617">JDK æºç ä¸­ HashMap çš„ hash æ–¹æ³•åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</a></p><p><img src="https://i.loli.net/2021/05/15/OZT8G6PdxkAtQVi.png" alt="img"></p><p>æ··åˆåŸå§‹å“ˆå¸Œç çš„é«˜ä½å’Œä½ä½ï¼Œä»¥æ­¤æ¥åŠ å¤§ä½ä½çš„éšæœºæ€§ ã€‚è€Œä¸”æ··åˆåçš„ä½ä½æºæ‚äº†é«˜ä½çš„éƒ¨åˆ†ç‰¹å¾ï¼Œè¿™æ ·é«˜ä½çš„ä¿¡æ¯ä¹Ÿè¢«å˜ç›¸ä¿ç•™ä¸‹æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> h;</span><br><span class="line"><span class="comment">// key.hashCode()ï¼šè¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode</span></span><br><span class="line"><span class="comment">// ^ ï¼šæŒ‰ä½å¼‚æˆ–</span></span><br><span class="line"><span class="comment">// &gt;&gt;&gt;â½†ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥â»¬</span></span><br><span class="line"><span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸â½äº JDK1.8 çš„ hash æ–¹æ³• ï¼ŒJDK 1.7 çš„ hash æ–¹æ³•çš„æ€§èƒ½ä¼šç¨å·®â¼€ç‚¹ç‚¹ï¼Œå› ä¸ºæ¯•ç«Ÿæ‰°åŠ¨äº† 4 æ¬¡ã€‚</p></li><li><p><strong>Objectç±»HashCodeå®ç°</strong></p><blockquote><p>è¯¦ç»†æºç åˆ†æå‚è€ƒ ï¼š<a href="https://juejin.cn/post/6844903487432556551">Java Object.hashCode()è¿”å›çš„æ˜¯å¯¹è±¡å†…å­˜åœ°å€ï¼Ÿ</a></p></blockquote><p>JDK8 çš„<strong>é»˜è®¤</strong>hashCodeçš„è®¡ç®—æ–¹æ³•æ˜¯é€šè¿‡å’Œå½“å‰çº¿ç¨‹æœ‰å…³çš„<strong>ä¸€ä¸ªéšæœºæ•°+ä¸‰ä¸ªç¡®å®šå€¼</strong>ï¼Œè¿ç”¨Marsagliaâ€™s xorshift schemeéšæœºæ•°ç®—æ³•å¾—åˆ°çš„ä¸€ä¸ªéšæœºæ•° ã€‚</p><p>å¯ä»¥é€šè¿‡åœ¨JVMå¯åŠ¨å‚æ•°ä¸­æ·»åŠ <code>-XX:hashCode=4</code>ï¼Œ<u>æ”¹å˜é»˜è®¤çš„hashCodeè®¡ç®—æ–¹å¼</u>ï¼š</p><ul><li>hashCode == 0 ï¼šè¿”å›ä¸€ä¸ªPark-Millerä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆçš„éšæœºæ•° ï¼ŒOpenJdk 6 &amp;7çš„é»˜è®¤å®ç°ï¼›</li><li>hashCode == 1ï¼šæ­¤ç±»æ–¹æ¡ˆå°†å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œåšç§»ä½è¿ç®—åä¸ä¸€ä¸ªéšæœºæ•°è¿›è¡Œå¼‚æˆ–å¾—åˆ°ç»“æœ ï¼›</li><li>hashCode == 2ï¼šæ­¤ç±»æ–¹æ¡ˆè¿”å›å›ºå®šçš„1ï¼›</li><li>hashCode == 3ï¼šæ­¤ç±»æ–¹æ¡ˆè¿”å›ä¸€ä¸ªè‡ªå¢åºåˆ—çš„å½“å‰å€¼ï¼›</li><li>hashCode == 4ï¼šæ­¤ç±»æ–¹æ¡ˆè¿”å›å½“å‰å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</li></ul></li></ul></li><li><p>æ ¹æ®<code>indexFor(hash, table.length)</code> ï¼Œè®¡ç®—åœ¨tableä¸­ä¸‹æ ‡</p><p><code>key.hashcodeå¾—åˆ°hash â†’ ç»è¿‡é«˜ä½16å¼‚æˆ–æ‰°åŠ¨å¾—åˆ°è¡Œhash â†’  indexForè®¡ç®—ä¸‹æ ‡</code></p><blockquote><p><code>indexFor()</code>  å®é™…å°±æ˜¯hashå€¼å–ä½™ï¼š<code>hash%(table.lenght-1)</code> ã€‚ä½†åœ¨å…·ä½“å®ç°ä¸­é€šè¿‡ä½è¿ç®—å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></blockquote><ul><li><p><strong>è®¡ç®—åŸç†</strong>ã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™ä¹Ÿæ­£å¥½è§£é‡Šäº†<strong>ä¸ºä»€ä¹ˆHashMapçš„æ•°ç»„é•¿åº¦è¦å–2çš„æ•´æ¬¡å¹‚</strong>ã€‚å› ä¸ºè¿™æ ·ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰æ­£å¥½ç›¸å½“äºä¸€ä¸ª<strong>ä½ä½æ©ç </strong>ã€‚â€œä¸â€æ“ä½œçš„ç»“æœå°±æ˜¯æ•£åˆ—å€¼çš„é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™ä½ä½å€¼ï¼Œç”¨æ¥åšæ•°ç»„ä¸‹æ ‡è®¿é—®ã€‚ä»¥åˆå§‹é•¿åº¦16ä¸ºä¾‹ï¼Œ16-1=15ã€‚2è¿›åˆ¶è¡¨ç¤ºæ˜¯00000000 00000000 00001111ã€‚å’ŒæŸæ•£åˆ—å€¼åšâ€œä¸â€æ“ä½œå¦‚ä¸‹ï¼Œç»“æœå°±æ˜¯<strong>æˆªå–äº†æœ€ä½çš„å››ä½å€¼</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">          10100101 11000100 00100101</span><br><span class="line">&amp;         00000000 00000000 00001111 ï¼ˆ16ï¼‰</span><br><span class="line">------------------------------------------</span><br><span class="line">          00000000 00000000 000000101</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½è¿ç®—è¦æ±‚<code>length</code> ä¸€å®šæ˜¯å¶æ•°</strong>ã€‚<code>length-1</code>åˆ™ä¸€å®šæ˜¯å¥‡æ•°ã€‚ è¿™æ ·<code>h &amp; (length-1)</code>è¿›è¡Œä½è¿ç®—å‡ºç°çš„ç»“æœå¯å¥‡å¯å¶ï¼Œä¸ä¼šä¸€ç›´æ˜¯å¶æ•°ï¼Œæµªè´¹å¥‡æ•°ç©ºé—´ã€‚è€Œlengthä¸º2çš„å¹‚æ¬¡ï¼Œå¯ä»¥ä¿è¯lengthä¸€å®šæ˜¯å¶æ•°ï¼Œ<strong>è¿™ä¹Ÿæ˜¯æ‰©å®¹ä¸ºä»€ä¹ˆè¦æ±‚ä¸€å®šæ˜¯2çš„å¹‚æ¬¡</strong>ã€‚</p></li></ul></li><li><p><u>éå†tableä¸­ä¸‹æ ‡ä¸ºiçš„Entryå•å‘é“¾è¡¨</u>ï¼Œæ‰¾æ˜¯å¦æœ‰ç›¸åŒçš„keyå·²ç»åœ¨HashMapä¸­ï¼Œå¦‚æœæœ‰ï¼Œå°±æ›¿æ¢valueä¸ºæœ€æ–°çš„å€¼ï¼›æ²¡æœ‰å°±ç›´æ¥æ’å…¥ã€‚æ‰€ä»¥HashMapä¸­åªèƒ½å­˜å‚¨å”¯ä¸€çš„keyã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">       <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">           Object k;</span><br><span class="line">           <span class="comment">// å…ˆåˆ¤æ–­hashå€¼æ˜¯å¦ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·ï¼Œå†åˆ¤æ–­keyæ˜¯å¦ä¸€æ ·</span></span><br><span class="line">           <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">               V oldValue = e.value;</span><br><span class="line">               e.value = value;</span><br><span class="line">               e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">               <span class="keyword">return</span> oldValue;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡putä¸Šé¢<code>for</code>å¾ªç¯ä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯<code>addEntry</code>æ–¹æ³•ç›´æ¥æŠŠkeyå’Œvalueå°è£…æˆEntryï¼Œç„¶ååŠ å…¥åˆ°tableä¸­çš„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modCount++;</span><br><span class="line">addEntry(hash, key, value, i);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ¶‰åŠåˆ°HashMapçš„<strong>æ‰©å®¹æœºåˆ¶</strong>ã€‚</p></li></ol></li><li><p><code>æ‰©å®¹æœºåˆ¶</code></p><blockquote><p>å½“HashMapä¸­å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°æ‰©å®¹çš„é˜€å€¼ ï¼Œé‚£å¦‚ä½•è¿›è¡Œæ‰©å®¹ï¼Ÿ</p></blockquote><blockquote><p>âš ï¸ åœ¨jdk1.8ç‰ˆæœ¬ä»¥åï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚</p><img src="https://i.loli.net/2021/05/04/PoScN7yntJRhFvd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 50%;" /></blockquote><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹addEntryæ–¹æ³•ä¸­çš„æ‰©å®¹ç›¸å…³ä»£ç ï¼š</p><ul><li>æ‰©å®¹å°±æ˜¯é€šè¿‡<code>resize()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºåŸæ¥<strong>2</strong>å€çš„æ–°table ï¼›</li><li><code>resize()</code>æ–¹æ³•å†…éƒ¨é€šè¿‡éå†çš„æ–¹å¼ï¼Œå°†è€tableçš„æ•°æ®ï¼Œé‡æ–°è®¡ç®—hashå¹¶å­˜å‚¨åˆ°æ–°tableçš„é€‚å½“ä½ç½®ï¼Œæœ€åä½¿ç”¨æ–°çš„tableï¼Œå¹¶é‡æ–°è®¡HashMapçš„æ‰©å®¹é˜€å€¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;   <span class="comment">//ä¼ å…¥æ–°çš„å®¹é‡</span></span><br><span class="line">     Entry[] oldTable = table;    <span class="comment">//å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„</span></span><br><span class="line">      <span class="keyword">int</span> oldCapacity = oldTable.length;         </span><br><span class="line">      <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;  <span class="comment">//æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº†</span></span><br><span class="line">          threshold = Integer.MAX_VALUE; <span class="comment">//ä¿®æ”¹é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼(2^31-1)ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šæ‰©å®¹äº†</span></span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„</span></span><br><span class="line">     Entry[] newTable = <span class="keyword">new</span> Entry[newCapacity];</span><br><span class="line">     <span class="comment">//ï¼ï¼å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ</span></span><br><span class="line">     transfer(newTable);     </span><br><span class="line">     <span class="comment">//HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„</span></span><br><span class="line">     table = newTable;  </span><br><span class="line">     <span class="comment">//ä¿®æ”¹é˜ˆå€¼</span></span><br><span class="line">     threshold = (<span class="keyword">int</span>)(newCapacity * loadFactor);</span><br><span class="line"><span class="number">13</span> &#125;</span><br></pre></td></tr></table></figure><p>transfer()æ–¹æ³•å°†åŸæœ‰Entryæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//srcå¼•ç”¨äº†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">      Entry[] src = table;                   </span><br><span class="line">      <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.length; j++) &#123; <span class="comment">//éå†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">          Entry&lt;K,V&gt; e = src[j];             <span class="comment">//å–å¾—æ—§Entryæ•°ç»„çš„æ¯ä¸ªå…ƒç´ </span></span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">              src[j] = <span class="keyword">null</span>;<span class="comment">//é‡Šæ”¾æ—§Entryæ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªç¯åï¼Œæ—§çš„Entryæ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰</span></span><br><span class="line">              <span class="keyword">do</span> &#123;</span><br><span class="line">                  Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                  <span class="comment">//ï¼ï¼é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®</span></span><br><span class="line">                  <span class="keyword">int</span> i = indexFor(e.hash, newCapacity); </span><br><span class="line">                 e.next = newTable[i]; <span class="comment">//æ ‡è®°[1]</span></span><br><span class="line">                 newTable[i] = e; <span class="comment">//å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š</span></span><br><span class="line">                 e = next; <span class="comment">//è®¿é—®ä¸‹ä¸€ä¸ªEntryé“¾ä¸Šå…ƒç´ </span></span><br><span class="line">            &#125; <span class="keyword">while</span> (e != <span class="keyword">null</span>);</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>newTable[i]çš„å¼•ç”¨èµ‹ç»™äº†e.nextï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ ã€‚ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯å“ˆå¸Œæ¡¶æ•°ç»„ resizeæˆ4ï¼Œç„¶åæ‰€æœ‰çš„Nodeé‡æ–°rehashçš„è¿‡ç¨‹ã€‚</p><p><img src="https://i.loli.net/2021/05/15/nCYJf3KPqBdEU4G.png" alt="image-20210515115619336"></p></li><li><p><code>getæ–¹æ³•å®ç°</code></p><p>ç”¨keyçš„hashå€¼ç®—å‡ºkeyå¯¹åº”çš„Entryæ‰€åœ¨é“¾è¡¨åœ¨åœ¨tableçš„ä¸‹æ ‡ï¼Œç„¶åéå†ä¸‹æ ‡å³å¯ã€‚</p><img src="4843132-9b5f706433247a6c.webp" alt="img" style="zoom:80%;"/></li></ul><h5 id="5-1-ä¸ºä»€ä¹ˆHashMapé»˜è®¤é“¾è¡¨é•¿åº¦è¶…è¿‡8è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè€Œä¸æ˜¯6ã€7æˆ–9ï¼Ÿ">5.1 ä¸ºä»€ä¹ˆHashMapé»˜è®¤é“¾è¡¨é•¿åº¦è¶…è¿‡8è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè€Œä¸æ˜¯6ã€7æˆ–9ï¼Ÿ</h5><ul><li><p>åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œé“¾è¡¨é•¿åº¦ç¬¦åˆæ³Šæ¾åˆ†å¸ƒï¼Œå„ä¸ªé•¿åº¦çš„å‘½ä¸­æ¦‚ç‡ä¾æ¬¡é€’å‡ï¼Œå½“é•¿åº¦ä¸º 8 çš„æ—¶å€™ï¼Œæ¦‚ç‡ä»…ä¸º 0.00000006ã€‚æºç ä¸­æ³¨é‡Šå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>:    <span class="number">0.60653066</span></span><br><span class="line"><span class="number">1</span>:    <span class="number">0.30326533</span></span><br><span class="line"><span class="number">2</span>:    <span class="number">0.07581633</span></span><br><span class="line"><span class="number">3</span>:    <span class="number">0.01263606</span></span><br><span class="line"><span class="number">4</span>:    <span class="number">0.00157952</span></span><br><span class="line"><span class="number">5</span>:    <span class="number">0.00015795</span></span><br><span class="line"><span class="number">6</span>:    <span class="number">0.00001316</span></span><br><span class="line"><span class="number">7</span>:    <span class="number">0.00000094</span></span><br><span class="line"><span class="number">8</span>:    <span class="number">0.00000006</span></span><br><span class="line">more: less than <span class="number">1</span> in ten million</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå°äºåƒä¸‡åˆ†ä¹‹ä¸€çš„æ¦‚ç‡ï¼Œé€šå¸¸æˆ‘ä»¬çš„ Map é‡Œé¢æ˜¯ä¸ä¼šå­˜å‚¨è¿™ä¹ˆå¤šçš„æ•°æ®çš„ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¼šå‘ç”Ÿä»é“¾è¡¨å‘çº¢é»‘æ ‘çš„è½¬æ¢ã€‚</p></li><li><p>ç‰¹åˆ«çš„ï¼Œé»˜è®¤æ˜¯é“¾è¡¨é•¿åº¦è¾¾åˆ° 8 å°±è½¬æˆçº¢é»‘æ ‘ï¼Œè€Œå½“é•¿åº¦é™åˆ° 6 å°±è½¬æ¢å›å»ï¼Œè¿™ä½“ç°äº†æ—¶é—´å’Œç©ºé—´å¹³è¡¡çš„æ€æƒ³ã€‚<strong>é•¿åº¦è¾ƒå°æ—¶ï¼Œä½¿ç”¨é“¾<u>è¡¨ç©ºé—´å ç”¨å°‘</u>ï¼Œæ—¶é—´ä¹Ÿä¸ä¼šé•¿ï¼ˆå› ä¸ºé“¾è¡¨çŸ­</strong>ï¼‰ã€‚</p></li></ul><h5 id="5-2-HashMap-å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜ï¼Ÿ">5.2  HashMap å¤šçº¿ç¨‹æ“ä½œå¯¼è‡´æ­»å¾ªç¯é—®é¢˜ï¼Ÿ</h5><p><strong>æ€»ç»“</strong>ï¼š HashMapä¹‹æ‰€ä»¥åœ¨å¹¶å‘ä¸‹çš„æ‰©å®¹é€ æˆæ­»å¾ªç¯ï¼Œæ˜¯å› ä¸ºï¼Œå¤šä¸ªçº¿ç¨‹å¹¶å‘è¿›è¡Œæ—¶ï¼Œ<strong>å› ä¸ºä¸€ä¸ªçº¿ç¨‹å…ˆæœŸå®Œæˆäº†æ‰©å®¹</strong>ï¼Œå°†åŸçš„é“¾è¡¨é‡æ–°æ•£åˆ—åˆ°è‡ªå·±çš„è¡¨ä¸­ï¼Œå¹¶ä¸”é“¾è¡¨å˜æˆäº†<strong>å€’åº</strong>ï¼Œåä¸€ä¸ªçº¿ç¨‹å†æ‰©å®¹æ—¶ï¼Œåˆè¿›è¡Œè‡ªå·±çš„æ•£åˆ—ï¼Œå†æ¬¡å°†<strong>å€’åºé“¾è¡¨å˜ä¸ºæ­£åºé“¾è¡¨</strong>ï¼Œäºæ˜¯å½¢æˆäº†ä¸€ä¸ªç¯å½¢é“¾è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//srcå¼•ç”¨äº†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">      Entry[] src = table;                   </span><br><span class="line">      <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.length; j++) &#123; <span class="comment">//éå†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">          Entry&lt;K,V&gt; e = src[j];             <span class="comment">//å–å¾—æ—§Entryæ•°ç»„çš„æ¯ä¸ªå…ƒç´ </span></span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">              src[j] = <span class="keyword">null</span>;</span><br><span class="line">             <span class="keyword">do</span> &#123;</span><br><span class="line">                  Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                  <span class="comment">//ï¼ï¼é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®</span></span><br><span class="line">               <span class="keyword">int</span> i = indexFor(e.hash, newCapacity); </span><br><span class="line">               e.next = newTable[i]; <span class="comment">//æ ‡è®°[1]</span></span><br><span class="line">               newTable[i] = e;    <span class="comment">//å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š</span></span><br><span class="line">                e = next;    <span class="comment">//è®¿é—®ä¸‹ä¸€ä¸ªEntryé“¾ä¸Šçš„å…ƒç´ </span></span><br><span class="line">            &#125; <span class="keyword">while</span> (e != <span class="keyword">null</span>);</span><br><span class="line">          &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ol><li><p>mapåˆå§‹åŒ–ä¸ºä¸€ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼ŒloadFactor=0.75ï¼Œ<code>threshold=2*0.75</code>=1ï¼Œä¹Ÿå°±æ˜¯è¯´å½“putç¬¬äºŒä¸ªkeyçš„æ—¶å€™ï¼Œmapå°±éœ€è¦è¿›è¡Œresizeã€‚</p></li><li><p>è®¾ç½®æ–­ç‚¹è®©çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶debugåˆ°transferæ–¹æ³•çš„é¦–è¡Œã€‚æ³¨æ„æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹å·²ç»æˆåŠŸæ·»åŠ æ•°æ®ã€‚æ”¾å¼€thread1çš„æ–­ç‚¹è‡³transferæ–¹æ³•çš„â€œEntry next = e.next;â€ è¿™ä¸€è¡Œï¼›ç„¶åæ”¾å¼€çº¿ç¨‹2çš„çš„æ–­ç‚¹ï¼Œè®©çº¿ç¨‹2è¿›è¡Œresizeã€‚ç»“æœå¦‚ä¸‹å›¾ã€‚</p><p><img src="https://i.loli.net/2021/05/15/9wiAnOHdBe7hjLs.png" alt="image-20210515120319361"></p></li><li><p>æ³¨æ„ï¼ŒThread1çš„ e æŒ‡å‘äº†key(3)ï¼Œè€ŒnextæŒ‡å‘äº†key(7)ï¼Œå…¶åœ¨çº¿ç¨‹äºŒrehashåï¼Œ<strong>æŒ‡å‘äº†çº¿ç¨‹äºŒé‡ç»„åçš„æ–°é“¾è¡¨</strong>ã€‚</p></li><li><p>çº¿ç¨‹ä¸€è¢«è°ƒåº¦å›æ¥æ‰§è¡Œï¼Œå…ˆæ˜¯æ‰§è¡Œ newTalbe[i] = eï¼Œ ç„¶åæ˜¯e = nextï¼Œå¯¼è‡´äº†eæŒ‡å‘äº†key(7)ï¼Œè€Œä¸‹ä¸€æ¬¡å¾ªç¯çš„next = e.nextå¯¼è‡´äº†nextæŒ‡å‘äº†key(3)ã€‚</p><p><img src="https://i.loli.net/2021/05/15/NFfwAOguQmsyeWh.png" alt="image-20210515120436107"></p></li><li><p>e.next = newTable[i] å¯¼è‡´ key(3).next æŒ‡å‘äº† key(7)ã€‚æ³¨æ„ï¼šæ­¤æ—¶çš„key(7).next å·²ç»æŒ‡å‘äº†key(3)ï¼Œ ç¯å½¢é“¾è¡¨å°±è¿™æ ·å‡ºç°äº†ã€‚</p><p><img src="https://i.loli.net/2021/05/15/ApClYedO6JTWmnx.png" alt="image-20210515120503570"></p></li></ol><h5 id="5-3-è¯´è¯´HashMapçš„putæ–¹æ³•ï¼Ÿ">5.3 è¯´è¯´HashMapçš„putæ–¹æ³•ï¼Ÿ</h5><p>æ ¹æ®keyå€¼è®¡ç®—åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼š</p><ul><li>å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´  å°±ç›´æ¥æ’å…¥ï¼›</li><li>å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æœ‰å…ƒç´ ï¼Œéå†ä»¥è¿™ä¸ªå…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ï¼Œ<u>ä¾æ¬¡å’Œæ’å…¥çš„ key æ¯”è¾ƒï¼Œå¦‚æœ <strong>hashå€¼&amp;equalså¯¹è±¡ç›¸åŒ</strong>å°±ç›´æ¥<strong>è¦†ç›–</strong>ï¼Œ<strong>ä¸åŒ</strong>å°±é‡‡ç”¨<strong>å¤´æ’æ³•</strong>æ’å…¥å…ƒç´ </u>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//table[i]çš„ä½ç½®å·²ç»å­˜åœ¨å…ƒç´ ï¼Œéå†é“¾è¡¨</span></span><br><span class="line"><span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;    </span><br><span class="line">    Object k;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//è°ƒç”¨ equals æ–¹æ³•åˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰ï¼Œè¯¥keyå¯¹åº”çš„é”®å€¼å¯¹å·²ç»å­˜åœ¨ï¼Œç”¨æ–°çš„valueå–ä»£æ—§çš„value</span></span><br><span class="line">    <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;    </span><br><span class="line">        V oldValue = e.value;    </span><br><span class="line">        e.value = value;    </span><br><span class="line">        e.recordAccess(<span class="keyword">this</span>);    </span><br><span class="line">        <span class="keyword">return</span> oldValue;    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><h5 id="5-4-è¯´è¯´HashMapçš„getæ–¹æ³•ï¼Ÿ"><strong>5.4 è¯´è¯´HashMapçš„getæ–¹æ³•</strong>ï¼Ÿ</h5><p>æ ¹æ®keyå€¼è®¡ç®—åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼š</p><ul><li>éå†é“¾è¡¨æˆ–è€…åœ¨çº¢é»‘æ ‘ï¼Œæ¯”è¾ƒkeyæ¥è·å–value</li></ul><h5 id="5-5-ã€ç™¾åº¦ã€‘rehashæ‰©å®¹æ—¶æœºï¼Ÿåœ¨æ’å…¥å‰è¿˜æ˜¯æ’å…¥åï¼Ÿ">5.5 ã€ç™¾åº¦ã€‘rehashæ‰©å®¹æ—¶æœºï¼Ÿåœ¨æ’å…¥å‰è¿˜æ˜¯æ’å…¥åï¼Ÿ</h5><p>rehashè¿‡ç¨‹åœ¨putå‡½æ•°ä¸­ï¼Œå…¶å¤§è‡´æ‰©å®¹æ—¶æœºå¦‚ä¸‹ï¼š</p><ol><li><p>è®¡ç®—hashï¼Œå®šä½åˆ°æ¡¶ï¼›ä¸”éå†æ¡¶å¤–æŒ‚é“¾è¡¨ï¼Œå¦‚æœæœ‰ç›¸åŒkeyåˆ™è¦†ç›–ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span>)  <span class="comment">// ã€ç™¾åº¦ã€‘æ€ä¹ˆå¤„ç†keyæˆ–valueä¸ºNULLçš„æƒ…å†µï¼Ÿ</span></span><br><span class="line">            <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">        <span class="keyword">int</span> hash = hash(key);<span class="comment">//è®¡ç®—é”®çš„hashå€¼</span></span><br><span class="line">        <span class="keyword">int</span> i = indexFor(hash, table.length);<span class="comment">//é€šè¿‡hashå€¼å¯¹åº”åˆ°æ¡¶ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;<span class="comment">//é¡ºåºéå†æ¡¶å¤–æŒ‚çš„å•é“¾è¡¨</span></span><br><span class="line">            Object k;</span><br><span class="line">            <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;/</span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                e.value = value;</span><br><span class="line">                e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        modCount++;</span><br><span class="line">        addEntry(hash, key, value, i);<span class="comment">//éå†å•é“¾è¡¨å®Œæ¯•ï¼Œæ²¡æœ‰æ‰¾åˆ°ä¸é”®ç›¸å¯¹çš„Entryï¼Œéœ€æ–°å»ºä¸€ä¸ªEntry</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ã€å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒkeyï¼Œè¯´æ˜è¦æ’å…¥ä¸€ä¸ªæ–°entryã€‘</strong> ï¼Œæ‰§è¡ŒaddEntryï¼Œ<strong>æ’å…¥å‰</strong>å…ˆéªŒè¯ä¸‹æ˜¯å¦æ‰©å®¹ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((size &gt;= threshold) &amp;&amp; (<span class="keyword">null</span> != table[bucketIndex])) &#123;</span><br><span class="line">            resize(<span class="number">2</span> * table.length);<span class="comment">//å°†å®¹é‡æ‰©å®¹ä¸ºåŸæ¥çš„2å€</span></span><br><span class="line">            hash = (<span class="keyword">null</span> != key) ? hash(key) : <span class="number">0</span>;</span><br><span class="line">            bucketIndex = indexFor(hash, table.length);<span class="comment">//æ‰©å®¹åçš„ï¼Œè¯¥hashå€¼å¯¹åº”çš„æ–°çš„æ¡¶ä½ç½®</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        createEntry(hash, key, value, bucketIndex);<span class="comment">//åœ¨æŒ‡å®šçš„æ¡¶ä½ç½®ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Entry</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">        Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">        table[bucketIndex] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);<span class="comment">//é“¾è¡¨çš„å¤´æ’æ³•æ’å…¥æ–°å»ºçš„Entry</span></span><br><span class="line">        size++;<span class="comment">//æ›´æ–°size</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol><p>å› æ­¤æ€»ç»“æ‰©å®¹æ—¶æœºå¦‚ä¸‹ï¼š</p><ul><li>åœ¨æ‰§è¡Œputæ—¶ï¼Œå¦‚æœéå†æŒ‡å®šæ¡¶å¤–æŒ‚é“¾è¡¨<strong>æ²¡æœ‰æ‰¾åˆ°ç›¸åŒkey</strong>çš„èŠ‚ç‚¹æ—¶ï¼Œè¯´æ˜éœ€è¦<strong>æ–°å»ºä¸€ä¸ªentry</strong>ï¼Œè¿™ä¸ªæ—¶å€™åœ¨<strong>æ’å…¥å‰</strong>éªŒè¯ä¸‹æ˜¯å¦è¦æ‰©å®¹ã€‚</li></ul><h5 id="5-6-hashmapåœ¨1-7ç‰ˆæœ¬ä¹‹å‰ä¸ºä»€ä¹ˆä½¿ç”¨å¤´æ’æ³•ï¼Ÿ">5.6 hashmapåœ¨1.7ç‰ˆæœ¬ä¹‹å‰ä¸ºä»€ä¹ˆä½¿ç”¨å¤´æ’æ³•ï¼Ÿ</h5><blockquote><p>1.7ç‰ˆæœ¬ä¹‹å‰é‡‡ç”¨å¤´æ’æ³•ï¼Œ1.8ä¹‹åé‡‡ç”¨å°¾æ’æ³•ã€‚</p></blockquote><p><strong>å¤´æ’æ³•</strong>ä¼šæ”¹å˜é“¾è¡¨ä¸­å…ƒç´ åŸæœ¬çš„é¡ºåºï¼Œä»¥è‡³äºåœ¨å¹¶å‘åœºæ™¯ä¸‹<strong>å¯¼è‡´é“¾è¡¨æˆç¯</strong>çš„é—®é¢˜ï¼›è€Œ<strong>å°¾æ’æ³•</strong>ï¼Œåœ¨æ‰©å®¹æ—¶<strong>ä¼šä¿æŒé“¾è¡¨å…ƒç´ åŸæœ¬çš„é¡ºåº</strong>ï¼Œå°±ä¸ä¼šå‡ºç°é“¾è¡¨æˆç¯çš„é—®é¢˜ ã€‚</p><blockquote><p>æ—¢ç„¶æœ‰å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ï¼Œé‚£ä¸ºä»€ä¹ˆ1.8ä¹‹å‰è¿˜è¦ä½¿ç”¨å¤´æ’æ³•ï¼Ÿ</p></blockquote><ol><li><strong>å±€éƒ¨æ€§åŸç†</strong>ï¼š æœ€è¿‘è®¿é—®è¿‡çš„æ•°æ®ä¸‹æ¬¡å¤§æ¦‚ç‡ä¼šå†æ¬¡è®¿é—®ï¼ŒæŠŠåˆšè®¿é—®è¿‡çš„å…ƒç´ <strong>æ”¾åœ¨é“¾è¡¨æœ€å‰é¢</strong>å¯ä»¥ç›´æ¥è¢«æŸ¥è¯¢åˆ°ï¼Œå‡å°‘æŸ¥æ‰¾æ¬¡æ•°</li><li><strong>ä¸æ˜¯ä¸ºäº†é€‚åº”å¤šçº¿ç¨‹è€Œè®¾è®¡</strong>ï¼šã€€åªæœ‰åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤´æ’æ³•æ‰ä¼šå‡ºç°é“¾è¡¨æˆç¯çš„é—®é¢˜ï¼Œå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼ŒHashMap æœ¬å°±éçº¿ç¨‹å®‰å…¨ï¼Œè¿™å°±<strong>ç›¸å½“äºä½ åœ¨å®ƒçš„è§„åˆ™ä¹‹å¤–</strong>å‡ºäº†é—®é¢˜ã€‚</li></ol><h5 id="5-7-ä¸ºä»€ä¹ˆ-HashMap-çš„è´Ÿè½½å› å­è®¾ç½®æˆ-0-75ï¼Œè€Œä¸æ˜¯-1-ä¹Ÿä¸æ˜¯-0-5ï¼Ÿ">5.7 <strong>ä¸ºä»€ä¹ˆ HashMap çš„è´Ÿè½½å› å­è®¾ç½®æˆ 0.75ï¼Œè€Œä¸æ˜¯ 1 ä¹Ÿä¸æ˜¯ 0.5ï¼Ÿ</strong></h5><p>åœ¨ HashMap ä¸­ï¼Œä¸´ç•Œå€¼ï¼ˆthresholdï¼‰ = è´Ÿè½½å› å­ï¼ˆloadFactorï¼‰ * å®¹é‡ï¼ˆcapacityï¼‰ã€‚</p><p><strong>é‚£ä¹ˆå¦‚ä½•èƒ½æœ‰æ•ˆçš„é¿å…å“ˆå¸Œç¢°æ’å‘¢</strong>ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆåå‘æ€ç»´ä¸€ä¸‹ï¼Œä½ è®¤ä¸ºä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´ HashMap çš„å“ˆå¸Œç¢°æ’æ¯”è¾ƒå¤šï¼Ÿ</p><p>æ— å¤–ä¹ä¸¤ç§æƒ…å†µï¼š</p><ol><li><p>å®¹é‡å¤ªå°ã€‚å®¹é‡å°ï¼Œç¢°æ’çš„æ¦‚ç‡å°±é«˜äº†ã€‚ç‹¼å¤šè‚‰å°‘ï¼Œå°±ä¼šå‘ç”Ÿäº‰æŠ¢ã€‚</p></li><li><p>hash ç®—æ³•ä¸å¤Ÿå¥½ã€‚ç®—æ³•ä¸åˆç†ï¼Œå°±å¯èƒ½éƒ½åˆ†åˆ°åŒä¸€ä¸ªæˆ–å‡ ä¸ªæ¡¶ä¸­ã€‚åˆ†é…ä¸å‡ï¼Œä¹Ÿä¼šå‘ç”Ÿäº‰æŠ¢ã€‚</p></li></ol><p><strong>ä¸ºäº†é¿å…å“ˆå¸Œç¢°æ’ï¼ŒHashMap éœ€è¦åœ¨åˆé€‚çš„æ—¶å€™è¿›è¡Œæ‰©å®¹</strong>ã€‚é‚£å°±æ˜¯å½“å…¶ä¸­çš„å…ƒç´ ä¸ªæ•°è¾¾åˆ°ä¸´ç•Œå€¼çš„æ—¶å€™ï¼ˆ<strong>ç­‰å…¨æ»¡äº†å†æ‰©å®¹ï¼Œé‚£ä¹ˆåœ¨æ­¤ä¹‹å‰å®¹é‡å¤ªå°‘ï¼Œå¯¼è‡´ç¢°æ’çš„æ¦‚ç‡è¿‡é«˜</strong>ï¼‰ï¼Œè€Œè¿™ä¸ªä¸´ç•Œå€¼å‰é¢è¯´è¿‡å’Œ loadFactor æœ‰å…³ï¼Œæ¢å¥è¯è¯´ï¼Œ<strong>è®¾ç½®ä¸€ä¸ªåˆç†çš„ loadFactor</strong>ï¼Œå¯ä»¥æœ‰æ•ˆçš„é¿å…å“ˆå¸Œå†²çªã€‚</p><blockquote><p>JVMä¸­åŸè¯ï¼š</p><p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œé»˜è®¤çš„è´Ÿè½½å› å­ (0.75) åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´æä¾›äº†å¾ˆå¥½çš„æƒè¡¡ã€‚æ›´é«˜çš„å€¼å‡å°‘äº†ç©ºé—´å¼€é”€ï¼Œä½†å¢åŠ äº†æŸ¥æ‰¾æˆæœ¬(åæ˜ åœ¨ HashMap ç±»çš„å¤§å¤šæ•°æ“ä½œä¸­ï¼ŒåŒ…æ‹¬ get å’Œ put)</strong>ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œ<strong>ä¸ºäº†ä¿è¯è´Ÿè½½å› å­ï¼ˆloadFactorï¼‰ * å®¹é‡ï¼ˆcapacityï¼‰çš„ç»“æœæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¿™ä¸ªå€¼æ˜¯ 0.75(3/4) æ¯”è¾ƒåˆç†ï¼Œå› ä¸ºè¿™ä¸ªæ•°å’Œä»»ä½• 2 çš„å¹‚ä¹˜ç§¯ç»“æœéƒ½æ˜¯æ•´æ•°</strong>ã€‚</p></blockquote><h5 id="5-8-Hashmap-æ€ä¹ˆå¤„ç†keyå’Œvalueä¸ºnullçš„æƒ…å†µï¼Ÿ">5.8 Hashmap æ€ä¹ˆå¤„ç†keyå’Œvalueä¸ºnullçš„æƒ…å†µï¼Ÿ</h5><h4 id="6-Hashtable-æºç åˆ†æ">6. Hashtable æºç åˆ†æ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903509725282317">Javaé›†åˆä¹‹Hashtableæºç è§£æ</a></p></blockquote><ul><li><p><strong>æ„é€ å‡½æ•°</strong></p><p>å’ŒHashMapè¿˜æ˜¯æŒºç›¸ä¼¼çš„ï¼Œä½†æ˜¯é»˜è®¤åˆå§‹å®¹é‡æ˜¯11ï¼ˆHashMapæ˜¯16ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Entry&lt;?,?&gt;[] table;<span class="comment">//æ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> count;<span class="comment">//é”®å€¼å¯¹çš„æ•°é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> threshold;<span class="comment">//é˜€å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> loadFactor;<span class="comment">//åŠ è½½å› å­</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>;<span class="comment">//ä¿®æ”¹æ¬¡æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Hashtable</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;<span class="comment">//ä¸‹é¢çš„ä¸‰ä¸ªæ„é€ å‡½æ•°éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ¥è¿›è¡Œç›¸å…³çš„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal Capacity: &quot;</span>+</span><br><span class="line">                                               initialCapacity);</span><br><span class="line">        <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal Load: &quot;</span>+loadFactor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (initialCapacity==<span class="number">0</span>)</span><br><span class="line">            initialCapacity = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">        table = <span class="keyword">new</span> Entry[initialCapacity];<span class="comment">//è¿™é‡Œæ˜¯ä¸HashMapçš„åŒºåˆ«ä¹‹ä¸€ï¼ŒHashMapä¸­table</span></span><br><span class="line">        threshold = (<span class="keyword">int</span>)Math.min(initialCapacity * loadFactor, MAX_ARRAY_SIZE + <span class="number">1</span>);</span><br><span class="line">        initHashSeedAsNeeded(initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Hashtable</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;<span class="comment">//æŒ‡å®šåˆå§‹æ•°ç»„é•¿åº¦</span></span><br><span class="line">        <span class="keyword">this</span>(initialCapacity, <span class="number">0.75f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Hashtable</span><span class="params">()</span> </span>&#123;<span class="comment">//ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºå®¹é‡çš„é»˜è®¤å€¼ä¸º16ï¼ŒåŠ è½½å› å­ä¸º0.75f.</span></span><br><span class="line">        <span class="keyword">this</span>(<span class="number">11</span>, <span class="number">0.75f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Hashtable</span><span class="params">(Map&lt;? extends K, ? extends V&gt; t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(Math.max(<span class="number">2</span>*t.size(), <span class="number">11</span>), <span class="number">0.75f</span>);</span><br><span class="line">        putAll(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>putæ–¹æ³•</strong></p><p>å’ŒHashMapæ•´ä½“è¿‡ç¨‹ä¾æ—§å¾ˆåƒï¼Œä½†æœ‰4ç‚¹æ³¨æ„ï¼š</p><ol><li><p>putæ–¹æ³•æ˜¯åŠ é”synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹å®‰å…¨</p></li><li><p>Hashtableè®¡ç®—hashå€¼çš„hash(key)ï¼Œä¸å…è®¸ä¸ºnullï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºå¼‚å¸¸</p></li><li><p>è·å–æ•°ç»„æ•£åˆ—çš„ä¸‹æ ‡ <code>(hash &amp; 0x7FFFFFFF) % tab.length</code> å’ŒHashMap <code>hash &amp; length-1</code> ä¸åŒ</p><blockquote><ul><li><code>(hash &amp; 0x7FFFFFFF) % tab.length</code>  æ˜¯ï¼ˆ1ï¼‰<code>hash &amp; 0x7FFFFFFF</code>  ä¿è¯hashæ˜¯æ­£æ•° ï¼ˆ2ï¼‰ç„¶åå–ä½™</li><li>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒHashMapæ˜¯ä½è¿ç®—è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ›´é«˜æ•ˆ</li></ul></blockquote></li><li><p>Hashtableæ²¡æœ‰é“¾è¡¨è½¬çº¢é»‘æ ‘çš„æœºåˆ¶</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;<span class="comment">//è¿™é‡Œæ–¹æ³•ä¿®é¥°ç¬¦ä¸ºsynchronized,æ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();<span class="comment">//valueå¦‚æœä¸ºNull,æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        &#125;</span><br><span class="line">        Entry tab[] = table;</span><br><span class="line">        <span class="keyword">int</span> hash = hash(key);<span class="comment">//hashé‡Œé¢çš„ä»£ç æ˜¯hashSeed^key.hashcodeï¼ˆï¼‰,null.hashCodeï¼ˆï¼‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥è¿™å°±è§£é‡Šäº†Hashtableçš„keyå’Œvalueä¸èƒ½ä¸ºnullçš„åŸå› ã€‚</span></span><br><span class="line">        <span class="keyword">int</span> index = (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;<span class="comment">//è·å–æ•°ç»„å…ƒç´ ä¸‹æ ‡,å…ˆå¯¹hashå€¼å–æ­£ï¼Œç„¶åå–ä½™ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e = tab[index] ; e != <span class="keyword">null</span> ; e = e.next) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;</span><br><span class="line">                V old = e.value;</span><br><span class="line">                e.value = value;</span><br><span class="line">                <span class="keyword">return</span> old;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        modCount++;<span class="comment">//ä¿®æ”¹æ¬¡æ•°ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt;= threshold) &#123;<span class="comment">//é”®å€¼å¯¹çš„æ€»æ•°å¤§äºå…¶é˜€å€¼</span></span><br><span class="line">            rehash();<span class="comment">//åœ¨rehashé‡Œè¿›è¡Œæ‰©å®¹å¤„ç†</span></span><br><span class="line"></span><br><span class="line">            tab = table;</span><br><span class="line">            hash = hash(key);</span><br><span class="line">            index = (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br><span class="line">        &#125;</span><br><span class="line">        Entry&lt;K,V&gt; e = tab[index];</span><br><span class="line">        tab[index] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>rehashæ–¹æ³•ï¼ˆæ‰©å®¹</strong>ï¼‰</p><p>å’ŒHashMapä¾æ—§å¾ˆåƒï¼Œä½†æ˜¯æ‰©å®¹æ¯æ¬¡æ˜¯ <code>old*2+1</code> ã€‚</p></li><li><p><strong>getæ–¹æ³•</strong></p><p>ä¹Ÿæ˜¯ç›¸æ¯”Hashmapç›´æ¥åŠ äº† synchronized è¿›è¡Œä¿®é¥°ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;<span class="comment">//æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šæ€§ï¼Œå°±æ˜¯åŠ äº†ä¸€ä¸ªsynchronizedï¼Œå°±æ˜¯æ ¹æ®indexæ¥éå†ç´¢å¼•å¤„çš„å•é“¾è¡¨ã€‚</span></span><br><span class="line">       Entry tab[] = table;</span><br><span class="line">       <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">       <span class="keyword">int</span> index = (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br><span class="line">       <span class="keyword">for</span> (Entry&lt;K,V&gt; e = tab[index] ; e != <span class="keyword">null</span> ; e = e.next) &#123;</span><br><span class="line">           <span class="keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;</span><br><span class="line">               <span class="keyword">return</span> e.value;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="6-1-ï¼ˆå®¹æ˜“å¿˜ï¼‰HashMap-å’Œ-Hashtable-çš„åŒºåˆ«-ï¼Ÿ">6.1 ï¼ˆå®¹æ˜“å¿˜ï¼‰HashMap <strong>å’Œ</strong> Hashtable <strong>çš„åŒºåˆ«</strong> ï¼Ÿ</h5><ol><li><p><strong>å…³äºnull</strong>ï¼ŒHashMapå…è®¸keyå’Œvalueéƒ½å¯ä»¥ä¸ºnullï¼Œè€ŒHashtableåˆ™ä¸æ¥å—keyä¸ºnullæˆ–valueä¸ºnullçš„é”®å€¼å¯¹ã€‚</p></li><li><p><strong>å…³äºçº¿ç¨‹å®‰å…¨</strong>ï¼ŒHashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒHashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºHashtableçš„è®¸å¤šæ“ä½œå‡½æ•°éƒ½ç”¨synchronizedä¿®é¥°ã€‚</p></li><li><p><strong>Hashtableä¸HashMapå®ç°çš„æ¥å£ä¸ä¸€è‡´</strong>ï¼Œä½†Hashtableç»§æ‰¿Dictionaryï¼Œè€ŒHashMapç»§æ‰¿è‡ªAbstractMapï¼Œå³çˆ¶ç±»ä¸åŒ</p></li><li><p><strong>é»˜è®¤åˆå§‹å®¹é‡ä¸åŒ</strong>ï¼Œæ‰©å®¹å¤§å°ä¸åŒã€‚HashMapçš„hashæ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯16ï¼Œè€Œä¸”ä¸€å®šæ˜¯2 çš„æŒ‡æ•°<code>old*2</code>ï¼›Hashtableä¸­hashæ•°ç»„é»˜è®¤å¤§å°æ˜¯11ï¼Œå¢åŠ çš„æ–¹å¼æ˜¯<code>old*2+1</code>ã€‚</p></li></ol><h5 id="6-2-ConcurrentHashMap-å’Œ-Hashtable-çš„åŒºåˆ«-ï¼Ÿ">6.2 ConcurrentHashMap <strong>å’Œ</strong> Hashtable <strong>çš„åŒºåˆ«</strong> ï¼Ÿ</h5><p>ConcurrentHashMap å’Œ Hashtable çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä¸Šä¸åŒã€‚</p><ul><li><strong>åº•å±‚æ•°æ®ç»“æ„</strong>ï¼š JDK1.7çš„ ConcurrentHashMap åº•å±‚é‡‡ç”¨<strong>åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨</strong> å®ç°ï¼ŒJDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„â¼€æ ·ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘â¼†å‰æ ‘ã€‚Hashtable å’Œ JDK1.8 ä¹‹å‰çš„HashMap çš„åº•å±‚æ•°æ®ç»“æ„ç±»ä¼¼éƒ½æ˜¯é‡‡ç”¨<strong>æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘</strong> çš„å½¢å¼ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼›</li><li><strong>å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼ˆé‡è¦</strong>ï¼‰ï¼š â‘ <strong>åœ¨JDK1.7</strong>çš„æ—¶å€™ConcurrentHashMapï¼ˆåˆ†æ®µé”ï¼‰ å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†å‰²åˆ†æ®µ(Segment)ï¼Œæ¯â¼€æŠŠé”åªé”å®¹å™¨å…¶ä¸­â¼€éƒ¨åˆ†æ•°æ®ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨â¾¥ä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæé«˜å¹¶å‘è®¿é—®ç‡ã€‚<strong>åˆ°JDK1.8 çš„æ—¶å€™å·²ç»æ‘’å¼ƒäº†Segmentçš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æ¥ç”¨ Node æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨ synchronized å’ŒCAS æ¥æ“ä½œ</strong>ã€‚ï¼ˆJDK1.6ä»¥å å¯¹ synchronizedé”åšäº†å¾ˆå¤šä¼˜åŒ–ï¼‰ <u>æ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„ HashMap</u>ï¼Œè™½ç„¶åœ¨JDK1.8ä¸­è¿˜èƒ½çœ‹åˆ° Segment çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±æ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ï¼›â‘¡ <strong>Hashtable(åŒâ¼€æŠŠé”ï¼Œå…¨è¡¨é”)</strong> :ä½¿ç”¨ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚å½“â¼€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®åŒæ­¥æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿›â¼Šé˜»å¡æˆ–è½®è¯¢çŠ¶æ€ï¼Œå¦‚ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œå¦â¼€ä¸ªçº¿ç¨‹ä¸èƒ½ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ getï¼Œç«äº‰ä¼šè¶Šæ¥è¶Šæ¿€çƒˆæ•ˆç‡è¶Šä½ã€‚</li></ul><h4 id="7-ConcurrentHashMapçº¿ç¨‹å®‰å…¨çš„å…·ä½“å®ç°æ–¹å¼-åº•å±‚å…·ä½“å®ç°-ï¼Ÿ">7.  ConcurrentHashMap<strong>çº¿ç¨‹å®‰å…¨çš„å…·ä½“å®ç°æ–¹å¼</strong>/<strong>åº•å±‚å…·ä½“å®ç°</strong> ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/huangjuncong/p/9478505.html">https://www.cnblogs.com/huangjuncong/p/9478505.html</a></p><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/collection/ConcurrentHashMap%E6%BA%90%E7%A0%81%2B%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90.md">javaGuide</a></p></blockquote><p>Java7 ä¸­ ConcurrentHashMap ä½¿ç”¨çš„åˆ†æ®µé”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª Segment ä¸ŠåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œï¼Œæ¯ä¸€ä¸ª Segment éƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼ HashMap æ•°ç»„çš„ç»“æ„ï¼Œå®ƒå¯ä»¥æ‰©å®¹ï¼Œå®ƒçš„å†²çªä¼šè½¬åŒ–ä¸ºé“¾è¡¨ã€‚ä½†æ˜¯ Segment çš„ä¸ªæ•°ä¸€ä½†åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜ã€‚</p><p>Java8 ä¸­çš„ ConcurrentHashMap ä½¿ç”¨çš„ Synchronized é”åŠ  CAS çš„æœºåˆ¶ã€‚ç»“æ„ä¹Ÿç”± Java7 ä¸­çš„ <strong>Segment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨</strong> è¿›åŒ–æˆäº† <strong>Node æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘</strong>ï¼ŒNode æ˜¯ç±»ä¼¼äºä¸€ä¸ª HashEntry çš„ç»“æ„ã€‚å®ƒçš„å†²çªå†è¾¾åˆ°ä¸€å®šå¤§å°æ—¶ä¼šè½¬åŒ–æˆçº¢é»‘æ ‘ï¼Œåœ¨å†²çªå°äºä¸€å®šæ•°é‡æ—¶åˆé€€å›é“¾è¡¨ã€‚</p><ul><li><p><strong>JDK 1.7 å®ç°</strong></p><p>Java 7 ä¸­ ConcurrentHashMap çš„å­˜å‚¨ç»“æ„å¦‚ä¸‹å›¾ã€‚</p><img src="https://i.loli.net/2021/05/15/iT9npPGIdazS4vw.png" alt="img" style="zoom:150%;" /><ul><li><p><strong>å­˜å‚¨ç»“æ„</strong></p><p>ConcurrentHashMap ä¸ºäº†æé«˜æœ¬èº«çš„å¹¶å‘èƒ½åŠ›ï¼Œåœ¨å†…éƒ¨é‡‡ç”¨äº†ä¸€ä¸ªå«åš Segment çš„ç»“æ„ï¼Œ<strong>ä¸€ä¸ª Segment å…¶å®å°±æ˜¯ä¸€ä¸ªç±» HashTable çš„ç»“æ„</strong>ï¼ŒSegment å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨æ•°ç»„ã€‚</p><blockquote><p><strong>ä¸¤æ¬¡Hash</strong>ã€‚ConcurrentHashMap å®šä½ä¸€ä¸ªå…ƒç´ çš„è¿‡ç¨‹éœ€è¦è¿›è¡Œä¸¤æ¬¡Hashæ“ä½œï¼Œç¬¬ä¸€æ¬¡ Hash å®šä½åˆ° Segmentï¼Œç¬¬äºŒæ¬¡ Hash å®šä½åˆ°å…ƒç´ æ‰€åœ¨çš„é“¾è¡¨çš„å¤´éƒ¨ã€‚</p><p>å› æ­¤ï¼Œè¿™ä¸€ç§ç»“æ„çš„å¸¦æ¥çš„å‰¯ä½œç”¨æ˜¯ Hash çš„è¿‡ç¨‹è¦æ¯”æ™®é€šçš„ HashMap è¦é•¿ï¼Œä½†æ˜¯å¸¦æ¥çš„å¥½å¤„æ˜¯å†™æ“ä½œçš„æ—¶å€™å¯ä»¥åªå¯¹å…ƒç´ æ‰€åœ¨çš„ Segment è¿›è¡Œæ“ä½œå³å¯ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ Segmentã€‚</p></blockquote><p><strong>1. ConcurrentHashMapçš„æˆå‘˜å˜é‡å’Œæ„é€ å‡½æ•°</strong></p><blockquote><p><strong>ConcurrentHashMapæ‰©å®¹</strong>ï¼š å…ƒç´ æ•°é‡å¢åŠ å¯¼è‡´ConrruentHashMapéœ€è¦æ‰©å®¹ï¼ŒConcurrentHashMapä¸ä¼šå¢åŠ Segmentçš„æ•°é‡ï¼Œè€Œ<strong>åªä¼šå¢åŠ Segmentä¸­é“¾è¡¨æ•°ç»„çš„å®¹é‡å¤§å°</strong>ã€‚ éœ€è¦å¯¹æ•´ä¸ªConcurrentHashMapåšrehashï¼Œè€Œåªéœ€è¦å¯¹Segmenté‡Œé¢çš„å…ƒç´ åšä¸€æ¬¡rehashå°±å¯ä»¥äº†ã€‚</p></blockquote><p>æ ¸å¿ƒåˆå§‹åŒ–å‡½æ•°é€»è¾‘å¦‚ä¸‹ï¼š</p><blockquote><p>2çš„æŒ‡æ•°æ˜¯ä¸ºäº†å¯ä»¥ä½¿ç”¨ç§»ä½æ“ä½œåŠ å¿«hashè®¡ç®—è¿‡ç¨‹ã€‚</p></blockquote><ol><li><p>è®¡ç®—å‡ºSegmentçš„æ•°é‡<code>ssize</code>ï¼Œæ˜¯ä¸å¤§äºconcurrencyLevelçš„æœ€å¤§çš„2çš„æŒ‡æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ssize = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (ssize &lt; concurrencyLevel) &#123;</span><br><span class="line">          ++sshift; </span><br><span class="line">           ssize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ ¹æ®intialCapacityç¡®å®šSegmentçš„å®¹é‡çš„å¤§å°ï¼Œæ¯ä¸€ä¸ªSegmentçš„å®¹é‡å¤§å°ä¹Ÿæ˜¯2çš„æŒ‡æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> c = initialCapacity / ssize;</span><br><span class="line"><span class="keyword">if</span> (c * ssize &lt; initialCapacity)</span><br><span class="line">      ++c;</span><br><span class="line">      <span class="keyword">int</span> cap = MIN_SEGMENT_TABLE_CAPACITY;</span><br><span class="line">      <span class="keyword">while</span> (cap &lt; c)</span><br><span class="line">            cap &lt;&lt;= <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li></ol><p>ä¸‹é¢æ˜¯å®Œæ•´ä»£ç ï¼š</p><blockquote><ul><li>segmentShift åç§»é‡ï¼Œè¿™ä¸ªå€¼ä¸ºã€å®¹é‡ = 2 çš„Næ¬¡æ–¹ã€‘ä¸­çš„ Nï¼Œåœ¨åé¢ Put æ—¶è®¡ç®—ä½ç½®æ—¶ä¼šç”¨åˆ° <strong>ã€‚é»˜è®¤æ˜¯ 32 - sshift = 28</strong></li><li>segmentMaskï¼Œé»˜è®¤æ˜¯ ssize - 1 = 16 -1 = 15</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤åˆå§‹å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"><span class="comment">// é»˜è®¤åŠ è½½å› å­</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"><span class="comment">// é»˜è®¤segmentå±‚çº§</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CONCURRENCY_LEVEL = <span class="number">16</span>;</span><br><span class="line"><span class="comment">// æœ€å¤§å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"><span class="comment">// segmentæœ€å°å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_SEGMENT_TABLE_CAPACITY = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// ä¸€ä¸ªsegmentæœ€å¤§å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SEGMENTS = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line"><span class="comment">// é”ä¹‹å‰é‡è¯•æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RETRIES_BEFORE_LOCK = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°ï¼šæ— å‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR, DEFAULT_CONCURRENCY_LEVEL);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°ï¼šæŒ‡å®šåˆå§‹å®¹é‡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR, DEFAULT_CONCURRENCY_LEVEL);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°ï¼šæŒ‡å®šåˆå§‹å®¹é‡ï¼Œè´Ÿè½½å› å­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(initialCapacity, loadFactor, DEFAULT_CONCURRENCY_LEVEL);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°ï¼šæŒ‡å®šåˆå§‹å®¹é‡ï¼Œè´Ÿè½½å› å­ï¼Œå¹¶å‘çº§åˆ«</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="keyword">float</span> loadFactor, <span class="keyword">int</span> concurrencyLevel)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(loadFactor &gt; <span class="number">0</span>) || initialCapacity &lt; <span class="number">0</span> || concurrencyLevel &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">if</span> (concurrencyLevel &gt; MAX_SEGMENTS)</span><br><span class="line">            concurrencyLevel = MAX_SEGMENTS;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ä¸¤ç§å¤§å°çš„æœ€åŒ¹é…å‚æ•°</span></span><br><span class="line">        <span class="keyword">int</span> sshift = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// segmentæ•°ç»„çš„é•¿åº¦æ˜¯ç”±concurrentLevelè®¡ç®—æ¥çš„ï¼Œsegmentæ•°ç»„çš„é•¿åº¦æ˜¯2çš„Næ¬¡æ–¹ï¼Œ</span></span><br><span class="line">        <span class="comment">// é»˜è®¤concurrencyLevel = 16, æ‰€ä»¥ssizeåœ¨é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯16,æ­¤æ—¶ sshift = 4</span></span><br><span class="line">        <span class="comment">// sshiftç›¸å½“äºssizeä»1å‘å·¦ç§»çš„æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">int</span> ssize = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (ssize &lt; concurrencyLevel) &#123;</span><br><span class="line">            ++sshift; </span><br><span class="line">            ssize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ®µåç§»é‡ï¼Œé»˜è®¤å€¼æƒ…å†µä¸‹æ­¤æ—¶segmentShift = 28</span></span><br><span class="line">        <span class="keyword">this</span>.segmentShift = <span class="number">32</span> - sshift;</span><br><span class="line">        <span class="comment">// æ•£åˆ—ç®—æ³•çš„æ©ç ï¼Œé»˜è®¤å€¼æƒ…å†µä¸‹segmentMask = 15</span></span><br><span class="line">        <span class="keyword">this</span>.segmentMask = ssize - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">            initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> c = initialCapacity / ssize;</span><br><span class="line">        <span class="keyword">if</span> (c * ssize &lt; initialCapacity)</span><br><span class="line">            ++c;</span><br><span class="line">        <span class="keyword">int</span> cap = MIN_SEGMENT_TABLE_CAPACITY;</span><br><span class="line">        <span class="keyword">while</span> (cap &lt; c)</span><br><span class="line">            cap &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// create segments and segments[0]</span></span><br><span class="line">        Segment&lt;K,V&gt; s0 =</span><br><span class="line">            <span class="keyword">new</span> Segment&lt;K,V&gt;(loadFactor, (<span class="keyword">int</span>)(cap * loadFactor),</span><br><span class="line">                             (HashEntry&lt;K,V&gt;[])<span class="keyword">new</span> HashEntry[cap]);</span><br><span class="line">        <span class="comment">// åˆ›å»ºssizeé•¿åº¦çš„Segmentæ•°ç»„</span></span><br><span class="line">        Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])<span class="keyword">new</span> Segment[ssize];</span><br><span class="line">        UNSAFE.putOrderedObject(ss, SBASE, s0); <span class="comment">// ordered write of segments[0]</span></span><br><span class="line">        <span class="keyword">this</span>.segments = ss;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><strong>2.æ¥æŸ¥çœ‹å…·ä½“ä»£ç å®šä¹‰ï¼ŒSegmentçš„æˆå‘˜å˜é‡</strong>ï¼š</p><blockquote><p>Segment ç»§æ‰¿äº ReentrantLockï¼Œä¸ä¼šåƒ HashTable é‚£æ ·ä¸ç®¡æ˜¯ put è¿˜æ˜¯ get æ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç†ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Segment</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> count;    <span class="comment">//Segmentä¸­å…ƒç´ çš„æ•°é‡</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> modCount;      <span class="comment">//å¯¹tableçš„å¤§å°é€ æˆå½±å“çš„æ“ä½œçš„æ•°é‡(æ¯”å¦‚putæˆ–è€…removeæ“ä½œ)</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> threshold;    <span class="comment">//é˜ˆå€¼,Segmenté‡Œé¢å…ƒç´ çš„æ•°é‡è¶…è¿‡è¿™ä¸ªå€¼é‚£ä¹ˆå°±ä¼šå¯¹Segmentè¿›è¡Œæ‰©å®¹</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;   <span class="comment">//è´Ÿè½½å› å­,ç”¨äºç¡®å®šthreshold</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;    <span class="comment">//é“¾è¡¨æ•°ç»„,æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä»£è¡¨äº†ä¸€ä¸ªé“¾è¡¨çš„å¤´éƒ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. ç»§ç»­æŸ¥çœ‹HashEntryç»„æˆ</strong>ï¼š</p><blockquote><p>å’Œ HashMap éå¸¸ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å…¶ä¸­çš„æ ¸å¿ƒæ•°æ®å¦‚ <strong>value ï¼Œä»¥åŠé“¾è¡¨éƒ½æ˜¯ volatile ä¿®é¥°çš„</strong>ï¼Œä¿è¯äº†è·å–æ—¶çš„å¯è§æ€§ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    ã€€<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ConcurrentHashMapåˆ—è¡¨Entryã€‚æ³¨æ„ï¼Œè¿™ä¸ä¼šä½œä¸ºç”¨æˆ·å¯è§çš„Map.Entryå¯¼å‡ºã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HashEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    <span class="keyword">volatile</span> V value;</span><br><span class="line">    <span class="keyword">volatile</span> HashEntry&lt;K,V&gt; next;</span><br><span class="line">    </span><br><span class="line">    HashEntry(<span class="keyword">int</span> hash, K key, V value, HashEntry&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.hash = hash;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®å…·æœ‰volatileå†™è¯­ä¹‰çš„nextå­—æ®µã€‚</span></span><br><span class="line">  <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(HashEntry&lt;K,V&gt; n)</span> </span>&#123;</span><br><span class="line">      UNSAFE.putOrderedObject(<span class="keyword">this</span>, nextOffset, n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸‹é¢ä¸å¤ªé‡è¦ï¼Œç•¥ã€‚</span></span><br></pre></td></tr></table></figure></li><li><p><strong>put() æ–¹æ³•å®ç°</strong></p><blockquote><p>ç›¸æ¯”Hashtableï¼Œ1.7ç‰ˆæœ¬concurrentHashmapçš„æ›´åŠ ç»†ç²’åº¦ï¼Œåªæœ‰å®šä½åˆ°æ®µï¼Œæ‰ä¼šé”ä½ã€‚ä¹Ÿå°±æ˜¯æ®µé”ï¼</p><p>è€ŒHashtableç›´æ¥é”ä½æ•´ä¸ªæ–¹æ³•ã€‚</p></blockquote><ol><li><p>è®¡ç®—keyçš„hashå€¼ ;</p></li><li><p>æ ¹æ®<strong>hashå€¼ï¼ŒsegmentShiftï¼ŒsegmentMaskå®šä½åˆ°å“ªä¸ªSegment</strong>ï¼›</p></li><li><p>å¦‚æœæŒ‡å®šä½ç½®çš„ Segment ä¸ºç©ºï¼Œåˆ™åˆå§‹åŒ–è¿™ä¸ª Segmentï¼›</p></li><li><p>åœ¨å¯¹åº”çš„ Segment ä¸­è¿›è¡Œå…·ä½“çš„ putã€‚</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    Segment&lt;K,V&gt; s;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">    <span class="comment">// hash å€¼æ— ç¬¦å·å³ç§» 28ä½ï¼ˆåˆå§‹åŒ–æ—¶è·å¾—ï¼‰ï¼Œç„¶åä¸ segmentMask=15 åšä¸è¿ç®—</span></span><br><span class="line">    <span class="comment">// å…¶å®ä¹Ÿå°±æ˜¯æŠŠé«˜4ä½ä¸segmentMaskï¼ˆ1111ï¼‰åšä¸è¿ç®—</span></span><br><span class="line">    <span class="keyword">int</span> j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask;</span><br><span class="line">    <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject          <span class="comment">// nonvolatile; recheck</span></span><br><span class="line">         (segments, (j &lt;&lt; SSHIFT) + SBASE)) == <span class="keyword">null</span>) <span class="comment">//  in ensureSegment</span></span><br><span class="line">        <span class="comment">// å¦‚æœæŸ¥æ‰¾åˆ°çš„ Segment ä¸ºç©ºï¼Œåˆå§‹åŒ–</span></span><br><span class="line">        s = ensureSegment(j);</span><br><span class="line">    <span class="keyword">return</span> s.put(key, hash, value, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Segment ä¸­è¿›è¡Œå…·ä½“çš„ putçš„æºç å¦‚ä¸‹ï¼š</p><blockquote><p>åˆ¤æ–­å…ƒç´ ä¸ªæ•°æ˜¯å¦è¶…è¿‡äº†é˜ˆå€¼æˆ–è€…segmentä¸­æ•°ç»„çš„é•¿åº¦è¶…è¿‡äº†MAXIMUM_CAPACITYï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶åˆ™rehashæ‰©å®¹ï¼</p></blockquote><p>ç”±äº Segment ç»§æ‰¿äº† ReentrantLockï¼Œæ‰€ä»¥ Segment å†…éƒ¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–é”ï¼Œput æµç¨‹å°±ç”¨åˆ°äº†è¿™ä¸ªåŠŸèƒ½ã€‚</p><ol><li><p>tryLock() è·å–é”ï¼Œè·å–ä¸åˆ°ä½¿ç”¨<code>scanAndLockForPut</code>æ–¹æ³•ç»§ç»­è·å–ï¼›</p><blockquote><p>è¿™é‡Œé¢çš„ç¬¬ä¸€æ­¥ä¸­çš„ scanAndLockForPut æ“ä½œè¿™é‡Œæ²¡æœ‰ä»‹ç»ï¼Œè¿™ä¸ªæ–¹æ³•åšçš„æ“ä½œå°±æ˜¯ä¸æ–­çš„è‡ªæ—‹ <code>tryLock()</code> è·å–é”ã€‚å½“è‡ªæ—‹æ¬¡æ•°å¤§äºæŒ‡å®šæ¬¡æ•°æ—¶ï¼Œä½¿ç”¨ <code>lock()</code> é˜»å¡è·å–é”ã€‚</p></blockquote></li><li><p>è®¡ç®— put çš„æ•°æ®è¦æ”¾å…¥çš„ index ä½ç½®ï¼Œç„¶åè·å–è¿™ä¸ªä½ç½®ä¸Šçš„ HashEntry ï¼›</p></li><li><p>éå† put æ–°å…ƒç´ ï¼Œä¸ºä»€ä¹ˆè¦éå†ï¼Ÿå› ä¸ºè¿™é‡Œè·å–çš„ HashEntry å¯èƒ½æ˜¯ä¸€ä¸ªç©ºå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯é“¾è¡¨å·²å­˜åœ¨ï¼Œæ‰€ä»¥è¦åŒºåˆ«å¯¹å¾…ï¼›</p><p>å¦‚æœè¿™ä¸ªä½ç½®ä¸Šçš„ <strong>HashEntry ä¸å­˜åœ¨</strong>ï¼š</p><ol><li>å¦‚æœå½“å‰å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œ<strong>è¿›è¡Œæ‰©å®¹</strong>ã€‚</li><li>ç›´æ¥<strong>å¤´æ’æ³•</strong>æ’å…¥ã€‚</li></ol><p>å¦‚æœè¿™ä¸ªä½ç½®ä¸Šçš„ <strong>HashEntry å­˜åœ¨</strong>ï¼š</p><ol><li>åˆ¤æ–­é“¾è¡¨å½“å‰å…ƒç´  Key å’Œ hash å€¼æ˜¯å¦å’Œè¦ put çš„ key å’Œ hash å€¼ä¸€è‡´ï¼Œ<strong>ä¸€è‡´åˆ™æ›¿æ¢å€¼</strong></li><li>ä¸ä¸€è‡´ï¼Œ<u>è·å–é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</u>ï¼Œç›´åˆ°å‘ç°ç›¸åŒè¿›è¡Œå€¼æ›¿æ¢ï¼Œæˆ–è€…é“¾è¡¨è¡¨é‡Œå®Œæ¯•æ²¡æœ‰ç›¸åŒçš„ã€‚<ol><li>å¦‚æœå½“å‰å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œ<strong>è¿›è¡Œæ‰©å®¹</strong>ã€‚</li><li>ç›´æ¥é“¾è¡¨<strong>å¤´æ’æ³•</strong>æ’å…¥ã€‚</li></ol></li></ol></li><li><p>å¦‚æœè¦æ’å…¥çš„ä½ç½®ä¹‹å‰å·²ç»å­˜åœ¨ï¼Œæ›¿æ¢åè¿”å›æ—§å€¼ï¼Œå¦åˆ™è¿”å› nullã€‚</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">put</span><span class="params">(K key, <span class="keyword">int</span> hash, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å– ReentrantLock ç‹¬å é”ï¼Œè·å–ä¸åˆ°ï¼ŒscanAndLockForPut è·å–ã€‚</span></span><br><span class="line">    HashEntry&lt;K,V&gt; node = tryLock() ? <span class="keyword">null</span> : scanAndLockForPut(key, hash, value);</span><br><span class="line">    V oldValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        HashEntry&lt;K,V&gt;[] tab = table;</span><br><span class="line">        <span class="comment">// è®¡ç®—è¦putçš„æ•°æ®ä½ç½®</span></span><br><span class="line">        <span class="keyword">int</span> index = (tab.length - <span class="number">1</span>) &amp; hash;</span><br><span class="line">        <span class="comment">// CAS è·å– index åæ ‡çš„å€¼</span></span><br><span class="line">        HashEntry&lt;K,V&gt; first = entryAt(tab, index);</span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = first;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ£€æŸ¥æ˜¯å¦ key å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™éå†é“¾è¡¨å¯»æ‰¾ä½ç½®ï¼Œæ‰¾åˆ°åæ›¿æ¢ value</span></span><br><span class="line">                K k;</span><br><span class="line">                <span class="keyword">if</span> ((k = e.key) == key ||</span><br><span class="line">                    (e.hash == hash &amp;&amp; key.equals(k))) &#123;</span><br><span class="line">                    oldValue = e.value;</span><br><span class="line">                    <span class="keyword">if</span> (!onlyIfAbsent) &#123;</span><br><span class="line">                        e.value = value;</span><br><span class="line">                        ++modCount;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                e = e.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// first æœ‰å€¼æ²¡è¯´æ˜ index ä½ç½®å·²ç»æœ‰å€¼äº†ï¼Œæœ‰å†²çªï¼Œé“¾è¡¨å¤´æ’æ³•ã€‚</span></span><br><span class="line">                <span class="keyword">if</span> (node != <span class="keyword">null</span>)</span><br><span class="line">                    node.setNext(first);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    node = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(hash, key, value, first);</span><br><span class="line">                <span class="keyword">int</span> c = count + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// å®¹é‡å¤§äºæ‰©å®¹é˜€å€¼ï¼Œå°äºæœ€å¤§å®¹é‡ï¼Œè¿›è¡Œæ‰©å®¹</span></span><br><span class="line">                <span class="keyword">if</span> (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)</span><br><span class="line">                    rehash(node);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// index ä½ç½®èµ‹å€¼ nodeï¼Œnode å¯èƒ½æ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨çš„è¡¨å¤´</span></span><br><span class="line">                    setEntryAt(tab, index, node);</span><br><span class="line">                ++modCount;</span><br><span class="line">                count = c;</span><br><span class="line">                oldValue = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ‰©å®¹ rehash</strong></p><blockquote><p>rehashåœ¨put()å†…éƒ¨è¢«è§¦å‘ã€‚</p></blockquote><p>ConcurrentHashMap çš„æ‰©å®¹åªä¼šæ‰©å®¹åˆ°åŸæ¥çš„ä¸¤å€ã€‚è€æ•°ç»„é‡Œçš„æ•°æ®ç§»åŠ¨åˆ°æ–°çš„æ•°ç»„æ—¶ï¼Œ<strong>ä½ç½®è¦ä¹ˆä¸å˜ï¼Œè¦ä¹ˆå˜ä¸º index+ oldSize</strong>ï¼Œå‚æ•°é‡Œçš„ node ä¼šåœ¨æ‰©å®¹ä¹‹åä½¿ç”¨é“¾è¡¨<strong>å¤´æ’æ³•</strong>æ’å…¥åˆ°æŒ‡å®šä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> idx = e.hash &amp; sizeMask;  <span class="comment">// æ–°ä½ç½®è®¡ç®—</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rehash</span><span class="params">(HashEntry&lt;K,V&gt; node)</span> </span>&#123;</span><br><span class="line">    HashEntry&lt;K,V&gt;[] oldTable = table;</span><br><span class="line">    <span class="comment">// è€å®¹é‡</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = oldTable.length;</span><br><span class="line">    <span class="comment">// æ–°å®¹é‡ï¼Œæ‰©å¤§ä¸¤å€</span></span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æ–°çš„æ‰©å®¹é˜€å€¼ </span></span><br><span class="line">    threshold = (<span class="keyword">int</span>)(newCapacity * loadFactor);</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°çš„æ•°ç»„</span></span><br><span class="line">    HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) <span class="keyword">new</span> HashEntry[newCapacity];</span><br><span class="line">    <span class="comment">// æ–°çš„æ©ç ï¼Œé»˜è®¤2æ‰©å®¹åæ˜¯4ï¼Œ-1æ˜¯3ï¼ŒäºŒè¿›åˆ¶å°±æ˜¯11ã€‚</span></span><br><span class="line">    <span class="keyword">int</span> sizeMask = newCapacity - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldCapacity ; i++) &#123;</span><br><span class="line">        <span class="comment">// éå†è€æ•°ç»„</span></span><br><span class="line">        HashEntry&lt;K,V&gt; e = oldTable[i];</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            HashEntry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="comment">// è®¡ç®—æ–°çš„ä½ç½®ï¼Œæ–°çš„ä½ç½®åªå¯èƒ½æ˜¯ä¸å˜æˆ–è€…æ˜¯ï¼šè€çš„ä½ç½®+è€çš„å®¹é‡ã€‚</span></span><br><span class="line">            <span class="keyword">int</span> idx = e.hash &amp; sizeMask;</span><br><span class="line">            <span class="keyword">if</span> (next == <span class="keyword">null</span>)   <span class="comment">//  Single node on list</span></span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰ä½ç½®è¿˜ä¸æ˜¯é“¾è¡¨ï¼Œåªæ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œç›´æ¥èµ‹å€¼</span></span><br><span class="line">                newTable[idx] = e;</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">// Reuse consecutive sequence at same slot</span></span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯é“¾è¡¨äº†</span></span><br><span class="line">                HashEntry&lt;K,V&gt; lastRun = e;</span><br><span class="line">                <span class="keyword">int</span> lastIdx = idx;</span><br><span class="line">                <span class="comment">// æ–°çš„ä½ç½®åªå¯èƒ½æ˜¯ä¸å˜æˆ–è€…æ˜¯ï¼šè€çš„ä½ç½®+è€çš„å®¹é‡ã€‚</span></span><br><span class="line">                <span class="comment">// éå†ç»“æŸåï¼ŒlastRun åé¢çš„å…ƒç´ ä½ç½®éƒ½æ˜¯ç›¸åŒçš„</span></span><br><span class="line">                <span class="keyword">for</span> (HashEntry&lt;K,V&gt; last = next; last != <span class="keyword">null</span>; last = last.next) &#123;</span><br><span class="line">                    <span class="keyword">int</span> k = last.hash &amp; sizeMask;</span><br><span class="line">                    <span class="keyword">if</span> (k != lastIdx) &#123;</span><br><span class="line">                        lastIdx = k;</span><br><span class="line">                        lastRun = last;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ï¼ŒlastRun åé¢çš„å…ƒç´ ä½ç½®éƒ½æ˜¯ç›¸åŒçš„ï¼Œç›´æ¥ä½œä¸ºé“¾è¡¨èµ‹å€¼åˆ°æ–°ä½ç½®ã€‚</span></span><br><span class="line">                newTable[lastIdx] = lastRun;</span><br><span class="line">                <span class="comment">// Clone remaining nodes</span></span><br><span class="line">                <span class="keyword">for</span> (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123;</span><br><span class="line">                    <span class="comment">// éå†å‰©ä½™å…ƒç´ ï¼Œå¤´æ’æ³•åˆ°æŒ‡å®š k ä½ç½®ã€‚</span></span><br><span class="line">                    V v = p.value;</span><br><span class="line">                    <span class="keyword">int</span> h = p.hash;</span><br><span class="line">                    <span class="keyword">int</span> k = h &amp; sizeMask;</span><br><span class="line">                    HashEntry&lt;K,V&gt; n = newTable[k];</span><br><span class="line">                    newTable[k] = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(h, p.key, v, n);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤´æ’æ³•æ’å…¥æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">int</span> nodeIndex = node.hash &amp; sizeMask; <span class="comment">// add the new node</span></span><br><span class="line">    node.setNext(newTable[nodeIndex]);</span><br><span class="line">    newTable[nodeIndex] = node;</span><br><span class="line">    table = newTable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>getæ–¹æ³•</strong></p><blockquote><p>æ³¨æ„ï¼ŒHashtable ä¼šä½¿ç”¨Synchronizedè¿›è¡Œä¿®é¥°ï¼Œæ‰€ä»¥ä¸æ”¯æŒå¹¶å‘ã€‚ä½†æ˜¯ConcurrentHashmap <strong>æ²¡æœ‰ä½¿ç”¨åŒæ­¥æœºåˆ¶</strong>ï¼š</p><ul><li>1.7ç‰ˆæœ¬ <strong>ã€‚ä½¿ç”¨unsafeæ–¹æ³•ï¼ˆï¼‰ç­‰æ–¹å¼ç›´æ¥æ“ä½œæ¥ä¿è¯å¹¶å‘å¤„ç†çš„å®‰å…¨æ€§</strong>ï¼Œä½¿ç”¨çš„æ˜¯ç¡¬ä»¶çš„å®‰å…¨æœºåˆ¶ã€‚</li><li>1.8ç‰ˆæœ¬ã€‚æ²¡æœ‰ä½¿ç”¨åŒæ­¥ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨unsafeæ–¹å¼ã€‚æ‰€ä»¥<strong>æ˜¯å¹¶å‘</strong>çš„ã€‚</li></ul></blockquote><ul><li><p>åˆ°è¿™é‡Œå°±å¾ˆç®€å•äº†ï¼Œget æ–¹æ³•åªéœ€è¦ä¸¤æ­¥å³å¯ã€‚</p><ol><li>è®¡ç®—å¾—åˆ°segmentçš„ä½ç½® u</li><li><strong>CASæ–¹å¼è·å–segmentæ•°ç»„å¯¹è±¡ segment[u]</strong></li><li>è®¡ç®—HashEntryæ•°ç»„çš„ä¸‹æ ‡ i</li><li><strong>CASæ–¹å¼è·å–HashEntry[i]ï¼Œå³æ•°ç»„é¦–èŠ‚ç‚¹</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Segment&lt;K,V&gt; s; <span class="comment">// manually integrate access methods to reduce overhead</span></span><br><span class="line">    HashEntry&lt;K,V&gt;[] tab;</span><br><span class="line">    <span class="keyword">int</span> h = hash(key);</span><br><span class="line">    <span class="keyword">long</span> u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE;</span><br><span class="line">    <span class="comment">// è®¡ç®—å¾—åˆ° key çš„å­˜æ”¾ä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">        (tab = s.table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile</span><br><span class="line">                 (tab, ((<span class="keyword">long</span>)(((tab.length - <span class="number">1</span>) &amp; h)) &lt;&lt; TSHIFT) + TBASE);</span><br><span class="line">             e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†æŸ¥æ‰¾åˆ°ç›¸åŒ key çš„ valueã€‚</span></span><br><span class="line">            K k;</span><br><span class="line">            <span class="keyword">if</span> ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k)))</span><br><span class="line">                <span class="keyword">return</span> e.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p><strong>JDK 1.8 å®ç°</strong></p><blockquote><p>1.8ç‰ˆæœ¬åˆ†æï¼Œå»ºè®®å‚è€ƒï¼š<a href="https://www.cnblogs.com/zerotomax/p/8687425.html">https://www.cnblogs.com/zerotomax/p/8687425.html</a> ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/05/15/F6UhuXNQGKnldVk.png" alt="image-20210515224441806"></p><p>å¯ä»¥å‘ç° Java8 çš„ ConcurrentHashMap ç›¸å¯¹äº Java7 æ¥è¯´å˜åŒ–æ¯”è¾ƒå¤§ï¼Œä¸å†æ˜¯ä¹‹å‰çš„ <strong>Segment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨</strong>ï¼Œè€Œæ˜¯ <strong>Node æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘</strong>ã€‚å½“å†²çªé“¾è¡¨è¾¾åˆ°ä¸€å®šé•¿åº¦æ—¶ï¼Œé“¾è¡¨ä¼šè½¬æ¢æˆçº¢é»‘æ ‘ã€‚</p><blockquote><p>å’ŒJDK1.8çš„HashMapæ˜¯å¾ˆç›¸ä¼¼ , æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† <code>CAS + synchronized</code> æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚</p></blockquote><ul><li><p><strong>å­˜å‚¨ç»“æ„å’Œå±æ€§</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">16</span>; <span class="comment">// hashmapä¹Ÿæ˜¯16</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>; <span class="comment">// è¶…è¿‡8æ‰©å®¹</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>; <span class="comment">// è¶…è¿‡64çº¢é»‘æ ‘</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MOVED     = -<span class="number">1</span>; <span class="comment">// è¡¨ç¤ºæ­£åœ¨è½¬ç§»</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEBIN   = -<span class="number">2</span>; <span class="comment">// è¡¨ç¤ºå·²ç»è½¬æ¢æˆæ ‘</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESERVED  = -<span class="number">3</span>; <span class="comment">// hash for transient reservations</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_BITS = <span class="number">0x7fffffff</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Nodeæ•°ç»„å­˜å‚¨å…ƒç´ </span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] table;<span class="comment">//é»˜è®¤æ²¡åˆå§‹åŒ–çš„æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å…ƒç´ </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] nextTable;<span class="comment">//è½¬ç§»çš„æ—¶å€™ç”¨çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æ¥æ§åˆ¶è¡¨åˆå§‹åŒ–å’Œæ‰©å®¹çš„ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå½“åœ¨åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šäº†å¤§å°ï¼Œè¿™ä¼šå°†è¿™ä¸ªå¤§å°ä¿å­˜åœ¨sizeCtlä¸­ï¼Œå¤§å°ä¸ºæ•°ç»„çš„0.75</span></span><br><span class="line"><span class="comment">     * å½“ä¸ºè´Ÿçš„æ—¶å€™ï¼Œè¯´æ˜è¡¨æ­£åœ¨åˆå§‹åŒ–æˆ–æ‰©å¼ ï¼Œ</span></span><br><span class="line"><span class="comment">     *     -1è¡¨ç¤ºåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     *     -(1+n) n:è¡¨ç¤ºæ´»åŠ¨çš„æ‰©å¼ çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> sizeCtl;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨ConcurrentHashMapä¸­ä½¿ç”¨äº†unSafeæ–¹æ³•ï¼Œé€šè¿‡ç›´æ¥æ“ä½œå†…å­˜çš„æ–¹å¼æ¥ä¿è¯å¹¶å‘å¤„ç†çš„å®‰å…¨æ€§ï¼Œä½¿ç”¨çš„æ˜¯ç¡¬ä»¶çš„å®‰å…¨æœºåˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ç”¨æ¥è¿”å›èŠ‚ç‚¹æ•°ç»„çš„æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹çš„åŸå­æ“ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function">Node&lt;K,V&gt; <span class="title">tabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * casåŸå­æ“ä½œï¼Œåœ¨æŒ‡å®šä½ç½®è®¾å®šå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">casTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> U.compareAndSwapObject(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE, c, v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * åŸå­æ“ä½œï¼Œåœ¨æŒ‡å®šä½ç½®è®¾å®šå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function"><span class="keyword">void</span> <span class="title">setTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i, Node&lt;K,V&gt; v)</span> </span>&#123;</span><br><span class="line">        U.putObjectVolatile(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE, v);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆå§‹åŒ–</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç©ºçš„æ„é€ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMapDebug</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//å¦‚æœåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™æŒ‡å®šäº†å®¹é‡ï¼Œåˆ™åˆå§‹åŒ–sizeCtl</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMapDebug</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="keyword">int</span> cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="number">1</span>)) ?</span><br><span class="line">                   MAXIMUM_CAPACITY :</span><br><span class="line">                   tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; <span class="number">1</span>) + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">this</span>.sizeCtl = cap;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//å½“å‡ºå…¥ä¸€ä¸ªMapçš„æ—¶å€™ï¼Œå…ˆè®¾å®šsizeCtlä¸ºé»˜è®¤å®¹é‡ï¼Œåœ¨æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMapDebug</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sizeCtl = DEFAULT_CAPACITY;</span><br><span class="line">        putAll(m);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>putæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> putVal(key, value, <span class="keyword">false</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹putVal ï¼š</p><blockquote><p>å¯ä»¥å‘ç°ç›¸æ¯”HashTableç›´æ¥å¯¹æ–¹æ³•è¿›è¡ŒåŠ é”synchronized / 1.7ç‰ˆæœ¬çš„ConcurrentHashMap è¿›å…¥çš„å¼€å¤´å°è¯•è·å–é”ï¼Œ1.8ç‰ˆæœ¬çš„ConcurrentHashMap é”æ›´åŠ ç»†ç²’åº¦åŒ–ã€‚</p><ul><li>åªæœ‰ï¼šï¼ˆ1ï¼‰tableä¸ä¸ºåˆå§‹åŒ– ï¼ˆ2ï¼‰å®šä½åˆ°tableä½ç½®<code>i</code>ä¸å­˜åœ¨å…ƒç´ ï¼ˆæ­¤æ—¶ä¼šç”¨CASæ–¹å¼è¿›è¡Œæ·»åŠ ï¼‰ï¼ˆ3ï¼‰æ•°ç»„ä¹Ÿæ²¡æœ‰åœ¨è¿›è¡Œæ‰©å¼ ï¼ˆMOVED=-1ï¼‰</li></ul><p>æ­¤æ—¶æ‰ä¼šè¿›è¡Œsynchronized æ·»åŠ å…ƒç´ ï¼ˆä¸ä¼šé”ä½rehashæ–¹æ³•ï¼Œæœ€åæ‰åˆ¤æ–­æ˜¯å¦æ‰©å®¹ï¼‰ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">     * å½“æ·»åŠ ä¸€å¯¹é”®å€¼å¯¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå»åˆ¤æ–­ä¿å­˜è¿™äº›é”®å€¼å¯¹çš„æ•°ç»„æ˜¯ä¸æ˜¯åˆå§‹åŒ–äº†ï¼Œ</span></span><br><span class="line"><span class="comment">     * å¦‚æœæ²¡æœ‰çš„è¯å°±åˆå§‹åŒ–æ•°ç»„</span></span><br><span class="line"><span class="comment">     *  ç„¶åé€šè¿‡è®¡ç®—hashå€¼æ¥ç¡®å®šæ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®</span></span><br><span class="line"><span class="comment">     * å¦‚æœè¿™ä¸ªä½ç½®ä¸ºç©ºåˆ™ç›´æ¥æ·»åŠ ï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™å–å‡ºè¿™ä¸ªèŠ‚ç‚¹æ¥</span></span><br><span class="line"><span class="comment">     * å¦‚æœå–å‡ºæ¥çš„èŠ‚ç‚¹çš„hashå€¼æ˜¯MOVED(-1)çš„è¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰æ­£åœ¨å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œå¤åˆ¶åˆ°æ–°çš„æ•°ç»„ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿå»å¸®åŠ©å¤åˆ¶</span></span><br><span class="line"><span class="comment">     * æœ€åä¸€ç§æƒ…å†µå°±æ˜¯ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹ï¼Œä¸ä¸ºç©ºï¼Œä¹Ÿä¸åœ¨æ‰©å®¹ï¼Œåˆ™é€šè¿‡synchronizedæ¥åŠ é”ï¼Œè¿›è¡Œæ·»åŠ æ“ä½œ</span></span><br><span class="line"><span class="comment">     *    ç„¶ååˆ¤æ–­å½“å‰å–å‡ºçš„èŠ‚ç‚¹ä½ç½®å­˜æ”¾çš„æ˜¯é“¾è¡¨è¿˜æ˜¯æ ‘</span></span><br><span class="line"><span class="comment">     *    å¦‚æœæ˜¯é“¾è¡¨çš„è¯ï¼Œåˆ™éå†æ•´ä¸ªé“¾è¡¨ï¼Œç›´åˆ°å–å‡ºæ¥çš„èŠ‚ç‚¹çš„keyæ¥ä¸ªè¦æ”¾çš„keyè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœkeyç›¸ç­‰ï¼Œå¹¶ä¸”keyçš„hashå€¼ä¹Ÿç›¸ç­‰çš„è¯ï¼Œ</span></span><br><span class="line"><span class="comment">     *          åˆ™è¯´æ˜æ˜¯åŒä¸€ä¸ªkeyï¼Œåˆ™è¦†ç›–æ‰valueï¼Œå¦åˆ™çš„è¯åˆ™æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾</span></span><br><span class="line"><span class="comment">     *    å¦‚æœæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æŠŠè¿™ä¸ªå…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­å»</span></span><br><span class="line"><span class="comment">     *  æœ€ååœ¨æ·»åŠ å®Œæˆä¹‹åï¼Œä¼šåˆ¤æ–­åœ¨è¯¥èŠ‚ç‚¹å¤„å…±æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼ˆæ³¨æ„æ˜¯æ·»åŠ å‰çš„ä¸ªæ•°ï¼‰ï¼Œå¦‚æœè¾¾åˆ°8ä¸ªä»¥ä¸Šäº†çš„è¯ï¼Œ</span></span><br><span class="line"><span class="comment">     *  åˆ™è°ƒç”¨treeifyBinæ–¹æ³•æ¥å°è¯•å°†å¤„çš„é“¾è¡¨è½¬ä¸ºæ ‘ï¼Œæˆ–è€…æ‰©å®¹æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();<span class="comment">//K,Véƒ½ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™çš„è¯è·‘å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">int</span> hash = spread(key.hashCode());    <span class="comment">//å–å¾—keyçš„hashå€¼</span></span><br><span class="line">        <span class="keyword">int</span> binCount = <span class="number">0</span>;    <span class="comment">//ç”¨æ¥è®¡ç®—åœ¨è¿™ä¸ªèŠ‚ç‚¹æ€»å…±æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œç”¨æ¥æ§åˆ¶æ‰©å®¹æˆ–è€…è½¬ç§»ä¸ºæ ‘</span></span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;    <span class="comment">//</span></span><br><span class="line">            Node&lt;K,V&gt; f; <span class="keyword">int</span> n, i, fh;</span><br><span class="line">            <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)    </span><br><span class="line">                tab = initTable();    <span class="comment">//ç¬¬ä¸€æ¬¡putçš„æ—¶å€™tableæ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–table</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123;    <span class="comment">//é€šè¿‡å“ˆå¸Œè®¡ç®—å‡ºä¸€ä¸ªè¡¨ä¸­çš„ä½ç½®å› ä¸ºnæ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œæ‰€ä»¥(n-1)&amp;hashè‚¯å®šä¸ä¼šå‡ºç°æ•°ç»„è¶Šç•Œ</span></span><br><span class="line">                <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,        <span class="comment">//å¦‚æœè¿™ä¸ªä½ç½®æ²¡æœ‰å…ƒç´ çš„è¯ï¼Œåˆ™é€šè¿‡casçš„æ–¹å¼å°è¯•æ·»åŠ ï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰åŠ é”çš„</span></span><br><span class="line">                             <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>)))        <span class="comment">//åˆ›å»ºä¸€ä¸ªNodeæ·»åŠ åˆ°æ•°ç»„ä¸­åŒºï¼Œnullè¡¨ç¤ºçš„æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º</span></span><br><span class="line">                    <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * å¦‚æœæ£€æµ‹åˆ°æŸä¸ªèŠ‚ç‚¹çš„hashå€¼æ˜¯MOVEDï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨è¿›è¡Œæ•°ç»„æ‰©å¼ çš„æ•°æ®å¤åˆ¶é˜¶æ®µï¼Œ</span></span><br><span class="line"><span class="comment">             * åˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¼šå‚ä¸å»å¤åˆ¶ï¼Œé€šè¿‡å…è®¸å¤šçº¿ç¨‹å¤åˆ¶çš„åŠŸèƒ½ï¼Œä¸€æ¬¡æ¥å‡å°‘æ•°ç»„çš„å¤åˆ¶æ‰€å¸¦æ¥çš„æ€§èƒ½æŸå¤±</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)    </span><br><span class="line">                tab = helpTransfer(tab, f);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * å¦‚æœåœ¨è¿™ä¸ªä½ç½®æœ‰å…ƒç´ çš„è¯ï¼Œå°±é‡‡ç”¨synchronizedçš„æ–¹å¼åŠ é”ï¼Œ</span></span><br><span class="line"><span class="comment">                 *     å¦‚æœæ˜¯é“¾è¡¨çš„è¯(hashå¤§äº0)ï¼Œå°±å¯¹è¿™ä¸ªé“¾è¡¨çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œéå†ï¼Œ</span></span><br><span class="line"><span class="comment">                 *         å¦‚æœæ‰¾åˆ°äº†keyå’Œkeyçš„hashå€¼éƒ½ä¸€æ ·çš„èŠ‚ç‚¹ï¼Œåˆ™æŠŠå®ƒçš„å€¼æ›¿æ¢åˆ°</span></span><br><span class="line"><span class="comment">                 *         å¦‚æœæ²¡æ‰¾åˆ°çš„è¯ï¼Œåˆ™æ·»åŠ åœ¨é“¾è¡¨çš„æœ€åé¢</span></span><br><span class="line"><span class="comment">                 *  å¦åˆ™ï¼Œæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æ·»åŠ åˆ°æ ‘ä¸­å»</span></span><br><span class="line"><span class="comment">                 *  </span></span><br><span class="line"><span class="comment">                 *  åœ¨æ·»åŠ å®Œä¹‹åï¼Œä¼šå¯¹è¯¥èŠ‚ç‚¹ä¸Šå…³è”çš„çš„æ•°ç›®è¿›è¡Œåˆ¤æ–­ï¼Œ</span></span><br><span class="line"><span class="comment">                 *  å¦‚æœåœ¨8ä¸ªä»¥ä¸Šçš„è¯ï¼Œåˆ™ä¼šè°ƒç”¨treeifyBinæ–¹æ³•ï¼Œæ¥å°è¯•è½¬åŒ–ä¸ºæ ‘ï¼Œæˆ–è€…æ˜¯æ‰©å®¹</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                V oldVal = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;        <span class="comment">//å†æ¬¡å–å‡ºè¦å­˜å‚¨çš„ä½ç½®çš„å…ƒç´ ï¼Œè·Ÿå‰é¢å–å‡ºæ¥çš„æ¯”è¾ƒ</span></span><br><span class="line">                        <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;                <span class="comment">//å–å‡ºæ¥çš„å…ƒç´ çš„hashå€¼å¤§äº0ï¼Œå½“è½¬æ¢ä¸ºæ ‘ä¹‹åï¼Œhashå€¼ä¸º-2</span></span><br><span class="line">                            binCount = <span class="number">1</span>;            </span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;    <span class="comment">//éå†è¿™ä¸ªé“¾è¡¨</span></span><br><span class="line">                                K ek;</span><br><span class="line">                                <span class="keyword">if</span> (e.hash == hash &amp;&amp;        <span class="comment">//è¦å­˜çš„å…ƒç´ çš„hashï¼Œkeyè·Ÿè¦å­˜å‚¨çš„ä½ç½®çš„èŠ‚ç‚¹çš„ç›¸åŒçš„æ—¶å€™ï¼Œæ›¿æ¢æ‰è¯¥èŠ‚ç‚¹çš„valueå³å¯</span></span><br><span class="line">                                    ((ek = e.key) == key ||</span><br><span class="line">                                     (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                    oldVal = e.val;</span><br><span class="line">                                    <span class="keyword">if</span> (!onlyIfAbsent)        <span class="comment">//å½“ä½¿ç”¨putIfAbsentçš„æ—¶å€™ï¼Œåªæœ‰åœ¨è¿™ä¸ªkeyæ²¡æœ‰è®¾ç½®å€¼å¾—æ—¶å€™æ‰è®¾ç½®</span></span><br><span class="line">                                        e.val = value;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                Node&lt;K,V&gt; pred = e;</span><br><span class="line">                                <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>) &#123;    <span class="comment">//å¦‚æœä¸æ˜¯åŒæ ·çš„hashï¼ŒåŒæ ·çš„keyçš„æ—¶å€™ï¼Œåˆ™åˆ¤æ–­è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œ</span></span><br><span class="line">                                    pred.next = <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key,        <span class="comment">//ä¸ºç©ºçš„è¯æŠŠè¿™ä¸ªè¦åŠ å…¥çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                                                              value, <span class="keyword">null</span>);</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;    <span class="comment">//è¡¨ç¤ºå·²ç»è½¬åŒ–æˆçº¢é»‘æ ‘ç±»å‹äº†</span></span><br><span class="line">                            Node&lt;K,V&gt; p;</span><br><span class="line">                            binCount = <span class="number">2</span>;</span><br><span class="line">                            <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,    <span class="comment">//è°ƒç”¨putTreeValæ–¹æ³•ï¼Œå°†è¯¥å…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­å»</span></span><br><span class="line">                                                           value)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                oldVal = p.val;</span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    p.val = value;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)    <span class="comment">//å½“åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹çš„æ•°ç›®è¾¾åˆ°8ä¸ªçš„æ—¶å€™ï¼Œåˆ™æ‰©å¼ æ•°ç»„æˆ–å°†ç»™èŠ‚ç‚¹çš„æ•°æ®è½¬ä¸ºtree</span></span><br><span class="line">                        treeifyBin(tab, i);    </span><br><span class="line">                    <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">return</span> oldVal;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        addCount(<span class="number">1L</span>, binCount);    <span class="comment">//è®¡æ•°ï¼Œå¯èƒ½ä¹Ÿä¼šè§¦å‘æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>æ‰©å®¹<code>transfer</code></p><blockquote><p>æ‰©å®¹ä¸»è¦æ˜¯é€šè¿‡transferæ–¹æ³•æ¥è¿›è¡Œçš„ã€‚</p><ul><li>åªæœ‰åœ¨å¾€mapä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œåœ¨æŸä¸€ä¸ªèŠ‚ç‚¹çš„æ•°ç›®å·²ç»è¶…è¿‡äº†8ä¸ªï¼Œè°ƒç”¨<strong>treeifyBin()</strong> è§¦å‘æ•°ç»„çš„æ‰©å®¹/è½¬æ¢ä¸ºæ•°ï¼›</li><li>ä½¿ç”¨**addCount()**æ·»åŠ å…ƒç´ æ•°ç»„å…ƒç´ ï¼Œä¼šè¿›è¡Œåˆ¤æ–­è¾¾åˆ°äº†sizeCtlçš„æ•°é‡çš„æ—¶å€™ï¼Œåˆ™ä¼šè°ƒç”¨transferæ–¹æ³•æ¥è¿›è¡Œæ‰©å®¹</li></ul></blockquote><ul><li><p><strong>treeifyBin()</strong></p><p>æŸä¸€ä¸ªèŠ‚ç‚¹çš„æ•°ç›®å·²ç»è¶…è¿‡äº†8ä¸ªï¼Œæ‰§è¡ŒtreeifyBin() ã€‚</p><ol><li><p>å½“éœ€è¦æ‰©å®¹çš„æ—¶å€™ï¼Œè°ƒç”¨çš„æ—¶å€™tryPresizeæ–¹æ³•</p><p>ï¼ˆ1ï¼‰<strong>tryPresizeæ–¹æ³•å¹¶æ²¡æœ‰åŠ é”</strong>ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹è¿›å…¥ï¼Œå¦‚æœæ•°ç»„æ­£åœ¨æ‰©å¼ ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿå»å¸®åŠ©æ‰©å®¹ä½¿ç”¨<strong>transfer</strong>æ–¹æ³•</p><p>ï¼ˆ2ï¼‰<u>transferæ¯”è¾ƒå¤æ‚è¿˜æ²¡æœ‰è¯¦ç»†çœ‹ï¼Œå®ƒé‡Œé¢ä½¿ç”¨çš„synchronized è¿›è¡Œå•ä¸ªèŠ‚ç‚¹å¤„ç†æ‰©å®¹</u>  ï¼ˆæŸ¥çœ‹ä¸Šé¢çœ‹transferæºç ï¼‰</p></li><li><p>å¦åˆ™synchronizedè¿›è¡Œé“¾è¡¨è½¬æ¢ä¸ºæ ‘</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">     * å½“æ•°ç»„é•¿åº¦å°äº64çš„æ—¶å€™ï¼Œæ‰©å¼ æ•°ç»„é•¿åº¦ä¸€å€ï¼Œå¦åˆ™çš„è¯æŠŠé“¾è¡¨è½¬ä¸ºæ ‘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt; b; <span class="keyword">int</span> n, sc;</span><br><span class="line">        <span class="keyword">if</span> (tab != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;treeifyBinæ–¹\t==&gt;æ•°ç»„é•¿ï¼š&quot;</span>+tab.length);</span><br><span class="line">            <span class="keyword">if</span> ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY)    <span class="comment">//MIN_TREEIFY_CAPACITY 64</span></span><br><span class="line">                tryPresize(n &lt;&lt; <span class="number">1</span>);        <span class="comment">// æ•°ç»„æ‰©å®¹</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((b = tabAt(tab, index)) != <span class="keyword">null</span> &amp;&amp; b.hash &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (b) &#123;    <span class="comment">//ä½¿ç”¨synchronizedåŒæ­¥å™¨ï¼Œå°†è¯¥èŠ‚ç‚¹å‡ºçš„é“¾è¡¨è½¬ä¸ºæ ‘</span></span><br><span class="line">                    <span class="keyword">if</span> (tabAt(tab, index) == b) &#123;</span><br><span class="line">                        TreeNode&lt;K,V&gt; hd = <span class="keyword">null</span>, tl = <span class="keyword">null</span>;    <span class="comment">//hdï¼šæ ‘çš„å¤´(head)</span></span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; e = b; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">                            TreeNode&lt;K,V&gt; p =</span><br><span class="line">                                <span class="keyword">new</span> TreeNode&lt;K,V&gt;(e.hash, e.key, e.val,</span><br><span class="line">                                                  <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                            <span class="keyword">if</span> ((p.prev = tl) == <span class="keyword">null</span>)        <span class="comment">//æŠŠNodeç»„æˆçš„é“¾è¡¨ï¼Œè½¬åŒ–ä¸ºTreeNodeçš„é“¾è¡¨ï¼Œå¤´ç»“ç‚¹ä»»ç„¶æ”¾åœ¨ç›¸åŒçš„ä½ç½®</span></span><br><span class="line">                                hd = p;    <span class="comment">//è®¾ç½®head</span></span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                tl.next = p;</span><br><span class="line">                            tl = p;</span><br><span class="line">                        &#125;</span><br><span class="line">                        setTabAt(tab, index, <span class="keyword">new</span> TreeBin&lt;K,V&gt;(hd));<span class="comment">//æŠŠTreeNodeçš„é“¾è¡¨æ”¾å…¥å®¹å™¨TreeBinä¸­</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>addCount()</strong></p><p>addCountä¹Ÿä¸»è¦æ˜¯è°ƒç”¨transferï¼Œè¿™é‡Œä¸»è¦è¿˜æ˜¯å¯„ä¸€ä¸‹transferçš„æºç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Moves and/or copies the nodes in each bin to new table. See</span></span><br><span class="line"><span class="comment">     * above for explanation.</span></span><br><span class="line"><span class="comment">     * æŠŠæ•°ç»„ä¸­çš„èŠ‚ç‚¹å¤åˆ¶åˆ°æ–°çš„æ•°ç»„çš„ç›¸åŒä½ç½®ï¼Œæˆ–è€…ç§»åŠ¨åˆ°æ‰©å¼ éƒ¨åˆ†çš„ç›¸åŒä½ç½®</span></span><br><span class="line"><span class="comment">     * åœ¨è¿™é‡Œé¦–å…ˆä¼šè®¡ç®—ä¸€ä¸ªæ­¥é•¿ï¼Œè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„æ•°ç»„é•¿åº¦ï¼Œç”¨æ¥æ§åˆ¶å¯¹CPUçš„ä½¿ç”¨ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ¯ä¸ªCPUæœ€å°‘å¤„ç†16ä¸ªé•¿åº¦çš„æ•°ç»„å…ƒç´ ,ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ•°ç»„çš„é•¿åº¦åªæœ‰16ï¼Œé‚£åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå¯¹å…¶è¿›è¡Œæ‰©å®¹çš„å¤åˆ¶ç§»åŠ¨æ“ä½œ</span></span><br><span class="line"><span class="comment">     * æ‰©å®¹çš„æ—¶å€™ä¼šä¸€ç›´éå†ï¼ŒçŸ¥é“å¤åˆ¶å®Œæ‰€æœ‰èŠ‚ç‚¹ï¼Œæ²¡å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ä¼šåœ¨é“¾è¡¨çš„å¤´éƒ¨è®¾ç½®ä¸€ä¸ªfwdèŠ‚ç‚¹ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±ä¼šè·³è¿‡ä»–ï¼Œ</span></span><br><span class="line"><span class="comment">     * å¤åˆ¶ååœ¨æ–°æ•°ç»„ä¸­çš„é“¾è¡¨ä¸æ˜¯ç»å¯¹çš„ååºçš„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = tab.length, stride;</span><br><span class="line">        <span class="keyword">if</span> ((stride = (NCPU &gt; <span class="number">1</span>) ? (n &gt;&gt;&gt; <span class="number">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)    <span class="comment">//MIN_TRANSFER_STRIDE ç”¨æ¥æ§åˆ¶ä¸è¦å ç”¨å¤ªå¤šCPU</span></span><br><span class="line">            stride = MIN_TRANSFER_STRIDE; <span class="comment">// subdivide range    //MIN_TRANSFER_STRIDE=16</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * å¦‚æœå¤åˆ¶çš„ç›®æ ‡nextTabä¸ºnullçš„è¯ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªtableä¸¤å€é•¿çš„nextTab</span></span><br><span class="line"><span class="comment">         * æ­¤æ—¶nextTableè¢«è®¾ç½®å€¼äº†(åœ¨åˆå§‹æƒ…å†µä¸‹æ˜¯ä¸ºnullçš„)</span></span><br><span class="line"><span class="comment">         * å› ä¸ºå¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹å¼€å§‹äº†è¡¨çš„æ‰©å¼ çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šè¿›æ¥å¸®å¿™æ‰©å¼ ï¼Œ</span></span><br><span class="line"><span class="comment">         * è€Œåªæ˜¯ç¬¬ä¸€ä¸ªå¼€å§‹æ‰©å¼ çš„çº¿ç¨‹éœ€è¦åˆå§‹åŒ–ä¸‹ç›®æ ‡æ•°ç»„</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (nextTab == <span class="keyword">null</span>) &#123;            <span class="comment">// initiating</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">                Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node&lt;?,?&gt;[n &lt;&lt; <span class="number">1</span>];</span><br><span class="line">                nextTab = nt;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ex) &#123;      <span class="comment">// try to cope with OOME</span></span><br><span class="line">                sizeCtl = Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            nextTable = nextTab;</span><br><span class="line">            transferIndex = n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> nextn = nextTab.length;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * åˆ›å»ºä¸€ä¸ªfwdèŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥æ§åˆ¶å¹¶å‘çš„ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºæˆ–å·²ç»è¢«è½¬ç§»ä¹‹åï¼Œå°±è®¾ç½®ä¸ºfwdèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">         * è¿™æ˜¯ä¸€ä¸ªç©ºçš„æ ‡å¿—èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ForwardingNode&lt;K,V&gt; fwd = <span class="keyword">new</span> ForwardingNode&lt;K,V&gt;(nextTab);</span><br><span class="line">        <span class="keyword">boolean</span> advance = <span class="keyword">true</span>;    <span class="comment">//æ˜¯å¦ç»§ç»­å‘å‰æŸ¥æ‰¾çš„æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">boolean</span> finishing = <span class="keyword">false</span>; <span class="comment">// to ensure sweep(æ¸…æ‰«) before committing nextTab,åœ¨å®Œæˆä¹‹å‰é‡æ–°åœ¨æ‰«æä¸€éæ•°ç»„ï¼Œçœ‹çœ‹æœ‰æ²¡å®Œæˆçš„æ²¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, bound = <span class="number">0</span>;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; f; <span class="keyword">int</span> fh;</span><br><span class="line">            <span class="keyword">while</span> (advance) &#123;</span><br><span class="line">                <span class="keyword">int</span> nextIndex, nextBound;</span><br><span class="line">                <span class="keyword">if</span> (--i &gt;= bound || finishing) &#123;</span><br><span class="line">                    advance = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((nextIndex = transferIndex) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    i = -<span class="number">1</span>;</span><br><span class="line">                    advance = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt</span><br><span class="line">                         (<span class="keyword">this</span>, TRANSFERINDEX, nextIndex,</span><br><span class="line">                          nextBound = (nextIndex &gt; stride ?</span><br><span class="line">                                       nextIndex - stride : <span class="number">0</span>))) &#123;</span><br><span class="line">                    bound = nextBound;</span><br><span class="line">                    i = nextIndex - <span class="number">1</span>;</span><br><span class="line">                    advance = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= n || i + n &gt;= nextn) &#123;</span><br><span class="line">                <span class="keyword">int</span> sc;</span><br><span class="line">                <span class="keyword">if</span> (finishing) &#123;        <span class="comment">//å·²ç»å®Œæˆè½¬ç§»</span></span><br><span class="line">                    nextTable = <span class="keyword">null</span>;</span><br><span class="line">                    table = nextTab;</span><br><span class="line">                    sizeCtl = (n &lt;&lt; <span class="number">1</span>) - (n &gt;&gt;&gt; <span class="number">1</span>);    <span class="comment">//è®¾ç½®sizeCtlä¸ºæ‰©å®¹åçš„0.75</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc = sizeCtl, sc - <span class="number">1</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((sc - <span class="number">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) &#123;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    finishing = advance = <span class="keyword">true</span>;</span><br><span class="line">                    i = n; <span class="comment">// recheck before commit</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i)) == <span class="keyword">null</span>)            <span class="comment">//æ•°ç»„ä¸­æŠŠnullçš„å…ƒç´ è®¾ç½®ä¸ºForwardingNodeèŠ‚ç‚¹(hashå€¼ä¸ºMOVED[-1])</span></span><br><span class="line">                advance = casTabAt(tab, i, <span class="keyword">null</span>, fwd);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">                advance = <span class="keyword">true</span>; <span class="comment">// already processed</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (f) &#123;                <span class="comment">//åŠ é”æ“ä½œ</span></span><br><span class="line">                    <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                        Node&lt;K,V&gt; ln, hn;</span><br><span class="line">                        <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;        <span class="comment">//è¯¥èŠ‚ç‚¹çš„hashå€¼å¤§äºç­‰äº0ï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªNodeèŠ‚ç‚¹</span></span><br><span class="line">                                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                                 * å› ä¸ºnçš„å€¼ä¸ºæ•°ç»„çš„é•¿åº¦ï¼Œä¸”æ˜¯power(2,x)çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨&amp;æ“ä½œçš„ç»“æœåªå¯èƒ½æ˜¯0æˆ–è€…n</span></span><br><span class="line"><span class="comment">                                 * æ ¹æ®è¿™ä¸ªè§„åˆ™</span></span><br><span class="line"><span class="comment">                                 *         0--&gt;  æ”¾åœ¨æ–°è¡¨çš„ç›¸åŒä½ç½®</span></span><br><span class="line"><span class="comment">                                 *         n--&gt;  æ”¾åœ¨æ–°è¡¨çš„ï¼ˆn+åŸæ¥ä½ç½®ï¼‰</span></span><br><span class="line"><span class="comment">                                 */</span></span><br><span class="line">                            <span class="keyword">int</span> runBit = fh &amp; n; </span><br><span class="line">                            Node&lt;K,V&gt; lastRun = f;</span><br><span class="line">                            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                             * lastRun è¡¨ç¤ºçš„æ˜¯éœ€è¦å¤åˆ¶çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">                             * æ¯å½“æ–°èŠ‚ç‚¹çš„hash&amp;n -&gt; b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå°±æŠŠrunBitè®¾ç½®ä¸ºè¿™ä¸ªç»“æœb</span></span><br><span class="line"><span class="comment">                             * è¿™æ ·forå¾ªç¯ä¹‹åï¼ŒrunBitçš„å€¼å°±æ˜¯æœ€åä¸å˜çš„hash&amp;nçš„å€¼</span></span><br><span class="line"><span class="comment">                             * è€ŒlastRunçš„å€¼å°±æ˜¯æœ€åä¸€æ¬¡å¯¼è‡´hash&amp;n å‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹(å‡è®¾ä¸ºpèŠ‚ç‚¹)</span></span><br><span class="line"><span class="comment">                             * ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºpèŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹çš„hash&amp;n å€¼è·ŸpèŠ‚ç‚¹æ˜¯ä¸€æ ·çš„ï¼Œ</span></span><br><span class="line"><span class="comment">                             * æ‰€ä»¥åœ¨å¤åˆ¶åˆ°æ–°çš„tableçš„æ—¶å€™ï¼Œå®ƒè‚¯å®šè¿˜æ˜¯è·ŸpèŠ‚ç‚¹åœ¨åŒä¸€ä¸ªä½ç½®</span></span><br><span class="line"><span class="comment">                             * åœ¨å¤åˆ¶å®ŒpèŠ‚ç‚¹ä¹‹åï¼ŒpèŠ‚ç‚¹çš„nextèŠ‚ç‚¹è¿˜æ˜¯æŒ‡å‘å®ƒåŸæ¥çš„èŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦è¿›è¡Œå¤åˆ¶äº†ï¼Œè‡ªå·±å°±è¢«å¸¦è¿‡å»äº†</span></span><br><span class="line"><span class="comment">                             * è¿™ä¹Ÿå°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤åˆ¶åçš„é“¾è¡¨çš„é¡ºåºå¹¶ä¸ä¸€å®šæ˜¯åŸæ¥çš„å€’åº</span></span><br><span class="line"><span class="comment">                             */</span></span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class="keyword">null</span>; p = p.next) &#123;</span><br><span class="line">                                <span class="keyword">int</span> b = p.hash &amp; n;    <span class="comment">//nçš„å€¼ä¸ºæ‰©å¼ å‰çš„æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">                                <span class="keyword">if</span> (b != runBit) &#123;</span><br><span class="line">                                    runBit = b;</span><br><span class="line">                                    lastRun = p;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (runBit == <span class="number">0</span>) &#123;</span><br><span class="line">                                ln = lastRun;</span><br><span class="line">                                hn = <span class="keyword">null</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                hn = lastRun;</span><br><span class="line">                                ln = <span class="keyword">null</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                             * æ„é€ ä¸¤ä¸ªé“¾è¡¨ï¼Œé¡ºåºå¤§éƒ¨åˆ†å’ŒåŸæ¥æ˜¯åçš„</span></span><br><span class="line"><span class="comment">                             * åˆ†åˆ«æ”¾åˆ°åŸæ¥çš„ä½ç½®å’Œæ–°å¢åŠ çš„é•¿åº¦çš„ç›¸åŒä½ç½®(i/n+i)</span></span><br><span class="line"><span class="comment">                             */</span></span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;</span><br><span class="line">                                <span class="keyword">int</span> ph = p.hash; K pk = p.key; V pv = p.val;</span><br><span class="line">                                <span class="keyword">if</span> ((ph &amp; n) == <span class="number">0</span>)</span><br><span class="line">                                        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                                         * å‡è®¾runBitçš„å€¼ä¸º0ï¼Œ</span></span><br><span class="line"><span class="comment">                                         * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºæŠŠæ—§çš„åºåˆ—çš„æœ€åä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—ååŒä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">                                         * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›ï¼Œç„¶ååœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">                                         */</span></span><br><span class="line">                                    ln = <span class="keyword">new</span> Node&lt;K,V&gt;(ph, pk, pv, ln);</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                                         * å‡è®¾runBitçš„å€¼ä¸ä¸º0ï¼Œ</span></span><br><span class="line"><span class="comment">                                         * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºæŠŠæ—§çš„åºåˆ—çš„æœ€åä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—ååŒä¸ä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åä¸ä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">                                         * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›ï¼Œç„¶ååœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">                                         */</span></span><br><span class="line">                                    hn = <span class="keyword">new</span> Node&lt;K,V&gt;(ph, pk, pv, hn);    </span><br><span class="line">                            &#125;</span><br><span class="line">                            setTabAt(nextTab, i, ln);    </span><br><span class="line">                            setTabAt(nextTab, i + n, hn);</span><br><span class="line">                            setTabAt(tab, i, fwd);</span><br><span class="line">                            advance = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;    <span class="comment">//å¦åˆ™çš„è¯æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹</span></span><br><span class="line">                            TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;</span><br><span class="line">                            TreeNode&lt;K,V&gt; lo = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                            TreeNode&lt;K,V&gt; hi = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                            <span class="keyword">int</span> lc = <span class="number">0</span>, hc = <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">for</span> (Node&lt;K,V&gt; e = t.first; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">                                <span class="keyword">int</span> h = e.hash;</span><br><span class="line">                                TreeNode&lt;K,V&gt; p = <span class="keyword">new</span> TreeNode&lt;K,V&gt;</span><br><span class="line">                                    (h, e.key, e.val, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                                <span class="keyword">if</span> ((h &amp; n) == <span class="number">0</span>) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> ((p.prev = loTail) == <span class="keyword">null</span>)</span><br><span class="line">                                        lo = p;</span><br><span class="line">                                    <span class="keyword">else</span></span><br><span class="line">                                        loTail.next = p;</span><br><span class="line">                                    loTail = p;</span><br><span class="line">                                    ++lc;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="keyword">if</span> ((p.prev = hiTail) == <span class="keyword">null</span>)</span><br><span class="line">                                        hi = p;</span><br><span class="line">                                    <span class="keyword">else</span></span><br><span class="line">                                        hiTail.next = p;</span><br><span class="line">                                    hiTail = p;</span><br><span class="line">                                    ++hc;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                             * åœ¨å¤åˆ¶å®Œæ ‘èŠ‚ç‚¹ä¹‹åï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹å¤„æ„æˆçš„æ ‘è¿˜æœ‰å‡ ä¸ªèŠ‚ç‚¹ï¼Œ</span></span><br><span class="line"><span class="comment">                             * å¦‚æœâ‰¤6ä¸ªçš„è¯ï¼Œå°±è½¬å›ä¸ºä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="comment">                             */</span></span><br><span class="line">                            ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :</span><br><span class="line">                                (hc != <span class="number">0</span>) ? <span class="keyword">new</span> TreeBin&lt;K,V&gt;(lo) : t;</span><br><span class="line">                            hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :</span><br><span class="line">                                (lc != <span class="number">0</span>) ? <span class="keyword">new</span> TreeBin&lt;K,V&gt;(hi) : t;</span><br><span class="line">                            setTabAt(nextTab, i, ln);</span><br><span class="line">                            setTabAt(nextTab, i + n, hn);</span><br><span class="line">                            setTabAt(tab, i, fwd);</span><br><span class="line">                            advance = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>getæ–¹æ³•</strong></p><p>getæ“ä½œä¸­ï¼Œæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œ<strong>ä¹Ÿæ²¡æœ‰ä½¿ç”¨unsafeæ–¹æ³•</strong>ï¼Œæ‰€ä»¥è¯»ï¼ˆgetï¼‰æ“ä½œæ˜¯æ”¯æŒå¹¶å‘æ“ä½œçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ç›¸æ¯”putæ–¹æ³•ï¼Œgetå°±å¾ˆå•çº¯äº†ï¼Œæ”¯æŒå¹¶å‘æ“ä½œï¼Œ</span></span><br><span class="line"><span class="comment">     * å½“keyä¸ºnullçš„æ—¶å€™å›æŠ›å‡ºNullPointerExceptionçš„å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * getæ“ä½œé€šè¿‡é¦–å…ˆè®¡ç®—keyçš„hashå€¼æ¥ç¡®å®šè¯¥å…ƒç´ æ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®</span></span><br><span class="line"><span class="comment">     * ç„¶åéå†è¯¥ä½ç½®çš„æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸å­˜åœ¨çš„è¯è¿”å›null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; <span class="keyword">int</span> n, eh; K ek;</span><br><span class="line">        <span class="keyword">int</span> h = spread(key.hashCode());</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">            (e = tabAt(tab, (n - <span class="number">1</span>) &amp; h)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((eh = e.hash) == h) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((ek = e.key) == key || (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))</span><br><span class="line">                    <span class="keyword">return</span> e.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (eh &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> (p = e.find(h, key)) != <span class="keyword">null</span> ? p.val : <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == h &amp;&amp;</span><br><span class="line">                    ((ek = e.key) == key || (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek))))</span><br><span class="line">                    <span class="keyword">return</span> e.val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="7-1-ä½ çŸ¥é“-ConcurrentHashMap-çš„å·¥ä½œåŸç†å—ï¼Ÿ">7.1 ä½ çŸ¥é“ ConcurrentHashMap çš„å·¥ä½œåŸç†å—ï¼Ÿ</h5><ul><li>Java7 ä¸­ ConcurrentHashMap ä½¿ç”¨çš„åˆ†æ®µé”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª Segment ä¸ŠåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œï¼Œæ¯ä¸€ä¸ª Segment éƒ½æ˜¯ä¸€ä¸ªç±»ä¼¼ HashMap æ•°ç»„çš„ç»“æ„ï¼Œå®ƒå¯ä»¥æ‰©å®¹ï¼Œå®ƒçš„å†²çªä¼šè½¬åŒ–ä¸ºé“¾è¡¨ã€‚ä½†æ˜¯ Segment çš„ä¸ªæ•°ä¸€ä½†åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜ã€‚<ul><li><strong>ä¸»è¦é‡‡ç”¨é”æœºåˆ¶</strong>ï¼Œåœ¨å¯¹æŸä¸ªSegmentè¿›è¡Œæ“ä½œæ—¶ï¼Œå°†è¯¥Segmenté”å®šï¼Œä¸å…è®¸å¯¹å…¶è¿›è¡ŒéæŸ¥è¯¢æ“ä½œ</li></ul></li><li>Java8 ä¸­çš„ ConcurrentHashMap ä½¿ç”¨çš„ Synchronized é”åŠ  CAS çš„æœºåˆ¶ã€‚ç»“æ„ä¹Ÿç”± Java7 ä¸­çš„ <strong>Segment æ•°ç»„ + HashEntry æ•°ç»„ + é“¾è¡¨</strong> è¿›åŒ–æˆäº† <strong>Node æ•°ç»„ + é“¾è¡¨ / çº¢é»‘æ ‘</strong>ï¼ŒNode æ˜¯ç±»ä¼¼äºä¸€ä¸ª HashEntry çš„ç»“æ„ã€‚å®ƒçš„å†²çªå†è¾¾åˆ°ä¸€å®šå¤§å°æ—¶ä¼šè½¬åŒ–æˆçº¢é»‘æ ‘ï¼Œåœ¨å†²çªå°äºä¸€å®šæ•°é‡æ—¶åˆé€€å›é“¾è¡¨ã€‚<ul><li><strong>CASæ— é”ç®—æ³•</strong>ï¼Œè¿™ç§ä¹è§‚æ“ä½œåœ¨å®Œæˆå‰è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç¬¦åˆé¢„æœŸç»“æœæ‰ç»™äºˆæ‰§è¡Œ</li></ul></li></ul><h5 id="7-2-è¯·é—®ConcurrentHashMapä¸­å˜é‡ä½¿ç”¨finalå’Œvolatileä¿®é¥°æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå…¶ä¸­é“¾è¡¨æ˜¯finalçš„nextå±æ€§ï¼Œé‚£ä¹ˆå‘ç”Ÿåˆ é™¤æŸä¸ªå…ƒç´ ï¼Œå¦‚ä½•å®ç°çš„ï¼Ÿ">7.2 è¯·é—®ConcurrentHashMapä¸­å˜é‡ä½¿ç”¨finalå’Œvolatileä¿®é¥°æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå…¶ä¸­é“¾è¡¨æ˜¯finalçš„nextå±æ€§ï¼Œé‚£ä¹ˆå‘ç”Ÿåˆ é™¤æŸä¸ªå…ƒç´ ï¼Œå¦‚ä½•å®ç°çš„ï¼Ÿ</h5><p>ConcurrentHashMapè¢«finalä¿®é¥°çš„å˜é‡ï¼Œï¼ˆéƒ¨åˆ†ï¼‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤åˆå§‹å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"><span class="comment">// é»˜è®¤åŠ è½½å› å­</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"><span class="comment">// é»˜è®¤segmentå±‚çº§</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CONCURRENCY_LEVEL = <span class="number">16</span>;</span><br><span class="line"><span class="comment">// æœ€å¤§å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"><span class="comment">// segmentæœ€å°å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_SEGMENT_TABLE_CAPACITY = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// ä¸€ä¸ªsegmentæœ€å¤§å®¹é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SEGMENTS = <span class="number">1</span> &lt;&lt; <span class="number">16</span>;</span><br><span class="line"><span class="comment">// é”ä¹‹å‰é‡è¯•æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RETRIES_BEFORE_LOCK = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>HashEntryä¸­è¢«volatileä¿®é¥°çš„éƒ¨åˆ†å˜é‡å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HashEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">       <span class="keyword">final</span> K key;</span><br><span class="line">       <span class="keyword">volatile</span> V value;  <span class="comment">// ä¿è¯å¯è§æ€§</span></span><br><span class="line">       <span class="keyword">volatile</span> HashEntry&lt;K,V&gt; next;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½¿ç”¨final</strong>ã€‚ç”¨æ¥å®ç°ä¸å˜æ¨¡å¼ï¼ˆimmutableï¼‰ï¼Œä»–æ˜¯å¤šçº¿ç¨‹å®‰å…¨é‡Œæœ€ç®€å•çš„ä¸€ç§ä¿éšœæ–¹å¼ã€‚å› ä¸ºä½ æ‹¿ä»–æ²¡æœ‰åŠæ³•ï¼Œæƒ³æ”¹å˜å®ƒä¹Ÿæ²¡æœ‰æœºä¼šã€‚ä¸å˜æ¨¡å¼ä¸»è¦é€šè¿‡finalå…³é”®å­—æ¥é™å®šçš„ã€‚åœ¨JMMä¸­finalå…³é”®å­—è¿˜æœ‰ç‰¹æ®Šçš„è¯­ä¹‰ã€‚FinalåŸŸä½¿å¾—ç¡®ä¿åˆå§‹åŒ–å®‰å…¨æ€§ï¼ˆinitialization safetyï¼‰æˆä¸ºå¯èƒ½ï¼Œåˆå§‹åŒ–å®‰å…¨æ€§è®©ä¸å¯å˜å½¢å¯¹è±¡ä¸éœ€è¦åŒæ­¥å°±èƒ½è‡ªç”±åœ°è¢«è®¿é—®å’Œå…±äº«ã€‚</li><li><strong>ä½¿ç”¨volatile</strong>ã€‚ä¿è¯æŸä¸ªå˜é‡å†…å­˜çš„æ”¹å˜å¯¹å…¶ä»–çº¿ç¨‹å³æ—¶å¯è§ï¼Œåœ¨é…åˆCASå¯ä»¥å®ç°ä¸åŠ é”å¯¹å¹¶å‘æ“ä½œçš„æ”¯æŒã€‚</li></ul><h5 id="7-3-HashTableä¸ConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæè¿°é”åˆ†æ®µæŠ€æœ¯ã€‚">7.3 HashTableä¸ConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæè¿°é”åˆ†æ®µæŠ€æœ¯ã€‚</h5><ul><li><strong>é”æœºåˆ¶</strong>ã€‚ æ‰€æœ‰è®¿é—®HashTableçš„çº¿ç¨‹éƒ½å¿…é¡»ç«äº‰åŒä¸€æŠŠé”ï¼Œæ•ˆç‡æ›´ä½ï¼›ConcurrentHashMapæ‰€ä½¿ç”¨çš„é”åˆ†æ®µæŠ€æœ¯ï¼Œé¦–å…ˆå°†æ•°æ®åˆ†æˆä¸€æ®µä¸€æ®µçš„å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚</li><li><strong>åº•å±‚æ•°æ®ç»“æ„</strong>ã€‚ 1.8ä¹‹åå¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ ï¼› 1.8ä¹‹å‰ï¼ŒConcurrentHashMapæ˜¯Segementæ•°ç»„ + HashEntryæ•°ç»„ + é“¾è¡¨ã€‚</li></ul><h5 id="7-4-ï¼ˆé˜¿é‡ŒÂ·æ·˜ç‰¹ï¼‰ConcurrentHashMap1-8ä¸ºä»€ä¹ˆä¸ä½¿ç”¨åˆ†æ®µé”ï¼Ÿ">7.4 ï¼ˆé˜¿é‡ŒÂ·æ·˜ç‰¹ï¼‰ConcurrentHashMap1.8ä¸ºä»€ä¹ˆä¸ä½¿ç”¨åˆ†æ®µé”ï¼Ÿ</h5><p>å…ˆè¯´åˆ†æ®µé”çš„ä¼˜ç‚¹ï¼š</p><ol><li>ä¿è¯åœ¨<strong>æ“ä½œä¸åŒæ®µ map</strong> çš„æ—¶å€™<strong>å¯ä»¥å¹¶å‘æ‰§è¡Œ</strong>ï¼›æ“ä½œ<strong>åŒæ®µ map</strong> çš„æ—¶å€™ï¼Œè¿›è¡Œ<strong>é”çš„ç«äº‰å’Œç­‰å¾…</strong>ã€‚è¿™ç›¸<strong>å¯¹äºç›´æ¥å¯¹æ•´ä¸ªmapåŒæ­¥synchronized</strong>æ˜¯æœ‰ä¼˜åŠ¿çš„ã€‚</li></ol><p>ä½†æ˜¯åˆ†æ®µé”ä¹Ÿæœ‰ä¸€äº›ä¸å¯å¿½è§†çš„ç¼ºç‚¹ï¼š</p><ol><li>åˆ†æˆå¾ˆå¤šæ®µæ—¶ä¼šæ¯”è¾ƒ<strong>æµªè´¹å†…å­˜ç©ºé—´</strong>(ä¸è¿ç»­ï¼Œç¢ç‰‡åŒ–)ï¼›</li><li><strong>æ“ä½œmapæ—¶ç«äº‰åŒä¸€ä¸ªåˆ†æ®µé”çš„æ¦‚ç‡éå¸¸å°ï¼ˆæ®µæ•£åˆ—æ¯”è¾ƒå¥½çš„æ—¶å€™</strong>ï¼‰æ—¶ï¼Œåˆ†æ®µé”åè€Œä¼šé€ æˆæ›´æ–°ç­‰æ“ä½œçš„é•¿æ—¶é—´ç­‰å¾…ï¼›</li><li>å½“æŸä¸ªæ®µå¾ˆå¤§æ—¶ï¼Œåˆ†æ®µé”çš„æ€§èƒ½ä¼šä¸‹é™ã€‚</li></ol><p>ç»¼ä¸Šè€ƒè™‘1.8ä¸å†ä½¿ç”¨åˆ†æ®µé”ã€‚</p><h5 id="7-5-ä¸ºä»€ä¹ˆ1-8ä¸­-get-æ–¹æ³•ä¸åŠ é”ï¼Ÿ">7.5 ä¸ºä»€ä¹ˆ1.8ä¸­ get() æ–¹æ³•ä¸åŠ é”ï¼Ÿ</h5><p>å› ä¸ºé“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹çš„valå’Œnextéƒ½ä½¿ç”¨volatileä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ã€‚</p><h5 id="7-6-ä¸ºä»€ä¹ˆ1-8ä¸ä½¿ç”¨lockè€Œæ˜¯ä½¿ç”¨syncï¼Ÿ">7.6 ä¸ºä»€ä¹ˆ1.8ä¸ä½¿ç”¨lockè€Œæ˜¯ä½¿ç”¨syncï¼Ÿ</h5><ol><li>å› ä¸ºsyncåŠ å…¥é”å‡çº§æœºåˆ¶ï¼ˆjdk1.6ä¹‹åï¼‰ï¼Œå·²ç»ä¼˜åŒ–çš„ä¸é”™äº†ï¼›</li><li>locké€šè¿‡reentranclockå®ç°ï¼Œreentranlockæ˜¯é€šè¿‡AQSå®ç°ï¼Œéœ€è¦å¢åŠ é¢å¤–å†…å­˜å¼€é”€ï¼ˆCLHåŒå‘é˜Ÿåˆ—ï¼‰ã€‚</li></ol><h5 id="7-7-ConcurrenthashMapä½¿ç”¨çš„æ—¶å€™æœ‰å¯èƒ½å‡ºç°ä¸å®‰å…¨çš„æƒ…å†µï¼Ÿ">7.7 ConcurrenthashMapä½¿ç”¨çš„æ—¶å€™æœ‰å¯èƒ½å‡ºç°ä¸å®‰å…¨çš„æƒ…å†µï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/luzhensmart/article/details/108133560">https://blog.csdn.net/luzhensmart/article/details/108133560</a></p></blockquote><p>æŸ¥äº†ä¸€äº›èµ„æ–™åå‘ç°ï¼Œ<strong>åŸæ¥ConcurrentHashMapçš„çº¿ç¨‹å®‰å…¨æŒ‡çš„æ˜¯ï¼Œå®ƒçš„ã€æ¯ä¸ªæ–¹æ³•ã€‘å•ç‹¬è°ƒç”¨ï¼ˆå³åŸå­æ“ä½œï¼‰éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯ä»£ç æ€»ä½“çš„äº’æ–¥æ€§å¹¶ä¸å—æ§åˆ¶</strong>ã€‚ä»¥ä¸Šé¢çš„ä»£ç ä¸ºä¾‹ï¼Œæœ€åä¸€è¡Œä¸­çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public void run() &#123;</span><br><span class="line">        for (int i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">            this.addup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private void addup() &#123;</span><br><span class="line">        if (!map.containsKey(KEY)) &#123;</span><br><span class="line">            map.put(KEY, 1);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            map.put(KEY, map.get(KEY) + 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>åœ¨ä¸Šé¢ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨è¿›è¡Œäº†100æ¬¡åŠ æ³•ï¼Œä½†æ˜¯å…¶å®åŠ 1åœ¨çº¿ç¨‹å†…éƒ¨æœ¬èº«ä¹Ÿå¹¶ä¸æ˜¯åŸå­æ“ä½œ</strong>ã€‚</p><p>å®é™…ä¸Šå¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œå®ƒåŒ…å«äº†ä¸‰æ­¥ï¼š</p><ol><li>map.get</li><li>åŠ 1</li><li>map.put</li></ol><p>æ˜¯ç”±äºåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œmapæœ¬èº«æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ã€‚<strong>å½“çº¿ç¨‹Aæ‰§è¡Œmap.getçš„æ—¶å€™ï¼Œå…¶å®ƒçº¿ç¨‹å¯èƒ½æ­£åœ¨æ‰§è¡Œmap.put</strong>ï¼Œè¿™æ ·ä¸€æ¥å½“çº¿ç¨‹Aæ‰§è¡Œåˆ°map.putçš„æ—¶å€™ï¼Œçº¿ç¨‹Açš„å€¼å°±å·²ç»æ˜¯è„æ•°æ®äº†ï¼Œç„¶åè„æ•°æ®è¦†ç›–äº†çœŸå€¼ï¼Œå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ã€‚</p><h4 id="8-HashMap-å’Œ-HashSetåŒºåˆ«-ï¼Ÿ">8. HashMap <strong>å’Œ</strong> HashSet<strong>åŒºåˆ«</strong> ï¼Ÿ</h4><blockquote><p>å¦‚æœä½ çœ‹è¿‡ HashSet æºç çš„è¯å°±åº”è¯¥çŸ¥é“ï¼šHashSet åº•å±‚å°±æ˜¯åŸºäº HashMap å®ç°çš„ã€‚ï¼ˆHashSet çš„æºç éå¸¸éå¸¸å°‘ï¼Œå› ä¸ºé™¤äº†clone() ã€ writeObject() ã€ readObject() æ˜¯ HashSet â¾ƒâ¼°ä¸å¾—ä¸å®ç°ä¹‹å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯ç›´æ¥è°ƒç”¨ HashMap ä¸­çš„æ–¹æ³•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"><strong>HashMap</strong></th><th style="text-align:center"><strong>HashSet</strong></th></tr></thead><tbody><tr><td style="text-align:center">å®ç°äº†Mapæ¥â¼</td><td style="text-align:center">å®ç°Setæ¥â¼</td></tr><tr><td style="text-align:center">å­˜å‚¨é”®å€¼å¯¹</td><td style="text-align:center">ä»…å­˜å‚¨å¯¹è±¡</td></tr><tr><td style="text-align:center">è°ƒâ½¤ <code>put()</code> å‘mapä¸­æ·»åŠ å…ƒç´ </td><td style="text-align:center">è°ƒâ½¤ <code>add()</code> â½…æ³•å‘Setä¸­æ·»åŠ å…ƒç´ </td></tr><tr><td style="text-align:center">HashMapä½¿â½¤é”®ï¼ˆKeyï¼‰è®¡ç®—Hashcodeï¼š<code>int hash = hash(key);</code></td><td style="text-align:center">HashSetä½¿â½¤æˆå‘˜å¯¹è±¡æ¥è®¡ç®—hashcodeå€¼ï¼Œå¯¹äºä¸¤ä¸ªå¯¹è±¡æ¥è¯´hashcodeå¯èƒ½ç›¸åŒï¼Œæ‰€ä»¥equals()â½…æ³•â½¤æ¥åˆ¤æ–­å¯¹è±¡çš„ç›¸ç­‰æ€§ã€‚</td></tr></tbody></table><h4 id="9-è¯´è¯´HashSetçš„åŸºæœ¬åŸç†ï¼Ÿ">9. è¯´è¯´HashSetçš„åŸºæœ¬åŸç†ï¼Ÿ</h4><ul><li><p><strong>åº•å±‚ç»“æ„</strong></p><p><code>HashSet</code>åº•å±‚åŸç†å®Œå…¨å°±æ˜¯åŒ…è£…äº†ä¸€ä¸‹<code>HashMap</code> ï¼Œåªä¸è¿‡å­˜å‚¨çš„æ—¶å€™<code>value</code>æ˜¯é»˜è®¤å­˜å‚¨äº†ä¸€ä¸ª<code>Object</code>çš„é™æ€å¸¸é‡ï¼Œå–çš„æ—¶å€™ä¹Ÿæ˜¯åªè¿”å›<code>key</code>ï¼Œæ‰€ä»¥çœ‹èµ·æ¥å°±åƒ<code>List</code>ä¸€æ ·ã€‚</p></li><li><p><strong>åˆå§‹åŒ–</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/<span class="number">.75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>add()æ–¹æ³•</strong></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯ç›´æ¥è°ƒç”¨çš„<code>HashMap</code>çš„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.remove(o)==PRESENT;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.containsKey(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>addå…¶å®å°±æ˜¯è°ƒç”¨HashMapçš„putæ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯<strong>å”¯ä¸€æ€§</strong>ï¼Ÿ</p></blockquote><p><strong>å¦‚æœ<code>å“ˆå¸Œå€¼</code>å’Œ<code>key</code>éƒ½ä¸€æ ·</strong>ï¼Œå°±ä¼šç›´æ¥æ‹¿æ–°å€¼<strong>è¦†ç›–æ—§å€¼</strong>ï¼Œè€Œ<code>HashSet</code>å°±æ˜¯åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥ä¿è¯å”¯ä¸€æ€§ã€‚</p><p>å…¶å®å’ŒHashMapå°±æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">    e = p;</span><br></pre></td></tr></table></figure></li><li><p><strong>containsæ–¹æ³•</strong>ï¼ˆ<s>Get()æ–¹æ³•</s> ï¼‰</p><p><strong>hashsetæ²¡æœ‰getæ–¹æ³•</strong>ï¼Œå› ä¸ºæ²¡æœ‰æ„ä¹‰ï¼šä¸éœ€è¦è·å–æŸä¸ªé”®å€¼å¯¹åº”çš„valueã€‚</p><p>å…·ä½“å®ç°ç›´æ¥è°ƒç”¨hashmapçš„containsKey()æ–¹æ³•ï¼š</p><blockquote><p>è¿‡ç¨‹å’Œhashmapçš„getæ–¹æ³•è¿‡ç¨‹å·®ä¸å¤šï¼Œè¿”å›ä¸ºnullåˆ™æ˜¯ä¸å­˜åœ¨ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.containsKey(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="9-1-HashSetå¦‚ä½•æ£€æŸ¥é‡å¤-ï¼Ÿ">9. 1 HashSet<strong>å¦‚ä½•æ£€æŸ¥é‡å¤</strong> ï¼Ÿ</h5><ol><li>æŠŠå¯¹è±¡åŠ â¼Š HashSet æ—¶ï¼ŒHashSetå…ˆè®¡ç®—å¯¹è±¡çš„hashcode å€¼ï¼›</li><li>æ ¹æ®hashcodeå€¼è®¡ç®—å‡ºè¦åŠ â¼Šçš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–åŠ â¼Šçš„å¯¹è±¡çš„hashcodeå€¼ä½œâ½æ•™ï¼›</li><li>å¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„hashcodeï¼ŒHashSetä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ï¼›</li><li><strong>å¦‚æœå‘ç°æœ‰ç›¸åŒhashcodeå€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨ equals()</strong> æ–¹æ³•æ¥æ£€æŸ¥hashcodeç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒï¼Œå¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSetå°±ä¸ä¼šè®©åŠ â¼Šæ“ä½œæˆåŠŸã€‚</li></ol><h5 id="9-2-ã€æ–°ã€‘contains-æ–¹æ³•åœ¨HashSetå’ŒArrayListçš„å®ç°åŒºåˆ«ï¼Ÿ">9.2 ã€æ–°ã€‘contains()æ–¹æ³•åœ¨HashSetå’ŒArrayListçš„å®ç°åŒºåˆ«ï¼Ÿ</h5><ul><li><p><strong>Arraylist</strong></p><p>å› ä¸ºåº•å±‚æ˜¯objectæ•°ç»„ï¼Œåˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå…¶å®æ˜¯é€šè¿‡éå†æ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;<span class="comment">//#1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿”å›æŒ‡å®šå…ƒç´ åœ¨åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœè¯¥åˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚*/</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">                <span class="keyword">if</span> (elementData[i]==<span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">                <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Hashset</strong></p><p>Hashsetæ˜¯<strong>hashå€¼ &amp;&amp; éå†é“¾è¡¨equals()</strong> éƒ½ç›¸ç­‰ï¼Œæ¥åˆ¤æ–­çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">    e = p;</span><br></pre></td></tr></table></figure></li></ul><h4 id="10-comparable-å’Œ-Comparatorçš„åŒºåˆ«ï¼Ÿ">10. comparable <strong>å’Œ</strong> Comparatorçš„åŒºåˆ«ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/xujian2014/p/5215082.html">https://www.cnblogs.com/xujian2014/p/5215082.html</a></p></blockquote><ul><li><p>Comparableæ˜¯æ’åºæ¥å£ï¼Œè‹¥ä¸€ä¸ªç±»å®ç°äº†Comparableæ¥å£ï¼Œå°±æ„å‘³ç€â€œè¯¥ç±»æ”¯æŒæ’åºâ€ã€‚</p><blockquote><p>ä¾‹å¦‚Personç±»ï¼Œå®ç°Comparableæ¥å£ï¼Œä½¿å¾—æ‰€æœ‰Personç±»å¯¹è±¡å¯ä»¥æŒ‰ç…§å„è‡ªå¹´é¾„å¤§å°è¿›è¡Œæ’åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Person p)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">this</span>.age-p.getAge();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>Comparatoræ˜¯æ¯”è¾ƒå™¨ï¼Œæˆ‘ä»¬è‹¥éœ€è¦æ§åˆ¶æŸä¸ªç±»çš„æ¬¡åºï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªâ€œè¯¥ç±»çš„æ¯”è¾ƒå™¨â€æ¥è¿›è¡Œæ’åºã€‚</p><blockquote><p>Personç±»æ²¡æœ‰å®ç°Comparableæ¥å£ï¼Œè¯¥å¦‚ä½•æ¯”è¾ƒå¤§å°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªç±»ï¼Œè®©å…¶å®ç°Comparatoræ¥å£ï¼Œä»è€Œæ„é€ ä¸€ä¸ªâ€œæ¯”è¾ƒå™¨&quot;ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Person o1, Person o2)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> o1.getAge()-o2.getAge();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>Comparableç›¸å½“äºâ€œå†…éƒ¨æ¯”è¾ƒå™¨â€ï¼Œè€ŒComparatorç›¸å½“äºâ€œå¤–éƒ¨æ¯”è¾ƒå™¨â€ã€‚ã€‚</p></li></ul><h4 id="11-å¦‚ä½•é€‰ç”¨é›†åˆ">11. <strong>å¦‚ä½•é€‰ç”¨é›†åˆ</strong>?</h4><p><img src="https://img-blog.csdn.net/20140630092900390?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaml1cWl5dWxpYW5n/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p><p><strong>éœ€è¦å­˜å‚¨é”®å€¼å¯¹</strong>ï¼š</p><ul><li><strong>Mapæ¥å£çš„é›†åˆ</strong><ul><li>éœ€è¦æ’åºæ—¶é€‰æ‹©TreeMap</li><li>ä¸éœ€è¦æ’åºæ—¶å°±é€‰æ‹©HashMap</li><li>éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨å°±é€‰â½¤ConcurrentHashMap</li></ul></li></ul><p><strong>åªéœ€è¦å­˜å‚¨å…ƒç´ ï¼Œå®ç°collectionæ¥å£çš„é›†åˆï¼Œåˆåˆ†ä¸º</strong>ï¼š</p><ul><li><strong>éœ€è¦ä¿è¯å…ƒç´ å”¯ä¸€â€“Setæ¥å£çš„é›†åˆ</strong><ul><li>HashSet</li></ul></li><li><strong>ä¸éœ€è¦å…ƒç´ å”¯ä¸€â€“Listæ¥å£ç»“åˆ</strong><ul><li>æŸ¥æ‰¾æ¯”è¾ƒå¤šï¼šArrayList</li><li>å¢åˆ æ¯”è¾ƒå¤šï¼šLinkedList</li></ul></li></ul><h3 id="1-3-3-List">1.3.3 <strong>List</strong></h3><h4 id="1-ç”¨è¿‡-ArrayList-å—ï¼Ÿè¯´ä¸€ä¸‹å®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ">1.<strong>ç”¨è¿‡ ArrayList å—ï¼Ÿè¯´ä¸€ä¸‹å®ƒæœ‰ä»€ä¹ˆç‰¹ç‚¹</strong>ï¼Ÿ</h4><ul><li><strong>è‡ªåŠ¨æ‰©å®¹</strong>ï¼š å½“åŠ å…¥æ•°æ®è¾¾åˆ°ä¸€å®šç¨‹åº¦åï¼Œä¼šå®è¡Œè‡ªåŠ¨æ‰©å®¹ï¼Œå³æ‰©å¤§æ•°ç»„å¤§å° ï¼›</li><li><strong>åº•å±‚å®ç°</strong>ï¼šåº•å±‚æ˜¯ä½¿ç”¨æ•°ç»„å®ç°ï¼Œadd(int,o)ï¼Œæ·»åŠ åˆ°æŸä¸ªä½ç½®ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæŒªåŠ¨å¤§é‡çš„æ•°ç»„å…ƒç´ ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼›</li><li><strong>çº¿ç¨‹ä¸å®‰å…¨</strong></li></ul><h4 id="2-ArrayList-ä¸-Vector-åŒºåˆ«å‘¢-ä¸ºä»€ä¹ˆè¦ç”¨Arraylistå–ä»£Vectorå‘¢ï¼Ÿ">2. ArrayList <strong>ä¸</strong> Vector <strong>åŒºåˆ«å‘¢</strong>?<strong>ä¸ºä»€ä¹ˆè¦ç”¨</strong>Arraylist<strong>å–ä»£</strong>Vector<strong>å‘¢</strong>ï¼Ÿ</h4><ul><li><p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š Vectorçº¿ç¨‹å®‰å…¨ï¼ŒArrayList ä¸æ˜¯ï¼›</p></li><li><p><strong>Vectorè€—æ—¶</strong>ï¼šVector ç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„ã€‚å¯ä»¥ç”±ä¸¤ä¸ªçº¿ç¨‹å®‰å…¨åœ°è®¿é—®â¼€ä¸ªVectorå¯¹è±¡ã€ä½†æ˜¯â¼€ä¸ªçº¿ç¨‹è®¿é—®Vectorçš„è¯ä»£ç è¦åœ¨åŒæ­¥æ“ä½œä¸Šè€—è´¹å¤§é‡çš„æ—¶é—´ã€‚</p></li></ul><h4 id="3-Array-ArrayListä¸åŒç‚¹">3. Array &amp; ArrayListä¸åŒç‚¹?</h4><ol><li><strong>Arrayå¯ä»¥åŒ…å«åŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹</strong>ï¼Œ<strong>ArrayListåªèƒ½åŒ…å«å¯¹è±¡ç±»å‹</strong> ï¼›</li><li>Arrayå¤§å°æ˜¯å›ºå®šçš„ï¼ŒArrayListçš„å¤§å°æ˜¯ <u>åŠ¨æ€å˜åŒ–</u> çš„ ï¼›</li><li>ArrayListæä¾›äº†æ›´å¤šçš„æ–¹æ³•å’Œç‰¹æ€§: addAll()ï¼ŒremoveAll()ï¼Œiterator()ã€‚</li></ol><h4 id="4-Arraylist-ä¸-LinkedList-åŒºåˆ«">4. Arraylist <strong>ä¸</strong> LinkedList <strong>åŒºåˆ«</strong>?</h4><ul><li><p><strong>ç´¢å¼•/æ’å…¥</strong>ï¼šArrayListæŒ‰åºå·ç´¢å¼•ï¼Œç´¢å¼•å¿«æ’å…¥æ…¢ï¼›LinkedListä¸æ˜¯ï¼Œç´¢å¼•æ…¢ï¼Œæ’å…¥å¿«ï¼›</p></li><li><p><strong>å†…å­˜æ–¹é¢</strong>ï¼š Arraylist æ˜¯çº¿æ€§è¿ç»­å­˜å‚¨ï¼Œ å†…å­˜åˆ©ç”¨æ›´ä½ï¼›LinkedList æ˜¯é“¾è¡¨ï¼Œå†…å­˜åˆ©ç”¨æ›´é«˜ï¼ˆå°†å†…å­˜é›¶æ•£ç©ºé—´ä¸²è”ï¼‰ï¼Œä½†ä¹Ÿæ›´å æœ‰å†…å­˜ï¼ˆæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨äº†ä¸¤ä¸ªå¼•ç”¨ï¼‰ï¼›</p></li><li><p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š ArrayList å’Œ LinkedList éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯<strong>éƒ½ä¸</strong>ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</p></li><li><p><strong>åº•å±‚æ•°æ®ç»“æ„</strong>ï¼š Arraylist åº•å±‚ä½¿ç”¨çš„æ˜¯ <strong>Object</strong>æ•°ç»„ï¼› LinkedList  åº•å±‚ä½¿ç”¨çš„æ˜¯<strong>åŒå‘é“¾è¡¨</strong> æ•°æ®ç»“æ„ ï¼›</p><blockquote><p>JDK1.6ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7å–æ¶ˆäº†å¾ªç¯ã€‚</p></blockquote></li></ul><h4 id="5-ã€-u-æºç è§£è¯»-u-ã€‘è¯´è¯´ArrayListçš„æ‰©å®¹æœºåˆ¶å§-ï¼Ÿä¸ºä»€ä¹ˆæ˜¯æ‰©å®¹1-5å€ï¼Ÿé»˜è®¤å¤§å°æ˜¯å¤šå°‘ã€‚">5. ã€<u>æºç è§£è¯»</u>ã€‘è¯´è¯´ArrayListçš„æ‰©å®¹æœºåˆ¶å§ ï¼Ÿä¸ºä»€ä¹ˆæ˜¯æ‰©å®¹1.5å€ï¼Ÿé»˜è®¤å¤§å°æ˜¯å¤šå°‘ã€‚</h4><blockquote><p><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/collection/ArrayList%E6%BA%90%E7%A0%81%2B%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E5%88%86%E6%9E%90.md">é€æºç åˆ†ææ‰©å®¹æœºåˆ¶</a></p></blockquote><p>å…ˆæŠŠå›ç­”å†™åœ¨ä¸‹é¢ï¼š</p><blockquote><p><strong>ArrayList/vectoré»˜è®¤å¤§å°éƒ½æ˜¯10ï¼Œä½†vectotæ‰©å®¹æ˜¯2å€</strong>ã€‚</p></blockquote><p><strong>1. æ‰©å®¹æœºåˆ¶</strong>ï¼š</p><p>ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„æ•°ç»„é•¿åº¦ä¸º0ï¼Œå½“ç¬¬ä¸€æ¬¡addåæ•°ç»„é•¿åº¦ä¸º10 ï¼› å¦‚æœç»§ç»­addè¶…è¿‡10åï¼Œä¹Ÿå°±æ˜¯ä¸æ»¡è¶³<strong>minCapacityï¼ˆæœ€å°éœ€è¦å®¹é‡ï¼‰ - elementData.length &gt; 0</strong> ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚ å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠã€æœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ã€‘ã€‚</p><p>æœ€åæ£€æŸ¥è®¾ç½®çš„æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å¤§å®¹é‡MAX_ARRAY_SIZE ï¼Œè¿›å…¥<code>hugeCapacity()</code> :</p><ul><li>å¦‚æœminCapacityå¤§äºMAX_ARRAY_SIZEï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º <code>Integer.MAX_VALUE - 8</code> ã€‚</li></ul><p><strong>2. ä¸ºä»€ä¹ˆæ˜¯1.5å€</strong>ï¼Ÿ</p><p>å› ä¸ºï¼Œ<strong>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1)ï¼Œæ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œå¦åˆ™æ˜¯ 1.5 å€å·¦å³ï¼‰ï¼</strong> å¥‡å¶ä¸åŒã€‚</p><p>æ¯”å¦‚ ï¼š10+10/2 = 15, 33+33/2=49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°ã€‚</p><ul><li><p><strong>ArrayListæ€»è§ˆ</strong></p><p><code>ArrayList</code>ç»§æ‰¿äº<strong>AbstractList</strong> ï¼Œå®ç°äº†<strong>List</strong>,<strong>RandomAccess</strong>,<strong>Cloneable</strong>,<strong>java.io.Serializable</strong> è¿™äº›æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li><code>RandomAccess</code> æ˜¯ä¸€ä¸ªæ ‡å¿—æ¥å£ï¼Œè¡¨æ˜å®ç°è¿™ä¸ªè¿™ä¸ªæ¥å£çš„ List é›†åˆæ˜¯æ”¯æŒ<strong>å¿«é€Ÿéšæœºè®¿é—®</strong>çš„ã€‚åœ¨ <code>ArrayList</code> ä¸­ï¼Œæˆ‘ä»¬å³å¯ä»¥é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡ï¼Œè¿™å°±æ˜¯å¿«é€Ÿéšæœºè®¿é—®ï¼›</li><li><code>ArrayList</code> å®ç°äº†<strong>Cloneable æ¥å£</strong> ï¼Œå³è¦†ç›–äº†å‡½æ•°<code>clone()</code>ï¼Œèƒ½è¢«å…‹éš†ï¼›</li><li><code>ArrayList</code> å®ç°äº† <code>java.io.Serializable </code>æ¥å£ï¼Œè¿™æ„å‘³ç€<code>ArrayList</code>æ”¯æŒåºåˆ—åŒ–ï¼Œèƒ½é€šè¿‡åºåˆ—åŒ–å»ä¼ è¾“ã€‚</li></ul></li><li><p><strong>ArrayList æ ¸å¿ƒæºç è§£è¯»ï¼ˆå…ˆè€å¿ƒçœ‹ä¸€é</strong>ï¼‰</p><p>ç›´æ¥ç‚¹å‡»ä¸Šé¢é“¾æ¥ <a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/collection/ArrayList%E6%BA%90%E7%A0%81%2B%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6%E5%88%86%E6%9E%90.md">é€æºç åˆ†ææ‰©å®¹æœºåˆ¶</a> æŸ¥çœ‹ã€‚</p></li><li><p><strong>ã€é‡ç‚¹ã€‘JDK8 <u>æ‰©å®¹æœºåˆ¶</u> è§£è¯»</strong></p><ol><li><p><strong>ä»æ„é€ å‡½æ•°è¯´èµ·</strong></p><p>ï¼ˆJDK8ï¼‰ArrayList æœ‰ä¸‰ç§æ–¹å¼æ¥åˆå§‹åŒ– :</p><ul><li>ä»¥<strong>æ— å‚æ•°æ„é€ æ–¹æ³•</strong>åˆ›å»º ArrayList æ—¶ï¼Œå®é™…ä¸Šåˆå§‹åŒ–èµ‹å€¼çš„æ˜¯ä¸€ä¸ª<strong>ç©ºæ•°ç»„</strong>ã€‚<u>å½“çœŸæ­£å¯¹æ•°ç»„è¿›è¡Œæ·»åŠ å…ƒç´ æ“ä½œæ—¶ï¼Œæ‰çœŸæ­£åˆ†é…å®¹é‡</u>ã€‚å³å‘æ•°ç»„ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæ•°ç»„å®¹é‡æ‰©ä¸º 10ã€‚</li><li>jdk8ä¸­çš„ArrayListçš„å¯¹è±¡çš„åˆ›å»º<strong>ç±»ä¼¼äºå•ä¾‹çš„æ‡’æ±‰å¼</strong>ã€‚JDK8çš„å†…å­˜ä¼˜åŒ–ä¹Ÿå€¼å¾—æˆ‘ä»¬åœ¨å¹³æ—¶å¼€å‘ä¸­å­¦ä¹ ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * é»˜è®¤åˆå§‹å®¹é‡å¤§å°</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line">     </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ç©ºæ•°ç»„ï¼ˆç”¨äºç©ºå®ä¾‹ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">     </span><br><span class="line">  <span class="comment">//ç”¨äºé»˜è®¤å¤§å°ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚</span></span><br><span class="line">   <span class="comment">//æˆ‘ä»¬æŠŠå®ƒä»EMPTY_ELEMENTDATAæ•°ç»„ä¸­åŒºåˆ†å‡ºæ¥ï¼Œä»¥çŸ¥é“åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å®¹é‡éœ€è¦å¢åŠ å¤šå°‘ã€‚</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">     </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ä¿å­˜ArrayListæ•°æ®çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">transient</span> Object[] elementData; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line">     </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ArrayList æ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">     </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment"> /**</span></span><br><span class="line"><span class="comment">  * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ï¼ˆç”¨æˆ·è‡ªå·±æŒ‡å®šå®¹é‡ï¼‰</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) &#123;<span class="comment">//åˆå§‹å®¹é‡å¤§äº0</span></span><br><span class="line">         <span class="comment">//åˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„</span></span><br><span class="line">         <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;<span class="comment">//åˆå§‹å®¹é‡ç­‰äº0</span></span><br><span class="line">         <span class="comment">//åˆ›å»ºç©ºæ•°ç»„</span></span><br><span class="line">         <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;<span class="comment">//åˆå§‹å®¹é‡å°äº0ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal Capacity: &quot;</span>+</span><br><span class="line">                                            initialCapacity);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ åˆ©ç”¨è¯¥é›†åˆçš„è¿­ä»£å™¨æŒ‰é¡ºåºè¿”å›</span></span><br><span class="line"><span class="comment"> *å¦‚æœæŒ‡å®šçš„é›†åˆä¸ºnullï¼Œthrows NullPointerExceptionã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">     elementData = c.toArray();</span><br><span class="line">     <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">         <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">             elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// replace with empty array.</span></span><br><span class="line">         <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å†çœ‹<code>add</code>æ–¹æ³•</strong></p><blockquote><p>è¿™é‡Œ<u>ä»¥æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„ ArrayList</u> ä¸ºä¾‹åˆ†æ ã€‚</p></blockquote><blockquote><p>JDK11 ç§»é™¤äº† <code>ensureCapacityInternal()</code> å’Œ <code>ensureExplicitCapacity()</code> æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line"> <span class="comment">//æ·»åŠ å…ƒç´ ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ensureCapacityInternalæ–¹æ³•</span></span><br><span class="line">      ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">      <span class="comment">//è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼</span></span><br><span class="line">      elementData[size++] = e;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å†çœ‹ <code>ensureCapacityInternal()</code> æ–¹æ³•</strong></p><p>ç¬¬2æ­¥ï¼ˆJDK7ï¼‰å¯ä»¥çœ‹åˆ° <code>add</code> æ–¹æ³• é¦–å…ˆè°ƒç”¨äº†<code>ensureCapacityInternal(size + 1)</code> ã€‚</p><ul><li><strong>å½“ è¦ add è¿›ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity ä¸º 1ï¼Œåœ¨ Math.max()æ–¹æ³•æ¯”è¾ƒåï¼ŒminCapacity ä¸º 10ã€‚</strong></li><li>ç„¶åå¼€å§‹è°ƒç”¨ <code>ensureExplicitCapacity()</code> æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¾—åˆ°æœ€å°æ‰©å®¹é‡</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">            <span class="comment">// è·å–é»˜è®¤çš„å®¹é‡å’Œä¼ å…¥å‚æ•°çš„è¾ƒå¤§å€¼</span></span><br><span class="line">          minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">      &#125;</span><br><span class="line">     </span><br><span class="line">      ensureExplicitCapacity(minCapacity);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>è°ƒç”¨ <code>ensureCapacityInternal()</code> è¿›å…¥<code>ensureExplicitCapacity()</code>è¿™ä¸ªæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        modCount++;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="comment">//è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº†</span></span><br><span class="line">            grow(minCapacity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸€ä¸‹ï¼š</p><ul><li>å½“æˆ‘ä»¬è¦ add è¿›ç¬¬ 1 ä¸ªå…ƒç´ åˆ° ArrayList æ—¶ï¼ŒelementData.length ä¸º 0 ï¼ˆå› ä¸ºè¿˜æ˜¯ä¸€ä¸ªç©ºçš„ listï¼‰ï¼Œå› ä¸ºæ‰§è¡Œäº† <code>ensureCapacityInternal()</code> æ–¹æ³• ï¼Œ<strong>æ‰€ä»¥ minCapacity æ­¤æ—¶ä¸º 10</strong>ã€‚æ­¤æ—¶ï¼Œ<code>minCapacity - elementData.length &gt; 0</code>æˆç«‹ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ <code>grow(minCapacity)</code> æ–¹æ³•ã€‚</li><li>å½“ add ç¬¬ 2 ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity ä¸º 2ï¼Œæ­¤æ—¶ elementData.length(å®¹é‡)åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ åæ‰©å®¹æˆ 10 äº†ã€‚æ­¤æ—¶ï¼Œ<code>minCapacity - elementData.length &gt; 0</code> ä¸æˆç«‹ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ ï¼ˆæ‰§è¡Œï¼‰<code>grow(minCapacity)</code> æ–¹æ³•ã€‚</li><li>æ·»åŠ ç¬¬ 3ã€4Â·Â·Â·åˆ°ç¬¬ 9 ä¸ªå…ƒç´ æ—¶ï¼Œä¾ç„¶ä¸ä¼šæ‰§è¡Œ grow æ–¹æ³•ï¼Œæ•°ç»„å®¹é‡éƒ½ä¸º 10ã€‚</li></ul><p>ç›´åˆ°æ·»åŠ ç¬¬ 10 ä¸ªå…ƒç´ ï¼Œ<code>minCapacity &lt; elementData.length</code><strong>ä¸æˆç«‹</strong>ã€‚è¿›å…¥ grow æ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚</p></li><li><p><strong>elementData.lengthï¼ˆå®é™…å®¹é‡ï¼‰&gt;= minCapacityï¼ˆæœ€å°éœ€è¦å®¹é‡ï¼‰  , æ‰§è¡Œ grow()</strong></p><blockquote><p><strong>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1),æ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œå¦åˆ™æ˜¯ 1.5 å€å·¦å³ï¼‰ï¼</strong> å¥‡å¶ä¸åŒï¼Œæ¯”å¦‚ ï¼š10+10/2 = 15, 33+33/2=49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°ã€‚</p></blockquote><p>å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠã€æœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ã€‘ã€‚</p><ul><li>æœ€åæ£€æŸ¥è®¾ç½®çš„æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å¤§å®¹é‡MAX_ARRAY_SIZE ï¼Œè¿›å…¥<code>hugeCapacity()</code> :<ul><li>å¦‚æœminCapacityå¤§äºMAX_ARRAY_SIZEï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º <code>Integer.MAX_VALUE - 8</code> ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å°</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line">     </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•growã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span></span><br><span class="line">       <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">       <span class="comment">//å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span></span><br><span class="line">       <span class="comment">//æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span></span><br><span class="line">       <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">       <span class="comment">//ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠã€æœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ã€‘ï¼Œ</span></span><br><span class="line">       <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">           newCapacity = minCapacity;</span><br><span class="line">      <span class="comment">// å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) `hugeCapacity()` æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œ</span></span><br><span class="line">      <span class="comment">//å¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º`Integer.MAX_VALUE`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º `Integer.MAX_VALUE - 8`ã€‚</span></span><br><span class="line">       <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">           newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">       <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">       elementData = Arrays.copyOf(elementData, newCapacity);</span><br></pre></td></tr></table></figure></li><li><p><strong>è®¾ç½®å®Œæ–°å®¹é‡ newCapacity ï¼Œè¿›è¡Œ<code>Arrays.copyOf</code></strong></p><p>Arraysçš„copyOf()æ–¹æ³•ä¼ å›çš„æ•°ç»„æ˜¯æ–°çš„æ•°ç»„å¯¹è±¡ï¼Œæ”¹å˜ä¼ å›æ•°ç»„ä¸­çš„å…ƒç´ å€¼ï¼Œä¸ä¼šå½±å“åŸæ¥çš„æ•°ç»„ã€‚</p><ul><li><u>ç¬¬äºŒä¸ªè‡ªå˜é‡æŒ‡å®šè¦å»ºç«‹çš„æ–°æ•°ç»„é•¿åº¦</u>ï¼Œå¦‚æœæ–°æ•°ç»„çš„é•¿åº¦è¶…è¿‡åŸæ•°ç»„çš„é•¿åº¦ï¼Œåˆ™ä¿ç•™æ•°ç»„é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š</li></ul><p>ä½¿ç”¨ <code>Arrays.copyOf()</code>æ–¹æ³•ä¸»è¦æ˜¯ä¸ºäº†ç»™åŸæœ‰æ•°ç»„æ‰©å®¹ã€‚</p></li></ol></li><li><p><strong>contains()æ–¹æ³•</strong></p><p>å°±æ˜¯éå†æ•°ç»„çœ‹æ˜¯å¦å­˜åœ¨è¯¥å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> indexOf(o) &gt;= <span class="number">0</span>;<span class="comment">//#1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿”å›æŒ‡å®šå…ƒç´ åœ¨åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœè¯¥åˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚*/</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">                <span class="keyword">if</span> (elementData[i]==<span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">                <span class="keyword">if</span> (o.equals(elementData[i]))</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="5-1-å¤šçº¿ç¨‹æ“ä½œArrayListä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯ï¼Ÿ">5.1 å¤šçº¿ç¨‹æ“ä½œArrayListä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯ï¼Ÿ</h5><p>ä»ArrayListçš„ï¼ˆ1ï¼‰æ·»åŠ å…ƒç´ ï¼ˆ<code>add</code>/<code>addAll</code>ï¼‰å’Œï¼ˆ2ï¼‰è·å–å…ƒç´ ï¼ˆ<code>get</code>ï¼‰  ä¸¤ä¸ªè§’åº¦æ¥è¯´ï¼š</p><ol><li><p><strong>å¤šçº¿ç¨‹æ·»åŠ å…ƒç´ </strong></p><p>å‡è®¾æ­¤æ—¶<code>minCapacityï¼ˆæœ€å°éœ€è¦å®¹é‡ï¼‰= 10</code> ï¼Œæ­¤æ—¶æ•°ç»„å®¹é‡æ˜¯10ã€‚A,Bä¸¤ä¸ªçº¿ç¨‹å„éœ€è¦æ·»åŠ è‹¥å¹²å…ƒç´ ï¼Œ<strong>åŒæ—¶</strong> åˆ¤æ–­æ­¤æ—¶ä¸éœ€è¦æ‰©å®¹ï¼Œåç»­å¯èƒ½å°±ä¼šå‘ç”Ÿ<strong>æ•°ç»„è¶Šç•Œ</strong>ã€‚</p></li><li><p><strong>å¤šçº¿ç¨‹è·å–å…ƒç´ </strong></p><p>ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ä¿®æ”¹æŸä¸ªå…ƒç´ ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ­¤æ—¶æ­£åœ¨è¯»ï¼Œé‚£ä¹ˆè¯»åˆ°çš„å°±æ˜¯ä¿®æ”¹å‰çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯<strong>è„æ•°æ®</strong>ã€‚</p></li></ol><h5 id="5-2-arraylistå¯ä»¥å­˜å¤šå°‘æ•°æ®ï¼Ÿ">5.2 <strong>arraylistå¯ä»¥å­˜å¤šå°‘æ•°æ®</strong>ï¼Ÿ</h5><p>Integer.MAX_VALUE = 2147483647 ã€‚</p><p>arrayliståº•å±‚æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼šObject[] arr = new Object[10]ï¼Œæ•°ç»„çš„å¤§å°åªèƒ½è®¾ç½®intç±»å‹ã€‚æ‰€ä»¥èƒ½å­˜å‚¨2147483647 å­—èŠ‚æ•°æ®ã€‚</p><h4 id="6-è¯´ä¸€ä¸‹LinkedListåº•å±‚åŸç†ï¼Ÿ">6. è¯´ä¸€ä¸‹LinkedListåº•å±‚åŸç†ï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000021433760">Javaé›†åˆç³»åˆ—ä¹‹ä¸‰ï¼šLinkedListåº•å±‚åŸç†</a></p></blockquote><p>LinkedListå®ç°äº†<strong>List</strong>æ¥å£å’Œ<strong>Deque</strong>æ¥å£çš„ï¼Œåº•å±‚çš„<strong>åŒç«¯é“¾è¡¨</strong>ç»“æ„ä½¿å®ƒæ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œ<u>ä¹Ÿå…·æœ‰é˜Ÿåˆ—çš„ç‰¹æ€§</u>ï¼Œéçº¿ç¨‹å®‰å…¨çš„ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/2192701-9c26f117619ad840.png" alt="img"></p><blockquote><p>ç›¸æ¯”ArrayListè¦ç®€å•å¾ˆå¤šï¼Œä¸»è¦æ˜¯åŒå‘é“¾è¡¨é‚£äº›æ“ä½œã€‚</p></blockquote><ul><li><p><strong>åº•å±‚ç»“æ„</strong></p><p>æ ¸å¿ƒå±æ€§ã€æ„é€ æ–¹æ³•å’ŒNodeå®šä¹‰å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt;<span class="keyword">extends</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">Deque</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;   <span class="comment">//LinkedListä¸­å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> Node&lt;E&gt; first;  <span class="comment">//å¤´èŠ‚ç‚¹</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">transient</span> Node&lt;E&gt; last;   <span class="comment">//å°¾èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„åˆ—è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†ä¸€ä¸ªæŒ‡å®šçš„é›†åˆæ·»åŠ åˆ°LinkedListä¸­ï¼Œå…ˆå®Œæˆåˆå§‹åŒ–ï¼Œåœ¨è°ƒç”¨æ·»åŠ æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">(Collection&lt;? extends E&gt; c)</span>     </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">        addAll(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NodeèŠ‚ç‚¹    </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">     E item;</span><br><span class="line">     Node&lt;E&gt; next;</span><br><span class="line">     Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">     Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">         <span class="keyword">this</span>.item = element;</span><br><span class="line">         <span class="keyword">this</span>.next = next;</span><br><span class="line">         <span class="keyword">this</span>.prev = prev;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>add() æ–¹æ³•</strong></p><p><strong>æœ´å®æ— åçš„åŒå‘é“¾è¡¨å°¾æ’æ³•</strong>ã€‚è·å¾—å½“å‰æœ€åä¸€ä¸ªèŠ‚ç‚¹æœ€ä¸ºå½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ï¼ŒåŒæ ·æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå‰ç½®èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹ï¼Œç„¶åæŠŠå½“å‰èŠ‚ç‚¹ä½œä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› ä¸ºåªéœ€è¦åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ä¸å‰ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹å‰åå…³ç³»å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    linkLast(e);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">linkLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å¾—å½“å‰æœ€åä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºå‰ç½®èŠ‚ç‚¹ï¼Œå¯èƒ½ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; l = last;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(l, e, <span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">// æŠŠå½“å‰èŠ‚ç‚¹ä½œä¸ºæœ€åçš„èŠ‚ç‚¹</span></span><br><span class="line">    last = newNode;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡æ·»åŠ è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (l == <span class="keyword">null</span>)</span><br><span class="line">        first = newNode;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå‰ç½®èŠ‚ç‚¹çš„åç½®èŠ‚ç‚¹</span></span><br><span class="line">        l.next = newNode;</span><br><span class="line">    size++;</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>add(int index,E e)</strong></p><p>æŒ‰ç´¢å¼•æ’å…¥å…ƒç´ ï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯ç¬¬ä¸€ä¸ªæ·»åŠ çš„å…ƒç´ ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œç›´æ¥ä½¿ç”¨add()æ–¹æ³•æ·»åŠ å°±å¯ä»¥äº†ï¼Œå¦‚æœä¸æ˜¯åˆ™éœ€è¦æ ¹æ®ç´¢å¼•æ¥éå†å¯»æ‰¾é“¾è¡¨ä¸Šå¯¹åº”ä½ç½®ã€‚</p><ul><li>è¿™é‡Œç”¨äº†ä¸ªå°æŠ€å·§ï¼Œ<strong>åˆ¤æ–­ç´¢å¼•æ˜¯åœ¨å‰åŠæ®µè¿˜æ˜¯åœ¨ååŠæ®µ</strong>ï¼Œä»çŸ­çš„é‚£å¤´å¼€å§‹éå†ï¼Œæ‰¾åˆ°ä¹‹åï¼Œæ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå»ºç«‹æ–°çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„å…³ç³»ã€‚æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œnä¸ºsize/2ã€‚</li></ul></li><li><p><strong>get(int index)æ–¹æ³•</strong></p><p>get()æ–¹æ³•æ˜¯ç”¨çš„ä¸Šé¢ä»‹ç»è¿‡çš„node()æ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œnä¸ºsize/2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// åˆ¤æ–­æ•°ç»„è¶Šç•Œ</span></span><br><span class="line">     checkElementIndex(index);</span><br><span class="line">     <span class="comment">// éå†å¯»æ‰¾èŠ‚ç‚¹</span></span><br><span class="line">     <span class="keyword">return</span> node(index).item;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å¾—è¢«æ’å…¥ç´¢å¼•ä¸Šçš„å…ƒç´ </span></span><br><span class="line"><span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"><span class="comment">// å¦‚æœç´¢å¼•æ˜¯åœ¨é“¾è¡¨çš„å‰åŠæ®µ</span></span><br><span class="line"><span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">    <span class="comment">// è·å¾—ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    Node&lt;E&gt; x = first;</span><br><span class="line">    <span class="comment">// å¾€åæ‰¾åˆ°æ’å…¥ç´¢å¼•ä½ç½®ä¸Šçš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">        x = x.next;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœç´¢å¼•æ˜¯åœ¨é“¾è¡¨çš„å‰åŠæ®µ</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// è·å¾—æœ€åä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    Node&lt;E&gt; x = last;</span><br><span class="line">    <span class="comment">// å¾€å‰æ‰¾åˆ°æ’å…¥ç´¢å¼•ä½ç½®ä¸Šçš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">        x = x.prev;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-3-4-è¿­ä»£å™¨">1.3.4 è¿­ä»£å™¨</h3><h4 id="1-è¯·ç®€å•è¯´æ˜ä¸€ä¸‹ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ">1.<strong>è¯·ç®€å•è¯´æ˜ä¸€ä¸‹ä»€ä¹ˆæ˜¯è¿­ä»£å™¨</strong>ï¼Ÿ</h4><p>Iteratoræä¾›äº†ç»Ÿä¸€éå†æ“ä½œé›†åˆå…ƒç´ çš„ç»Ÿä¸€æ¥å£, <strong>Collectionæ¥å£å®ç°Iterableæ¥å£</strong>ã€‚</p><ul><li>æ¯ä¸ªé›†åˆ<strong>éƒ½é€šè¿‡å®ç°Iterableæ¥å£ä¸­iterator()æ–¹æ³•</strong>è¿”å›Iteratoræ¥å£çš„å®ä¾‹, ç„¶åå¯¹é›†åˆçš„å…ƒç´ è¿›è¡Œè¿­ä»£æ“ä½œï¼›</li><li>åœ¨<u><strong>è¿­ä»£å…ƒç´ çš„æ—¶å€™ä¸èƒ½é€šè¿‡é›†åˆçš„æ–¹æ³•åˆ é™¤å…ƒç´ </strong></u>, å¦åˆ™ä¼šæŠ›å‡ºConcurrentModificationException å¼‚å¸¸. ä½†æ˜¯å¯ä»¥é€šè¿‡Iteratoræ¥å£ä¸­çš„remove()æ–¹æ³•è¿›è¡Œåˆ é™¤ã€‚</li></ul><h4 id="2-è¯·ä½ è¯´è¯´Iteratorå’ŒListIteratorçš„åŒºåˆ«ï¼Ÿ">2.<strong>è¯·ä½ è¯´è¯´Iteratorå’ŒListIteratorçš„åŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><strong>éå†ç±»å‹</strong>ï¼š<code>Iterator</code>å¯ç”¨æ¥éå†Setå’ŒListé›†åˆï¼Œä½†æ˜¯<code>ListIterator</code>åªèƒ½ç”¨æ¥éå†Listï¼›</li><li><strong>éå†æ–¹å‘</strong>ï¼š<code>Iterator</code>å¯¹é›†åˆåªèƒ½æ˜¯å‰å‘éå†ï¼Œ<code>ListIterator</code>æ—¢å¯ä»¥å‰å‘ä¹Ÿå¯ä»¥åå‘ï¼›</li><li><strong>åŠŸèƒ½åŒºåˆ«</strong>ï¼š<code>ListIterator</code>å®ç°äº†Iteratoræ¥å£ï¼Œå¹¶åŒ…å«å…¶ä»–çš„åŠŸèƒ½</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> æ ¡æ‹› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é¢å¯¹å¯¹è±¡</title>
      <link href="/p/7257/"/>
      <url>/p/7257/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h2 id="1-2-é¢å¯¹å¯¹è±¡">1.2 é¢å¯¹å¯¹è±¡</h2><h3 id="1-2-1-åŸºæœ¬é—®é¢˜">1.2.1 åŸºæœ¬é—®é¢˜</h3><h4 id="1-ä»‹ç»ä¸€ä¸‹é¢å¯¹å¯¹è±¡ä¸ƒå¤§åŸåˆ™ï¼Ÿä¸‰å¤§ç‰¹æ€§ï¼Ÿ">1.<strong>ä»‹ç»ä¸€ä¸‹é¢å¯¹å¯¹è±¡ä¸ƒå¤§åŸåˆ™ï¼Ÿä¸‰å¤§ç‰¹æ€§</strong>ï¼Ÿ</h4><h5 id="ä¸ƒå¤§åŸåˆ™">ä¸ƒå¤§åŸåˆ™</h5><ul><li><p><strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼š å°±ä¸€ä¸ªç±»æ¥è¯´ï¼Œåº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªèŒè´£</strong>ã€‚</p><blockquote><p>å¦‚æœæœ‰å¤šä¸ªèŒè´£ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºæŠŠè¿™äº›æŒ‡è´£è€¦åˆåœ¨èµ·ï¼Œä¸€ä¸ªèŒè´£çš„å˜åŒ–å°±å¯èƒ½å‰Šå¼±æˆ–æŠ‘åˆ¶äº†è¿™ä¸ªç±»å®Œæˆå…¶ä»–èŒè´£çš„èƒ½åŠ›ï¼Œå¼•èµ·ç±»çš„å˜åŒ–çš„åŸå› å°±ä¼šæœ‰å¤šä¸ªã€‚æ‰€ä»¥åœ¨æ„é€ ä¸€ä¸ªç±»æ—¶ï¼Œ å°†ç±»çš„ä¸åŒèŒè´£åˆ†ç¦»è‡³ä¸¤ä¸ªæˆ–å¤šä¸ªç±»ä¸­(æˆ–è€…æ¥å£ä¸­)ï¼Œç¡®ä¿å¼•èµ·è¯¥ç±»å˜åŒ–çš„åŸå› åªæœ‰ä¸€ä¸ªã€‚</p></blockquote></li><li><p><strong>å¼€é—­åŸåˆ™(OCP)</strong>ï¼š è½¯ä»¶ç»„æˆå®ä½“åº”è¯¥æ˜¯å¯æ‰©å±•çš„ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹ã€‚å¼€æ”¾-å°é—­åŸåˆ™è®¤ä¸ºåº”è¯¥è¯•å›¾è®¾è®¡æ°¸è¿œä¹Ÿä¸éœ€è¦æ”¹å˜çš„æ¨¡å—ã€‚å¯ä»¥æ·»åŠ æ–°ä»£ç æ¥æ‰“å±•ç³»ç»Ÿçš„è¡Œä¸ºï¼Œä¸èƒ½å¯¹å·²æœ‰çš„ä»£ç è¿›è¡Œä¿®æ”¹ã€‚</p><blockquote><p>è¿™ä¸ªåŸåˆ™å¾ˆå¥½çš„å®ç°äº†é¢å‘å¯¹è±¡çš„å°è£…æ€§å’Œå¯é‡ç”¨æ€§ã€‚</p></blockquote></li><li><p><strong>ææ°æ›¿æ¢åŸåˆ™(LSP)</strong>ï¼š å­ç±»åº”å½“å¯ä»¥æ›¿æ¢çˆ¶ç±»å¹¶å‡ºç°åœ¨çˆ¶ç±»èƒ½å¤Ÿå‡ºç°çš„ä»»ä½•åœ°æ–¹ã€‚</p><blockquote><p>ä»¥åœ†å’Œæ¤­åœ†ä¸ºä¾‹ï¼Œåœ†æ˜¯æ¤­åœ†çš„ä¸€ä¸€ä¸ªç‰¹æ®Šå­ç±»ã€‚å› æ­¤ä»»ä½•å‡ºç°æ¤­åœ†çš„åœ°æ–¹ï¼Œåœ†å‡å¯ä»¥å‡ºç°ã€‚</p></blockquote></li><li><p><strong>ä¾èµ–å€’ç½®åŸåˆ™(DIP)</strong>ï¼š åœ¨è¿›è¡Œä¸šåŠ¡è®¾è®¡æ—¶ï¼Œä¸<u>ç‰¹å®šä¸šåŠ¡æœ‰å…³çš„ä¾èµ–</u>å…³ç³»åº”è¯¥å°½é‡ä¾èµ–<strong>æ¥å£å’ŒæŠ½è±¡ç±»</strong>ï¼Œ<strong>è€Œä¸æ˜¯ä¾èµ–äºå…·ä½“ç±»</strong>ã€‚å…·ä½“ç±»åªè´Ÿè´£ç›¸å…³ä¸šåŠ¡çš„å®ç°ï¼Œä¿®æ”¹å…·ä½“ç±»ä¸å½±å“ä¸ç‰¹å®šä¸šåŠ¡æœ‰å…³çš„ä¾èµ–å…³ç³»ã€‚</p><blockquote><p>ä¸ºæ­¤ï¼Œåœ¨è¿›è¡Œä¸šåŠ¡è®¾è®¡æ—¶ï¼Œåº”å°½é‡åœ¨æ¥å£æˆ–æŠ½è±¡ç±»ä¸­å®šä¹‰ä¸šåŠ¡æ–¹æ³•çš„åŸå‹ï¼Œå¹¶é€šè¿‡å…·ä½“çš„å®ç°ç±»(å­ç±»)æ¥å®ç°è¯¥ä¸šåŠ¡æ–¹æ³•ï¼Œä¸šåŠ¡æ–¹æ³•å†…å®¹çš„ä¿®æ”¹å°†ä¸ä¼šå½±å“åˆ°è¿è¡Œæ—¶ä¸šåŠ¡æ–¹æ³•çš„è°ƒç”¨ã€‚</p></blockquote></li><li><p><strong>æ¥å£åˆ†ç¦»åŸåˆ™(ISP)</strong>ï¼š  <u>é‡‡ç”¨å¤šä¸ªä¸ç‰¹å®šå®¢æˆ·ç±»æœ‰å…³çš„æ¥å£</u> æ¯”é‡‡ç”¨ä¸€ä¸ªé€šç”¨çš„æ¶µç›–å¤šä¸ªä¸šåŠ¡æ–¹æ³•çš„æ¥å£è¦å¥½ã€‚</p><blockquote><p>ä¸¾ä¾‹ï¼šå¦‚æœæ‹¥æœ‰ä¸€ä¸ªé’ˆå¯¹å¤šä¸ªå®¢æˆ·çš„ç±»ï¼Œä¸ºæ¯ä¸€ä¸ªå®¢æˆ·åˆ›å»ºç‰¹å®šä¸šåŠ¡æ¥å£ï¼Œç„¶åä½¿è¯¥å®¢æˆ·ç±»ç»§æ‰¿å¤šä¸ªç‰¹å®šä¸šåŠ¡æ¥å£å°†<u>æ¯”ç›´æ¥åŠ è½½å®¢æˆ·æ‰€éœ€æ‰€æœ‰æ–¹æ³•æœ‰æ•ˆ</u>ã€‚</p></blockquote></li><li><p><strong>ç»„åˆé‡ç”¨åŸåˆ™</strong> ï¼šèƒ½ç”¨ç»„åˆå®ç°çš„åœ°æ–¹ï¼Œ<strong>å°½é‡ç”¨ç»„åˆæ¥</strong>å®ç°ï¼Œè€Œ<strong>ä¸è¦ä½¿ç”¨ç»§æ‰¿</strong>æ¥æ‰©å±•åŠŸèƒ½ã€‚</p><blockquote><p>097å› ä¸ºç»„åˆèƒ½æ›´å¥½åœ°å®ç°å°è£…ï¼Œæ¯”ç»§æ‰¿å…·æœ‰æ›´å¤§çš„çµæ´»æ€§å’Œæ›´ç¨³å®šçš„ç»“æ„ã€‚</p></blockquote></li><li><p><strong>è¿ªç±³ç‰¹åŸåˆ™ :</strong> <u>ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹äºå…¶ä»–å¯¹è±¡æœ‰æœ€å°‘çš„äº†è§£</u>ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¯ä»¥æœ‰æ•ˆåœ°é™ä½ç±»ä¹‹é—´çš„è€¦åˆè¦æ±‚ã€‚</p></li></ul><h5 id="ä¸‰å¤§ç‰¹æ€§">ä¸‰å¤§ç‰¹æ€§</h5><ul><li><p><strong>å°è£…</strong>ã€‚<u>å°è£…æŠŠâ¼€ä¸ªå¯¹è±¡çš„å±æ€§ç§æœ‰åŒ–ï¼ŒåŒæ—¶æä¾›â¼€äº›å¯ä»¥è¢«å¤–ç•Œè®¿é—®çš„å±æ€§çš„æ–¹æ³•</u>ï¼Œå¦‚æœå±æ€§ä¸æƒ³è¢«å¤–ç•Œè®¿é—®ï¼Œæˆ‘ä»¬å¤§å¯ä¸å¿…æä¾›æ–¹æ³•ç»™å¤–ç•Œè®¿é—®ã€‚ä½†æ˜¯å¦‚æœâ¼€ä¸ªç±»æ²¡æœ‰æä¾›ç»™å¤–ç•Œè®¿é—®çš„æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ã€‚</p></li><li><p><strong>ç»§æ‰¿</strong>ã€‚ <u>ç»§æ‰¿æ˜¯ä½¿ç”¨å·²å­˜åœ¨çš„ç±»çš„å®šä¹‰ä½œä¸ºåŸºç¡€å»ºâ½´æ–°ç±»çš„æŠ€æœ¯ï¼Œæ–°ç±»çš„å®šä¹‰å¯ä»¥å¢åŠ æ–°çš„æ•°æ®æˆ–æ–°çš„åŠŸèƒ½</u>ï¼Œä¹Ÿå¯ä»¥ç”¨â½—ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½é€‰æ‹©æ€§åœ°ç»§æ‰¿â½—ç±»ã€‚é€šè¿‡ä½¿ç”¨ç»§æ‰¿æˆ‘ä»¬èƒ½å¤Ÿéå¸¸æ–¹ä¾¿åœ°<strong>å¤ç”¨</strong>ä»¥å‰çš„ä»£ç ã€‚</p><blockquote><ol><li>å­ç±»æ‹¥æœ‰â½—ç±»å¯¹è±¡æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼ˆåŒ…æ‹¬ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•ï¼‰ï¼Œä½†æ˜¯â½—ç±»ä¸­çš„ç§æœ‰å±æ€§å’Œæ–¹æ³•å­ç±»æ˜¯æ— æ³•è®¿é—®ï¼Œåªæ˜¯æ‹¥æœ‰ã€‚</li><li>å­ç±»å¯ä»¥æ‹¥æœ‰â¾ƒâ¼°å±æ€§å’Œæ–¹æ³•ï¼Œå³å­ç±»å¯ä»¥å¯¹â½—ç±»è¿›è¡Œæ‰©å±•ã€‚</li><li>å­ç±»å¯ä»¥ç”¨â¾ƒâ¼°çš„æ–¹å¼å®ç°â½—ç±»çš„æ–¹æ³•ã€‚</li></ol></blockquote></li><li><p><strong>å¤šæ€</strong>ã€‚ï¼ˆ1ï¼‰<strong>é™æ€å¤šæ€ï¼šé‡è½½</strong> ï¼ˆ2ï¼‰<strong>åŠ¨æ€å¤šæ€</strong>ï¼šæ‰€è°“å¤šæ€å°±æ˜¯æŒ‡ç¨‹åºä¸­å®šä¹‰çš„<strong>å¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹</strong>å’Œ&lt;é€šè¿‡è¯¥<strong>å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨</strong>åœ¨<strong>ç¼–ç¨‹æ—¶å¹¶ä¸ç¡®å®š</strong>ï¼Œè€Œæ˜¯åœ¨ã€<strong>ç¨‹åºè¿è¡ŒæœŸé—´æ‰ç¡®å®š</strong>ã€‘ã€‚å³â¼€ä¸ªå¼•ç”¨å˜é‡åˆ°åº•ä¼šæŒ‡å‘å“ªä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­å®ç°çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨ç”±ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½å†³å®šã€‚</p><blockquote><p>åœ¨ Java ä¸­æœ‰ä¸¤ç§å½¢å¼å¯ä»¥å®ç°å¤šæ€ï¼š<strong>ç»§æ‰¿</strong>ï¼ˆå¤šä¸ªå­ç±»å¯¹åŒâ¼€æ–¹æ³•çš„é‡å†™ï¼‰å’Œ<strong>æ¥å£</strong>ï¼ˆå®ç°æ¥å£å¹¶è¦†ç›–æ¥å£ä¸­åŒâ¼€æ–¹æ³•ï¼‰ã€‚</p></blockquote></li></ul><h5 id="1-1-javaå¤šæ€çš„åŸç†ï¼Ÿã€é˜¿é‡Œ-å¾…é‡å†™ã€‘">1.1 javaå¤šæ€çš„åŸç†ï¼Ÿã€é˜¿é‡Œ&amp;å¾…é‡å†™ã€‘</h5><p>å¤šæ€åˆ†ä¸¤ç§ï¼šï¼ˆ1ï¼‰ã€ç¼–è¯‘ã€‘æ—¶å¤šæ€ï¼ˆé™æ€å¤šæ€ï¼‰ï¼ˆ2ï¼‰è¿è¡Œæ—¶å¤šæ€ï¼ˆåŠ¨æ€å¤šæ€ï¼‰ã€‚</p><ol><li><p><strong>é™æ€å¤šæ€</strong></p><p><strong>é‡è½½</strong>ï¼ˆoverloadï¼‰å°±æ˜¯ç¼–è¯‘æ—¶å¤šæ€çš„ä¸€ä¸ªä¾‹å­ï¼Œ<strong>ç¼–è¯‘æ—¶</strong>å¤šæ€åœ¨ç¼–è¯‘æ—¶å°±å·²ç»<strong>ç¡®å®š</strong>ã€‚</p><p>è¿è¡Œæ—¶è¿è¡Œçš„æ—¶å€™è°ƒç”¨çš„æ˜¯ç¡®å®šçš„æ–¹æ³•ã€‚</p></li><li><p><strong>åŠ¨æ€å¤šæ€</strong></p><blockquote><p>æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„å¤šæ€æŒ‡çš„éƒ½æ˜¯è¿è¡Œæ—¶å¤šæ€ï¼Œä¹Ÿå°±æ˜¯<strong>ç¼–è¯‘æ—¶ä¸ç¡®å®šç©¶ç«Ÿè°ƒç”¨å“ªä¸ªå…·ä½“æ–¹æ³•</strong>ï¼Œä¸€ç›´å»¶è¿Ÿåˆ°è¿è¡Œæ—¶ï¼ˆ<strong>é“¾æ¥è¿‡ç¨‹</strong>ï¼‰æ‰èƒ½ç¡®å®šã€‚</p></blockquote><p>é€šå¸¸åŠ¨æ€å¤šæ€çš„å®ç°æ–¹æ³•ï¼š</p><ol><li>å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼ˆextendsï¼‰</li><li>ç±»å®ç°æ¥å£ï¼ˆimplementsï¼‰</li></ol><p>æ ¸å¿ƒä¹‹å¤„å°±åœ¨äº<strong>å¯¹çˆ¶ç±»æ–¹æ³•çš„æ”¹å†™æˆ–å¯¹æ¥å£æ–¹æ³•çš„å®ç°</strong>ï¼Œä»¥å–å¾—åœ¨è¿è¡Œæ—¶ä¸åŒçš„æ‰§è¡Œæ•ˆæœã€‚</p></li><li><p><strong>å¤šæ€è¿è¡Œçš„åŸç†</strong></p><blockquote><p>è¯¦ç»†å»ºè®®æŸ¥çœ‹ï¼š<a href="https://zhuanlan.zhihu.com/p/94086109">æ·±å…¥ç†è§£Javaå¤šæ€çš„å®ç°åŸç†</a></p></blockquote><ul><li><p><strong>èƒŒæ™¯ä»‹ç»</strong></p><p><img src="https://i.loli.net/2021/04/21/m1Ot3nQcMGq2YfW.jpg" alt="img"></p><p><u>ç±»åŠ è½½</u> æ—¶ä¼šå°†<strong>ç±»çš„å…ƒæ•°æ®ä¿¡æ¯</strong>ï¼ˆ<strong>ç±»çš„æ–¹æ³•ä»£ç ã€ç±»å˜é‡ã€æˆå‘˜å˜é‡çš„å®šä¹‰</strong>ç­‰ç­‰ï¼‰ä¿å­˜åˆ°æ–¹æ³•åŒºï¼Œ<strong>æ–¹æ³•åŒº</strong>ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ol><li><strong>å¸¸é‡æ± </strong>ï¼šJava ç±»å¼•ç”¨çš„ä¸€äº›å¸¸é‡ä¿¡æ¯ï¼Œæ¯”å¦‚<strong>ç±»çš„ç¬¦å·å¼•ç”¨ä¿¡æ¯</strong></li><li><strong>æ–¹æ³•åŒºå…¶å®ƒéƒ¨åˆ†</strong>ï¼š ä¿å­˜<strong>æ–¹æ³•è¡¨</strong>ç­‰</li></ol><p><u>é“¾æ¥è¿‡ç¨‹</u> <strong>ç±»çš„å¤šæ€å°±å‘ç”Ÿåœ¨ <u>é“¾æ¥çš„è§£æ</u></strong> è¿‡ç¨‹ï¼Œå°† <u>ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨</u>ã€‚</p></li><li><p><strong>åŸç†ç®€è¿°ï¼ˆå­ç±»æ–¹æ³•ç»§æ‰¿</strong>ï¼‰</p><blockquote><p>å‚è€ƒï¼š<a href="https://www.huaweicloud.com/articles/9b805c24ab31a65f5883c0dfeaf5a39b.html">https://www.huaweicloud.com/articles/9b805c24ab31a65f5883c0dfeaf5a39b.html</a></p></blockquote></li></ul></li></ol><h4 id="2-è¯·è§£é‡ŠJavaä¸­çš„æ¦‚å¿µï¼Œä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ï¼Ÿä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°é‡è½½ï¼Ÿä»€ä¹ˆæ˜¯å¤åˆ¶æ„é€ å‡½æ•°ï¼Ÿ">2.<strong>è¯·è§£é‡ŠJavaä¸­çš„æ¦‚å¿µï¼Œä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°ï¼Ÿä»€ä¹ˆæ˜¯æ„é€ å‡½æ•°é‡è½½ï¼Ÿä»€ä¹ˆæ˜¯å¤åˆ¶æ„é€ å‡½æ•°</strong>ï¼Ÿ</h4><ul><li><strong>æ„é€ å‡½æ•°</strong>ï¼š æ¯ä¸€ä¸ªç±»éƒ½æœ‰æ„é€ å‡½æ•°ï¼Œç¨‹åºå‘˜æ²¡æœ‰åˆ›å»ºæ—¶ï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼›<strong>å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œæ„é€ å‡½æ•°è¢«è°ƒç”¨</strong>ï¼›</li><li><strong>æ„é€ å‡½æ•°é‡è½½</strong>ï¼š å’Œæ–¹æ³•é‡è½½ç±»ä¼¼ï¼Œä¸€ä¸ªç±»å¯ä»¥åˆ›å»ºå¤šä¸ªæ„é€ å‡½æ•°ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰<strong>å”¯ä¸€å‚æ•°åˆ—è¡¨</strong>ï¼›</li><li><strong>å¤åˆ¶æ„é€ å‡½æ•°</strong>ï¼š Javaä¸æ”¯æŒåƒC++ä¸­é‚£æ ·çš„å¤åˆ¶æ„é€ å‡½æ•°ã€‚</li></ul><h4 id="3-è¯·è¯´æ˜Javaä¸­çš„æ–¹æ³•é‡å†™-Overriding-å’Œæ–¹æ³•é‡è½½-Overloading-æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ„é€ å‡½æ•°èƒ½å¦è¢«é‡å†™ï¼Ÿ">3.<strong>è¯·è¯´æ˜Javaä¸­çš„æ–¹æ³•é‡å†™(Overriding)å’Œæ–¹æ³•é‡è½½(Overloading)æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ„é€ å‡½æ•°èƒ½å¦è¢«é‡å†™</strong>ï¼Ÿ</h4><ul><li><p>Overriding ï¼š æ–¹æ³•é‡å†™æ˜¯è¯´<u>å­ç±»é‡æ–°å®šä¹‰äº†çˆ¶ç±»çš„æ–¹æ³•</u>ï¼Œæœ‰<u>ç›¸åŒçš„æ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨å’Œè¿”å›ç±»å‹</u> ï¼›</p></li><li><p>Overloadingï¼š åŒä¸€ä¸ªç±»é‡Œé¢ä¸¤ä¸ªæˆ–è€…æ˜¯å¤šä¸ªæ–¹æ³•<u>åŒå</u> ï¼Œä½† <u>å‚æ•°åˆ—è¡¨ä¸åŒ</u>ä¸åŒã€‚</p><blockquote><p>ç‰¹åˆ«çš„é‡å†™è¦æ±‚è¿”å›ç±»å‹ä¸€è‡´ï¼Œä½†<strong>é‡è½½ä¸è¦æ±‚è¿”å›ç±»å‹ä¸€è‡´</strong>ï¼</p></blockquote></li></ul><p><strong>æ„é€ å‡½æ•°ä¸èƒ½è¢« overrideï¼ˆé‡å†™ï¼‰</strong>ï¼ä½†æ˜¯å¯ä»¥ overloadï¼ˆé‡è½½ï¼‰,æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°â¼€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ„é€ å‡½æ•°çš„æƒ…å†µã€‚</p><h5 id="3-1-fï¼ˆList-String-lï¼‰-fï¼ˆList-Integer-lï¼‰æ˜¯é‡è½½ä¹ˆï¼Ÿ">3.1 fï¼ˆList&lt;String&gt; lï¼‰ fï¼ˆList&lt;Integer&gt; lï¼‰æ˜¯é‡è½½ä¹ˆï¼Ÿ</h5><p>ä¸æ˜¯é‡è½½ã€‚</p><p>é™æ€ç±»å‹ä¸€è‡´ï¼Œå¹¶<strong>ä¸ä¼šå› ä¸ºæ³›å‹è€Œæ”¹å˜</strong>ã€‚å› ä¸º<strong>ç¼–è¯‘</strong>æœŸé—´ï¼Œä¼šå¯¹æ³›å‹è¿›è¡Œ<strong>æ“¦é™¤</strong>ã€‚</p><h4 id="4-ä»‹ç»ä¸€ä¸‹æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿ">4.<strong>ä»‹ç»ä¸€ä¸‹æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«</strong>ï¼Ÿ</h4><ul><li><p><strong>è®¾è®¡å±‚é¢</strong></p><p>æ¥å£ï¼Œæ˜¯å¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œçº¦æŸï¼Œ<strong>å¼ºåˆ¶è¦æ±‚</strong>ä¸åŒç±»å®ç°ç›¸åŒè¡Œä¸º ï¼› æŠ½è±¡ç±»ï¼Œæ—¢ 1.<strong>éæŠ½è±¡ç±»å®ç°ä»£ç å¤ç”¨</strong> 2.åˆåŒæ—¶æœ‰<strong>æŠ½è±¡æ–¹æ³•ä½¿å¾—è¢«ç»§æ‰¿ç±»å„è‡ªå®ç°</strong>ã€‚</p></li><li><p><strong>æ–¹æ³•å®ç°</strong></p><p>æŠ½è±¡ç±»å¯ä»¥<strong>æœ‰éæŠ½è±¡æ–¹æ³•ï¼Œæœ‰æ–¹æ³•ä½“</strong> ï¼› æ¥å£ä¸èƒ½æœ‰ã€‚</p><blockquote><p><strong>æŠ½è±¡ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œä½ å¯ä»¥ç»™å®ƒæä¾›é»˜è®¤çš„å®ç°</strong>ã€‚å› æ­¤ä½ ä¸éœ€è¦æ”¹å˜ä½ ç°åœ¨çš„ä»£ç ã€‚ å¦‚æœä½ å¾€æ¥å£ä¸­æ·»åŠ æ–¹æ³•ï¼Œé‚£ä¹ˆä½ å¿…é¡»æ”¹å˜å®ç°è¯¥æ¥å£çš„ç±»ã€‚</p></blockquote></li><li><p><strong>æ„é€ å‡½æ•°</strong></p><p>æŠ½è±¡ç±»æœ‰ï¼›æ¥å£æ²¡æœ‰ã€‚</p></li><li><p><strong>ä¿®é¥°ç¬¦</strong></p><p>æŠ½è±¡ç±»é™¤private éƒ½æœ‰ï¼ˆæŠ½è±¡ç±»ç›®çš„æ˜¯è¢«ç»§æ‰¿ï¼Œæ‰€ä»¥<strong>æŠ½è±¡æ–¹æ³•æ˜¯ä¸ºè¢«é‡å†™ï¼Œä¸èƒ½ç§æœ‰</strong>ï¼‰ï¼›æ¥å£<strong>é»˜è®¤public</strong>ã€‚</p></li><li><p><strong>ç»§æ‰¿ä¸ªæ•° [æ¥å£ä¼˜]</strong></p><p>æŠ½è±¡ç±»åªèƒ½è¢«ç»§æ‰¿ä¸€æ¬¡ï¼›æ¥å£å¯ä»¥æœ‰å¤šä¸ªã€‚</p></li></ul><h4 id="5-Javaçš„å››ç§å¼•ç”¨ï¼Ÿå¼ºè½¯å¼±è™š-ï¼Ÿ">5. <strong>Javaçš„å››ç§å¼•ç”¨ï¼Ÿå¼ºè½¯å¼±è™š</strong> ï¼Ÿ</h4><ul><li><p><strong>å¼ºå¼•ç”¨</strong> ï¼šå¼ºå¼•ç”¨æ˜¯å¹³å¸¸ä¸­ä½¿ç”¨æœ€å¤šçš„å¼•ç”¨ï¼Œå¼ºå¼•ç”¨<strong>åœ¨ç¨‹åºå†…å­˜ä¸è¶³ï¼ˆOOM</strong>ï¼‰çš„æ—¶å€™ä¹Ÿä¸ä¼šè¢«å›æ”¶ï¼Œä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="keyword">new</span> String(<span class="string">&quot;str&quot;</span>);</span><br><span class="line">System.out.println(str);</span><br></pre></td></tr></table></figure></li><li><p><strong>è½¯å¼•ç”¨</strong>ï¼š è½¯å¼•ç”¨<strong>åœ¨ç¨‹åºå†…å­˜ä¸è¶³æ—¶ï¼Œä¼šè¢«å›æ”¶ï¼ˆâ€œè½¯â€ï¼Œæ²¡é’±ç”¨äº†ç¬¬ä¸€ä¸ªè¢«æ‰“åŠ«</strong>ï¼‰ï¼Œä½¿ç”¨æ–¹å¼ï¼š</p><blockquote><p>å¯ç”¨åœºæ™¯ï¼š åˆ›å»ºç¼“å­˜çš„æ—¶å€™ï¼Œåˆ›å»ºçš„å¯¹è±¡æ”¾è¿›ç¼“å­˜ä¸­ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMå°±ä¼šå›æ”¶<u>æ—©å…ˆåˆ›å»ºçš„å¯¹è±¡</u>ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„ï¼šwrfè¿™ä¸ªå¼•ç”¨ä¹Ÿæ˜¯å¼ºå¼•ç”¨ï¼Œå®ƒæ˜¯æŒ‡å‘SoftReferenceè¿™ä¸ªå¯¹è±¡çš„ï¼Œ</span></span><br><span class="line"><span class="comment">// è¿™é‡Œçš„è½¯å¼•ç”¨æŒ‡çš„æ˜¯æŒ‡å‘new String(&quot;str&quot;)çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯SoftReferenceç±»ä¸­T</span></span><br><span class="line">SoftReference&lt;String&gt; wrf = <span class="keyword">new</span> SoftReference&lt;String&gt;(<span class="keyword">new</span> String(<span class="string">&quot;str&quot;</span>));</span><br></pre></td></tr></table></figure></li><li><p><strong>å¼±å¼•ç”¨</strong>ï¼šæ˜¯<strong>åªè¦<u>JVMåƒåœ¾å›æ”¶å™¨å‘ç°äº†å¼±å¼•ç”¨</u>ï¼Œå°±ä¼šå°†ä¹‹å›æ”¶</strong>ï¼Œä½¿ç”¨æ–¹å¼ï¼š</p><blockquote><p><strong>å¯ç”¨åœºæ™¯</strong>ï¼š  Javaæºç ä¸­çš„ java.util.WeakHashMap ä¸­çš„ key å°±æ˜¯ä½¿ç”¨å¼±å¼•ç”¨ã€‚ä¸€æ—¦æˆ‘ä¸éœ€è¦æŸä¸ªå¼•ç”¨ï¼ŒJVMä¼šè‡ªåŠ¨å¸®æˆ‘å¤„ç†å®ƒï¼Œè¿™æ ·æˆ‘å°±ä¸éœ€è¦åšå…¶å®ƒæ“ä½œã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WeakReference&lt;String&gt; wrf = <span class="keyword">new</span> WeakReference&lt;String&gt;(str);</span><br></pre></td></tr></table></figure></li><li><p><strong>è™šå¼•ç”¨ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–å¯¹ä¸€ä¸ªå¯¹è±¡çš„çœŸå®å¼•ç”¨</strong>ï¼› è™šå¼•ç”¨å¿…é¡»ä¸ReferenceQueueä¸€èµ·ä½¿ç”¨ï¼Œå½“GCå‡†å¤‡å›æ”¶ä¸€ä¸ª<strong>å¯¹è±¡</strong>ï¼Œå¦‚æœå‘ç°<strong>å®ƒè¿˜æœ‰è™šå¼•ç”¨</strong>ï¼Œå°±ä¼šåœ¨å›æ”¶ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„ReferenceQueueä¸­ã€‚</p><blockquote><p>å¯ç”¨åœºæ™¯ï¼š å¯¹è±¡é”€æ¯å‰çš„ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è¯´èµ„æºé‡Šæ”¾ç­‰ã€‚ Object.finalize() è™½ç„¶ä¹Ÿå¯ä»¥åšè¿™ç±»åŠ¨ä½œï¼Œä½†æ˜¯è¿™ä¸ªæ–¹å¼å³ä¸å®‰å…¨åˆä½æ•ˆã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PhantomReference&lt;String&gt; prf = <span class="keyword">new</span> PhantomReference&lt;String&gt;(<span class="keyword">new</span> String(<span class="string">&quot;str&quot;</span>),</span><br><span class="line"><span class="keyword">new</span> ReferenceQueue&lt;&gt;());</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-JAVAåˆ›å»ºå¯¹è±¡çš„æœºåˆ¶ï¼Ÿ">6. <strong>JAVAåˆ›å»ºå¯¹è±¡çš„æœºåˆ¶</strong>ï¼Ÿ</h4><ul><li><p>newåˆ›å»ºæ–°å¯¹è±¡</p></li><li><p>é€šè¿‡åå°„æœºåˆ¶</p></li><li><p>é‡‡ç”¨cloneæœºåˆ¶</p></li><li><p>é€šè¿‡åºåˆ—åŒ–æœºåˆ¶</p></li></ul><h4 id="7-ç®€è¿°Javaçš„å¯¹è±¡ç»“æ„ï¼Ÿ">7.<strong>ç®€è¿°Javaçš„å¯¹è±¡ç»“æ„</strong>ï¼Ÿ</h4><p>Javaå¯¹è±¡ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€<u>å¯¹é½å¡«å……</u>ã€‚</p><ol><li><p><strong>å¯¹è±¡å¤´</strong>ã€‚ åœ¨JVMä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­é™¤äº†æœ¬èº«çš„æ•°æ®å¤–è¿˜ä¼šæœ‰ä¸ªå¯¹è±¡å¤´ï¼Œå¯¹äºæ™®é€šå¯¹è±¡è€Œè¨€ï¼Œå…¶å¯¹è±¡å¤´ä¸­æœ‰ä¸¤ç±»ä¿¡æ¯ï¼š<strong>mark wordå’Œç±»å‹æŒ‡é’ˆ</strong>ã€‚ å¦‚æœæ˜¯æ•°ç»„å¯¹è±¡ï¼Œè¿˜æœ‰æ•°ç»„é•¿åº¦ã€‚</p><ol><li><p><u><code>mark word(32ä½)</code></u></p><p><img src="https://i.loli.net/2021/05/16/PjXkchreF9sSEKG.png" alt="image-20210516131559341"></p><ul><li>å…·ä½“çš„å†…å®¹åŒ…å«å¯¹è±¡çš„hashcodeã€åˆ†ä»£å¹´é¾„ã€è½»é‡çº§é”æŒ‡é’ˆã€é‡é‡çº§é”æŒ‡é’ˆã€GCæ ‡è®°ï¼ˆåˆ†ä»£å¹´é¾„ï¼‰ã€åå‘é”çº¿ç¨‹IDã€åå‘é”æ—¶é—´æˆ³ã€‚</li><li>å½“å¯¹è±¡çŠ¶æ€ä¸ºåå‘é”æ—¶ï¼Œ<code>mark word</code>å­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹IDï¼›å½“çŠ¶æ€ä¸ºè½»é‡çº§é”ï¼ˆlightweight lockedï¼‰æ—¶ï¼Œ<code>mark word</code>å­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­<code>Lock Record</code>çš„æŒ‡é’ˆï¼›<strong>å½“çŠ¶æ€ä¸ºé‡é‡çº§é”ï¼ˆinflatedï¼‰æ—¶ï¼Œä¸ºæŒ‡å‘å †ä¸­çš„monitorå¯¹è±¡çš„æŒ‡é’ˆ</strong>ã€‚</li></ul></li><li><p><u>å­˜å‚¨ç±»å‹æŒ‡é’ˆ</u>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘ç±»çš„å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ‰èƒ½ç¡®å®šå¯¹è±¡æ˜¯<strong>å±äºå“ªä¸ªç±»çš„å®ä¾‹</strong>ï¼›</p></li><li><p><u>æ•°ç»„é•¿åº¦ï¼š</u>å¦å¤–å¯¹äºæ•°ç»„è€Œè¨€è¿˜ä¼šæœ‰ä¸€ä»½è®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ã€‚</p></li></ol></li><li><p><strong>å®ä¾‹æ•°æ®</strong>ã€‚ æ¥å­˜å‚¨å¯¹è±¡çœŸæ­£çš„æœ‰æ•ˆä¿¡æ¯ï¼ˆåŒ…æ‹¬çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œè‡ªå·±å®šä¹‰çš„ï¼‰ï¼›</p></li><li><p><strong>å¯¹é½å¡«å……</strong>ã€‚JVMè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼ˆ8å­—èŠ‚å¯¹é½ï¼‰ã€‚</p></li></ol><h4 id="8-Objectæœ‰å“ªäº›å¸¸ç”¨æ–¹æ³•ï¼Ÿ">8. Objectæœ‰å“ªäº›å¸¸ç”¨æ–¹æ³•ï¼Ÿ</h4><ul><li><em>equalsæ–¹æ³•</em></li><li>hashCodeæ–¹æ³•</li><li>waitæ–¹æ³•</li><li>notifyæ–¹æ³•</li><li>notifyAllæ–¹æ³•</li></ul><h3 id="1-2-2-åå°„">1.2.2 åå°„</h3><h4 id="1-è¯·è¯´æ˜ä¸€ä¸‹JAVAä¸­åå°„çš„å®ç°è¿‡ç¨‹å’Œä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ-ï¼ˆå¿«æ‰‹ï¼‰ä¼˜ç¼ºç‚¹ï¼Ÿ">1.<strong>è¯·è¯´æ˜ä¸€ä¸‹JAVAä¸­åå°„çš„å®ç°è¿‡ç¨‹å’Œä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ ï¼ˆå¿«æ‰‹ï¼‰ä¼˜ç¼ºç‚¹ï¼Ÿ</h4><ul><li><p><strong>å®šä¹‰</strong></p><p>åå°„æœºåˆ¶æ˜¯<strong>åœ¨è¿è¡Œæ—¶</strong>ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ã€‚åœ¨javaä¸­ï¼Œåªè¦ç»™å®šç±»çš„åå­—ï¼Œå°±å¯ä»¥é€šè¿‡åå°„æœºåˆ¶æ¥è·å¾—ç±»çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><blockquote><p>jdbcå°±æ˜¯å…¸å‹çš„åå°„ :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&#x27;com.mysql.jdbc.Driver.class&#x27;</span>);<span class="comment">//åŠ è½½MySQLçš„é©±åŠ¨ç±»</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p><strong>å®ç°å’Œä½œç”¨</strong></p><p>JAVAè¯­è¨€ç¼–è¯‘ä¹‹åä¼šç”Ÿæˆä¸€ä¸ª<code>.class</code>æ–‡ä»¶ï¼Œåå°„å°±æ˜¯é€šè¿‡<strong>å­—èŠ‚ç </strong>æ–‡ä»¶<strong>æ‰¾åˆ°æŸä¸€ä¸ªç±»ã€ç±»ä¸­çš„æ–¹æ³•ä»¥åŠå±æ€§</strong>ç­‰ã€‚</p><ul><li><p><strong>å®ç°</strong>ï¼š ï¼ˆ1ï¼‰<strong>ä»£ç ä¼šç¼–è¯‘æˆä¸€ä¸ª.classæ–‡ä»¶</strong> ï¼ˆ2ï¼‰<strong>ç±»åŠ è½½å™¨åŠ è½½è¿›JVMçš„å†…å­˜ä¸­ï¼Œåœ¨æ–¹æ³•åŒºåˆ›å»ºäº†Objectç±»çš„Classå¯¹è±¡</strong></p><blockquote><p>ä¸æ˜¯newå‡ºæ¥çš„å¯¹è±¡ï¼Œè€Œæ˜¯ç±»çš„ç±»å‹å¯¹è±¡ï¼Œæ¯ä¸ªç±»éƒ½åªæœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºç±»çš„æ•°æ®ç»“æ„çš„æ¥å£ã€‚</p></blockquote><p>æˆ‘ä»¬ä¾¿æ˜¯é€šè¿‡è¿™ä¸ªclasså¯¹è±¡æ¥è¿›è¡Œåå°„è·å–ç±»çš„ä¿¡æ¯ã€‚</p></li><li><p><strong>ä½œç”¨</strong>ï¼š</p><ol><li>åå°„æœºåˆ¶æŒ‡çš„æ˜¯ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½å¤Ÿè·å–è‡ªèº«çš„ä¿¡æ¯ã€‚åœ¨JAVAä¸­ï¼Œ<strong><u>åªè¦ç»™å®šç±»çš„åå­—</u></strong>ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡åå°„æœºåˆ¶æ¥è·å–ç±»çš„æ‰€æœ‰ä¿¡æ¯ã€‚</li><li>æ ¹æ®ç±»ååœ¨<strong>è¿è¡Œæ—¶åˆ›å»ºå®ä¾‹</strong>ï¼ˆç±»åå¯ä»¥ä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œä¸ç”¨newï¼‰</li></ol></li></ul></li><li><p><strong>åå°„ä¼˜ç¼ºç‚¹</strong></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šï¼ˆ1ï¼‰å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›ï¼ˆ2ï¼‰å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•</li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li><strong>æ€§èƒ½é™ä½</strong> ï¼š åå°„åŒ…æ‹¬äº†ä¸€äº›<strong>åŠ¨æ€ç±»å‹</strong>ï¼Œæ‰€ä»¥JVM<strong>æ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–</strong></li><li><strong>å®‰å…¨é™åˆ¶</strong>ï¼š ä½¿ç”¨åå°„æŠ€æœ¯è¦æ±‚ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ª<strong>æ²¡æœ‰å®‰å…¨é™åˆ¶çš„ç¯å¢ƒ</strong>ä¸­è¿è¡Œ</li><li><strong>å†…éƒ¨æš´éœ²</strong>ï¼šç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œä¸€äº›åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸è¢«å…è®¸çš„æ“ä½œï¼ˆæ¯”å¦‚<strong>è®¿é—®ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•</strong>ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„å‰¯ä½œç”¨</li></ul></li></ul></li></ul><h4 id="2-è§£é‡Šä¸€ä¸‹JAVAä»£ç†æ¨¡å¼ï¼ŸåŠ¨æ€ä»£ç†çš„åŸç†ï¼Ÿ">2. è§£é‡Šä¸€ä¸‹JAVAä»£ç†æ¨¡å¼ï¼ŸåŠ¨æ€ä»£ç†çš„åŸç†ï¼Ÿ</h4><blockquote><p>å‚è€ƒè¿™ä¸ªï¼š<a href="https://zhuanlan.zhihu.com/p/54733692">JAVAé¢è¯•50è®²ä¹‹9ï¼šåŠ¨æ€ä»£ç†çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</a></p></blockquote><p>ä»£ç†æ¨¡å¼æ˜¯ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ã€<strong>ä»£ç†å¯¹è±¡ã€‘æ§åˆ¶å¯¹ã€åŸå¯¹è±¡ã€‘çš„å¼•ç”¨(ä½¿ç”¨)</strong>ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šä»£ç†æ¨¡å¼èƒ½å¤Ÿåè°ƒè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ï¼Œ<u>åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„<strong>è€¦åˆåº¦</strong></u>ï¼›å¯ä»¥<u>çµæ´»åœ°éšè—è¢«ä»£ç†å¯¹è±¡çš„éƒ¨åˆ†åŠŸèƒ½å’ŒæœåŠ¡ï¼Œä¹Ÿå¢åŠ é¢å¤–çš„åŠŸèƒ½å’ŒæœåŠ¡</u>ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç”±äºä½¿ç”¨äº†ä»£ç†æ¨¡å¼ï¼Œå› æ­¤ç¨‹åºçš„æ€§èƒ½<u>æ²¡æœ‰ç›´æ¥è°ƒç”¨æ€§èƒ½é«˜</u>ï¼›ä½¿ç”¨ä»£ç†æ¨¡å¼<u>æé«˜äº†ä»£ç çš„å¤æ‚åº¦</u>ã€‚</li></ul><p>æ ¹æ®ä»£ç†æ¨¡å¼åˆå¯ä»¥åˆ†ä¸ºï¼šé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚</p><h5 id="2-1-é™æ€ä»£ç†">2.1 é™æ€ä»£ç†</h5><blockquote><p>é™æ€ä»£ç†ï¼šç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–ç‰¹å®šå·¥å…·è‡ªåŠ¨ç”Ÿæˆæºä»£ç ï¼Œä¹Ÿå°±æ˜¯åœ¨<strong>ç¼–è¯‘æ—¶</strong>å°±å·²ç»å°†æ¥å£ã€è¢«ä»£ç†ç±»ã€ä»£ç†ç±»ç­‰ç¡®å®šä¸‹æ¥ã€‚åœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä»£ç†ç±»çš„.classæ–‡ä»¶å°±å·²ç»ç”Ÿæˆã€‚</p></blockquote><p>ä»£ç†æ¨¡å¼æœ€ä¸»è¦çš„å°±æ˜¯æœ‰ä¸€ä¸ªå…¬å…±æ¥å£ï¼ˆPersonï¼‰ï¼Œä¸€ä¸ªå…·ä½“çš„ç±»ï¼ˆStudentï¼‰ï¼Œä¸€ä¸ªä»£ç†ç±»ï¼ˆStudentsProxyï¼‰,ä»£ç†ç±»æŒæœ‰å…·ä½“ç±»çš„å®ä¾‹ï¼Œä»£ä¸ºæ‰§è¡Œå…·ä½“ç±»å®ä¾‹æ–¹æ³•ã€‚</p><ul><li><p>ä¸€ä¸ªç­çš„åŒå­¦ï¼ˆStudentï¼‰è¦å‘è€å¸ˆäº¤ç­è´¹ï¼Œä½†æ˜¯éƒ½æ˜¯é€šè¿‡ç­é•¿ï¼ˆStudentProxyï¼‰æŠŠè‡ªå·±çš„é’±è½¬äº¤ç»™è€å¸ˆã€‚è¿™é‡Œï¼Œç­é•¿å°±æ˜¯ä»£ç†å­¦ç”Ÿä¸Šäº¤ç­è´¹ï¼Œç­é•¿å°±æ˜¯å­¦ç”Ÿçš„ä»£ç†ã€‚</p></li><li><p><strong>å…¬å…±Personæ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä¸Šäº¤ç­è´¹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Studentå®ç°Personæ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       System.out.println(name + <span class="string">&quot;ä¸Šäº¤ç­è´¹50å…ƒ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>StudentsProxyå®ç°Personæ¥å£</strong></p><p>å®ç°äº†Pesonæ¥å£ï¼Œ<strong>åŒæ—¶æŒæœ‰ä¸€ä¸ªStudentå¯¹è±¡</strong>ï¼Œé‚£ä¹ˆä»–å¯ä»¥ä»£ç†å­¦ç”Ÿç±»å¯¹è±¡æ‰§è¡Œä¸Šäº¤ç­è´¹ï¼ˆæ‰§è¡ŒgiveMoney()æ–¹æ³•ï¼‰è¡Œä¸ºã€‚</p><blockquote><p>âš ï¸ è‡ªå·±å®ç°çš„giveMoneyï¼Œè°ƒç”¨çš„æ˜¯<strong>è¢«ä»£ç†çš„å­¦ç”Ÿå¯¹è±¡.giveMoney()</strong> æ–¹æ³•ï¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentsProxy</span> <span class="keyword">implements</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="comment">//è¢«ä»£ç†çš„å­¦ç”Ÿ</span></span><br><span class="line">    Student stu;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentsProxy</span><span class="params">(Person stu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åªä»£ç†å­¦ç”Ÿå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span>(stu.getClass() == Student.class) &#123;</span><br><span class="line">            <span class="keyword">this</span>.stu = (Student)stu;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»£ç†ä¸Šäº¤ç­è´¹ï¼Œè°ƒç”¨è¢«ã€ä»£ç†å­¦ç”Ÿçš„ä¸Šäº¤ç­è´¹ã€‘è¡Œä¸º</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stu.giveMoney();</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨å®ä¾‹1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticProxyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è¢«ä»£ç†çš„å­¦ç”Ÿå¼ ä¸‰ï¼Œä»–çš„ç­è´¹ä¸Šäº¤æœ‰ä»£ç†å¯¹è±¡monitorï¼ˆç­é•¿ï¼‰å®Œæˆ</span></span><br><span class="line">        Person zhangsan = <span class="keyword">new</span> Student(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå¹¶å°†å¼ ä¸‰ä¼ ç»™ä»£ç†å¯¹è±¡</span></span><br><span class="line">        Person monitor = <span class="keyword">new</span> StudentsProxy(zhangsan);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç­é•¿ä»£ç†ä¸Šäº¤ç­è´¹ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„giveMoneyæ–¹æ³•</span></span><br><span class="line">        monitor.giveMoney();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨å®ä¾‹2</strong>ï¼šæ‰©å……å¢å¼ºåŸå¯¹è±¡æ–¹æ³•</p><p>ç­é•¿åœ¨å¸®å¼ ä¸‰ä¸Šäº¤ç­è´¹ä¹‹å‰ï¼Œæƒ³è¦å…ˆåæ˜ ä¸€ä¸‹<strong>å¼ ä¸‰æœ€è¿‘å­¦ä¹ æœ‰å¾ˆå¤§è¿›æ­¥</strong>ï¼Œé€šè¿‡ä»£ç†æ¨¡å¼å¾ˆè½»æ¾å°±èƒ½åŠåˆ° ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentsProxy</span> <span class="keyword">implements</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="comment">//è¢«ä»£ç†çš„å­¦ç”Ÿ</span></span><br><span class="line">    Student stu;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentsProxy</span><span class="params">(Person stu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åªä»£ç†å­¦ç”Ÿå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span>(stu.getClass() == Student.class) &#123;</span><br><span class="line">            <span class="keyword">this</span>.stu = (Student)stu;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»£ç†ä¸Šäº¤ç­è´¹ï¼Œè°ƒç”¨è¢«ä»£ç†å­¦ç”Ÿçš„ä¸Šäº¤ç­è´¹è¡Œä¸º</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼ ä¸‰æœ€è¿‘å­¦ä¹ æœ‰è¿›æ­¥ï¼&quot;</span>);</span><br><span class="line">        stu.giveMoney();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="2-2-åŠ¨æ€ä»£ç†">2.2 åŠ¨æ€ä»£ç†</h5><blockquote><p>ä¸Šé¢é™æ€ä»£ç†çš„ä¾‹å­ä¸­ï¼Œä»£ç†ç±»(studentProxy)æ˜¯è‡ªå·±å®šä¹‰å¥½çš„ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰å°±<strong>å·²ç»ç¼–è¯‘</strong>å®Œæˆ ã€‚</p></blockquote><p>ç„¶è€ŒåŠ¨æ€ä»£ç†ï¼Œä»£ç†ç±»<strong>å¹¶ä¸æ˜¯åœ¨Javaä»£ç ä¸­å®šä¹‰</strong>çš„ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®æˆ‘ä»¬åœ¨Javaä»£ç ä¸­çš„â€œæŒ‡ç¤ºâ€<strong>åŠ¨æ€ç”Ÿæˆ</strong>â€œçš„ ã€‚</p><ul><li><p><strong>ä¼˜ç‚¹</strong>ï¼š å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹ä»£ç†ç±»çš„å‡½æ•°è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ï¼Œ<strong>è€Œä¸ç”¨ä¿®æ”¹æ¯ä¸ªä»£ç†ç±»ä¸­çš„æ–¹æ³•</strong>ã€‚ æ¯”å¦‚è¯´ï¼Œæƒ³è¦åœ¨æ¯ä¸ªä»£ç†çš„æ–¹æ³•å‰<u>éƒ½åŠ ä¸Š</u>ä¸€ä¸ªå¤„ç†æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨è¢«ä»£ç†æ–¹æ³•å‰åŠ å…¥å¤„ç†æ–¹æ³•</span></span><br><span class="line">        beforeMethod();</span><br><span class="line">        stu.giveMoney();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ä»£ç†ç±»å…¶å®ƒæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">giveHomework</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="comment">//è°ƒç”¨è¢«ä»£ç†æ–¹æ³•å‰åŠ å…¥å¤„ç†æ–¹æ³•</span></span><br><span class="line">        beforeMethod();</span><br><span class="line">        stu.giveHomework();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†giveMonneyè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•ï¼ˆgiveHomeworkï¼‰ï¼Œé‚£å°±éœ€è¦å†™å¾ˆå¤šæ¬¡beforeMethodæ–¹æ³•ï¼Œéº»çƒ¦ã€‚</p></li><li><p><strong>ç®€å•å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//åˆ›å»ºä¸€ä¸ªä¸ä»£ç†å¯¹è±¡ç›¸å…³è”çš„InvocationHandler</span></span><br><span class="line">  InvocationHandler stuHandler = <span class="keyword">new</span> MyInvocationHandler&lt;Person&gt;(stu);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡stuProxyï¼Œä»£ç†å¯¹è±¡çš„æ¯ä¸ªæ‰§è¡Œæ–¹æ³•éƒ½ä¼šæ›¿æ¢æ‰§è¡ŒInvocationä¸­çš„invokeæ–¹æ³•</span></span><br><span class="line">  Person stuProxy= (Person) Proxy.newProxyInstance(Person.class.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[]&#123;Person.class&#125;, stuHandler);</span><br></pre></td></tr></table></figure></li><li><p><strong>å…¬å…±Personæ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä¸Šäº¤ç­è´¹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Studentå®ç°Personæ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//å‡è®¾æ•°é’±èŠ±äº†ä¸€ç§’æ—¶é—´</span></span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">       System.out.println(name + <span class="string">&quot;ä¸Šäº¤ç­è´¹50å…ƒ&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure><p>å¢åŠ ä¸€ä¸ªè®¡ç®—æ–¹æ³•æ‰§è¡Œæ—¶é—´çš„æ£€æµ‹æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MonitorUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; tl = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        tl.set(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»“æŸæ—¶æ‰“å°è€—æ—¶</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">(String methodName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> finishTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(methodName + <span class="string">&quot;æ–¹æ³•è€—æ—¶&quot;</span> + (finishTime - tl.get()) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>StuInvocationHandler å®ç° InvocationHandleræ¥å£</strong></p><blockquote><p>å¹¶æ²¡æœ‰åƒä¹‹å‰ä¸€æ ·ï¼šç”¨ä¸€ä¸ªä»£ç†ç±» StudentsProxyå®ç°å…¬å…±<strong>Person</strong>æ¥å£ï¼Œè€Œæ˜¯ä»£ç†ç±»StuInvocationHandler å®ç°<strong>InvocationHandler</strong>æ¥å£ã€‚</p><p>ä½†äºŒè€…<strong>éƒ½æ˜¯æŒæœ‰è¢«ä»£ç†çš„å¯¹è±¡Studentå¼•ç”¨</strong>ã€‚</p></blockquote><p>InvocationHandlerä¸­æœ‰ä¸€ä¸ªinvokeæ–¹æ³•ï¼Œæ‰€æœ‰æ‰§è¡Œä»£ç†å¯¹è±¡çš„æ–¹æ³•éƒ½ä¼šè¢«æ›¿æ¢æˆæ‰§è¡Œinvokeæ–¹æ³•ã€‚</p><ul><li>é€šè¿‡<strong>åå°„</strong>ï¼Œå¯ä»¥æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡Studentçš„ç›¸åº”æ–¹æ³•giveMoney()ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StuInvocationHandler</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">   <span class="comment">//invocationHandleræŒæœ‰çš„è¢«ä»£ç†å¯¹è±¡</span></span><br><span class="line">    T target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StuInvocationHandler</span><span class="params">(T target)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * proxy:ä»£è¡¨åŠ¨æ€ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * methodï¼šä»£è¡¨æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * argsï¼šä»£è¡¨è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ä¼ å…¥çš„å®å‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä»£ç†æ‰§è¡Œ&quot;</span> +method.getName() + <span class="string">&quot;æ–¹æ³•&quot;</span>);</span><br><span class="line">     */   </span><br><span class="line">        <span class="comment">//ä»£ç†è¿‡ç¨‹ä¸­æ’å…¥ç›‘æµ‹æ–¹æ³•,è®¡ç®—è¯¥æ–¹æ³•è€—æ—¶</span></span><br><span class="line">        MonitorUtil.start();</span><br><span class="line">        <span class="comment">// åŸæ¥çš„ä»£ç†å¯¹è±¡Studentä¸­çš„æ–¹æ³•</span></span><br><span class="line">        Object result = method.invoke(target, args);</span><br><span class="line">        MonitorUtil.finish(method.getName());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å…·ä½“å®ä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯è¢«ä»£ç†çš„å¯¹è±¡</span></span><br><span class="line">        Person zhangsan = <span class="keyword">new</span> Student(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªä¸ä»£ç†å¯¹è±¡ç›¸å…³è”çš„InvocationHandler</span></span><br><span class="line">        InvocationHandler stuHandler = <span class="keyword">new</span> StuInvocationHandler&lt;Person&gt;(zhangsan);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡stuProxyæ¥ä»£ç†zhangsanï¼Œä»£ç†å¯¹è±¡çš„æ¯ä¸ªæ‰§è¡Œæ–¹æ³•éƒ½ä¼šæ›¿æ¢æ‰§è¡ŒInvocationä¸­çš„invokeæ–¹æ³•</span></span><br><span class="line">        Person stuProxy = (Person) Proxy.newProxyInstance(Person.class.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[]&#123;Person.class&#125;, stuHandler)ï¼›</span><br><span class="line"></span><br><span class="line">       <span class="comment">//ä»£ç†æ‰§è¡Œä¸Šäº¤ç­è´¹çš„æ–¹æ³•</span></span><br><span class="line">        stuProxy.giveMoney();</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/26/bIVRJdO5vKX36nQ.jpg" alt="img"></p></li></ul><h5 id="2-3-åŠ¨æ€ä»£ç†çš„åŸç†">2.3 åŠ¨æ€ä»£ç†çš„åŸç†</h5><p>ä» JVM è§’åº¦æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶<u>ï¼Œé€šè¿‡<strong>åå°„</strong>åŠ¨æ€ç”Ÿæˆç±»<strong>å­—èŠ‚ç </strong>ï¼Œ</u>å¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚</p><h4 id="3-å¦‚ä½•åˆ©ç”¨åå°„åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Ÿ">3. å¦‚ä½•åˆ©ç”¨åå°„åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Ÿ</h4><p>è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1. å¾—åˆ°Stuç±»çš„è¿è¡Œæ—¶Classæè¿°ç¬¦</span></span><br><span class="line">            <span class="comment">//ç®€å•ç†è§£ä¸ºä½ ç°åœ¨æœ‰äº†è¿™ä¸ªç±»ï¼Œå¯ä»¥è°ƒç”¨ç›¸åº”çš„æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–äº†</span></span><br><span class="line">            Class&lt;?&gt; stu = Class.forName(<span class="string">&quot;Stu&quot;</span>);</span><br><span class="line">            <span class="comment">//2.ä»getDeclaredConstructor()çš„å­—é¢æ„æ€å°±èƒ½ç†è§£ï¼Œå¾—åˆ°æ‰€æœ‰å£°æ˜çš„æ„é€ å™¨</span></span><br><span class="line">            <span class="comment">//è¿™é‡Œå¾—åˆ°çš„æ˜¯æ‰€æœ‰å£°æ˜çš„æ„é€ å™¨ï¼ŒgetConstructor()åˆ™åªèƒ½å¾—åˆ°è¢«publicä¿®é¥°çš„æ„é€ å™¨</span></span><br><span class="line">            Constructor&lt;?&gt; declaredConstructor = stu.getDeclaredConstructor(<span class="keyword">new</span> Class[]&#123;String.class, <span class="keyword">int</span>.class&#125;);</span><br><span class="line">            <span class="comment">//3. ä½¿ç”¨newInstance()æ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶ä¼ å…¥å‚æ•°</span></span><br><span class="line">            <span class="comment">//ç®€å•çš„ç†è§£ä¸ºStu o = new Stu(&quot;zhangsan&quot;, 01)</span></span><br><span class="line">            Stu o = (Stu) declaredConstructor.newInstance(<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;zhangsan&quot;</span>, <span class="number">01</span>&#125;);</span><br><span class="line">            <span class="comment">//4.è°ƒç”¨Stuè¿™ä¸ªç±»é‡Œé¢çš„æ–¹æ³•</span></span><br><span class="line">            <span class="comment">// getDeclaredMethod()æ–¹æ³•èƒ½è°ƒç”¨åˆ°æ‰€æœ‰å£°æ˜çš„æ–¹æ³•</span></span><br><span class="line">            Method method = stu.getDeclaredMethod(<span class="string">&quot;toString&quot;</span>, <span class="keyword">new</span> Class[]&#123;&#125;);</span><br><span class="line">            <span class="comment">//5. ç®€å•çš„ç†è§£ä¸ºo.toStirng()</span></span><br><span class="line">            String invoke = (String)method.invoke(o, <span class="keyword">new</span> Object[]&#123;&#125;);</span><br><span class="line">            System.out.println(invoke);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> æ ¡æ‹› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_Javaå…¥é—¨</title>
      <link href="/p/51787/"/>
      <url>/p/51787/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h2 id="1-1-JAVAå…¥é—¨">1.1  JAVAå…¥é—¨</h2><h3 id="1-1-1-JAVAåŸºæœ¬">1.1.1 JAVAåŸºæœ¬</h3><h4 id="1-ä»‹ç»ä¸€ä¸‹JVM-JRE-JDKï¼Ÿ-JAVAè¯­è¨€æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ">1.<strong>ä»‹ç»ä¸€ä¸‹JVM&amp;JRE&amp;JDKï¼Ÿ</strong> JAVAè¯­è¨€æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h4><ul><li><strong>JVM&amp;JRE&amp;JDK</strong><ul><li><strong>JVM:</strong>  å³javaè™šæ‹Ÿæœºï¼Œé’ˆå¯¹ä¸åŒæ“ä½œç³»ç»Ÿï¼ŒJVMæŠŠJavaä»£ç ç¿»è¯‘æˆ<u>å¯¹åº”æ“ä½œç³»ç»Ÿå¯ä»¥è¯†åˆ«çš„å†…å®¹ï¼Œå®ç°è·¨å¹³å°</u> ï¼›</li><li><strong>JRE</strong> : <u>JVM + æ ¸å¿ƒç±»åº“ = JRE</u> ï¼Œ å³Javaè¿è¡Œæ—¶ç¯å¢ƒã€‚åªæœ‰JVMä¸èƒ½è¿è¡Œï¼Œå®ƒè¿˜<strong>éœ€è¦æ ¸å¿ƒç±»åº“ï¼Œæ‰èƒ½ä¿è¯Javaè¿è¡Œ</strong> ï¼›</li><li><strong>JDK:</strong> <u>JRE + <strong>javaå¼€å‘å·¥å…·</strong>ï¼ˆç¼–è¯‘å™¨ç­‰) = JDK</u> ï¼ŒJavaå¼€å‘å·¥å…·åŒ…(JDK)æ˜¯å®Œæ•´çš„Javaè½¯ä»¶å¼€å‘åŒ…ï¼ŒåŒ…å«äº†JREï¼Œç¼–è¯‘å™¨å’Œå…¶ä»–çš„å·¥å…·ã€‚</li></ul></li><li><strong>Javaè¯­è¨€ç‰¹ç‚¹</strong><ol><li><p>ç®€å•æ˜“å­¦ï¼›</p></li><li><p>é¢å‘å¯¹è±¡ï¼ˆå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ï¼‰ï¼›</p></li><li><p><strong>å¹³å°æ— å…³æ€§</strong>ï¼ˆ Java è™šæ‹Ÿæœºå®ç°å¹³å°æ— å…³æ€§ï¼‰ï¼›</p></li><li><p>å¯é æ€§ï¼›</p></li><li><p>å®‰å…¨æ€§ï¼›</p></li><li><p><strong>æ”¯æŒå¤šçº¿ç¨‹</strong>ï¼ˆ <u>C++ è¯­â¾”æ²¡æœ‰å†…ç½®çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼Œå› æ­¤å¿…é¡»è°ƒç”¨æ“ä½œç³»ç»Ÿçš„å¤šçº¿ç¨‹åŠŸèƒ½æ¥è¿›è¡Œå¤šçº¿ç¨‹ç¨‹åºè®¾è®¡</u>ï¼Œè€Œ Java è¯­â¾”å´æä¾›äº†å¤šçº¿ç¨‹æ”¯æŒï¼‰ï¼›</p></li></ol></li></ul><h4 id="2-ä»€ä¹ˆæ˜¯Javaè™šæ‹Ÿæœºï¼Ÿä¸ºä»€ä¹ˆJavaè¢«ç§°ä¸ºå¹³å°æ— å…³çš„ç¼–ç¨‹è¯­è¨€ï¼Ÿ">2.<strong>ä»€ä¹ˆæ˜¯Javaè™šæ‹Ÿæœºï¼Ÿä¸ºä»€ä¹ˆJavaè¢«ç§°ä¸ºå¹³å°æ— å…³çš„ç¼–ç¨‹è¯­è¨€</strong>ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/05/12/b4HUYmVo6P5uFCi.png" alt="image-20210512104311616"></p><ul><li><p>javaè™šæ‹Ÿæœºï¼Œæ˜¯<strong>æ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼ˆ.class</strong>ï¼‰çš„<u>è™šæ‹Ÿæœºè¿›ç¨‹</u>ï¼›</p><blockquote><p>åœ¨ Java ä¸­ï¼Œ<strong>JVM å¯ä»¥ç†è§£çš„ä»£ç å°±å«åš å­—èŠ‚ç </strong> ï¼ˆå³æ‰©å±•åä¸º .class çš„â½‚ä»¶ï¼‰ï¼Œå®ƒä¸é¢å‘ä»» ä½•ç‰¹å®šçš„å¤„ç†å™¨ï¼Œ<strong>åªé¢å‘è™šæ‹Ÿæœº</strong>ã€‚</p></blockquote></li><li><p>javaæºç¨‹åºï¼ˆ.javaï¼‰è¢«ç¼–è¯‘å™¨ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classï¼‰ã€‚ç„¶åå­—èŠ‚ç æ–‡ä»¶ï¼Œå°†ç”±<u>javaè™šæ‹Ÿæœºï¼Œè§£é‡Šæˆæœºå™¨ç ï¼ˆ<strong>ä¸åŒå¹³å°çš„æœºå™¨ç ä¸åŒ</strong>ï¼‰</u>ã€‚</p></li></ul><h4 id="3-è¯·ä½ è°ˆè°ˆJavaä¸­æ˜¯å¦‚ä½•æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„ï¼Ÿï¼ˆè¡¥å……å®ä¾‹ï¼‰">3. è¯·ä½ è°ˆè°ˆJavaä¸­æ˜¯å¦‚ä½•æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„ï¼Ÿï¼ˆè¡¥å……å®ä¾‹ï¼‰</h4><p>Javaä¸­çš„Stringç±»æä¾›äº†æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><code>matches()ã€replaceAll()ã€replaceFirst()ã€split()</code></li></ul><p>æ­¤å¤–ï¼ŒJavaä¸­å¯ä»¥ç”¨Patternç±»è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„APIè¿›è¡Œå„ç§æ­£åˆ™è¡¨è¾¾å¼æ“ä½œï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegExpTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;æˆéƒ½å¸‚(æˆååŒº)(æ­¦ä¾¯åŒº)(é«˜æ–°åŒº)&quot;</span>;</span><br><span class="line">        Pattern p = Pattern.compile(<span class="string">&quot;.*?(?=\\()&quot;</span>);</span><br><span class="line">        Matcher m = p.matcher(str);</span><br><span class="line">        <span class="keyword">if</span>(m.find()) &#123;</span><br><span class="line">            System.out.println(m.group());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å®ä¾‹ç¤ºèŒƒï¼ˆPCGé—®è¿‡ï¼‰">å®ä¾‹ç¤ºèŒƒï¼ˆPCGé—®è¿‡ï¼‰</h5><blockquote><p>å‚è€ƒï¼š<a href="https://www.runoob.com/regexp/regexp-syntax.html">https://www.runoob.com/regexp/regexp-syntax.html</a></p></blockquote><ul><li><p><strong>ç‰¹æ®Šå­—ç¬¦</strong></p><img src="https://i.loli.net/2021/05/12/9IBVheAOz5aGnxC.png" alt="image-20210512110705420" style="zoom:80%;" /></li><li><p><strong>æ™®é€šå­—ç¬¦</strong></p><p><img src="https://i.loli.net/2021/05/12/QcjTKqEJZwx7LdM.png" alt="image-20210512111050519"></p></li><li><p><strong>å®ä¾‹ç¤ºèŒƒ</strong></p><ol><li><p>åŒ¹é…é‚®ç®±</p><p><img src="https://i.loli.net/2021/05/12/Lvo56GHie2Qqla1.png" alt="img"></p></li><li><p>åŒ¹é…ç”µè¯å·ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…ç”µè¯å·ç </span></span><br><span class="line">String phone = <span class="string">&quot;18637866964&quot;</span>;</span><br><span class="line">String reg = <span class="string">&quot;^1[3,5,7,8,9]\\d&#123;9&#125;$&quot;</span>;</span><br><span class="line">System.out.println(phone.matches(reg));</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…ç¬¬ä¸€ä¸ªå‡ºç°çš„æ•°å­—</p><p>ä¸‹é¢å¥½åƒæ˜¯ä¸å¯¹çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String phone = <span class="string">&quot;avss1sdp22&quot;</span>;</span><br><span class="line">String reg = <span class="string">&quot;\d?&quot;</span>;</span><br><span class="line">System.out.println(phone.matches(reg));</span><br></pre></td></tr></table></figure></li></ol></li></ul><h4 id="4-ï¼ˆè¡¥å……ä¾‹å­ï¼‰è¯·ä½ ç®€å•æè¿°ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼åŠå…¶ç”¨é€”ã€‚">4.<strong>ï¼ˆè¡¥å……ä¾‹å­ï¼‰è¯·ä½ ç®€å•æè¿°ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼åŠå…¶ç”¨é€”</strong>ã€‚</h4><p>åœ¨ç¼–å†™å¤„ç†å­—ç¬¦ä¸²çš„ç¨‹åºæ—¶ï¼Œç»å¸¸ä¼šæœ‰æŸ¥æ‰¾ <u>ç¬¦åˆæŸäº›å¤æ‚è§„åˆ™çš„å­—ç¬¦ä¸²</u> çš„éœ€è¦ã€‚</p><ul><li>è®¡ç®—æœºå¤„ç†çš„ä¿¡æ¯æ›´å¤šçš„æ—¶å€™ä¸æ˜¯æ•°å€¼è€Œæ˜¯å­—ç¬¦ä¸²ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯åœ¨è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…å’Œå¤„ç†çš„æ—¶å€™æœ€ä¸ºå¼ºå¤§çš„å·¥å…·ï¼›</li><li>ç»å¤§å¤šæ•°è¯­è¨€éƒ½æä¾›äº†å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒã€‚</li></ul><h4 id="5-å’Œ-åŒºåˆ†ï¼Ÿ">5.<strong>&amp;å’Œ&amp;&amp;åŒºåˆ†ï¼Ÿ</strong></h4><ul><li><strong>å…±åŒç‚¹</strong>ï¼šéƒ½è¦æ±‚è¿ç®—ç¬¦å·¦å³ä¸¤ç«¯çš„å¸ƒå°”å€¼ <u>éƒ½æ˜¯true</u> æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼æ‰æ˜¯true</li><li>åŒºåˆ«ï¼š&amp;&amp;ä¹‹ç§°ä¸ºçŸ­è·¯è¿ç®—ï¼Œ<u>å¦‚æœ&amp;&amp;å·¦è¾¹çš„è¡¨è¾¾å¼çš„å€¼æ˜¯falseï¼Œå³è¾¹çš„è¡¨è¾¾å¼ä¼šè¢«ç›´æ¥çŸ­è·¯æ‰ï¼Œä¸ä¼šè¿›è¡Œè¿ç®—</u>ã€‚ å¥½å¤„ï¼š<ul><li><em>e.g.</em> ï¼šå³è¾¹åˆ¤åˆ«å¼æœ‰å¦‚æœæœ‰ç©ºæŒ‡é’ˆ<code>NullPointerException</code>å¼‚å¸¸åˆ¤æ–­é£é™©ï¼Œå¯ä»¥é¿å…ã€‚</li></ul></li></ul><h4 id="6-å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’åŒºåˆ†ï¼Ÿ">6.<strong>å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’åŒºåˆ†ï¼Ÿ</strong></h4><ul><li><p>å€¼ä¼ é€’æ˜¯<strong>è¯¥å˜é‡</strong>çš„ä¸€ä¸ª<u>å‰¯æœ¬</u>ï¼Œ æ”¹å˜å‰¯æœ¬<u>ä¸å½±å“</u>åŸå˜é‡ï¼›</p></li><li><p>å¼•ç”¨ä¼ é€’æ˜¯<strong>å¯¹è±¡åœ°å€</strong>çš„<u>å‰¯æœ¬</u>ï¼Œå¼•ç”¨å¯¹è±¡è¿›è¡Œæ“ä½œä¼šåŒæ—¶<u>æ”¹å˜</u>åŸå¯¹è±¡ã€‚</p></li></ul><h4 id="7-åè¿›åˆ¶ä¸äºŒè¿›åˆ¶ï¼Ÿ">7.<strong>åè¿›åˆ¶ä¸äºŒè¿›åˆ¶ï¼Ÿ</strong></h4><ul><li><p><strong>è¯·ä½ è®²è®²ä¸€ä¸ªåè¿›åˆ¶çš„æ•°åœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆå­˜çš„ï¼Ÿ</strong></p><p>è¡¥ç å½¢å¼ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆä¼šå‡ºç°4.0-3.6=0.40000001è¿™ç§ç°è±¡ï¼Ÿ</strong></p><p>2è¿›åˆ¶çš„å°æ•°æ— æ³•ç²¾ç¡®çš„è¡¨è¾¾10è¿›åˆ¶å°æ•°ï¼Œè®¡ç®—æœºåœ¨ <u>è®¡ç®—10è¿›åˆ¶å°æ•°çš„è¿‡ç¨‹ä¸­è¦å…ˆè½¬æ¢ä¸º2è¿›åˆ¶è¿›è¡Œè®¡ç®—</u> ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å‡ºç°äº†è¯¯å·®ã€‚</p></li></ul><h4 id="8-ï¼ˆé‡è¦ï¼‰equalsä¸-çš„åŒºåˆ«">8.<strong>ï¼ˆé‡è¦ï¼‰equalsä¸==çš„åŒºåˆ«</strong></h4><blockquote><p>å¾ˆæ¸…æ™°ä¸¥è°¨çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.cnblogs.com/skywang12345/p/3324958.html">https://www.cnblogs.com/skywang12345/p/3324958.html</a></p></blockquote><ul><li><p><strong>==</strong></p><ol><li>åŸºæœ¬ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸åŒï¼›</li><li>å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯<strong>å¼•ç”¨ï¼ˆå¯¹è±¡åœ°å€</strong>ï¼‰æ˜¯å¦ç›¸åŒï¼›</li></ol></li><li><p><strong>equals</strong></p><p>è¦çœ‹<strong>ç±»æ˜¯å¦è¦†ç›–equals()æ–¹æ³•</strong>ï¼Œå°†å®ƒåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ol><li><p>è‹¥æŸä¸ªç±»æ²¡æœ‰è¦†ç›–equals()æ–¹æ³•ï¼Œå½“å®ƒçš„é€šè¿‡<strong>equals()æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡</strong>æ—¶ï¼Œå®é™…ä¸Šæ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼ˆåœ°å€ï¼‰æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚è¿™æ—¶ï¼Œ<u>ç­‰ä»·äºé€šè¿‡â€œ==â€å»æ¯”è¾ƒè¿™ä¸¤ä¸ªå¯¹è±¡</u>ï¼›</p></li><li><p>æˆ‘ä»¬å¯ä»¥è¦†ç›–ç±»çš„equals()æ–¹æ³•ï¼Œæ¥è®©equals()é€šè¿‡å…¶å®ƒæ–¹å¼æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹ï¼ˆ<strong>è€Œä¸æ˜¯åœ°å€</strong>ï¼‰æ˜¯å¦ç›¸ç­‰ã€‚</p><blockquote><p>String ä¸­çš„ equals æ–¹æ³•æ˜¯è¢«é‡å†™è¿‡çš„ï¼š</p><ul><li>å› ä¸º object çš„ equals æ–¹æ³•æ˜¯â½æ•™çš„å¯¹è±¡çš„å†…å­˜åœ°å€</li><li>è€Œ <strong>String çš„ equals æ–¹æ³•ï¼ˆ1ï¼‰å…ˆæ¯”è¾ƒå¯¹è±¡åœ°å€æ˜¯å¦ç›¸ç­‰ ï¼Œç›¸åŒåˆ™tureï¼Œå¦åˆ™ï¼ˆ2ï¼‰å†æ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰</strong></li></ul></blockquote></li></ol></li></ul><h4 id="7-è¯·è§£é‡ŠhashCode-å’Œequals-æ–¹æ³•æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ">7.<strong>è¯·è§£é‡ŠhashCode()å’Œequals()æ–¹æ³•æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ</strong></h4><blockquote><p>é¢è¯•å®˜å¯èƒ½ä¼šé—®ä½ ï¼šâ€œä½ é‡å†™è¿‡ hashcode å’Œ equals ä¹ˆï¼Œä¸ºä»€ä¹ˆé‡å†™ equals æ—¶å¿…é¡»é‡å†™ hashCodeæ–¹æ³•ï¼Ÿâ€</p><ul><li>å»ºè®®çœ‹æ–‡ä¸­ä¾‹å­ç†è§£ï¼š<a href="https://www.cnblogs.com/skywang12345/p/3324958.html">https://www.cnblogs.com/skywang12345/p/3324958.html</a></li></ul></blockquote><ul><li><p><strong>hashCode()ä»‹ç»</strong></p><p>hashCode() çš„ä½œç”¨æ˜¯<strong>è·å–å“ˆå¸Œç </strong>ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ï¼›å®ƒå®é™…ä¸Šæ˜¯è¿”å›ä¸€ä¸ªintæ•´æ•°ã€‚è¿™ä¸ª<strong>å“ˆå¸Œç çš„ä½œç”¨</strong>æ˜¯ç¡®å®šè¯¥ <u>å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®</u>ã€‚</p><blockquote><p>æˆ‘ä»¬ä»…åœ¨HashSet, Hashtable, HashMapç­‰ç­‰è¿™äº›æœ¬è´¨æ˜¯æ•£åˆ—è¡¨çš„æ•°æ®ç»“æ„ä¸­ï¼Œç”¨åˆ°è¯¥ç±»ã€‚  å…¶å®ƒæƒ…å†µä¸‹hashCode() åˆ™æ ¹æœ¬æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œæ‰€ä»¥ï¼Œä¸ç”¨ç†ä¼šhashCode()ã€‚</p><ul><li>åœ¨è¿™ç§æƒ…å†µä¸‹å¯¹è±¡ç›¸ç­‰ï¼Œhashcodeå€¼ä¹Ÿä¼šä¸ç›¸ç­‰ã€‚</li></ul></blockquote></li><li><p><strong>ä¸ºä»€ä¹ˆè¦æœ‰hashcode()</strong></p><p>hashCode() çš„ä½œç”¨å°±æ˜¯<strong>è·å–å“ˆå¸Œç </strong>ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ï¼›å®ƒå®é™…ä¸Šæ˜¯è¿”å›â¼€ä¸ª intæ•´æ•°ã€‚è¿™ä¸ª<strong>å“ˆå¸Œç çš„ä½œç”¨</strong>æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚ <strong>hashCode()</strong><u>åœ¨æ•£åˆ—è¡¨ä¸­</u>æ‰æœ‰ç”¨ï¼Œåœ¨å…¶å®ƒæƒ…å†µä¸‹æ²¡ç”¨ã€‚åœ¨æ•£åˆ—è¡¨ä¸­ hashCode() çš„ä½œç”¨æ˜¯è·å–å¯¹è±¡çš„æ•£åˆ—ç ï¼Œè¿›è€Œç¡®å®šè¯¥å¯¹è±¡åœ¨æ•£åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚</p><p><strong>å…ˆåˆ¤æ–­hashcodeï¼Œè€Œä¸æ˜¯ç›´æ¥éå†O(n)å¤æ‚åº¦ç”¨equals()åˆ¤æ–­ï¼Œå‡å°‘åˆ¤æ–­æ—¶é—´</strong>ã€‚</p><blockquote><p><strong>å¦‚æœhashcodeä¸€æ ·ï¼Œä¼šè°ƒç”¨equals()å»æ¯”è¾ƒ</strong>ã€‚</p><ul><li><strong>HashSet</strong> ä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒ hashcode å€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨ equals() æ–¹æ³•æ¥æ£€æŸ¥ hashcode ç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSet å°±ä¸ä¼šè®©å…¶åŠ â¼Šæ“ä½œæˆåŠŸã€‚å¦‚æœä¸åŒçš„è¯ï¼Œå°±ä¼šé‡æ–°æ•£åˆ—åˆ°å…¶ä»–ä½ç½®ã€‚</li></ul></blockquote></li></ul><h5 id="7-1-ä¸ºä»€ä¹ˆé‡å†™äº†equals-ä¸€å®šè¦é‡å†™hashcode-æ–¹æ³•ï¼Ÿ">7.1 ä¸ºä»€ä¹ˆé‡å†™äº†equals()ä¸€å®šè¦é‡å†™hashcode()æ–¹æ³•ï¼Ÿ</h5><blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/xyh269/article/details/69171545">ä¸ºä»€ä¹ˆé‡å†™äº†equals()ï¼Œè¿˜è¦é‡å†™hashCode()ï¼Ÿ</a></p></blockquote><p>åœ¨Hashmap / Hashsetä¸­ï¼Œé€šè¿‡è®¡ç®—hash = hash(key.hashcode) ç„¶åè¿›è¡Œå–ä½™æ“ä½œï¼Œå¿«é€Ÿå®šä½åˆ°æ•°ç»„ä¸­ã€‚</p><p>å› ä¸º<strong>mapä¸­æ˜¯ä¸å…è®¸é‡å¤key</strong>çš„ï¼Œæ‰€ä»¥å¯¹å†…éƒ¨get()/add()æ–¹æ³•ï¼šå¯¹äºæ•£åˆ—åˆ°æ•°ç»„åŒä¸€ä½ç½®çš„å¯¹è±¡æ¥è¯´ï¼Œ<strong>å¦‚æœhashç›¸ç­‰ &amp;&amp; equals()åˆ¤æ–­ç›¸ç­‰</strong> ï¼Œæ˜¯è¦è¿›è¡Œ<strong>è¦†ç›–</strong>çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è°ƒç”¨ equals æ–¹æ³•åˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰ï¼Œè¯¥keyå¯¹åº”çš„é”®å€¼å¯¹å·²ç»å­˜åœ¨ï¼Œç”¨æ–°çš„valueå–ä»£æ—§çš„value</span></span><br><span class="line">           <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;    </span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åªé‡å†™äº†equalsæ–¹æ³•ï¼šç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚ä½†æ˜¯ä¾æ—§å¯èƒ½å‡ºç°ï¼šä¸¤ä¸ªç›¸åŒå¯¹è±¡<strong>equalsç›¸ç­‰ï¼Œä½†hashcodeä¸ç­‰ï¼Œè¢«æ•£åˆ—åˆ°ä¸åŒæ¡¶ä¸Šï¼Œmapä¸­ä¾æ—§å‡ºç°äº†é‡å¤é”®å€¼å¯¹ï¼</strong></p><p><img src="https://i.loli.net/2021/05/26/v5aHJGt8qErx6P9.png" alt="hashcode"></p><p>æ‰€ä»¥ï¼Œéœ€è¦é‡å†™hashcodeæ–¹æ³•ï¼Œä¿è¯<strong>ç›¸åŒå¯¹è±¡ä¸€å®šæ˜¯æ•£åˆ—åˆ°åŒä¸€ä¸ªä½ç½®ï¼ˆå…·æœ‰åŒæ ·çš„hashå€¼ï¼‰</strong>ã€‚</p><h5 id="7-2-ä¸¤ä¸ªå¯¹è±¡å€¼ç›¸åŒ-x-equals-y-true-ï¼Œä½†å´å¯æœ‰ä¸åŒçš„hash-codeï¼Œè¯¥è¯´æ³•æ˜¯å¦æ­£ç¡®ï¼Œä¸ºä»€ä¹ˆï¼Ÿ">7.2 <strong>ä¸¤ä¸ªå¯¹è±¡å€¼ç›¸åŒ(x.equals(y) == true)ï¼Œä½†å´å¯æœ‰ä¸åŒçš„hash codeï¼Œè¯¥è¯´æ³•æ˜¯å¦æ­£ç¡®ï¼Œä¸ºä»€ä¹ˆ</strong>ï¼Ÿ</h5><p>ä¸ä¸€å®šæ­£ç¡®ï¼Œ<u>å¦‚æœåœ¨HashSet, Hashtable, HashMapç­‰ç­‰è¿™äº›æœ¬è´¨æ˜¯æ•£åˆ—è¡¨çš„æ•°æ®ç»“æ„ä¸­</u>ï¼Œä¸¤ä¸ªå¯¹è±¡xå’Œyæ»¡è¶³x.equals(y) == trueï¼Œå®ƒä»¬çš„å“ˆå¸Œç ï¼ˆhash codeï¼‰åº”å½“ç›¸åŒã€‚</p><p>å…¶å®ƒæƒ…å†µä¸‹å¯èƒ½ä¼šå‡ºç°é¢˜ç›®æè¿°çš„æƒ…å†µã€‚</p><h4 id="8-è‡ªåŠ¨æ‹†ç®±å’Œè£…ç®±ï¼Ÿ">8. è‡ªåŠ¨æ‹†ç®±å’Œè£…ç®±ï¼Ÿ</h4><h5 id="8-1-ä»‹ç»ä¸€ä¸‹int-Integerï¼Ÿ">8.1 <strong>ä»‹ç»ä¸€ä¸‹int&amp;Integerï¼Ÿ</strong></h5><p>Javaä¸ºäº†ç¼–ç¨‹çš„æ–¹ä¾¿è¿˜æ˜¯å¼•å…¥äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä½†æ˜¯ <u>ä¸ºäº†èƒ½å¤Ÿå°†è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹å½“æˆå¯¹è±¡æ“ä½œ</u>ï¼ŒJavaä¸ºæ¯ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹éƒ½å¼•å…¥äº†å¯¹åº”çš„<strong>åŒ…è£…ç±»å‹</strong>ï¼ˆwrapper classï¼‰</p><ul><li><p>intçš„åŒ…è£…ç±»å°±æ˜¯Integerï¼Œä»Java 5å¼€å§‹å¼•å…¥äº†è‡ªåŠ¨è£…ç®±/æ‹†ç®±æœºåˆ¶ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç›¸äº’è½¬æ¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// e.g. </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        Integer a = <span class="keyword">new</span> Integer(<span class="number">3</span>);</span><br><span class="line">        Integer b = <span class="number">3</span>;          <span class="comment">// å°†3è‡ªåŠ¨è£…ç®±æˆIntegerç±»å‹</span></span><br><span class="line">        <span class="keyword">int</span> c = <span class="number">3</span>;</span><br><span class="line">        <span class="comment">// false ä¸¤ä¸ªå¼•ç”¨æ²¡æœ‰å¼•ç”¨åŒä¸€å¯¹è±¡</span></span><br><span class="line">        System.out.println(a == b);  </span><br><span class="line">        <span class="comment">// true aè‡ªåŠ¨æ‹†ç®±æˆintç±»å‹å†å’Œcæ¯”è¾ƒ</span></span><br><span class="line">        System.out.println(a == c);  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p>Java ä¸º<u>æ¯ä¸ªåŸå§‹ç±»å‹</u>æä¾›äº†åŒ…è£…ç±»å‹ï¼š</p><ul><li>ï¼ˆ<strong>8ç§åŸºæœ¬ç±»å‹</strong>ï¼‰åŸå§‹ç±»å‹: booleanï¼Œcharï¼Œbyteï¼Œshortï¼Œintï¼Œlongï¼Œfloatï¼Œdouble</li><li>åŒ…è£…ç±»å‹ï¼šBooleanï¼ŒCharacterï¼ŒByteï¼ŒShortï¼ŒIntegerï¼ŒLongï¼ŒFloatï¼ŒDouble</li></ul></li></ul><h5 id="8-2-æ‹†ç®±ã€è£…ç®±å­˜åœ¨çš„æ„ä¹‰ï¼Ÿ">8.2 <strong>æ‹†ç®±ã€è£…ç®±å­˜åœ¨çš„æ„ä¹‰ï¼Ÿ</strong></h5><blockquote><p>ä¸ºä»€ä¹ˆè¦æœ‰è£…ç®±ã€æ‹†ç®±ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p><em>java</em> æ˜¯ é¢å¯¹å¯¹è±¡ç¼–ç¨‹ï¼Œè€ŒåŸºæœ¬æ•°æ®ç±»å‹ä¸æ˜¯å¯¹è±¡ï¼Œ<strong>æ‰€æœ‰æ‰æœ‰å°è£…ç±» å¼•ç”¨åŸºæœ¬æ•°æ®ç±»å‹è¿›è¡Œæ“ä½œ</strong>ã€‚æ¯”å¦‚ï¼Œä¸‹é¢æ‰“å°å‡º<em>int</em>å‹æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>ï¼› </span><br><span class="line">System.out.println(i); <span class="comment">// è‡ªåŠ¨è£…ç®±</span></span><br></pre></td></tr></table></figure><p>å…¶å®ï¼ŒæŸ¥çœ‹æºç ï¼Œå®é™…ç»è¿‡ä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼š</p><ul><li>å°† <em>i</em> è‡ªåŠ¨è£…ç®±æˆå°è£…ç±» <em>Integer</em></li><li>ç„¶åè°ƒç”¨ <em>Integer</em>ä¸­ <em>toString</em>() æ–¹æ³•ï¼Œæ‰“å°å‡ºå­—ç¬¦ä¸²è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</li></ul><blockquote><p>è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ï¼Ÿ</p></blockquote><ul><li>è‡ªåŠ¨è£…ç®±ï¼šå°±æ˜¯è‡ªåŠ¨å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŒ…è£…å™¨ç±»å‹</li><li>è‡ªåŠ¨æ‹†ç®±ï¼šå°±æ˜¯è‡ªåŠ¨å°†åŒ…è£…å™¨ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹</li></ul><h5 id="8-3-charå’Œbyteçš„åŒºåˆ«-ï¼Œ-èƒ½å¦å¼ºåˆ¶è½¬æ¢ï¼Ÿ">8.3 charå’Œbyteçš„åŒºåˆ« ï¼Œ èƒ½å¦å¼ºåˆ¶è½¬æ¢ï¼Ÿ</h5><p>åŒºåˆ«ï¼š</p><ul><li>Charæ˜¯æ— ç¬¦å·å‹çš„ï¼Œå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæ•´æ•°ï¼Œä¸èƒ½è¡¨ç¤ºè´Ÿæ•°ï¼Œå¤§å°èŒƒå›´ æ˜¯0â€”65535ï¼›è€Œbyteæ˜¯æœ‰ç¬¦å·å‹çš„ï¼Œå¯ä»¥è¡¨ç¤º-128â€”127 çš„æ•°</li><li>charå¯ä»¥è¡¨ä¸­è‹±æ–‡å­—ç¬¦ï¼Œbyteä¸å¯ä»¥</li></ul><p>å¼ºåˆ¶è½¬æ¢ï¼š</p><p>å¯ä»¥ï¼Œä½†æ˜¯ä¼šå‡ºç°ç²¾åº¦ä¸¢å¤±ã€‚</p><h4 id="9-String-StringBuffer-StringBuilder-åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆStringä¸å¯å˜">9.  String &amp; StringBuffer&amp; StringBuilder åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆStringä¸å¯å˜?</h4><ul><li><p><strong>è¯·è§£é‡ŠString &amp; StringBufferåŒºåˆ«ï¼Ÿ</strong></p><ul><li><p><strong>å…±åŒç‚¹</strong>ï¼šå®ƒä»¬å¯ä»¥<strong>å‚¨å­˜å’Œæ“ä½œ</strong>å­—ç¬¦ä¸²ï¼Œå³åŒ…å«å¤šä¸ªå­—ç¬¦çš„å­—ç¬¦æ•°æ®ï¼›</p></li><li><p><strong>å¯å¦ä¿®æ”¹</strong>ï¼šStringç±»æä¾›äº†æ•°å€¼ä¸å¯æ”¹å˜çš„å­—ç¬¦ï¼ŒStringBufferå¯ä»¥ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œéœ€è¦ <u>å­—ç¬¦æ•°æ®è¦æ”¹å˜</u> æ—¶ç”¨ã€‚</p></li></ul><p>å…¸å‹åœ°ï¼Œä½ å¯ä»¥ä½¿ç”¨StringBuffersæ¥åŠ¨æ€æ„é€ å­—ç¬¦æ•°æ®ã€‚</p></li><li><p><strong>è¯·è§£é‡Š StringBuilder&amp; StringBuffer åŒºåˆ«ï¼Ÿ</strong></p><ul><li><p><strong>å…±åŒç‚¹</strong>ï¼š<code>AbstractStringBuilder</code> æ˜¯ StringBuilder ä¸ StringBuffer çš„å…¬å…±â½—ç±»ã€‚éƒ½å¯ä»¥ä¿®<u>æ”¹å­—ç¬¦ä¸²ï¼Œæ“ä½œå­—ç¬¦ä¸²æ–¹æ³•ä¸°å¯Œ</u>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title">Appendable</span>, <span class="title">CharSequence</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The value is used for character storage.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">char</span>[] value;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The count is the number of characters used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">int</span> count;</span><br><span class="line"> AbstractStringBuilder(<span class="keyword">int</span> capacity) &#123;</span><br><span class="line"> value = <span class="keyword">new</span> <span class="keyword">char</span>[capacity];</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p><u><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š</u>å•çº¿ç¨‹ä¸”æ“ä½œå¤§é‡å­—ç¬¦ä¸²ç”¨StringBuilder,é€Ÿåº¦å¿«ï¼Œä½†çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¯ä¿®æ”¹ï¼›åœ¨å¤šçº¿ç¨‹ä¸”æ“ä½œå¤§é‡å­—ç¬¦ä¸²ç”¨<strong>StringBufferï¼Œçº¿ç¨‹å®‰å…¨ï¼Œå¯ä¿®æ”¹</strong>ã€‚</p><blockquote><p>StringBuffer å¯¹æ–¹æ³•åŠ äº†åŒæ­¥é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚StringBuilder å¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŠ åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote></li></ul></li><li><p><strong>ä¸ºä»€ä¹ˆString ä¸å¯å˜ï¼Ÿ</strong></p><p>String ç±»ä¸­ä½¿ç”¨ final å…³é”®å­—ä¿®é¥°å­—ç¬¦æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œ æ‰€ä»¥ String å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[]</span><br></pre></td></tr></table></figure></li></ul><h4 id="10-è¯´è¯´æ·±æ‹·è´å’Œæµ…æ‹·è´ï¼Ÿ">10.<strong>è¯´è¯´æ·±æ‹·è´å’Œæµ…æ‹·è´</strong>ï¼Ÿ</h4><ul><li><p>æµ…æ‹·è´ï¼ˆshallowCopyï¼‰åªæ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å·²å­˜åœ¨çš„å†…å­˜åœ°å€ï¼›</p><blockquote><p>å› æ­¤ï¼Œå¯èƒ½ä¼šå‡ºç°å‡ºç°æµ…æ‹·è´æ—¶é‡Šæ”¾åŒä¸€ä¸ªå†…å­˜çš„é”™è¯¯ã€‚</p></blockquote></li><li><p>æ·±æ‹·è´ï¼ˆdeepCopyï¼‰æ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆ<strong>å¹¶ä¸”ç”³è¯·äº†ä¸€ä¸ªæ–°çš„å†…å­˜</strong>ï¼Œä½¿è¿™ä¸ªå¢åŠ çš„æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°çš„å†…å­˜ã€‚</p></li></ul><h4 id="11-ã€æ–°å¢ã€‘ä»‹ç»ä¸€ä¸‹JDK1-8çš„æ–°ç‰¹æ€§ï¼Ÿ">11. ã€æ–°å¢ã€‘ä»‹ç»ä¸€ä¸‹JDK1.8çš„æ–°ç‰¹æ€§ï¼Ÿ</h4><p>JDK1.8æ–°å¢äº†éå¸¸å¤šçš„ç‰¹æ€§ï¼Œå¦‚ï¼š</p><ul><li><strong>Lambdaè¡¨è¾¾å¼</strong>ï¼šLambdaå…è®¸æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ï¼ˆå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ–¹æ³•ä¸­ï¼‰ã€‚</li><li><strong>æ–¹æ³•å¼•ç”¨</strong>ï¼šæ–¹æ³•å¼•ç”¨æä¾›äº†éå¸¸æœ‰ç”¨çš„è¯­æ³•ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨å·²æœ‰Javaç±»æˆ–å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰çš„æ–¹æ³•æˆ–æ„é€ å™¨ã€‚ä¸lambdaè”åˆä½¿ç”¨ï¼Œæ–¹æ³•å¼•ç”¨å¯ä»¥ä½¿è¯­è¨€çš„æ„é€ æ›´ç´§å‡‘ç®€æ´ï¼Œå‡å°‘å†—ä½™ä»£ç ã€‚</li><li><strong>é»˜è®¤æ–¹æ³•</strong>ï¼šé»˜è®¤æ–¹æ³•å°±æ˜¯ä¸€ä¸ª<strong>åœ¨æ¥å£é‡Œé¢æœ‰äº†ä¸€ä¸ªå®ç°çš„æ–¹æ³•</strong>ã€‚</li><li><strong>æ–°å·¥å…·</strong>ï¼šæ–°çš„ç¼–è¯‘å·¥å…·ï¼Œå¦‚ï¼šNashornå¼•æ“ jjsã€ ç±»ä¾èµ–åˆ†æå™¨jdepsã€‚</li><li><strong>Stream API</strong>ï¼šæ–°æ·»åŠ çš„Stream APIï¼ˆjava.util.streamï¼‰ æŠŠçœŸæ­£çš„<strong>å‡½æ•°å¼ç¼–ç¨‹é£æ ¼</strong>å¼•å…¥åˆ°Javaä¸­ã€‚</li><li><strong>Date Time API</strong>ï¼šåŠ å¼ºå¯¹æ—¥æœŸä¸æ—¶é—´çš„å¤„ç†ã€‚</li><li><strong>Optionalç±»</strong>ï¼šOptional ç±»å·²ç»æˆä¸º Java 8 ç±»åº“çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥è§£å†³<strong>ç©ºæŒ‡é’ˆå¼‚å¸¸</strong>ã€‚</li><li><strong>Nashornï¼ŒJavaScriptå¼•æ“</strong>ï¼šJDK1.8æä¾›äº†ä¸€ä¸ªæ–°çš„Nashorn javascriptå¼•æ“ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨JVMä¸Šè¿è¡Œç‰¹å®šçš„javascriptåº”ç”¨ã€‚</li></ul><h4 id="12-ã€æ–°å¢ã€‘javaä¸€ä¸ªç¨‹åºèƒ½ä¸èƒ½æœ‰å¤šä¸ªmainæ–¹æ³•ï¼Ÿä¸€ä¸ªç±»é‡Œå‘¢ï¼Ÿ">12. ã€æ–°å¢ã€‘javaä¸€ä¸ªç¨‹åºèƒ½ä¸èƒ½æœ‰å¤šä¸ªmainæ–¹æ³•ï¼Ÿä¸€ä¸ªç±»é‡Œå‘¢ï¼Ÿ</h4><ul><li><p><strong>ä¸€ä¸ªç¨‹åºé‡Œï¼Œå¤šä¸ªclasséƒ½æœ‰mainæ–¹æ³•</strong></p><p>å¯ä»¥ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªä¸ºå…¥å£ï¼Œå…¶ä½™ä¸ºæ™®é€šå‡½æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Class2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸€ä¸ªç±»æœ‰å¤šä¸ªmainæ–¹æ³•</strong></p><p>å¯ä»¥ï¼Œå…¶ä½™å°±ç›¸å½“æ˜¯é‡è½½ã€‚ä½†æ˜¯å…·æœ‰ä»¥ä¸‹sigatureï¼ˆç­¾åï¼‰çš„ä¸»è¦æ–¹æ³•å°†è¢«è§†ä¸ºappå…¥å£ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-2-å…³é”®å­—">1.1.2 å…³é”®å­—</h3><h4 id="1-è¯·ä½ è®²è®²Javaé‡Œé¢çš„finalå…³é”®å­—æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ">1.<strong>è¯·ä½ è®²è®²Javaé‡Œé¢çš„finalå…³é”®å­—æ˜¯æ€ä¹ˆç”¨çš„</strong>ï¼Ÿ</h4><ul><li><p><strong>ä¿®é¥°ç±»</strong>ï¼šè¡¨ç¤ºä¸èƒ½è¢«ç»§æ‰¿ï¼Œfinalç±» <u>æˆå‘˜å˜é‡</u> å¯ä»¥è®¾ä¸ºfinalï¼›ä½†finalç±»<u>æ‰€æœ‰æ–¹æ³•</u> ï¼Œéƒ½è¢«éšå¼æŒ‡å®šä¸ºfinalæ–¹æ³•ï¼›</p></li><li><p><strong>ä¿®é¥°æ–¹æ³•</strong>ï¼šé˜²ä»»ä½•ç»§æ‰¿ç±»ä¿®æ”¹å®ƒçš„å«ä¹‰ ï¼› åœ¨æ—©æœŸçš„Javaå®ç°ç‰ˆæœ¬ä¸­ï¼Œä¼šå°†finalæ–¹æ³•è½¬ä¸ºå†…åµŒè°ƒç”¨ï¼Œæ•ˆç‡ä¼šæ›´é«˜ï¼›</p></li><li><p><strong>ä¿®é¥°å˜é‡ã€å¼•ç”¨</strong>ï¼š<u>åŸºæœ¬ç±»å‹</u>çš„è¯ä¸€æ—¦åˆå§‹åŒ–ä¸èƒ½ä¿®æ”¹ï¼›<u>å¼•ç”¨ç±»å‹</u>ï¼Œä¸èƒ½æŒ‡å®šå…¶ä»–å¯¹è±¡ ã€‚</p></li></ul><h4 id="2-ã€é‡ç‚¹ã€‘è¯·ä½ è°ˆè°ˆå…³äºSynchronizedå’Œlock-ï¼Ÿ">2. ã€<strong>é‡ç‚¹</strong>ã€‘è¯·ä½ è°ˆè°ˆå…³äºSynchronizedå’Œlock ï¼Ÿ</h4><ul><li><p><strong>Synchronized</strong>ï¼šæ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œä¿®é¥°<u>ç±»ã€æ–¹æ³• </u> æˆ– <u>ä»£ç å—</u> ï¼Œä¿è¯åœ¨åŒä¸€æ—¶åˆ»æœ€<strong>å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹</strong>æ‰§è¡Œè¯¥æ®µä»£ç ï¼›</p><blockquote><p>ä½œç”¨èŒƒå›´ï¼š</p><ol><li>ä¿®é¥°ä¸€ä¸ªç±»/é™æ€æ–¹æ³•ï¼Œ<strong>ä½œç”¨çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡</strong>ã€‚</li><li>ä¿®é¥°ä¸€ä¸ªæ–¹æ³•/ä»£ç å—ï¼Œ<strong>ä½œç”¨çš„å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•/ä»£ç å—çš„å¯¹è±¡</strong>ã€‚</li></ol></blockquote></li><li><p>Lockï¼š<strong>æ˜¯ä¸€ä¸ªæ¥å£</strong>ï¼ŒLockèƒ½å®Œæˆsynchronizedæ‰€å®ç°çš„æ‰€æœ‰åŠŸèƒ½ã€‚</p><blockquote><p>Lockæ¥å£æ˜¯ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–çš„ï¼Œéœ€è¦é å®ƒçš„å®ç°ç±»ReentrantLockæ¥è¿›è¡Œå®ä¾‹åŒ–ã€‚</p></blockquote><ul><li><p>åŒºåˆ«ï¼š</p><ul><li><u>é”é‡Šæ”¾ï¼š</u><strong>synchronizedåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”</strong>ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”ç°è±¡å‘ç”Ÿï¼›Lockä¸ä¼šä¸»åŠ¨é€‚åº” <code>unLock()</code> é‡Šæ”¾ï¼Œå¿…é¡»æ‰‹åŠ¨åœ¨f<code>inally</code>é‡Šæ”¾ã€‚ï¼›</li><li><u>çº¿ç¨‹ç­‰å¾…ï¼š</u> <u>Lockå¯ä»¥è®©<strong>ç­‰å¾…é”çš„çº¿ç¨‹å¯ä»¥å“åº”ä¸­æ–­</strong></u>ï¼Œçº¿ç¨‹å¯ä»¥ä¸­æ–­å»å¹²åˆ«çš„äº‹åŠ¡ï¼›è€Œsynchronizedå´ä¸è¡Œï¼Œä½¿ç”¨synchronizedæ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼›</li><li><u>æˆåŠŸè·å–é”ï¼š</u> é€šè¿‡Lockå¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œsynchronizedå´æ— æ³•åŠåˆ°ã€‚</li></ul></li></ul></li></ul><h4 id="3-instanceofå…³é”®å­—çš„ä½œç”¨ï¼Ÿ">3. <strong>instanceof</strong>å…³é”®å­—çš„ä½œç”¨ï¼Ÿ</h4><p>instanceof ä¸¥æ ¼æ¥è¯´æ˜¯Javaä¸­çš„ä¸€ä¸ªåŒç›®è¿ç®—ç¬¦ï¼Œç”¨æ¥æµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºä¸€ä¸ªç±»çš„å®ä¾‹ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">System.out.println(i <span class="keyword">instanceof</span> Integer);<span class="comment">//ç¼–è¯‘ä¸é€šè¿‡ iå¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹</span></span><br><span class="line">System.out.println(i <span class="keyword">instanceof</span> Object);<span class="comment">//ç¼–è¯‘ä¸é€šè¿‡</span></span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer integer = <span class="keyword">new</span> Integer(<span class="number">1</span>);</span><br><span class="line">System.out.println(integer <span class="keyword">instanceof</span> Integer);<span class="comment">//true</span></span><br></pre></td></tr></table></figure><h4 id="4-finalæœ‰å“ªäº›ç”¨æ³•">4. <strong>finalæœ‰å“ªäº›ç”¨æ³•?</strong></h4><ul><li><p>è¢«finalä¿®é¥°çš„ç±»ä¸å¯ä»¥è¢«ç»§æ‰¿ ï¼›</p></li><li><p>è¢«finalä¿®é¥°çš„æ–¹æ³•<strong>ä¸å¯ä»¥è¢«é‡å†™</strong>ï¼Œ<u>è€Œä¸”JVMä¼šå°è¯•å°†å…¶å†…è”ï¼Œä»¥æé«˜è¿è¡Œæ•ˆç‡</u>ï¼›</p></li><li><p>è¢«finalä¿®é¥°çš„<u>å˜é‡</u>ä¸å¯ä»¥è¢«æ”¹å˜ï¼›</p><ul><li><p>è¢«finalä¿®é¥°çš„<u>å¼•ç”¨</u>ï¼Œé‚£ä¹ˆè¡¨ç¤ºå¼•ç”¨ä¸å¯å˜ï¼Œ<u>å¼•ç”¨æŒ‡å‘çš„å†…å®¹å¯å˜</u>ï¼›</p></li><li><p>è¢«finalä¿®é¥°çš„<u>å¸¸é‡</u>ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥å¸¸é‡æ± ä¸­ã€‚</p></li></ul></li></ul><h4 id="5-staticéƒ½æœ‰å“ªäº›ç”¨æ³•">5. <strong>staticéƒ½æœ‰å“ªäº›ç”¨æ³• ?</strong></h4><ul><li><p><strong>ä¿®é¥°é™æ€å˜é‡å’Œé™æ€æ–¹æ³•</strong> ï¼šéƒ½å±äºç±»çš„é™æ€èµ„æºï¼Œç±»å®ä¾‹æ‰€å…±äº« ï¼›</p></li><li><p><strong>ä¿®é¥°é™æ€å—</strong>ï¼šç”¨äºåˆå§‹åŒ–æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> calss PreCache&#123;</span><br><span class="line"> <span class="keyword">static</span>&#123;</span><br><span class="line"> <span class="comment">//æ‰§è¡Œç›¸å…³æ“ä½œ</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿®é¥°é™æ€åŒ…</strong>ï¼šåœ¨JDK 1.5ä¹‹åå¼•å…¥çš„æ–°ç‰¹æ€§,å¯ä»¥ç”¨æ¥æŒ‡å®šå¯¼å…¥æŸä¸ªç±»ä¸­çš„é™æ€èµ„æº,å¹¶ä¸”<strong>ä¸éœ€è¦ä½¿ç”¨ç±»å,<strong>å¯ä»¥ç›´æ¥</strong>ä½¿ç”¨æ–¹æ³•å</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.*;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        <span class="comment">//System.out.println(Math.sin(20));ä¼ ç»Ÿåšæ³•</span></span><br><span class="line">        System.out.println(sin(<span class="number">20</span>));</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-è°ˆä¸€è°ˆtransientå…³é”®å­—ï¼Ÿ">6. è°ˆä¸€è°ˆtransientå…³é”®å­—ï¼Ÿ</h4><blockquote><p><strong>å‚è€ƒ</strong> : <a href="https://www.cnblogs.com/chenpi/p/6185773.html">Javaä¸­çš„å…³é”®å­— transient</a></p></blockquote><ul><li><p><strong>Javaä¸­åºåˆ—åŒ–æ“ä½œ</strong></p><p>Javaä¸­å¯¹è±¡çš„åºåˆ—åŒ–æŒ‡çš„æ˜¯å°†<strong>å¯¹è±¡è½¬æ¢æˆä»¥ã€å­—èŠ‚åºåˆ—ã€‘çš„å½¢å¼æ¥è¡¨ç¤º</strong>ï¼Œè¿™äº›å­—èŠ‚åºåˆ—<strong>åŒ…å«äº†å¯¹è±¡çš„æ•°æ®å’Œä¿¡æ¯</strong>ã€‚</p><blockquote><p>å½“ç„¶ï¼Œåºåˆ—åŒ–åçš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†ååºåˆ—åŒ–ï¼Œæ¢å¤æˆåŸå…ˆçš„Javaå¯¹è±¡ï¼Œè¦ä¸ç„¶åºåˆ—åŒ–åå¹²å˜›å‘¢ï¼Œæ‰€ä»¥åºåˆ—åŒ–åçš„å­—èŠ‚åºåˆ—éƒ½æ˜¯å¯ä»¥æ¢å¤æˆJavaå¯¹è±¡çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ååºåˆ—åŒ–ã€‚</p></blockquote><ul><li><u>ä¸€ä¸ªåºåˆ—åŒ–åçš„å¯¹è±¡å¯ä»¥<strong>è¢«å†™åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶</strong>ä¸­</u>ï¼Œä¹Ÿå¯ç”¨äº<strong>ç½‘ç»œä¼ è¾“</strong>ï¼Œä¸€èˆ¬å½“æˆ‘ä»¬ä½¿ç”¨ç¼“å­˜cacheï¼ˆå†…å­˜ç©ºé—´ä¸å¤Ÿæœ‰å¯èƒ½ä¼šæœ¬åœ°å­˜å‚¨åˆ°ç¡¬ç›˜ï¼‰æˆ–è¿œç¨‹è°ƒç”¨rpcï¼ˆç½‘ç»œä¼ è¾“ï¼‰çš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦è®©æˆ‘ä»¬çš„å®ä½“ç±»å®ç°Serializableæ¥å£ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†è®©å…¶å¯åºåˆ—åŒ–ã€‚</li></ul></li><li><p><strong>å…³äºtransientå…³é”®å­—</strong></p><p>Javaä¸­transientå…³é”®å­—çš„ä½œç”¨ï¼Œå‘è™šæ‹Ÿæœºè¡¨æ˜: <strong><code>transient</code>å˜é‡ä¸æ˜¯å¯¹è±¡çš„<u>æŒä¹…çŠ¶æ€</u>çš„ä¸€éƒ¨åˆ†</strong>ã€‚</p><p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯è®©æŸäº›è¢«ä¿®é¥°çš„æˆå‘˜å±æ€§å˜é‡ä¸è¢«åºåˆ—åŒ–ï¼Œä¾‹å¦‚ï¼š</p><ol><li><p>ç±»ä¸­çš„å­—æ®µå€¼å¯ä»¥æ ¹æ®å…¶å®ƒå­—æ®µæ¨å¯¼å‡ºæ¥ï¼Œå¦‚ä¸€ä¸ªé•¿æ–¹å½¢ç±»æœ‰ä¸‰ä¸ªå±æ€§ï¼šé•¿åº¦ã€å®½åº¦ã€é¢ç§¯ï¼ˆç¤ºä¾‹è€Œå·²ï¼Œä¸€èˆ¬ä¸ä¼šè¿™æ ·è®¾è®¡ï¼‰ï¼Œé‚£ä¹ˆåœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œé¢ç§¯è¿™ä¸ªå±æ€§å°±æ²¡å¿…è¦è¢«åºåˆ—åŒ–äº†ï¼›</p></li><li><p>å…¶å®ƒï¼Œçœ‹å…·ä½“ä¸šåŠ¡éœ€æ±‚å§ï¼Œå“ªäº›å­—æ®µä¸æƒ³è¢«åºåˆ—åŒ–ï¼›</p></li></ol></li></ul><h5 id="7-1-HashMapä¸­æºç modCountä¸ºä»€ä¹ˆç”¨tranisentä¿®é¥°ï¼Ÿ">7.1 HashMapä¸­æºç modCountä¸ºä»€ä¹ˆç”¨tranisentä¿®é¥°ï¼Ÿ</h5><p>modCountä¸»è¦ç”¨äºåˆ¤æ–­HashMapæ˜¯å¦è¢«ä¿®æ”¹ï¼ˆåƒputã€removeæ“ä½œçš„æ—¶å€™ï¼ŒmodCountéƒ½ä¼šè‡ªå¢ï¼‰ã€‚</p><p>å¯¹äºè¿™ç§å˜é‡ï¼Œä¸€å¼€å§‹å¯ä»¥ä¸ºä»»ä½•å€¼ï¼Œ0å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥ï¼ˆnewå‡ºæ¥ã€ååºåˆ—åŒ–å‡ºæ¥ã€æˆ–è€…å…‹éš†cloneå‡ºæ¥çš„æ—¶å€™éƒ½æ˜¯ä¸º0çš„ï¼‰ï¼Œæ²¡å¿…è¦æŒä¹…åŒ–å…¶å€¼ã€‚</p><h3 id="1-1-3-Javaå¼‚å¸¸">1.1.3 Javaå¼‚å¸¸</h3><h4 id="1-Javaå¸¸è§å¼‚å¸¸å’Œåˆ†ç±»ï¼Ÿ">1. Javaå¸¸è§å¼‚å¸¸å’Œåˆ†ç±»ï¼Ÿ</h4><p><img src="https://i.loli.net/2021/05/26/1ctoGfDdrj6Wapv.png" alt="Javaå¼‚å¸¸çš„åˆ†ç±»å’Œç±»ç»“æ„å›¾1"></p><p>å¸¸è§åˆ†ä¸ºä¸¤ç±»ï¼ŒErrorå’ŒException ï¼š</p><ul><li><strong>Error</strong> ï¼šæŒ‡ç¨‹åºæ— æ³•æ¢å¤çš„å¼‚å¸¸æƒ…å†µï¼Œå¯¹äºå…¶æ‰€æœ‰ç±»å‹ï¼Œéƒ½ä¸è¦æ±‚ç¨‹åºå¤„ç†ã€‚<ul><li>å¸¸è§é”™è¯¯ï¼šStackoverflowï¼ŒoutOfMemory</li></ul></li><li><strong>Exceptionï¼š</strong> ç¨‹åºæœ‰å¯èƒ½æ¢å¤çš„é”™è¯¯ï¼Œåˆåˆ†ä¸ºIOException &amp; RuntimeException ï¼Œå¸¸è§é”™è¯¯ï¼š<ul><li><strong>IOException</strong>ï¼šFileNotFoundExcepetion</li><li><strong>RuntimeException</strong>  : ç©ºæŒ‡é’ˆï¼Œå‚æ•°ä¸åˆæ³•ï¼Œç±»æœªæ‰¾åˆ°ç­‰</li></ul></li></ul><h4 id="2-OOMäº§ç”ŸåŸå› å’Œåˆ†æï¼Ÿ">2. OOMäº§ç”ŸåŸå› å’Œåˆ†æï¼Ÿ</h4><blockquote><p>OOMï¼Œå…¨ç§°â€œOut Of Memoryâ€ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯â€œå†…å­˜ç”¨å®Œäº†â€ï¼Œæ¥æºäºjava.lang.OutOfMemoryError ã€‚</p></blockquote><ol><li><p><strong>java.lang.OutOfMemoryError: Java heap space</strong> ï¼ˆå †æº¢å‡ºï¼‰</p><ul><li><p><strong>äº§ç”ŸåŸå› </strong></p><ol><li><strong>å†…å­˜æ³„æ¼</strong>ï¼›</li><li>å †åˆ†é…å¤ªå°ï¼›</li></ol></li><li><p><strong>è§£å†³åŠæ³•</strong></p><ol><li><strong>å†…å­˜æ³„æ¼è¦æ‰‹åŠ¨å»é‡Šæ”¾å†…å­˜</strong>ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ï¼Œå•ä¾‹æ¨¡å¼</li><li>é€šè¿‡è™šæ‹Ÿæœºå‚æ•°<code>-Xms,-Xmx</code>ç­‰ä¿®æ”¹ï¼Œå¯¹å†…å­˜å¤§å°</li></ol></li></ul></li><li><p><strong>java.lang.OutOfMemoryError: PermGen space</strong> ï¼ˆæ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºï¼‰æº¢å‡ºï¼‰</p><ul><li><p><strong>äº§ç”ŸåŸå› </strong></p><p>å³æ–¹æ³•åŒºæº¢å‡ºäº†ï¼š</p><ol><li>ä¸€èˆ¬å‡ºç°äºå¤§é‡Classæˆ–è€…jspé¡µé¢ï¼Œæˆ–è€…é‡‡ç”¨cglibç­‰åå°„æœºåˆ¶çš„æƒ…å†µï¼Œå› ä¸ºä¸Šè¿°æƒ…å†µä¼šäº§ç”Ÿ<strong>å¤§é‡çš„Classä¿¡æ¯å­˜å‚¨äºæ–¹æ³•åŒº</strong> ï¼›</li><li><strong>è¿‡å¤šçš„å¸¸é‡</strong>å°¤å…¶æ˜¯å­—ç¬¦ä¸²ä¹Ÿä¼šå¯¼è‡´æ–¹æ³•åŒºæº¢å‡ºã€‚</li></ol></li><li><p><strong>è§£å†³åŠæ³•</strong></p><ol><li>æ°¸ä¹…ä»£çš„å†…å­˜åˆ†é…å¢å¤§ ï¼š-XX:PermSizeå’Œ-XX:MaxPermSize</li></ol></li></ul></li><li><p><strong>java.lang.StackOverflowError ------&gt; ä¸ä¼šæŠ›OOM errorï¼Œä½†ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„Javaå†…å­˜æº¢å‡º</strong>ã€‚</p><p>çº¿ç¨‹æ ˆç›¸å…³çš„å†…å­˜å¼‚å¸¸æœ‰ä¸¤ä¸ªï¼š</p><ul><li>StackOverflowError(æ–¹æ³•è°ƒç”¨å±‚æ¬¡å¤ªæ·±ï¼Œå†…å­˜ä¸å¤Ÿæ–°å»ºæ ˆå¸§)</li><li>OutOfMemoryErrorï¼ˆçº¿ç¨‹å¤ªå¤šï¼Œå†…å­˜ä¸å¤Ÿæ–°å»ºçº¿ç¨‹ï¼‰</li></ul></li><li><p><strong>java.lang.OutOfMemoryError: Metaspace</strong></p><blockquote><p>Javaä¸­<strong>æ™®é€šI/O</strong>é‡‡ç”¨<strong>è¾“å…¥/è¾“å‡ºæµ</strong>æ–¹å¼å®ç°ï¼Œè¾“å…¥æµInputStreamï¼ˆ  ç»ˆç«¯â€”&gt;ç›´æ¥å†…å­˜-&gt;JVMï¼‰ï¼Œè¾“å‡ºæµï¼ˆJVM-&gt;ç›´æ¥å†…å­˜-&gt;ç»ˆç«¯ï¼‰ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸­æœ‰kenelä¸JVMä¹‹é—´çš„æ‹·è´ï¼ˆå¾ˆå¤šæ¬¡ï¼‰ã€‚</p></blockquote><p>ä¸ºäº†ä½¿ç”¨<strong>ç›´æ¥å†…å­˜</strong>ï¼ŒJavaæ˜¯æœ‰ä¸€å—åŒºåŸŸå«<strong>DirectBuffer</strong>ï¼Œä¸æ˜¯JavaHeapè€Œæ˜¯<strong>cHeap</strong>çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ä½†ç”±äºç›´æ¥å†…å­˜æ²¡æœ‰è¢«javaè™šæœºå®Œå…¨æ‰˜ç®¡ï¼Œè‹¥ä½¿ç”¨ä¸å½“ï¼Œä¹Ÿå®¹æ˜“è§¦å‘æº¢å‡ºï¼Œå¯¼è‡´å®•æœºã€‚</p></li></ol><h4 id="3-try-catch-finallyï¼Œtryé‡Œæœ‰returnï¼Œfinallyè¿˜æ‰§è¡Œä¹ˆï¼Ÿ"><strong>3. try catch finallyï¼Œtryé‡Œæœ‰returnï¼Œfinallyè¿˜æ‰§è¡Œä¹ˆ</strong>ï¼Ÿ</h4><p>æ‰§è¡Œï¼Œå¹¶ä¸”finallyçš„æ‰§è¡Œæ—©äºtryé‡Œé¢çš„return ï¼š</p><ol><li>ä¸ç®¡æœ‰æœ¨æœ‰å‡ºç°å¼‚å¸¸ï¼Œfinallyå—ä¸­ä»£ç éƒ½ä¼šæ‰§è¡Œï¼›</li><li>å½“tryå’Œcatchä¸­æœ‰returnæ—¶ï¼Œfinallyä»ç„¶ä¼šæ‰§è¡Œï¼›</li><li>finallyæ˜¯<strong>åœ¨returnåé¢çš„è¡¨è¾¾å¼è¿ç®—åæ‰§è¡Œ</strong>çš„ï¼ˆæ­¤æ—¶å¹¶æ²¡æœ‰è¿”å›è¿ç®—åçš„å€¼ï¼Œè€Œæ˜¯å…ˆæŠŠè¦è¿”å›çš„å€¼ä¿å­˜èµ·æ¥ï¼Œç®¡finallyä¸­çš„ä»£ç æ€ä¹ˆæ ·ï¼Œè¿”å›çš„å€¼éƒ½ä¸ä¼šæ”¹å˜ï¼Œä»»ç„¶æ˜¯ä¹‹å‰ä¿å­˜çš„å€¼ï¼‰ï¼Œæ‰€ä»¥<strong>å‡½æ•°è¿”å›å€¼æ˜¯åœ¨finallyæ‰§è¡Œå‰ç¡®å®š</strong>çš„ã€‚</li></ol><h4 id="4-è¯´è¯´ä½ æ˜¯æ€ä¹ˆå¤„ç†å¼‚å¸¸çš„ï¼Ÿ">4.<strong>è¯´è¯´ä½ æ˜¯æ€ä¹ˆå¤„ç†å¼‚å¸¸çš„ï¼Ÿ</strong></h4><p><em><strong>try-catch-finally</strong></em></p><p><img src="https://i.loli.net/2021/05/05/JfavipzFPb6GI2t.png" alt="image-20210505154833171"></p><ul><li><p>try å—è´Ÿè´£ç›‘æ§å¯èƒ½å‡ºç°å¼‚å¸¸çš„ä»£ç </p></li><li><p>catch å—è´Ÿè´£æ•è·å¯èƒ½å‡ºç°çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œå¤„ç†</p></li><li><p>finally å—è´Ÿè´£æ¸…ç†å„ç§èµ„æºï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ</p></li><li><p>å…¶ä¸­ try å—æ˜¯å¿…é¡»çš„ï¼Œ<strong>catch å’Œ finally è‡³å°‘å­˜åœ¨ä¸€ä¸ªæ ‡å‡†å¼‚å¸¸å¤„ç†æµç¨‹</strong></p></li></ul><h4 id="5-webç½‘é¡µå¡æ€ä¹ˆæ’æŸ¥ï¼Ÿcpu100-æ€ä¹ˆæ’æŸ¥ï¼ŸOOMæ€ä¹ˆæ’æŸ¥ï¼Ÿ">5. webç½‘é¡µå¡æ€ä¹ˆæ’æŸ¥ï¼Ÿcpu100%æ€ä¹ˆæ’æŸ¥ï¼ŸOOMæ€ä¹ˆæ’æŸ¥ï¼Ÿ</h4><ul><li><p><strong>webç½‘é¡µå¡é¡¿</strong></p><ol><li><strong>ç”¨æˆ·ç«¯</strong>ï¼šç¡¬ä»¶é…ç½®ä½ã€èµ„æºä¸è¶³ï¼›CPU æˆ–è€…å†…å­˜èµ„æºä¸è¶³, æ¯”å¦‚ç”¨æˆ·æ˜¯å¦ä½¿ç”¨äº† Chrome è¿™ç§ â€œåƒå†…å­˜å¤§æˆ·â€ çš„æµè§ˆå™¨å¹¶ä¸”æ‰“å¼€äº†å¾ˆå¤šç½‘é¡µ?</li><li><strong>ç½‘ç»œåˆ†æ</strong>ï¼š<strong>DNS è§£ææ…¢</strong>ï¼›<strong>æœªè®¾ç½® CDN</strong>ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® CDN, åœ¨è·¨çº¿è·¯è®¿é—®(æ¯”å¦‚ç”¨æˆ·æ˜¯é“é€š, ä½†æ˜¯æœåŠ¡å™¨éƒ¨ç½²åœ¨è”é€š, è¿™ç§æƒ…å†µå°±æ˜¯è·¨çº¿è·¯), åœ°ç†ä½ç½®ç›¸å·®å¾ˆè¿œ ç­‰æƒ…å†µ ï¼›ç”¨æˆ·ç«¯çš„å¸¦å®½ä¸è¶³æˆ–æ‰€å¤„ç¯å¢ƒç½‘ç»œä¸ä½³ï¼›</li><li><strong>æœåŠ¡ç«¯</strong>ï¼šæœåŠ¡ç«¯å“åº”æ…¢ï¼Œæ€§èƒ½æ¯”è¾ƒå·® ã€‚</li></ol></li><li><p><strong>cpu100%</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/dennyzhangdd/p/11585971.html">https://www.cnblogs.com/dennyzhangdd/p/11585971.html</a></p></blockquote><ol><li><p><strong>æ‰§è¡Œ<code>top</code>å‘½ä»¤</strong>ï¼šæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹å ç³»ç»ŸCPUçš„æ’åºï¼›</p><blockquote><p>æå¤§å¯èƒ½æ’ç¬¬ä¸€ä¸ªçš„å°±æ˜¯å’±ä»¬çš„javaè¿›ç¨‹ï¼ˆCOMMANDåˆ—ï¼‰ã€‚PIDé‚£ä¸€åˆ—å°±æ˜¯è¿›ç¨‹å·ã€‚</p></blockquote></li><li><p>æ‰§è¡Œ<strong>top -Hp è¿›ç¨‹å·</strong>å‘½ä»¤ï¼šæŸ¥çœ‹javaè¿›ç¨‹ä¸‹çš„<strong>æ‰€æœ‰çº¿ç¨‹å CPUçš„æƒ…å†µ</strong>ï¼›</p></li><li><p>æ‰§è¡Œ<strong>printf &quot;%x\n 10</strong>å‘½ä»¤ ï¼šåç»­æŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯å±•ç¤ºçš„éƒ½æ˜¯åå…­è¿›åˆ¶ï¼Œä¸ºäº†æ‰¾åˆ°å’±ä»¬çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå’±ä»¬éœ€è¦æŠŠçº¿ç¨‹å·è½¬æˆ16è¿›åˆ¶ã€‚</p></li><li><p>æ‰§è¡Œ<strong>jstack è¿›ç¨‹å· | grep çº¿ç¨‹IDâ€ æŸ¥æ‰¾æŸè¿›ç¨‹ä¸‹</strong>â€“&gt;<code>çº¿ç¨‹ID(jstackå †æ ˆä¿¡æ¯ä¸­çš„nid)=0xa</code>çš„<strong>çº¿ç¨‹çŠ¶æ€</strong>ã€‚</p><p>ä»£ç ä¸­æœ‰å¤§é‡æ¶ˆè€—CPUçš„æ“ä½œï¼Œå¯¼è‡´CPUè¿‡é«˜ï¼Œç³»ç»Ÿè¿è¡Œç¼“æ…¢ï¼š</p><blockquote><ol><li><p>jstackï¼Œå¯ç›´æ¥å®šä½åˆ°ä»£ç è¡Œã€‚ä¾‹å¦‚æŸäº›å¤æ‚ç®—æ³•ï¼Œç”šè‡³ç®—æ³•BUGï¼Œæ— é™å¾ªç¯é€’å½’ç­‰ç­‰ã€‚</p></li><li><p>å¦‚æœæœ‰æ­»é”ï¼Œä¼šç›´æ¥æç¤ºå…³é”®å­—ï¼šdeadlockã€‚æ­¥éª¤4ï¼Œä¼šæ‰“å°å‡ºä¸šåŠ¡æ­»é”çš„ä½ç½®ã€‚</p></li></ol></blockquote></li><li><p>æ‰§è¡Œ<strong>jstat -gcutil è¿›ç¨‹å·</strong> ç»Ÿè®¡é—´éš”æ¯«ç§’ ç»Ÿè®¡æ¬¡æ•°ï¼ˆç¼ºçœä»£è¡¨ä¸€è‡´ç»Ÿè®¡ï¼‰â€ï¼Œ<strong>æŸ¥çœ‹æŸè¿›ç¨‹GCæŒç»­å˜åŒ–æƒ…å†µ</strong>ï¼Œ<strong>å¦‚æœå‘ç°è¿”å›ä¸­FGCå¾ˆå¤§ä¸”ä¸€ç›´å¢å¤§â€“&gt;ç¡®è®¤Full GC!</strong></p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨â€œ<strong>jmap -heap è¿›ç¨‹IDâ€æŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹çš„å †å†…ä»æ˜¯ä¸æ˜¯è¦æº¢å‡ºäº†</strong>ï¼Œç‰¹åˆ«æ˜¯è€å¹´ä»£å†…ä»ä½¿ç”¨æƒ…å†µä¸€èˆ¬æ˜¯è¾¾åˆ°é˜ˆå€¼(å…·ä½“çœ‹åƒåœ¾å›æ”¶å™¨å’Œå¯åŠ¨æ—¶é…ç½®çš„é˜ˆå€¼)å°±ä¼šè¿›ç¨‹Full GCã€‚</p><blockquote><p>jstatå‘½ä»¤ç›‘æ§GCæƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°Full GCæ¬¡æ•°éå¸¸å¤šï¼Œå¹¶ä¸”æ¬¡æ•°åœ¨ä¸æ–­å¢åŠ ã€‚</p></blockquote></li><li><p>æ‰§è¡Œ<strong>jmap -dump:format=b,file=filename è¿›ç¨‹ID</strong>ï¼Œå¯¼å‡ºæŸè¿›ç¨‹ä¸‹å†…å­˜heapè¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚</p></li></ol></li><li><p><strong>OOM</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/valjeanshaw/p/13130102.html">https://www.cnblogs.com/valjeanshaw/p/13130102.html</a></p></blockquote><p>å…ˆé€šè¿‡å†…å­˜æ˜ åƒå·¥å…·å¯¹Dumpå‡ºæ¥çš„å †è½¬å‚¨å¿«ç…§è¿›è¡Œåˆ†æï¼Œ<strong>é‡ç‚¹æ˜¯ç¡®è®¤å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦æ˜¯å¿…è¦çš„ï¼Œä¹Ÿå°±æ˜¯è¦å…ˆåˆ†æ¸…æ¥šåˆ°åº•æ˜¯å‡ºç°äº†å†…å­˜æ³„æ¼è¿˜æ˜¯å†…å­˜æº¢å‡º</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -dump:format=b,file=$java_pid.hprof     #java_pidä¸ºjavaè¿›ç¨‹ID</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹å…·ä½“æ˜¯æŠ¥ä»€ä¹ˆé”™ï¼šå¾ˆæ˜æ˜¾ä¸‹é¢æ˜¯å †æº¢å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to oom.out ...</span><br><span class="line">Heap dump file created [3196858 bytes in 0.016 secs]</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">        at java.util.Arrays.copyOf(Arrays.java:3332)</span><br><span class="line">        at java.lang.AbstractStringBuilder.ensureCapacityInternal(AbstractStringBuilder.java:124)</span><br><span class="line">        at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:700)</span><br><span class="line">        at java.lang.StringBuilder.append(StringBuilder.java:214)</span><br><span class="line">        at jvm.OomDemo.main(OomDemo.java:13)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JAVA </tag>
            
            <tag> æ ¡æ‹› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</title>
      <link href="/p/29708/"/>
      <url>/p/29708/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>è½¬çœ¼å°±åˆ°äº†å±äºæˆ‘çš„æ¯•ä¸šå­£ï¼Œè¿˜è®°å¾—åˆæ¥å­¦æ ¡çš„æœŸå¾…å’Œå…´å¥‹ï¼Œå´ä»â€œå°å¸ˆå¼Ÿâ€çœ¨çœ¼å˜æˆäº†â€œè€æ²¹æ¡â€ã€‚å®ä¹ å’Œç§‹æ‹›ä¹Ÿç®—æ­£å¼å‘Šä¸€æ®µè½ï¼Œå¯¹äºæˆ‘è¿™ç§æ‡’è›‹ï¼Œæœ‰å¹¸æ‹¿åˆ°äº†<u>è…¾è®¯</u>ã€<u>ç¾å›¢</u>ã€<u>Shoope SG</u>ç­‰ <u>åç«¯å¼€å‘å²—</u> offerï¼Œå‹‰å¼ºç®—æ˜¯ä¸€ä¸ª â€œhappy endingâ€ã€‚æ‰¾å·¥ä½œæ˜¯ä»Šå¹´æˆ‘ç»å†çš„æœ€é‡è¦äº‹æƒ…ä¹‹ä¸€ï¼ŒåŒæ—¶ä¹Ÿæƒ³ç»™å¸ˆå¼Ÿå¸ˆå¦¹æä¾›ä¸€ç‚¹å¸®åŠ©ï¼Œä¾¿æ•´ç†äº†è¿™ä»½ <u>ï¼ˆäº’è”ç½‘ï¼‰æ ¡æ‹›ç¬”è®°</u>ã€‚</p></blockquote><h3 id="ç›´å…¥ä¸»é¢˜">ç›´å…¥ä¸»é¢˜</h3><p>äº’è”ç½‘æ ¡æ‹›ä¸»è¦å½¢å¼å’Œè€ƒå¯Ÿå†…å®¹å¦‚ä¸‹ï¼š</p><ul><li><p><strong>è€ƒå¯Ÿå½¢å¼</strong></p><p>çº¿ä¸Šè€ƒå¯Ÿï¼Œè§†é¢‘é¢è¯•ï¼ˆå¤§éƒ¨åˆ†å…¬å¸ï¼‰æˆ–ç”µè¯é¢è¯•ï¼ˆé˜¿é‡Œç­‰éƒ¨åˆ†å…¬å¸å–œæ¬¢è¿™ç§æ–¹å¼ï¼‰ã€‚</p></li><li><p><strong>è€ƒå¯Ÿå†…å®¹</strong></p><ul><li><p><strong>ç®—æ³•èƒ½åŠ›</strong></p><p>ä¿—ç§°â€œåˆ·é¢˜â€ï¼Œä¸€èˆ¬é¢è¯•éƒ½æ˜¯å¸¸è§é¢˜ï¼Œç†è®ºä¸Šåˆ·å®Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a>ï¼Œèƒ½åšåˆ°çƒ‚ç†Ÿäºå¿ƒï¼ˆæŒ‡ç°åœº<strong>ç§’èƒŒé¢˜æˆ–æ¨¡æ¿</strong>ï¼‰ï¼Œå¤§å‚é¢è¯•ä¸€èˆ¬æ²¡æœ‰å¤šå¤§é—®é¢˜ã€‚</p><p>å½“ç„¶é’ˆå¯¹å¿ƒä»ªå…¬å¸ï¼Œå¯ä»¥åœ¨é¢è¯•å‰<strong>æ›´åŠ é’ˆå¯¹æ€§</strong>åœ°ç»ƒä¹ è¯¥å…¬å¸çš„å¸¸å‡ºé¢˜ï¼Œè¿™ä¸€ç‚¹ä¸Š<a href="https://codetop.cc/">codeTop</a>æ˜¯ä¸€ä¸ªä¸é”™çš„ç½‘ç«™ã€‚</p></li><li><p><strong>è®¡ç®—æœºåŸºç¡€</strong></p><p>ä¿—ç§°â€œå…«è‚¡â€ï¼Œè€ƒå¯ŸèŒƒå›´åŒ…å«ï¼šè®¡ç®—æœºç½‘ç»œã€Linuxã€æ•°æ®åº“ã€æ“ä½œç³»ç»Ÿã€å¸¸è§ä¸­é—´ä»¶&amp;æ¡†æ¶ã€æ™ºåŠ›é¢˜ç­‰ã€‚å¯ä»¥çœ‹å¾—åˆ°<strong>è€ƒå¯ŸèŒƒå›´éå¸¸å¹¿</strong>ï¼Œä½†æ˜¯<strong>è€ƒå¯Ÿçš„é¢˜ç›®éå¸¸å›ºå®š</strong>ã€‚æ‰€ä»¥åªè¦èƒŒç†Ÿå¸¸è§é¢˜ç›®é—®ç­”ä¾¿èƒ½ä¸é”™åœ°åº”å¯¹é¢è¯•ï¼Œè¿™ä¹Ÿæ˜¯è¯¥éƒ¨åˆ†å†…å®¹è¢«ç§°ä¸ºâ€œå…«è‚¡æ–‡â€çš„åŸå› ã€‚</p></li><li><p><strong>é¡¹ç›® &amp; å®ä¹ </strong></p><p>é¡¹ç›®é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å®é™…åšçš„å¼€å‘é¡¹ç›®ï¼ˆå¦‚æœæ˜¯ç®—æ³•å²—åˆ™å¯¹åº”è®ºæ–‡ï¼‰ã€‚æ ¹æ®é¢è¯•ç»éªŒï¼Œä¸€ä¸ª<strong>å¥½çš„å¼€æºé¡¹ç›®</strong>æ˜¯éå¸¸åŠ åˆ†çš„ã€‚</p><p>å®ä¹ é€šå¸¸æ˜¯æŒ‡å¤§å‚å®ä¹ ï¼Œåœ¨ç«äº‰è¿™ä¹ˆæ¿€çƒˆçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰å®ä¹ ï¼Œç§‹æ‹›æƒ³è¿›å…¥äº’è”ç½‘å¤§å‚å°†ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚</p></li></ul></li></ul><p>æ ¹æ®ä»¥ä¸Šå†…å®¹ï¼Œè¿™ä»½æ ¡æ‹›ç¬”è®°äº‰å–å°½é‡å…¨é¢è¦†ç›–ï¼Œæ•´ä¸ªç›®å½•å®‰æ’å¦‚ä¸‹ï¼š</p><ul><li>[æ³¨1]ï¼šæœ¬ä»½ç¬”è®°é™¤è‡ªèº«æ€»ç»“å¤–ï¼Œä¸»è¦å‚è€ƒèµ„æ–™æ¥æºäº<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="Java Guideï¼šhttps://github.com/Snailclimb/JavaGuide">[1]</span></a></sup><sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="é˜¿ç§€C++é¢è¯•ç¬”è®°ï¼šhttps://github.com/forthespada/InterviewGuide">[2]</span></a></sup><sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="ç‰›å®¢ç½‘é¢ç»ï¼šhttps://www.nowcoder.com/interview/center">[3]</span></a></sup>ï¼Œç‰¹æ­¤æ³¨æ˜ã€‚</li></ul><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><p>ä¸‹é¢æ˜¯ä¸€äº›å¥‡æ€ªæ²¡æœ‰è„‘è¢‹çš„çµ®çµ®å¨å¨ï¼Œè¿«ä¸åŠå¾…å¹´å…¥ç™¾ä¸‡å¯ä»¥æ ¹æ®ä¸Šé¢ç›®å½•ç›´æ¥å¼€å§‹å­¦ä¹ äº†ï¼Œä»¥ä¸‹å¯ç•¥è¿‡ã€‚</p><h3 id="ç®—æ³•è¿˜æ˜¯åç«¯ï¼Ÿ">ç®—æ³•è¿˜æ˜¯åç«¯ï¼Ÿ</h3><blockquote><p>è¯»äº†ä¸ªï¼ˆ<s>æœ«æµ</s>ï¼‰985ç¡•å£«ï¼Œä¹Ÿæœ‰ç¯‡ä¸é”™çš„ï¼ˆ<s>æ°´</s>ï¼‰è®ºæ–‡ï¼Œæœ€åå»åšäº†å½“æ—¶æœ¬ç§‘æ¯•ä¸šå°±èƒ½åšçš„å¼€å‘å²—ï¼Ÿâ€”ã€Šæœ¬ç§‘åŒå­¦ç«Ÿæ˜¯æˆ‘çš„é¢è¯•å®˜ã€‹ç³»åˆ—ã€‚</p></blockquote><p>å¦‚æœä½ å’Œæˆ‘æœ‰ä¸€æ ·çš„å›°æƒ‘å’Œé€‰æ‹©ï¼Œä¸å¦¨æ¥çœ‹çœ‹æˆ‘çš„ç»å†ï¼Œä¹Ÿè®¸ä¼šæœ‰ç‚¹å¸®åŠ©ã€‚åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ†æä¸‹ç®—æ³•å’Œåç«¯çš„å„è‡ªä¼˜åŠ£ã€‚</p><h4 id="ç®—æ³•-P-K-åç«¯">ç®—æ³• P.K. åç«¯</h4><p>åœ¨è¿™é‡Œæˆ‘å°†ä»ï¼Œèµ·è–ªã€é—¨æ§›ã€ç«äº‰å¼ºåº¦ã€æœªæ¥å‘å±•ç­‰ç»´åº¦æ¥åˆ†æäºŒè€…ä¼˜åŠ£ã€‚</p><ul><li>[æ³¨1]ï¼šä»¥ä¸‹å‡ä»¥ä¸€çº¿å¤§å‚ï¼ˆè…¾è®¯ã€é˜¿é‡Œã€å­—èŠ‚ã€ç¾å›¢ç­‰ï¼‰ä¸ºåŸºå‡†ã€‚</li><li>[æ³¨2]ï¼šCV=Computer Visionï¼ŒNLP=Natural Language Processing ã€‚</li><li>[æ³¨3]ï¼šéç‰¹åˆ«è¯´æ˜ï¼Œä¸è€ƒè™‘ç‰¹ä¾‹æƒ…å†µã€‚</li></ul><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">ç®—æ³•</th><th style="text-align:center">åç«¯</th></tr></thead><tbody><tr><td style="text-align:center"><strong>èµ·è–ª</strong></td><td style="text-align:center">åŒçº§åˆ«æ¯”åç«¯é«˜ï¼š1~2K/æœˆ</td><td style="text-align:center">ä¸­æ¡£è–ªèµ„ï¼š40W+</td></tr><tr><td style="text-align:center"><strong>ç®€å†é—¨æ§›</strong></td><td style="text-align:center">211ç¡•å£«èµ·</td><td style="text-align:center">211æœ¬èµ·ï¼ˆéƒ¨åˆ†çŸ¥ååŒéï¼‰</td></tr><tr><td style="text-align:center"><strong>ç«äº‰å¼ºåº¦</strong></td><td style="text-align:center">CV&gt;&gt;æœå¹¿æ¨&gt;NLP</td><td style="text-align:center">CV&gt;Javaåç«¯&gt;&gt;C++åç«¯&gt;å…¶å®ƒ</td></tr><tr><td style="text-align:center"><strong>æœªæ¥å‘å±•</strong></td><td style="text-align:center">äºŒè€…å‘å±•ç›¸å·®ä¸å¤§ï¼Œå’Œä¸ªäººå¼ºç›¸å…³</td><td style="text-align:center">äºŒè€…å‘å±•ç›¸å·®ä¸å¤§ï¼Œå’Œä¸ªäººå¼ºç›¸å…³</td></tr><tr><td style="text-align:center"><strong>å…¶å®ƒ</strong></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°ï¼ŒCVç«äº‰å¼ºåº¦è¿œå¤§äºå…¶å®ƒç®—æ³•å²—ä½ï¼Œå³ä½¿å’Œåç«¯ä¸­ç«äº‰æœ€æ¿€çƒˆçš„<strong>Javaåç«¯</strong>ç›¸æ¯”ï¼Œä¹Ÿä¾æ—§æ›´å¤§ã€‚</p><p>åœ¨è¯»ç ”æœŸé—´ï¼Œæˆ‘ä¸ªäººç ”ç©¶æ–¹å‘å°±æ˜¯CVé¢†åŸŸï¼ˆObject Trackingï¼‰ï¼Œæœ‰ä¸€ç¯‡è®ºæ–‡ï¼ˆCCF-Aï¼Œä¸‰å®¡ï¼‰å’Œå‡ ç¯‡ä¸“åˆ©ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰ä¿¡å¿ƒå»ç«äº‰CVç›¸å…³å²—ä½ï¼ˆå­¦å†å’Œè®ºæ–‡æ— ä¼˜åŠ¿ï¼‰ï¼Œä¹Ÿå¯¹æ·±åº¦å­¦ä¹ äº§ç”Ÿäº†è¿·èŒ«ï¼š<u>è°ƒå‚å’Œæ¨¡å‹ç¼è¡¥ä¹Ÿè®¸å¹¶ä¸æ˜¯æˆ‘æƒ³åšçš„äº‹ï¼Œè™½ç„¶æœ‰æ›´åº•å±‚çš„ç ”ç©¶æ–¹å‘ä½†è‡ªå·±çš„æ•°å­¦åŸºç¡€ä¸å¤Ÿç‰¢é </u>ã€‚</p><p>å°±è¿™æ ·ï¼Œå¸¦ç€<strong>ä¸ƒåˆ†è¿·èŒ«ä¸‰åˆ†ç›²ç›®è‡ªä¿¡</strong> çš„æˆ‘ä¸€è‚¡è„‘æ‰è¿›Javaçš„è‹¦æµ·ã€‚å¯æ˜¯<strong>Javaåç«¯å²—ä½</strong>çš„ç«äº‰æ¿€çƒˆç¨‹åº¦è¿œè¶…æˆ‘æƒ³è±¡ï¼Œå®ä¹ å’Œç§‹æ‹›ä¸€ç›´éƒ½åœ¨å¤±ä¸šè¾¹ç¼˜ç–¯ç‹‚è¯•æ¢ã€‚æ— è®ºæ˜¯å®ä¹ è¿˜æ˜¯ç§‹æ‹›ï¼Œæœ€åæˆ‘æ¥å—çš„Offeréƒ½æ˜¯<strong>C++åç«¯å²—ä½(è…¾è®¯)</strong> ï¼Œå¯ä»¥è¯´æ˜¯ç°å®Javaå°ä¸‘äº†ã€‚</p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/b393ec036fd14f3c9d9610f7d0c839ff.png" alt="2021Q1å¤©çŒ«æ·˜å®åŒæ¯”å¢é•¿è¾¾53%ï¼Œçˆ†å‘çš„ç”·å£«é¦™æ°´å¸‚åœºèƒŒåâ€¦â€¦_å“ç‰Œ" style="zoom:67%;" /><p>ç°åœ¨å›å¤´æƒ³æƒ³ï¼ŒJavaåç«¯ç«äº‰ä¹‹æ‰€ä»¥è¿™ä¹ˆæ¿€çƒˆä¹ŸåŸºæœ¬æ˜¯å¿…ç„¶çš„ï¼šäº’è”ç½‘çš„é«˜è–ªï¼ˆ<s>å’Œ996</s>ï¼‰å¸å¼•äº†å¤§é‡å…¶å®ƒä¸“ä¸šè½¬è¡Œçš„åŒå­¦ï¼Œè€ŒJavaç›¸æ¯”C++ï¼šæ˜“ä¸Šæ‰‹é€Ÿæˆã€éœ€æ±‚å¤§ã€ç”Ÿæ€ä¸°å¯Œï¼ˆ<s>åŸ¹è®­ç­ä¸€æ¡é¾™æœåŠ¡</s>ï¼‰ï¼Œè‡ªç„¶æ˜¯é¦–é€‰ã€‚</p><p>é‚£ä¹ˆï¼š<strong>åˆ°åº•æ˜¯é€‰æ‹©Javaåç«¯è¿˜æ˜¯C++åç«¯å‘¢?</strong> è¿™é‡Œæˆ‘ä¹Ÿç®€å•åˆ†æä¸€ä¸‹å„è‡ªä¼˜åŠ£ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®ä¸ªäººæƒ…å†µè¿›è¡ŒæŠ‰æ‹©ã€‚</p><h4 id="Javaåç«¯-P-K-C-åç«¯">Javaåç«¯ P.K. C++åç«¯</h4><blockquote><p>ä¸€å®¶ä¹‹è¨€ï¼Œä»…ä¾›å‚è€ƒã€‚</p></blockquote><p>åœ¨è¿™é‡Œæˆ‘å°†ä»ï¼Œèµ·è–ª&amp;é—¨æ§›ã€å²—ä½éœ€æ±‚ï¼Œç«äº‰å¼ºåº¦ã€æœªæ¥å‘å±•ç­‰ç»´åº¦æ¥åˆ†æäºŒè€…ä¼˜åŠ£ã€‚</p><ul><li>[æ³¨1]ï¼šä»¥ä¸‹å‡ä»¥ä¸€çº¿å¤§å‚ï¼ˆè…¾è®¯ã€é˜¿é‡Œã€å­—èŠ‚ã€ç¾å›¢ç­‰ï¼‰ä¸ºåŸºå‡†ã€‚</li><li>[æ³¨2]ï¼šéç‰¹åˆ«è¯´æ˜ï¼Œä¸è€ƒè™‘ç‰¹ä¾‹æƒ…å†µã€‚</li></ul><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"><strong>Javaåç«¯</strong></th><th style="text-align:center"><strong>C++åç«¯</strong></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>èµ·è–ª&amp;é—¨æ§›</strong></td><td style="text-align:center">åŸºæœ¬ä¸€è‡´</td><td style="text-align:center">åŸºæœ¬ä¸€è‡´</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>å²—ä½éœ€æ±‚</strong></td><td style="text-align:center">éå¸¸å¤š</td><td style="text-align:center">ä¸€èˆ¬</td><td style="text-align:center"><strong>ä»Šå¹´åµŒå…¥å¼çˆ†çƒ­</strong>ï¼ŒC++å²—ä½éœ€æ±‚é¢„è®¡ä¼šå¢åŠ </td></tr><tr><td style="text-align:center"><strong>ç«äº‰å¼ºåº¦</strong></td><td style="text-align:center">éå¸¸å¤§ï¼ŒJava&gt;&gt;C++</td><td style="text-align:center">ä¸€èˆ¬</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>æœªæ¥å‘å±•</strong></td><td style="text-align:center">ç›¸å·®ä¸å¤§ï¼Œå’Œä¸ªäººç›¸å…³</td><td style="text-align:center">ç›¸å·®ä¸å¤§ï¼Œå’Œä¸ªäººç›¸å…³</td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>å…¶å®ƒ</strong></td><td style="text-align:center">é“¶è¡Œå’Œå›½ä¼ç­‰<strong>å…»è€æ€§è´¨</strong>å•ä½å¯¹Javaéœ€æ±‚æ¯”è¾ƒå¤§ï¼ŒåæœŸèŒä¸šå‘å±•<strong>æœ‰æ›´å¤šé€‰æ‹©</strong></td><td style="text-align:center">C++å²—ä½éœ€æ±‚ä¸»è¦æ˜¯<strong>å¤§å‚</strong>ï¼ŒåæœŸèŒä¸šå‘å±•è·³æ§½<strong>å¯é€‰è¾ƒå°‘</strong></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>å¯¹å£å…¬å¸</strong></td><td style="text-align:center">é˜¿é‡Œã€ç¾å›¢ç­‰</td><td style="text-align:center">è…¾è®¯ã€ç™¾åº¦ã€åä¸ºç­‰</td><td style="text-align:center"></td></tr></tbody></table><p>ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œçš„èªæ˜ä½ ï¼Œæ ¹æ®è‡ªå·±çš„æŠ€æœ¯å€¾å‘ã€æ„å‘å…¬å¸ç­‰å·²ç»æœ‰äº†å¤§æ¦‚çš„æ€è·¯ï¼š</p><ul><li>æƒ³æ›´å®¹æ˜“å»å¤§å‚ï¼Œåšä¸€äº›æ›´åº•å±‚ï¼ˆç½‘ç»œã€å­˜å‚¨ã€æ“ä½œç³»ç»Ÿã€å®‰å…¨æ–¹é¢ç­‰ï¼‰çš„äº‹æƒ…ï¼ŒC++è‡ªç„¶æ˜¯ä¸é”™çš„é€‰æ‹©ï¼›</li><li>ä½†æ˜¯æœªæ¥è€ƒè™‘å»ä¸€äº›å…»è€å•ä½å…»è€ï¼Œå¯¹Webå¼€å‘ã€ç§»åŠ¨å¼€å‘ç­‰æ›´æ„Ÿå…´è¶£çš„è¯ï¼ŒJavaåº”è¯¥æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li></ul><h3 id="æ±‚èŒæ—¶é—´èŠ‚ç‚¹"><strong>æ±‚èŒæ—¶é—´èŠ‚ç‚¹</strong></h3><p>æ•´ä¸ªå®ä¹ å’Œç§‹æ‹›ï¼Œç”±äºè‡ªå·±çš„æ‹–å»¶å’Œæ‡’æ•£ï¼Œæ‰€æœ‰çš„æ—¶é—´èŠ‚ç‚¹åŸºæœ¬éƒ½æ˜¯åœ¨DDLä¸Šåå¤æ¨ªè·³ã€‚å¦‚æœä¸æ˜¯è¿æ°”è¿˜ä¸é”™ï¼Œç°åœ¨è¯´ä¸å®šæ­£åœ¨å¯å®¤æŠ±ç€æµ…è“è‰²åºŠå•å“­æ³£ ğŸ˜­ ï¼Œç•™ä¸‹ä¸å­¦æ— æœ¯çš„æ³ªæ°´ã€‚</p><p>æ‰€ä»¥æ ¹æ®è‡ªå·±çš„ç»éªŒï¼Œæ•´ç†äº†ä¸€ä»½<strong>æˆ‘è®¤ä¸º</strong>çš„å®Œç¾æ±‚èŒæ—¶é—´èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ•´ç†äº†ä¸€ä»½å·¥ä½œå°ä¸‘æ—¶é—´èŠ‚ç‚¹å®‰æ’ï¼Œä¾›å¯¹æ¯”å‚è€ƒã€‚</p><ul><li>[æ³¨1]ï¼šå¹´ä»½ä»¥å½“å¹´åº”å±Šæ±‚èŒå¹´ä»½ä¸ºå‡†ã€‚</li></ul><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">è‡ªå¾‹å¤§ä½¬ â›¹</th><th style="text-align:center">å·¥ä½œå°ä¸‘ ğŸ˜¹</th></tr></thead><tbody><tr><td style="text-align:center"><strong>1æœˆä»½</strong></td><td style="text-align:center">åˆ·å®Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a>ï¼Œå‡†å¤‡é¡¹ç›®</td><td style="text-align:center">ç©</td></tr><tr><td style="text-align:center"><strong>2æœˆä»½</strong></td><td style="text-align:center">äºŒåˆ·LeetCodeï¼Œå¼€å§‹èƒŒè¯µå…«è‚¡ï¼Œä¼˜åŒ–é¡¹ç›®</td><td style="text-align:center">ç»§ç»­ç©</td></tr><tr><td style="text-align:center"><strong>3æœˆä»½</strong></td><td style="text-align:center">å…«è‚¡åŸºæœ¬çƒ‚ç†Ÿï¼Œå¼€å§‹é¢è¯•ï¼ˆ<strong>æ‰¾å®ä¹ </strong>ï¼‰å°è¯•é”‹èŠ’</td><td style="text-align:center">ç„¦è™‘çš„ç©</td></tr><tr><td style="text-align:center"><strong>4æœˆä»½</strong></td><td style="text-align:center">LeetCodeå’Œå…«è‚¡çƒ‚ç†Ÿï¼Œæ”¶è·ä¼—å¤šå¤§å‚å®ä¹ Offerï¼Œèµ¢æ¥å·¥ä½œå°ä¸‘ç¾¡æ…•çš„èµå¹</td><td style="text-align:center">ç‰¹åˆ«ç„¦è™‘ï¼Œå¼€å§‹ä¸€è¾¹ç¾¡æ…•ä¸€è¾¹æŠ•ç®€å†ï¼Œé¢è¯•è¢«æ— æƒ…æš´æ‰“</td></tr><tr><td style="text-align:center"><strong>5æœˆä»½</strong></td><td style="text-align:center">å¼€å§‹<strong>ç¬¬ä¸€æ®µ</strong>å¤§å‚å®ä¹ </td><td style="text-align:center">æåº¦ç„¦è™‘ï¼Œå¼€å§‹ç†¬å¤œå‡†å¤‡åˆ·é¢˜å’Œå…«è‚¡ï¼Œç»§ç»­é¢è¯•</td></tr><tr><td style="text-align:center"><strong>6æœˆä»½</strong></td><td style="text-align:center">å·²å®ä¹ ä¸¤ä¸ªæœˆï¼ŒåŒæ—¶é¢è¯•æ”¶è·äº†ç¬¬äºŒä¸ªå¤§å‚Offerï¼Œæ³¢æ¾œä¸æƒŠ</td><td style="text-align:center">ç»ˆäºæ”¶è·Offerï¼Œç°ä»£èŒƒè¿›ä¸­ä¸¾ï¼Œå¥”èµ°ç›¸å‘Š</td></tr><tr><td style="text-align:center"><strong>7æœˆä»½</strong></td><td style="text-align:center">å¼€å§‹<strong>ç¬¬äºŒæ®µ</strong>å¤§å‚å®ä¹ ï¼Œå¼€å§‹<strong>æå‰æ‰¹</strong></td><td style="text-align:center">å®ä¹ ç¬¬ä¸€ä¸ªæœˆï¼Œä¸‹ç­å°±æ˜¯ç©ï¼Œ<strong>æå‰æ‰¹é‚£æ˜¯ä¸ªå•¥ï¼Ÿ</strong></td></tr><tr><td style="text-align:center"><strong>8æœˆä»½</strong></td><td style="text-align:center">ç¬¬äºŒæ®µå¤§å‚å®ä¹ äºŒä¸ªæœˆï¼Œæå‰æ‰¹æ”¶è·æ ¡æ‹›Offerï¼ŒåŒæ—¶æ— æ„å¤–<strong>è½¬æ­£</strong></td><td style="text-align:center">å®ä¹ ä¸¤ä¸ªæœˆï¼Œç»§ç»­æ— è§†æå‰æ‰¹ï¼Œè¿æ°”å¥½ä¹Ÿ<strong>è½¬æ­£</strong>äº†</td></tr><tr><td style="text-align:center"><strong>9æœˆä»½</strong></td><td style="text-align:center"><code>Offeræ”¶å‰²æœº</code>+<code>SSPæ”¶å‰²æœº</code>ç§°å·è¾¾æˆï¼Œç¾¡æ…•å¬åˆ°éº»</td><td style="text-align:center">åˆç©äº†åŠä¸ªæœˆï¼Œå¼€å§‹æŠ•ç®€å†ï¼Œæ¡äº†å‡ å®¶Offerï¼Œå½»åº•èººå¹³</td></tr><tr><td style="text-align:center"><strong>10æœˆä»½</strong></td><td style="text-align:center">å¼€å§‹å‡†å¤‡<strong>é€‰è°ƒ</strong></td><td style="text-align:center"><code>ç™½èœæ”¶å‰²æœº</code>ç§°å·è¾¾æˆï¼Œæœ€ç»ˆæ— å¥ˆé€‰ä¸€é¢—å¤§ç™½èœ<strong>ç»“æŸç§‹æ‹›</strong></td></tr></tbody></table><ul><li><p><strong>å…³äºå®ä¹ </strong>ï¼šå¯ä»¥çœ‹åˆ°ï¼Œå·¥ä½œå°ä¸‘å¦‚æœä¸æ˜¯<strong>è¿æ°”å¥½è½¬æ­£</strong>ï¼Œç§‹æ‹›<strong>å‡­å€Ÿå®ä¹ ç»å†ï¼ˆå¦ä¸€æ–¹é¢ä¹Ÿè¯´æ˜äº†å®ä¹ çš„é‡è¦æ€§</strong>ï¼‰æ‹¿äº†å‡ ä¸ªOfferï¼Œæ•´ä¸ªæ±‚èŒè¿‡ç¨‹å¹¶ä¸ä¹è§‚ã€‚</p></li><li><p><strong>å…³äºæå‰æ‰¹</strong> ï¼šå®ä¹ çš„æ—¶å€™<strong>ä¸€å®šè¦å»å‡†å¤‡æå‰æ‰¹</strong>ï¼Œæå‰æ‰¹<strong>HCä¼—å¤š</strong>ï¼ˆç‰¹åˆ«æ˜¯å¥½å²—ä½ï¼‰ï¼Œ<strong>éš¾åº¦ä¹Ÿè¾ƒä½ï¼ˆäº²èº«æ„Ÿå—ï¼‰</strong> ï¼Œæ‹¿åˆ°Offerçš„æ¦‚ç‡<strong>ç›¸æ¯”ç§‹æ‹›</strong>ä¼šå¤§å¾ˆå¤šã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œå¤§å®¶<strong>å°½é‡æ—©ç‚¹</strong>å……åˆ†å‡†å¤‡ï¼Œæ‰¾å·¥ä½œä¸è‡³äºé•¿æœŸå¤„äºç„¦è™‘çŠ¶æ€ã€‚æ‹¼è¿æ°”è‡ªç„¶ä¸å¦‚æ‹¼å®åŠ›ï¼Œå½“ç„¶ä¹Ÿè¦åŠ³é€¸ç»“åˆï¼Œæœ‰ç©ºé—²å¤šå’Œå¸ˆå…„æ‰“æ‰“LOLæ”¾æ¾ä¸‹ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ ğŸ•¹ ï¼Œå“ˆå“ˆã€‚</p><h3 id="ä¸€äº›æœ‰ç”¨çš„app-ç½‘ç«™"><strong>ä¸€äº›æœ‰ç”¨çš„app &amp; ç½‘ç«™</strong></h3><blockquote><p>æœªå¿…å…¨é¢ï¼Œä»…ä¾›å‚è€ƒã€‚</p></blockquote><ul><li>[æ³¨1]ï¼šå„å¤§å…¬å¸æ ¡æ‹›å®˜ç½‘ï¼Œæ¯”å¦‚ï¼š<a href="join.qq.com">è…¾è®¯æ ¡å›­æ‹›è˜</a> ï¼Œæœ€å¥½å…ˆå»æå‰ä¸€æ¬¡æ€§æ³¨å†Œå¥½ç®€å†ã€‚</li></ul><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">åº”ç”¨/ç½‘ç«™å</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç½‘ç«™</strong></td><td style="text-align:center"><a href="https://www.nowcoder.com/">ç‰›å®¢ç½‘</a></td><td style="text-align:center">æ‰¾å†…æ¨ã€çœ‹é¢ç»ã€æ±‚èŒäº¤æµç­‰</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://leetcode-cn.com/">Leetcode</a></td><td style="text-align:center">åˆ·é¢˜</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://codetop.cc/">codeTop</a></td><td style="text-align:center">åˆ·é¢˜</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.wondercv.com/">è¶…çº§ç®€å†</a></td><td style="text-align:center">åˆ¶ä½œç®€å†çš„ä¸äºŒä¹‹é€‰</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://www.hwh.zone">royhuangâ€™s blog</a></td><td style="text-align:center">æ¯›é‚è‡ªèï¼Œçœ‹çœ‹å…«è‚¡</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://github.com/">github</a></td><td style="text-align:center">ç¥å¥‡çš„åœ°æ–¹ï¼Œå¤šåœ¨è¿™é‡Œæ‰¾å„ç§èµ„æºï¼šé¢ç»æ€»ç»“ã€é¡¹ç›®æ•™ç¨‹ç­‰</td></tr><tr><td style="text-align:center"><strong>APP</strong></td><td style="text-align:center">ç‰›å®¢ç½‘</td><td style="text-align:center">åŒä¸Š</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">è„‰è„‰</td><td style="text-align:center">æ±‚èŒä¿¡æ¯äº¤æµï¼Œå›½å†…æœ€å¤§çš„èŒåœºäº¤æµAPP</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">é—²é±¼</td><td style="text-align:center">å„ç§æ•™å­¦è§†é¢‘è¯¾ç¨‹ï¼Œä¸å¦¨è¿™é‡Œå…ˆæœä¸€æœ</td></tr></tbody></table><p>ğŸ”¼ ä»¥ä¸Šå¤§æ¦‚å°±æ˜¯æˆ‘æ±‚èŒæ‰€ç”¨åˆ°çš„ï¼Œå…¨éƒ¨ç½‘ç«™æˆ–APPï¼Œä¸ç®—å¤šä½†åŸºæœ¬æœ‰ç‚¹ç”¨ã€‚</p><h3 id="å†™åœ¨æœ€å"><strong>å†™åœ¨æœ€å</strong></h3><p>ç¢ç¢å¿µåˆå†™äº†å°å‡ Kå­—äº†ï¼Œ9æœˆåº•ç»“æŸç§‹æ‹›æ—¶ï¼Œä¾¿æƒ³ç€æŠŠè‡ªå·±æ±‚èŒçš„ç¬”è®°æ€»ç»“&amp;ç»å†å¤ç›˜ã€‚ä¸çŸ¥ä¸è§‰åˆæ‹–å»¶/ç©äº†ä¸¤ä¸ªæœˆï¼Œè¿™ä¸ªæ˜ŸæœŸæŠŠç½‘ç«™æå¥½äº†ä¹Ÿæ­£å¥½é¡ºæ‰‹å¼€å§‹æ•´ç†ã€‚å†™åˆ°è¿™é‡Œï¼Œç»ˆäºæœ‰äº†åˆæ­¥äº†ç»“ï¼Œæ„Ÿè§‰åƒæ˜¯Deä¸€ä¸ªå¤§BUG ğŸ› ï¼Œå¿ƒæƒ…éƒ½èˆ’ç•…äº†èµ·æ¥ã€‚</p><p>åé¢è¿˜ä¼š<strong>ç»§ç»­æ›´æ–°æ²¡å¡«å¥½çš„å‘</strong>ï¼Œe.g. æ€ä¹ˆå‡†å¤‡ä¸€ä¸ªç§‹æ‹›é¡¹ç›®ã€‚ä¹Ÿä¼šå¼€å§‹è®°å½•ä¸€äº›<strong>C++éŸ³è§†é¢‘ç›¸å…³æ–¹å‘åšæ–‡</strong>ï¼Œå’Œä¸€äº›ç”Ÿæ´»è®°å½•ï¼ˆè™½ç„¶å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯æ— èŠåœ°å¾…åœ¨å¯å®¤æˆ–å®¶é‡Œï¼‰ã€‚å½“ç„¶ï¼Œå¦‚æœè¿˜æœ‰ä»€ä¹ˆæƒ³è¦å’Œæˆ‘è¯´çš„ï¼Œå¯ä»¥åœ¨ä¸‹é¢ç•™è¨€ã€‚</p><p>æœ€åï¼Œç»™ä¸Šæˆ‘æœ€è¯šæŒšçš„ç¥ç¦ï¼š</p><div align = "center" style="bold"> <h5>â€œ æ˜å¹´è¯·åŠ¡å¿…å€’æŒ‚æˆ‘ï¼Œè°¢è°¢ã€‚â€</h5></div><h3 id="æ›´æ–°è®°å½•">æ›´æ–°è®°å½•</h3><div class="timeline"><div class="timenode"><div class="meta"><p><p>2021-11-29 ï¼šæ›´æ–°æ–‡æ¡£</p></p></div><div class="body"><ol><li>æ›´æ–°æ ¡æ‹›å¿ƒå¾—è®°å½• &amp; é‡æ–°åˆ†ç±»æ•´ç†ç¬”è®°</li><li>æ”¯æŒè¯„è®ºç³»ç»Ÿ</li></ol></div></div><div class="timenode"><div class="meta"><p><p>2021-11-24 ï¼šç¬¬ä¸€æ¬¡æ›´æ–°</p></p></div><div class="body"><ol><li>ä¸Šä¼ æ‰€æœ‰ç¬”è®°å¹¶å‘å¸ƒ</li></ol></div></div></div> <div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Java Guideï¼šhttps://github.com/Snailclimb/JavaGuide<a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">é˜¿ç§€C++é¢è¯•ç¬”è®°ï¼šhttps://github.com/forthespada/InterviewGuide<a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">ç‰›å®¢ç½‘é¢ç»ï¼šhttps://www.nowcoder.com/interview/center<a href="#fnref:3" rev="footnote"> â†©</a></span></li></ol></div></div>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> ç›®å½• </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitåŸºç¡€ç¬”è®°ï¼ˆåˆæ­¥æ•´ç†ï¼‰</title>
      <link href="/p/43848/"/>
      <url>/p/43848/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="ä¸€ã€Git-ç®€ä»‹">ä¸€ã€Git ç®€ä»‹</h2><h3 id="1-1-å®‰è£…">1.1 å®‰è£…</h3><ul><li><p>å®‰è£…åœ°å€</p><p>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://git-scm.com/downloads">Gitå®˜ç½‘ä¸‹è½½</a></p></li><li><p>è®¾ç½®ç”¨æˆ·ä¿¡æ¯</p><p>ä¸»è¦æ˜¯è®¾ç½® ï¼š åå­— &amp; Email åœ°å€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;hwh&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;380141202@qq.com&quot;</span></span><br></pre></td></tr></table></figure><p><code>git config</code>å‘½ä»¤çš„<code>--global</code>å‚æ•°ï¼Œç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä½ è¿™å°æœºå™¨ä¸Šæ‰€æœ‰çš„Gitä»“åº“éƒ½ä¼šä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¯¹æŸä¸ªä»“åº“æŒ‡å®šä¸åŒçš„ç”¨æˆ·åå’ŒEmailåœ°å€ã€‚</p></li></ul><h3 id="1-2-åˆ›å»ºç‰ˆæœ¬åº“">1.2 åˆ›å»ºç‰ˆæœ¬åº“</h3><ul><li><p>åˆ›å»ºä»“åº“</p><p>â€‹       windowså¯ä»¥ç›´æ¥åœ¨æ¡Œé¢åˆ›å»ºä¸€ä¸ªåä¸ºï¼š&quot;Git&quot;æ–‡ä»¶å¤¹ï¼Œä¸‹æœ‰â€œtestâ€å­æ–‡ä»¶å¤¹ï¼Œå­æ–‡ä»¶å¤¹å«æœ‰ä¸€ä¸ªåä¸ºâ€œ<a href="http://readme.md">readme.md</a>â€æ–‡ä»¶ã€‚</p><p>â€‹       ç„¶ååˆ‡æ¢åˆ°å…¶ç›®å½•ä¸‹ï¼ˆè¿™é‡Œåˆ‡æ¢çš„æ˜¯&quot;Git&quot;æ–‡ä»¶å¤¹ï¼Œè€Œéâ€œtestâ€å­æ–‡ä»¶å¤¹ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> Git/</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/c/Users/86151/Desktop/Git</span><br></pre></td></tr></table></figure></li><li><p>åˆæ­¥æäº¤è¿‡ç¨‹</p><ul><li><p>åˆå§‹åŒ–ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /Users/michael/learngit/.git/</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ä»“åº“æ–‡ä»¶</p><p>å°†â€œtestâ€å­æ–‡ä»¶å¤¹ï¼Œä¸‹readme.mdæ–‡ä»¶ï¼Œå¢åŠ å†…å®¹ã€‚</p></li><li><p>æ·»åŠ æ–‡ä»¶åˆ°ä»“åº“</p><p>æ³¨æ„ï¼šå¯ä»¥åŒæ—¶ ä¸€æ¬¡æ·»åŠ <strong>å¤šä¸ª</strong>æ–‡ä»¶åˆ°ä»“åº“ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure></li><li><p>æäº¤æ–‡ä»¶</p><p>å¯ä»¥å¢åŠ må‚æ•°ï¼šæ·»åŠ ä¿®æ”¹ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">&#x27;ç¬¬ä¸€æ¬¡æ–‡ä»¶æ”¹åŠ¨&#x27;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="äºŒã€æ—¶å…‰æœºç©¿æ¢­">äºŒã€æ—¶å…‰æœºç©¿æ¢­</h2><h3 id="2-0-æ›´å¤šæ§åˆ¶ä¿®æ”¹æäº¤">2.0 æ›´å¤šæ§åˆ¶ä¿®æ”¹æäº¤</h3><ul><li><p>æ¦‚è§ˆ</p><ul><li>è¦éšæ—¶æŒæ¡å·¥ä½œåŒºçš„çŠ¶æ€ï¼Œä½¿ç”¨<code>git status</code>å‘½ä»¤ã€‚</li><li>å¦‚æœ<code>git status</code>å‘Šè¯‰ä½ æœ‰æ–‡ä»¶è¢«ä¿®æ”¹è¿‡ï¼Œç”¨<code>git diff &lt;filepath&gt;</code>å¯ä»¥æŸ¥çœ‹ä¿®æ”¹å†…å®¹ã€‚</li></ul></li><li><p>å®æ“</p><ul><li><p>å†æ¬¡ä¿®æ”¹æ–‡ä»¶</p><p>å¯ä»¥å…ˆæ¸…é™¤åŸæ–‡ä»¶ï¼Œå†å¢æ·»readme.mdæ–‡æ¡£å†…å®¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â€œi am  huitailang , here  is my first test word .â€œ</span><br><span class="line"></span><br><span class="line"> â€œè¿™æ˜¯æˆ‘ç¬¬äºŒæ¬¡ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶â€</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>git status</code>ï¼ŒæŸ¥çœ‹çŠ¶æ€å‘ç°readme.mdæ–‡ä»¶å·²è¢«ä¿®æ”¹ä½†æœªæäº¤ï¼ˆ<strong>no changes</strong>ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560766427962.png" alt="1560766427962"></p></li><li><p>æŸ¥çœ‹å…·ä½“ä¿®æ”¹äº†ä»€ä¹ˆå†…å®¹</p><p><code>git diff &lt;filepath&gt;</code>æŸ¥çœ‹æ–‡ä»¶å…·ä½“ä¿®æ”¹ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560766437006.png" alt="1560766437006"></p></li><li><p>æ·»åŠ ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure><p>åŒæ—¶å¯ç”¨ <code>git status</code>ï¼ŒæŸ¥çœ‹æ­¤æ—¶çŠ¶æ€ä¼šæ˜¾ç¤ºï¼Œreadme.mdå°†è¦è¢«æäº¤ä¿®æ”¹ã€‚</p></li><li><p>æäº¤ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">&quot;è¿™æ˜¯æˆ‘ç¬¬äºŒæ¬¡ä¿®æ”¹&quot;</span></span><br></pre></td></tr></table></figure><p>â€‹     å†ç”¨ <code>git status</code>ï¼ŒæŸ¥çœ‹ä»“åº“å½“å‰çŠ¶æ€ï¼Œæ˜¾ç¤ºæ²¡æœ‰éœ€è¦æäº¤çš„ä¿®æ”¹ï¼Œè€Œä¸”å·¥ä½œç›®å½•æ˜¯å¹²å‡€çš„ï¼ˆworking tree cleanï¼‰ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560766449576.png" alt="1560766449576"></p></li></ul></li></ul><h3 id="2-1-ç‰ˆæœ¬å›é€€">2.1 ç‰ˆæœ¬å›é€€</h3><ul><li><p>æ¦‚è§ˆ</p><ul><li><code>HEAD</code>æŒ‡å‘çš„ç‰ˆæœ¬å°±æ˜¯å½“å‰ç‰ˆæœ¬ï¼Œå› æ­¤ï¼ŒGitå…è®¸æˆ‘ä»¬åœ¨ç‰ˆæœ¬çš„å†å²ä¹‹é—´ç©¿æ¢­ï¼Œä½¿ç”¨å‘½ä»¤<code>git reset --hard commit_id</code>ã€‚</li><li>ç©¿æ¢­å‰ï¼Œç”¨<code>git log</code>å¯ä»¥æŸ¥çœ‹æäº¤å†å²ï¼Œä»¥ä¾¿ç¡®å®šè¦å›é€€åˆ°å“ªä¸ªç‰ˆæœ¬ã€‚</li><li>è¦é‡è¿”æœªæ¥ï¼Œç”¨<code>git reflog</code>æŸ¥çœ‹å‘½ä»¤å†å²ï¼Œä»¥ä¾¿ç¡®å®šè¦å›åˆ°æœªæ¥çš„å“ªä¸ªç‰ˆæœ¬</li></ul></li><li><p>å®æ“</p><ul><li><p>Næ¬¡ä¿®æ”¹æ–‡ä»¶</p><p>å…ˆå¤šä¿®æ”¹å‡ æ¬¡æ–‡ä»¶æäº¤ï¼Œå¾—åˆ°å¤šä¸ªç‰ˆæœ¬ã€‚</p></li><li><p>ç‰ˆæœ¬å›é€€</p><ul><li><p>æŸ¥çœ‹ç‰ˆæœ¬å†å²</p><p><code>git log </code>æŸ¥çœ‹å½“å‰ç‰ˆæœ¬å’Œä¹‹å‰çš„å†å²ï¼Œ<code>git relog</code> æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬å†å²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span>  <span class="comment"># å¯ä»¥åŠ ä¸Š --pretty=oneline å‚æ•°ä½¿æ˜¾ç¤ºæ›´ç®€æ´</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560778515569.png" alt="1560778515569"></p></li></ul></li><li><p>å›é€€ç‰ˆæœ¬</p><p><code>git reset --hard &lt;æŒ‡å®šç‰ˆæœ¬&gt;</code>ï¼šå¯ç”¨äºå›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼Œ&lt;<strong>æŒ‡å®šç‰ˆæœ¬</strong>&gt;æ–¹å¼ï¼š</p><ul><li><p>HEAD ^</p><p>HEAD ^ å›åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼›HEAD ^ ^  å›åˆ°ä¸Šä¸Š ä¸ªç‰ˆæœ¬ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard HEAD^^  <span class="comment"># å›åˆ°ä¸Šä¸Šä¸ªç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560779037449.png" alt="1560779037449"></p></li><li><p>HEAD~&lt;æ•°å­—&gt;</p><p>å›åˆ°å‰&lt;æ•°å­—&gt;ç‰ˆæœ¬ã€‚å¦‚HEAD~100ï¼Œå›åˆ°å‰100ä¸ªç‰ˆæœ¬ã€‚</p></li><li><p><commit ID> :</p><p>commit ID ä¸ç”¨æ‰“å…¨ï¼Œä¸€èˆ¬æ‰“å‰é¢å‡ ä¸ªå­—ç¬¦å³å¯ã€‚å¦‚ï¼Œå¦‚æœå›é€€ç¬¬2ç‰ˆæœ¬ï¼Œ<code>git log</code>ï¼Œåªèƒ½çœ‹åˆ°ç¬¬2ç‰ˆæœ¬åŠä¹‹å‰çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚é‚£ä¹ˆå¯ç”¨ <code>git reflog</code>æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬IDï¼Œç„¶åæŒ‡å®šIDï¼Œå›åˆ°ç¬¬4ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560779323726.png" alt="1560779323726"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard 3928d   <span class="comment"># å†æ¬¡å›åˆ°ç¬¬å››æ¬¡ä¿®æ”¹ç‰ˆæœ¬</span></span><br><span class="line">HEAD is now at 3928d9f ç¬¬å››æ¬¡ä¿®æ”¹</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h3 id="2-2-å·¥ä½œåŒºå’Œæš‚å­˜åŒº">2.2 å·¥ä½œåŒºå’Œæš‚å­˜åŒº</h3><ul><li><p>æ¦‚è§ˆ</p><ul><li>ç†è§£å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„åŒºåˆ«ï¼Œæš‚å­˜åŒºæ˜¯ç‰ˆæœ¬åº“çš„ä¸€ä¸ªå­é›†</li><li>æ¯”è¾ƒæ–‡ä»¶æœ‰ä¸‰ä¸ªä¸åŒå‘½ä»¤<ul><li>git diff   <filename></li><li>git diff  --cached <filename></li><li>git diff  --HEAD <filename></li></ul></li></ul></li><li><p>å·¥ä½œåŒº</p><p>å·¥ä½œåŒºå°±æ˜¯æˆ‘ä»¬èƒ½çœ‹åˆ°çš„ç›®å½•ï¼Œå¦‚æˆ‘å‰é¢åˆ›å»ºçš„<code>Git</code>æ–‡ä»¶å¤¹å°±æ˜¯ä¸€ä¸ªå·¥ä½œåŒº</p></li><li><p>ç‰ˆæœ¬åº“ &amp; æš‚å­˜åŒº</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-repo"></p><p>å·¥ä½œåŒºæœ‰ä¸€ä¸ªéšè—ç›®å½•<code>.git</code>ï¼Œä¸å±äºå·¥ä½œåŒºè€Œæ˜¯Gitç‰ˆæœ¬åº“ï¼Œç‰ˆæœ¬åº“åŒ…å«</p><ul><li><p>Gitè‡ªåŠ¨åˆ›å»ºçš„åˆ†æ”¯<code>master</code>&amp;æŒ‡å‘<code>master</code>çš„æŒ‡é’ˆ<code>HEAD</code></p></li><li><p>stageï¼ˆæˆ–å«indexï¼‰æš‚å­˜åŒº</p></li></ul></li><li><p>æš‚å­˜åŒºå·¥ä½œ</p><ul><li><p><strong>git add</strong></p><p>è¿™ä¸€æ­¥å®é™…ä¸Šå°±æ˜¯æŠŠæ–‡ä»¶ä¿®æ”¹ï¼ˆå·²å­˜åœ¨è¢«ä¿®æ”¹ OR æ–°æ–‡ä»¶ï¼‰æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå¯ä»¥addå¤šä¸ªæ–‡ä»¶ï¼Œä¸€æ¬¡è¢«æäº¤ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-stage"></p></li><li><p><strong>git commit</strong></p><p>æŠŠæš‚å­˜åŒºçš„<strong>æ‰€æœ‰</strong>å†…å®¹æäº¤åˆ°å½“å‰åˆ†æ”¯ã€‚</p><p>ä½†æ˜¯æ³¨æ„ï¼Œgit commit å<strong>æš‚å­˜åŒºæ–‡ä»¶ä¸ä¼šæ¶ˆå¤±</strong>ï¼Œå§‹ç»ˆæ˜¯ä¸Šä¸€æ¬¡git addä¹‹åæ–‡ä»¶ï¼</p></li><li><p><strong>git diff</strong>  &amp;<strong>git diff --cached</strong> &amp;<strong>git diff HEAD</strong></p><p>git diff  æ¯”è¾ƒçš„æ˜¯<strong>å·¥ä½œåŒºæ–‡ä»¶å’Œæš‚å­˜åŒºæ–‡ä»¶</strong>åŒºåˆ«ã€‚</p><p>git diff --cached æ¯”è¾ƒçš„æ˜¯<strong>æš‚å­˜åŒºæ–‡ä»¶å’Œä»“åº“åˆ†æ”¯æ–‡ä»¶</strong>åŒºåˆ«ã€‚</p><p>git diff --HEAD æ¯”è¾ƒçš„æ˜¯<strong>å·¥ä½œåŒºæ–‡ä»¶å’Œä»“åº“åˆ†æ”¯æœ€æ–°ç‰ˆæœ¬</strong>åŒºåˆ«ã€‚</p><ul><li><p>æš‚å­˜åŒºï¼šå°±æ˜¯ .git / index è¿™ä¸ªæ–‡ä»¶ï¼Œgit add ä¼šæŠŠå·¥ä½œåŒºä¿®æ”¹çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå³ä½¿ git commit åä¹Ÿä¸ä¼šç©ºï¼Œ<strong>å§‹ç»ˆä¿å­˜æœ€è¿‘ä¸€æ¬¡ git addåçš„å†…å®¹</strong>ã€‚</p></li><li><p>ä»“åº“åˆ†æ”¯ï¼š<strong>å§‹ç»ˆä¿å­˜ä¸Šæ¬¡git commit å†…å®¹</strong>ã€‚</p></li></ul></li></ul></li></ul><h3 id="2-3-ç®¡ç†ä¿®æ”¹">2.3 ç®¡ç†ä¿®æ”¹</h3><ul><li><p>æ¦‚è§ˆ</p><ul><li>gitç®¡ç†çš„æ˜¯ä¿®æ”¹ï¼Œè€Œéæ–‡ä»¶</li></ul></li><li><p>å®æ“</p><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶ readme1.txtï¼Œç„¶åä¾æ¬¡ï¼š</p><blockquote><p>ç¬¬ä¸€æ¬¡ä¿®æ”¹ -&gt; <code>git add</code> -&gt; ç¬¬äºŒæ¬¡ä¿®æ”¹ -&gt; <code>git commit</code></p></blockquote><p>â€‹      ç”¨<code>git diff HEAD test/readme1.txt</code> æ¯”è¾ƒ<strong>å·¥ä½œåŒºå’Œç‰ˆæœ¬åˆ†æ”¯</strong>ï¼Œä¼šå‘ç°ç¬¬äºŒæ¬¡ä¿®æ”¹æ²¡æœ‰è¢«æäº¤ï¼Œè¯´æ˜gitåªæŠŠgit addåæš‚å­˜åŒºå†…å®¹æäº¤äº†ï¼Œè€Œä¸ç®¡ç†æ–‡ä»¶ã€‚</p><p>å¦‚æœè¦æŠŠç¬¬äºŒæ¬¡ä¿®æ”¹ä¹Ÿæäº¤äº†ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><blockquote><p>ç¬¬ä¸€æ¬¡ä¿®æ”¹ -&gt; <code>git add</code> -&gt; ç¬¬äºŒæ¬¡ä¿®æ”¹-&gt; <code>git add</code>  -&gt; <code>git commit</code></p></blockquote></li></ul><h3 id="2-4-æ’¤é”€ä¿®æ”¹">2.4 æ’¤é”€ä¿®æ”¹</h3><ul><li><p>æ¦‚è§ˆ</p><ul><li><p>åœºæ™¯1ï¼šæ”¹ä¹±äº†å·¥ä½œåŒºæŸä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæƒ³ç›´æ¥ä¸¢å¼ƒå·¥ä½œåŒºçš„ä¿®æ”¹æ—¶</p><p>ç”¨å‘½ä»¤<code>git checkout -- file</code>ã€‚</p></li><li><p>åœºæ™¯2ï¼šä¸ä½†æ”¹ä¹±äº†å·¥ä½œåŒºæŸä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œè¿˜æ·»åŠ åˆ°äº†æš‚å­˜åŒºæ—¶ï¼Œæƒ³ä¸¢å¼ƒä¿®æ”¹</p><ul><li>ç¬¬ä¸€æ­¥ç”¨å‘½ä»¤<code>git reset HEAD &lt;file&gt;</code>ï¼Œå°±å›åˆ°äº†åœºæ™¯1</li><li>ç¬¬äºŒæ­¥æŒ‰åœºæ™¯1æ“ä½œã€‚</li></ul></li><li><p>åœºæ™¯3ï¼šå·²ç»æäº¤äº†ä¸åˆé€‚çš„ä¿®æ”¹åˆ°ç‰ˆæœ¬åº“æ—¶ï¼Œæƒ³è¦æ’¤é”€æœ¬æ¬¡æäº¤</p><p>å‚è€ƒ<a href="https://www.liaoxuefeng.com/wiki/896043488029600/897013573512192">ç‰ˆæœ¬å›é€€</a>ä¸€èŠ‚ï¼Œä¸è¿‡å‰ææ˜¯æ²¡æœ‰æ¨é€åˆ°è¿œç¨‹åº“ã€‚</p></li></ul></li><li><p>å®æ“</p><ul><li><p>åœºæ™¯1</p><p>ä¸å°å¿ƒåœ¨æ–‡ä»¶é‡Œå¢åŠ äº†ä¸€å¥è¯ï¼š</p><blockquote><p>åˆ˜å©·æ˜¯å‚»å­</p></blockquote><p>ç”¨ <code>git checkout</code>å‘½ä»¤æ’¤å›å·¥ä½œåŒºä¿®æ”¹ï¼Œæœ‰ä¸¤ç§æƒ…å†µ</p><ul><li><code>readme.txt</code>ä¿®æ”¹ä½†æœªè¢«æ”¾åˆ°æš‚å­˜åŒºï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°å’Œç‰ˆæœ¬åº“ä¸€æ ·çŠ¶æ€ï¼›</li><li><code>readme.txt</code>ä¿®æ”¹ä¸”æ·»åŠ åˆ°æš‚å­˜åŒºåï¼Œæ’¤é”€ä¿®æ”¹å°±å›åˆ°æ·»åŠ åˆ°æš‚å­˜åŒºåçš„çŠ¶æ€ã€‚</li></ul><blockquote><p>âš ï¸ æ€»ä¹‹ï¼Œå°±æ˜¯è®©æ–‡ä»¶å›åˆ°æœ€è¿‘ä¸€æ¬¡<code>git commit</code>æˆ–<code>git add</code>æ—¶çš„çŠ¶æ€ã€‚</p><p>ğŸ•µæ‰€ä»¥ï¼Œä¹Ÿå¯ç”¨äºæ¢å¤è¯¯åˆ çš„æ–‡ä»¶ï¼ˆæ’¤é”€å·¥ä½œåŒºåˆ é™¤æ“ä½œï¼‰</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560826918878.png" alt="1560826918878"></p></li><li><p>åœºæ™¯2</p><p>ä¸å°å¿ƒåœ¨æ–‡ä»¶é‡Œå¢åŠ äº†ä¸€å¥è¯ï¼Œè€Œä¸”å·²ç»git addæäº¤åˆ°æš‚å­˜åŒº</p><blockquote><p>åˆ˜å©·æ˜¯å‚»å­å“ˆå“ˆå“ˆ</p></blockquote><p>å‘½ä»¤<code>git reset </code><strong>ä¸ä»…å¯ä»¥å›é€€ç‰ˆæœ¬ è€Œä¸”å¯ä»¥æŠŠæš‚å­˜åŒºçš„ä¿®æ”¹æ’¤é”€</strong>ã€‚</p><p>âš ï¸ä¹‹æ‰€ä»¥ä¸ç›´æ¥ git checkout æ˜¯å› ä¸ºæ­¤æ—¶ä¼šç”¨<strong>æš‚å­˜åŒºå†…å®¹è¦†ç›–å·¥ä½œåŒº</strong>ï¼Œæ˜¾ç„¶ä¸è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD <span class="built_in">test</span>/readme.md <span class="comment"># HEADè¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ­¤æ—¶å†ç”¨git checkout ï¼Œæš‚å­˜åŒºå†…å®¹è¦†ç›–å·¥ä½œåŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹æ–‡ä»¶å‘ç°ï¼Œâ€˜â€™åˆ˜å©·æ˜¯å‚»å­å“ˆå“ˆå“ˆâ€˜â€™ çš„èƒ¡è¯å·²ç»è¢«æ²¡äº†ï¼Œæš‚å­˜åŒºä¹Ÿæ²¡äº†ã€‚</p></li><li><p>åœºæ™¯3</p><p>åˆè¯´èƒ¡è¯ï¼Œä¸ä½† git add ä¸”git  commitï¼ˆæš‚å­˜åŒºå’Œç‰ˆæœ¬åº“<strong>HEAD</strong>éƒ½æ˜¯ä¿®æ”¹åç‰ˆæœ¬ï¼‰</p><blockquote><p>åˆ˜å©·æ˜¯å‚»å­å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ</p></blockquote><p>è¿™ä¸ªæ—¶å€™åªæœ‰å›é€€ç‰ˆæœ¬äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog  <span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬å·</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard  3928</span><br><span class="line">HEAD is now at 3928d9f ç¬¬å››æ¬¡ä¿®æ”¹</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="2-5-åˆ é™¤æ–‡ä»¶">2.5 åˆ é™¤æ–‡ä»¶</h3><ul><li><p>rm åˆ é™¤</p><ul><li><p>åŸç†</p><p>rm åˆ é™¤æ–‡ä»¶ï¼Œåªç›¸å½“äºåˆ é™¤äº† å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¦‚æœè¦æ¢å¤æ–‡ä»¶æ’¤é”€å·¥ä½œåŒºä¿®æ”¹å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure></li><li><p>æ¢å¤</p><p>ç”¨<code>git checkout -- &lt;file&gt;</code>ï¼Œå®ƒä¼šç”¨æœ€æ–°ç‰ˆæœ¬åº“æ–‡ä»¶ï¼ˆå¦‚æœå·²ç»git add ç”¨æœ€æ–°æš‚å­˜åŒºå†…å®¹ï¼Œè§å‰ï¼‰è¦†ç›–å·¥ä½œåŒºæ–‡ä»¶ï¼Œåˆ™ç›¸å½“äºæ’¤é”€å·¥ä½œåŒºä¿®æ”¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure></li></ul></li><li><p>git rm åˆ é™¤</p><ul><li><p>åŸç†</p><p>git rm åˆ é™¤æ–‡ä»¶ï¼Œä¸ä½†ç›¸å½“äº<strong>åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ &amp;  è€Œä¸”git addæ·»åŠ åˆ°æš‚å­˜åŒº</strong>ã€‚</p><p>æ‰€ä»¥æ­¤æ—¶ç›´æ¥<code>git checkout </code>æ˜¯ç”¨æš‚å­˜åŒºå†…å®¹è¦†ç›– å·¥ä½œåŒºï¼Œæ˜¾ç„¶æ˜¯æ²¡ç”¨çš„ã€‚</p></li><li><p>æ¢å¤</p><ul><li><p>å…ˆæ¢å¤æš‚å­˜åŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD <span class="built_in">test</span>/readme.md <span class="comment"># HEADè¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure></li><li><p>å†ç”¨æš‚å­˜åŒºè¦†ç›–å·¥ä½œåŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- <span class="built_in">test</span>/readme.md</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å½»åº•åˆ é™¤</p><p>å¦‚å‰æ‰€è¿°ï¼Œgit rm å·²ç»åˆ é™¤äº† â‘ å·¥ä½œåŒºæ–‡ä»¶ â‘¡ æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œé‚£ä¹ˆæ­¤æ—¶åªéœ€è¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --m <span class="string">&#x27;å½»åº•åˆ é™¤&#x27;</span>  <span class="comment"># å°†â‘¢ç‰ˆæœ¬åº“å†…å®¹ä¹Ÿä¿®æ”¹</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ–‡ä»¶å°±ä¼šä»å·¥ä½œåŒºã€æš‚å­˜åŒºã€ç‰ˆæœ¬åº“å…¨éƒ¨åˆ é™¤ã€‚</p></li><li><p>å½»åº•åˆ é™¤æ¢å¤</p><p>å¦‚æœå·²ç»commitï¼Œé‚£ä¹ˆåªèƒ½<code>git reset</code>å›é€€ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard  3928</span><br><span class="line">HEAD is now at 3928d9f ç¬¬å››æ¬¡ä¿®æ”¹</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="ä¸‰ã€è¿œç¨‹ä»“åº“">ä¸‰ã€è¿œç¨‹ä»“åº“</h2><h3 id="3-1-æ·»åŠ è¿œç¨‹åº“ä¸Šä¼ æœ¬åœ°æ–‡ä»¶">3.1 æ·»åŠ è¿œç¨‹åº“ä¸Šä¼ æœ¬åœ°æ–‡ä»¶</h3><blockquote><p>ä»¥ä¸‹æ“ä½œåŸºäºé»˜è®¤ä½ </p><ul><li>åˆ›å»ºå¥½ github è´¦å· &amp; åˆ›å»ºå¥½ä¸€ä¸ªä»“åº“</li><li>è®¾ç½®å¥½æœ¬åœ°ssh -key è€Œä¸”å·²ç»åŒæ—¶åœ¨githubç½‘é¡µæœåŠ¡ç«¯è´¦å·è®¾ç½®é‡Œæ·»åŠ  ssh -key</li></ul></blockquote><ol><li><p>æ·»åŠ ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;hwh&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;380141202@qq.com&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</p><blockquote><p>å¦‚æœæœ¬åœ°ä»“åº“ä»æœªè¢«åˆå§‹åŒ–æ‰éœ€è¦ï¼Œåˆå§‹åŒ–ä¼šåˆ›å»ºä¸€ä¸ªéšè—çš„ .git æ–‡ä»¶ç®¡ç†ç‰ˆæœ¬ã€‚</p></blockquote><ul><li><p>cdåˆ‡æ¢ + git init</p><p>cdå‘½ä»¤åˆ‡æ¢åˆ°åæœ¬åœ°ä»“åº“ï¼›</p><p>git init åˆå§‹åŒ–æœ¬åœ°ä»“åº“ï¼Œä¼šä¸ºä½ åˆ›å»ºä¸€ä¸ª .gitæ–‡ä»¶ï¼Œå·²ç»åˆå§‹åŒ–ä¸ç”¨ã€‚</p></li><li><p>æ‰‹åŠ¨ bash</p><blockquote><p>âš ï¸ å¾ˆå¥‡æ€ªçš„æ˜¯ï¼Œè¿™æ · git add . --&gt; git commit --&gt; git pushåï¼Œä¼šæŠŠæ•´ä¸ªçˆ¶æ–‡ä»¶å¤¹æ¨é€ä¸Šå»ã€‚</p><p>æ¯”å¦‚ï¼šåœ°å€ TEST æ–‡ä»¶å¤¹ä¸‹æœ‰ <a href="http://README.md">README.md</a> ï¼Œæ¨é€ågithubä¸Šæ˜¾ç¤ºçš„ TESTæ–‡ä»¶å¤¹ï¼Œè€Œä¸æ˜¯æˆ‘æƒ³çš„README.mdæ–‡ä»¶ã€‚</p></blockquote><p>å³å‡»æœ¬åœ°ä»“åº“ï¼Œé€‰æ‹©<code>Git Bash here</code></p></li></ul></li><li><p>æŠŠæœ¬åœ°ä»“åº“æ·»åŠ åˆ°ç‰ˆæœ¬åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add .  <span class="comment"># add . æäº¤æ‰€æœ‰æ–°å»ºã€ä¿®æ”¹æ–‡ä»¶</span></span><br><span class="line">$ git commit -m <span class="string">&#x27;ç¬¬ä¸€æ¬¡æ·»åŠ æœ¬åœ°ä»“åº“åˆ°ç‰ˆæœ¬åº“&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°ä»“åº“å…³è”è¿œç¨‹åº“</p><p><code>git remote add &lt;è¿œç¨‹åº“åè®¾ç½®&gt;  &lt;è¿œç¨‹ä»“åº“åœ°å€&gt;</code></p><p>æ˜¾ç„¶è¿™é‡ŒæŠŠ<strong>è¿œç¨‹ä»“åº“åœ°å€è®¾ç½®ä¸º origin</strong>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:huangwanghuiYY/gitTest.git</span><br></pre></td></tr></table></figure></li><li><p>æ¨é€åˆ°è¿œç¨‹åº“</p><p>ä¸‹é¢ä»£ç è¡¨ç¤ºï¼šå°†æœ¬åœ°<code>master</code>åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“<code>origin</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u origin master  <span class="comment"># ç¬¬ä¸€æ¬¡æ¨é€å¸¦ -u å‚æ•°</span></span><br></pre></td></tr></table></figure><p><code>-u</code>é€‰é¡¹æŒ‡å®šä¸€ä¸ªé»˜è®¤ä¸»æœºï¼Œè¿™æ ·åé¢å°±å¯ä»¥ä¸åŠ ä»»ä½•å‚æ•°ä½¿ç”¨<code>git push</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push origin master</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="3-2-ä»è¿œç¨‹åº“å…‹éš†">3.2 ä»è¿œç¨‹åº“å…‹éš†</h3><blockquote><p>â€‹       å½“æˆ‘ä»¬æƒ³å¤šäººåä½œæ—¶ä¼šç”¨åˆ°å…‹éš†ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªä¸é”™çš„å¼€æºé¡¹ç›®ï¼Œä½ å¯ä»¥å…‹éš†åˆ°<code>æœ¬åœ°ä»“åº“</code>è¿›è¡Œä¿®æ”¹ç­‰ã€‚</p></blockquote><ol><li><p>ç¡®å®šè¦å…‹éš†çš„ä»“åº“</p><p>æ¯”å¦‚æˆ‘çš„XSurveyé¡¹ç›®ã€‚</p></li><li><p>git clone è¿›è¡Œå…‹éš†</p><p>å…‹éš†ä¼šåœ¨<code>å½“å‰æ–‡ä»¶å¤¹</code>åˆ›å»ºå…‹éš†çš„ä»“åº“ï¼Œå…‹éš†ä»“åº“ä»¥XSueryä¸ºåï¼Œä¸‹å«é¡¹ç›®æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:huangwanghuiYY/XSurvey.git</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560943024969.png" alt="1560943024969"></p></li></ol><h2 id="å››ã€åˆ†æ”¯ç®¡ç†">å››ã€åˆ†æ”¯ç®¡ç†</h2><h3 id="4-1-åˆ›å»ºå’Œåˆå¹¶åˆ†æ”¯">4.1 åˆ›å»ºå’Œåˆå¹¶åˆ†æ”¯</h3><blockquote><p>è¿™ä¸€èŠ‚ï¼Œæ¶‰åŠå¤§é‡å›¾å½¢ï¼Œ<a href="https://www.liaoxuefeng.com/wiki/896043488029600/900003767775424">å»–é›ªå³°æ•™ç¨‹</a>  è®²çš„å¾ˆå¥½ï¼Œè¿™é‡Œå°½é‡ç²¾ç®€è®°å½•å¿ƒå¾—ã€‚</p></blockquote><ul><li><p>æ¦‚è¿°</p><ul><li><p>æŸ¥çœ‹åˆ†æ”¯ï¼š<code>git branch</code></p></li><li><p>åˆ›å»ºåˆ†æ”¯ï¼š<code>git branch &lt;name&gt;</code></p></li><li><p>åˆ‡æ¢åˆ†æ”¯ï¼š<code>git checkout &lt;name&gt;</code></p></li><li><p>åˆ›å»º+åˆ‡æ¢åˆ†æ”¯ï¼š<code>git checkout -b &lt;name&gt;</code></p></li><li><p>åˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼š<code>git merge &lt;name&gt;</code></p></li><li><p>åˆ é™¤åˆ†æ”¯ï¼š<code>git branch -d &lt;name&gt;</code></p></li></ul></li><li><p>å®æ“è®°å½•</p><ul><li><p>ä¸»åˆ†æ”¯</p><p>â€‹       <code>master</code>åˆ†æ”¯ä¹Ÿæ˜¯ä¸€æ¡æ—¶é—´çº¿ï¼Œæ¯æ¬¡<strong>æäº¤</strong> master åˆ†æ”¯éƒ½ä¼šå‘å‰ç§»åŠ¨ä¸€æ­¥ï¼Œéšç€ä¸æ–­æäº¤ masteråˆ†æ”¯ä¹Ÿå°±è¶Šé•¿ã€‚</p><p>âš ï¸ä¸‹å›¾æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼š<code>HEAD</code> &amp; <code>master</code> ï¼Œ<code>HEAD</code>ä¸¥æ ¼æ¥è¯´ä¸æ˜¯æŒ‡å‘æäº¤ã€‚HEADæŒ‡å‘masterï¼ŒmasteræŒ‡å‘æœ€æ–°åˆ†æ”¯ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-br-initial"></p></li><li><p>æ–°åˆ†æ”¯åˆ›å»ºåˆ‡æ¢</p><ul><li><p>åˆ›å»ºæ–°åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git branch dev1   <span class="comment"># æ–°å»ºåˆ†æ”¯</span></span><br><span class="line">$ git branch        <span class="comment"># æŸ¥çœ‹åˆ†æ”¯</span></span><br><span class="line">  dev1</span><br><span class="line">* master           <span class="comment"># * è¡¨ç¤ºå½“å‰æ‰€åœ¨çš„åˆ†æ”¯ï¼ˆmasterï¼‰</span></span><br></pre></td></tr></table></figure><p>â€‹     å½“æˆ‘ä»¬åˆ›å»ºæ–°çš„åˆ†æ”¯ï¼Œä¾‹å¦‚<code>dev</code>æ—¶ï¼ŒGitæ–°å»ºäº†ä¸€ä¸ªæŒ‡é’ˆå«<code>dev</code>ï¼ŒæŒ‡å‘<code>master</code>æŒ‡å‘çš„æäº¤ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1560997582503.png" alt="1560997582503"></p></li><li><p>åˆ‡æ¢åˆ°å½“å‰åˆ†æ”¯</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b dev1</span><br></pre></td></tr></table></figure><p>å¦‚æœcheckout åŠ ä¸Š -bå‚æ•°ï¼Œè¡¨ç¤º åˆ›å»º &amp; åˆ‡æ¢ä¸¤ä¸ªæ“ä½œ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout dev1</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ°å½“å‰åˆ†æ”¯ï¼Œå…¶å®æŠŠheadæŒ‡å‘masteræ‰€æŒ‡å‘çš„æäº¤ã€‚</p><p>âš ï¸è¿™å¼ å›¾ï¼Œè¿˜è¡¨ç¤ºdevåˆ†æ”¯è¿˜æ‰§è¡Œäº†<strong>ä¸€æ¬¡æäº¤</strong>ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-br-dev-fd"></p></li></ul></li><li><p>åˆå¹¶åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master  <span class="comment"># å…ˆåˆ‡å›masteråˆ†æ”¯ï¼ˆå³HEADæŒ‡å‘masterï¼‰</span></span><br><span class="line">$ git merge dev1   <span class="comment"># è¡¨ç¤ºå½“å‰åˆ†æ”¯ï¼ˆmasterï¼‰åˆå¹¶ dev1åˆ†æ”¯</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><p>â€‹      <code>dev</code>åˆ†æ”¯å‘å‰èµ°äº†ä¸€æ­¥ï¼Œ<code>dev</code>æŒ‡å‘äº†<strong>å½“å‰æœ€æ–°</strong>æäº¤ï¼Œè€Œ<code>master</code>æŒ‡é’ˆä¾ç„¶æŒ‡å‘<strong>ä¸Šæ¬¡</strong>æäº¤ã€‚</p><p>â€‹      å¦‚æœè¦åˆå¹¶ï¼Œé‚£ä¹ˆç›´æ¥<strong>è®©<code>master</code>æŒ‡å‘<code>dev</code>æŒ‡å‘çš„å½“å‰æäº¤</strong> ã€‚ç›¸å½“äºï¼Œmasterä¹Ÿæäº¤è¿‡ä¸€æ¬¡ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-br-ff-merge"></p></li><li><p>åˆ é™¤åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d dev</span><br><span class="line">Deleted branch dev (was b17d20e).</span><br></pre></td></tr></table></figure><p>â€‹     åˆ é™¤åˆ†æ”¯ï¼Œç­‰ä»·äºåˆ é™¤åˆ›å»ºåˆ†æ”¯åçš„æäº¤è®°å½•ï¼ˆä¸Šå›¾çº¢è‰²çº¿ï¼‰ï¼Œä½†ç”±äºmasteræŒ‡å‘äº†æœ€æ–°æäº¤ï¼Œç­‰ä»·å¤åˆ¶dev1çš„æäº¤è®°å½•ï¼ˆè“è‰²çº¿ï¼‰ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-br-rm"></p><p>â€‹</p></li></ul></li></ul><h3 id="4-2-è§£å†³åŒæ—¶ä¿®æ”¹å†²çª">4.2 è§£å†³åŒæ—¶ä¿®æ”¹å†²çª</h3><ul><li><p>äº§ç”Ÿå†²çªåŸå› </p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561001334904.png" alt="1561001334904"></p><ul><li><p>åœ¨masteråˆ†æ”¯ä¸Š</p><ul><li><p>åœ¨å½“å‰<code>master</code>åˆ†æ”¯ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯  <code>dev2</code></p></li><li><p>åŒæ—¶masteråˆ†æ”¯ä¸Šï¼Œå¯¹README.mdæ–‡ä»¶å¢åŠ ä¸€å¥è¯</p><blockquote><p>i said master</p></blockquote></li><li><p>âš ï¸ ç„¶åï¼Œ<code>git add  --&gt; git commit</code></p></li></ul></li><li><p>åœ¨dev2åˆ†æ”¯ä¸Š</p><ul><li><p>checkoutåˆ‡å›masteråˆ†æ”¯ä¸Šï¼Œå¯¹README.mdæ–‡ä»¶å¢åŠ ä¸€å¥è¯</p><blockquote><p>i said dev2</p></blockquote></li><li><p>âš ï¸ ç„¶åï¼Œ<code>git add  --&gt; git commit</code></p></li></ul></li><li><p>åˆå¹¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge dev2</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºï¼ŒREADME.mdæ–‡ä»¶åŒæ—¶è¢«ä¿®æ”¹ï¼Œå‘ç”Ÿå†²çªï¼ˆä¹Ÿå¯ç”¨ <code>git status</code> æŸ¥çœ‹ï¼‰</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561001544117.png" alt="1561001544117"></p><p>vim æŸ¥çœ‹æ–‡ä»¶æ˜¾ç¤ºå…·ä½“å†²çªï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim README.md <span class="comment">#å½“å‰HEADæŒ‡å‘masterï¼Œæ‰€ä»¥ä¸‹å›¾æ˜¾ç¤ºHEAD</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561001684363.png" alt="1561001684363"></p></li></ul></li><li><p>è§£å†³å†²çª</p><p>â“‚ï¸æ­¤æ—¶<strong>ä¸¤</strong><a href="http://xn--README-ov7i.md">ä¸ªREADME.md</a><strong>å·²ç»æ˜¯ä¸€ä¸ªæ–‡ä»¶äº†</strong>ï¼Œæ–‡ä»¶å†…å®¹å°±æ˜¯ä¸Šå›¾vimæŸ¥çœ‹çš„<strong>æ‰€æœ‰</strong>å†…å®¹ ã€‚</p><p>æˆ‘ä»¬å†å‘½ä»¤è¡Œç«¯å£ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæç¤ºæˆ‘ä»¬åœ¨ master|MERGING åˆå¹¶ä¸­ã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561002765319.png" alt="1561002765319"></p><p>â€‹     æˆ‘ä»¬æ‰“å¼€æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ä¸ºï¼šï¼ˆç¬¬ä¸€å¥è¯æœ‰è¯¯ï¼Œæ­¤æ—¶å®åœ¨masteråˆ†æ”¯ä¸Šï¼Œä¸ç”¨åœ¨æ„ï¼‰</p><blockquote><p>è¿™æ˜¯çš„devåˆ†æ”¯ï¼Œæˆ‘å¢åŠ äº†ä¸€å¥è¯</p><p>ä¿®æ”¹å†²çªï¼Œè¿™é‡Œå˜æˆè¿™æ ·ã€‚å…¶å®ä¸ä¿®æ”¹ç›´æ¥æäº¤ä¹Ÿè§£å†³å†²çªï¼Œåªæ˜¯æ²¡è§£å†³åŒæ—¶ä¿®æ”¹ã€‚</p></blockquote><p>ç„¶åå†æäº¤ï¼Œå‘ç°å†²çªå·²ç»è§£å†³ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add README.md </span><br><span class="line">$ git commit -m <span class="string">&#x27;è§£å†³å†²çª&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561002865426.png" alt="1561002865426"></p></li></ul><h3 id="4-3-åˆ†æ”¯ç®¡ç†ç­–ç•¥-â€“-ç¦ç”¨Fast-forward">4.3 åˆ†æ”¯ç®¡ç†ç­–ç•¥ â€“ ç¦ç”¨Fast forward</h3><ul><li><p>æ¦‚è§ˆ</p><blockquote><p>é€šå¸¸ï¼Œåˆå¹¶åˆ†æ”¯æ—¶ï¼Œå¦‚æœå¯èƒ½ï¼ŒGitä¼šç”¨<code>Fast forward</code>æ¨¡å¼ï¼Œåˆ™ç›´æ¥æŠŠ master çš„æŒ‡é’ˆç›´æ¥æŒ‡å‘äº† dev åˆ†æ”¯çš„æœ€æ–°æäº¤ï¼Œè¿™æ ·ä¸¤ä¸ªåˆ†æ”¯çš„æœ€æ–°æäº¤çš„ commit id å°±æ˜¯ä¸€æ ·çš„ã€‚ä½†è¿™ç§æ¨¡å¼ä¸‹ï¼Œåˆ é™¤åˆ†æ”¯åï¼Œä¼šä¸¢æ‰åˆ†æ”¯ä¿¡æ¯ã€‚</p><p><strong>åŠ ä¸Š<code>--no-ff</code>å‚æ•°ï¼Œå¼ºåˆ¶ç¦ç”¨<code>Fast forward</code>æ¨¡å¼ï¼Œä½¿ç”¨æ™®é€šæ¨¡å¼</strong>ã€‚Gitå°±ä¼šåœ¨mergeæ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„commitï¼Œè¿™æ ·ï¼Œä»åˆ†æ”¯å†å²ä¸Šå°±å¯ä»¥çœ‹å‡ºåˆ†æ”¯ä¿¡æ¯ã€‚</p></blockquote></li><li><p>å®æ“</p><blockquote><p>é»˜è®¤å·²ç»åˆ›å»ºå¥½åˆ†æ”¯ dev3ï¼Œä¸”ä¿®è¯¥äº†æ–‡ï¼Œè¿›è¡Œäº†ä¸€æ¬¡<strong>commit</strong>ã€‚</p><p>ç„¶åä¸‹é¢éƒ½æ˜¯åœ¨ masteråˆ†æ”¯ä¸Šå°è¯•åˆå¹¶æ“ä½œ</p></blockquote><ol><li><p>åˆ‡å›master</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br></pre></td></tr></table></figure></li><li><p>åˆå¹¶åˆ†æ”¯</p><p>â€“noâ€“ff ï¼š æ™®é€šæ¨¡å¼åˆå¹¶ã€‚</p><p>-m ï¼šç”±äºæœ¬æ¬¡åˆå¹¶<strong>dev</strong>è¦åˆ›å»ºä¸€ä¸ªæ–°çš„commitï¼Œæ‰€ä»¥åŠ ä¸Š<code>-m</code>å‚æ•°ï¼Œæ·»åŠ æè¿°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git merge --no-ff -m <span class="string">&quot;merge with no-ff&quot;</span> dev</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å†å²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph --pretty=oneline --abbrev-commit</span><br><span class="line">*   e1e9c68 (HEAD -&gt; master) merge with no-ff</span><br><span class="line">|\  </span><br><span class="line">| * f52c633 (dev) add merge</span><br><span class="line">|/  </span><br><span class="line">*   cf810e4 conflict fixed</span><br></pre></td></tr></table></figure></li><li><p>Fast forwardæ¨¡å¼ &amp; æ™®é€šæ¨¡å¼ å¯¹æ¯”</p><blockquote><p>FFæ¨¡å¼ä¸ç”¨<code>--no-ff</code>ï¼Œå®é™…ä¸Šåªæ˜¯å°†masterçš„æŒ‡é’ˆupdateæˆdevåˆ†æ”¯è€Œå·²ã€‚ç”¨çš„è¿˜æ˜¯devçš„commit IDã€‚</p><p>æ™®é€šæ¨¡å¼ç”¨ï¼Œåˆ™æ˜¯é‡æ–°commitä¸€æ¬¡ï¼Œæœ‰äº†æ–°çš„commit IDï¼Œ<strong>ä¿ç•™äº†åˆ†æ”¯ç‰ˆæœ¬è®°å½•</strong>ã€‚</p></blockquote><ul><li><p>Fast forwardæ¨¡å¼</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-br-ff-merge"></p></li><li><p>æ™®é€šæ¨¡å¼</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/0" alt="git-no-ff-mode"></p></li></ul></li></ol></li></ul><h3 id="4-4-BUGåˆ†æ”¯â€”git-stash">4.4 BUGåˆ†æ”¯â€”git stash</h3><ul><li><p>æ¦‚è§ˆ</p><blockquote><p>â€‹      ä¿®å¤bugæ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡åˆ›å»ºæ–°çš„bugåˆ†æ”¯è¿›è¡Œä¿®å¤ï¼Œç„¶ååˆå¹¶ï¼Œæœ€ååˆ é™¤ï¼›</p><p>â€‹      å½“æ‰‹å¤´å·¥ä½œæ²¡æœ‰å®Œæˆæ—¶ï¼Œå…ˆæŠŠå·¥ä½œç°åœº<code>git stash</code>ä¸€ä¸‹ï¼Œç„¶åå»ä¿®å¤bugï¼Œä¿®å¤åï¼Œå†<code>git stash pop</code>ï¼Œå›åˆ°å·¥ä½œç°åœºã€‚</p></blockquote></li><li><p>å®æ“ï¼ˆåº”ç”¨åœºæ™¯ï¼‰</p><ol><li><p>master ä¸Šé¢å‘å¸ƒçš„æ˜¯Açš„1.0ç‰ˆæœ¬</p></li><li><p>dev ä¸Šå¼€å‘çš„æ˜¯Açš„2.0ç‰ˆæœ¬ ï¼Œ<strong>åˆšåˆšæ–°å»ºäº†testæ–‡ä»¶</strong> &amp;<strong><a href="http://xn--README-2g0js76l.md">ä¿®æ”¹README.md</a></strong>ï¼š</p><blockquote><p>è¿™é‡Œæ˜¯devåˆ†æ”¯ã€‚</p></blockquote><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561019801527.png" alt="1561019801527"></p></li><li><p>è¿™æ—¶ï¼Œç”¨æˆ·åæ˜  1.0ç‰ˆæœ¬å­˜åœ¨æ¼æ´ï¼Œæœ‰äººåˆ©ç”¨è¿™ä¸ªæ¼æ´å¼€å¤–æŒ‚</p></li><li><p>éœ€è¦ä»devåˆ‡æ¢åˆ°masterå»å¡«è¿™ä¸ªæ¼æ´ï¼Œæ­£å¸¸å¿…é¡»å…ˆæäº¤devç›®å‰çš„å·¥ä½œï¼Œæ‰èƒ½åˆ‡æ¢ã€‚</p><ul><li><p>å¦‚æœä¸commitåˆ‡æ¢åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master </span><br></pre></td></tr></table></figure><p>å‘ç°å½“å‰å·¥ä½œç›®å½•ï¼Œæ˜¯devåˆ†æ”¯å·¥ä½œç›®å½•ï¼</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561018815751.png" alt="1561018815751"></p></li><li><p>è§£é‡Š1</p><blockquote><p>ä¸€ä¸ªæœ¬åœ°çš„git repoåªæœ‰ä¸€ä¸ªå·¥ä½œåŒºå’Œæš‚å­˜åŒºï¼Œä½†æ˜¯æœ‰å¤šä¸ªåˆ†æ”¯çš„æäº¤åŒºï¼Œè€Œæˆ‘ä»¬çš„checkoutåªæ˜¯å°†HEADæŒ‡é’ˆä»ä¸€ä¸ªåˆ†æ”¯åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ã€‚</p></blockquote><p>æ‰€ä»¥ï¼š</p><ol><li><p>åˆ‡æ¢åå·¥ä½œåŒºå†…å®¹æ˜¯branchçš„å·¥ä½œå†…å®¹</p></li><li><p>ç»è¿‡æµ‹è¯•ï¼Œå¦‚æœåˆ‡å›devåˆ†æ”¯ï¼Œè¿›è¡Œ<code>add --&gt; commi</code>t å†åˆ‡å›masterå°±å›åˆ°       masterå·¥ä½œåŒºã€‚</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561019439523.png" alt="1561019439523"></p></li></ol></li></ul></li><li><p>è€Œdevçš„å·¥ä½œè¿˜æœªå®Œæˆï¼Œä¸æƒ³æäº¤ï¼Œæ‰€ä»¥å…ˆæŠŠdevçš„å·¥ä½œstashä¸€ä¸‹ï¼Œç„¶ååˆ‡æ¢åˆ°masterï¼š</p><ol><li><p>å…ˆgit add test</p><blockquote><p>âš ï¸  ä¸ºä»€ä¹ˆè¦å…ˆadd testæ–‡ä»¶ï¼Ÿ</p><p>testæ–‡ä»¶æ˜¯æ–°å»ºï¼Œè¿˜æœªè¢«gitç®¡ç†ï¼è®©git add<strong>è¿½è¸ªtestæ–‡ä»¶</strong>ï¼Œå¦åˆ™å³ä½¿ git stash ï¼Œtestæ–‡ä»¶ä¹Ÿä¾ç„¶ä¼šå‡ºç°åœ¨masterå·¥ä½œç›®å½•ä¸­ï¼</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add <span class="built_in">test</span></span><br></pre></td></tr></table></figure></li><li><p>git stash ç„¶ååˆ‡æ¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git stash</span><br><span class="line">$ git checkout master</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561021862083.png" alt="1561021862083"></p></li><li><p>æ¢å¤devå·¥ä½œç›®å½•</p><p>ç®€å•æ¢å¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash pop  <span class="comment"># æ¢å¤çš„åŒæ—¶æŠŠstashå†…å®¹ä¹Ÿåˆ äº†</span></span><br></pre></td></tr></table></figure><p>æœ‰å¤šä¸ªå› æ­¤ç›®å½•ï¼Œå¯ä»¥é…åˆä¸‹é¢ç›®å½•æ¢å¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git stash list  </span><br><span class="line">stash@&#123;0&#125;: WIP on dev: f52c633 add merge</span><br><span class="line">$ git stash apply stash@&#123;0&#125; <span class="comment"># æ¢å¤ä¸ä¼šåˆ é™¤stashå†…å®¹</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>åœ¨masterå»ºç«‹åˆ†æ”¯issue101å¹¶åˆ‡æ¢ã€‚</p></li><li><p>åœ¨issue101ä¸Šä¿®å¤æ¼æ´ã€‚</p></li><li><p>ä¿®å¤åï¼Œåœ¨masterä¸Šåˆå¹¶issue101  ã€‚</p></li><li><p>åˆ‡å›devï¼Œæ¢å¤åŸæœ¬å·¥ä½œï¼Œç»§ç»­å·¥ä½œã€‚</p></li></ol></li></ul><h3 id="4-5-åˆ é™¤åˆ†æ”¯">4.5 åˆ é™¤åˆ†æ”¯</h3><p>å¦‚æœè¦ä¸¢å¼ƒä¸€ä¸ªæ²¡æœ‰è¢«åˆå¹¶è¿‡çš„åˆ†æ”¯ï¼Œå¯ä»¥é€šè¿‡<code>git branch -D &lt;name&gt;</code>å¼ºè¡Œåˆ é™¤ã€‚</p><h3 id="4-6-å¤šäººåä½œ">4.6 å¤šäººåä½œ</h3><ul><li><p><strong>æŸ¥çœ‹åˆ†æ”¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v  <span class="comment"># å¸¦-vå‚æ•°æŸ¥çœ‹æ›´åŠ è¯¦ç»†</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561023498006.png" alt="1561023498006"></p></li><li><p><strong>push æ¨é€åˆ†æ”¯</strong></p><p><code>git push &lt;è¿œç¨‹åº“å&gt; &lt;è¦æ¨é€åˆ†æ”¯å&gt;</code></p><blockquote><p>â€‹      æ¨é€æœ¬åœ°ä¸»åˆ†æ”¯masteråˆ° origin masterï¼Œç›¸å½“ç”¨æœ¬åœ°masterç‰ˆæœ¬è¦†ç›–è¿œç¨‹origin masterç‰ˆæœ¬ã€‚</p><p>âš ï¸ git push åªèƒ½ç”¨æˆ·è¯¥é¡¹ç›®å±äºè‡ªå·±çš„æƒ…å†µï¼Œå› ä¸ºè¦è¾“å…¥è´¦å·å¯†ç ï¼å‚ä¸ä»–äººå¼€æºï¼š</p><ul><li>æˆä¸ºè¯¥å¼€æºé¡¹ç›®è´¡çŒ®è€…ï¼ˆç”±é¡¹ç›®ä½œè€…è®¾ç½®ï¼‰</li><li>fork è¯¥é¡¹ç›® ----&gt; cloneåˆ°æœ¬åœ°----&gt; ä¿®æ”¹ ----&gt; å‘èµ· pull requset â€”&gt; è®¨è®º &amp; ç­‰å¾…åˆå¹¶</li></ul><p>è¿˜æœ‰å…¶ä»–æ›´å¤šæƒ…å†µï¼Œå¦‚äº§ç”Ÿå†²çªç­‰ï¼ŒæŸ¥çœ‹ï¼š<a href="%5Bhttps://progit.bootcss.com/#_%E5%AF%B9%E9%A1%B9%E7%9B%AE%E5%81%9A%E5%87%BA%E8%B4%A1%E7%8C%AE%5D(https://progit.bootcss.com/#_%E5%AF%B9%E9%A1%B9%E7%9B%AE%E5%81%9A%E5%87%BA%E8%B4%A1%E7%8C%AE)">pro git ä¸­æ–‡# å¯¹é¡¹ç›®åšå‡ºè´¡çŒ®</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561024444763.png" alt="1561024444763"></p><blockquote><p>æ¨é€å…¶ä»–åˆ†æ”¯åˆ°è¿œç¨‹åº“ ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin dev</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561024648502.png" alt="1561024648502"></p></li><li><p>clone å…‹éš†åˆ†æ”¯å·¥ä½œ</p><p>å¤šäººåä½œæ—¶ï¼Œå¤§å®¶éƒ½ä¼šå¾€<strong>è¿œç¨‹åº“</strong><code>master</code>å’Œ<code>dev</code>åˆ†æ”¯ä¸Šæ¨é€å„è‡ªçš„ä¿®æ”¹ã€‚</p><ol><li><p>å…‹éš†ä¸»åˆ†æ”¯</p><blockquote><p>âš ï¸ å…‹éš†åªèƒ½å…‹éš†masteråˆ†æ”¯ï¼ï¼</p></blockquote><p>ç°åœ¨ï¼Œæ¨¡æ‹Ÿä½ çš„å°ä¼™ä¼´ï¼Œåœ¨å¦ä¸€å°ç”µè„‘ï¼ˆæ³¨æ„è¦æŠŠSSH Keyæ·»åŠ åˆ°GitHubï¼‰å…‹éš†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:michaelliao/Python-100-Days</span><br></pre></td></tr></table></figure></li><li><p>å…‹éš†è¿œç¨‹devåˆ†æ”¯å¼€å‘</p><p>ç”±äºåªèƒ½å…‹éš†masteråˆ†æ”¯ï¼Œè€Œåˆè¦åœ¨è¿œç¨‹devåˆ†æ”¯å¼€å‘ï¼Œé‚£ä¹ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b dev origin/dev</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±å¯è¿›è¡Œä¿®æ”¹ â€”&gt; æäº¤ ï¼šgit pushäº†</p></li></ol></li><li><p><code>git pull</code></p><blockquote><p>ä¸€ç§åº”ç”¨æƒ…å†µï¼šAã€Béƒ½å…‹éš†äº†é¡¹ç›®ï¼Œåœ¨è¿œç¨‹åˆ†æ”¯devä¸Šè¿›è¡Œå¼€å‘ï¼ˆåˆ†åˆ«åœ¨æœ¬åœ°ä¹Ÿå…‹éš†devåˆ†æ”¯ï¼‰</p><ol><li><p>Aä¿®æ”¹äº†æ–‡ä»¶ READMEï¼Œå¹¶è¿›è¡Œäº†pushæäº¤ ã€‚</p></li><li><p>ä½ ä¹Ÿä¿®æ”¹äº†READMEï¼Œè¿›è¡Œæäº¤ä¿®æ”¹ï¼Œä¼šå‡ºé”™ï¼ŒåŸå› æ˜¯</p><p>âš ï¸<strong>è¿œç¨‹åˆ†æ”¯æ¯”ä½ çš„æœ¬åœ°æ›´æ–°ï¼</strong></p></li><li><p>åªæœ‰å…ˆ pull æœ€æ–°åˆ†æ”¯ä½ çš„åˆ†æ”¯åˆå¹¶ â€”&gt; è§£å†³å†²çªâ€”&gt;æäº¤</p></li></ol></blockquote><p><code>git pull</code>å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šå–å›è¿œç¨‹ä¸»æœºæŸä¸ªåˆ†æ”¯çš„æ›´æ–°ï¼Œå†ä¸æœ¬åœ°çš„æŒ‡å®šåˆ†æ”¯åˆå¹¶ï¼Œå®ƒçš„å®Œæ•´æ ¼å¼ç¨ç¨æœ‰ç‚¹å¤æ‚ã€‚</p><blockquote><p>åœ¨é»˜è®¤æ¨¡å¼ä¸‹ï¼Œ<code>git pull</code>æ˜¯<code>git fetch</code>åè·Ÿ<code>git merge FETCH_HEAD</code>çš„ç¼©å†™ã€‚</p><p>git pull == git fetch+  git merge ï¼ˆé»˜è®¤æ˜¯æ£€ç´¢å¤´éƒ¨åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼‰</p><p>âš ï¸ ä½¿ç”¨â€“rebaseï¼Œå®ƒè¿è¡Œ<code>git rebase</code>è€Œä¸æ˜¯<code>git merge</code>ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull&lt;å¯é€‰å‚æ•°&gt; &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2><p>æ¯”å¦‚ï¼Œè¦å–å›<code>origin</code>ä¸»æœºçš„<code>next</code>åˆ†æ”¯ï¼Œä¸æœ¬åœ°çš„<code>master</code>åˆ†æ”¯åˆå¹¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin next:master</span></span><br></pre></td></tr></table></figure><ul><li><p>çœç•¥å½“å‰åˆ†æ”¯å</p><p>å¦‚æœè¿œç¨‹åˆ†æ”¯(<code>next</code>)è¦ä¸å½“å‰åˆ†æ”¯åˆå¹¶ï¼Œåˆ™å†’å·åé¢çš„éƒ¨åˆ†å¯ä»¥çœç•¥ã€‚ä¸Šé¢å‘½ä»¤å¯ä»¥ç®€å†™ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin next</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œå–å›<code>origin/next</code>åˆ†æ”¯ï¼Œå†ä¸å½“å‰åˆ†æ”¯åˆå¹¶ã€‚å®è´¨ä¸Šï¼Œè¿™ç­‰åŒäºå…ˆåš<code>git fetch</code>ï¼Œå†æ‰§è¡Œ<code>git merge</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch origin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge origin/next</span></span><br></pre></td></tr></table></figure></li><li><p>çœç•¥è¿œç¨‹åˆ†æ”¯å</p><blockquote><p>æŸäº›åœºåˆï¼ŒGitä¼šè‡ªåŠ¨åœ¨æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯ä¹‹é—´ï¼Œå»ºç«‹ä¸€ç§è¿½è¸ªå…³ç³»(tracking)ã€‚æ¯”å¦‚ï¼Œåœ¨<code>git clone</code>çš„æ—¶å€™ï¼Œæ‰€æœ‰æœ¬åœ°åˆ†æ”¯é»˜è®¤ä¸è¿œç¨‹ä¸»æœºçš„åŒååˆ†æ”¯ï¼Œå»ºç«‹è¿½è¸ªå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬åœ°çš„<code>master</code>åˆ†æ”¯è‡ªåŠ¨â€è¿½è¸ªâ€<code>origin/master</code>åˆ†æ”¯ã€‚</p><p>Gitä¹Ÿå…è®¸æ‰‹åŠ¨å»ºç«‹è¿½è¸ªå…³ç³»ï¼ŒæŒ‡å®š<code>master</code>åˆ†æ”¯è¿½è¸ª<code>origin/next</code>åˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch --set-upstream master origin/next</span></span><br></pre></td></tr></table></figure></blockquote><p>å¦‚æœå½“å‰åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯å­˜åœ¨è¿½è¸ªå…³ç³»ï¼Œ<code>git pull</code>å°±å¯ä»¥çœç•¥è¿œç¨‹åˆ†æ”¯åã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull origin</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œæœ¬åœ°çš„å½“å‰åˆ†æ”¯è‡ªåŠ¨ä¸å¯¹åº”çš„<code>origin</code>ä¸»æœºâ€è¿½è¸ªåˆ†æ”¯â€(remote-tracking branch)è¿›è¡Œåˆå¹¶ã€‚</p></li><li><p>çœç•¥è¿œç¨‹ä¸»æœºå</p><p>å¦‚æœå½“å‰åˆ†æ”¯åªæœ‰ä¸€ä¸ªè¿½è¸ªåˆ†æ”¯ï¼Œè¿è¿œç¨‹ä¸»æœºåéƒ½å¯ä»¥çœç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git pull</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>git fetchå’Œgit pullçš„åŒºåˆ«</strong></p><ol><li><em>git fetch</em>ï¼šç›¸å½“äºæ˜¯ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°ï¼Œä¸ä¼šè‡ªåŠ¨åˆå¹¶ã€‚</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch origin master</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> -p master..origin/master</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge origin/master</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå‘½ä»¤çš„å«ä¹‰ï¼š</p><ul><li>é¦–å…ˆä»è¿œç¨‹çš„<code>origin</code>çš„<code>master</code>ä¸»åˆ†æ”¯ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬åˆ°<code>origin/master</code>åˆ†æ”¯ä¸Š</li><li>ç„¶åæ¯”è¾ƒæœ¬åœ°çš„<code>master</code>åˆ†æ”¯å’Œ<code>origin/master</code>åˆ†æ”¯çš„å·®åˆ«</li><li>æœ€åè¿›è¡Œåˆå¹¶</li></ul><p>ä¸Šè¿°è¿‡ç¨‹å…¶å®å¯ä»¥ç”¨ä»¥ä¸‹æ›´æ¸…æ™°çš„æ–¹å¼æ¥è¿›è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git fetch origin master:tmp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff tmp</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge tmp</span></span><br></pre></td></tr></table></figure><ol start="2"><li><em>git pull</em>ï¼šç›¸å½“äºæ˜¯ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬å¹¶<code>merge</code>åˆ°æœ¬åœ°</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin maste</span><br></pre></td></tr></table></figure></li></ul><h2 id="äº”ã€æ ‡ç­¾ç®¡ç†">äº”ã€æ ‡ç­¾ç®¡ç†</h2><h3 id="5-1-åˆ›å»ºæ ‡ç­¾">5.1 åˆ›å»ºæ ‡ç­¾</h3><h3 id="5-2-æ“ä½œæ ‡ç­¾">5.2 æ“ä½œæ ‡ç­¾</h3><h2 id="å…­ã€ä½¿ç”¨Github">å…­ã€ä½¿ç”¨Github</h2><h3 id="6-1-ç®€å•ä¸Šä¼ ">6.1 ç®€å•ä¸Šä¼ </h3><ol><li><p>è®¾ç½®ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;hwh&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;380141202@qq.com&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>git init åˆå§‹åŒ–ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°åˆ›å»ºssh key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;380141202@qq.com&quot;</span> <span class="comment"># åé¢ä¼šè¦æ±‚è®¾ç½®å¯†ç å¯ä¸è®¾ç½®</span></span><br></pre></td></tr></table></figure><p>ç„¶åä¼šåœ¨ï¼šC:\Users\80651\.ssh ç”Ÿæˆssh key æ–‡ä»¶ï¼Œå…¶ä¸‹æœ‰ä¸€ä¸ªå…¬é’¥ <code>id_rsa.pub</code>ï¼Œè®°äº‹æœ¬æ‰“å¼€å¤åˆ¶ã€‚</p></li><li><p>æ‰“å¼€githubè®¾ç½®</p><p>æ‰“å¼€github åœ¨ä¸ªäººè®¾ç½®ä¸­æ·»åŠ **2.**ä¸­ssh keyã€‚</p><p>å¯ç”¨ <code>ssh -T</code>æŸ¥çœ‹æ˜¯å¦æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -T git@github.com</span><br></pre></td></tr></table></figure></li><li><p>å¯¹æ–‡ä»¶ä¸€äº›æ“ä½œ</p><p>æ¯”å¦‚ï¼Œè¿™é‡Œä»¥å¢åŠ ä¸€ä¸ªREADMEæ–‡ä»¶ï¼Œç„¶å<strong>git commit æäº¤</strong>åˆ°ç‰ˆæœ¬åº“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add README   <span class="comment"># ä¹Ÿå¯add . æäº¤æ‰€æœ‰æ–°å»ºã€ä¿®æ”¹æ–‡ä»¶</span></span><br><span class="line">$ git commit -m <span class="string">&#x27;å¢åŠ readme&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>push ä¸Šä¼ åˆ°ç‰ˆæœ¬åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure><blockquote><p>Q : git push å‡ºç°é”™è¯¯ â€˜â€™ error: failed to push some refs to gitâ€˜â€™</p><p>A : ä¸€èˆ¬æ˜¯å› ä¸ºgithubä¸­çš„<code>README.md</code>æ–‡ä»¶ä¸åœ¨æœ¬åœ°ä»£ç ç›®å½•ä¸­</p><ul><li><p>æ·»åŠ  -f å‚æ•°å¼ºåˆ¶è¦†ç›–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f origin master</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œgithubä¸æœ¬åœ°ä»£ç åˆå¹¶:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git pull --rebase origin master   <span class="comment"># å…ˆå’Œæœ¬åœ°ä»£ç åˆå¹¶</span></span><br><span class="line">$ git push    <span class="comment"># ç„¶åå†ä¸Šä¼ </span></span><br></pre></td></tr></table></figure></li></ul></blockquote></li></ol><h3 id="6-2-å‚ä¸å¼€æºé¡¹ç›®">6.2 å‚ä¸å¼€æºé¡¹ç›®</h3><blockquote><p>å¯å‚è€ƒï¼š<a href="https://www.zhihu.com/question/21682976/answer/79489643">GitHubçš„Pull Request æ˜¯æŒ‡ä»€ä¹ˆæ„æ€</a></p></blockquote><h2 id="ä¸ƒã€è‡ªå®šä¹‰Git">ä¸ƒã€è‡ªå®šä¹‰Git</h2><ol><li><p>æœåŠ¡å™¨ç«¯å®‰è£…Git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install git</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºç”¨æˆ· &amp; ç»„ ç®¡ç†ä»“åº“ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ groupadd git</span><br><span class="line">$ useradd git -g git  <span class="comment"># -g å‚æ•°è¡¨ç¤ºæŠŠç”¨æˆ·gituserä¸»ç»„è®¾ç½®ä¸º git</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºç›®å½•</p><p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•<code>gitrepo</code>ç”¨æ¥ç®¡ç†å…¶ä¸‹ä»“åº“ï¼Œä¸€èˆ¬ä¹ æƒ¯åœ¨ /varä¸‹åˆ›å»ºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /var</span><br><span class="line">$ mkdir gitrepo</span><br></pre></td></tr></table></figure><p>ç»™å…¶è®¾ç½®å¥½ç”¨æˆ· &amp; ç»„ï¼Œä¾¿äºç®¡ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chown -R gituser:git gitrepo <span class="comment"># æŠŠç›®å½•gitrepo è®¾ç½®ç”¨æˆ·gituser &amp; ç»„ git</span></span><br></pre></td></tr></table></figure><p><code>ls -l</code> æŸ¥çœ‹æ˜¯å¦è®¾ç½®æˆåŠŸï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561122220352.png" alt="1561122220352"></p></li><li><p>åˆ›å»ºä»“åº“</p><p>åˆ›å»º<code>hwhComputer2Backup.git</code>ä»“åº“ï¼Œå¹¶åˆå§‹åŒ–ç”¨æ¥ä¸Šä¼ ç”µè„‘å¤‡ä»½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> gitrepo  <span class="comment"># æ³¨æ„å…ˆåˆ‡æ¢åˆ°gitä¸‹</span></span><br><span class="line">$ git init --bare hwhComputer2Backup.git</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºè¯ä¹¦</p><ul><li><p>åœ¨æœ¬åœ°ç”µè„‘ä¸Š</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºssh å…¬é’¥ã€‚ä¼šåœ¨ï¼š<code>C:\Users\80651\\.ssh</code> ç”Ÿæˆssh key æ–‡ä»¶ï¼Œå…¶ä¸‹æœ‰ä¸€ä¸ªå…¬é’¥ <code>id_rsa.pub</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;380141202@qq.com&quot;</span> <span class="comment"># åé¢ä¼šè¦æ±‚è®¾ç½®å¯†ç å¯ä¸è®¾ç½®</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ‡å›æœåŠ¡ç«¯</p><blockquote><p>è£¸æœºéœ€åˆ›å»º<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> gitrepo/</span><br><span class="line">$ mkdir .ssh</span><br><span class="line">$ touch .ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠæœ¬åœ°ç”µè„‘ä¸Šå…¬é’¥å¤åˆ¶å¯¼å…¥ï¼Œä¸€è¡Œä¸€ä¸ªï¼ˆï¼Ÿï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim .ssh/authorized_keys</span><br></pre></td></tr></table></figure><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561123680464.png" alt="1561123680464"></p></li></ul></li><li><p>å†æ¬¡ä¿®æ”¹æƒé™</p><blockquote><p>åˆ›å»ºçš„å­ç›®å½• ç”¨æˆ· &amp; ç»„ é»˜è®¤æ˜¯ root root</p></blockquote><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561124160395.png" alt="1561124160395"></p><p>âš ï¸ç”±äº.ssh &amp; ä»“åº“ hwhComputer2Backup.git éƒ½ä¸å±äº gituser ï¼Œæ‰€æœ‰è¿˜éœ€è®¾ç½®æƒé™ã€‚å¦åˆ™è¿›è¡Œ push pull æ“ä½œ æ²¡æœ‰è¶³å¤Ÿæƒé™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /var</span><br><span class="line">$ chown -R gituser:git gitrepo</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°ä¸Šä¼ æ–‡ä»¶</p><ol><li><p>æ·»åŠ ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;hwh&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;380141202@qq.com&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> D:/hwh/uploadToGit</span><br><span class="line">$ git init</span><br></pre></td></tr></table></figure></li><li><p>æŠŠæœ¬åœ°ä»“åº“æ·»åŠ åˆ°ç‰ˆæœ¬åº“</p><blockquote><p>é”™è¯¯ï¼šc#ç¨‹åºç»ƒä¹  does not have a commit checked out</p><p>è§£å†³ï¼šæ˜¯å› ä¸º c#ç¨‹åºç»ƒä¹  è¿™ä¸ªæ–‡ä»¶å¤¹å·²ç»è¢«åˆå§‹åŒ–ï¼ŒæŸ¥çœ‹éšè—æ–‡ä»¶å¯ä»¥å‘ç° .gitæ–‡ä»¶åˆ é™¤å…¶å³å¯ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add .  <span class="comment"># add . æäº¤æ‰€æœ‰æ–°å»ºã€ä¿®æ”¹æ–‡ä»¶</span></span><br><span class="line">$ git commit -m <span class="string">&#x27;ç¬¬ä¸€æ¬¡å¤‡ä»½æ–‡ä»¶&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°ä»“åº“å…³è”è¿œç¨‹åº“</p><blockquote><p>ç§»é™¤å½“å‰è¿œç¨‹è¿æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote remove origin </span><br></pre></td></tr></table></figure></blockquote><p><code>git remote add origin &lt;æœåŠ¡ç«¯ç”¨æˆ·å&gt;@&lt;è¿œç¨‹åº“ååœ°å€&gt;:&lt;è¿œç¨‹ä»“åº“åœ°å€&gt;</code></p><p>âš ï¸<code>&lt;æœåŠ¡ç«¯ç”¨æˆ·å&gt; :</code> æ˜¯åœ¨æœåŠ¡ç«¯çš„ç”¨æˆ·ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin gituser@129.28.154.240:/var/gitrepo/hwhComputer2Backup.git</span><br></pre></td></tr></table></figure></li><li><p>æ¨é€åˆ°è¿œç¨‹åº“</p><blockquote><p>ä¼¼ä¹ç”±äº <em>ssh key</em> è®¾ç½®ä¸å¯¹ï¼Œ<em>git push</em> è¦è¾“å…¥ç”¨æˆ· <em>gituser</em> çš„å¯†ç  123456ï¼Ÿ</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u origin master  <span class="comment"># ç¬¬ä¸€æ¬¡æ¨é€å¸¦ -u å‚æ•°</span></span><br></pre></td></tr></table></figure><p>ç­‰å¾…ä¸Šä¼ æœåŠ¡å™¨(é€Ÿåº¦æœ‰ç‚¹æ…¢)ï¼š</p><p><img src="https://blog-imgs-1256686095.cos.ap-guangzhou.myqcloud.com/1561128011507.png" alt="1561128011507"></p></li></ol></li></ol><h2 id="å…«ã€debug-è®°å½•">å…«ã€<code>debug</code> è®°å½•</h2><blockquote><p><strong>ERROR</strong>ï¼šç”±äºå­˜åœ¨ <code>&gt;100M</code> æ–‡ä»¶ï¼Œæäº¤åæŠ¥é”™ï¼Œä¸å…è®¸æäº¤è¶…è¿‡<code>100M</code> æ–‡ä»¶ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li>å‹ç¼©å¹¶åˆ é™¤<code>&gt;100M</code>æ–‡ä»¶</li><li>å°†ç›¸åº”æ–‡ä»¶åŠ å…¥ <code>.gitignore</code></li><li>å†æ¬¡<code>commit</code>  --&gt; <code>push</code></li></ul><p>ä¾æ—§æŠ¥ç›¸åŒé”™è¯¯ã€‚</p></blockquote><p>è§£å†³åŠæ³•å¦‚ä¸‹ï¼Œå‚è€ƒï¼š<a href="https://medium.com/@marcosantonocito/fixing-the-gh001-large-files-detected-you-may-want-to-try-git-large-file-storage-43336b983272">Fixing the â€œGH001â€¦</a></p><ol><li><p>åˆ é™¤æ–‡ä»¶</p><blockquote><p>å»ºè®®å¯ä»¥å…ˆå›é€€æœ€è¿‘çš„<code>commit</code> åˆ†æ”¯</p></blockquote><p>åˆ©ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤æ‰€æœ‰åœ¨ä»“åº“ä¸­  <code>&gt;100M</code> çš„æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git filter-branch -f --index-filter <span class="string">&#x27;git rm --cached --ignore-unmatch &lt;å¤§äº100Mæ–‡ä»¶URL&gt;&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘çš„ä¾‹å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git filter-branch -f --index-filter <span class="string">&#x27;git rm --cached --ignore-unmatch  Experiment/Ex4_CustomerForecast/src/train.csv&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>å†æ¬¡æäº¤</p><p>ä¸ºäº†ä¿é™©ï¼Œå¯ä»¥å…ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached ./   <span class="comment"># æœ¬åœ°ä»£ç ä¸ä¼šè¢«åˆ é™¤</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ­£å¸¸ï¼š<code>git add --&gt; git commit --&gt; git push</code> å³å¯</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰_è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</title>
      <link href="/p/5582/"/>
      <url>/p/5582/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><blockquote><p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a href="https://www.hwh.zone/p/29708/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p></blockquote><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th><th style="text-align:center">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td><td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td><td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a href="https://codetop.cc/">codeTop</a></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/51787/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td><td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/7257/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/21069/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/8959/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/45493/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/42516/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td><td style="text-align:center"><a href="http://hwh.zone/p/44980/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/46361/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/15646/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/56848/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/31215/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/61434/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="https://hwh.zone/p/31667/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"><a href="http://hwh.zone/p/5582/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td><td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td><td style="text-align:center"></td></tr></tbody></table><h1>ä¹ã€ç›¸å…³è¡¥å……</h1><h2 id="9-1-ï¼ˆè¦æ‰©å……ï¼‰è®¾è®¡æ¨¡å¼">9.1 ï¼ˆè¦æ‰©å……ï¼‰è®¾è®¡æ¨¡å¼</h2><blockquote><p>æ²¡æœ‰è¶³å¤Ÿå®é™…ä»£ç ç»éªŒï¼Œåªå¥½å…ˆå†™è¿™äº›åº”ä»˜ä¸‹é¢è¯•ã€‚</p></blockquote><h4 id="1-è¯´è¯´ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼-æ‰‹å†™ä¸€ä¸ªï¼Ÿ">1.è¯´è¯´ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ ?æ‰‹å†™ä¸€ä¸ªï¼Ÿ</h4><p>å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œåœ¨åº”ç”¨è¿™ä¸ªæ¨¡å¼æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œæ•´ä¸ªç³»ç»Ÿåªèƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚</p><ul><li><p><strong>æ‰‹å†™å•ä¾‹æ¨¡å¼</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://www.runoob.com/design-pattern/singleton-pattern.html">https://www.runoob.com/design-pattern/singleton-pattern.html</a></p></blockquote><blockquote><p>è®°å¿†ï¼šâ€œ2private + 1public â€</p></blockquote><ol><li><p><strong>é¥¿æ±‰å¼</strong></p><p>çº¿ç¨‹å®‰å…¨ ï¼Œ ä½†ï¼šç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleObject</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="comment">// åˆ›å»º SingleObject çš„ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> SingleObject instance = <span class="keyword">new</span> SingleObject();</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// *è®©æ„é€ å‡½æ•°ä¸º privateï¼Œè¿™æ ·è¯¥ç±»å°±ä¸ä¼šè¢«å®ä¾‹åŒ–</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">SingleObject</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// è·å–å”¯ä¸€å¯ç”¨çš„å¯¹è±¡</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleObject <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ‡’æ±‰å¼ï¼ˆä¸åŠ é”ï¼‰</strong></p><p>åªæœ‰çœŸæ­£è°ƒç”¨è·å–å®ä¾‹å¯¹è±¡æ—¶ï¼Œæ‰ä¼šåˆ›å»ºä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// è°ƒç”¨æ—¶æ‰åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) </span><br><span class="line">    &#123;  </span><br><span class="line">        instance = <span class="keyword">new</span> Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ‡’æ±‰å¼ï¼ˆåŠ é”ï¼‰</strong></p><p>çº¿ç¨‹å®‰å…¨ï¼Œä½†åŠ é”æ€§èƒ½ä¸å¤Ÿé«˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="comment">// å°±æ˜¯å¤šäº†ä¸ªsynchronizedå…³é”®å­—</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;  </span><br><span class="line">        instance = <span class="keyword">new</span> Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åŒæ£€é”å¼</strong></p><p>æ‡’æ±‰å¼ï¼ˆåŠ é”ï¼‰è™½ç„¶å¯ä»¥ä¿è¯åªåˆ›å»ºä¸€ä¸ªå•ä¾‹ï¼Œä½†å…¶æ€§èƒ½ä¸é«˜ï¼Œå› ä¸ºæ¯æ¬¡è®¿é—®<strong>æ•´ä¸ªæ–¹æ³•éƒ½åŠ é”</strong>ã€‚</p><p>å› æ­¤å‡ºç°åŒæ£€ç´¢å¼ï¼Œåœ¨<code>instance=new DoubleCheckSingleton();</code> è¿›è¡ŒåŠ é” ï¼Œ <code>return instance;</code><strong>ä¸åŠ é”</strong>ï¼</p><blockquote><p><strong>ä¸ºä»€ä¹ˆè¦è¿›è¡Œä¸¤æ¬¡æ£€æŸ¥instance==nullï¼Ÿ</strong></p><ol><li><p>ç¬¬ä¸€å±‚æ£€æŸ¥ä½œç”¨</p><p>ä¸»è¦ä¸ºäº†æé«˜æ€§èƒ½ã€‚å¦‚æœæ²¡æœ‰ç¬¬ä¸€å±‚ï¼Œä¸Šæ¥å°±è¦åŠ é”æ¯”è¾ƒè€—è´¹æ€§èƒ½</p></li><li><p>ç¬¬äºŒå±‚æ£€æŸ¥ä½œç”¨</p><p>è§£å†³å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ã€‚å‡è®¾æ˜¯ç¬¬ä¸€æ¬¡å¼€å§‹æ‰§è¡Œ<code>getInstance</code>æ–¹æ³•ï¼š</p><ol><li>Aï¼ŒBä¸¤ä¸ªçº¿ç¨‹ï¼Œæ­¤æ—¶<code>instance==null</code> ï¼ŒAï¼ŒBéƒ½é€šè¿‡äº†ç¬¬ä¸€å±‚æ£€æŸ¥ã€‚</li><li>å‡è®¾Aå…ˆæ‹¿åˆ°é”ï¼Œå¾€ä¸‹æ‰§è¡Œåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç„¶åé‡Šæ”¾äº†é”ï¼›</li><li>æ­¤æ—¶Bä¹Ÿæ‹¿åˆ°äº†é”ï¼Œ<strong>å¦‚æœæ²¡æœ‰ç¬¬äºŒå±‚æ£€æŸ¥ï¼ŒBä¼šè¿›è¡Œé‡æ–°newä¸€ä¸ªå®ä¾‹</strong>ï¼Œè¿èƒŒå•ä¾‹æ¨¡å¼ï¼</li></ol></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleCheckSingleton</span></span></span><br><span class="line"><span class="class"></span>&#123;      </span><br><span class="line">     <span class="comment">// volitale å…³é”®å­—ä¿®é¥°ï¼Œé¿å…æŒ‡ä»¤é‡æ’ï¼Œå› ä¸ºåˆå§‹åŒ–æ“ä½œæ˜¯ä¸åŸå­åŒ–çš„ ï¼š</span></span><br><span class="line">    <span class="comment">//  (1) ç»™DoubleCheckSingletonç±»çš„å®ä¾‹instanceåˆ†é…å†…å­˜</span></span><br><span class="line">    <span class="comment">//  (2) è°ƒç”¨å®ä¾‹instanceçš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="comment">//  (3) å°†instanceæŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€</span></span><br><span class="line">    <span class="comment">//  åœ¨å¤šçº¿ç¨‹ä¸­ï¼ŒAå¯èƒ½æ˜¯ 1â†’3â†’2çš„é¡ºåºï¼Œæ‰§è¡Œåˆ°1â†’3ï¼Œæ­¤æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°instanceä¸ä¸ºnullï¼ˆå› ä¸ºå‰é¢çº¿ç¨‹æ‰§è¡Œäº†3ï¼‰å°±ç›´æ¥è¿”å›å®ä¾‹ã€‚è€Œæ­¤æ—¶å¹¶æ²¡æœ‰è¢«åˆ†é…å†…å­˜æ•…å¯èƒ½å‡ºç°é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">volatile</span> <span class="keyword">static</span> DoubleCheckSingleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DoubleCheckSingleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DoubleCheckSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123; <span class="comment">//ç¬¬ä¸€å±‚æ£€æŸ¥ï¼Œæ˜¯å¦å­˜åœ¨å®ä¾‹</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleCheckSingleton.class)&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123; <span class="comment">//ç¬¬äºŒå±‚æ£€æŸ¥ï¼Œé˜²æ­¢å‡ºç°å¦å¤–ä¸€ä¸ªçº¿ç¨‹é˜»å¡åœ¨synchronizedï¼Œè·å¾—é”åé‡å¤åˆ›å»ºå®ä¾‹</span></span><br><span class="line"></span><br><span class="line">                    instance=<span class="keyword">new</span> DoubleCheckSingleton();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><h4 id="2-è¯´è¯´ä½ å¯¹ä»£ç†æ¨¡å¼çš„ç†è§£ï¼Ÿ">2.<strong>è¯´è¯´ä½ å¯¹ä»£ç†æ¨¡å¼çš„ç†è§£</strong>ï¼Ÿ</h4><p>ä»£ç†æ¨¡å¼æ˜¯ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±<strong>ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨</strong>ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šä»£ç†æ¨¡å¼èƒ½å¤Ÿåè°ƒè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ï¼Œ<u>åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„<strong>è€¦åˆåº¦</strong></u>ï¼›å¯ä»¥<u>çµæ´»åœ°éšè—è¢«ä»£ç†å¯¹è±¡çš„éƒ¨åˆ†åŠŸèƒ½å’ŒæœåŠ¡ï¼Œä¹Ÿå¢åŠ é¢å¤–çš„åŠŸèƒ½å’ŒæœåŠ¡</u>ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç”±äºä½¿ç”¨äº†ä»£ç†æ¨¡å¼ï¼Œå› æ­¤ç¨‹åºçš„æ€§èƒ½<u>æ²¡æœ‰ç›´æ¥è°ƒç”¨æ€§èƒ½é«˜</u>ï¼›ä½¿ç”¨ä»£ç†æ¨¡å¼<u>æé«˜äº†ä»£ç çš„å¤æ‚åº¦</u>ã€‚</li></ul><h4 id="3-è¯´è¯´ç®€å•å·¥å‚æ¨¡å¼ï¼Ÿ">3.<strong>è¯´è¯´ç®€å•å·¥å‚æ¨¡å¼</strong>ï¼Ÿ</h4><p>ç®€å•å·¥å‚æ¨¡å¼åˆå«é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ªå·¥å‚ç±»ï¼Œ<strong>å¯¹å®ç°äº†åŒä¸€æ¥å£çš„ä¸€äº›ç±»è¿›è¡Œå®ä¾‹çš„åˆ›å»º</strong>ã€‚</p><ul><li><p>æ¯”å¦‚ï¼Œä¸€å°å’–å•¡æœºå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå·¥å‚æ¨¡å¼ï¼Œä½ åªéœ€è¦æŒ‰ä¸‹æƒ³å–çš„å’–å•¡å“ç±»çš„æŒ‰é’®ï¼ˆæ‘©å¡æˆ–æ‹¿é“ï¼‰ï¼Œå®ƒå°±ä¼šç»™ä½ ç”Ÿäº§ä¸€æ¯ç›¸åº”çš„å’–å•¡ï¼Œä½ ä¸éœ€è¦ç®¡å®ƒå†…éƒ¨çš„å…·ä½“å®ç°ï¼Œåªè¦å‘Šè¯‰å®ƒä½ çš„éœ€æ±‚å³å¯ï¼›</p></li><li><p>ã€<strong>ä¼˜ç‚¹</strong>ã€‘<strong>å·¥å‚ç±»å«æœ‰å¿…è¦çš„åˆ¤æ–­é€»è¾‘ï¼Œå¯ä»¥å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºå“ªä¸€ä¸ªäº§å“ç±»çš„å®ä¾‹</strong>ï¼Œå®¢æˆ·ç«¯å¯ä»¥å…é™¤ç›´æ¥åˆ›å»ºäº§å“å¯¹è±¡çš„è´£ä»»ï¼Œè€Œä»…ä»…â€œæ¶ˆè´¹â€äº§å“ï¼›</p></li><li><p>ã€<strong>ç¼ºç‚¹</strong>ã€‘ ä¸æ˜“æ‹“å±•ï¼Œ<u>ä¸€æ—¦æ·»åŠ æ–°çš„äº§å“ç±»å‹ï¼Œå°±ä¸å¾—ä¸ä¿®æ”¹å·¥å‚çš„åˆ›å»ºé€»è¾‘</u>ï¼› äº§å“ç±»å‹è¾ƒå¤šæ—¶ï¼Œå·¥å‚çš„åˆ›å»ºé€»è¾‘å¯èƒ½è¿‡äºå¤æ‚ï¼Œä¸€æ—¦å‡ºé”™å¯èƒ½é€ æˆæ‰€æœ‰äº§å“çš„åˆ›å»ºå¤±è´¥ï¼Œä¸åˆ©äºç³»ç»Ÿçš„ç»´æŠ¤ã€‚</p></li></ul><h4 id="4-è¯´è¯´æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Ÿ">4.<strong>è¯´è¯´æŠ½è±¡å·¥å‚æ¨¡å¼</strong>ï¼Ÿ</h4><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯åœ¨ç®€å•å·¥å‚çš„åŸºç¡€ä¸Šå°†æœªæ¥<strong>å¯èƒ½éœ€è¦ä¿®æ”¹çš„ä»£ç æŠ½è±¡å‡ºæ¥</strong>ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹å¼è®©å­ç±»å»åšå†³å®šã€‚</p><ul><li>ã€<strong>ç®€å•å·¥å‚æ¨¡å¼ç¼ºç‚¹</strong>ã€‘ä»¥ä¸Šé¢çš„å’–å•¡å·¥å‚ä¸ºä¾‹ï¼ŒæŸå¤©æˆ‘çš„å£å‘³çªç„¶å˜äº†ï¼Œ<u>ä¸æƒ³å–å’–å•¡äº†æƒ³å–å•¤é…’ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç›´æ¥ä¿®æ”¹ç®€å•å·¥å‚é‡Œé¢çš„ä»£ç </u>ï¼Œè¿™ç§åšæ³•ä¸ä½†ä¸å¤Ÿä¼˜é›…ï¼Œä¹Ÿä¸ç¬¦åˆè½¯ä»¶è®¾è®¡çš„â€œå¼€é—­åŸåˆ™â€ï¼Œå› ä¸ºæ¯æ¬¡æ–°å¢å“ç±»éƒ½è¦ä¿®æ”¹åŸæ¥çš„ä»£ç ã€‚</li><li>ã€<strong>æŠ½è±¡å·¥å‚</strong>ã€‘<strong>æŠ½è±¡å·¥å‚é‡Œåªå£°æ˜æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°äº¤ç»™å­ç±»ï¼ˆå­å·¥å‚ï¼‰å»å®ç°</strong>ï¼Œè¿™ä¸ªæ—¶å€™å†æœ‰æ–°å¢å“ç±»çš„éœ€æ±‚ï¼Œåªéœ€è¦æ–°åˆ›å»ºä»£ç å³å¯ã€‚å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªå•¤é…’å·¥å‚è€Œä¸æ˜¯å’–å•¡å·¥å‚ã€‚</li></ul><h4 id="5-è£…é¥°å™¨æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ">5.<strong>è£…é¥°å™¨æ¨¡å¼æ˜¯ä»€ä¹ˆ</strong>ï¼Ÿ</h4><blockquote><p>ä¸å¤Ÿæ·±å…¥ã€‚</p></blockquote><p>è£…é¥°å™¨æ¨¡å¼æ˜¯æŒ‡<u>åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„åŠŸèƒ½</u>ï¼ŒåŒæ—¶<strong>åˆä¸æ”¹å˜å…¶ç»“æ„</strong>ã€‚</p><h2 id="9-2-åˆ†å¸ƒå¼é—®é¢˜ã€æ ¡æ‹›å¿…é—®ã€‘">9.2 åˆ†å¸ƒå¼é—®é¢˜ã€æ ¡æ‹›å¿…é—®ã€‘</h2><blockquote><p>éå¸¸ç³»ç»Ÿçš„æ€»ç»“æ–‡æ¡£ï¼š<a href="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E9%9D%A2%E8%AF%95%E7%B2%BE%E8%AE%B2/03%20%20%E9%9D%A2%E8%AF%95%E5%AE%98%E5%A6%82%E4%BD%95%E8%80%83%E5%AF%9F%E4%B8%8E%20CAP%20%E6%9C%89%E5%85%B3%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E7%90%86%E8%AE%BA%EF%BC%9F.md">åˆ†å¸ƒå¼ç›¸å…³ï¼šç¬¬ä¸€é¡µ</a></p></blockquote><p>CAP ç†è®ºæŒ‡çš„æ˜¯ä»€ä¹ˆï¼šCï¼ˆConsistencyï¼‰æ˜¯æ•°æ®ä¸€è‡´æ€§ã€Aï¼ˆAvailabilityï¼‰æ˜¯æœåŠ¡å¯ç”¨æ€§ã€Pï¼ˆPartition toleranceï¼‰æ˜¯åˆ†åŒºå®¹é”™æ€§ã€‚</p><ul><li><p><strong>é—®é¢˜å¼•å…¥</strong></p><p>ç°åœ¨æœ‰ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿ Aï¼Œå®ƒæœ‰ä¸€ä¸ªå‰¯æœ¬ A1ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ Client å†™æ•°æ®åˆ°ç³»ç»Ÿ Aï¼Œç„¶åæ•°æ®ä» A èŠ‚ç‚¹åŒæ­¥åˆ° A1 èŠ‚ç‚¹ï¼Œå†è¿”å›ç»™ Client æˆåŠŸçŠ¶æ€ã€‚</p><p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E9%9D%A2%E8%AF%95%E7%B2%BE%E8%AE%B2/assets/CgqCHl_-eW2ALOs5AAFBvaYD4f8199.png" alt="6.png"></p><p>ä½†ç”±äºç½‘ç»œæ˜¯ä¸å¯é çš„ï¼ŒèŠ‚ç‚¹ A å’Œ A1 çš„ç½‘ç»œéšæ—¶ä¼šå› ä¸ºä¸­æ–­è€Œå‡ºç°åˆ†åŒºã€‚æ‰€è°“ç½‘ç»œåˆ†åŒºå°±æ˜¯ç”±äºç½‘ç»œä¸é€šå¯¼è‡´èŠ‚ç‚¹ A å’Œ A1 è¢«éš”ç¦»åœ¨ä¸åŒçš„ç½‘ç»œå­é›†ä¸­ï¼Œæ­¤æ—¶èŠ‚ç‚¹ A çš„æ•°æ®å°±ä¸èƒ½åŠæ—¶åŒæ­¥åˆ°èŠ‚ç‚¹ A1 ä¸­äº†ã€‚</p><p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E9%9D%A2%E8%AF%95%E7%B2%BE%E8%AE%B2/assets/Ciqc1F_-eXaAcu6nAAE3Pk18sD8666.png" alt="7.png"></p></li></ul><h4 id="9-1-1-åœ¨CAPåŸºç¡€ä¸Šè®²è®²BASEï¼Ÿä¸¾å®ä¾‹è¯´è¯´ï¼Ÿ">9.1.1 åœ¨CAPåŸºç¡€ä¸Šè®²è®²BASEï¼Ÿä¸¾å®ä¾‹è¯´è¯´ï¼Ÿ</h4><p>BASE ç†è®ºï¼Œå®ƒæ˜¯ CAP ç†è®ºçš„å»¶ä¼¸ã€‚BASE æ˜¯ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰å’Œ Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªå•è¯çš„ç®€å†™ï¼Œä½œç”¨æ˜¯ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œç„¶åé€šè¿‡<strong>æœ€ç»ˆä¸€è‡´æ€§æ¥ä»£æ›¿å¼ºä¸€è‡´æ€§</strong>ï¼Œå®ƒæ˜¯ç›®å‰åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­æœ€å…·æŒ‡å¯¼æ„ä¹‰çš„ç»éªŒæ€»ç»“ã€‚</p><p>å…¶å®æ˜¯åšäº†â€œå¯ç”¨æ€§â€æ–¹é¢çš„å¦¥åï¼Œæ¯”å¦‚ï¼š</p><ul><li>ç”µå•†ç½‘ç«™åœ¨åŒåä¸€å¤§ä¿ƒç­‰è®¿é—®å‹åŠ›è¾ƒå¤§çš„æ—¶å€™ï¼Œå…³é—­å•†å“æ’è¡Œæ¦œç­‰æ¬¡è¦åŠŸèƒ½çš„å±•ç¤ºï¼Œä»è€Œä¿è¯å•†å“äº¤æ˜“ä¸»æµç¨‹çš„å¯ç”¨æ€§ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>æœåŠ¡é™çº§ï¼›</strong></li><li>ä¸ºäº†é”™å¼€åŒåä¸€é«˜å³°æœŸï¼Œç”µå•†ç½‘ç«™ä¼šå°†<strong>é¢„å”®å•†å“çš„æ”¯ä»˜æ—¶é—´</strong>å»¶åååˆ°äºŒååˆ†é’Ÿï¼Œè¿™å°±æ˜¯<strong>æµé‡å‰Šå³°</strong>ï¼›</li><li>åœ¨ä½ æŠ¢è´­å•†å“çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯å¸¸ç”¨çš„<strong>å»¶è¿Ÿé˜Ÿåˆ—</strong>ã€‚</li></ul><p>è½¯çŠ¶æ€å’Œæœ€ç»ˆä¸€è‡´æ€§æŒ‡çš„æ˜¯å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè¿™åŒæ ·æ˜¯<strong>ä¸ºäº†ç³»ç»Ÿå¯ç”¨æ€§è€Œç‰ºç‰²ä¸€æ®µæ—¶é—´çª—å†…çš„æ•°æ®ä¸€è‡´æ€§</strong>ï¼Œä»è€Œä¿è¯æœ€ç»ˆçš„æ•°æ®ä¸€è‡´æ€§çš„åšæ³•ã€‚</p><h4 id="9-1-2-äº¿çº§å•†å“åˆ†å¸ƒå¼å­˜å‚¨é—®é¢˜ï¼Ÿ">9.1.2 äº¿çº§å•†å“åˆ†å¸ƒå¼å­˜å‚¨é—®é¢˜ï¼Ÿ</h4><h5 id="1-å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ”¯æŒæµ·é‡å•†å“å­˜å‚¨çš„é«˜æ‰©å±•æ€§æ¶æ„ï¼Ÿ">1.å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ”¯æŒæµ·é‡å•†å“å­˜å‚¨çš„é«˜æ‰©å±•æ€§æ¶æ„ï¼Ÿ</h5><p><strong>ä»è¿™ä¸€ç‚¹å‡ºå‘ä¼šè€ƒå¯Ÿä½ Hashï¼ˆå“ˆå¸Œï¼‰åˆ†ç‰‡çš„å…·ä½“å®ç°åŸç†</strong>ã€‚</p><ol><li>ä»¥å•†å“ ID ä½œä¸ºå…³é”®å­—è¿›è¡Œåˆ†ç‰‡ï¼Œç³»ç»Ÿä¼šé€šè¿‡ä¸€ä¸ª Hash å‡½æ•°è®¡ç®—å•†å“ ID çš„ Hash å€¼ï¼Œç„¶åå–æ¨¡ï¼Œå°±èƒ½å¾—åˆ°å¯¹åº”çš„åˆ†ç‰‡ï¼›</li></ol><h5 id="2-åœ¨åšåˆ†åº“åˆ†è¡¨æ—¶ï¼ŒåŸºäº-Hash-å–æ¨¡å’Œä¸€è‡´æ€§-Hash-çš„æ•°æ®åˆ†ç‰‡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ">2.åœ¨åšåˆ†åº“åˆ†è¡¨æ—¶ï¼ŒåŸºäº Hash å–æ¨¡å’Œä¸€è‡´æ€§ Hash çš„æ•°æ®åˆ†ç‰‡æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h5><ol><li><strong>è§£å†³ Hash åˆ†ç‰‡çš„ç¼ºç‚¹ï¼Œæ—¢ä¿è¯æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Œåˆä¿è¯æ‰©å±•æ€§</strong> ï¼Œæœ€ç»ˆé‡‡ç”¨ä¸€è‡´æ€§ Hash ï¼šå®ƒæ˜¯æŒ‡å°†å­˜å‚¨èŠ‚ç‚¹å’Œæ•°æ®éƒ½æ˜ å°„åˆ°ä¸€ä¸ªé¦–å°¾ç›¸è¿çš„å“ˆå¸Œç¯ä¸Šã€‚</li><li>å…·ä½“è§å‰ï¼Œä¸€è‡´æ€§å“ˆå¸Œç›¸å…³ç®—æ³•æè¿°</li></ol><h5 id="3-åœ¨ç”µå•†å¤§ä¿ƒæ—¶æœŸï¼Œå¦‚ä½•å¯¹çƒ­ç‚¹å•†å“æ•°æ®åšå­˜å‚¨ç­–ç•¥-ï¼Ÿ">3.åœ¨ç”µå•†å¤§ä¿ƒæ—¶æœŸï¼Œå¦‚ä½•å¯¹çƒ­ç‚¹å•†å“æ•°æ®åšå­˜å‚¨ç­–ç•¥ ï¼Ÿ</h5><ul><li><p><strong>é—®é¢˜</strong></p><p>ä¸€è‡´æ€§ Hash æå‡äº†ç¨³å®šæ€§ï¼Œä½¿èŠ‚ç‚¹çš„åŠ å…¥å’Œé€€å‡ºä¸ä¼šé€ æˆå¤§è§„æ¨¡çš„æ•°æ®è¿ç§»ï¼Œä½†<strong>æœ¬è´¨ä¸Š Hash åˆ†ç‰‡æ˜¯ä¸€ç§é™æ€çš„åˆ†ç‰‡æ–¹å¼</strong>ï¼Œå¿…é¡»è¦æå‰è®¾å®šåˆ†ç‰‡çš„æœ€å¤§è§„æ¨¡ï¼Œ<strong>è€Œä¸”æ— æ³•é¿å…å•ä¸€çƒ­ç‚¹é—®é¢˜ï¼Œ</strong> æŸä¸€æ•°æ®è¢«æµ·é‡å¹¶å‘è¯·æ±‚åï¼Œä¸è®ºå¦‚ä½•è¿›è¡Œ Hashï¼Œæ•°æ®ä¹Ÿåªèƒ½å­˜åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿™åŠ¿å¿…ä¼šå¸¦æ¥çƒ­ç‚¹è¯·æ±‚é—®é¢˜ã€‚</p></li><li><p><strong>è§£å†³</strong></p><p><strong>åš Rangeï¼ˆèŒƒå›´ï¼‰åˆ†ç‰‡</strong>ã€‚ ä¸ Hash åˆ†ç‰‡ä¸åŒçš„æ˜¯ï¼ŒRange åˆ†ç‰‡èƒ½ç»“åˆä¸šåŠ¡é€»è¾‘è§„åˆ™ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬ç”¨ â€œCategoryï¼ˆå•†å“ç±»ç›®ï¼‰â€ ä½œä¸ºå…³é”®å­—è¿›è¡Œ<strong>åŠ¨æ€åˆ†ç‰‡æ—¶</strong>ï¼Œä¸æ˜¯ä»¥ç»Ÿä¸€çš„å•†å“ä¸€çº§ç±»ç›®ä¸ºæ ‡å‡†ï¼Œè€Œæ˜¯å¯ä»¥æŒ‰ç…§ä¸€ã€äºŒã€ä¸‰çº§ç±»ç›®è¿›è¡Œçµæ´»åˆ†ç‰‡ã€‚ä¾‹å¦‚ï¼Œå¯¹äºäº¬ä¸œå¼ºåŠ¿çš„ 3C å“ç±»ï¼Œå¯ä»¥æŒ‰ç…§ 3C çš„ä¸‰çº§å“ç±»è®¾ç½®åˆ†ç‰‡ï¼›å¯¹äºå¼±åŠ¿å“ç±»ï¼Œå¯ä»¥å…ˆæŒ‰ç…§ä¸€çº§å“ç±»è¿›è¡Œåˆ†ç‰‡ï¼Œè¿™æ ·ä¼šè®©åˆ†ç‰‡é—´çš„æ•°æ®æ›´åŠ å¹³è¡¡ã€‚</p><p><img src="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E9%9D%A2%E8%AF%95%E7%B2%BE%E8%AE%B2/assets/CgpVE1_-ed6AfUBMAAFtDc6PlH4881.png" alt="15.png"></p></li></ul><p><strong>4.å¼ºä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§çš„æ•°æ®å…±è¯†ç®—æ³•æ˜¯å¦‚ä½•å®ç°çš„</strong>ï¼Ÿ</p><h4 id="9-1-3-æµ·é‡å¹¶å‘ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ">9.1.3 æµ·é‡å¹¶å‘ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</h4><ul><li><p><strong>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</strong>ï¼Ÿ</p><p>ä¸€æ¬¡å¤§çš„æ“ä½œç”±å¤šä¸ªå°æ“ä½œç»„æˆï¼Œè¿™äº›<strong>å°çš„æ“ä½œåˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š</strong>ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦<strong>ä¿è¯è¿™äº›å°æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</strong>ã€‚</p><p>ä¸¾ä¸€ä¸ªå®ä¾‹ï¼š</p><ul><li>äº¬ä¸œæ—…è¡Œç³»ç»Ÿï¼Œæ‹†åˆ†æˆå¤šä¸ªå­ç³»ç»Ÿï¼Œå¦‚å•†å“ç³»ç»Ÿã€ä¿ƒé”€ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€‚ç”¨æˆ·ä¸‹å•æ—¶ï¼Œ<strong>è®¢å•ç³»ç»Ÿç”Ÿæˆè®¢å•ï¼Œå•†å“ç³»ç»Ÿæ‰£å‡åº“å­˜ï¼Œä¿ƒé”€ç³»ç»Ÿæ‰£å‡ä¼˜æƒ åˆ¸</strong>ï¼Œ<strong>åªæœ‰å½“ä¸‰ä¸ªç³»ç»Ÿçš„äº‹åŠ¡éƒ½æäº¤ä¹‹åï¼Œæ‰è®¤ä¸ºæ­¤æ¬¡ä¸‹å•æˆåŠŸ</strong>ï¼Œå¦åˆ™å¤±è´¥ã€‚</li></ul></li><li><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>æœ‰ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆTwo-Phase Commitï¼Œ2PCï¼‰ã€3PC ã€TCC å’ŒåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼ã€‚</p><ul><li><p><strong>é”™è¯¯å›ç­”</strong>ï¼šæ–¹æ¡ˆå¾ˆå¤šï¼Œå¯ä»¥é€‰æ‹© 2PC ï¼Œ2PC å®ç°çš„æµç¨‹æ˜¯â€¦</p></li><li><p><strong>é”™è¯¯åŸå› </strong>ï¼š å› ä¸ºåœ¨å®é™…å·¥ä½œä¸­ï¼Œ<strong>å¾ˆå°‘é‡‡ç”¨å‰å‡ ç§æ–¹æ¡ˆï¼ˆäº’è”ç½‘ä¸­è½åœ°æ–¹æ¡ˆä»£ä»·å¤§ï¼‰</strong>ï¼ŒåŸºæœ¬éƒ½æ˜¯åŸºäº MQ çš„å¯é æ¶ˆæ¯æŠ•é€’çš„æ–¹å¼æ¥å®ç°ã€‚</p></li><li><p><strong>æ­£ç¡®å›ç­”</strong>ï¼šå…ˆä»‹ç»ç›®å‰ä¸»æµå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿäº‹åŠ¡ä¸€è‡´æ€§çš„æ–¹æ¡ˆï¼ˆä¹Ÿå°±æ˜¯åŸºäº MQ çš„å¯é æ¶ˆæ¯æŠ•é€’çš„æœºåˆ¶ï¼‰ç„¶åå›ç­”å‡ºå¯å®ç°æ–¹æ¡ˆå’Œå…³é”®çŸ¥è¯†ç‚¹ã€‚å¦å¤–ï¼Œ<strong>ä¸ºäº†å’Œé¢è¯•å®˜è¿›ä¸€æ­¥äº¤æµï¼Œä½ å¯ä»¥æå‡º 2PC æˆ– TCC</strong> ï¼ˆè¿™æ˜¯ä¸€ç§äº¤æµæ–¹æ¡ˆï¼‰ã€‚</p></li><li><p><strong>å›ç­”ä¸€ã€åŸºäº MQ çš„å¯é æ¶ˆæ¯æŠ•é€’æ–¹æ¡ˆ</strong></p><ul><li><p><strong>ä»€ä¹ˆæ˜¯MQ</strong></p><p>æ ¸å¿ƒçš„äº”ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>Queue</strong>: çœŸæ­£å­˜å‚¨æ•°æ®çš„åœ°æ–¹</li><li><strong>Exchange</strong>: æ¥æ”¶è¯·æ±‚ï¼Œè½¬å­˜æ•°æ®</li><li><strong>Bind:</strong> æ”¶åˆ°è¯·æ±‚åå­˜å‚¨åˆ°å“ªé‡Œ</li><li><strong>æ¶ˆæ¯ç”Ÿäº§è€…</strong>:å‘é€æ•°æ®çš„åº”ç”¨</li><li><strong>æ¶ˆæ¯æ¶ˆè´¹è€…</strong>: å–å‡ºæ•°æ®å¤„ç†çš„åº”ç”¨</li></ol></li><li><p><strong>åœºæ™¯å®ä¾‹</strong></p><blockquote><p><strong>è®¢å•ç³»ç»Ÿï¼ˆ1ï¼‰å®Œæˆè®¢å•åï¼Œï¼ˆ2ï¼‰è´­ç‰©è½¦ç³»ç»Ÿå‡è´­ç‰©è½¦ä¸­çš„å•†å“</strong>ã€‚</p></blockquote><p><img src="https://i.loli.net/2021/09/05/B2uKDL8cyfhplis.png" alt="img"></p><ol><li><p>è®¢å•ç³»ç»Ÿåœ¨<strong>æ¶ˆæ¯é˜Ÿåˆ—ä¸Š</strong>å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼ˆæ²¡æœ‰åˆ›å»ºè®¢å•ï¼‰ï¼›</p></li><li><p>è®¢å•ç³»ç»Ÿç»™æ¶ˆæ¯æœåŠ¡å™¨å‘é€ä¸€ä¸ªâ€œåŠæ¶ˆæ¯â€ï¼›</p><blockquote><p>è¿™ä¸ªåŠæ¶ˆæ¯ä¸æ˜¯è¯´æ¶ˆæ¯å†…å®¹ä¸å®Œæ•´ï¼Œå®ƒåŒ…å«çš„å†…å®¹å°±æ˜¯å®Œæ•´çš„æ¶ˆæ¯å†…å®¹ï¼ŒåŠæ¶ˆæ¯å’Œæ™®é€šæ¶ˆæ¯çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œ<strong>åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸å¯è§çš„</strong>ã€‚</p></blockquote></li><li><p>åŠæ¶ˆæ¯å‘é€æˆåŠŸåï¼Œ<strong>è®¢å•ç³»ç»Ÿå°±å¯ä»¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡äº†</strong>ï¼Œåœ¨è®¢å•åº“ä¸­åˆ›å»ºä¸€æ¡è®¢å•è®°å½•ï¼Œå¹¶æäº¤è®¢å•åº“çš„æ•°æ®åº“äº‹åŠ¡ã€‚</p></li><li><p>ç„¶å<strong>æ ¹æ®æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœå†³å®šæäº¤æˆ–è€…å›æ»šäº‹åŠ¡æ¶ˆæ¯</strong>ã€‚</p><blockquote><p>å¦‚æœè®¢å•åˆ›å»ºæˆåŠŸï¼Œé‚£å°±æäº¤äº‹åŠ¡æ¶ˆæ¯ï¼Œè´­ç‰©è½¦ç³»ç»Ÿå°±å¯ä»¥æ¶ˆè´¹åˆ°è¿™æ¡æ¶ˆæ¯ç»§ç»­åç»­çš„æµç¨‹ã€‚å¦‚æœè®¢å•åˆ›å»ºå¤±è´¥ï¼Œé‚£å°±å›æ»šäº‹åŠ¡æ¶ˆæ¯ï¼Œè´­ç‰©è½¦ç³»ç»Ÿå°±ä¸ä¼šæ”¶åˆ°è¿™æ¡æ¶ˆæ¯ã€‚</p></blockquote></li><li><p>è´­ç‰©ç³»ç»Ÿæ¶ˆè´¹è¿™æ¡æ‹¿åˆ°çš„è®¢å•ç³»ç»Ÿæ¶ˆæ¯ï¼ˆ<strong>ç¡®è®¤äº†è®¢å•ç³»ç»Ÿäº‹åŠ¡æ‰§è¡Œå®Œæ¯•</strong>ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥è´­ç‰©æ“ä½œ</p></li></ol></li></ul></li></ul></li></ul><h4 id="9-1-4-åˆ†å¸ƒå¼é”é—®é¢˜">9.1.4 åˆ†å¸ƒå¼é”é—®é¢˜</h4><blockquote><p><a href="http://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E9%9D%A2%E8%AF%95%E7%B2%BE%E8%AE%B2/06%20%20%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%AD%EF%BC%8C%E5%A6%82%E4%BD%95%E5%9B%9E%E7%AD%94%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9F.md">06 åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¦‚ä½•å›ç­”é”çš„å®ç°åŸç†ï¼Ÿ</a></p></blockquote><p>åˆ†å¸ƒå¼é”æ˜¯è§£å†³åè°ƒåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´ï¼ŒåŒæ­¥è®¿é—®å…±äº«èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚è¯¦ç»†æ¥è®²ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œ<strong>å¤šä¸ªç³»ç»Ÿåœ¨åŒæ—¶æ“ä½œå…±äº«èµ„æº</strong>ï¼ˆå¦‚å†™æ•°æ®ï¼‰æ—¶ï¼Œå‘èµ·æ“ä½œçš„ç³»ç»Ÿé€šå¸¸ä¼šé€šè¿‡ä¸€ç§æ–¹å¼å»åè°ƒå…¶ä»–ç³»ç»Ÿï¼Œç„¶åè·å–è®¿é—®æƒé™ï¼Œå¾—åˆ°è®¿é—®æƒé™åæ‰å¯ä»¥å†™å…¥æ•°æ®ï¼Œå…¶ä»–ç³»ç»Ÿå¿…é¡»ç­‰å¾…æƒé™é‡Šæ”¾ã€‚</p><img src="https://i.loli.net/2021/09/05/f7Fh83wrnqvH6PK.png" alt="image-20210905232542573" style="zoom:80%;" /><ul><li><p><strong>åŸºäºredisçš„åˆ†å¸ƒå¼é”</strong></p><p><strong>ä½¿ç”¨setnxå‘½ä»¤åŠ é”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wrongGetLock1</span><span class="params">(Jedis jedis, String lockKey, String requestId, <span class="keyword">int</span> expireTime)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€æ­¥ï¼šåŠ é”</span></span><br><span class="line">    Long result = jedis.setnx(lockKey, requestId);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// ç¬¬äºŒæ­¥ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        jedis.expire(lockKey, expireTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>setnxå‘½ä»¤ï¼Œæ„æ€å°±æ˜¯ set if not existï¼Œ<strong>å¦‚æœlockKeyä¸å­˜åœ¨ï¼ŒæŠŠkeyå­˜å…¥Redis</strong>ï¼Œä¿å­˜æˆåŠŸåå¦‚æœresultè¿”å›1ï¼Œè¡¨ç¤ºè®¾ç½®æˆåŠŸï¼Œå¦‚æœé1ï¼Œè¡¨ç¤ºå¤±è´¥ï¼Œåˆ«çš„çº¿ç¨‹å·²ç»è®¾ç½®è¿‡äº†ã€‚</p></li><li><p>expire()ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼Œå‡è®¾ï¼Œå¦‚æœä¸€ä¸ªé”setåï¼Œä¸€ç›´ä¸åˆ æ‰ï¼Œé‚£è¿™ä¸ªé”ç›¸å½“äºä¸€ç›´å­˜åœ¨ï¼Œäº§ç”Ÿæ­»é”ã€‚</p></li></ul></li></ul><p><strong>è§£å†³setnxä¸expireä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ</strong></p><ul><li><p>åŠ é”æ€»å…±åˆ†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥jedis.setnxï¼Œç¬¬äºŒæ­¥jedis.expireè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œsetnxä¸expireä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå¦‚æœç¨‹åºæ‰§è¡Œå®Œç¬¬ä¸€æ­¥åå¼‚å¸¸äº†ï¼Œç¬¬äºŒæ­¥jedis.expire(lockKey, expireTime)æ²¡æœ‰å¾—åˆ°æ‰§è¡Œï¼Œ<strong>ç›¸å½“äºè¿™ä¸ªé”æ²¡æœ‰è¿‡æœŸæ—¶é—´ï¼Œæœ‰äº§ç”Ÿæ­»é”çš„å¯èƒ½</strong>ã€‚</p></li><li><p>è§£å†³æ–¹æ¡ˆä¸ºï¼šä¸€æ­¥æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>Â <span class="class"><span class="keyword">class</span>Â <span class="title">RedisLockDemo</span>Â </span></span><br><span class="line"><span class="class"></span>&#123;Â Â Â </span><br><span class="line"> <span class="keyword">private</span>Â <span class="keyword">static</span>Â <span class="keyword">final</span>Â StringÂ SET_IF_NOT_EXISTÂ =Â <span class="string">&quot;NX&quot;</span>;Â Â </span><br><span class="line">        <span class="keyword">private</span>Â <span class="keyword">static</span>Â <span class="keyword">final</span>Â StringÂ SET_WITH_EXPIRE_TIMEÂ =Â <span class="string">&quot;PX&quot;</span>;Â Â Â </span><br><span class="line">        <span class="comment">/**Â Â Â Â Â </span></span><br><span class="line"><span class="comment">        *Â è·å–åˆ†å¸ƒå¼é”Â Â Â Â </span></span><br><span class="line"><span class="comment">        *Â <span class="doctag">@param</span>Â jedisÂ Rediså®¢æˆ·ç«¯Â Â Â Â Â </span></span><br><span class="line"><span class="comment">        *Â <span class="doctag">@param</span>Â lockKeyÂ é”Â Â Â Â </span></span><br><span class="line"><span class="comment">        *Â <span class="doctag">@param</span>Â requestIdÂ è¯·æ±‚æ ‡è¯†Â Â Â Â Â </span></span><br><span class="line"><span class="comment">        *Â <span class="doctag">@param</span>Â expireTimeÂ è¶…æœŸæ—¶é—´Â Â Â Â Â </span></span><br><span class="line"><span class="comment">        *Â <span class="doctag">@return</span>Â æ˜¯å¦è·å–åŠŸÂ Â Â Â Â */</span>Â Â Â </span><br><span class="line">            <span class="function"><span class="keyword">public</span>Â <span class="keyword">static</span>Â <span class="keyword">boolean</span>Â <span class="title">getLock</span><span class="params">(JedisÂ jedis,Â StringÂ lockKey,Â StringÂ requestId,Â <span class="keyword">int</span>Â expireTime)</span></span></span><br><span class="line"><span class="function">   </span>&#123;Â Â Â Â </span><br><span class="line">           <span class="comment">//Â ä¸¤æ­¥åˆäºŒä¸ºä¸€ï¼Œä¸€è¡Œä»£ç åŠ é”å¹¶è®¾ç½®Â +Â è¿‡æœŸæ—¶é—´ã€‚Â Â Â Â Â Â Â </span></span><br><span class="line">     <span class="keyword">if</span>Â (<span class="number">1</span>Â ==Â jedis.set(lockKey,Â requestId,Â SET_IF_NOT_EXIST,Â SET_WITH_EXPIRE_TIME,Â expireTime))</span><br><span class="line">      &#123;Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">            <span class="keyword">return</span>Â <span class="keyword">true</span>;<span class="comment">//åŠ é”æˆåŠŸÂ Â Â Â Â Â Â Â </span></span><br><span class="line">      &#125;Â Â Â Â Â Â Â </span><br><span class="line">      <span class="keyword">return</span>Â <span class="keyword">false</span>;<span class="comment">//åŠ é”å¤±è´¥Â Â Â </span></span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// è§£é”ï¼šå¯¹åº”delåˆ é™¤keyå³å¯</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span>Â <span class="keyword">static</span>Â <span class="keyword">void</span>Â <span class="title">unLock</span><span class="params">(JedisÂ jedis,Â StringÂ lockKey,Â StringÂ requestId)</span>Â </span></span><br><span class="line"><span class="function">  </span>&#123;Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">      <span class="comment">//Â ç¬¬ä¸€æ­¥ï¼šÂ ä½¿ç”¨Â requestIdÂ åˆ¤æ–­åŠ é”ä¸è§£é”æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯Â Â Â Â </span></span><br><span class="line">      <span class="keyword">if</span>Â (requestId.equals(jedis.get(lockKey)))Â </span><br><span class="line">      &#123;Â Â Â Â Â Â Â </span><br><span class="line">          <span class="comment">//Â ç¬¬äºŒæ­¥ï¼šÂ è‹¥åœ¨æ­¤æ—¶ï¼Œè¿™æŠŠé”çªç„¶ä¸æ˜¯è¿™ä¸ªå®¢æˆ·ç«¯çš„ï¼Œåˆ™ä¼šè¯¯è§£é”Â Â Â Â Â </span></span><br><span class="line">          jedis.del(lockKey);Â Â Â Â </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>â€‹</p><ul><li><p><strong>åŸºäºZoopkeeperçš„åˆ†å¸ƒå¼é”</strong></p><blockquote><p>syncï¼Œlockä¹Ÿåªèƒ½ä¿è¯ä½ å½“å‰æœºå™¨çº¿ç¨‹å®‰å…¨ï¼Œè¿™æ ·åˆ†å¸ƒå¼è®¿é—®è¿˜æ˜¯æœ‰é—®é¢˜ã€‚</p><p>å»ºè®®å‚è€ƒï¼š<a href="https://www.cnblogs.com/aobing/p/12650036.html">https://www.cnblogs.com/aobing/p/12650036.html</a></p></blockquote><p>ä¸€ä¸ªæœºå™¨æ¥æ”¶åˆ°äº†è¯·æ±‚ä¹‹åï¼Œå…ˆè·å– zookeeper ä¸Šçš„ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼ˆzkä¼šåˆ›å»ºä¸€ä¸ª znodeï¼‰ï¼Œæ‰§è¡Œæ“ä½œï¼›ç„¶åå¦å¤–ä¸€ä¸ªæœºå™¨ä¹Ÿ<strong>å°è¯•å»åˆ›å»º</strong>é‚£ä¸ª znodeï¼Œç»“æœå‘ç°è‡ªå·±åˆ›å»ºä¸äº†ï¼Œå› ä¸ºè¢«åˆ«äººåˆ›å»ºäº†ï¼Œé‚£åªèƒ½ç­‰å¾…ï¼Œç­‰ç¬¬ä¸€ä¸ªæœºå™¨æ‰§è¡Œå®Œäº†æ–¹å¯æ‹¿åˆ°é”ã€‚</p><p>ä¸‹é¢æ˜¯åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹çš„æƒ…å†µï¼š</p><ol><li><p>å®¢æˆ·ç«¯è°ƒç”¨create()æ–¹æ³•åˆ›å»ºåä¸ºâ€œ/dlm-locks/lockname/lock-â€çš„ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ã€‚</p></li><li><p>å®¢æˆ·ç«¯è°ƒç”¨getChildren(â€œlocknameâ€)æ–¹æ³•æ¥è·å–æ‰€æœ‰å·²ç»åˆ›å»ºçš„å­èŠ‚ç‚¹ã€‚</p></li><li><p>å®¢æˆ·ç«¯è·å–åˆ°æ‰€æœ‰å­èŠ‚ç‚¹pathä¹‹åï¼Œå¦‚æœå‘ç°<strong>è‡ªå·±åœ¨æ­¥éª¤1ä¸­åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯æ‰€æœ‰èŠ‚ç‚¹ä¸­åºå·æœ€å°</strong>çš„ï¼Œå°±æ˜¯çœ‹è‡ªå·±åˆ›å»ºçš„åºåˆ—å·æ˜¯å¦æ’ç¬¬ä¸€ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€ï¼Œé‚£ä¹ˆ<strong>å°±è®¤ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯è·å¾—äº†é”</strong>ï¼Œåœ¨å®ƒå‰é¢æ²¡æœ‰åˆ«çš„å®¢æˆ·ç«¯æ‹¿åˆ°é”ã€‚</p></li><li><p>å¦‚æœåˆ›å»ºçš„èŠ‚ç‚¹ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹ä¸­éœ€è¦æœ€å°çš„ï¼Œé‚£ä¹ˆåˆ™<strong>ç›‘è§†æ¯”è‡ªå·±åˆ›å»ºèŠ‚ç‚¹çš„åºåˆ—å·å°çš„æœ€å¤§çš„èŠ‚ç‚¹ï¼Œè¿›å…¥ç­‰å¾…</strong>ã€‚ç›´åˆ°ä¸‹æ¬¡ç›‘è§†çš„<strong>å­èŠ‚ç‚¹å˜æ›´çš„æ—¶å€™</strong>ï¼Œå†è¿›è¡Œå­èŠ‚ç‚¹çš„è·å–ï¼Œåˆ¤æ–­æ˜¯å¦è·å–é”ã€‚</p></li></ol></li><li><p><strong>åŸºäºå…³ç³»å‹æ•°æ®åº“ MySQL å®ç°åˆ†å¸ƒå¼é”</strong></p><blockquote><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/6844904137172189198">https://juejin.cn/post/6844904137172189198</a></p></blockquote><p>åˆ©ç”¨ Mysql çš„é”è¡¨ï¼Œåˆ›å»ºä¸€å¼ è¡¨ï¼Œè®¾ç½®ä¸€ä¸ª UNIQUE KEYï¼ˆå¦‚ï¼Œ<strong>åˆ©ç”¨ä¸»é”®IDçš„å”¯ä¸€æ€§</strong>ï¼‰ è¿™ä¸ª KEY å°±æ˜¯è¦é”çš„ KEYï¼Œæ‰€ä»¥åŒä¸€ä¸ª KEY åœ¨mysqlè¡¨é‡Œåªèƒ½æ’å…¥ä¸€æ¬¡äº†ã€‚</p><blockquote><p>è¿™æ ·å¯¹é”çš„ç«äº‰å°±äº¤ç»™äº†æ•°æ®åº“ï¼Œå¤„ç†åŒä¸€ä¸ª KEY æ•°æ®åº“ä¿è¯äº†åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½æ’å…¥æˆåŠŸï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½ä¼šæ’å…¥å¤±è´¥ã€‚</p></blockquote><p>å®šä¹‰åŠ é”ã€è§£é”ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span>Â <span class="title">lock</span>Â ï¼šÂ Â </span></span><br><span class="line"><span class="function">    <span class="title">exec</span>Â <span class="title">sql</span>:</span>Â insertÂ intoÂ lockedtableÂ (xxx)Â valuesÂ (xxx)Â Â Â Â </span><br><span class="line">    <span class="keyword">if</span>Â resultÂ ==Â trueÂ :Â Â Â Â Â Â Â </span><br><span class="line">         <span class="keyword">return</span>Â trueÂ Â Â Â </span><br><span class="line">    <span class="keyword">else</span>Â :Â Â Â Â Â Â Â Â </span><br><span class="line">         <span class="keyword">return</span>Â falsedefÂ </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">unlock</span>Â ï¼šÂ Â Â # è§£é”å°±æ˜¯åˆ é™¤</span></span><br><span class="line"><span class="function"> <span class="title">exec</span>Â <span class="title">sql</span>:</span>Â deleteÂ <span class="keyword">from</span>Â lockedOrderÂ whereÂ order_id=<span class="string">&#x27;order_id&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="9-3-å…¶å®ƒé—®é¢˜">9.3 å…¶å®ƒé—®é¢˜</h2><h4 id="1-ã€å­—èŠ‚-æ‡‚è½¦å¸ã€‘ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ">1. ã€å­—èŠ‚-æ‡‚è½¦å¸ã€‘ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ</h4><blockquote><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/f049ac7e2220">https://www.jianshu.com/p/f049ac7e2220</a></p></blockquote><p>è·¨åŸŸï¼Œæ˜¯æŒ‡æµè§ˆå™¨ä¸èƒ½æ‰§è¡Œå…¶ä»–ç½‘ç«™çš„è„šæœ¬ã€‚å®ƒæ˜¯ç”±<strong>æµè§ˆå™¨çš„åŒæºç­–ç•¥</strong>é€ æˆçš„ï¼Œæ˜¯æµè§ˆå™¨å¯¹JavaScriptå®æ–½çš„å®‰å…¨é™åˆ¶ã€‚</p><p>åŒæºç­–ç•¥é™åˆ¶äº†ä¸€ä¸‹è¡Œä¸ºï¼š</p><ol><li><p>Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–</p></li><li><p>DOM å’Œ JS å¯¹è±¡æ— æ³•è·å–</p></li><li><p>Ajaxè¯·æ±‚å‘é€ä¸å‡ºå»</p></li></ol><p>å…·ä½“çš„ä¸€äº›å®ä¾‹ï¼š</p><ol><li><p><strong>éè·¨åŸŸ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxxyyy.cn/index.html è°ƒç”¨ http://www.xxxyyy.cn/server.php éè·¨åŸŸ</span><br></pre></td></tr></table></figure></li><li><p><strong>è·¨åŸŸï¼šä¸»åŸŸä¸åŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxxyyy.cn/index.html è°ƒç”¨  http://www.xxx.cn/server.php</span><br></pre></td></tr></table></figure></li><li><p><strong>è·¨åŸŸï¼šå­åŸŸåä¸åŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://abc.xxxyyy.cn/index.html è°ƒç”¨  http://def.xxx.cn/server.php</span><br></pre></td></tr></table></figure></li><li><p><strong>è·¨åŸŸï¼šç«¯å£ä¸åŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxx.cn:**8080**/index.html è°ƒç”¨  http://www.xxx.cn/server.php</span><br></pre></td></tr></table></figure></li><li><p><strong>è·¨åŸŸï¼šåè®®ä¸åŒ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**https**://www.xxx.cn/index.html è°ƒç”¨  **http**://www.xxx.cn/server.php</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ ¡æ‹›ç¬”è®° </category>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡æ‹› </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
