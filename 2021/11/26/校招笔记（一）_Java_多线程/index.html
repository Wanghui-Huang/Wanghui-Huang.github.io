<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_å¤šçº¿ç¨‹ | royhuang's blog</title><meta name="keywords" content="JAVA,æ ¡æ‹›"><meta name="author" content="Wanghui Huang"><meta name="copyright" content="Wanghui Huang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æˆ‘çš„æ ¡æ‹›è®°å½•ï¼šæ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢ ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚       å¤‡æ³¨     ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰ è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼ŒLeetcode-Top100 æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚ è¡¥å……ç»ƒä¹ ï¼šcodeTop   è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰ æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨ C++åç«¯åç»­æ›´æ–°    æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡     æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ">
<meta property="og:type" content="article">
<meta property="og:title" content="æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_å¤šçº¿ç¨‹">
<meta property="og:url" content="https://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E5%A4%9A%E7%BA%BF%E7%A8%8B/index.html">
<meta property="og:site_name" content="royhuang&#39;s blog">
<meta property="og:description" content="æˆ‘çš„æ ¡æ‹›è®°å½•ï¼šæ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢ ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚       å¤‡æ³¨     ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰ è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼ŒLeetcode-Top100 æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚ è¡¥å……ç»ƒä¹ ï¼šcodeTop   è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰ æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨ C++åç«¯åç»­æ›´æ–°    æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡     æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hwh.zone/img/about-bg.jpg">
<meta property="article:published_time" content="2021-11-26T12:01:58.657Z">
<meta property="article:modified_time" content="2021-11-27T08:24:49.982Z">
<meta property="article:author" content="Wanghui Huang">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="æ ¡æ‹›">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hwh.zone/img/about-bg.jpg"><link rel="shortcut icon" href="/img/cat.jpg"><link rel="canonical" href="https://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":"true# copy button","highlightLang":false,"highlightHeightLimit":400},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":100,"languages":{"author":"ä½œè€…: Wanghui Huang","link":"é“¾æ¥: ","source":"æ¥æº: royhuang's blog","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_å¤šçº¿ç¨‹',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-27 16:24:49'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cat.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">28</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">27</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">17</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ç›®å½•</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> aboutME</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/about-bg.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">royhuang's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ç›®å½•</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> aboutME</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_å¤šçº¿ç¨‹</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-11-26T12:01:58.657Z" title="å‘è¡¨äº 2021-11-26 20:01:58">2021-11-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-11-27T08:24:49.982Z" title="æ›´æ–°äº 2021-11-27 16:24:49">2021-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/">æ ¡æ‹›ç¬”è®°</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0/JAVA/">JAVA</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">9.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>34åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_å¤šçº¿ç¨‹"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>æˆ‘çš„æ ¡æ‹›è®°å½•ï¼š<a target="_blank" rel="noopener" href="https://www.hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E9%9B%B6%EF%BC%89_%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2/">æ ¡æ‹›ç¬”è®°ï¼ˆé›¶ï¼‰_å†™åœ¨å‰é¢</a> ï¼Œä»¥ä¸‹æ˜¯æ ¡æ‹›ç¬”è®°æ€»ç›®å½•ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>ç®—æ³•èƒ½åŠ›ï¼ˆâ€œåˆ·é¢˜â€ï¼‰</strong></td>
<td style="text-align:center">è¿™éƒ¨åˆ†å°±æ˜¯è€—æ—¶é—´å¤šç»ƒä¹ ï¼Œ<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problem-list/2cktkvj/">Leetcode-Top100</a> æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</td>
<td style="text-align:center">è¡¥å……ç»ƒä¹ ï¼š<a target="_blank" rel="noopener" href="https://codetop.cc/">codeTop</a></td>
</tr>
<tr>
<td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸Š)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_Java%E5%85%A5%E9%97%A8/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_Javaå…¥é—¨</a></td>
<td style="text-align:center">C++åç«¯åç»­æ›´æ–°</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é¢å¯¹å¯¹è±¡</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%9B%86%E5%90%88/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é›†åˆ</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E5%A4%9A%E7%BA%BF%E7%A8%8B/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_å¤šçº¿ç¨‹</a></td>
<td style="text-align:center">ğŸš©</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%94%81/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_é”</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_JVM/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰__Java_JVM</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><strong>è®¡ç®—æœºåŸºç¡€(ä¸‹)ï¼ˆâ€œå…«è‚¡â€ï¼‰</strong></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_Linux&amp;Git/">æ ¡æ‹›ç¬”è®°ï¼ˆäºŒï¼‰__è®¡ç®—æœºåŸºç¡€_Linux&amp;Git</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸‰ï¼‰__è®¡ç®—æœºåŸºç¡€_è®¡ç®—æœºç½‘ç»œ</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰__è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_MySQL/">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰__è®¡ç®—æœºåŸºç¡€_MySQL</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_Redis/">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰__è®¡ç®—æœºåŸºç¡€_Redis</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰__è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="https://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AB%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E5%9C%BA%E6%99%AF%E5%92%8C%E6%99%BA%E5%8A%9B%E9%A2%98/">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰__è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"><a href="http://hwh.zone/2021/11/25/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B9%9D%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E7%9B%B8%E5%85%B3%E8%A1%A5%E5%85%85/">æ ¡æ‹›ç¬”è®°ï¼ˆä¹ï¼‰__è®¡ç®—æœºåŸºç¡€_ç›¸å…³è¡¥å……</a></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"><strong>é¡¹ç›®&amp;å®ä¹ </strong></td>
<td style="text-align:center">ä¸»è¦æ˜¯æ€ä¹ˆå‡†å¤‡é¡¹ç›®ï¼Œåç»­æ›´æ–°</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h2 id="1-4-å¤šçº¿ç¨‹">1.4 å¤šçº¿ç¨‹</h2>
<h4 id="0-ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•è®©ä»–ä»¬æŒ‰é¡ºåºæ‰“å°Aã€Bã€Cï¼Ÿå¦‚æœæ˜¯å¾ªç¯æ‰“å°10æ¬¡å‘¢ï¼Ÿä¾æ¬¡æ‰“å°1-100å‘¢ï¼Ÿäº¤æ›¿æ‰“å°å¥‡å¶10æ¬¡å‘¢ï¼Ÿ">0.<strong>ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•è®©ä»–ä»¬æŒ‰é¡ºåºæ‰“å°Aã€Bã€Cï¼Ÿå¦‚æœæ˜¯å¾ªç¯æ‰“å°10æ¬¡å‘¢ï¼Ÿä¾æ¬¡æ‰“å°1~100å‘¢ï¼Ÿäº¤æ›¿æ‰“å°å¥‡å¶10æ¬¡å‘¢ï¼Ÿ</strong></h4>
<blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/370130458">https://zhuanlan.zhihu.com/p/370130458</a></p>
</blockquote>
<h5 id="0-1-synchronized-æ¡ä»¶å˜é‡">0.1 <strong>synchronized + æ¡ä»¶å˜é‡</strong></h5>
<ol>
<li>
<p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆå¾ªç¯æ‰“å°1æ¬¡ï¼‰</p>
<p>æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ–°å»ºä¸‰ä¸ªçº¿ç¨‹1ã€2ã€3 ï¼Œåˆ†åˆ«è´Ÿè´£æ‰“å°Aã€Bã€Cï¼›åŒæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼š<code>num%3==å½“å‰çº¿ç¨‹æ¡ä»¶å˜é‡?</code> ï¼›</li>
<li>æŠŠæ‰“å°çš„ä»£ç ç”¨synchronized åŠ é”ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°é”åï¼Œ<strong>whileå¾ªç¯åˆ¤æ–­</strong>æ˜¯å¦æ»¡è¶³å½“å‰çº¿ç¨‹çš„æ¡ä»¶å˜é‡ ï¼›</li>
<li><strong>å¦‚æœæ»¡è¶³</strong> ï¼Œä¾¿æ‰§è¡Œåç»­é€»è¾‘æ‰“å°å½“å‰çº¿ç¨‹ï¼Œä¹‹å<strong>notifyall()å”¤é†’å…¶å®ƒçº¿ç¨‹</strong>ï¼›</li>
<li><strong>å¦‚æœä¸æ»¡è¶³</strong>ï¼Œæ‰§è¡Œwaitç­‰å¾…é‡Šæ”¾é”ï¼›</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wait_Notify_ACB</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;  <span class="comment">// targetNum ï¼š æ¯ä¸ªçº¿ç¨‹åº”è¯¥æ»¡è¶³çš„å¯¹åº”æ¡ä»¶å˜é‡</span></span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span> (num % <span class="number">3</span> != targetNum) </span><br><span class="line">                &#123;   <span class="comment">// while ï¼šçº¿ç¨‹é˜»å¡åœ¨wait(),å†æ¬¡è¢«å”¤é†’åº”è¯¥å…ˆæ£€æŸ¥ä¸‹æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æœªå¿…è½®åˆ°å½“å‰çº¿ç¨‹æ‰§è¡Œï¼›ç”¨ifä¼šå¯¼è‡´ç›´æ¥å¾€ä¸‹æ‰§è¡Œã€‚</span></span><br><span class="line">                    <span class="keyword">try</span> </span><br><span class="line">                    &#123;</span><br><span class="line">                        LOCK.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">                    &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                num++;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Wait_Notify_ACB  wait_notify_acb = <span class="keyword">new</span> Wait_Notify_ACB ();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆå¾ªç¯æ‰“å°10æ¬¡ï¼‰</p>
<p>æ‰“å°10æ¬¡ï¼Œåªéœ€è®©ä¸‰ä¸ªçº¿ç¨‹ï¼Œå°è¯•å»ç«äº‰10æ¬¡é”å³å¯ã€‚æ‰€ä»¥åœ¨<strong>synchronizedå‰åŠ ä¸Šforå¾ªç¯</strong>å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wait_Notify_ACB</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;  <span class="comment">// targetNum ï¼š æ¯ä¸ªçº¿ç¨‹åº”è¯¥æ»¡è¶³çš„å¯¹åº”æ¡ä»¶å˜é‡</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i&lt;<span class="number">10</span> ;i++)</span><br><span class="line">      &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span> (num % <span class="number">3</span> != targetNum) </span><br><span class="line">                &#123;   <span class="comment">// while ï¼šçº¿ç¨‹é˜»å¡åœ¨wait(),å†æ¬¡è¢«å”¤é†’åº”è¯¥å…ˆæ£€æŸ¥ä¸‹æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æœªå¿…è½®åˆ°å½“å‰çº¿ç¨‹æ‰§è¡Œï¼›ç”¨ifä¼šå¯¼è‡´ç›´æ¥å¾€ä¸‹æ‰§è¡Œã€‚</span></span><br><span class="line">                    <span class="keyword">try</span> </span><br><span class="line">                    &#123;</span><br><span class="line">                        LOCK.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">                    &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                num++;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Wait_Notify_ACB  wait_notify_acb = <span class="keyword">new</span> Wait_Notify_ACB ();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; </span><br><span class="line">        &#123;</span><br><span class="line">            wait_notify_acb.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆæ‰“å°1~100)</p>
<p>è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œsynchronized ä¸­åŠ é”å‡½æ•°å¯¹num+1ï¼Œä¿è¯åªè¦æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wait_Notify_100</span> </span>&#123;</span><br><span class="line">â€‹</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxnum = <span class="number">10</span>;</span><br><span class="line">â€‹</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LOCK) &#123;</span><br><span class="line">                <span class="keyword">while</span> (num % <span class="number">3</span> != targetNum) &#123; <span class="comment">//æƒ³æƒ³è¿™é‡Œä¸ºä»€ä¹ˆä¸èƒ½ç”¨ifä»£æ›¿ï¼Œæƒ³ä¸èµ·æ¥å¯ä»¥çœ‹å…¬ä¼—å·ä¸Šä¸€ç¯‡æ–‡ç« </span></span><br><span class="line">                    <span class="keyword">if</span>(num &gt;= maxnum)&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        LOCK.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(num &gt;= maxnum)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                num++;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: &quot;</span> + num);</span><br><span class="line">                LOCK.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Wait_Notify_100  wait_notify_100 = <span class="keyword">new</span> Wait_Notify_100 ();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            wait_notify_100.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;thread1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            wait_notify_100.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;thread2&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            wait_notify_100.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;thread3&quot;</span>).start();</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>synchronized + æ¡ä»¶å˜é‡</strong>ï¼ˆå¥‡å¶æ‰“å°10æ¬¡ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Wait_Notify_Odd_Even</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object monitor = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> count;</span><br><span class="line">    Wait_Notify_Odd_Even(<span class="keyword">int</span> initCount) &#123;</span><br><span class="line">        <span class="keyword">this</span>.count = initCount;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printOddEven</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (monitor) &#123;</span><br><span class="line">            <span class="keyword">while</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> <span class="comment">// è¿™é‡Œä¸ç”¨whileå¾ªç¯åˆ¤æ–­ï¼Œæ˜¯å› ä¸ºä¸‹æ¬¡notifyAllçš„ä¸€å®šæ˜¯å¥‡æ•°æˆ–å¶æ•°</span></span><br><span class="line">                &#123;</span><br><span class="line">                    System.out.print( Thread.currentThread().getName() + <span class="string">&quot;ï¼š&quot;</span>);</span><br><span class="line">                    System.out.println(++count);</span><br><span class="line">                    monitor.notifyAll();</span><br><span class="line">                    monitor.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é˜²æ­¢count=10åï¼Œwhile()å¾ªç¯ä¸å†æ‰§è¡Œï¼Œæœ‰å­çº¿ç¨‹è¢«é˜»å¡æœªè¢«å”¤é†’ï¼Œå¯¼è‡´ä¸»çº¿ç¨‹ä¸èƒ½é€€å‡º</span></span><br><span class="line">            monitor.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Wait_Notify_Odd_Even waitNotifyOddEven = <span class="keyword">new</span> Wait_Notify_Odd_Even(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(waitNotifyOddEven::printOddEven, <span class="string">&quot;odd&quot;</span>).start();</span><br><span class="line">        Thread.sleep(<span class="number">10</span>); <span class="comment">//ä¸ºäº†ä¿è¯çº¿ç¨‹oddå…ˆæ‹¿åˆ°é”</span></span><br><span class="line">        <span class="keyword">new</span> Thread(waitNotifyOddEven::printOddEven, <span class="string">&quot;even&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="0-2-join">0.2 join</h5>
<p><code>join()</code>æ–¹æ³•**ï¼šåœ¨Açº¿ç¨‹ä¸­è°ƒç”¨äº†Bçº¿ç¨‹çš„join()æ–¹æ³•æ—¶ï¼Œè¡¨ç¤ºåªæœ‰å½“Bçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ—¶ï¼ŒAçº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œ**ã€‚</p>
<p>åŸºäºè¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬ä½¿å¾—ä¸‰ä¸ªçº¿ç¨‹æŒ‰é¡ºåºæ‰§è¡Œï¼Œç„¶åå¾ªç¯å¤šæ¬¡å³å¯ã€‚æ— è®ºçº¿ç¨‹1ã€çº¿ç¨‹2ã€çº¿ç¨‹3å“ªä¸ªå…ˆæ‰§è¡Œï¼Œæœ€åæ‰§è¡Œçš„é¡ºåºéƒ½æ˜¯çº¿ç¨‹1â€”â€”&gt;çº¿ç¨‹2â€”â€”&gt;çº¿ç¨‹3ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Join_ABC</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> printABC(<span class="keyword">null</span>),<span class="string">&quot;A&quot;</span>);</span><br><span class="line">            Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> printABC(t1),<span class="string">&quot;B&quot;</span>);</span><br><span class="line">            Thread t3 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> printABC(t2),<span class="string">&quot;C&quot;</span>);</span><br><span class="line">            t1.start();</span><br><span class="line">            t2.start();</span><br><span class="line">            t3.start();</span><br><span class="line">            Thread.sleep(<span class="number">10</span>); <span class="comment">//è¿™é‡Œæ˜¯è¦ä¿è¯åªæœ‰t1ã€t2ã€t3ä¸ºä¸€ç»„ï¼Œè¿›è¡Œæ‰§è¡Œæ‰èƒ½ä¿è¯t1-&gt;t2-&gt;t3çš„æ‰§è¡Œé¡ºåºã€‚</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">printABC</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Thread beforeThread;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">printABC</span><span class="params">(Thread beforeThread)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.beforeThread = beforeThread;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(beforeThread!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    beforeThread.join(); </span><br><span class="line">                    System.out.print(Thread.currentThread().getName());</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="0-3-Lock">0.3 Lock</h5>
<p>è¯¥æ–¹æ³•å¾ˆå®¹æ˜“ç†è§£ï¼Œä¸ç®¡å“ªä¸ªçº¿ç¨‹æ‹¿åˆ°é”ï¼Œ<strong>åªæœ‰ç¬¦åˆæ¡ä»¶çš„æ‰èƒ½æ‰“å°</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Lock_ABC</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;   <span class="comment">// å½“å‰çŠ¶æ€å€¼ï¼šä¿è¯ä¸‰ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ›¿æ‰“å°</span></span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(<span class="keyword">int</span> targetNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (num % <span class="number">3</span> == targetNum) &#123;</span><br><span class="line">                num++;</span><br><span class="line">                i++;</span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">            lock.unlock(); <span class="comment">// ä¸ç¬¦åˆè¦æ±‚ç›´æ¥é‡Šæ”¾é”ï¼Œä¸ä¼šåƒsyncä¸€æ ·é˜»å¡åœ¨syncæˆ–waitå¤„</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Lock_ABC lockABC = <span class="keyword">new</span> Lock_ABC();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lockABC.printABC(<span class="number">0</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lockABC.printABC(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lockABC.printABC(<span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="0-4-Semaphore">0.4 <strong>Semaphore</strong></h5>
<p>Semaphoreï¼šç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªç‰¹å®šèµ„æºçš„æ“ä½œæ•°é‡ï¼Œæˆ–è€…åŒæ—¶æ‰§è¡ŒæŸä¸ªåˆ¶å®šæ“ä½œçš„æ•°é‡ã€‚Semaphoreå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå…¶å€¼ä¸ºå¯ä»¥è®¿é—®çš„å…±äº«èµ„æºçš„ä¸ªæ•°ã€‚</p>
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹è¦è®¿é—®å…±äº«èµ„æºï¼Œå…ˆä½¿ç”¨<code>acquire()</code>æ–¹æ³•è·å¾—ä¿¡å·é‡ï¼Œå¦‚æœä¿¡å·é‡çš„è®¡æ•°å™¨å€¼å¤§äºç­‰äº1ï¼Œæ„å‘³ç€æœ‰å…±äº«èµ„æºå¯ä»¥è®¿é—®ï¼Œåˆ™ä½¿å…¶è®¡æ•°å™¨å€¼å‡å»1ï¼Œå†è®¿é—®å…±äº«èµ„æºã€‚å¦‚æœè®¡æ•°å™¨å€¼ä¸º0,çº¿ç¨‹è¿›å…¥ä¼‘çœ ï¼›</li>
<li>å½“æŸä¸ªçº¿ç¨‹ä½¿ç”¨å®Œå…±äº«èµ„æºåï¼Œä½¿ç”¨<code>release()</code>é‡Šæ”¾ä¿¡å·é‡ï¼Œ<strong>å¹¶å°†ä¿¡å·é‡å†…éƒ¨çš„è®¡æ•°å™¨åŠ 1</strong>ï¼Œä¹‹å‰è¿›å…¥ä¼‘çœ çš„çº¿ç¨‹å°†è¢«å”¤é†’å¹¶å†æ¬¡è¯•å›¾è·å¾—ä¿¡å·é‡ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SemaphoreABC</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore s1 = <span class="keyword">new</span> Semaphore(<span class="number">1</span>); <span class="comment">//å› ä¸ºå…ˆæ‰§è¡Œçº¿ç¨‹Aï¼Œæ‰€ä»¥è¿™é‡Œè®¾s1çš„è®¡æ•°å™¨ä¸º1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore s2 = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore s3 = <span class="keyword">new</span> Semaphore(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printABC</span><span class="params">(Semaphore currentThread, Semaphore nextThread)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                currentThread.acquire();       <span class="comment">//é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå³ä¿¡å·é‡çš„è®¡æ•°å™¨å‡1ä¸º0</span></span><br><span class="line">                System.out.print(Thread.currentThread().getName());</span><br><span class="line">                nextThread.release();          <span class="comment">//å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œå³ä¿¡å·é‡çš„è®¡æ•°å™¨åŠ 1</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        SemaphoreABC printer = <span class="keyword">new</span> SemaphoreABC();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            printer.printABC(s1, s2);</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            printer.printABC(s2, s3);</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            printer.printABC(s3, s1);</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-1-çº¿ç¨‹åŸºæœ¬">1.4.1 çº¿ç¨‹åŸºæœ¬</h3>
<h4 id="1-ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ">1. ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿ<strong>å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></h4>
<h5 id="1-1-ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿ">1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿ</h5>
<ul>
<li>
<p><strong>ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ</strong></p>
<p><strong>è¿›ç¨‹æ˜¯ç¨‹åºçš„â¼€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½</strong>ï¼Œå› æ­¤è¿›ç¨‹æ˜¯<strong>åŠ¨æ€</strong>çš„ã€‚ç³»ç»Ÿè¿è¡Œâ¼€ä¸ªç¨‹åºå³æ˜¯â¼€ä¸ªè¿›ç¨‹ä»åˆ›å»ºï¼Œè¿è¡Œåˆ°æ¶ˆäº¡çš„è¿‡ç¨‹ã€‚</p>
<blockquote>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ windows ä¸­é€šè¿‡æŸ¥çœ‹ä»»åŠ¡ç®¡ç†å™¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šçœ‹åˆ° window å½“å‰è¿è¡Œçš„è¿›ç¨‹ï¼ˆ.exe â½‚ä»¶çš„è¿è¡Œï¼‰ã€‚åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç¨‹åºåªå¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œé‡Œé¢å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚</p>
<p><img src="https://i.loli.net/2021/05/16/cxYPKI1LnR4V3Mt.png" alt="image-20210516101110229"></p>
</blockquote>
</li>
<li>
<p><strong>ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</strong></p>
<p><strong>çº¿ç¨‹ä¸è¿›ç¨‹ç›¸ä¼¼ï¼Œä½†çº¿ç¨‹æ˜¯â¼€ä¸ªâ½è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½</strong>ã€‚â¼€ä¸ªè¿›ç¨‹åœ¨å…¶æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯ä»¥äº§â½£å¤šä¸ªçº¿ç¨‹ã€‚</p>
<ul>
<li>ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº</strong>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰â¾ƒâ¼°çš„<strong>ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong>å’Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong></li>
</ul>
<p>æ‰€ä»¥ç³»ç»Ÿåœ¨äº§â½£â¼€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œ<u>åˆ‡æ¢â¼¯ä½œ</u>æ—¶ï¼Œ<strong>è´Ÿæ‹…è¦â½è¿›ç¨‹å°å¾—å¤š</strong>ï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p>
<blockquote>
<p>â¼€ä¸ª Java ç¨‹åºçš„è¿è¡Œæ˜¯ main çº¿ç¨‹å’Œå¤šä¸ªå…¶ä»–çº¿ç¨‹åŒæ—¶è¿è¡Œã€‚</p>
</blockquote>
</li>
</ul>
<h5 id="1-2-å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ">1.2 å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h5>
<ol>
<li><strong>åŸå­æ€§</strong>ï¼Œç®€å•è¯´å°±æ˜¯<u>ç›¸å…³æ“ä½œä¸ä¼šä¸­é€”è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œä¸€èˆ¬é€šè¿‡åŒæ­¥æœºåˆ¶å®ç°</u>ï¼›</li>
<li><strong>å¯è§æ€§</strong>ï¼Œ<u>æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡ï¼Œå…¶çŠ¶æ€èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çŸ¥æ™“</u>ï¼Œé€šå¸¸è¢«è§£é‡Šä¸ºå°†çº¿ç¨‹æœ¬åœ°çŠ¶æ€åæ˜ åˆ°ä¸»å†…å­˜ä¸Šï¼Œvolatile å°±æ˜¯è´Ÿè´£ä¿è¯å¯è§æ€§çš„ï¼›</li>
<li><strong>æœ‰åºæ€§</strong>ï¼Œ<u>æ˜¯ä¿è¯çº¿ç¨‹å†…ä¸²è¡Œè¯­ä¹‰ï¼Œé¿å…æŒ‡ä»¤é‡æ’</u>ç­‰ã€‚</li>
</ol>
<h5 id="1-3-ä¸ºä»€ä¹ˆç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯-u-çº¿ç¨‹-u-ç§æœ‰çš„">1.3 ä¸ºä»€ä¹ˆç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯<u>çº¿ç¨‹</u>ç§æœ‰çš„?</h5>
<ul>
<li>
<p><strong>ç¨‹åºè®¡æ•°å™¨ä¸ºä»€ä¹ˆæ˜¯ç§æœ‰</strong></p>
<p>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªâ¼‰äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œç¨‹åºè®¡æ•°å™¨<u>ç§æœ‰</u>ä¸»è¦æ˜¯ä¸ºäº†<strong>çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®</strong>ã€‚</p>
</li>
<li>
<p><strong>è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºä»€ä¹ˆç§æœ‰</strong></p>
<ul>
<li>
<p><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼š <u>æ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶ä¼šåˆ›å»ºâ¼€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å¸¸é‡æ± å¼•ç”¨ç­‰ä¿¡æ¯</u>ã€‚ä»æ–¹æ³•è°ƒç”¨ç›´â¾„æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€â¼€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­<strong>â¼Šæ ˆå’Œå‡ºæ ˆ</strong>çš„è¿‡ç¨‹ã€‚</p>
</li>
<li>
<p><strong>æœ¬åœ°æ–¹æ³•æ³•æ ˆ</strong>ï¼š å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š<strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ</strong> <strong>Java</strong> æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ <strong>Nativeæ–¹æ³•æœåŠ¡</strong>ã€‚ åœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆâ¼†ä¸ºâ¼€ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œä¸ºäº†<strong>ä¿è¯çº¿ç¨‹ä¸­çš„å±€éƒ¨å˜é‡ä¸è¢«åˆ«çš„çº¿ç¨‹è®¿é—®åˆ°</strong>ï¼Œè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p>
</li>
</ul>
<h4 id="2-åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆéçº¿ç¨‹æ± ï¼‰ï¼Ÿ-å“ªç§æœ€å¥½ï¼Ÿ">2.<strong>åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆéçº¿ç¨‹æ± ï¼‰ï¼Ÿ å“ªç§æœ€å¥½ï¼Ÿ</strong></h4>
<p>ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼æ¥è¿›è¡Œåˆ›å»ºï¼š</p>
<ol>
<li>
<p><strong>ç»§æ‰¿Threadç±»</strong>ï¼šï¼ˆ1ï¼‰å®šä¹‰Threadç±»çš„å­ç±»ï¼Œå¹¶é‡å†™è¯¥ç±»çš„runæ–¹æ³•ï¼ˆ2ï¼‰åˆ›å»ºThreadå­ç±»çš„å®ä¾‹å¯¹è±¡ ï¼ˆ3ï¼‰è°ƒç”¨å¯¹è±¡start()æ–¹æ³•</p>
<blockquote>
<ul>
<li>ä¼˜ç‚¹ï¼šç¼–å†™ç®€å•ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œåˆ™æ— éœ€ä½¿ç”¨ Thread.currentThread() æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨thiså³å¯è·å–å½“å‰çº¿ç¨‹ï¼›</li>
<li>ç¼ºç‚¹ï¼šå› ä¸ºçº¿ç¨‹ç±»å·²ç»ç»§æ‰¿äº†Threadç±»ï¼ŒJavaè¯­è¨€æ˜¯å•ç»§æ‰¿çš„ï¼Œæ‰€ä»¥å°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–çˆ¶ç±»äº†ã€‚</li>
</ul>
</blockquote>
</li>
<li>
<p><strong>å®ç°Runnableæ¥å£</strong>ï¼šï¼ˆ1ï¼‰å®šä¹‰runnableæ¥å£çš„<strong>å®ç°ç±»</strong>ï¼Œå¹¶é‡å†™è¯¥æ¥å£çš„run()æ–¹æ³• ï¼ˆ2ï¼‰åˆ›å»ºå®ç°ç±»çš„å®ä¾‹å¯¹è±¡ï¼ˆ3ï¼‰è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹</p>
</li>
<li>
<p><strong>é€šè¿‡Callableå’ŒFutureåˆ›å»ºçº¿ç¨‹</strong>ï¼šï¼ˆ1ï¼‰åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»ï¼Œ<strong>å¹¶å®ç°call()æ–¹æ³•</strong>ï¼ˆ2ï¼‰åˆ›å»ºCallableå®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶ä½¿ç”¨FutureTaskç±»æ¥åŒ…è£…Callableå¯¹è±¡ï¼ˆ3ï¼‰ä½¿ç”¨FutureTaskå¯¹è±¡ä½œä¸ºThreadå¯¹è±¡çš„targetåˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ï¼ˆ4ï¼‰è°ƒç”¨FutureTaskå¯¹è±¡çš„get()æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼</p>
</li>
</ol>
<p>å…¶ä¸­ <u>å®ç°Runnalbeæ¥å£æ›´å¥½</u>  ï¼Œä½¿ç”¨å®ç°Runnableæ¥å£çš„æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹<strong>å¯ä»¥å¤„ç†åŒä¸€èµ„æº</strong>ï¼Œä»è€Œå®ç°èµ„æºçš„å…±äº«ã€‚</p>
<h4 id="3-å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ">3.<strong>å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ</strong></h4>
<ol>
<li>
<p>ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢ï¼›</p>
</li>
<li>
<p>ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢ï¼Œä½†æ˜¯ä¸æ¨èè¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºstopå’ŒsuspendåŠresumeä¸€æ ·éƒ½æ˜¯è¿‡æœŸä½œåºŸçš„æ–¹æ³•ï¼›</p>
</li>
<li>
<p>ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">     <span class="keyword">volatile</span> <span class="keyword">boolean</span> stop = <span class="keyword">false</span>;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">        System.out.println(getName() + <span class="string">&quot; is running&quot;</span>);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">           sleep(<span class="number">1000</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;week up from blcok...&quot;</span>);</span><br><span class="line">            stop = <span class="keyword">true</span>; <span class="comment">// åœ¨å¼‚å¸¸å¤„ç†ä»£ç ä¸­ä¿®æ”¹å…±äº«å˜é‡çš„çŠ¶æ€</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    System.out.println(getName() + <span class="string">&quot; is exiting...&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterruptThreadDemo3</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span>          InterruptedException </span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">          MyThread m1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">          System.out.println(<span class="string">&quot;Starting thread...&quot;</span>);</span><br><span class="line">          m1.start();</span><br><span class="line">          Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">          System.out.println(<span class="string">&quot;Interrupt thread...: &quot;</span> +           m1.getName());</span><br><span class="line">          m1.stop = <span class="keyword">true</span>; <span class="comment">// è®¾ç½®å…±äº«å˜é‡ä¸ºtrue</span></span><br><span class="line">          m1.interrupt(); <span class="comment">// é˜»å¡æ—¶é€€å‡ºé˜»å¡çŠ¶æ€</span></span><br><span class="line">          Thread.sleep(<span class="number">3000</span>); <span class="comment">// ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’ä»¥ä¾¿è§‚å¯Ÿçº¿ç¨‹m1çš„ä¸­æ–­æƒ…å†µ</span></span><br><span class="line">          System.out.println(<span class="string">&quot;Stopping application...&quot;</span>);</span><br><span class="line">       &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="4-ä»€ä¹ˆæ˜¯Daemonçº¿ç¨‹ï¼Ÿå®ƒæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ">4.<strong>ä»€ä¹ˆæ˜¯Daemonçº¿ç¨‹ï¼Ÿå®ƒæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</strong></h4>
<p>æ‰€è°“åå°(daemon)çº¿ç¨‹ï¼Œä¹Ÿå«å®ˆæŠ¤çº¿ç¨‹ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™åœ¨åå°æä¾›ä¸€ç§é€šç”¨æœåŠ¡çš„çº¿ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸ªçº¿ç¨‹å¹¶ä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚</p>
<ul>
<li><strong>æ„ä¹‰</strong>ï¼šJVMçš„åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯Daemonçº¿ç¨‹ï¼ŒFinalizerä¹Ÿæ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</li>
</ul>
<h4 id="5-è¯´è¯´CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«ï¼Ÿ">5.<strong>è¯´è¯´CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«ï¼Ÿ</strong></h4>
<p>ä¸¤ä¸ªçœ‹ä¸Šå»æœ‰ç‚¹åƒçš„ç±»ï¼Œéƒ½åœ¨<code>java.util.concurrent</code>ä¸‹ï¼Œéƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤ºä»£ç è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºï¼š</p>
<ol>
<li>CyclicBarrierçš„æŸä¸ªçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œ<strong>è¯¥çº¿ç¨‹å³åœæ­¢è¿è¡Œ</strong>ï¼Œ<strong>ç›´åˆ°æ‰€æœ‰çš„çº¿ç¨‹éƒ½åˆ°è¾¾äº†è¿™ä¸ªç‚¹</strong>ï¼Œæ‰€æœ‰çº¿ç¨‹æ‰é‡æ–°è¿è¡ŒCountDownLatchåˆ™ä¸æ˜¯ï¼ŒæŸçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ä¸Šä¹‹åï¼Œåªæ˜¯ç»™æŸä¸ªæ•°å€¼**-1**è€Œå·²ï¼Œè¯¥çº¿ç¨‹ç»§ç»­è¿è¡Œï¼›</li>
<li>CyclicBarrier<strong>åªèƒ½å”¤èµ·ä¸€ä¸ªä»»åŠ¡</strong>ï¼ŒCountDownLatchå¯ä»¥å”¤èµ·å¤šä¸ªä»»åŠ¡</li>
<li>CyclicBarrierå¯é‡ç”¨ï¼Œ<strong>CountDownLatchä¸å¯é‡ç”¨ï¼Œè®¡æ•°å€¼ä¸º0è¯¥CountDownLatchå°±ä¸å¯å†ç”¨äº†</strong></li>
</ol>
<h4 id="6-è¯·ä½ ç®€è¦è¯´æ˜ä¸€ä¸‹çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Ÿ">6.<strong>è¯·ä½ ç®€è¦è¯´æ˜ä¸€ä¸‹çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Ÿ</strong></h4>
<p><img src="https://i.loli.net/2021/04/28/VCN8xckXHMdrl1R.png" alt="image-20210428164922743"></p>
<ol>
<li><strong>æ–°å»ºçŠ¶æ€</strong>ï¼šnewè¯­å¥åˆ›å»ºçš„çº¿ç¨‹å¯¹è±¡å¤„äºæ–°å»ºçŠ¶æ€ï¼Œä»…è¢«åˆ†é…äº†å†…å­˜ï¼›</li>
<li><strong>ç­‰å¾…çŠ¶æ€</strong>ï¼š å½“çº¿ç¨‹åœ¨newä¹‹åï¼Œå¹¶ä¸”<u>åœ¨è°ƒç”¨startæ–¹æ³•å‰</u>ï¼Œçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ ;</li>
<li><strong>å°±ç»ªçŠ¶æ€</strong>ï¼š å…¶ä»–çº¿ç¨‹è°ƒç”¨å®ƒçš„**start()**æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹å°±è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œ<u>åªå·®ç­‰å¾…cpuçš„ä½¿ç”¨æƒ </u> ;</li>
<li><strong>è¿è¡ŒçŠ¶æ€</strong>ï¼š <u>çº¿ç¨‹å ç”¨CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç </u>  ;</li>
<li><strong>é˜»å¡çŠ¶æ€</strong>ï¼š é˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸäº›åŸå› æ”¾å¼ƒCPUï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚<u>é˜»å¡çŠ¶æ€åˆ†ä¸ºä¸‰ç§ï¼š</u>
<ul>
<li><u>ç­‰å¾…é˜»å¡:</u> è¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œ**wait()**æ–¹æ³•ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…æ± ä¸­ï¼›</li>
<li><u>åŒæ­¥é˜»å¡:</u> è¿è¡Œçš„çº¿ç¨‹åœ¨è·å–<strong>å¯¹è±¡åŒæ­¥é”</strong>æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠçº¿ç¨‹æ”¾å…¥é”æ± ä¸­ï¼›</li>
<li><u>å…¶ä»–é˜»å¡:</u> è¿è¡Œçš„çº¿ç¨‹æ‰§è¡ŒSleep()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºI/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠçº¿ç¨‹è®¾ä¸ºé˜»å¡çŠ¶æ€ã€‚</li>
</ul>
</li>
<li><strong>æ­»äº¡çŠ¶æ€</strong>ï¼š çº¿ç¨‹æ‰§è¡Œå®Œ<strong>run()æ–¹æ³•ä¸­çš„ä»£ç </strong>ï¼Œæˆ–è€…é‡åˆ°äº†æœªæ•è·çš„å¼‚å¸¸ï¼Œå°±ä¼šé€€å‡ºrun()æ–¹æ³•ï¼Œç»“æŸç”Ÿå‘½å‘¨æœŸ</li>
</ol>
<h4 id="7-notify-å’ŒnotifyAll-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">7. <strong>notify()å’ŒnotifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4>
<ul>
<li><strong>notifyå¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼ˆwhyï¼Ÿ</strong>ï¼‰ï¼Œè€ŒnotifyAllåˆ™ä¸ä¼šï¼›</li>
<li>ä½¿ç”¨notifyall,å¯ä»¥å”¤é†’ æ‰€æœ‰å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä½¿å…¶é‡æ–°è¿›å…¥é”çš„äº‰å¤ºé˜Ÿåˆ—ä¸­ï¼Œè€Œnotifyåªèƒ½å”¤é†’ä¸€ä¸ªã€‚</li>
</ul>
<h4 id="8-sleep-å’Œwait-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">8. <strong>sleep()å’Œwait() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h4>
<ul>
<li>
<p><strong>ç»§æ‰¿çš„ç±»</strong>ï¼šsleep()æ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“è¯¥æ–¹æ³•æ˜¯å±äºThreadç±»ä¸­çš„ï¼›è€Œwait()æ–¹æ³•ï¼Œåˆ™æ˜¯å±äºObjectç±»ä¸­çš„ï¼›</p>
<blockquote>
<p><em>sleep()</em> æ˜¯ <em>Thread</em> ç±»é™æ€æ–¹æ³•ï¼Œå¯ä»¥ä½¿ <u>å½“å‰</u> çº¿ç¨‹é˜»å¡ï¼Œå¹¶æŒ‡å®šæš‚åœæ—¶é—´ï¼Œé‡ç‚¹åœ¨äºç†è§£ <u>å½“å‰</u>ã€‚ä¼‘çœ æ—¶é—´æœŸæ»¡åï¼Œè¯¥çº¿ç¨‹ä¸ä¸€å®šä¼šç«‹å³æ‰§è¡Œè¢«CPUè°ƒåº¦ï¼Œåªæ˜¯åˆ°äº†å°±ç»ªçŠ¶æ€ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>æ˜¯å¦é‡Šæ”¾é”</strong>ï¼šsleep()æ–¹æ³•å¯¼è‡´äº†ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œè®©å‡ºcpuè¯¥å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯ä»–çš„ç›‘æ§çŠ¶æ€ä¾ç„¶ä¿æŒè€…ï¼Œå½“æŒ‡å®šçš„æ—¶é—´åˆ°äº†åˆä¼šè‡ªåŠ¨æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚<strong>åœ¨è°ƒç”¨sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼›å½“è°ƒç”¨wait()æ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”</strong>ï¼Œè¿›å…¥ç­‰å¾…æ­¤å¯¹è±¡çš„ç­‰å¾…é”å®šæ± ï¼›</p>
</li>
<li>
<p><strong>ç”¨å¤„</strong>ï¼š <strong>Wait é€šå¸¸è¢«ç”¨äºçº¿ç¨‹é—´äº¤äº’/é€šä¿¡</strong>ï¼Œsleep é€šå¸¸è¢«ç”¨äºæš‚åœæ‰§è¡Œï¼›</p>
</li>
<li>
<p><strong>å†æ¬¡å”¤é†’</strong>ï¼š wait() æ–¹æ³•è¢«è°ƒç”¨åï¼Œçº¿ç¨‹ä¸ä¼šâ¾ƒåŠ¨è‹é†’ï¼Œéœ€è¦åˆ«çš„çº¿ç¨‹è°ƒç”¨åŒâ¼€ä¸ªå¯¹è±¡ä¸Šçš„ notify() æˆ–è€…notifyAll() æ–¹æ³•ã€‚sleep() æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ä¼šâ¾ƒåŠ¨è‹é†’ã€‚</p>
</li>
</ul>
<h5 id="8-1-Threadç±»ä¸­çš„yieldæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ">8.1 <strong>Threadç±»ä¸­çš„yieldæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></h5>
<p><em>yield()</em> ä¹Ÿæ˜¯ <em>Thread</em> ç±»é™æ€æ–¹æ³•ï¼Œ<strong>ä½¿å½“å‰çº¿ç¨‹å˜ä¸º<u>å°±ç»ªçŠ¶æ€</u></strong> ï¼ˆ<em>sleep()</em> æ˜¯é˜»å¡ï¼‰ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ›´å¤šæœºä¼šè·å–CPUã€‚æ‰§è¡Œyield()çš„çº¿ç¨‹æœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°æš‚åœçŠ¶æ€åé©¬ä¸Šåˆè¢«æ‰§è¡Œã€‚</p>
<h5 id="8-2-java-ä¸­Waitã€Sleepå’ŒYieldæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ">8.2 <strong>java ä¸­Waitã€Sleepå’ŒYieldæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ</strong></h5>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/25e959037eed">https://www.jianshu.com/p/25e959037eed</a></p>
<h4 id="9-volatile-æ˜¯ä»€ä¹ˆ-å¯ä»¥ä¿è¯æœ‰åºæ€§å—">9. <strong>volatile æ˜¯ä»€ä¹ˆ?å¯ä»¥ä¿è¯æœ‰åºæ€§å—?</strong></h4>
<ol>
<li>ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„,volatileå…³é”®å­—ä¼šå¼ºåˆ¶å°†ä¿®æ”¹çš„å€¼ç«‹å³å†™å…¥ä¸»å­˜ï¼›</li>
<li>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚</li>
</ol>
<p><strong>èƒ½ä¿è¯æœ‰åºæ€§</strong>ï¼Œå› ä¸ºç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</p>
<h4 id="10-ä¸ºä»€ä¹ˆwait-notify-å’Œ-notifyAllè¿™äº›æ–¹æ³•ä¸åœ¨threadç±»é‡Œé¢ï¼Ÿ">10. ä¸ºä»€ä¹ˆwait, notify å’Œ notifyAllè¿™äº›æ–¹æ³•ä¸åœ¨threadç±»é‡Œé¢ï¼Ÿ</h4>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/321674476">https://www.zhihu.com/question/321674476</a></p>
<p>æ˜æ˜¾çš„åŸå› æ˜¯<strong>JAVAæä¾›çš„é”æ˜¯å¯¹è±¡çº§çš„è€Œä¸æ˜¯çº¿ç¨‹çº§çš„</strong>ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰é”ï¼Œé€šè¿‡çº¿ç¨‹è·å¾—ã€‚å¦‚æœçº¿ç¨‹éœ€è¦ç­‰å¾…æŸäº›é”é‚£ä¹ˆè°ƒç”¨å¯¹è±¡ä¸­çš„wait()æ–¹æ³•å°±æœ‰æ„ä¹‰äº†ã€‚<u>å¦‚æœwait()æ–¹æ³•å®šä¹‰åœ¨Threadç±»ä¸­ï¼Œçº¿ç¨‹æ­£åœ¨ç­‰å¾…çš„æ˜¯å“ªä¸ªé”å°±ä¸æ˜æ˜¾äº†</u>ã€‚</p>
<ul>
<li>ç®€å•çš„è¯´ï¼Œç”±äºwaitï¼Œnotifyå’ŒnotifyAlléƒ½æ˜¯é”çº§åˆ«çš„æ“ä½œï¼Œæ‰€ä»¥æŠŠä»–ä»¬å®šä¹‰åœ¨Objectç±»ä¸­å› ä¸ºé”å±äºå¯¹è±¡ã€‚</li>
</ul>
<h4 id="11-ä¸ºä»€ä¹ˆwaitå’Œnotifyæ–¹æ³•è¦åœ¨åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ">11.<strong>ä¸ºä»€ä¹ˆwaitå’Œnotifyæ–¹æ³•è¦åœ¨åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ</strong></h4>
<ul>
<li><u>wait()æ–¹æ³•<strong>å¼ºåˆ¶å½“å‰çº¿ç¨‹é‡Šæ”¾å¯¹è±¡é”</strong></u>ã€‚è¿™æ„å‘³ç€åœ¨è°ƒç”¨æŸå¯¹è±¡çš„wait()æ–¹æ³•ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹å¿…é¡»å·²ç»è·å¾—è¯¥å¯¹è±¡çš„é”ã€‚å› æ­¤ï¼Œçº¿ç¨‹å¿…é¡»åœ¨æŸä¸ªå¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­æ‰èƒ½è°ƒç”¨è¯¥å¯¹è±¡çš„wait()æ–¹æ³•ï¼›</li>
<li>åœ¨è°ƒç”¨å¯¹è±¡çš„notify()å’ŒnotifyAll()æ–¹æ³•ä¹‹å‰ï¼Œ<u>è°ƒç”¨çº¿ç¨‹å¿…é¡»<strong>å·²ç»å¾—åˆ°è¯¥å¯¹è±¡çš„é”</strong></u>ã€‚å› æ­¤ï¼Œå¿…é¡»åœ¨æŸä¸ªå¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­æ‰èƒ½è°ƒç”¨è¯¥å¯¹è±¡çš„notify()æˆ–notifyAll()æ–¹æ³•ã€‚</li>
</ul>
<h4 id="12-ï¼ˆæ²¡ç»†çœ‹ï¼‰Javaä¸­interrupted-å’Œ-isInterrupteddæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ">12. ï¼ˆæ²¡ç»†çœ‹ï¼‰<strong>Javaä¸­interrupted å’Œ isInterrupteddæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ</strong></h4>
<p>interrupted() å’Œ isInterrupted()çš„ä¸»è¦åŒºåˆ«æ˜¯å‰è€…ä¼šå°†ä¸­æ–­çŠ¶æ€æ¸…é™¤è€Œåè€…ä¸ä¼šã€‚Javaå¤šçº¿ç¨‹çš„ä¸­æ–­æœºåˆ¶æ˜¯ç”¨å†…éƒ¨æ ‡è¯†æ¥å®ç°çš„ï¼Œè°ƒThread.interrupt()æ¥ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹å°±ä¼šè®¾ç½®ä¸­æ–­æ ‡è¯†ä¸ºtrueã€‚å½“ä¸­æ–­çº¿ç¨‹è°ƒç”¨é™æ€æ–¹æ³•Thread.interrupted()æ¥æ£€æŸ¥ä¸­æ–­çŠ¶æ€æ—¶ï¼Œä¸­æ–­çŠ¶æ€ä¼šè¢«æ¸…é›¶ã€‚è€Œéé™æ€æ–¹æ³•isInterrupted()ç”¨æ¥æŸ¥è¯¢å…¶å®ƒçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¸”ä¸ä¼šæ”¹å˜ä¸­æ–­çŠ¶æ€æ ‡è¯†ã€‚ç®€å•çš„è¯´å°±æ˜¯ä»»ä½•æŠ›å‡ºInterruptedExceptionå¼‚å¸¸çš„æ–¹æ³•ã€‚</p>
<h3 id="1-4-2-çº¿ç¨‹æ± ">1.4.2 çº¿ç¨‹æ± </h3>
<h4 id="1-è¯·ä½ è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼ˆthread-poolï¼‰ï¼Ÿ">1.<strong>è¯·ä½ è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼ˆthread poolï¼‰ï¼Ÿ</strong></h4>
<p>çº¿ç¨‹æ± é¡¾åæ€ä¹‰å°±æ˜¯äº‹å…ˆåˆ›å»ºè‹¥å¹²ä¸ªå¯æ‰§è¡Œçš„çº¿ç¨‹æ”¾å…¥ä¸€ä¸ªæ± ï¼ˆå®¹å™¨ï¼‰ä¸­ï¼Œéœ€è¦çš„æ—¶å€™ä»æ± ä¸­è·å–çº¿ç¨‹ä¸ç”¨è‡ªè¡Œåˆ›å»ºï¼Œ<u>ä½¿ç”¨å®Œæ¯•ä¸éœ€è¦é”€æ¯çº¿ç¨‹è€Œæ˜¯æ”¾å›æ± ä¸­ï¼Œä»è€Œå‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¯¹è±¡çš„å¼€é”€</u>ã€‚ é™¤æ­¤ä¹‹å¤–ï¼š</p>
<ul>
<li>æé«˜æ€§èƒ½ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å‹æ¦¨CPUç®—åŠ›ï¼›</li>
<li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼Œé™åˆ¶çº¿ç¨‹æ•°é‡å¹¶å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚</li>
</ul>
<h5 id="1-1-è¯·ä»‹ç»ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"><strong>1.1 è¯·ä»‹ç»ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</strong></h5>
<p><strong>æ ¸å¿ƒå‚æ•°</strong>ï¼šå…¶ä¸­<code>corePool</code>æ˜¯æ ¸å¿ƒçº¿ç¨‹æ± ï¼ˆä¿æ´»çº¿ç¨‹ï¼‰ï¼Œ<code>maximumPool</code>æ˜¯æ€»çº¿ç¨‹æ± ï¼ˆä¿æ´»çº¿ç¨‹+å·¥ä½œçº¿ç¨‹ï¼‰ï¼Œ<code>blockQueue </code>æ˜¯ç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—ï¼Œ<code>rejectedExecutionHandler</code>æ˜¯æ‹’ç»ç­–ç•¥ï¼š</p>
<p><img src="https://i.loli.net/2021/04/19/Pn4wc5621hqIXpl.png" alt="image-20210419235537833" style="zoom: 33%;" /><img src="https://segmentfault.com/img/remote/1460000038860133" alt="iShot2021-01-03 20.18.23.png" style="zoom: 67%;" /></p>
<p><strong>æµç¨‹ï¼šcorePoolSizeâ†’é˜Ÿåˆ—â†’maximumPoolâ†’æ‹’ç»ç­–ç•¥</strong></p>
<ol>
<li>æœªè¾¾åˆ°corePoolSizeæ—¶ï¼Œæ ¸å¿ƒçº¿ç¨‹æ± ä¼šå¼€è¾Ÿæ–°çº¿ç¨‹è¿è¡Œä»»åŠ¡ï¼ˆ<u>å¯ä»¥ä½¿ç”¨å·²æœ‰çº¿ç¨‹å—ï¼Ÿ</u>ï¼‰ï¼Œ<strong>ä»»åŠ¡ç»“æŸåçº¿ç¨‹ä¸é”€æ¯</strong>ï¼›</li>
<li>è¾¾åˆ°corePoolSizeï¼Œè€Œä»»åŠ¡é˜Ÿåˆ—æœªæ»¡æ—¶ï¼Œæ–°ä»»åŠ¡æäº¤åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œ<strong>çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeæ—¶è¢«é”€æ¯ï¼›</strong></li>
<li>ä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œä½†æœªè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ–°å»ºå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼›</li>
<li>è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°æ—¶ï¼Œ<strong>æŒ‰æ‹’ç»ç­–ç•¥å¤„ç†</strong>ï¼ŒåŒ…æ‹¬ï¼š<u>æŠ›å‡ºå¼‚å¸¸ã€ä½¿ç”¨è°ƒç”¨è€…çº¿ç¨‹è¿è¡Œä»»åŠ¡ã€ä¸¢å¼ƒæ–°ä»»åŠ¡ã€ä¸¢å¼ƒé˜Ÿåˆ—å¤´ä»»åŠ¡</u>ç­‰ã€‚</li>
</ol>
<h5 id="1-2-çº¿ç¨‹æ± ä¼šå›æ”¶æ ¸å¿ƒçº¿ç¨‹å—ï¼Ÿ">1.2 çº¿ç¨‹æ± ä¼šå›æ”¶æ ¸å¿ƒçº¿ç¨‹å—ï¼Ÿ</h5>
<blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000038836285">çº¿ç¨‹æ± æ˜¯æ€ä¹ˆå›æ”¶ç©ºé—²çº¿ç¨‹çš„</a></p>
</blockquote>
<p>ä¼šï¼Œå¯ä»¥é€šè¿‡allowCoreThreadTimeOutå‚æ•°æ¥è¿›è¡Œè®¾ç½®ã€‚</p>
<ul>
<li>
<p>å…ˆå›å¿†ä¸€ä¸‹æ•´ä½“çº¿ç¨‹æ± æµç¨‹</p>
<img src="https://segmentfault.com/img/remote/1460000038860133" alt="iShot2021-01-03 20.18.23.png" style="zoom:67%;" />
</li>
<li>
<p><strong>excuteæ–¹æ³•</strong></p>
<p>æˆ‘ä»¬çš„ä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± åï¼Œæ˜¯ä»è°ƒç”¨executeæ‰§è¡Œå¼€å§‹çš„ã€‚<br>
<img src="https://i.loli.net/2021/05/26/hc4w6ZIbm57CpOQ.png" alt="image-20210526234652655" style="zoom: 67%;" /></p>
<ul>
<li>
<p>æ ¸å¿ƒæ˜¯addWorkeråŠæ³•ï¼Œ é‡Œé¢æœ€æœ€é‡è¦çš„å°±æ˜¯åˆå§‹åŒ–WorkeråŒæ—¶å¯åŠ¨threadã€‚</p>
</li>
<li>
<p>Workerå®ç°äº†Runnableæ¥å£ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹å®ƒçš„runæ–¹æ³•ï¼Œçœ‹æˆªå›¾çš„â‘¢å¤„æ ‡è®°ï¼ŒæŠ½ç¦»å‡ºæ¥ä¸€ä¸ªrunWorkeræ–¹æ³•ï¼š</p>
<p><img src="https://i.loli.net/2021/05/26/39woAvIR4QjNfxd.png" alt="iShot2021-01-03 20.39.22.png"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼šâ‘ å¤„æ˜¯ä¸€ä¸ªwhileå¾ªç¯ï¼Œ<strong>getTask</strong>æ–¹æ³•å°±æ˜¯ä»çº¿ç¨‹æ± é˜Ÿåˆ—å–ä»»åŠ¡ï¼Œ<strong>å¦‚æœå–ä¸åˆ°ä»»åŠ¡</strong>å°±ä¼šæ‰§è¡Œ</p>
<p>â€‹                   â‘¡<strong>ä¸€æ—¦è·³å‡ºwhileå¾ªç¯ï¼Œå³è¿›å…¥åˆ°processWorkExitæ–¹æ³•ï¼Œè¿™å°±æ˜¯å›æ”¶Worker</strong></p>
</li>
</ul>
</li>
<li>
<p><strong>getTaskæ–¹æ³•</strong></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œâ‘ åˆ¤æ–­æ˜¯å¦å›æ”¶çº¿ç¨‹çš„æ¡ä»¶ï¼Œ<strong>timed</strong> ï¼Œæœ‰ä¸¤ç§æƒ…å†µè¦å›æ”¶çº¿ç¨‹ï¼š</p>
<ol>
<li><strong>wc&gt;corePoolSize</strong> ï¼Œå½“å‰çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°</li>
<li><strong>allowCoreThreadTimeOut</strong>ï¼Œæ ¸å¿ƒçº¿ç¨‹è¶…æ—¶ï¼Œæ‰€ä»¥<strong>æ ¸å¿ƒçº¿ç¨‹æ˜¯ä¼šè¢«å›æ”¶</strong>çš„</li>
</ol>
<p>ç„¶åâ‘¡å¤„å°±æ˜¯ä»ä»»åŠ¡é˜Ÿåˆ—å–ä»»åŠ¡äº†ï¼Œ<strong>å¸¦äº†timeOutå‚æ•°çš„pollæ–¹æ³•è¶…æ—¶</strong> ï¼Œæœªèƒ½ä»ä»»åŠ¡é˜Ÿåˆ—è·å–ä»»åŠ¡å³è¿”å›nullï¼Œä»è€Œå®ç°æœ€ç»ˆçš„<strong>çº¿ç¨‹å›æ”¶</strong>ã€‚</p>
<blockquote>
<p>ä¸æ˜¯processWorkExitå¤„ç†å—ï¼Œæ€ä¹ˆåœ¨getTaskå¤„ç†ï¼Œè¿˜æ˜¯å¾—å¥½å¥½çœ‹çœ‹ã€‚</p>
</blockquote>
<p><img src="https://i.loli.net/2021/05/26/hxJerXAo16msf38.png" alt="image-20210526235850331"></p>
</li>
</ul>
<h4 id="2-è¯·ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Ÿ">2.<strong>è¯·ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Ÿ</strong></h4>
<p><img src="https://uploadfiles.nowcoder.com/images/20180925/308572_1537880635592_7142B8354CA8A352B2B805F997C71549" alt="img"></p>
<p>ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜æ˜¯çº¿ç¨‹æ¨¡å‹ä¸­çš„ç»å…¸é—®é¢˜ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åœ¨<strong>åŒä¸€æ—¶é—´æ®µå†…å…±ç”¨åŒä¸€å­˜å‚¨ç©ºé—´</strong>ï¼Œç”Ÿäº§è€…å‘ç©ºé—´é‡Œç”Ÿäº§æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…å–èµ°æ•°æ®ã€‚</li>
</ul>
<h4 id="3-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ">3.<strong>çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</strong></h4>
<p>ä¸»è¦æœ‰4ç§æ‹’ç»ç­–ç•¥ï¼š</p>
<ol>
<li>AbortPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥</li>
<li><strong>CallerRunsPolicy</strong>ï¼šåªç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡</li>
<li>DiscardOldestPolicyï¼š<strong>ä¸¢å¼ƒç­‰å¾…é˜Ÿåˆ—ä¸­æœ€æ—§</strong>çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡</li>
<li>DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸</li>
</ol>
<h4 id="4-å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆå››å¤§æ–¹æ³•ï¼‰ï¼Ÿç›¸å…³å‚æ•°ï¼ˆä¸ƒå¤§å‚æ•°ï¼‰æ˜¯ä»€ä¹ˆ">4.<strong>å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆå››å¤§æ–¹æ³•ï¼‰ï¼Ÿç›¸å…³å‚æ•°ï¼ˆä¸ƒå¤§å‚æ•°ï¼‰æ˜¯ä»€ä¹ˆ?</strong></h4>
<p>javaé€šè¿‡Executorsæä¾›<strong>å››å¤§æ–¹æ³•</strong>ï¼š</p>
<ol>
<li><strong>newCachedThreadPool</strong>ï¼šåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œ<strong>å¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹</strong>ï¼›</li>
<li><strong>newFixedThreadPool</strong>ï¼šåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œ<u>å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°</u>ï¼Œ<strong>è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨<u>é˜Ÿåˆ—ä¸­ç­‰å¾…</u></strong>ï¼›</li>
<li><strong>newScheduledThreadPool</strong>ï¼šåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œ<u>æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ</u>ï¼›</li>
<li><strong>newSingleThreadExecutor</strong>ï¼š åˆ›å»ºä¸€ä¸ª<u>å•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± </u>ï¼Œå®ƒåªä¼šç”¨<strong>å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹</strong>æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯<u>æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œ</u>ã€‚</li>
</ol>
<p><strong>ä¸ƒå¤§å‚æ•°è®¾ç½®</strong>ï¼š</p>
<ol>
<li>
<p><strong>corePoolSize</strong>ï¼šå½“ä½¿ç”¨äº†<code>LinkedBlockingQueue = new LinkedBlockQueue</code>çš„æ—¶å€™ï¼Œ<strong>é˜Ÿåˆ—é•¿åº¦é»˜è®¤æ— é™é•¿</strong>ï¼Œä¼šå¯¼è‡´çº¿ç¨‹æ•°é‡æ°¸è¿œç­‰äº<code>corePoolSize</code>ï¼Œä»»åŠ¡æ¿€å¢æ—¶ä»»åŠ¡å“åº”æ—¶é—´ä¹Ÿæ¿€å¢ï¼›</p>
</li>
<li>
<p><strong>maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹ä¸ªæ•°ï¼Œå¢åŠ çº¿ç¨‹çš„å…¬å¼ï¼š<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mtext>ä»»åŠ¡æ•°</mtext><mo>âˆ’</mo><mi>q</mi><mi>u</mi><mi>e</mi><mi>u</mi><mi>e</mi><mi>C</mi><mi>a</mi><mi>p</mi><mi>a</mi><mi>c</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo stretchy="false">)</mo><mo>Ã—</mo><mo stretchy="false">(</mo><mtext>åŸçº¿ç¨‹æ•°</mtext><mo>Ã·</mo><mtext>åŸä»»åŠ¡æ•°</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(ä»»åŠ¡æ•°-queueCapacity) \times (åŸçº¿ç¨‹æ•° \div åŸä»»åŠ¡æ•°)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">ä»»åŠ¡æ•°</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">åŸçº¿ç¨‹æ•°</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã·</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">åŸä»»åŠ¡æ•°</span><span class="mclose">)</span></span></span></span>ï¼›</p>
</li>
<li>
<p><strong>keepAliveTime</strong>ï¼šçº¿ç¨‹æœ€å¤§ï¼ˆç©ºé—²ï¼‰å­˜æ´»æ—¶é—´ï¼›</p>
</li>
<li>
<p><strong>rejectedExecutionHandler</strong>ï¼šçº¿ç¨‹è¢«æ‹’ç»çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è‡ªå·±é‡å†™ï¼›</p>
</li>
<li>
<p><strong>workQueue</strong> ï¼š é˜»å¡é˜Ÿåˆ—ï¼›</p>
</li>
<li>
<p><strong>unit</strong>ï¼škeepAliveTimeçš„å•ä½ ï¼›</p>
</li>
<li>
<p><strong>threadFactory</strong>ï¼šè¡¨ç¤ºç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ä¸€èˆ¬é»˜è®¤å³å¯</p>
</li>
</ol>
<h4 id="5-çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°corePoolSizeæ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ">5.<strong>çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°corePoolSizeæ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ</strong></h4>
<p>åˆ†ä¸ºCPUå¯†é›†å‹å’ŒIOå¯†é›†å‹æ¥è€ƒè™‘ï¼š</p>
<ul>
<li>
<p><strong>CPUå¯†é›†å‹</strong>ã€‚è¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º <code>Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1</code>ã€‚</p>
<blockquote>
<p><u>æ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹</u> ï¼šæ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>IOå¯†é›†å‹</strong>ã€‚è¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œ<strong>è€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†</strong>ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ ï¼š <code>æ ¸å¿ƒçº¿ç¨‹æ•°=CPUæ ¸å¿ƒæ•°é‡*2</code></p>
</li>
</ul>
<h4 id="6-ï¼ˆä¸ç†Ÿæ‚‰ï¼‰Javaçº¿ç¨‹æ± ä¸­é˜Ÿåˆ—å¸¸ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ">6.<strong>ï¼ˆä¸ç†Ÿæ‚‰ï¼‰Javaçº¿ç¨‹æ± ä¸­é˜Ÿåˆ—å¸¸ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ</strong></h4>
<ul>
<li><code>ArrayBlockingQueue</code> ï¼šæ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼›</li>
<li><code>LinkedBlockingQueue</code> :ä¸€ä¸ªåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰FIFO ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ æ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸è¦é«˜äº ArrayBlockingQueue ï¼›</li>
<li><code>SynchronousQueue</code> : ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼›</li>
<li><code>PriorityBlockingQueue</code>ï¼š ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—ï¼ŒPriorityBlockingQueue ä¹Ÿæ˜¯åŸºäºæœ€å°äºŒå‰å †å®ç°ã€‚</li>
</ul>
<h4 id="7-æœ‰ä¸‰ä¸ªçº¿ç¨‹T1-T2-T3-å¦‚ä½•ä¿è¯é¡ºåºæ‰§è¡Œï¼Ÿ">7.<strong>æœ‰ä¸‰ä¸ªçº¿ç¨‹T1,T2,T3,å¦‚ä½•ä¿è¯é¡ºåºæ‰§è¡Œï¼Ÿ</strong></h4>
<p>å› ä¸ºåœ¨æ¯ä¸ªçº¿ç¨‹çš„runæ–¹æ³•ä¸­ç”¨join()æ–¹æ³•é™å®šäº†ä¸‰ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JoinTest2</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="comment">// 1.ç°åœ¨æœ‰T1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œä½ æ€æ ·ä¿è¯T2åœ¨T1æ‰§è¡Œå®Œåæ‰§è¡Œï¼ŒT3åœ¨T2æ‰§è¡Œå®Œåæ‰§è¡Œ</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">     </span>&#123;</span><br><span class="line">         <span class="keyword">final</span> Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() </span><br><span class="line">         &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">               </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="keyword">final</span> Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                  <span class="comment">// t2çº¿ç¨‹å†…runæ–¹æ³•æœ€å¼€å§‹ï¼Œå¼•ç”¨t1.joinï¼Œç­‰å¾…t1çº¿ç¨‹æ‰§è¡Œå®Œ</span></span><br><span class="line">                   t1.join();</span><br><span class="line">                 &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">                 &#125;</span><br><span class="line">                   System.out.println(<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable()</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// t3çº¿ç¨‹å†…runæ–¹æ³•æœ€å¼€å§‹ï¼Œå¼•ç”¨t2.joinï¼Œç­‰å¾…t2çº¿ç¨‹æ‰§è¡Œå®Œ</span></span><br><span class="line">                        t2.join();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e)</span><br><span class="line">                          &#123;</span><br><span class="line">                           e.printStackTrace();</span><br><span class="line">                          &#125;</span><br><span class="line">                         System.out.println(<span class="string">&quot;t3&quot;</span>);</span><br><span class="line">                         &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//è¿™é‡Œä¸‰ä¸ªçº¿ç¨‹çš„å¯åŠ¨é¡ºåºå¯ä»¥ä»»æ„ï¼Œå¤§å®¶å¯ä»¥è¯•ä¸‹ï¼</span></span><br><span class="line">         t3.start();</span><br><span class="line">         t2.start();</span><br><span class="line">         t1.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-3-å¤šçº¿ç¨‹">1.4.3 å¤šçº¿ç¨‹</h3>
<h4 id="1-è¯·ç®€è¿°ä¸€ä¸‹å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼Ÿ-ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿä½¿ç”¨å¤šçº¿ç¨‹ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ">1.<strong>è¯·ç®€è¿°ä¸€ä¸‹å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼Ÿ</strong> ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿä½¿ç”¨å¤šçº¿ç¨‹ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4>
<ul>
<li>
<p><strong>åŒæ­¥æ–¹æ³•</strong>ï¼šå¯ä»¥ä½¿ç”¨synchronizedã€lockã€volatileå’ŒThreadLocalæ¥å®ç°åŒæ­¥ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</strong></p>
<ul>
<li>å‡å°‘<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</strong>ï¼ˆå…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒº ï¼Œæ³¨æ„ï¼Œå‡å°‘â‰ æ²¡æœ‰ï¼‰</li>
<li>åˆ©ç”¨å¥½å¤šçº¿ç¨‹æœºåˆ¶å¯ä»¥å¤§å¤§æ<strong>é«˜ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘èƒ½â¼’</strong>ä»¥åŠæ€§èƒ½</li>
<li><strong>å¤šæ ¸æ—¶ä»£</strong> ï¼šå¤šæ ¸æ—¶ä»£å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ CPU åˆ©ç”¨ç‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘ä»¬è¦è®¡ç®—â¼€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬åªç”¨â¼€ä¸ªçº¿ç¨‹çš„è¯ï¼ŒCPU <strong>åªä¼šâ¼€ä¸ª CPU æ ¸â¼¼</strong>è¢«åˆ©ç”¨åˆ°ï¼Œè€Œåˆ›å»ºå¤šä¸ªçº¿ç¨‹å°±å¯ä»¥è®©å¤šä¸ª CPU æ ¸â¼¼è¢«åˆ©ç”¨åˆ°ï¼Œè¿™æ ·å°±æé«˜äº† CPU çš„åˆ©ç”¨ç‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¸¦æ¥çš„é—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li><u>å†…å­˜æ³„æ¼ã€ä¸Šä¸‹â½‚åˆ‡æ¢ã€æ­»é”</u>è¿˜æœ‰å—é™äºç¡¬ä»¶å’Œè½¯ä»¶çš„èµ„æºé—²ç½®é—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ">2. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4>
<blockquote>
<p>å¥½æ–‡ï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/94762520">ä¸€æ–‡ææ‡‚CAS</a></p>
</blockquote>
<ul>
<li>
<p><strong>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></p>
<p>å¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚<u>å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„</u>ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
</li>
<li>
<p><strong>å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</strong></p>
<ol>
<li><strong>ä½¿ç”¨ synchronized å…³é”®å­—</strong> ã€‚å¼€é”€æ¯”è¾ƒå¤§</li>
<li><strong>ä½¿ç”¨Lock é”</strong> ã€‚é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ Lock é”è¦æ¯”ä½¿ç”¨synchronized å…³é”®å­—ï¼Œåœ¨æ€§èƒ½ä¸Šå¾—åˆ°æå¤§çš„æé«˜ã€‚å› ä¸º Lock åº•å±‚æ˜¯é€šè¿‡ AQS + CAS æœºåˆ¶æ¥å®ç°çš„ã€‚</li>
<li><strong>ä½¿ç”¨ Atomic åŸå­ç±»</strong> ã€‚ä½¿ç”¨ Lock æ–¹å¼ï¼Œä¸€æ—¦ unlock() æ–¹æ³•ä½¿ç”¨ä¸è§„èŒƒï¼Œå¯èƒ½å¯¼è‡´æ­»é”ã€‚ Atomic åŸå­ç±»ï¼Œå› ä¸ºå…¶åº•å±‚åŸºäº CAS ä¹è§‚é”æ¥å®ç°çš„ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</li>
<li><strong>ä½¿ç”¨Volatileï¼Ÿä¸å¯è¡Œï¼</strong> å› ä¸ºæ— æ³•ä¿è¯åŸå­æ€§ã€‚</li>
</ol>
</li>
</ul>
<h4 id="3-çº¿ç¨‹å®‰å…¨éœ€è¦ä¿è¯å‡ ä¸ªåŸºæœ¬ç‰¹å¾ï¼Ÿ">3.<strong>çº¿ç¨‹å®‰å…¨éœ€è¦ä¿è¯å‡ ä¸ªåŸºæœ¬ç‰¹å¾ï¼Ÿ</strong></h4>
<ul>
<li><strong>åŸå­æ€§</strong>ï¼Œç®€å•è¯´å°±æ˜¯ç›¸å…³æ“ä½œä¸ä¼šä¸­é€”è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œä¸€èˆ¬é€šè¿‡åŒæ­¥æœºåˆ¶å®ç°ã€‚</li>
<li><strong>å¯è§æ€§</strong>ï¼Œæ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡ï¼Œå…¶çŠ¶æ€èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çŸ¥æ™“ï¼Œé€šå¸¸è¢«è§£é‡Šä¸ºå°†<br>
çº¿ç¨‹æœ¬åœ°çŠ¶æ€åæ˜ åˆ°ä¸»å†…å­˜ä¸Šï¼Œvolatile å°±æ˜¯è´Ÿè´£ä¿è¯å¯è§æ€§çš„ã€‚</li>
<li><strong>æœ‰åºæ€§</strong>ï¼Œæ˜¯ä¿è¯çº¿ç¨‹å†…ä¸²è¡Œè¯­ä¹‰ï¼Œé¿å…æŒ‡ä»¤é‡æ’ç­‰ã€‚</li>
</ul>
<h4 id="4-ã€å¾…è¡¥å……ã€‘å¦‚ä½•åœ¨çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Ÿ">4. ã€å¾…è¡¥å……ã€‘<strong>å¦‚ä½•åœ¨çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Ÿ</strong></h4>
<p>å¯ä»¥ä½¿ç”¨åŠ é”ï¼Œæ¯”å¦‚synchronizedæˆ–è€…lockã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ConcurrentåŒ…ä¸‹çš„åŸå­ç±»ã€‚</p>
<h4 id="5-å¤šçº¿ç¨‹ä¸­çš„i-çº¿ç¨‹å®‰å…¨å—ï¼Ÿè¯·ç®€è¿°ä¸€ä¸‹åŸå› ï¼Ÿ">5.<strong>å¤šçº¿ç¨‹ä¸­çš„i++çº¿ç¨‹å®‰å…¨å—ï¼Ÿè¯·ç®€è¿°ä¸€ä¸‹åŸå› ï¼Ÿ</strong></h4>
<p>ä¸å®‰å…¨ï¼Œå› ä¸º<strong>i++ä¸æ˜¯åŸå­æ€§æ“ä½œ</strong>ã€‚i++åˆ†ä¸ºè¯»å–iå€¼ï¼Œå¯¹iå€¼åŠ ä¸€ï¼Œå†èµ‹å€¼ç»™i++ï¼Œæ‰§è¡ŒæœŸä¸­ä»»ä½•ä¸€æ­¥éƒ½æ˜¯æœ‰å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æŠ¢å çš„ã€‚</p>
<h4 id="6-ä»‹ç»ä¸€ä¸‹ThreadLocalåŸç†ï¼Ÿ">6.<strong>ä»‹ç»ä¸€ä¸‹ThreadLocalåŸç†ï¼Ÿ</strong></h4>
<blockquote>
<p>ä¸€ç¯‡è®²çš„ä¸é”™çš„æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wupeixuan/p/12638203.html">https://www.cnblogs.com/wupeixuan/p/12638203.html</a></p>
</blockquote>
<p>å½“å¤šçº¿ç¨‹è®¿é—®å…±äº«å¯å˜æ•°æ®æ—¶ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹é—´åŒæ­¥çš„é—®é¢˜ï¼Œ<u><strong>å¹¶ä¸æ˜¯</strong>æ‰€æœ‰æ—¶å€™ï¼Œéƒ½è¦ç”¨åˆ°å…±äº«æ•°æ®</u>ï¼Œæ‰€ä»¥å°±éœ€è¦çº¿ç¨‹å°é—­å‡ºåœºäº†ã€‚<strong>æ•°æ®éƒ½è¢«å°é—­åœ¨å„è‡ªçš„çº¿ç¨‹ä¹‹ä¸­</strong>ï¼Œå°±ä¸éœ€è¦åŒæ­¥ï¼Œè¿™ç§é€šè¿‡å°†æ•°æ®å°é—­åœ¨çº¿ç¨‹ä¸­è€Œé¿å…ä½¿ç”¨åŒæ­¥çš„æŠ€æœ¯ç§°ä¸º<strong>çº¿ç¨‹å°é—­</strong>ã€‚</p>
<p>ThreadLocal æ˜¯ Java é‡Œä¸€ç§ç‰¹æ®Šå˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹çº§åˆ«å˜é‡ï¼Œ<u>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª ThreadLocal å°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„ä¸€ä¸ªå˜é‡</u>ï¼Œç«æ€æ¡ä»¶è¢«å½»åº•æ¶ˆé™¤äº†ï¼Œåœ¨å¹¶å‘æ¨¡å¼ä¸‹æ˜¯ç»å¯¹å®‰å…¨çš„å˜é‡ã€‚</p>
<ul>
<li>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p>
<p>åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼ŒTreadLocal åšåˆ°å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€å¯¹è±¡ set æ“ä½œï¼Œä½†æ˜¯ get è·å–çš„å€¼è¿˜éƒ½æ˜¯æ¯ä¸ªçº¿ç¨‹ set çš„å€¼ï¼Œä½“ç°äº†çº¿ç¨‹çš„å°é—­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ThreadLocalå˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; THREAD_LOCAL = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ThreadLocalDemo().threadLocalTest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadLocalTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸»çº¿ç¨‹è®¾ç½®å€¼</span></span><br><span class="line">        THREAD_LOCAL.set(<span class="string">&quot;wupx&quot;</span>);</span><br><span class="line">        String v = THREAD_LOCAL.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹å‰ï¼Œ&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot;</span> + v);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                String v = THREAD_LOCAL.get();</span><br><span class="line">                <span class="comment">// æ­¤æ—¶æ–°å»ºçº¿ç¨‹Thread-0å–åˆ°çš„æ˜¯nullï¼Œæ„å‘³ç€ä¸åŒçº¿ç¨‹å–åˆ°çš„å€¼ä¸åŒçš„</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot;</span> + v);</span><br><span class="line">                <span class="comment">// è®¾ç½® threadLocal</span></span><br><span class="line">                THREAD_LOCAL.set(<span class="string">&quot;huxy&quot;</span>);</span><br><span class="line">                v = THREAD_LOCAL.get();</span><br><span class="line">                System.out.println(<span class="string">&quot;é‡æ–°è®¾ç½®ä¹‹åï¼Œ&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ä¸ºï¼š&quot;</span> + v);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç»“æŸ</span></span><br><span class="line">        Thread.sleep(<span class="number">3000L</span>);</span><br><span class="line">        v = THREAD_LOCAL.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹åï¼Œ&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot;</span> + v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  è¾“å‡ºç»“æœ */</span></span><br><span class="line"><span class="comment">// è™½ç„¶Thread-0å·²ç»æ”¹å˜äº†å€¼ï¼Œä½†æ˜¯mainå–åˆ°çš„å€¼ä¾æ—§æ˜¯ä¸€æ ·çš„ã€‚</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹å‰ï¼Œmainçº¿ç¨‹å–åˆ°çš„å€¼ï¼šwupx</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹å–åˆ°çš„å€¼ï¼šnull</span></span><br><span class="line"><span class="comment">é‡æ–°è®¾ç½®ä¹‹åThread-0çº¿ç¨‹å–åˆ°çš„å€¼ä¸ºï¼šhuxy</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹æ‰§è¡Œç»“æŸ</span></span><br><span class="line"><span class="comment">Thread-0çº¿ç¨‹æ‰§è¡Œä¹‹åï¼Œmainçº¿ç¨‹å–åˆ°çš„å€¼ï¼šwupx</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>ThreadLocalåŸç†</strong></p>
<p>ThreadLocalæœ‰ä¸€ä¸ª<strong>é™æ€å†…éƒ¨ç±»ThreadLocalMapï¼ŒThreadLocalMapåˆåŒ…å«äº†ä¸€ä¸ªEntryæ•°ç»„</strong>ï¼ŒEntryæœ¬èº«æ˜¯ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œä»–çš„keyæ˜¯æŒ‡å‘ThreadLocalçš„å¼±å¼•ç”¨ï¼ŒEntryå…·å¤‡äº†ä¿å­˜key valueé”®å€¼å¯¹çš„èƒ½åŠ›ã€‚</p>
<p><img src="https://i.loli.net/2021/05/16/MXKyQxYDjWdOku2.png" alt="image-20210516142348550"></p>
<ul>
<li>
<p><strong>ThreadLocalMap</strong></p>
<blockquote>
<p>ThreadLocalMap æ˜¯ ThreadLocal çš„é™æ€å†…éƒ¨ç±»ï¼Œå½“ä¸€ä¸ª<strong>çº¿ç¨‹æœ‰å¤šä¸ª ThreadLocal å¯¹è±¡æ—¶</strong>æ—¶ï¼Œéœ€è¦ä¸€ä¸ªå®¹å™¨æ¥ç®¡ç†å¤š ThreadLocalï¼ŒThreadLocalMap çš„ä½œç”¨å°±æ˜¯ç®¡ç†çº¿ç¨‹ä¸­å¤šä¸ª ThreadLocalã€‚</p>
</blockquote>
<p>ä»æºç ä¸­çœ‹åˆ° ThreadLocalMap å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„ Map ç»“æ„ï¼Œåº•å±‚æ˜¯æ•°ç»„ï¼Œæœ‰åˆå§‹åŒ–å¤§å°ï¼Œä¹Ÿæœ‰æ‰©å®¹é˜ˆå€¼å¤§å°ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯ Entryï¼Œ<strong>Entry çš„ key å°±æ˜¯ ThreadLocal çš„å¼•ç”¨ï¼Œvalue æ˜¯ ThreadLocal çš„å€¼</strong>ã€‚ThreadLocalMap è§£å†³ hash å†²çªçš„æ–¹å¼é‡‡ç”¨çš„æ˜¯<strong>çº¿æ€§æ¢æµ‹æ³•</strong>ï¼Œå¦‚æœå‘ç”Ÿå†²çªä¼šç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªç©ºçš„ä½ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalMap</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * é”®å€¼å¯¹å®ä½“çš„å­˜å‚¨ç»“æ„</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line">		<span class="comment">// å½“å‰çº¿ç¨‹å…³è”çš„ valueï¼Œè¿™ä¸ª value å¹¶æ²¡æœ‰ç”¨å¼±å¼•ç”¨è¿½è¸ª</span></span><br><span class="line">		Object value;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * æ„é€ é”®å€¼å¯¹</span></span><br><span class="line"><span class="comment">		 *</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> k k ä½œ key,ä½œä¸º key çš„ ThreadLocal ä¼šè¢«åŒ…è£…ä¸ºä¸€ä¸ªå¼±å¼•ç”¨</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> v v ä½œ value</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">			<span class="keyword">super</span>(k);</span><br><span class="line">			value = v;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åˆå§‹å®¹é‡ï¼Œå¿…é¡»ä¸º 2 çš„å¹‚</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å­˜å‚¨ ThreadLocal çš„é”®å€¼å¯¹å®ä½“æ•°ç»„ï¼Œé•¿åº¦å¿…é¡»ä¸º 2 çš„å¹‚</span></span><br><span class="line">	<span class="keyword">private</span> Entry[] table;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ThreadLocalMap å…ƒç´ æ•°é‡</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ‰©å®¹çš„é˜ˆå€¼ï¼Œé»˜è®¤æ˜¯æ•°ç»„å¤§å°çš„ä¸‰åˆ†ä¹‹äºŒ</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> threshold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>Setæ–¹æ³•</strong></p>
<blockquote>
<p>è°ƒç”¨ ThreadLocalå¯¹è±¡.set(value)ï¼Œå®é™…åœ¨è°ƒç”¨å½“å‰çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡.set(this,value) ï¼Œä¼šæŠŠå½“å‰ <code>threadLocal</code> å¯¹è±¡ä½œä¸º keyï¼Œæƒ³è¦ä¿å­˜çš„å¯¹è±¡ä½œä¸º valueï¼Œå­˜å…¥ mapã€‚</p>
</blockquote>
<p>set æ–¹æ³•çš„æµç¨‹ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>å…ˆè·å–åˆ°å½“å‰çº¿ç¨‹çš„å¼•ç”¨</li>
<li>åˆ©ç”¨è¿™ä¸ªå¼•ç”¨æ¥è·è¿”å›å½“å‰çº¿ç¨‹åˆ° ThreadLocalMap</li>
<li>å¦‚æœ map ä¸ºç©ºï¼Œåˆ™å»åˆ›å»ºä¸€ä¸ª ThreadLocalMap</li>
<li>å¦‚æœ map ä¸ä¸ºç©ºï¼Œå°±åˆ©ç”¨ ThreadLocalMap çš„ <code>set (thiså½“å‰å¯¹è±¡ï¼Œvalue)</code> æ·»åŠ é”®å€¼å¯¹</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸ºå½“å‰ ThreadLocal å¯¹è±¡å…³è” value å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value è¦å­˜å‚¨åœ¨æ­¤çº¿ç¨‹çš„çº¿ç¨‹å‰¯æœ¬çš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// è¿”å›å½“å‰ThreadLocalæ‰€åœ¨çš„çº¿ç¨‹</span></span><br><span class="line">	Thread t = Thread.currentThread();</span><br><span class="line">	<span class="comment">// è¿”å›å½“å‰çº¿ç¨‹æŒæœ‰çš„map</span></span><br><span class="line">	ThreadLocalMap map = getMap(t);</span><br><span class="line">	<span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="comment">// å¦‚æœ ThreadLocalMap ä¸ä¸ºç©ºï¼Œåˆ™ç›´æ¥å­˜å‚¨&lt;ThreadLocal, T&gt;é”®å€¼å¯¹</span></span><br><span class="line">        <span class="comment">// æ­¤æ—¶thisæ˜¯ThreadLocalå¯¹è±¡ï¼Œè¿™æ˜¯åœ¨ThreadLocalç±»ä¸­</span></span><br><span class="line">		map.set(<span class="keyword">this</span>, value);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// å¦åˆ™ï¼Œéœ€è¦ä¸ºå½“å‰çº¿ç¨‹åˆå§‹åŒ– ThreadLocalMapï¼Œå¹¶å­˜å‚¨é”®å€¼å¯¹ &lt;this, firstValue&gt;</span></span><br><span class="line">		createMap(t, value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰çº¿ç¨‹ thread æŒæœ‰çš„ ThreadLocalMapå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>Getæ–¹æ³•</strong></p>
<blockquote>
<p>è°ƒç”¨ThreadLocalå¯¹è±¡.get() æ–¹å¼æ—¶ï¼Œå®é™…åœ¨è°ƒç”¨ThreadLocalMapå¯¹è±¡.getEntry(this) æ–¹æ³•ã€‚thisæ˜¯å½“å‰ThreadLocalå¯¹è±¡ã€‚</p>
</blockquote>
<p>get æ–¹æ³•çš„ä¸»è¦æµç¨‹ä¸ºï¼š</p>
<ul>
<li>å…ˆè·å–åˆ°å½“å‰çº¿ç¨‹çš„å¼•ç”¨</li>
<li>è·å–å½“å‰çº¿ç¨‹å†…éƒ¨çš„ ThreadLocalMapå¯¹è±¡</li>
<li>å¦‚æœ map å­˜åœ¨ï¼Œåˆ™è·å–å½“å‰ ThreadLocal å¯¹åº”çš„ value å€¼</li>
<li>å¦‚æœ map ä¸å­˜åœ¨æˆ–è€…æ‰¾ä¸åˆ° value å€¼ï¼Œåˆ™è°ƒç”¨ setInitialValue() è¿›è¡Œåˆå§‹åŒ–</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰ ThreadLocal å¯¹è±¡å…³è”çš„å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// è¿”å›å½“å‰ ThreadLocal æ‰€åœ¨çš„çº¿ç¨‹</span></span><br><span class="line">	Thread t = Thread.currentThread();</span><br><span class="line">	<span class="comment">// ä»çº¿ç¨‹ä¸­æ‹¿åˆ° ThreadLocalMap</span></span><br><span class="line">	ThreadLocalMap map = getMap(t);</span><br><span class="line">	<span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="comment">// ä» map ä¸­æ‹¿åˆ° entry</span></span><br><span class="line">		ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</span><br><span class="line">		<span class="comment">// å¦‚æœä¸ä¸ºç©ºï¼Œè¯»å–å½“å‰ ThreadLocal ä¸­ä¿å­˜çš„å€¼</span></span><br><span class="line">		<span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">			T result = (T) e.value;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// è‹¥ map ä¸ºç©ºï¼Œåˆ™å¯¹å½“å‰çº¿ç¨‹çš„ ThreadLocal è¿›è¡Œåˆå§‹åŒ–ï¼Œæœ€åè¿”å›å½“å‰çš„ ThreadLocal å¯¹è±¡å…³è”çš„åˆå€¼ï¼Œå³ value</span></span><br><span class="line">	<span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>resize æ–¹æ³•</strong></p>
<p>å½“å‰çº¿ç¨‹çš„ ThreadLocalMap ä¸­çš„ ThreadLocal çš„ä¸ªæ•°è¶…è¿‡å®¹é‡é˜ˆå€¼æ—¶ï¼ŒThreadLocalMap å°±è¦å¼€å§‹æ‰©å®¹äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç•¥</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="7-ä¸ºä»€ä¹ˆThreadLocalé€ æˆå†…å­˜æ³„æ¼ï¼Ÿ">7.<strong>ä¸ºä»€ä¹ˆ<code>ThreadLocal</code>é€ æˆå†…å­˜æ³„æ¼ï¼Ÿ</strong></h4>
<p>ThreadLocalMap æ˜¯ ThreadLocal çš„é™æ€å†…éƒ¨ç±»ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æœ‰å¤š ä¸ªThreadLocal æ—¶ï¼Œéœ€è¦ä¸€ä¸ªå®¹å™¨æ¥ç®¡ç†å¤šä¸ª ThreadLocalï¼ŒThreadLocalMap çš„ä½œç”¨å°±æ˜¯ç®¡ç†çº¿ç¨‹ä¸­å¤šä¸ª ThreadLocalã€‚</p>
<blockquote>
<p>æºç ä¸­çœ‹åˆ° ThreadLocalMap å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„ Map ç»“æ„ï¼š</p>
<p>åº•å±‚æ˜¯æ•°ç»„<code>Entry[] table</code>ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯ Entryç±»ï¼š<strong>Entry çš„ä¸¤ä¸ªå±æ€§ï¼Œ key æ˜¯ ThreadLocalç±»å‹çš„å¼•ç”¨ï¼Œvalue æ˜¯ ThreadLocal çš„å€¼</strong>ã€‚</p>
</blockquote>
<ul>
<li><strong>åŸå› </strong>ï¼š<code>ThreadLocalMap</code>çš„keyä¸º<strong>å¼±å¼•ç”¨</strong>ï¼ˆæœ‰ç”¨ä½†éå¿…éœ€ï¼Œä¸‹ä¸€æ¬¡GCä¼šè¢«å›æ”¶ï¼‰ï¼Œvalueä¸º<strong>å¼ºå¼•ç”¨</strong>ï¼ˆGCè¿‡ç¨‹ä¸ä¼šè¢«å›æ”¶ï¼‰ï¼Œ<u>æœ‰å¯èƒ½é€ æˆkeyè¢«GCï¼Œvalueæ²¡è¢«G</u>Cï¼Œ<code>ThreadLocalMap</code>ä¸­å‡ºç°<code>null</code>ä¸ºkeyçš„<code>Entry</code>ï¼Œäº§ç”Ÿ<u>å†…å­˜æ³„æ¼</u>ï¼ˆ<strong>è½¯å¼•ç”¨</strong>ï¼šæœ‰ç”¨ä½†éå¿…éœ€ï¼Œå†…å­˜æº¢å‡ºä¹‹å‰è¢«å›æ”¶ï¼‰ï¼›</li>
<li><strong>è§£å†³</strong>ï¼š è°ƒç”¨<code>set()</code>ã€<code>get()</code>å’Œ<code>remove()</code>æ–¹æ³•æ—¶ï¼Œä¼šè‡ªåŠ¨æ¸…ç†æ‰keyä¸º<code>null</code>çš„è®°å½•ï¼Œä½†ä½¿ç”¨<code>ThreadLocal</code>æ–¹æ³•å<strong>æ‰‹åŠ¨<code>remove()</code></strong>ã€‚</li>
</ul>
<h4 id="8-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ">8.<strong>ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</strong></h4>
<p><u>ä¸€ä¸ªçº¿ç¨‹<strong>è®©å‡ºå¤„ç†å™¨ä½¿ç”¨æƒ</strong>ï¼Œå°±æ˜¯â€œåˆ‡å‡ºâ€ï¼›å¦å¤–ä¸€ä¸ªçº¿ç¨‹è·å–å¤„ç†å™¨ä½¿ç”¨æƒï¼Œå°±æ˜¯â€œåˆ‡å…¥â€ã€‚</u>åœ¨è¿™ä¸ªåˆ‡å…¥åˆ‡å‡ºçš„è¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šä¿å­˜å’Œæ¢å¤ç›¸å…³çš„è¿›åº¦ä¿¡æ¯ï¼Œè¿™ä¸ªè¿›åº¦ä¿¡æ¯å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€œä¸Šä¸‹æ–‡â€ï¼Œä¸Šä¸‹æ–‡ä¸­ä¸€èˆ¬åŒ…å«äº†å¯„å­˜å™¨çš„å­˜å‚¨å†…å®¹ä»¥åŠç¨‹åºè®¡æ•°å™¨å­˜å‚¨çš„æŒ‡ä»¤å†…å®¹ã€‚</p>
<h4 id="9-è¯·é—®ä»€ä¹ˆæ˜¯æ­»é”-deadlock">9.<strong>è¯·é—®ä»€ä¹ˆæ˜¯æ­»é”(deadlock)?</strong></h4>
<p>æ­»é”æ˜¯æŒ‡<u>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡</u>ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç§°ä¸ºæ­»é”è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ã€‚</p>
<h4 id="10-JAVAä¸­å¦‚ä½•ç¡®ä¿Nä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®Nä¸ªèµ„æºï¼Œä½†åŒæ—¶åˆä¸å¯¼è‡´æ­»é”ï¼Ÿ">10. <strong>JAVAä¸­å¦‚ä½•ç¡®ä¿Nä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®Nä¸ªèµ„æºï¼Œä½†åŒæ—¶åˆä¸å¯¼è‡´æ­»é”ï¼Ÿ</strong></h4>
<p><u>æœ€ç®€å•æ–¹æ³•ï¼š<strong>æŒ‡å®šè·å–é”çš„é¡ºåºï¼Œå¹¶å¼ºåˆ¶çº¿ç¨‹æŒ‰ç…§æŒ‡å®šçš„é¡ºåºè·å–é”</strong>ã€‚</u></p>
<p>å› æ­¤ï¼Œå¦‚æœæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯ä»¥åŒæ ·çš„é¡ºåºåŠ é”å’Œé‡Šæ”¾é”ï¼Œå°±ä¸ä¼šå‡ºç°æ­»é”äº†ã€‚æˆ–è€…é€šè¿‡ç ´åæ­»é”çš„å››ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><strong>äº’æ–¥</strong> ï¼š ä¸å¯èƒ½ç ´åã€‚</li>
<li><strong>ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶</strong>ï¼šè¿›ç¨‹å¿…é¡» <u>ç­‰æ‰€æœ‰è¦è¯·æ±‚çš„èµ„æºéƒ½ç©ºé—²æ—¶æ‰èƒ½ç”³è¯·èµ„æº</u>ï¼Œ è¿™ç§æ–¹æ³•ä¼šä½¿<strong>èµ„æºæµªè´¹ä¸¥é‡</strong> ã€‚å…è®¸è¿›ç¨‹è·å–åˆæœŸæ‰€éœ€èµ„æºåï¼Œä¾¿å¼€å§‹è¿è¡Œï¼Œè¿è¡Œè¿‡ç¨‹ä¸­å†é€æ­¥é‡Šæ”¾è‡ªå·±å æœ‰çš„èµ„æºã€‚</li>
<li><strong>ç ´åä¸å¯æŠ¢å æ¡ä»¶</strong>ï¼š æ–¹æ³•ä»£ä»·å¤§ï¼Œå®ç°å¤æ‚ã€‚</li>
<li><strong>ç ´åå¾ªåç­‰å¾…æ¡ä»¶</strong> ï¼šå¯¹å„è¿›ç¨‹è¯·æ±‚èµ„æºçš„é¡ºåºåšä¸€ä¸ªè§„å®šï¼Œé¿å…ç›¸äº’ç­‰å¾…ã€‚è¿™ç§æ–¹æ³•å¯¹<u>èµ„æºçš„åˆ©ç”¨ç‡æ¯”å‰ä¸¤ç§éƒ½é«˜</u>ï¼Œä½†æ˜¯å‰æœŸè¦ä¸ºè®¾å¤‡æŒ‡å®šåºå·ï¼Œæ–°è®¾å¤‡åŠ å…¥ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå…¶æ¬¡å¯¹ç”¨æˆ·ç¼–ç¨‹ä¹Ÿæœ‰é™åˆ¶ã€‚</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Wanghui Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://hwh.zone/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E5%A4%9A%E7%BA%BF%E7%A8%8B/">https://hwh.zone/2021/11/26/æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_å¤šçº¿ç¨‹/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://hwh.zone" target="_blank">royhuang's blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JAVA/">JAVA</a><a class="post-meta__tags" href="/tags/%E6%A0%A1%E6%8B%9B/">æ ¡æ‹›</a></div><div class="post_share"><div class="social-share" data-image="/img/about-bg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatPay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechatPay.png" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%9B%86%E5%90%88/"><img class="prev-cover" src="/img/about-bg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é›†åˆ</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%94%81/"><img class="next-cover" src="/img/about-bg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é”</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_Java%E5%85%A5%E9%97%A8/" title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_Javaå…¥é—¨"><img class="cover" src="/img/about-bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_Javaå…¥é—¨</div></div></a></div><div><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_JVM/" title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_JVM"><img class="cover" src="/img/about-bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_JVM</div></div></a></div><div><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%94%81/" title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é”"><img class="cover" src="/img/about-bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é”</div></div></a></div><div><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1/" title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é¢å¯¹å¯¹è±¡"><img class="cover" src="/img/about-bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é¢å¯¹å¯¹è±¡</div></div></a></div><div><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89_Java_%E9%9B%86%E5%90%88/" title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é›†åˆ"><img class="cover" src="/img/about-bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">æ ¡æ‹›ç¬”è®°ï¼ˆä¸€ï¼‰_Java_é›†åˆ</div></div></a></div><div><a href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰_è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„"><img class="cover" src="/img/about-bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰_è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cat.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Wanghui Huang</div><div class="author-info__description">tech & life</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">28</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">27</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">17</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Wanghui-Huang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Wanghui-Huang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:hwh199601@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">royHuang's studio</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-text">1.4 å¤šçº¿ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0-%E4%B8%89%E4%B8%AA%E7%BA%BF%E7%A8%8B%EF%BC%8C%E5%A6%82%E4%BD%95%E8%AE%A9%E4%BB%96%E4%BB%AC%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%89%93%E5%8D%B0A%E3%80%81B%E3%80%81C%EF%BC%9F%E5%A6%82%E6%9E%9C%E6%98%AF%E5%BE%AA%E7%8E%AF%E6%89%93%E5%8D%B010%E6%AC%A1%E5%91%A2%EF%BC%9F%E4%BE%9D%E6%AC%A1%E6%89%93%E5%8D%B01-100%E5%91%A2%EF%BC%9F%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B0%E5%A5%87%E5%81%B610%E6%AC%A1%E5%91%A2%EF%BC%9F"><span class="toc-text">0.ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•è®©ä»–ä»¬æŒ‰é¡ºåºæ‰“å°Aã€Bã€Cï¼Ÿå¦‚æœæ˜¯å¾ªç¯æ‰“å°10æ¬¡å‘¢ï¼Ÿä¾æ¬¡æ‰“å°1~100å‘¢ï¼Ÿäº¤æ›¿æ‰“å°å¥‡å¶10æ¬¡å‘¢ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#0-1-synchronized-%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F"><span class="toc-text">0.1 synchronized + æ¡ä»¶å˜é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0-2-join"><span class="toc-text">0.2 join</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0-3-Lock"><span class="toc-text">0.3 Lock</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#0-4-Semaphore"><span class="toc-text">0.4 Semaphore</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-%E7%BA%BF%E7%A8%8B%E5%9F%BA%E6%9C%AC"><span class="toc-text">1.4.1 çº¿ç¨‹åŸºæœ¬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B%EF%BC%9F%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%9F"><span class="toc-text">1. ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B%EF%BC%9F"><span class="toc-text">1.1 ä»€ä¹ˆæ˜¯çº¿ç¨‹å’Œè¿›ç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%9F"><span class="toc-text">1.2 å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-%E4%B8%BA%E4%BB%80%E4%B9%88%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8%E3%80%81%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E5%92%8C%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88%E6%98%AF-u-%E7%BA%BF%E7%A8%8B-u-%E7%A7%81%E6%9C%89%E7%9A%84"><span class="toc-text">1.3 ä¸ºä»€ä¹ˆç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„?</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%88%E9%9D%9E%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%89%EF%BC%9F-%E5%93%AA%E7%A7%8D%E6%9C%80%E5%A5%BD%EF%BC%9F"><span class="toc-text">2.åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆéçº¿ç¨‹æ± ï¼‰ï¼Ÿ å“ªç§æœ€å¥½ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%A6%82%E4%BD%95%E5%81%9C%E6%AD%A2%E4%B8%80%E4%B8%AA%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E7%BA%BF%E7%A8%8B%EF%BC%9F"><span class="toc-text">3.å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BB%80%E4%B9%88%E6%98%AFDaemon%E7%BA%BF%E7%A8%8B%EF%BC%9F%E5%AE%83%E6%9C%89%E4%BB%80%E4%B9%88%E6%84%8F%E4%B9%89%EF%BC%9F"><span class="toc-text">4.ä»€ä¹ˆæ˜¯Daemonçº¿ç¨‹ï¼Ÿå®ƒæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%AF%B4%E8%AF%B4CyclicBarrier%E5%92%8CCountDownLatch%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">5.è¯´è¯´CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%AF%B7%E4%BD%A0%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8B%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%8A%B6%E6%80%81%E4%BB%A5%E5%8F%8A%E7%8A%B6%E6%80%81%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%9F"><span class="toc-text">6.è¯·ä½ ç®€è¦è¯´æ˜ä¸€ä¸‹çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-notify-%E5%92%8CnotifyAll-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">7. notify()å’ŒnotifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-sleep-%E5%92%8Cwait-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">8. sleep()å’Œwait() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-1-Thread%E7%B1%BB%E4%B8%AD%E7%9A%84yield%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%EF%BC%9F"><span class="toc-text">8.1 Threadç±»ä¸­çš„yieldæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-java-%E4%B8%ADWait%E3%80%81Sleep%E5%92%8CYield%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">8.2 java ä¸­Waitã€Sleepå’ŒYieldæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-volatile-%E6%98%AF%E4%BB%80%E4%B9%88-%E5%8F%AF%E4%BB%A5%E4%BF%9D%E8%AF%81%E6%9C%89%E5%BA%8F%E6%80%A7%E5%90%97"><span class="toc-text">9. volatile æ˜¯ä»€ä¹ˆ?å¯ä»¥ä¿è¯æœ‰åºæ€§å—?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E4%B8%BA%E4%BB%80%E4%B9%88wait-notify-%E5%92%8C-notifyAll%E8%BF%99%E4%BA%9B%E6%96%B9%E6%B3%95%E4%B8%8D%E5%9C%A8thread%E7%B1%BB%E9%87%8C%E9%9D%A2%EF%BC%9F"><span class="toc-text">10. ä¸ºä»€ä¹ˆwait, notify å’Œ notifyAllè¿™äº›æ–¹æ³•ä¸åœ¨threadç±»é‡Œé¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-%E4%B8%BA%E4%BB%80%E4%B9%88wait%E5%92%8Cnotify%E6%96%B9%E6%B3%95%E8%A6%81%E5%9C%A8%E5%90%8C%E6%AD%A5%E5%9D%97%E4%B8%AD%E8%B0%83%E7%94%A8%EF%BC%9F"><span class="toc-text">11.ä¸ºä»€ä¹ˆwaitå’Œnotifyæ–¹æ³•è¦åœ¨åŒæ­¥å—ä¸­è°ƒç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-%EF%BC%88%E6%B2%A1%E7%BB%86%E7%9C%8B%EF%BC%89Java%E4%B8%ADinterrupted-%E5%92%8C-isInterruptedd%E6%96%B9%E6%B3%95%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-text">12. ï¼ˆæ²¡ç»†çœ‹ï¼‰Javaä¸­interrupted å’Œ isInterrupteddæ–¹æ³•çš„åŒºåˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2-%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-text">1.4.2 çº¿ç¨‹æ± </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%AF%B7%E4%BD%A0%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88thread-pool%EF%BC%89%EF%BC%9F"><span class="toc-text">1.è¯·ä½ è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼ˆthread poolï¼‰ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E8%AF%B7%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="toc-text">1.1 è¯·ä»‹ç»ä¸€ä¸‹ä½¿ç”¨çº¿ç¨‹æ± ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BC%9A%E5%9B%9E%E6%94%B6%E6%A0%B8%E5%BF%83%E7%BA%BF%E7%A8%8B%E5%90%97%EF%BC%9F"><span class="toc-text">1.2 çº¿ç¨‹æ± ä¼šå›æ”¶æ ¸å¿ƒçº¿ç¨‹å—ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%AF%B7%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AF%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%9F"><span class="toc-text">2.è¯·ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">3.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E5%9B%9B%E5%A4%A7%E6%96%B9%E6%B3%95%EF%BC%89%EF%BC%9F%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0%EF%BC%88%E4%B8%83%E5%A4%A7%E5%8F%82%E6%95%B0%EF%BC%89%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">4.å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆå››å¤§æ–¹æ³•ï¼‰ï¼Ÿç›¸å…³å‚æ•°ï¼ˆä¸ƒå¤§å‚æ•°ï¼‰æ˜¯ä»€ä¹ˆ?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%A0%B8%E5%BF%83%E7%BA%BF%E7%A8%8B%E6%95%B0corePoolSize%E6%80%8E%E4%B9%88%E8%AE%BE%E7%BD%AE%E5%91%A2%EF%BC%9F"><span class="toc-text">5.çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°corePoolSizeæ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%EF%BC%88%E4%B8%8D%E7%86%9F%E6%82%89%EF%BC%89Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%AD%E9%98%9F%E5%88%97%E5%B8%B8%E7%94%A8%E7%B1%BB%E5%9E%8B%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-text">6.ï¼ˆä¸ç†Ÿæ‚‰ï¼‰Javaçº¿ç¨‹æ± ä¸­é˜Ÿåˆ—å¸¸ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%9C%89%E4%B8%89%E4%B8%AA%E7%BA%BF%E7%A8%8BT1-T2-T3-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%EF%BC%9F"><span class="toc-text">7.æœ‰ä¸‰ä¸ªçº¿ç¨‹T1,T2,T3,å¦‚ä½•ä¿è¯é¡ºåºæ‰§è¡Œï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-3-%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-text">1.4.3 å¤šçº¿ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%AF%B7%E7%AE%80%E8%BF%B0%E4%B8%80%E4%B8%8B%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%9F%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BC%9A%E5%B8%A6%E6%9D%A5%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">1.è¯·ç®€è¿°ä¸€ä¸‹å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„æ–¹æ³•ï¼Ÿ ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿä½¿ç”¨å¤šçº¿ç¨‹ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%9F%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%9F"><span class="toc-text">2. ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%9C%80%E8%A6%81%E4%BF%9D%E8%AF%81%E5%87%A0%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%89%B9%E5%BE%81%EF%BC%9F"><span class="toc-text">3.çº¿ç¨‹å®‰å…¨éœ€è¦ä¿è¯å‡ ä¸ªåŸºæœ¬ç‰¹å¾ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E3%80%90%E5%BE%85%E8%A1%A5%E5%85%85%E3%80%91%E5%A6%82%E4%BD%95%E5%9C%A8%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%AE%A1%E6%95%B0%E5%99%A8%EF%BC%9F"><span class="toc-text">4. ã€å¾…è¡¥å……ã€‘å¦‚ä½•åœ¨çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84i-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%90%97%EF%BC%9F%E8%AF%B7%E7%AE%80%E8%BF%B0%E4%B8%80%E4%B8%8B%E5%8E%9F%E5%9B%A0%EF%BC%9F"><span class="toc-text">5.å¤šçº¿ç¨‹ä¸­çš„i++çº¿ç¨‹å®‰å…¨å—ï¼Ÿè¯·ç®€è¿°ä¸€ä¸‹åŸå› ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8BThreadLocal%E5%8E%9F%E7%90%86%EF%BC%9F"><span class="toc-text">6.ä»‹ç»ä¸€ä¸‹ThreadLocalåŸç†ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E4%B8%BA%E4%BB%80%E4%B9%88ThreadLocal%E9%80%A0%E6%88%90%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%EF%BC%9F"><span class="toc-text">7.ä¸ºä»€ä¹ˆThreadLocalé€ æˆå†…å­˜æ³„æ¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%EF%BC%9F"><span class="toc-text">8.ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E8%AF%B7%E9%97%AE%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%BB%E9%94%81-deadlock"><span class="toc-text">9.è¯·é—®ä»€ä¹ˆæ˜¯æ­»é”(deadlock)?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-JAVA%E4%B8%AD%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9DN%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AEN%E4%B8%AA%E8%B5%84%E6%BA%90%EF%BC%8C%E4%BD%86%E5%90%8C%E6%97%B6%E5%8F%88%E4%B8%8D%E5%AF%BC%E8%87%B4%E6%AD%BB%E9%94%81%EF%BC%9F"><span class="toc-text">10. JAVAä¸­å¦‚ä½•ç¡®ä¿Nä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®Nä¸ªèµ„æºï¼Œä½†åŒæ—¶åˆä¸å¯¼è‡´æ­»é”ï¼Ÿ</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AB%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E5%9C%BA%E6%99%AF%E5%92%8C%E6%99%BA%E5%8A%9B%E9%A2%98/" title="æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰_è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜">æ ¡æ‹›ç¬”è®°ï¼ˆå…«ï¼‰_è®¡ç®—æœºåŸºç¡€_åœºæ™¯&amp;æ™ºåŠ›é¢˜</a><time datetime="2021-11-26T13:37:19.761Z" title="å‘è¡¨äº 2021-11-26 21:37:19">2021-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰_è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„">æ ¡æ‹›ç¬”è®°ï¼ˆä¸ƒï¼‰_è®¡ç®—æœºåŸºç¡€_æ•°æ®ç»“æ„</a><time datetime="2021-11-26T13:20:04.945Z" title="å‘è¡¨äº 2021-11-26 21:20:04">2021-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_Redis/" title="æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰_è®¡ç®—æœºåŸºç¡€_Redis">æ ¡æ‹›ç¬”è®°ï¼ˆå…­ï¼‰_è®¡ç®—æœºåŸºç¡€_Redis</a><time datetime="2021-11-26T13:16:21.848Z" title="å‘è¡¨äº 2021-11-26 21:16:21">2021-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_MySQL/" title="æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰_è®¡ç®—æœºåŸºç¡€_MySQL">æ ¡æ‹›ç¬”è®°ï¼ˆäº”ï¼‰_è®¡ç®—æœºåŸºç¡€_MySQL</a><time datetime="2021-11-26T12:57:42.047Z" title="å‘è¡¨äº 2021-11-26 20:57:42">2021-11-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/11/26/%E6%A0%A1%E6%8B%9B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80_%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰_è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ">æ ¡æ‹›ç¬”è®°ï¼ˆå››ï¼‰_è®¡ç®—æœºåŸºç¡€_æ“ä½œç³»ç»Ÿ</a><time datetime="2021-11-26T12:55:27.544Z" title="å‘è¡¨äº 2021-11-26 20:55:27">2021-11-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/about-bg.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 By Wanghui Huang</div><div class="footer_custom_text">Tencent Cloud</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="æ”¾å¤§å­—ä½“"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="ç¼©å°å­—ä½“"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadUtterances () {
  let ele = document.createElement('script')
  ele.setAttribute('id', 'utterances_comment')
  ele.setAttribute('src', 'https://utteranc.es/client.js')
  ele.setAttribute('repo', 'Wanghui-Huang/gittalk')
  ele.setAttribute('issue-term', 'pathname')
  let nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
  ele.setAttribute('theme', nowTheme)
  ele.setAttribute('crossorigin', 'anonymous')
  ele.setAttribute('async', 'true')
  document.getElementById('utterances-wrap').insertAdjacentElement('afterbegin',ele)
}

function utterancesTheme () {
  if (document.querySelector('.utterances-frame')) {
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
    const message = {
      type: 'set-theme',
      theme: theme
    };
    const iframe = document.querySelector('.utterances-frame');
    iframe.contentWindow.postMessage(message, 'https://utteranc.es');
  }
}

if ('Utterances' === 'Utterances' || !false) {
  if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
  else loadUtterances()
} else {
  function loadOtherComment () {
    loadUtterances()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>